
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d004f489-c08d-5553-9688-0dbfbc4fd095")}catch(e){}}();
(()=>{var fF=Object.create;var t_=Object.defineProperty;var gF=Object.getOwnPropertyDescriptor;var SF=Object.getOwnPropertyNames;var AF=Object.getPrototypeOf,TF=Object.prototype.hasOwnProperty;var wi=(t,e)=>()=>(t&&(e=t(t=0)),e);var pg=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ka=(t,e)=>{for(var r in e)t_(t,r,{get:e[r],enumerable:!0})},rE=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of SF(e))!TF.call(t,o)&&o!==r&&t_(t,o,{get:()=>e[o],enumerable:!(n=gF(e,o))||n.enumerable});return t};var hc=(t,e,r)=>(r=t!=null?fF(AF(t)):{},rE(e||!t||!t.__esModule?t_(r,"default",{value:t,enumerable:!0}):r,t)),Ha=t=>rE(t_({},"__esModule",{value:!0}),t);var oE={};ka(oE,{ByteBuffer:()=>Jn});var _g,nE,Jn,Md=wi(()=>{_g=new Int32Array(1),nE=new Float32Array(_g.buffer),Jn=class t{constructor(e){if(e&&!(e instanceof Uint8Array))throw new Error("Must initialize a ByteBuffer with a Uint8Array");this._data=e||new Uint8Array(256),this._index=0,this._start=0,this.length=e?e.length:0}extendWindowTo(e){this._index=e._index}getNewWindowFromRight(){let e=new t(this._data);return e._index=this._index,e._start=this._index,e}windowToUint8Array(){return this._data.subarray(this._start,this._index)}toUint8Array(){return this._data.subarray(0,this.length)}readByte(){if(this._index+1>this._data.length)throw new Error("Index out of bounds");return this._data[this._index++]}readByteArray(){let e=this.readVarUint(),r=this._index,n=r+e;if(n>this._data.length)throw new Error("Read array out of bounds");this._index=n;let o=new Uint8Array(e);return o.set(this._data.subarray(r,n)),o}readVarFloat(){let e=this._index,r=this._data,n=r.length;if(e+1>n)throw new Error("Index out of bounds");let o=r[e];if(o===0)return this._index=e+1,0;if(e+4>n)throw new Error("Index out of bounds");let i=o|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24;return this._index=e+4,i=i<<23|i>>>9,_g[0]=i,nE[0]}readVarUint(){let e=0,r=0;do{var n=this.readByte();e|=(n&127)<<r,r+=7}while(n&128&&r<35);return e>>>0}readVarInt(){let e=this.readVarUint()|0;return e&1?~(e>>>1):e>>>1}readVarUint64Bin(){let e=0,r="";do{var n=this.readByte();if(e<8){let o=((n&127)>>>0).toString(2);r=(n&128?o.padStart(7,"0"):o)+r}else{r=n.toString(2)+r;break}e+=1}while(n&128);return r}readVarUint64(){return this.convertBase(this.readVarUint64Bin(),2,10)}readVarInt64(){let e=this.readVarUint64Bin();if(e.slice(-1)=="1"){let r=this.parseToDigitsArray(e.slice(0,-1),2);return r=this.add(r,[1],2),"-"+this.convertBase(this.parseFromDigitsArray(r,2),2,10)}else return this.convertBase(e.slice(0,-1),2,10)}readString(){let e="";for(;;){let r,n=this.readByte();if(n<192)r=n;else{let o=this.readByte();if(n<224)r=(n&31)<<6|o&63;else{let i=this.readByte();if(n<240)r=(n&15)<<12|(o&63)<<6|i&63;else{let a=this.readByte();r=(n&7)<<18|(o&63)<<12|(i&63)<<6|a&63}}}if(r===0)break;r<65536?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode((r>>10)+55296,(r&1023)+56320))}return e}_growBy(e){if(this.length+e>this._data.length){let r=new Uint8Array(this.length+e<<1);r.set(this._data),this._data=r}this.length+=e}writeByte(e){let r=this.length;this._growBy(1),this._data[r]=e}overwriteByte(e){this._data[this._index]=e,this._index+=1}writeByteArray(e){this.writeVarUint(e.length);let r=this.length;this._growBy(e.length),this._data.set(e,r)}writeVarFloat(e){let r=this.length;nE[0]=e;let n=_g[0];if(n=n>>>23|n<<9,(n&255)===0){this.writeByte(0);return}this._growBy(4);let o=this._data;o[r]=n,o[r+1]=n>>8,o[r+2]=n>>16,o[r+3]=n>>24}writeVarUint(e){do{let r=e&127;e>>>=7,this.writeByte(e?r|128:r)}while(e)}writeVarInt(e){this.writeVarUint(e<<1^e>>31)}writeVarUint64Helper(e){if(e){var r=0;do{if(r<8){var n=parseInt(e.slice(-7),2);e=e.slice(0,-7)}else{var n=parseInt(e.slice(-8),2);e=e.slice(0,-8),this.writeByte(n);break}this.writeByte(e?n|128:n),r+=1}while(e)}}writeVarUint64(e){e=this.cleanNumericString(e);let r=this.convertBase(e,10,2);this.writeVarUint64Helper(r)}subtractOne(e){let r=1,n=e.split("").map(Number);for(let o=n.length-1;o>=0;o--)if(n[o]<r)n[o]=1;else{n[o]--,r=0;break}return n.join("").replace(/^0+/,"")}cleanNumericString(e){let r="";for(let n=0;n<e.length;n++){let o=e.charAt(n);(o>="0"&&o<="9"||n===0&&o==="-")&&(r+=o)}return r}writeVarInt64(e){if(e=this.cleanNumericString(e),e!=""){if(e[0]!="-")var r=this.convertBase(e,10,2)+"0";else{var r=this.convertBase(e.slice(1),10,2);if(r=="0"||r==""){this.writeVarUint64("0");return}r=this.subtractOne(r)+"1"}this.writeVarUint64Helper(r)}}add(e,r,n){let o=[],i=Math.max(e.length,r.length),a=0,s=0;for(;s<i||a;){let l=s<e.length?e[s]:0,c=s<r.length?r[s]:0,d=a+l+c;o.push(d%n),a=Math.floor(d/n),s++}return o}multiplyByNumber(e,r,n){if(e<0)return[];if(e===0)return[];let o=[],i=r;for(;e&1&&(o=this.add(o,i,n)),e=e>>1,e!==0;)i=this.add(i,i,n);return o}parseToDigitsArray(e,r){let n=e.toString().split(""),o=[];for(let i=n.length-1;i>=0;i--){let a=parseInt(n[i],r);if(isNaN(a))return[];o.push(a)}return o}parseFromDigitsArray(e,r){let n="";for(let o=e.length-1;o>=0;o--)n+=e[o].toString(r);return n}convertBase(e,r,n){let o=this.parseToDigitsArray(e,r);if(o===null)return"";let i=[0],a=[1];for(let s=0;s<o.length;s++)o[s]&&(i=this.add(i,this.multiplyByNumber(o[s],a,n),n)),a=this.multiplyByNumber(r,a,n);return this.parseFromDigitsArray(i,n)}writeString(e){let r;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);if(n+1===e.length||o<55296||o>=56320)r=o;else{let i=e.charCodeAt(++n);r=(o<<10)+i+-56613888}if(r===0)throw new Error("Cannot encode a string containing the null character");r<128?this.writeByte(r):(r<2048?this.writeByte(r>>6&31|192):(r<65536?this.writeByte(r>>12&15|224):(this.writeByte(r>>18&7|240),this.writeByte(r>>12&63|128)),this.writeByte(r>>6&63|128)),this.writeByte(r&63|128))}this.writeByte(0)}redactString(e){let r=this._index,n=this.readString(),o=this._index,i=n.length>=2&&n[0]==='"'&&n[n.length-1]==='"',a=i?n.substring(1,n.length-1):n;if(e.test(a.toLowerCase()))return;let s="*".repeat(o-r-1),l=d=>d<=127;if(i)s=`"${s.substring(1,s.length-1)}"`;else if(s.length>=2){let d=n.charAt(0),u=n.charAt(n.length-1);l(d.charCodeAt(0))&&l(u.charCodeAt(0))&&(s=`${d}${s.substring(1,s.length-1)}${u}`)}this._index=r;let c;for(let d=0;d<s.length;d++){let u=s.charCodeAt(d);if(d+1===s.length||u<55296||u>=56320)c=u;else{let p=s.charCodeAt(++d);c=(u<<10)+p+-56613888}if(c===0)throw new Error("Cannot encode a string containing the null character");c<128?this.overwriteByte(c):(c<2048?this.overwriteByte(c>>6&31|192):(c<65536?this.overwriteByte(c>>12&15|224):(this.overwriteByte(c>>18&7|240),this.overwriteByte(c>>12&63|128)),this.overwriteByte(c>>6&63|128)),this.overwriteByte(c&63|128))}this.overwriteByte(0),this._index=o}}});var hg,dl,mg=wi(()=>{hg=class{constructor(){this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer),this._value=0}reset(){this._value=0}value(){return this._value}hashStr(e){for(var r=0;r<e.length;++r)this.hashI(e.codePointAt(r)||0)}hashBool(e){this.hashI(e?1:0)}hashBytes(e){for(var r=0;r<e.length;++r)this.hashI(e[r])}hashF(e){this._float[0]=e,this._value=this._combine(this._value,this._int[0])}hashI(e){this._value=this._combine(this._value,e)}_combine(e,r){return r+2654435769+(e<<6)+(e>>2)}},dl=class{constructor(e){this._helper=new hg,this._bb=e}bb(){return this._bb}windowToUint8Array(){return this._bb.windowToUint8Array()}value(){return this._helper.value()}readByte(){let e=this._bb.readByte();return this._helper.hashI(e),e}readByteArray(){let e=this._bb.readByteArray();return this._helper.hashBytes(e),e}readVarFloat(){let e=this._bb.readVarFloat();return this._helper.hashF(e),e}readVarUint(){let e=this._bb.readVarUint();return this._helper.hashI(e),e}readVarInt(){let e=this._bb.readVarInt();return this._helper.hashI(e),e}readVarUint64(){let e=this._bb.readVarUint64();return this._helper.hashStr(e),e}readVarInt64(){let e=this._bb.readVarInt64();return this._helper.hashStr(e),e}readString(){let e=this._bb.readString();return this._helper.hashStr(e),e}}});var Es,fg=wi(()=>{Es=class{constructor(e,r){this._buckets=new Map,this._hash=e,this._equals=r}get(e,r){let n=this._hash(e),o=this._buckets.get(n);if(o!==void 0)for(let i=0;i<o.length;++i){let a=o[i];if(this._equals(e,a.key))return a.value}return r}set(e,r){let n=this._hash(e),o=this._buckets.get(n);o===void 0&&(o=[],this._buckets.set(n,o));for(let i=0;i<o.length;++i){let a=o[i];if(this._equals(e,a.key))return a.value=r,r}return o.push({key:e,value:r}),r}remove(e){let r=this._hash(e),n=this._buckets.get(r);if(n!==void 0){for(let o=0;o<n.length;++o)if(this._equals(e,n[o].key)){n.splice(o,1),n.length===0&&this._buckets.delete(r);break}}}}});function st(t){return JSON.stringify(t)}function Dr(t,e,r){var n=new Error(t);throw n.line=e,n.column=r,n}var Bd=wi(()=>{});var lE={};ka(lE,{nativeTypes:()=>aE,parseSchema:()=>Gd,reservedNames:()=>sE});function xF(t){let e=t.split(EF),r=[],n=0,o=0;for(let[i,a]of e.entries()){i&1?IF.test(a)||r.push({text:a,line:o+1,column:n+1}):a!==""&&Dr("Syntax error "+st(a),o+1,n+1);let s=a.split(`
`);s.length>1&&(n=0),o+=s.length-1,n+=s[s.length-1].length}return r.push({text:"",line:o,column:n}),r}function LF(t){function e(){return t[s]}function r(l){return l.test(e().text)?(s++,!0):!1}function n(l,c){if(!r(l)){let d=e();Dr("Expected "+c+" but found "+st(d.text),d.line,d.column)}}function o(){let l=e();Dr("Unexpected token "+st(l.text),l.line,l.column)}let i=[],a=null,s=0;for(r(DF)&&(a=e().text,n(r_,"identifier"),n(iE,'";"'));s<t.length&&!r(yF);){let l=[],c;r(NF)?c="ENUM":r(PF)?c="STRUCT":r(FF)?c="MESSAGE":o();let d=e();for(n(r_,"identifier"),n(CF,'"{"');!r(OF);){let u=null,p=!1,_=!1;c!=="ENUM"&&(u=e().text,n(r_,"identifier"),p=r(bF));let h=e();n(r_,"identifier");let A=null;c!=="STRUCT"&&(n(RF,'"="'),A=e(),n(vF,"integer"),(+A.text|0)+""!==A.text&&Dr("Invalid integer "+st(A.text),A.line,A.column));let m=e();r(wF)&&(c!=="MESSAGE"&&Dr("Cannot deprecate this field",m.line,m.column),_=!0),n(iE,'";"'),l.push({name:h.text,line:h.line,column:h.column,type:u,isArray:p,isDeprecated:_,value:A!==null?+A.text|0:l.length+1})}i.push({name:d.text,line:d.line,column:d.column,kind:c,fields:l})}return{package:a,definitions:i}}function MF(t){let e=aE.slice(),r={};for(let i of t.definitions)e.indexOf(i.name)!==-1&&Dr("The type "+st(i.name)+" is defined twice",i.line,i.column),sE.indexOf(i.name)!==-1&&Dr("The type name "+st(i.name)+" is reserved",i.line,i.column),e.push(i.name),r[i.name]=i;for(let i of t.definitions){let a=i.fields;if(i.kind==="ENUM"||a.length===0)continue;for(let l of a)e.indexOf(l.type)===-1&&Dr("The type "+st(l.type)+" is not defined for field "+st(l.name),l.line,l.column);let s=[];for(let l of a)s.indexOf(l.value)!==-1&&Dr("The id for field "+st(l.name)+" is used twice",l.line,l.column),l.value<=0&&Dr("The id for field "+st(l.name)+" must be positive",l.line,l.column),l.value>a.length&&Dr("The id for field "+st(l.name)+" cannot be larger than "+a.length,l.line,l.column),s.push(l.value)}let n={},o=i=>{let a=r[i];if(a&&a.kind==="STRUCT"&&(n[i]===1&&Dr("Recursive nesting of "+st(i)+" is not allowed",a.line,a.column),n[i]!==2&&a)){n[i]=1;for(let s of a.fields)s.isArray||o(s.type);n[i]=2}return!0};for(let i of t.definitions)o(i.name)}function Gd(t){let e=LF(xF(t));return MF(e),e}var aE,sE,EF,r_,IF,RF,yF,iE,vF,CF,OF,bF,NF,PF,FF,DF,wF,n_=wi(()=>{Bd();aE=["bool","byte","float","int","string","uint","int64","uint64"],sE=["ByteBuffer","package"],EF=/((?:-|\b)\d+\b|[=;{}]|\[\]|\[deprecated\]|\b[A-Za-z_][A-Za-z0-9_]*\b|\/\/.*|\s+)/g,r_=/^[A-Za-z_][A-Za-z0-9_]*$/,IF=/^\/\/.*|\s+$/,RF=/^=$/,yF=/^$/,iE=/^;$/,vF=/^-?\d+$/,CF=/^\{$/,OF=/^\}$/,bF=/^\[\]$/,NF=/^enum$/,PF=/^struct$/,FF=/^message$/,DF=/^package$/,wF=/^\[deprecated\]$/});var cE={};ka(cE,{decodeBinarySchema:()=>Ud,encodeBinarySchema:()=>BF});function Ud(t){let e=t instanceof Jn?t:new Jn(t),r=e.readVarUint(),n=[];for(let o=0;o<r;o++){let i=e.readString(),a=e.readByte(),s=e.readVarUint(),l=[];for(let c=0;c<s;c++){let d=e.readString(),u=e.readVarInt(),p=!!(e.readByte()&1),_=e.readVarUint();l.push({name:d,line:0,column:0,type:Sg[a]==="ENUM"?null:u,isArray:p,isDeprecated:!1,value:_})}n.push({name:i,line:0,column:0,kind:Sg[a],fields:l})}for(let o=0;o<r;o++)for(let i of n[o].fields){let a=i.type;if(a!==null&&a<0){if(~a>=gg.length)throw new Error("Invalid type "+a);i.type=gg[~a]}else{if(a!==null&&a>=n.length)throw new Error("Invalid type "+a);i.type=a===null?null:n[a].name}}return{package:null,definitions:n}}function BF(t){let e=new Jn,r=t.definitions,n={};e.writeVarUint(r.length);for(let o=0;o<r.length;o++)n[r[o].name]=o;for(let o of r){e.writeString(o.name),e.writeByte(Sg.indexOf(o.kind)),e.writeVarUint(o.fields.length);for(let i of o.fields){let a=gg.indexOf(i.type);e.writeString(i.name),e.writeVarInt(a===-1?n[i.type]:~a),e.writeByte(i.isArray?1:0),e.writeVarUint(i.value)}}return e.toUint8Array()}var gg,Sg,o_=wi(()=>{Md();gg=["bool","byte","int","uint","float","string","int64","uint64"],Sg=["ENUM","STRUCT","MESSAGE"]});var uE={};ka(uE,{compileSchema:()=>Ag,compileSchemaJS:()=>dE});function GF(t,e,r){let n=[],o="  ";n.push("function(bb) {"),n.push("  if (!(bb instanceof this.ByteBuffer)) {"),n.push("    bb = new this.ByteBuffer(bb);"),n.push("  }"),n.push(""),t.kind==="MESSAGE"&&(n.push("  while (true) {"),n.push("  var x = bb.readVarUint();"),n.push("    switch (x) {"),n.push("    case 0:"),n.push("      return;"),n.push(""),o="      ");for(let i of t.fields){let a;switch(i.type){case"bool":{a="!!bb.readByte()";break}case"byte":{a="bb.readByte()";break}case"int":{a="bb.readVarInt()";break}case"uint":{a="bb.readVarUint()";break}case"int64":{a="bb.readVarInt64()";break}case"uint64":{a="bb.readVarUint64()";break}case"float":{a="bb.readVarFloat()";break}case"string":{r.has(i.name)?a="bb.redactString(this.shouldIgnoreForRedaction)":a="bb.readString()";break}default:{let s=e[i.type];s?s.kind==="ENUM"?a=`this[${st(s.name)}][bb.readVarUint()]`:a=`this[${st("redact"+s.name)}](bb)`:Dr(`Invalid type ${st(i.type)} for field ${st(i.name)}`,i.line,i.column)}}t.kind==="MESSAGE"&&n.push(`    case ${i.value}:`),i.isArray?i.isDeprecated?i.type==="byte"?n.push(o+"bb.readByteArray();"):(n.push(o+"var length = bb.readVarUint();"),n.push(o+`while (length-- > 0) ${a};`)):i.type==="byte"?n.push(o+"bb.readByteArray();"):(n.push(o+"var values = null;"),n.push(o+"if (values === null) {"),n.push(o+"  var length = bb.readVarUint();"),n.push(o+"  var values = Array(length);"),n.push(o+`  for (var i = 0; i < length; i++) values[i] = ${a};`),n.push(o+"}")):i.isDeprecated?n.push(o+`${a};`):n.push(o+`${a};`),t.kind==="MESSAGE"&&(n.push("      break;"),n.push(""))}return t.kind==="MESSAGE"&&(n.push("    default:"),n.push('      throw new Error("Attempted to parse invalid message");'),n.push("    }"),n.push("  }")),n.push("}"),n.join(`
`)}function UF(t,e,r,n){let o=[],i="  ";o.push("function(bb, optDedupCache) {"),o.push("  var dedupKey = null;"),r.includes(t.name)&&(o.push("  if (!!optDedupCache) {"),o.push("    if (!(optDedupCache instanceof this.HashTable)) {"),o.push('      throw new Error("optDedupCache must be instance of HashTable");'),o.push("    }"),o.push("    // lookahead with hasher then reference result with dedup cache"),o.push("    var hasher = new this.Hasher(bb.getNewWindowFromRight());"),o.push(`    this[${st("hash"+t.name)}](hasher);`),o.push(`    dedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${st(t.name)} };`),o.push("    var cachedResult = optDedupCache.get(dedupKey, null);"),o.push("    if (cachedResult !== null) {"),o.push("      bb.extendWindowTo(hasher.bb());"),o.push("      return cachedResult;"),o.push("    }"),o.push("  }")),o.push("  var result = {};"),o.push("  if (!(bb instanceof this.ByteBuffer)) {"),o.push("    bb = new this.ByteBuffer(bb);"),o.push("  }"),o.push(""),t.kind==="MESSAGE"&&(o.push("  while (true) {"),o.push("  var x = bb.readVarUint();"),o.push("    switch (x) {"),o.push("    case 0:"),o.push("      return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),o.push(""),i="      ");for(let a of t.fields){let s,l;switch(a.type){case"bool":{s="!!bb.readByte()",l="!!hasher.readByte()";break}case"byte":{s="bb.readByte()",l="hasher.readByte()";break}case"int":{s="bb.readVarInt()",l="hasher.readVarInt()";break}case"uint":{s="bb.readVarUint()",l="hasher.readVarUint()";break}case"int64":{s="bb.readVarInt64()",l="hasher.readVarInt64()";break}case"uint64":{s="bb.readVarUint64()",l="hasher.readVarUint64()";break}case"float":{s="bb.readVarFloat()",l="hasher.readVarFloat()";break}case"string":{s="bb.readString()",l="hasher.readString()";break}default:{let c=e[a.type];c?c.kind==="ENUM"?(s=`this[${st(c.name)}][bb.readVarUint()]`,l=`this[${st(c.name)}][hasher.readVarUint()]`):(s=`this[${st("decode"+c.name)}](bb, optDedupCache || null)`,l=`this[${st("hash"+c.name)}](hasher)`):Dr(`Invalid type ${st(a.type)} for field ${st(a.name)}`,a.line,a.column)}}t.kind==="MESSAGE"&&o.push(`    case ${a.value}:`),a.isArray?a.isDeprecated?a.type==="byte"?o.push(i+"bb.readByteArray();"):(o.push(i+"var length = bb.readVarUint();"),o.push(i+`while (length-- > 0) ${s};`)):a.type==="byte"?o.push(i+`result[${st(a.name)}] = bb.readByteArray();`):(o.push(i+"var arrayDedupKey = null;"),o.push(i+"var values = null;"),n.includes(a.type)&&(o.push(i+"if (!!optDedupCache) {"),o.push(i+"  // lookahead with hasher then reference result with dedup cache"),o.push(i+"  var hasher = new this.Hasher(bb.getNewWindowFromRight());"),o.push(i+"  var length = hasher.readVarUint();"),o.push(i+`  for (var i = 0; i < length; i++) ${l};`),o.push(i+`  arrayDedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${st(a.type+"[]")} };`),o.push(i+"  var cachedResult = optDedupCache.get(arrayDedupKey, null);"),o.push(i+"  if (cachedResult !== null) {"),o.push(i+"    bb.extendWindowTo(hasher.bb());"),o.push(i+"    values = cachedResult;"),o.push(i+"  }"),o.push(i+"}")),o.push(i+"if (values === null) {"),o.push(i+"  var length = bb.readVarUint();"),o.push(i+"  var values = Array(length);"),o.push(i+`  for (var i = 0; i < length; i++) values[i] = ${s};`),o.push(i+"  if (arrayDedupKey !== null) { optDedupCache.set(arrayDedupKey, values); }"),o.push(i+"}"),o.push(i+`result[${st(a.name)}] = values;`)):a.isDeprecated?o.push(i+`${s};`):o.push(i+`result[${st(a.name)}] = ${s};`),t.kind==="MESSAGE"&&(o.push("      break;"),o.push(""))}return t.kind==="MESSAGE"?(o.push("    default:"),o.push('      throw new Error("Attempted to parse invalid message");'),o.push("    }"),o.push("  }")):o.push("  return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),o.push("}"),o.join(`
`)}function VF(t,e){let r=[],n="  ";r.push("function(hasher) {"),r.push("  var result = {};"),r.push("  if (!(hasher instanceof this.Hasher)) {"),r.push('    throw new Error("Expected Hasher");'),r.push("  }"),r.push(""),t.kind==="MESSAGE"&&(r.push("  while (true) {"),r.push("    switch (hasher.readVarUint()) {"),r.push("    case 0:"),r.push("      return;"),r.push(""),n="      ");for(let o of t.fields){let i;switch(o.type){case"bool":{i="hasher.readByte()";break}case"byte":{i="hasher.readByte()";break}case"int":{i="hasher.readVarInt()";break}case"uint":{i="hasher.readVarUint()";break}case"int64":{i="hasher.readVarInt64()";break}case"uint64":{i="hasher.readVarUint64()";break}case"float":{i="hasher.readVarFloat()";break}case"string":{i="hasher.readString()";break}default:{let a=e[o.type];a?a.kind==="ENUM"?i="hasher.readVarUint()":i=`this[${st("hash"+a.name)}](hasher)`:Dr(`Invalid type ${st(o.type)} for field ${st(o.name)}`,o.line,o.column)}}t.kind==="MESSAGE"&&r.push(`    case ${o.value}:`),o.isArray?o.type==="byte"?r.push(n+"hasher.readByteArray();"):(r.push(n+"var length = hasher.readVarUint();"),r.push(n+`while (length-- > 0) ${i};`)):r.push(n+`${i};`),t.kind==="MESSAGE"&&(r.push("      break;"),r.push(""))}return t.kind==="MESSAGE"?(r.push("    default:"),r.push('      throw new Error("Attempted to parse invalid message");'),r.push("    }"),r.push("  }")):r.push("  return;"),r.push("}"),r.join(`
`)}function kF(t,e){let r=[];r.push("function(message, bb) {"),r.push("  var isTopLevel = !bb;"),r.push("  if (isTopLevel) bb = new this.ByteBuffer();");for(let n of t.fields){let o;if(!n.isDeprecated){switch(n.type){case"bool":{o="bb.writeByte(value);";break}case"byte":{o="bb.writeByte(value);";break}case"int":{o="bb.writeVarInt(value);";break}case"uint":{o="bb.writeVarUint(value);";break}case"int64":{o="bb.writeVarInt64(value);";break}case"uint64":{o="bb.writeVarUint64(value);";break}case"float":{o="bb.writeVarFloat(value);";break}case"string":{o="bb.writeString(value);";break}default:{let i=e[n.type];if(i)i.kind==="ENUM"?o=`var encoded = this[${st(i.name)}][value]; if (encoded === void 0) throw new Error("Invalid value " + JSON.stringify(value) + ${st(" for enum "+st(i.name))}); bb.writeVarUint(encoded);`:o=`this[${st("encode"+i.name)}](value, bb);`;else throw new Error(`Invalid type ${st(n.type)} for field ${st(n.name)}`)}}r.push(""),r.push(`  var value = message[${st(n.name)}];`),r.push("  if (value != null) {"),t.kind==="MESSAGE"&&r.push(`    bb.writeVarUint(${n.value});`),n.isArray?n.type==="byte"?r.push("    bb.writeByteArray(value);"):(r.push("    var values = value, n = values.length;"),r.push("    bb.writeVarUint(n);"),r.push("    for (var i = 0; i < n; i++) {"),r.push("      value = values[i];"),r.push(`      ${o}`),r.push("    }")):r.push(`    ${o}`),t.kind==="STRUCT"&&(r.push("  } else {"),r.push(`    throw new Error(${st("Missing required field "+st(n.name))});`)),r.push("  }")}}return t.kind==="MESSAGE"&&r.push("  bb.writeVarUint(0);"),r.push(""),r.push("  if (isTopLevel) return bb.toUint8Array();"),r.push("}"),r.join(`
`)}function HF(t){return typeof t=="string"?Gd(t):t instanceof Uint8Array||t instanceof Jn?Ud(t):t}function dE(t,e,r,n){t=HF(t);let o={},i=t.package,a=[];i!==null?a.push(`var ${i} = exports || ${i} || {}, exports;`):(a.push("var exports = exports || {};"),i="exports"),a.push(`${i}.ByteBuffer = ${i}.ByteBuffer || require("kiwi-schema").ByteBuffer;`),a.push(`${i}.shouldIgnoreForRedaction = ${(n==null?void 0:n.shouldIgnoreForRedaction)??/$^/};`);for(let s of t.definitions)o[s.name]=s;for(let s of t.definitions)switch(s.kind){case"ENUM":{let l={};for(let c of s.fields)l[c.name]=c.value,l[c.value]=c.name;a.push(`${i}[${st(s.name)}] = ${JSON.stringify(l,null,2)};`);break}case"STRUCT":case"MESSAGE":{a.push(""),a.push(`${i}[${st("decode"+s.name)}] = ${UF(s,o,e,r)};`),a.push(""),a.push(`${i}[${st("encode"+s.name)}] = ${kF(s,o)};`),a.push(""),a.push(`${i}[${st("hash"+s.name)}] = ${VF(s,o)};`),a.push(""),a.push(`${i}[${st("redact"+s.name)}] = ${GF(s,o,(n==null?void 0:n.sensitiveFields)??new Set)};`);break}default:Dr("Invalid definition kind "+st(s.kind),s.line,s.column)}return a.push(""),a.join(`
`)}function zF(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Ag(t,e,r){let n={ByteBuffer:Jn,Hasher:dl,HashTable:Es,makeDedupCache:()=>new Es(a=>a.hash,(a,s)=>a.defName===s.defName&&zF(a.data,s.data))},o=[],i=[];return e&&(o=e.filter(a=>!!a.match(/^[A-Za-z_][A-Za-z0-9_]*$/)),i=e.filter(a=>!!a.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(a=>a.slice(0,a.length-2)),i.length+o.length!==e.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping...")),new Function("exports",dE(t,o,i,r))(n),n}var Tg=wi(()=>{Md();mg();fg();Bd();n_();o_()});var pE={};ka(pE,{KiwiCodec:()=>i_,createKiwiCodec:()=>KF});function KF(t,e,r,n){return!t&&Eg?Ag(e,r,n):new i_(e,r,n)}var Eg,WF,i_,_E=wi(()=>{Md();mg();fg();Tg();n_();o_();WF=eval;try{Eg=WF("true")}catch{Eg=!1}i_=class{constructor(e,r,n){this._definitions={};this._fieldValueToIndex={};this._enums={};typeof e=="string"?e=Gd(e):(e instanceof Uint8Array||e instanceof Jn)&&(e=Ud(e));for(let o of e.definitions)this._definitions[o.name]=o;this._sensitiveFields=(n==null?void 0:n.sensitiveFields)??new Set,this._shouldIgnoreForRedaction=(n==null?void 0:n.shouldIgnoreForRedaction)??/$^/;for(let o of e.definitions)if(o.kind==="ENUM"){let i={};for(let a of o.fields)i[a.name]=a.value,i[a.value]=a.name;this._enums[o.name]=i,this[o.name]=i}else if(o.kind==="STRUCT"||o.kind==="MESSAGE"){if(this["decode"+o.name]=(i,a)=>this.decodeObject(o,i,a),this["encode"+o.name]=i=>this.encodeObject(o,i),this["redact"+o.name]=i=>this.redactObject(o,i),o.kind==="MESSAGE"){let i={};for(let a=0;a<o.fields.length;a++)i[o.fields[a].value]=a;this._fieldValueToIndex[o.name]=i}}else throw new Error(`Invalid definition kind ${o.kind}`);this._nonArrayDefinitionsToDedup=new Set,this._arrayDefinitionsToDedup=new Set,r&&(this._nonArrayDefinitionsToDedup=new Set(r.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*$/))),this._arrayDefinitionsToDedup=new Set(r.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(o=>o.slice(0,o.length-2))),this._arrayDefinitionsToDedup.size+this._nonArrayDefinitionsToDedup.size!==r.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping..."))}decode(e,r,n){let o=this._definitions[e];if(o===void 0)throw new Error(`Invalid definition ${e}`);return this.decodeObject(o,r,n)}encode(e,r){let n=this._definitions[e];if(n===void 0)throw new Error(`Invalid definition ${e}`);return this.encodeObject(n,r)}decodeSingleField(e,r,n){switch(e.type){case"bool":return!!r.readByte();case"byte":return r.readByte();case"int":return r.readVarInt();case"uint":return r.readVarUint();case"int64":return r.readVarInt64();case"uint64":return r.readVarUint64();case"float":return r.readVarFloat();case"string":return r.readString();default:let o=this._definitions[e.type];if(!o)throw new Error(`Invalid type ${e.type}`);if(o.kind==="ENUM")return this._enums[e.type][r.readVarUint()];if(o.kind==="STRUCT"||o.kind==="MESSAGE")return this.decodeObject(o,r,n);throw new Error(`Invalid definition kind ${o.kind}`)}}encodeSingleField(e,r,n){switch(e.type){case"bool":n.writeByte(r);break;case"byte":n.writeByte(r);break;case"int":n.writeVarInt(r);break;case"uint":n.writeVarUint(r);break;case"int64":n.writeVarInt64(r);break;case"uint64":n.writeVarUint64(r);break;case"float":n.writeVarFloat(r);break;case"string":n.writeString(r);break;default:let o=this._definitions[e.type];if(!o)throw new Error(`Invalid type ${e.type}`);if(o.kind==="ENUM"){let i=this._enums[e.type][r];if(i===void 0)throw new Error("Invalid value "+JSON.stringify(r)+" for enum "+e.type);n.writeVarUint(i)}else if(o.kind==="STRUCT"||o.kind==="MESSAGE")this.encodeObject(o,r,n);else throw new Error(`Invalid definition kind ${o.kind}`);break}}hashSingleField(e,r){switch(e.type){case"bool":r.readByte();break;case"byte":r.readByte();break;case"int":r.readVarInt();break;case"uint":r.readVarUint();break;case"int64":r.readVarInt64();break;case"uint64":r.readVarUint64();break;case"float":r.readVarFloat();break;case"string":r.readString();break;default:let n=this._definitions[e.type];if(!n)throw new Error(`Invalid type ${e.type}`);if(n.kind==="ENUM")r.readVarUint();else if(n.kind==="STRUCT"||n.kind==="MESSAGE")this.hashObject(n,r);else throw new Error(`Invalid definition kind ${n.kind}`);break}}redactSingleField(e,r){switch(e.type){case"bool":r.readByte();break;case"byte":r.readByte();break;case"int":r.readVarInt();break;case"uint":r.readVarUint();break;case"int64":r.readVarInt64();break;case"uint64":r.readVarUint64();break;case"float":r.readVarFloat();break;case"string":this._sensitiveFields.has(e.name)?r.redactString(this._shouldIgnoreForRedaction):r.readString();break;default:let n=this._definitions[e.type];if(!n)throw new Error(`Invalid type ${e.type}`);if(n.kind==="ENUM")r.readVarUint();else if(n.kind==="STRUCT"||n.kind==="MESSAGE")this.redactObject(n,r);else throw new Error(`Invalid definition kind ${n.kind}`);break}}decodeArrayField(e,r,n){if(e.type==="byte")return r.readByteArray();let o=null,i=null;if(n&&this._arrayDefinitionsToDedup.has(e.type)){let a=new dl(r.getNewWindowFromRight()),s=a.readVarUint();for(let c=0;c<s;c++)this.hashSingleField(e,a);o={hash:a.value(),data:a.windowToUint8Array(),defName:e.type+"[]"};let l=n.get(o,null);l!==null&&(r.extendWindowTo(a.bb()),i=l)}if(i===null){let a=r.readVarUint();i=Array(a);for(let s=0;s<a;s++)i[s]=this.decodeSingleField(e,r,n);o!==null&&n.set(o,i)}return i}decodeObject(e,r,n){r instanceof Jn||(r=new Jn(r));let o=null;if(n&&this._nonArrayDefinitionsToDedup.has(e.name)){if(!(n instanceof Es))throw new Error("optDedupCache must be instance of HashTable");let a=new dl(r.getNewWindowFromRight());this.hashObject(e,a),o={hash:a.value(),data:a.windowToUint8Array(),defName:e.name};let s=n.get(o,null);if(s!==null)return r.extendWindowTo(a.bb()),s}let i={};if(e.kind==="MESSAGE")for(;;){let a=r.readVarUint();if(a===0)break;let s=this._fieldValueToIndex[e.name][a];if(s===void 0)throw new Error("Attempted to parse invalid message");let l=e.fields[s],c=l.isDeprecated?null:n,d=l.isArray?this.decodeArrayField(l,r,c):this.decodeSingleField(l,r,c);l.isDeprecated||(i[l.name]=d)}else for(let a of e.fields){let s=a.isDeprecated?null:n,l=a.isArray?this.decodeArrayField(a,r,s):this.decodeSingleField(a,r,s);a.isDeprecated||(i[a.name]=l)}return o!==null&&n.set(o,i),i}hashObject(e,r){if(e.kind==="MESSAGE")for(;;){let n=r.readVarUint();if(n===0)break;let o=this._fieldValueToIndex[e.name][n];if(o===void 0)throw new Error("Attempted to parse invalid message");let i=e.fields[o];if(i.isArray)if(i.type==="byte")r.readByteArray();else{let a=r.readVarUint();for(let s=0;s<a;s++)this.hashSingleField(i,r)}else this.hashSingleField(i,r)}else for(let n of e.fields)if(n.isArray)if(n.type==="byte")r.readByteArray();else{let o=r.readVarUint();for(let i=0;i<o;i++)this.hashSingleField(n,r)}else this.hashSingleField(n,r)}encodeObject(e,r,n){let o=!n;n||(n=new Jn);for(let i of e.fields){if(i.isDeprecated)continue;let a=r[i.name];if(a!=null)if(e.kind==="MESSAGE"&&n.writeVarUint(i.value),i.isArray)if(i.type==="byte")n.writeByteArray(a);else{n.writeVarUint(a.length);for(let s=0;s<a.length;s++)this.encodeSingleField(i,a[s],n)}else this.encodeSingleField(i,a,n);else if(e.kind==="STRUCT")throw new Error("Missing required field "+i.name)}if(e.kind==="MESSAGE"&&n.writeVarUint(0),o)return n.toUint8Array()}redactObject(e,r){if(r instanceof Jn||(r=new Jn(r)),e.kind==="MESSAGE")for(;;){let n=r.readVarUint();if(n===0)break;let o=this._fieldValueToIndex[e.name][n];if(o===void 0)throw new Error("Attempted to parse invalid message");let i=e.fields[o];if(i.isArray)if(i.type==="byte")r.readByteArray();else{let a=r.readVarUint();for(let s=0;s<a;s++)this.redactSingleField(i,r)}else this.redactSingleField(i,r)}else for(let n of e.fields)if(n.isArray)if(n.type==="byte")r.readByteArray();else{let o=r.readVarUint();for(let i=0;i<o;i++)this.redactSingleField(n,r)}else this.redactSingleField(n,r)}makeDedupCache(){let e=(r,n)=>{if(r.length!==n.length)return!1;for(let o=0;o<r.length;o++)if(r[o]!==n[o])return!1;return!0};return new Es(r=>r.hash,(r,n)=>r.defName===n.defName&&e(r.data,n.data))}}});var SE={};ka(SE,{compileSchemaCallbackCPP:()=>QF});function YF(t,e,r){switch(e){case"bool":return{type:"bool ",name:r};case"byte":return{type:"uint8_t ",name:r};case"int":return{type:"int32_t ",name:r};case"uint":return{type:"uint32_t ",name:r};case"int64":return{type:"int64_t ",name:r};case"uint64":return{type:"uint64_t ",name:r};case"float":return{type:"float ",name:r};case"string":return{type:"const char *",name:r};default:{let n=t[e];return n.kind==="ENUM"?{type:n.name+" ",name:r}:null}}}function ul(t,e,r,n){let o=[];for(let i of r){let a=e+i.name;if(i.isArray&&!n)return null;let s=YF(t,i.type,a);if(s!==null){o.push(s);continue}let l=t[i.type];if(l.kind!=="STRUCT")return null;let c=ul(t,a+"_",l.fields,!1);if(c===null)return null;o.push.apply(o,c)}return o}function mc(t){return t.type+t.name}function fE(t){return t.name}function gE(t){switch(t.type){case"bool ":return`!bb.readBool(${t.name})`;case"uint8_t ":return`!bb.readByte(${t.name})`;case"int32_t ":return`!bb.readVarInt(${t.name})`;case"uint32_t ":return`!bb.readVarUint(${t.name})`;case"int64_t ":return`!bb.readVarInt64(${t.name})`;case"uint64_t ":return`!bb.readVarUint64(${t.name})`;case"float ":return`!bb.readVarFloat(${t.name})`;case"const char *":return`!bb.readString(${t.name})`;default:return`!bb.readVarUint(reinterpret_cast<uint32_t &>(${t.name}))`}}function hE(t){switch(t.type){case"bool ":return`_wb.writeBool(${t.name})`;case"uint8_t ":return`_wb.writeByte(${t.name})`;case"int32_t ":return`_wb.writeVarInt(${t.name})`;case"uint32_t ":return`_wb.writeVarUint(${t.name})`;case"int64_t ":return`_wb.writeVarInt64(${t.name})`;case"uint64_t ":return`_wb.writeVarUint64(${t.name})`;case"float ":return`_wb.writeVarFloat(${t.name})`;case"const char *":return`_wb.writeString(${t.name})`;default:return`_wb.writeVarUint(static_cast<uint32_t>(${t.name}))`}}function mE(t,e,r,n,o){let i=n.name;if(n.isArray){let s=`_${i}_count`;t.push(o+`uint32_t ${s};`),t.push(o+`if (!bb.readVarUint(${s})) return false;`),n.isDeprecated||t.push(o+`visitor.visit${r.name}_${n.name}_count(${s});`),t.push(o+`while (${s}-- > 0) {`),o+="  ",i+="_element"}let a=ul(e,"",[n],!0);if(a!==null){for(let s of a)t.push(o+`${mc(s)};`);t.push(o+`if (${a.map(gE).join(" || ")}) return false;`),n.isDeprecated||t.push(o+`visitor.visit${r.name}_${i}(${a.map(fE).join(", ")});`)}else{n.isDeprecated||t.push(o+`visitor.visit${r.name}_${i}();`);let s=e[n.type];t.push(o+`if (!parse${s.name}(bb, visitor)) return false;`)}n.isArray&&t.push(o.slice(2)+"}")}function QF(t,e={}){let r={},n=[],o=e.includePrefix||"";for(let i of t.definitions)r[i.name]=i;t.package!==null&&(n.push(`#ifndef INCLUDE_${t.package.toUpperCase()}_H`),n.push(`#define INCLUDE_${t.package.toUpperCase()}_H`),n.push("")),n.push(`#include "${o}kiwi.h"`),n.push(""),t.package!==null&&(n.push(`namespace ${t.package} {`),n.push(""));for(let i of t.definitions)if(i.kind==="ENUM"){n.push(`enum class ${i.name} : uint32_t {`);for(let a of i.fields)a.isDeprecated||n.push(`  ${a.name} = ${a.value},`);n.push("};"),n.push("")}for(let i=0;i<2;i++){let a=") = 0;";i===0?(n.push("class Visitor {"),n.push("public:")):(n.push("class Writer : public Visitor {"),n.push("private:"),n.push("  kiwi::WriteBuffer &_wb;"),n.push("public:"),n.push("  Writer(kiwi::WriteBuffer &wb) : _wb(wb) {}"),a=") override;");for(let s of t.definitions){if(s.kind==="STRUCT"){let l=ul(r,"",s.fields,!1);if(l!==null){n.push(`  virtual void visit${s.name}(${l.map(mc).join(", ")}${a}`);continue}}if(s.kind==="STRUCT"||s.kind==="MESSAGE"){n.push(`  virtual void begin${s.name}(${a}`);for(let l of s.fields){if(l.isDeprecated)continue;let c=l.name;l.isArray&&(n.push(`  virtual void visit${s.name}_${l.name}_count(uint32_t size${a}`),c+="_element");let d=ul(r,"",[l],!0);d!==null?n.push(`  virtual void visit${s.name}_${c}(${d.map(mc).join(", ")}${a}`):n.push(`  virtual void visit${s.name}_${c}(${a}`)}n.push(`  virtual void end${s.name}(${a}`)}}n.push("};"),n.push("")}for(let i of t.definitions)(i.kind==="STRUCT"||i.kind==="MESSAGE")&&n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor);`);n.push(""),n.push("#ifdef IMPLEMENT_SCHEMA_H"),n.push("");for(let i of t.definitions)if(i.kind==="STRUCT"){let a=ul(r,"",i.fields,!1);if(a!==null){n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`);for(let s of a)n.push(`  ${mc(s)};`);n.push(`  if (${a.map(gE).join(" || ")}) return false;`),n.push(`  visitor.visit${i.name}(${a.map(fE).join(", ")});`),n.push("  return true;"),n.push("}"),n.push("")}else{n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),n.push(`  visitor.begin${i.name}();`);for(let s of i.fields)mE(n,r,i,s,"  ");n.push(`  visitor.end${i.name}();`),n.push("  return true;"),n.push("}"),n.push("")}}else if(i.kind==="MESSAGE"){n.push(`bool parse${i.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),n.push(`  visitor.begin${i.name}();`),n.push("  while (true) {"),n.push("    uint32_t _type;"),n.push("    if (!bb.readVarUint(_type)) return false;"),n.push("    switch (_type) {"),n.push("      case 0: {"),n.push(`        visitor.end${i.name}();`),n.push("        return true;"),n.push("      }");for(let a of i.fields)n.push(`      case ${a.value}: {`),mE(n,r,i,a,"        "),n.push("        break;"),n.push("      }");n.push("      default: return false;"),n.push("    }"),n.push("  }"),n.push("}"),n.push("")}for(let i of t.definitions){if(i.kind==="STRUCT"){let a=ul(r,"",i.fields,!1);if(a!==null){n.push(`void Writer::visit${i.name}(${a.map(mc).join(", ")}) {`);for(let s of a)n.push(`  ${hE(s)};`);n.push("}"),n.push("");continue}}if(i.kind==="STRUCT"||i.kind==="MESSAGE"){n.push(`void Writer::begin${i.name}() {`),n.push("}"),n.push("");for(let a of i.fields){if(a.isDeprecated)continue;let s=a.name;a.isArray&&(n.push(`void Writer::visit${i.name}_${a.name}_count(uint32_t size) {`),i.kind==="MESSAGE"&&n.push(`  _wb.writeVarUint(${a.value});`),n.push("  _wb.writeVarUint(size);"),n.push("}"),n.push(""),s+="_element");let l=ul(r,"",[a],!0);if(l!==null){n.push(`void Writer::visit${i.name}_${s}(${l.map(mc).join(", ")}) {`),i.kind==="MESSAGE"&&!a.isArray&&n.push(`  _wb.writeVarUint(${a.value});`);for(let c of l)n.push(`  ${hE(c)};`);n.push("}"),n.push("")}else n.push(`void Writer::visit${i.name}_${s}() {`),i.kind==="MESSAGE"&&!a.isArray&&n.push(`  _wb.writeVarUint(${a.value});`),n.push("}"),n.push("")}n.push(`void Writer::end${i.name}() {`),i.kind==="MESSAGE"&&n.push("  _wb.writeVarUint(0);"),n.push("}"),n.push("")}}return n.push("#endif"),n.push(""),t.package!==null&&(n.push("}"),n.push(""),n.push("#endif"),n.push("")),n.join(`
`)}var AE=wi(()=>{});var bE={};ka(bE,{compileSchemaCPP:()=>sD,compileSchemaEnumsCPP:()=>lD});function qF(t,e,r){return(e.type==="int64"||e.type==="uint64")&&!r?"std::array<std::byte, 8>":jn(t,e,r)}function Vd(t,e){return(e.type==="int64"||e.type==="uint64")&&!e.isArray?`std::bit_cast<std::array<std::byte, 8>>(${t})`:t}function TE(t,e){return e.isArray?t:e.type==="int64"?`std::bit_cast<int64_t>(${t})`:e.type==="uint64"?`std::bit_cast<uint64_t>(${t})`:t}function IE(t,e,r){if(!e.isArray||e.isDeprecated||!e.type)return!1;let n=t[e.type];return n?r.includes(n.name):!1}function jn(t,e,r){let n;switch(e.type){case"bool":n="bool";break;case"byte":n="uint8_t";break;case"int":n="int32_t";break;case"uint":n="uint32_t";break;case"int64":n="int64_t";break;case"uint64":n="uint64_t";break;case"float":n="float";break;case"string":n="kiwi::String";break;default:{let o=t[e.type];o||Dr(`Invalid type ${st(e.type)} for field ${st(e.name)}`,e.line,e.column),n=o.name;break}}return r&&(n=`kiwi::Array<${n}>`),n}function Is(t){return"_data_"+t.name}function Ig(t){return t>>5}function Rg(t){return`(1 << ${t%32})`}function ui(t,e){return!e.isArray&&e.type in t&&t[e.type].kind!=="ENUM"}function RE(t,e,r){switch(e.type){case"bool":return`_wb.writeBool(${r});`;case"byte":return`_wb.writeByte(${r});`;case"int":return`_wb.writeVarInt(${r});`;case"uint":return`_wb.writeVarUint(${r});`;case"int64":return`_wb.writeVarInt64(${r});`;case"uint64":return`_wb.writeVarUint64(${r});`;case"float":return`_wb.writeVarFloat(${r});`;case"string":return`_wb.writeString(${r}.c_str());`;default:{let n=t[e.type];if(!n)Dr(`Invalid type ${st(e.type)} for field ${st(e.name)}`,e.line,e.column);else return n.kind==="ENUM"?`_wb.writeVarUint(static_cast<uint32_t>(${r}));`:`if (!${r}${ui(t,e)?"->":"."}encode(_wb)) return false;`}}}function kd(t,e,r,n){let o=ui(t,e);switch(e.type){case"bool":return`_bb.readBool(${r})`;case"byte":return`_bb.readByte(${r})`;case"int":return`_bb.readVarInt(${r})`;case"uint":return`_bb.readVarUint(${r})`;case"int64":return`_bb.readVarInt64(${r})`;case"uint64":return`_bb.readVarUint64(${r})`;case"float":return`_bb.readVarFloat(${r})`;case"string":return`_bb.readString(${r}, _pool)`;default:{let i=t[e.type];if(!i)Dr(`Invalid type ${st(e.type)} for field ${st(e.name)}`,e.line,e.column);else return i.kind==="ENUM"?`_bb.readVarUint(reinterpret_cast<uint32_t &>(${r}))`:n?`${r+(o?"->":".")}decode(_bb, _pool, _schema, tempDecodingFields)`:`${r+(o?"->":".")}decode(_bb, _pool, _schema)`}}}function yE(t){let e={bool:1,byte:1,int:4,uint:4,float:4};return t.slice().sort(function(r,n){let o=!r.isArray&&e[r.type]||8,i=!n.isArray&&e[n.type]||8;return o!==i?i-o:t.indexOf(r)-t.indexOf(n)})}function XF(t,e,r){let n=t.fields,o=[];o.push(`class ${t.name} {`),o.push("public:"),o.push(`  ${t.name}() { (void)_flags; }`),r||(o.push(`  ${t.name}(const ${t.name}&) = delete;`),o.push(`  ${t.name}& operator=(const ${t.name}&) = delete;`)),o.push(`  ${t.name}(${t.name}&&) = default;`),o.push(`  ${t.name}& operator=(${t.name}&&) = default;`),o.push(""),r&&(o.push(`  ${t.name} copy() const;`),o.push(""));for(let s of n){if(s.isDeprecated)continue;let l=jn(e,s,s.isArray);o.push(`  ${l} *${s.name}();`),o.push(`  const ${l} *${s.name}() const;`),ui(e,s)?o.push(`  void set_${s.name}(${l} *value);`):s.isArray?o.push(`  ${l} &set_${s.name}(kiwi::MemoryPool &pool, uint32_t count);`):o.push(`  void set_${s.name}(const ${l} &value);`),o.push("")}o.push("  bool encode(kiwi::WriteBuffer &wb) const;"),o.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),o.push(""),o.push("private:"),r&&(o.push(`  ${t.name}(const ${t.name}&) = default;`),o.push(`  ${t.name}& operator=(const ${t.name}&) = default;`)),o.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let i=yE(n),a="  ";for(let s of i){if(s.isDeprecated)continue;let l=Is(s),c=jn(e,s,s.isArray);ui(e,s)?o.push(a+`${c} *${l} = {};`):o.push(a+`${c} ${l} = {};`)}return o.push("};"),o.push(""),o}function ZF(t,e,r){let n=t.fields,o=[];o.push(`class ${t.name} {`),o.push("public:"),o.push("  union Field;"),o.push(`  ${t.name}() { (void)_flags; }`),o.push(`  ${t.name}(const ${t.name}&) = delete;`),o.push(`  ${t.name}& operator=(const ${t.name}&) = delete;`),o.push(`  ${t.name}(${t.name}&&) = default;`),o.push(`  ${t.name}& operator=(${t.name}&&) = default;`),o.push(""),r&&(o.push(`  ${t.name} copy(kiwi::MemoryPool& pool) const;`),o.push("")),o.push("  auto fields() const {"),o.push("    return _fields.fields();"),o.push("  }"),o.push("");for(let s of n){if(s.isDeprecated)continue;let l=jn(e,s,s.isArray);ui(e,s)?(o.push(`  ${l} *${s.name}();`),o.push(`  const ${l} *${s.name}() const;`),o.push(`  const ${l} *iterator_${s.name}(const typename kiwi::SparseFields<Field>::FieldIterator& it) const;`)):(o.push(`  kiwi::Optional<${l}> ${s.name}() const;`),o.push(`  ${l} iterator_${s.name}(const typename kiwi::SparseFields<Field>::FieldIterator& it) const;`)),ui(e,s)?o.push(`  void set_${s.name}(kiwi::MemoryPool &pool, ${l} *value);`):s.isArray?o.push(`  ${l} &set_${s.name}(kiwi::MemoryPool &pool, uint32_t count);`):o.push(`  void set_${s.name}(kiwi::MemoryPool &pool, const ${l} &value);`),o.push("")}o.push("  bool encode(kiwi::WriteBuffer &wb) const;"),o.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),o.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema, std::vector<kiwi::SparseFields<Field>::Element> &tempFields);"),o.push(""),o.push("private:"),o.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let i=yE(n);o.push("public:"),o.push("  union Field {"),o.push("  public:"),o.push("    bool operator==(const Field&) const { return false; }");let a="    ";for(let s of i){if(s.isDeprecated)continue;let l=Is(s),c=qF(e,s,s.isArray);ui(e,s)?o.push(a+`${c} *${l};`):o.push(a+`${c} ${l};`)}return o.push("  };"),o.push("private:"),o.push("  kiwi::SparseFields<Field> _fields;"),o.push("  friend std::hash<Field>;"),o.push("};"),o.push(""),o}function JF(t,e){if(t.type){let r=e[t.type];if(r&&r.kind==="ENUM")return!0}return!1}function vE(t,e){switch(t.type){case"bool":case"byte":case"int":case"uint":case"int64":case"uint64":case"float":case"string":return!0}return JF(t,e)}function CE(t,e){return e.type==="string"?"const char*":jn(t,e,!1)}function jF(t,e,r){return e.type==="string"?`bb.readString(${r})`:kd(t,e,r,!1).slice(1)}function $F(t,e){let r=[];r.push(`struct ${t.name}Visitor {`),r.push("  kiwi::ByteBuffer& bb;"),r.push("  BinarySchema& schema;"),r.push(""),r.push(`  ${t.name}Visitor(kiwi::ByteBuffer& _bb, BinarySchema& _schema) : bb(_bb), schema(_schema) {}`),r.push("");for(let n of t.fields)if(!n.isDeprecated)if(n.isArray)r.push("  // If this is overridden, the new implementation must skip over exactly count"),r.push(`  // encoded instances of ${n.type} in bb`),r.push(`  virtual bool visit${t.name}_${n.name}(size_t count) {`),r.push("    for (size_t i=0; i<count; i++) {"),r.push(`      if (!schema.skip${n.type}(bb)) return false;`),r.push("    }"),r.push("    return true;"),r.push("  }");else if(vE(n,e)){let o=CE(e,n);r.push(`  virtual bool visit${t.name}_${n.name}(${o} ${n.name}) { return true; }`)}else r.push(`  // If this is overridden, the new implementation must skip over encoded one ${n.type} in bb`),r.push(`  virtual bool visit${t.name}_${n.name}() {`),r.push(`    return schema.skip${n.type}(bb);`),r.push("  }");return r.push("};"),r.push(""),r.push(`bool parse${t.name}(kiwi::ByteBuffer& bb, ${t.name}Visitor& visitor);`),r.push(""),r}function eD(t,e){let r=[];r.push(`bool parse${t.name}(kiwi::ByteBuffer& bb, ${t.name}Visitor& visitor) {`),r.push("  while (true) {"),r.push("    uint32_t _field;"),r.push("    if (!bb.readVarUint(_field)) return false;"),r.push("    switch (_field) {"),r.push("      case 0: {"),r.push("        return true;"),r.push("      }");for(let n of t.fields)n.isDeprecated||(r.push(`      case ${n.value}: {`),n.isArray?(r.push("        uint32_t count;"),r.push("        if (!bb.readVarUint(count)) return false;"),r.push(`        if (!visitor.visit${t.name}_${n.name}(count)) return false;`),r.push("        break;")):vE(n,e)?(r.push(`        ${CE(e,n)} v;`),r.push(`        if (!${jF(e,n,"v")}) return false;`),r.push(`        if (!visitor.visit${t.name}_${n.name}(v)) return false;`),r.push("        break;")):(r.push(`        if (!visitor.visit${t.name}_${n.name}()) return false;`),r.push("        break;")),r.push("      }"));return r.push("      default:"),r.push(`        if (visitor.schema.skip${t.name}Field(bb, _field)) break;`),r.push("        return false;"),r.push("    }"),r.push("  }"),r.push("}"),r.push(""),r}function tD(t,e,r){let n=t.fields,o=[];r&&(o.push(`inline ${t.name} ${t.name}::copy() const {`),o.push(`  ${t.name} clone = *this;`),o.push("  return clone;"),o.push("}"),o.push(""));for(let[i,a]of n.entries()){let s=Is(a),l=jn(e,a,a.isArray),c=Ig(i),d=Rg(i);if(a.isDeprecated)continue;let u=`_flags[${c}] |= ${d}`,p=`_flags[${c}] & ${d}`;ui(e,a)?(o.push(`inline ${l} *${t.name}::${a.name}() {`),o.push(`  return ${s};`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::${a.name}() const {`),o.push(`  return ${s};`),o.push("}"),o.push(""),o.push(`inline void ${t.name}::set_${a.name}(${l} *value) {`),o.push(`  ${s} = value;`),o.push("}"),o.push("")):a.isArray?(o.push(`inline ${l} *${t.name}::${a.name}() {`),o.push(`  return ${p} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::${a.name}() const {`),o.push(`  return ${p} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline ${l} &${t.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),o.push(`  ${u}; return ${s} = pool.array<${jn(e,a,!1)}>(count);`),o.push("}"),o.push("")):(o.push(`inline ${l} *${t.name}::${a.name}() {`),o.push(`  return ${p} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::${a.name}() const {`),o.push(`  return ${p} ? &${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline void ${t.name}::set_${a.name}(const ${l} &value) {`),o.push(`  ${u}; ${s} = value;`),o.push("}"),o.push(""))}return o}function rD(t,e){let r=t.fields,n=[];n.push(`bool ${t.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let o of r){if(o.isDeprecated)continue;let i="  ";t.kind==="STRUCT"?n.push(`  if (${o.name}() == nullptr) return false;`):(n.push(`  if (${o.name}() != nullptr) {`),i="    ");let a=Is(o),s=o.isArray?"_it":a,l=RE(e,o,s);t.kind==="MESSAGE"&&n.push(i+`_wb.writeVarUint(${o.value});`),o.isArray?(n.push(i+`_wb.writeVarUint(${a}.size());`),n.push(i+`for (const ${jn(e,o,!1)} &_it : ${a}) ${l}`)):n.push(i+l),t.kind!=="STRUCT"&&n.push("  }")}return t.kind==="MESSAGE"&&n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function nD(t,e,r){let n=t.fields,o=[];o.push(`bool ${t.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let i of n)if(i.isArray){o.push("  uint32_t count;");break}t.kind==="MESSAGE"&&(o.push("  while (true) {"),o.push("    uint32_t type;"),o.push("    if (!_bb.readVarUint(type)) return false;"),o.push("    switch (type) {"),o.push("      case 0:"),o.push("        return true;"));for(let i of n){let a=Is(i),s=i.isArray?"_it":a,l=ui(e,i),c=IE(e,i,r),d=jn(e,i,!1),u=kd(e,i,s,c),p="  ";if(t.kind==="MESSAGE"&&(o.push(`      case ${i.value}: {`),p="        "),i.isArray)if(o.push(p+"if (!_bb.readVarUint(count)) return false;"),i.isDeprecated)if(i.type==="byte")o.push(p+"if (!_bb.skipCount(count)) return false;");else{let _=kd(e,i,s,!1);o.push(p+`for (${d} &_it : _pool.array<${d}>(count)) if (!${_}) return false;`)}else if(i.type==="byte")o.push(p+`if (!_bb.readByteArray(set_${i.name}(_pool, count).data(), count)) return false;`);else if(c){o.push(p+"if (shared_temp_field_vec_feature_flag) {"),o.push(p+`  std::vector<kiwi::SparseFields<${d}::Field>::Element> tempDecodingFields;`),o.push(p+`  for (${d} &_it : set_${i.name}(_pool, count)) if (!${u}) return false;`),o.push(p+"} else {");let _=kd(e,i,s,!1);o.push(p+`  for (${d} &_it : set_${i.name}(_pool, count)) if (!${_}) return false;`),o.push(p+"}")}else o.push(p+`for (${d} &_it : set_${i.name}(_pool, count)) if (!${u}) return false;`);else i.isDeprecated?(l?o.push(p+`${d} *${a} = _pool.allocate<${d}>();`):o.push(p+`${d} ${a} = {};`),o.push(p+`if (!${u}) return false;`)):(l&&o.push(p+`${a} = _pool.allocate<${d}>();`),o.push(p+`if (!${u}) return false;`),l||o.push(p+`set_${i.name}(${a});`));t.kind==="MESSAGE"&&(o.push("        break;"),o.push("      }"))}return t.kind==="MESSAGE"?(o.push("      default: {"),o.push(`        if (!_schema || !_schema->skip${t.name}Field(_bb, type)) return false;`),o.push("        break;"),o.push("      }"),o.push("    }"),o.push("  }")):o.push("  return true;"),o.push("}"),o.push(""),o}function oD(t,e,r){let n=t.fields,o=[];r&&(o.push(`inline ${t.name} ${t.name}::copy(kiwi::MemoryPool& pool) const {`),o.push(`  ${t.name} clone;`),o.push("  clone._fields = _fields.copy(pool);"),o.push("  memcpy(clone._flags, _flags, sizeof(_flags));"),o.push("  return clone;"),o.push("}"),o.push(""));for(let[i,a]of n.entries()){let s=Is(a),l=jn(e,a,a.isArray),c=Ig(i),d=Rg(i);if(a.isDeprecated)continue;let u=`_flags[${c}] |= ${d}`,p=`_flags[${c}] & ${d}`,_=ui(e,a);_?(o.push(`inline ${l} *${t.name}::${a.name}() {`),o.push(`  if (!(${p})) return nullptr;`),o.push(`  Field* field = _fields.getField(${a.value});`),o.push(`  return field ? ${_?"":"&"}field->${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::${a.name}() const {`),o.push(`  if (!(${p})) return nullptr;`),o.push(`  const Field* field = _fields.getField(${a.value});`),o.push(`  return field ? ${_?"":"&"}field->${s} : nullptr;`),o.push("}"),o.push(""),o.push(`inline const ${l} *${t.name}::iterator_${a.name}(const typename kiwi::SparseFields<Field>::FieldIterator& it) const {`),o.push(`  REPORT_IF_FALSE_DEBUG_ONLY(it.fieldNumber == ${a.value});`),o.push(`  return it.element->field.${s};`),o.push("}"),o.push("")):(o.push(`inline kiwi::Optional<${l}> ${t.name}::${a.name}() const {`),o.push(`  if (!(${p})) return std::nullopt;`),o.push(`  const Field* field = _fields.getField(${a.value});`),o.push(`  return field ? kiwi::Optional<${l}>(${TE(`field->${s}`,a)}) : std::nullopt;`),o.push("}"),o.push(""),o.push(`inline ${l} ${t.name}::iterator_${a.name}(const typename kiwi::SparseFields<Field>::FieldIterator& it) const {`),o.push(`  REPORT_IF_FALSE_DEBUG_ONLY(it.fieldNumber == ${a.value});`),o.push(`  return ${TE(`it.element->field.${s}`,a)};`),o.push("}"),o.push("")),ui(e,a)?o.push(`inline void ${t.name}::set_${a.name}(kiwi::MemoryPool &pool, ${l} *value) {`):a.isArray?(o.push(`inline ${l} &${t.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),o.push(`  ${l} value = pool.array<${jn(e,a,!1)}>(count);`)):o.push(`inline void ${t.name}::set_${a.name}(kiwi::MemoryPool &pool, const ${l} &value) {`),o.push(`  if (${p}) {`),o.push(`    Field* field = _fields.getField(${a.value});`),o.push(`    field->${s} = ${Vd("value",a)};`),a.isArray&&o.push(`    return field->${s};`),o.push("  } else {"),o.push(`    ${u};`),a.isArray?o.push(`    return _fields.addField({${a.value}, Field{.${s} = ${Vd("value",a)}}}, pool)->field.${s};`):o.push(`    _fields.addField({${a.value}, Field{.${s} = ${Vd("value",a)}}}, pool);`),o.push("  }"),o.push("}"),o.push("")}return o}function iD(t,e){let r=t.fields,n=[];n.push(`bool ${t.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let o of r){if(o.isDeprecated)continue;let i=jn(e,o,o.isArray),a=ui(e,o),s;a?s=`${i}*`:s=`kiwi::Optional<${i}>`;let l=Is(o);n.push(`  const ${s} ${l} = ${o.name}();`),a?(n.push(`  if (${l}) {`),n.push(`    const ${jn(e,o,o.isArray)}* _data = ${l};`)):(n.push(`  if (${l}.has_value()) {`),n.push(`    const ${jn(e,o,o.isArray)}& _data = *${l};`));let c="    ";l="_data";let d=o.isArray?"_it":l,u=RE(e,o,d);n.push(c+`_wb.writeVarUint(${o.value});`),o.isArray?(n.push(c+`_wb.writeVarUint(${l}.size());`),n.push(c+`for (const ${jn(e,o,!1)} &_it : ${l}) ${u}`)):n.push(c+u),n.push("  }")}return n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function aD(t,e,r){let n=t.fields,o=[];o.push(`bool ${t.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema, std::vector<kiwi::SparseFields<Field>::Element> &tempFields) {`);for(let i of n)if(i.isArray){o.push("  uint32_t count;");break}o.push("  while (true) {"),o.push("    uint32_t type;"),o.push("    if (!_bb.readVarUint(type)) return false;"),o.push("    switch (type) {"),o.push("      case 0: {"),o.push("        _fields = kiwi::SparseFields<Field>(tempFields.data(), tempFields.size(), _pool);"),o.push("        tempFields.clear();"),o.push("        return true;"),o.push("      }");for(let[i,a]of n.entries()){let s=Is(a),l=a.isArray?"_it":s,c=ui(e,a),d=IE(e,a,r),u=kd(e,a,l,d),p=jn(e,a,!1),_=Ig(i),h=Rg(i),A=`_flags[${_}] |= ${h}`;o.push(`      case ${a.value}: {`);let m="        ";a.isArray?(o.push(m+"if (!_bb.readVarUint(count)) return false;"),a.isDeprecated?a.type==="byte"?o.push(m+"if (!_bb.skipCount(count)) return false;"):o.push(m+`for (${p} &_it : _pool.array<${p}>(count)) if (!${u}) return false;`):(o.push(m+`${A};`),o.push(m+`${jn(e,a,!0)} ${s} = _pool.array<${p}>(count);`),a.type==="byte"?o.push(m+`if (!_bb.readByteArray(${s}.data(), count)) return false;`):(d&&o.push(m+`std::vector<kiwi::SparseFields<${p}::Field>::Element> tempDecodingFields;`),o.push(m+`for (${p} &_it : ${s}) if (!${u}) return false;`)),o.push(m+`tempFields.push_back({${a.value}, Field{.${s} = ${Vd(s,a)}}});`))):(c?o.push(m+`${p}* ${s} = _pool.allocate<${p}>();`):o.push(m+`${p} ${s} = {};`),o.push(m+`if (!${u}) return false;`),a.isDeprecated||(o.push(m+`${A};`),o.push(m+`tempFields.push_back({${a.value}, Field{.${s} = ${Vd(s,a)}}});`))),o.push("        break;"),o.push("      }")}return o.push("      default: {"),o.push(`        if (!_schema || !_schema->skip${t.name}Field(_bb, type)) return false;`),o.push("        break;"),o.push("      }"),o.push("    }"),o.push("  }"),o.push("}"),o.push(""),o.push(`bool ${t.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`),o.push("  std::vector<kiwi::SparseFields<Field>::Element> tempFields;"),o.push("  return decode(_bb, _pool, _schema, tempFields);"),o.push("}"),o}function EE(t){return t.fields.every(e=>e.type==="uint"||e.type==="float"||e.type==="byte"&&e.isArray)}function sD(t,e={}){let r={};for(let c of t.definitions)r[c.name]=c;let n=e.includePrefix||"",{sparseMessages:o=[],copyableMessages:i=[],generateVisitors:a=[],separateEnumFile:s}=e;for(let c of o)c in r||Dr(`Requesting sparse implementation for ${st(c)} which is not defined in the schema`,0,0);let l=[];l.push(`#include "${n}kiwi.h"`),s&&l.push(`#include "${n}${s}"`),l.push(""),t.package!==null&&(l.push(`namespace ${t.package} {`),l.push(""),l.push(`#ifndef INCLUDE_${t.package.toUpperCase()}_H`),l.push(`#define INCLUDE_${t.package.toUpperCase()}_H`),l.push("")),l.push("inline bool shared_temp_field_vec_feature_flag = false;"),l.push(""),l.push("class BinarySchema {"),l.push("public:"),l.push("  bool parse(kiwi::ByteBuffer &bb);"),l.push("  const kiwi::BinarySchema &underlyingSchema() const { return _schema; }");for(let c of t.definitions)c.kind==="MESSAGE"&&(l.push(`  bool skip${c.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const;`),l.push(`  bool skip${c.name}(kiwi::ByteBuffer &bb) const;`)),c.kind==="STRUCT"&&EE(c)&&l.push(`  bool skip${c.name}(kiwi::ByteBuffer &bb) const;`);l.push(""),l.push("private:"),l.push("  kiwi::BinarySchema _schema;");for(let c of t.definitions)c.kind==="MESSAGE"&&l.push(`  uint32_t _index${c.name} = 0;`);l.push("};"),l.push(""),s||OE(t,l);for(let c of[0,1,2,3]){let d=!1;if(c===3){if(t.package!==null){if(o.length>0){l.push(`}  // namespace ${t.package}`);for(let u of o)l.push("template<>"),l.push(`struct std::hash<${t.package}::${u}::Field> {`),l.push(`  size_t operator()(const ${t.package}::${u}::Field& msg) const {`),l.push("    return 0;"),l.push("  }"),l.push("};");l.push(`namespace ${t.package} {`)}l.push(`#endif  // INCLUDE_${t.package.toUpperCase()}_H`)}l.push("#ifdef IMPLEMENT_SCHEMA_H"),l.push(""),l.push("bool BinarySchema::parse(kiwi::ByteBuffer &bb) {"),l.push("  if (!_schema.parse(bb)) return false;");for(let u of t.definitions)u.kind==="MESSAGE"&&l.push(`  _schema.findDefinition("${u.name}", _index${u.name});`);l.push("  return true;"),l.push("}"),l.push("");for(let u of t.definitions)if(u.kind==="MESSAGE"&&(l.push(`bool BinarySchema::skip${u.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const {`),l.push(`  return _schema.skipField(bb, _index${u.name}, id);`),l.push("}"),l.push(""),l.push(`bool BinarySchema::skip${u.name}(kiwi::ByteBuffer &bb) const {`),l.push("  while (true) {"),l.push("    uint32_t type;"),l.push("    if (!bb.readVarUint(type)) return false;"),l.push("    if (type == 0) return true;"),l.push(`    if (!skip${u.name}Field(bb, type)) return false;`),l.push("  }"),l.push("}"),l.push(""),a.includes(u.name)&&(l=l.concat(eD(u,r)))),u.kind==="STRUCT"&&EE(u)){l.push(`bool BinarySchema::skip${u.name}(kiwi::ByteBuffer &bb) const {`);let p=!1,_=!1;for(let h of u.fields)l.push(`  // ${h.name}`),h.type==="float"?(_||(l.push("  float f;"),_=!0),l.push("  if (!bb.readVarFloat(f)) return false;")):(p||(l.push("  uint32_t i;"),p=!0),l.push("  if (!bb.readVarUint(i)) return false;"),h.isArray&&l.push("  if (!bb.skipCount(i)) return false;"));l.push("  return true;"),l.push("}"),l.push("")}}for(let u of t.definitions){if(u.kind==="ENUM")continue;let p=o.includes(u.name);if(p&&u.kind!=="MESSAGE"){let _=`Type ${st(u.name)} cannot be declared as sparse. `;_+=`${st(u.name)} is type ${st(u.kind)}, but needs to be a MESSAGE.`,Dr(_,u.line,u.column)}c===0?(l.push(`class ${u.name};`),d=!0):c===1?(p?l=l.concat(ZF(u,r,i.includes(u.name))):l=l.concat(XF(u,r,i.includes(u.name))),a.includes(u.name)&&(l=l.concat($F(u,r)))):c===2?p?l=l.concat(oD(u,r,i.includes(u.name))):l=l.concat(tD(u,r,i.includes(u.name))):p?(l=l.concat(iD(u,r)),l=l.concat(aD(u,r,o))):(l=l.concat(rD(u,r)),l=l.concat(nD(u,r,o)))}c===3?(l.push("#endif  // IMPLEMENT_SCHEMA_H"),l.push("")):d&&l.push("")}return t.package!==null&&(l.push(`}  // namespace ${t.package}`),l.push("")),l.join(`
`)}function lD(t){let e=["#pragma once",""];return t.package&&(e.push(`namespace ${t.package} {`),e.push("")),OE(t,e),t.package&&(e.push(""),e.push(`}  // namespace ${t.package}`),e.push("")),e.join(`
`)}function OE(t,e){for(let r of t.definitions)if(r.kind==="ENUM"){e.push(`enum class ${r.name} : uint32_t {`);for(let n of r.fields)e.push(`  ${n.name} = ${n.value},`);e.push("};"),e.push("")}}var NE=wi(()=>{Bd()});var PE={};ka(PE,{compileSchemaTypeScript:()=>cD});function cD(t){var e="",r=[];t.package!==null&&(r.push("export namespace "+t.package+" {"),e+="  ");for(let o of t.definitions)if(o.kind==="ENUM"){r.push(e+"export type "+o.name+" =");for(let[i,a]of o.fields.entries())r.push(e+"  "+JSON.stringify(a.name)+(i+1<o.fields.length?" |":";"));o.fields.length||r.push(e+"  any;"),r.push("")}for(let o of t.definitions)if(o.kind==="STRUCT"||o.kind==="MESSAGE"){r.push(e+"export interface "+o.name+" {");for(let i of o.fields){var n;if(!i.isDeprecated){switch(i.type){case"bool":n="boolean";break;case"byte":case"int":case"uint":case"float":n="number";break;case"int64":case"uint64":n="string";break;default:n=i.type;break}i.type==="byte"&&i.isArray?n="Uint8Array":i.isArray&&(n+="[]"),r.push(e+"  "+i.name+(o.kind==="MESSAGE"?"?":"")+": "+n+";")}}r.push(e+"}"),r.push("")}else o.kind!=="ENUM"&&Dr("Invalid definition kind "+st(o.kind),o.line,o.column);r.push(e+"export type DedupCache = any;"),r.push(""),r.push(e+"export interface Schema {"),r.push(e+"  makeDedupCache(): DedupCache;");for(let o of t.definitions)o.kind==="ENUM"?r.push(e+"  "+o.name+": any;"):(o.kind==="STRUCT"||o.kind==="MESSAGE")&&(r.push(e+"  encode"+o.name+"(message: "+o.name+"): Uint8Array;"),r.push(e+"  decode"+o.name+"(buffer: Uint8Array, optionalDedupCache?: DedupCache): "+o.name+";"),r.push(e+"  redact"+o.name+"(buffer: Uint8Array): void;"));return r.push(e+"}"),t.package!==null&&r.push("}"),r.push(""),r.join(`
`)}var FE=wi(()=>{Bd()});var DE={};ka(DE,{prettyPrintSchema:()=>dD});function dD(t){let e=t.definitions,r="";t.package!==null&&(r+="package "+t.package+`;

`);let n=!0;for(let o of e){n?n=!1:r+=`
`,r+=o.kind.toLowerCase()+" "+o.name+` {
`;for(let i of o.fields)r+="  ",o.kind!=="ENUM"&&(r+=i.type,i.isArray&&(r+="[]"),r+=" "),r+=i.name,o.kind!=="STRUCT"&&(r+=" = "+i.value),i.isDeprecated&&(r+=" [deprecated]"),r+=`;
`;r+=`}
`}return r}var wE=wi(()=>{});var Hd=pg(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.prettyPrintSchema=wr.parseSchema=wr.encodeBinarySchema=wr.decodeBinarySchema=wr.compileSchemaTypeScript=wr.compileSchemaCPP=wr.compileSchemaCallbackCPP=wr.createKiwiCodec=wr.KiwiCodec=wr.compileSchemaJS=wr.compileSchema=wr.ByteBuffer=void 0;var uD=(Md(),Ha(oE));Object.defineProperty(wr,"ByteBuffer",{enumerable:!0,get:function(){return uD.ByteBuffer}});var xE=(Tg(),Ha(uE));Object.defineProperty(wr,"compileSchema",{enumerable:!0,get:function(){return xE.compileSchema}});Object.defineProperty(wr,"compileSchemaJS",{enumerable:!0,get:function(){return xE.compileSchemaJS}});var LE=(_E(),Ha(pE));Object.defineProperty(wr,"KiwiCodec",{enumerable:!0,get:function(){return LE.KiwiCodec}});Object.defineProperty(wr,"createKiwiCodec",{enumerable:!0,get:function(){return LE.createKiwiCodec}});var pD=(AE(),Ha(SE));Object.defineProperty(wr,"compileSchemaCallbackCPP",{enumerable:!0,get:function(){return pD.compileSchemaCallbackCPP}});var _D=(NE(),Ha(bE));Object.defineProperty(wr,"compileSchemaCPP",{enumerable:!0,get:function(){return _D.compileSchemaCPP}});var hD=(FE(),Ha(PE));Object.defineProperty(wr,"compileSchemaTypeScript",{enumerable:!0,get:function(){return hD.compileSchemaTypeScript}});var ME=(o_(),Ha(cE));Object.defineProperty(wr,"decodeBinarySchema",{enumerable:!0,get:function(){return ME.decodeBinarySchema}});Object.defineProperty(wr,"encodeBinarySchema",{enumerable:!0,get:function(){return ME.encodeBinarySchema}});var mD=(n_(),Ha(lE));Object.defineProperty(wr,"parseSchema",{enumerable:!0,get:function(){return mD.parseSchema}});var fD=(wE(),Ha(DE));Object.defineProperty(wr,"prettyPrintSchema",{enumerable:!0,get:function(){return fD.prettyPrintSchema}})});var k1=pg((BA,GA)=>{(function(t,e){typeof BA=="object"&&typeof GA<"u"?GA.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(BA,function(){"use strict";function t(m,g,S,R,E){(function P(T,f,y,v,w){for(;v>y;){if(v-y>600){var I=v-y+1,C=f-y+1,L=Math.log(I),B=.5*Math.exp(2*L/3),V=.5*Math.sqrt(L*B*(I-B)/I)*(C-I/2<0?-1:1),b=Math.max(y,Math.floor(f-C*B/I+V)),D=Math.min(v,Math.floor(f+(I-C)*B/I+V));P(T,f,b,D,w)}var U=T[f],H=y,k=v;for(e(T,y,f),w(T[v],U)>0&&e(T,y,v);H<k;){for(e(T,H,k),H++,k--;w(T[H],U)<0;)H++;for(;w(T[k],U)>0;)k--}w(T[y],U)===0?e(T,y,k):e(T,++k,v),k<=f&&(y=k+1),f<=k&&(v=k-1)}})(m,g,S||0,R||m.length-1,E||r)}function e(m,g,S){var R=m[g];m[g]=m[S],m[S]=R}function r(m,g){return m<g?-1:m>g?1:0}var n=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(m,g,S){if(!S)return g.indexOf(m);for(var R=0;R<g.length;R++)if(S(m,g[R]))return R;return-1}function i(m,g){a(m,0,m.children.length,g,m)}function a(m,g,S,R,E){E||(E=h(null)),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(var P=g;P<S;P++){var T=m.children[P];s(E,m.leaf?R(T):T)}return E}function s(m,g){return m.minX=Math.min(m.minX,g.minX),m.minY=Math.min(m.minY,g.minY),m.maxX=Math.max(m.maxX,g.maxX),m.maxY=Math.max(m.maxY,g.maxY),m}function l(m,g){return m.minX-g.minX}function c(m,g){return m.minY-g.minY}function d(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function u(m){return m.maxX-m.minX+(m.maxY-m.minY)}function p(m,g){return m.minX<=g.minX&&m.minY<=g.minY&&g.maxX<=m.maxX&&g.maxY<=m.maxY}function _(m,g){return g.minX<=m.maxX&&g.minY<=m.maxY&&g.maxX>=m.minX&&g.maxY>=m.minY}function h(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function A(m,g,S,R,E){for(var P=[g,S];P.length;)if(!((S=P.pop())-(g=P.pop())<=R)){var T=g+Math.ceil((S-g)/R/2)*R;t(m,T,g,S,E),P.push(g,T,T,S)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(m){var g=this.data,S=[];if(!_(m,g))return S;for(var R=this.toBBox,E=[];g;){for(var P=0;P<g.children.length;P++){var T=g.children[P],f=g.leaf?R(T):T;_(m,f)&&(g.leaf?S.push(T):p(m,f)?this._all(T,S):E.push(T))}g=E.pop()}return S},n.prototype.collides=function(m){var g=this.data;if(!_(m,g))return!1;for(var S=[];g;){for(var R=0;R<g.children.length;R++){var E=g.children[R],P=g.leaf?this.toBBox(E):E;if(_(m,P)){if(g.leaf||p(m,P))return!0;S.push(E)}}g=S.pop()}return!1},n.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var g=0;g<m.length;g++)this.insert(m[g]);return this}var S=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===S.height)this._splitRoot(this.data,S);else{if(this.data.height<S.height){var R=this.data;this.data=S,S=R}this._insert(S,this.data.height-S.height-1,!0)}else this.data=S;return this},n.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},n.prototype.clear=function(){return this.data=h([]),this},n.prototype.remove=function(m,g){if(!m)return this;for(var S,R,E,P=this.data,T=this.toBBox(m),f=[],y=[];P||f.length;){if(P||(P=f.pop(),R=f[f.length-1],S=y.pop(),E=!0),P.leaf){var v=o(m,P.children,g);if(v!==-1)return P.children.splice(v,1),f.push(P),this._condense(f),this}E||P.leaf||!p(P,T)?R?(S++,P=R.children[S],E=!1):P=null:(f.push(P),y.push(S),S=0,R=P,P=P.children[0])}return this},n.prototype.toBBox=function(m){return m},n.prototype.compareMinX=function(m,g){return m.minX-g.minX},n.prototype.compareMinY=function(m,g){return m.minY-g.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(m){return this.data=m,this},n.prototype._all=function(m,g){for(var S=[];m;)m.leaf?g.push.apply(g,m.children):S.push.apply(S,m.children),m=S.pop();return g},n.prototype._build=function(m,g,S,R){var E,P=S-g+1,T=this._maxEntries;if(P<=T)return i(E=h(m.slice(g,S+1)),this.toBBox),E;R||(R=Math.ceil(Math.log(P)/Math.log(T)),T=Math.ceil(P/Math.pow(T,R-1))),(E=h([])).leaf=!1,E.height=R;var f=Math.ceil(P/T),y=f*Math.ceil(Math.sqrt(T));A(m,g,S,y,this.compareMinX);for(var v=g;v<=S;v+=y){var w=Math.min(v+y-1,S);A(m,v,w,f,this.compareMinY);for(var I=v;I<=w;I+=f){var C=Math.min(I+f-1,w);E.children.push(this._build(m,I,C,R-1))}}return i(E,this.toBBox),E},n.prototype._chooseSubtree=function(m,g,S,R){for(;R.push(g),!g.leaf&&R.length-1!==S;){for(var E=1/0,P=1/0,T=void 0,f=0;f<g.children.length;f++){var y=g.children[f],v=d(y),w=(I=m,C=y,(Math.max(C.maxX,I.maxX)-Math.min(C.minX,I.minX))*(Math.max(C.maxY,I.maxY)-Math.min(C.minY,I.minY))-v);w<P?(P=w,E=v<E?v:E,T=y):w===P&&v<E&&(E=v,T=y)}g=T||g.children[0]}var I,C;return g},n.prototype._insert=function(m,g,S){var R=S?m:this.toBBox(m),E=[],P=this._chooseSubtree(R,this.data,g,E);for(P.children.push(m),s(P,R);g>=0&&E[g].children.length>this._maxEntries;)this._split(E,g),g--;this._adjustParentBBoxes(R,E,g)},n.prototype._split=function(m,g){var S=m[g],R=S.children.length,E=this._minEntries;this._chooseSplitAxis(S,E,R);var P=this._chooseSplitIndex(S,E,R),T=h(S.children.splice(P,S.children.length-P));T.height=S.height,T.leaf=S.leaf,i(S,this.toBBox),i(T,this.toBBox),g?m[g-1].children.push(T):this._splitRoot(S,T)},n.prototype._splitRoot=function(m,g){this.data=h([m,g]),this.data.height=m.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(m,g,S){for(var R,E,P,T,f,y,v,w=1/0,I=1/0,C=g;C<=S-g;C++){var L=a(m,0,C,this.toBBox),B=a(m,C,S,this.toBBox),V=(E=L,P=B,T=void 0,f=void 0,y=void 0,v=void 0,T=Math.max(E.minX,P.minX),f=Math.max(E.minY,P.minY),y=Math.min(E.maxX,P.maxX),v=Math.min(E.maxY,P.maxY),Math.max(0,y-T)*Math.max(0,v-f)),b=d(L)+d(B);V<w?(w=V,R=C,I=b<I?b:I):V===w&&b<I&&(I=b,R=C)}return R||S-g},n.prototype._chooseSplitAxis=function(m,g,S){var R=m.leaf?this.compareMinX:l,E=m.leaf?this.compareMinY:c;this._allDistMargin(m,g,S,R)<this._allDistMargin(m,g,S,E)&&m.children.sort(R)},n.prototype._allDistMargin=function(m,g,S,R){m.children.sort(R);for(var E=this.toBBox,P=a(m,0,g,E),T=a(m,S-g,S,E),f=u(P)+u(T),y=g;y<S-g;y++){var v=m.children[y];s(P,m.leaf?E(v):v),f+=u(P)}for(var w=S-g-1;w>=g;w--){var I=m.children[w];s(T,m.leaf?E(I):I),f+=u(T)}return f},n.prototype._adjustParentBBoxes=function(m,g,S){for(var R=S;R>=0;R--)s(g[R],m)},n.prototype._condense=function(m){for(var g=m.length-1,S=void 0;g>=0;g--)m[g].children.length===0?g>0?(S=m[g-1].children).splice(S.indexOf(m[g]),1):this.clear():i(m[g],this.toBBox)},n})});var sP=pg((mp,jA)=>{(function(e,r){typeof mp=="object"&&typeof jA=="object"?jA.exports=r():typeof define=="function"&&define.amd?define([],r):typeof mp=="object"?mp.JsDiff=r():e.JsDiff=r()})(mp,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}return r.m=t,r.c=e,r.p="",r(0)}([function(t,e,r){"use strict";e.__esModule=!0,e.canonicalize=e.convertChangesToXML=e.convertChangesToDMP=e.merge=e.parsePatch=e.applyPatches=e.applyPatch=e.createPatch=e.createTwoFilesPatch=e.structuredPatch=e.diffArrays=e.diffJson=e.diffCss=e.diffSentences=e.diffTrimmedLines=e.diffLines=e.diffWordsWithSpace=e.diffWords=e.diffChars=e.Diff=void 0;var n=r(1),o=S(n),i=r(2),a=r(3),s=r(5),l=r(6),c=r(7),d=r(8),u=r(9),p=r(10),_=r(11),h=r(13),A=r(14),m=r(16),g=r(17);function S(R){return R&&R.__esModule?R:{default:R}}e.Diff=o.default,e.diffChars=i.diffChars,e.diffWords=a.diffWords,e.diffWordsWithSpace=a.diffWordsWithSpace,e.diffLines=s.diffLines,e.diffTrimmedLines=s.diffTrimmedLines,e.diffSentences=l.diffSentences,e.diffCss=c.diffCss,e.diffJson=d.diffJson,e.diffArrays=u.diffArrays,e.structuredPatch=A.structuredPatch,e.createTwoFilesPatch=A.createTwoFilesPatch,e.createPatch=A.createPatch,e.applyPatch=p.applyPatch,e.applyPatches=p.applyPatches,e.parsePatch=_.parsePatch,e.merge=h.merge,e.convertChangesToDMP=m.convertChangesToDMP,e.convertChangesToXML=g.convertChangesToXML,e.canonicalize=d.canonicalize},function(t,e){"use strict";e.__esModule=!0,e.default=r;function r(){}r.prototype={diff:function(a,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=l.callback;typeof l=="function"&&(c=l,l={}),this.options=l;var d=this;function u(E){return c?(setTimeout(function(){c(void 0,E)},0),!0):E}a=this.castInput(a),s=this.castInput(s),a=this.removeEmpty(this.tokenize(a)),s=this.removeEmpty(this.tokenize(s));var p=s.length,_=a.length,h=1,A=p+_,m=[{newPos:-1,components:[]}],g=this.extractCommon(m[0],s,a,0);if(m[0].newPos+1>=p&&g+1>=_)return u([{value:this.join(s),count:s.length}]);function S(){for(var E=-1*h;E<=h;E+=2){var P=void 0,T=m[E-1],f=m[E+1],y=(f?f.newPos:0)-E;T&&(m[E-1]=void 0);var v=T&&T.newPos+1<p,w=f&&0<=y&&y<_;if(!v&&!w){m[E]=void 0;continue}if(!v||w&&T.newPos<f.newPos?(P=o(f),d.pushComponent(P.components,void 0,!0)):(P=T,P.newPos++,d.pushComponent(P.components,!0,void 0)),y=d.extractCommon(P,s,a,E),P.newPos+1>=p&&y+1>=_)return u(n(d,P.components,s,a,d.useLongestToken));m[E]=P}h++}if(c)(function E(){setTimeout(function(){if(h>A)return c();S()||E()},0)})();else for(;h<=A;){var R=S();if(R)return R}},pushComponent:function(a,s,l){var c=a[a.length-1];c&&c.added===s&&c.removed===l?a[a.length-1]={count:c.count+1,added:s,removed:l}:a.push({count:1,added:s,removed:l})},extractCommon:function(a,s,l,c){for(var d=s.length,u=l.length,p=a.newPos,_=p-c,h=0;p+1<d&&_+1<u&&this.equals(s[p+1],l[_+1]);)p++,_++,h++;return h&&a.components.push({count:h}),a.newPos=p,_},equals:function(a,s){return this.options.comparator?this.options.comparator(a,s):a===s||this.options.ignoreCase&&a.toLowerCase()===s.toLowerCase()},removeEmpty:function(a){for(var s=[],l=0;l<a.length;l++)a[l]&&s.push(a[l]);return s},castInput:function(a){return a},tokenize:function(a){return a.split("")},join:function(a){return a.join("")}};function n(i,a,s,l,c){for(var d=0,u=a.length,p=0,_=0;d<u;d++){var h=a[d];if(h.removed){if(h.value=i.join(l.slice(_,_+h.count)),_+=h.count,d&&a[d-1].added){var m=a[d-1];a[d-1]=a[d],a[d]=m}}else{if(!h.added&&c){var A=s.slice(p,p+h.count);A=A.map(function(S,R){var E=l[_+R];return E.length>S.length?E:S}),h.value=i.join(A)}else h.value=i.join(s.slice(p,p+h.count));p+=h.count,h.added||(_+=h.count)}}var g=a[u-1];return u>1&&typeof g.value=="string"&&(g.added||g.removed)&&i.equals("",g.value)&&(a[u-2].value+=g.value,a.pop()),a}function o(i){return{newPos:i.newPos,components:i.components.slice(0)}}},function(t,e,r){"use strict";e.__esModule=!0,e.characterDiff=void 0,e.diffChars=s;var n=r(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.characterDiff=new o.default;function s(l,c,d){return a.diff(l,c,d)}},function(t,e,r){"use strict";e.__esModule=!0,e.wordDiff=void 0,e.diffWords=d,e.diffWordsWithSpace=u;var n=r(1),o=a(n),i=r(4);function a(p){return p&&p.__esModule?p:{default:p}}var s=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,c=e.wordDiff=new o.default;c.equals=function(p,_){return this.options.ignoreCase&&(p=p.toLowerCase(),_=_.toLowerCase()),p===_||this.options.ignoreWhitespace&&!l.test(p)&&!l.test(_)},c.tokenize=function(p){for(var _=p.split(/(\s+|\b)/),h=0;h<_.length-1;h++)!_[h+1]&&_[h+2]&&s.test(_[h])&&s.test(_[h+2])&&(_[h]+=_[h+2],_.splice(h+1,2),h--);return _};function d(p,_,h){return h=(0,i.generateOptions)(h,{ignoreWhitespace:!0}),c.diff(p,_,h)}function u(p,_,h){return c.diff(p,_,h)}},function(t,e){"use strict";e.__esModule=!0,e.generateOptions=r;function r(n,o){if(typeof n=="function")o.callback=n;else if(n)for(var i in n)n.hasOwnProperty(i)&&(o[i]=n[i]);return o}},function(t,e,r){"use strict";e.__esModule=!0,e.lineDiff=void 0,e.diffLines=l,e.diffTrimmedLines=c;var n=r(1),o=a(n),i=r(4);function a(d){return d&&d.__esModule?d:{default:d}}var s=e.lineDiff=new o.default;s.tokenize=function(d){var u=[],p=d.split(/(\n|\r\n)/);p[p.length-1]||p.pop();for(var _=0;_<p.length;_++){var h=p[_];_%2&&!this.options.newlineIsToken?u[u.length-1]+=h:(this.options.ignoreWhitespace&&(h=h.trim()),u.push(h))}return u};function l(d,u,p){return s.diff(d,u,p)}function c(d,u,p){var _=(0,i.generateOptions)(p,{ignoreWhitespace:!0});return s.diff(d,u,_)}},function(t,e,r){"use strict";e.__esModule=!0,e.sentenceDiff=void 0,e.diffSentences=s;var n=r(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.sentenceDiff=new o.default;a.tokenize=function(l){return l.split(/(\S.+?[.!?])(?=\s+|$)/)};function s(l,c,d){return a.diff(l,c,d)}},function(t,e,r){"use strict";e.__esModule=!0,e.cssDiff=void 0,e.diffCss=s;var n=r(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.cssDiff=new o.default;a.tokenize=function(l){return l.split(/([{}:;,]|\s+)/)};function s(l,c,d){return a.diff(l,c,d)}},function(t,e,r){"use strict";e.__esModule=!0,e.jsonDiff=void 0;var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p};e.diffJson=d,e.canonicalize=u;var o=r(1),i=s(o),a=r(5);function s(p){return p&&p.__esModule?p:{default:p}}var l=Object.prototype.toString,c=e.jsonDiff=new i.default;c.useLongestToken=!0,c.tokenize=a.lineDiff.tokenize,c.castInput=function(p){var _=this.options,h=_.undefinedReplacement,A=_.stringifyReplacer,m=A===void 0?function(g,S){return typeof S>"u"?h:S}:A;return typeof p=="string"?p:JSON.stringify(u(p,null,null,m),m,"  ")},c.equals=function(p,_){return i.default.prototype.equals.call(c,p.replace(/,([\r\n])/g,"$1"),_.replace(/,([\r\n])/g,"$1"))};function d(p,_,h){return c.diff(p,_,h)}function u(p,_,h,A,m){_=_||[],h=h||[],A&&(p=A(m,p));var g=void 0;for(g=0;g<_.length;g+=1)if(_[g]===p)return h[g];var S=void 0;if(l.call(p)==="[object Array]"){for(_.push(p),S=new Array(p.length),h.push(S),g=0;g<p.length;g+=1)S[g]=u(p[g],_,h,A,m);return _.pop(),h.pop(),S}if(p&&p.toJSON&&(p=p.toJSON()),(typeof p>"u"?"undefined":n(p))==="object"&&p!==null){_.push(p),S={},h.push(S);var R=[],E=void 0;for(E in p)p.hasOwnProperty(E)&&R.push(E);for(R.sort(),g=0;g<R.length;g+=1)E=R[g],S[E]=u(p[E],_,h,A,E);_.pop(),h.pop()}else S=p;return S}},function(t,e,r){"use strict";e.__esModule=!0,e.arrayDiff=void 0,e.diffArrays=s;var n=r(1),o=i(n);function i(l){return l&&l.__esModule?l:{default:l}}var a=e.arrayDiff=new o.default;a.tokenize=function(l){return l.slice()},a.join=a.removeEmpty=function(l){return l};function s(l,c,d){return a.diff(l,c,d)}},function(t,e,r){"use strict";e.__esModule=!0,e.applyPatch=s,e.applyPatches=l;var n=r(11),o=r(12),i=a(o);function a(c){return c&&c.__esModule?c:{default:c}}function s(c,d){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof d=="string"&&(d=(0,n.parsePatch)(d)),Array.isArray(d)){if(d.length>1)throw new Error("applyPatch only works with a single input.");d=d[0]}var p=c.split(/\r\n|[\n\v\f\r\x85]/),_=c.match(/\r\n|[\n\v\f\r\x85]/g)||[],h=d.hunks,A=u.compareLine||function(j,ae,xe,Je){return ae===Je},m=0,g=u.fuzzFactor||0,S=0,R=0,E=void 0,P=void 0;function T(j,ae){for(var xe=0;xe<j.lines.length;xe++){var Je=j.lines[xe],We=Je.length>0?Je[0]:" ",pt=Je.length>0?Je.substr(1):Je;if(We===" "||We==="-"){if(!A(ae+1,p[ae],We,pt)&&(m++,m>g))return!1;ae++}}return!0}for(var f=0;f<h.length;f++){for(var y=h[f],v=p.length-y.oldLines,w=0,I=R+y.oldStart-1,C=(0,i.default)(I,S,v);w!==void 0;w=C())if(T(y,I+w)){y.offset=R+=w;break}if(w===void 0)return!1;S=y.offset+y.oldStart+y.oldLines}for(var L=0,B=0;B<h.length;B++){var V=h[B],b=V.oldStart+V.offset+L-1;L+=V.newLines-V.oldLines,b<0&&(b=0);for(var D=0;D<V.lines.length;D++){var U=V.lines[D],H=U.length>0?U[0]:" ",k=U.length>0?U.substr(1):U,z=V.linedelimiters[D];if(H===" ")b++;else if(H==="-")p.splice(b,1),_.splice(b,1);else if(H==="+")p.splice(b,0,k),_.splice(b,0,z),b++;else if(H==="\\"){var q=V.lines[D-1]?V.lines[D-1][0]:null;q==="+"?E=!0:q==="-"&&(P=!0)}}}if(E)for(;!p[p.length-1];)p.pop(),_.pop();else P&&(p.push(""),_.push(`
`));for(var Y=0;Y<p.length-1;Y++)p[Y]=p[Y]+_[Y];return p.join("")}function l(c,d){typeof c=="string"&&(c=(0,n.parsePatch)(c));var u=0;function p(){var _=c[u++];if(!_)return d.complete();d.loadFile(_,function(h,A){if(h)return d.complete(h);var m=s(A,_,d);d.patched(_,m,function(g){if(g)return d.complete(g);p()})})}p()}},function(t,e){"use strict";e.__esModule=!0,e.parsePatch=r;function r(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.split(/\r\n|[\n\v\f\r\x85]/),a=n.match(/\r\n|[\n\v\f\r\x85]/g)||[],s=[],l=0;function c(){var p={};for(s.push(p);l<i.length;){var _=i[l];if(/^(\-\-\-|\+\+\+|@@)\s/.test(_))break;var h=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(_);h&&(p.index=h[1]),l++}for(d(p),d(p),p.hunks=[];l<i.length;){var A=i[l];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(A))break;if(/^@@/.test(A))p.hunks.push(u());else{if(A&&o.strict)throw new Error("Unknown line "+(l+1)+" "+JSON.stringify(A));l++}}}function d(p){var _=/^(---|\+\+\+)\s+(.*)$/.exec(i[l]);if(_){var h=_[1]==="---"?"old":"new",A=_[2].split("	",2),m=A[0].replace(/\\\\/g,"\\");/^".*"$/.test(m)&&(m=m.substr(1,m.length-2)),p[h+"FileName"]=m,p[h+"Header"]=(A[1]||"").trim(),l++}}function u(){for(var p=l,_=i[l++],h=_.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),A={oldStart:+h[1],oldLines:+h[2]||1,newStart:+h[3],newLines:+h[4]||1,lines:[],linedelimiters:[]},m=0,g=0;l<i.length&&!(i[l].indexOf("--- ")===0&&l+2<i.length&&i[l+1].indexOf("+++ ")===0&&i[l+2].indexOf("@@")===0);l++){var S=i[l].length==0&&l!=i.length-1?" ":i[l][0];if(S==="+"||S==="-"||S===" "||S==="\\")A.lines.push(i[l]),A.linedelimiters.push(a[l]||`
`),S==="+"?m++:S==="-"?g++:S===" "&&(m++,g++);else break}if(!m&&A.newLines===1&&(A.newLines=0),!g&&A.oldLines===1&&(A.oldLines=0),o.strict){if(m!==A.newLines)throw new Error("Added line count did not match for hunk at line "+(p+1));if(g!==A.oldLines)throw new Error("Removed line count did not match for hunk at line "+(p+1))}return A}for(;l<i.length;)c();return s}},function(t,e){"use strict";e.__esModule=!0,e.default=function(r,n,o){var i=!0,a=!1,s=!1,l=1;return function c(){if(i&&!s){if(a?l++:i=!1,r+l<=o)return l;s=!0}if(!a)return s||(i=!0),n<=r-l?-l++:(a=!0,c())}}},function(t,e,r){"use strict";e.__esModule=!0,e.calcLineCount=s,e.merge=l;var n=r(14),o=r(11),i=r(15);function a(v){if(Array.isArray(v)){for(var w=0,I=Array(v.length);w<v.length;w++)I[w]=v[w];return I}else return Array.from(v)}function s(v){var w=y(v.lines),I=w.oldLines,C=w.newLines;I!==void 0?v.oldLines=I:delete v.oldLines,C!==void 0?v.newLines=C:delete v.newLines}function l(v,w,I){v=c(v,I),w=c(w,I);var C={};(v.index||w.index)&&(C.index=v.index||w.index),(v.newFileName||w.newFileName)&&(d(v)?d(w)?(C.oldFileName=u(C,v.oldFileName,w.oldFileName),C.newFileName=u(C,v.newFileName,w.newFileName),C.oldHeader=u(C,v.oldHeader,w.oldHeader),C.newHeader=u(C,v.newHeader,w.newHeader)):(C.oldFileName=v.oldFileName,C.newFileName=v.newFileName,C.oldHeader=v.oldHeader,C.newHeader=v.newHeader):(C.oldFileName=w.oldFileName||v.oldFileName,C.newFileName=w.newFileName||v.newFileName,C.oldHeader=w.oldHeader||v.oldHeader,C.newHeader=w.newHeader||v.newHeader)),C.hunks=[];for(var L=0,B=0,V=0,b=0;L<v.hunks.length||B<w.hunks.length;){var D=v.hunks[L]||{oldStart:1/0},U=w.hunks[B]||{oldStart:1/0};if(p(D,U))C.hunks.push(_(D,V)),L++,b+=D.newLines-D.oldLines;else if(p(U,D))C.hunks.push(_(U,b)),B++,V+=U.newLines-U.oldLines;else{var H={oldStart:Math.min(D.oldStart,U.oldStart),oldLines:0,newStart:Math.min(D.newStart+V,U.oldStart+b),newLines:0,lines:[]};h(H,D.oldStart,D.lines,U.oldStart,U.lines),B++,L++,C.hunks.push(H)}}return C}function c(v,w){if(typeof v=="string"){if(/^@@/m.test(v)||/^Index:/m.test(v))return(0,o.parsePatch)(v)[0];if(!w)throw new Error("Must provide a base reference or pass in a patch");return(0,n.structuredPatch)(void 0,void 0,w,v)}return v}function d(v){return v.newFileName&&v.newFileName!==v.oldFileName}function u(v,w,I){return w===I?w:(v.conflict=!0,{mine:w,theirs:I})}function p(v,w){return v.oldStart<w.oldStart&&v.oldStart+v.oldLines<w.oldStart}function _(v,w){return{oldStart:v.oldStart,oldLines:v.oldLines,newStart:v.newStart+w,newLines:v.newLines,lines:v.lines}}function h(v,w,I,C,L){var B={offset:w,lines:I,index:0},V={offset:C,lines:L,index:0};for(S(v,B,V),S(v,V,B);B.index<B.lines.length&&V.index<V.lines.length;){var b=B.lines[B.index],D=V.lines[V.index];if((b[0]==="-"||b[0]==="+")&&(D[0]==="-"||D[0]==="+"))A(v,B,V);else if(b[0]==="+"&&D[0]===" "){var U;(U=v.lines).push.apply(U,a(E(B)))}else if(D[0]==="+"&&b[0]===" "){var H;(H=v.lines).push.apply(H,a(E(V)))}else b[0]==="-"&&D[0]===" "?m(v,B,V):D[0]==="-"&&b[0]===" "?m(v,V,B,!0):b===D?(v.lines.push(b),B.index++,V.index++):g(v,E(B),E(V))}R(v,B),R(v,V),s(v)}function A(v,w,I){var C=E(w),L=E(I);if(T(C)&&T(L)){if((0,i.arrayStartsWith)(C,L)&&f(I,C,C.length-L.length)){var B;(B=v.lines).push.apply(B,a(C));return}else if((0,i.arrayStartsWith)(L,C)&&f(w,L,L.length-C.length)){var V;(V=v.lines).push.apply(V,a(L));return}}else if((0,i.arrayEqual)(C,L)){var b;(b=v.lines).push.apply(b,a(C));return}g(v,C,L)}function m(v,w,I,C){var L=E(w),B=P(I,L);if(B.merged){var V;(V=v.lines).push.apply(V,a(B.merged))}else g(v,C?B:L,C?L:B)}function g(v,w,I){v.conflict=!0,v.lines.push({conflict:!0,mine:w,theirs:I})}function S(v,w,I){for(;w.offset<I.offset&&w.index<w.lines.length;){var C=w.lines[w.index++];v.lines.push(C),w.offset++}}function R(v,w){for(;w.index<w.lines.length;){var I=w.lines[w.index++];v.lines.push(I)}}function E(v){for(var w=[],I=v.lines[v.index][0];v.index<v.lines.length;){var C=v.lines[v.index];if(I==="-"&&C[0]==="+"&&(I="+"),I===C[0])w.push(C),v.index++;else break}return w}function P(v,w){for(var I=[],C=[],L=0,B=!1,V=!1;L<w.length&&v.index<v.lines.length;){var b=v.lines[v.index],D=w[L];if(D[0]==="+")break;if(B=B||b[0]!==" ",C.push(D),L++,b[0]==="+")for(V=!0;b[0]==="+";)I.push(b),b=v.lines[++v.index];D.substr(1)===b.substr(1)?(I.push(b),v.index++):V=!0}if((w[L]||"")[0]==="+"&&B&&(V=!0),V)return I;for(;L<w.length;)C.push(w[L++]);return{merged:C,changes:I}}function T(v){return v.reduce(function(w,I){return w&&I[0]==="-"},!0)}function f(v,w,I){for(var C=0;C<I;C++){var L=w[w.length-I+C].substr(1);if(v.lines[v.index+C]!==" "+L)return!1}return v.index+=I,!0}function y(v){var w=0,I=0;return v.forEach(function(C){if(typeof C!="string"){var L=y(C.mine),B=y(C.theirs);w!==void 0&&(L.oldLines===B.oldLines?w+=L.oldLines:w=void 0),I!==void 0&&(L.newLines===B.newLines?I+=L.newLines:I=void 0)}else I!==void 0&&(C[0]==="+"||C[0]===" ")&&I++,w!==void 0&&(C[0]==="-"||C[0]===" ")&&w++}),{oldLines:w,newLines:I}}},function(t,e,r){"use strict";e.__esModule=!0,e.structuredPatch=i,e.createTwoFilesPatch=a,e.createPatch=s;var n=r(5);function o(l){if(Array.isArray(l)){for(var c=0,d=Array(l.length);c<l.length;c++)d[c]=l[c];return d}else return Array.from(l)}function i(l,c,d,u,p,_,h){h||(h={}),typeof h.context>"u"&&(h.context=4);var A=(0,n.diffLines)(d,u,h);A.push({value:"",lines:[]});function m(v){return v.map(function(w){return" "+w})}for(var g=[],S=0,R=0,E=[],P=1,T=1,f=function(w){var I=A[w],C=I.lines||I.value.replace(/\n$/,"").split(`
`);if(I.lines=C,I.added||I.removed){var L;if(!S){var B=A[w-1];S=P,R=T,B&&(E=h.context>0?m(B.lines.slice(-h.context)):[],S-=E.length,R-=E.length)}(L=E).push.apply(L,o(C.map(function(z){return(I.added?"+":"-")+z}))),I.added?T+=C.length:P+=C.length}else{if(S)if(C.length<=h.context*2&&w<A.length-2){var V;(V=E).push.apply(V,o(m(C)))}else{var b,D=Math.min(C.length,h.context);(b=E).push.apply(b,o(m(C.slice(0,D))));var U={oldStart:S,oldLines:P-S+D,newStart:R,newLines:T-R+D,lines:E};if(w>=A.length-2&&C.length<=h.context){var H=/\n$/.test(d),k=/\n$/.test(u);C.length==0&&!H?E.splice(U.oldLines,0,"\\ No newline at end of file"):(!H||!k)&&E.push("\\ No newline at end of file")}g.push(U),S=0,R=0,E=[]}P+=C.length,T+=C.length}},y=0;y<A.length;y++)f(y);return{oldFileName:l,newFileName:c,oldHeader:p,newHeader:_,hunks:g}}function a(l,c,d,u,p,_,h){var A=i(l,c,d,u,p,_,h),m=[];l==c&&m.push("Index: "+l),m.push("==================================================================="),m.push("--- "+A.oldFileName+(typeof A.oldHeader>"u"?"":"	"+A.oldHeader)),m.push("+++ "+A.newFileName+(typeof A.newHeader>"u"?"":"	"+A.newHeader));for(var g=0;g<A.hunks.length;g++){var S=A.hunks[g];m.push("@@ -"+S.oldStart+","+S.oldLines+" +"+S.newStart+","+S.newLines+" @@"),m.push.apply(m,S.lines)}return m.join(`
`)+`
`}function s(l,c,d,u,p,_){return a(l,l,c,d,u,p,_)}},function(t,e){"use strict";e.__esModule=!0,e.arrayEqual=r,e.arrayStartsWith=n;function r(o,i){return o.length!==i.length?!1:n(o,i)}function n(o,i){if(i.length>o.length)return!1;for(var a=0;a<i.length;a++)if(i[a]!==o[a])return!1;return!0}},function(t,e){"use strict";e.__esModule=!0,e.convertChangesToDMP=r;function r(n){for(var o=[],i=void 0,a=void 0,s=0;s<n.length;s++)i=n[s],i.added?a=1:i.removed?a=-1:a=0,o.push([a,i.value]);return o}},function(t,e){"use strict";e.__esModule=!0,e.convertChangesToXML=r;function r(o){for(var i=[],a=0;a<o.length;a++){var s=o[a];s.added?i.push("<ins>"):s.removed&&i.push("<del>"),i.push(n(s.value)),s.added?i.push("</ins>"):s.removed&&i.push("</del>")}return i.join("")}function n(o){var i=o;return i=i.replace(/&/g,"&amp;"),i=i.replace(/</g,"&lt;"),i=i.replace(/>/g,"&gt;"),i=i.replace(/"/g,"&quot;"),i}}])})});var aF=hc(Hd());var a_=class{_statsigDelegate;setDelegate(e){this._statsigDelegate=e}clearDelegate(){this._statsigDelegate=void 0}getDynamicConfigBoolean(e,r,n){return this._statsigDelegate?this._statsigDelegate.getDynamicConfigBoolean(e,r,n):n}getDynamicConfigNumber(e,r,n){return this._statsigDelegate?this._statsigDelegate.getDynamicConfigNumber(e,r,n):n}getDynamicConfigString(e,r,n){return this._statsigDelegate?this._statsigDelegate.getDynamicConfigString(e,r,n):n}getExperimentBoolean(e,r,n){return this._statsigDelegate?this._statsigDelegate.getExperimentBoolean(e,r,n):n}getExperimentNumber(e,r,n){return this._statsigDelegate?this._statsigDelegate.getExperimentNumber(e,r,n):n}getExperimentString(e,r,n){return this._statsigDelegate?this._statsigDelegate.getExperimentString(e,r,n):n}getFeatureGate(e){return this._statsigDelegate?this._statsigDelegate.getFeatureGate(e):!1}updateFeatureGateForTesting(e,r){this._statsigDelegate&&this._statsigDelegate.updateFeatureGateForTesting(e,r)}clearFeatureGatesForTesting(){this._statsigDelegate&&this._statsigDelegate.clearFeatureGatesForTesting()}setInRenderServerForViewerTests(){this._statsigDelegate&&this._statsigDelegate.setInRenderServerForViewerTests()}updateExperimentForTesting(e,r,n){this._statsigDelegate&&this._statsigDelegate.updateExperimentForTesting(e,r,n)}clearExperimentsForTesting(){this._statsigDelegate&&this._statsigDelegate.clearExperimentsForTesting()}};var Br=new a_;var Ir;(e=>{function t(r,n,o){return r<n?n:r>o?o:r}e.Math_clamp=t})(Ir||(Ir={}));var fc=t=>t===(t|0);var s_;(n=>{function t(i,a){let s=0;switch(a){case 0:{for(let l of i)l<128?s=s+1:l<2048?s=s+2:l<65536?s=s+3:s=s+4;break}case 1:{for(let l of i)l<65536?s=s+1:s=s+2;break}case 2:{s=i.length;break}}return s}n.codeUnitCountForCodePoints=t;let e;(l=>(l[l.UTF8=0]="UTF8",l[l.UTF16=1]="UTF16",l[l.UTF32=2]="UTF32"))(e=n.Encoding||(n.Encoding={}));let o=class o{reset(a,s){return this.value=a,this.index=s,this.stop=a.length,this}countCodePointsUntil(a){let s=0;for(;this.index<a&&this.nextCodePoint()>=0;)s=s+1;return s}previousCodePoint(){if(this.index<=0)return-1;let a=this.value.charCodeAt(this.index=this.index-1);return(a&64512)!=56320?a:this.index<=0?-1:(this.value.charCodeAt(this.index=this.index-1)<<10)+a+-56613888}nextCodePoint(){if(this.index>=this.stop)return-1;let a=this.value.charCodeAt((this.index=this.index+1)+-1);if((a&64512)!=55296)return a;if(this.index>=this.stop)return-1;let s=this.value.charCodeAt((this.index=this.index+1)+-1);return(a<<10)+s+-56613888}constructor(){this.value="",this.index=0,this.stop=0}};o.INSTANCE=new o;let r=o;n.StringIterator=o})(s_||(s_={}));var pe=class{static equals(e,r){return e==null!=(r==null)?!1:e==null?!0:e.value==r.value}constructor(e){this.value=e}},BE=1e5;function Wr(t,e){if(e!=t,e.length<BE){t.push(...e);return}for(let r of e)t.push(r)}function GE(t,e,r){if(r!=t,r.length<BE){t.splice(e,0,...r);return}for(let n of r)t.splice(e,0,n),e=e+1}var ie;(c=>{function t(d){d.length!=0,d.pop()}c.List_removeLast=t;function e(d){let u=0;for(let p=0,_=d.length;p<_;p=p+1){let h=!1,A=d[p];for(let m=0;m<p;m=m+1)if(A==d[m]){h=!0;break}h||(u<p&&(d[u]=d[p]),u=u+1)}for(;u<d.length;)t(d)}c.List_removeDuplicates=e;function r(d){return d.length!=0,d[d.length-1]}c.List_last=r;function n(d,u){d.indexOf(u)==-1&&d.push(u)}c.List_appendOne=n;function o(d,u){let p=d.indexOf(u);p>=0&&d.splice(p,1)}c.List_removeOne=o;function i(d,u){let p=0;for(let _=0,h=d.length;_<h;_=_+1)u(d[_])||(p<_&&(d[p]=d[_]),p=p+1);for(;p<d.length;)t(d)}c.List_removeIf=i;function a(d,u){if(d.length!=u.length)return!1;for(let p=0,_=d.length;p<_;p=p+1)if(d[p]!=u[p])return!1;return!0}c.List_equals=a;function s(d,u){let p=d.slice();return p.push(u),p}c.List_cloneAndAppend=s;function l(d,u,p){if(d==null!=(u==null))return!1;if(d==null)return!0;if(d.length==u.length){for(let _=0,h=d.length;_<h;_=_+1)if(!p(d[_],u[_]))return!1;return!0}return!1}c.List_equalsWithComparison=l})(ie||(ie={}));var Qe;(n=>{function t(o,i,a){let s=o.get(i);return s!==void 0?s:a}n.StringMap_get=t;function e(o,i){o.forEach((a,s)=>{i(s,a)})}n.StringMap_each=e;function r(o){let i={};return e(o,(a,s)=>{i[a]=s}),i}n.StringMap_toJSObject=r})(Qe||(Qe={}));var Xt;(r=>{function t(n,o,i){let a=n.get(o);return a!==void 0?a:i}r.IntMap_get=t;function e(n,o){n.forEach((i,a)=>{o(a,i)})}r.IntMap_each=e})(Xt||(Xt={}));var Ft;(r=>{function t(n,o){return(o<n?1:0)-(o>n?1:0)}r.int_compare=t;function e(n,o){return n%o|0}r.int_remainder=e})(Ft||(Ft={}));var xt;(n=>{function t(o,i){return(i<o?1:0)-(i>o?1:0)}n.double_compare=t;function e(o,i,a){return o*(1-a)+i*a}n.double_lerp=e;function r(o,i,a){return Math.min(Math.max(o,i),a)}n.double_clamp=r})(xt||(xt={}));var pi;(i=>{function t(a){let s="";for(let l of a)s+=o(l);return s}i.string_fromCodePoints=t;function e(a,s){return(s<a|0)-(s>a|0)}i.string_compare=e;function r(a){let s="";for(let l of a)s+=String.fromCharCode(l);return s}i.string_fromCodeUnits=r;function n(a){let s=[],l=s_.StringIterator.INSTANCE;for(l.reset(a,0);;){let c=l.nextCodePoint();if(c<0)return s;s.push(c)}}i.string_codePoints=n;function o(a){return a<65536?String.fromCharCode(a):String.fromCharCode((a-65536>>10)+55296)+String.fromCharCode((a-65536&1023)+56320)}i.string_fromCodePoint=o})(pi||(pi={}));var zd=3;var UE;(function(t){t[t.INVALID=0]="INVALID",t[t.TEST_SETUP=1]="TEST_SETUP",t[t.USER=2]="USER",t[t.PLUGIN=3]="PLUGIN",t[t.SYSTEM=4]="SYSTEM",t[t.REST_API=5]="REST_API",t[t.ONBOARDING=6]="ONBOARDING",t[t.AUTOSAVE=7]="AUTOSAVE",t[t.AI=8]="AI"})(UE||(UE={}));var VE;(function(t){t[t.IN_CUBIC=0]="IN_CUBIC",t[t.OUT_CUBIC=1]="OUT_CUBIC",t[t.INOUT_CUBIC=2]="INOUT_CUBIC",t[t.LINEAR=3]="LINEAR",t[t.IN_BACK_CUBIC=4]="IN_BACK_CUBIC",t[t.OUT_BACK_CUBIC=5]="OUT_BACK_CUBIC",t[t.INOUT_BACK_CUBIC=6]="INOUT_BACK_CUBIC",t[t.CUSTOM_CUBIC=7]="CUSTOM_CUBIC",t[t.SPRING=8]="SPRING",t[t.GENTLE_SPRING=9]="GENTLE_SPRING",t[t.CUSTOM_SPRING=10]="CUSTOM_SPRING",t[t.SPRING_PRESET_ONE=11]="SPRING_PRESET_ONE",t[t.SPRING_PRESET_TWO=12]="SPRING_PRESET_TWO",t[t.SPRING_PRESET_THREE=13]="SPRING_PRESET_THREE"})(VE||(VE={}));var kE;(function(t){t[t.LINEAR=0]="LINEAR",t[t.BEZIER=1]="BEZIER",t[t.OSCILLATION=2]="OSCILLATION",t[t.SPRING=3]="SPRING"})(kE||(kE={}));var HE;(function(t){t[t.SELF=0]="SELF",t[t.DESIGN=1]="DESIGN"})(HE||(HE={}));var zE;(function(t){t[t.NONE=0]="NONE",t[t.PRIMARY=1]="PRIMARY",t[t.SECONDARY=2]="SECONDARY"})(zE||(zE={}));var WE;(function(t){t[t.NONE=0]="NONE",t[t.START=1]="START",t[t.END=2]="END"})(WE||(WE={}));var KE;(function(t){t[t.SYNCED=0]="SYNCED",t[t.OFFLINE=1]="OFFLINE",t[t.SESSION_START=2]="SESSION_START",t[t.FORCED=3]="FORCED",t[t.LIMBOED_CHANGES=4]="LIMBOED_CHANGES"})(KE||(KE={}));var YE;(function(t){t[t.TEXT_MATCH=0]="TEXT_MATCH",t[t.LAYER_MATCH=1]="LAYER_MATCH",t[t.PAGE_MATCH=2]="PAGE_MATCH"})(YE||(YE={}));var QE;(function(t){t[t.TEXT=0]="TEXT",t[t.FRAME_OR_GROUP=1]="FRAME_OR_GROUP",t[t.COMPONENT=2]="COMPONENT",t[t.INSTANCE=3]="INSTANCE",t[t.IMAGE=4]="IMAGE",t[t.SHAPE=5]="SHAPE",t[t.OTHER=6]="OTHER"})(QE||(QE={}));var qE;(function(t){t[t.FIND=0]="FIND",t[t.REPLACE=1]="REPLACE"})(qE||(qE={}));var XE;(function(t){t[t.ACTIVE_PAGE=0]="ACTIVE_PAGE",t[t.ALL_PAGES=1]="ALL_PAGES"})(XE||(XE={}));var ZE;(function(t){t[t.ONLY_ACTIVE=0]="ONLY_ACTIVE",t[t.ALL=1]="ALL"})(ZE||(ZE={}));var JE;(function(t){t[t.NONE=0]="NONE",t[t.UPPER_FIRST=1]="UPPER_FIRST",t[t.UPPER_ALL=2]="UPPER_ALL"})(JE||(JE={}));var jE;(function(t){t[t.NONE=0]="NONE",t[t.SELECT_ACTIVE=1]="SELECT_ACTIVE"})(jE||(jE={}));var $E;(function(t){t[t.ABOVE=0]="ABOVE",t[t.BELOW=1]="BELOW",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"})($E||($E={}));var eI;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.TEXT_AUTOSUGGEST=1]="TEXT_AUTOSUGGEST",t[t.DESIGN_TO_CODE=2]="DESIGN_TO_CODE",t[t.DEV_MODE_FOCUS_VIEW=3]="DEV_MODE_FOCUS_VIEW",t[t.GLOBAL_DEBUGGING=4]="GLOBAL_DEBUGGING"})(eI||(eI={}));var tI;(function(t){t[t.CLICK=0]="CLICK",t[t.COPY_PASTE=1]="COPY_PASTE",t[t.COPY_PASTE_DIFFERENT_FILE=2]="COPY_PASTE_DIFFERENT_FILE",t[t.DLT_DRAG_DROP=3]="DLT_DRAG_DROP",t[t.SHAPES_SIDEBAR_CLICK=4]="SHAPES_SIDEBAR_CLICK",t[t.SHAPES_SIDEBAR_DRAG_DROP=5]="SHAPES_SIDEBAR_DRAG_DROP",t[t.DUPLICATION=6]="DUPLICATION",t[t.LIBRARY_DRAG_AND_DROP=7]="LIBRARY_DRAG_AND_DROP",t[t.PLAYGROUND=8]="PLAYGROUND",t[t.SWAPPING_FROM_LIBRARY_DRAG_AND_DROP=9]="SWAPPING_FROM_LIBRARY_DRAG_AND_DROP",t[t.SWAPPING_FROM_PROPERTIES_PANEL=10]="SWAPPING_FROM_PROPERTIES_PANEL",t[t.LEFT_PANEL=11]="LEFT_PANEL",t[t.CMS_PROPERTIES_PANEL=12]="CMS_PROPERTIES_PANEL",t[t.CMS_CONNECT_MODE=13]="CMS_CONNECT_MODE",t[t.UNKNOWN=14]="UNKNOWN"})(tI||(tI={}));var rI;(function(t){t[t.IDLE=0]="IDLE",t[t.COLLECTION_SELECTED=1]="COLLECTION_SELECTED",t[t.FIELD_SELECTED=2]="FIELD_SELECTED"})(rI||(rI={}));var nI;(function(t){t[t.TEXT=0]="TEXT",t[t.IMAGE=1]="IMAGE"})(nI||(nI={}));var oI;(function(t){t[t.CUSTOM=0]="CUSTOM",t[t.TWITTER_POST=1]="TWITTER_POST",t[t.LINKEDIN_POST=2]="LINKEDIN_POST",t[t.INSTA_POST_SQUARE=3]="INSTA_POST_SQUARE",t[t.INSTA_POST_PORTRAIT=4]="INSTA_POST_PORTRAIT",t[t.INSTA_STORY=5]="INSTA_STORY",t[t.INSTA_AD=6]="INSTA_AD",t[t.FACEBOOK_POST=7]="FACEBOOK_POST",t[t.FACEBOOK_COVER_PHOTO=8]="FACEBOOK_COVER_PHOTO",t[t.FACEBOOK_EVENT_COVER=9]="FACEBOOK_EVENT_COVER",t[t.FACEBOOK_AD_PORTRAIT=10]="FACEBOOK_AD_PORTRAIT",t[t.FACEBOOK_AD_SQUARE=11]="FACEBOOK_AD_SQUARE",t[t.PINTEREST_AD_PIN=12]="PINTEREST_AD_PIN",t[t.TWITTER_BANNER=13]="TWITTER_BANNER",t[t.LINKEDIN_POST_SQUARE=14]="LINKEDIN_POST_SQUARE",t[t.LINKEDIN_POST_PORTRAIT=15]="LINKEDIN_POST_PORTRAIT",t[t.LINKEDIN_POST_LANDSCAPE=16]="LINKEDIN_POST_LANDSCAPE",t[t.LINKEDIN_PROFILE_BANNER=17]="LINKEDIN_PROFILE_BANNER",t[t.LINKEDIN_ARTICLE_BANNER=18]="LINKEDIN_ARTICLE_BANNER",t[t.LINKEDIN_AD_LANDSCAPE=19]="LINKEDIN_AD_LANDSCAPE",t[t.LINKEDIN_AD_SQUARE=20]="LINKEDIN_AD_SQUARE",t[t.LINKEDIN_AD_VERTICAL=21]="LINKEDIN_AD_VERTICAL",t[t.YOUTUBE_THUMBNAIL=22]="YOUTUBE_THUMBNAIL",t[t.YOUTUBE_BANNER=23]="YOUTUBE_BANNER",t[t.YOUTUBE_AD=24]="YOUTUBE_AD",t[t.TWITCH_BANNER=25]="TWITCH_BANNER",t[t.GOOGLE_LEADERBOARD_AD=26]="GOOGLE_LEADERBOARD_AD",t[t.GOOGLE_LARGE_AD=27]="GOOGLE_LARGE_AD",t[t.GOOGLE_MED_AD=28]="GOOGLE_MED_AD",t[t.GOOGLE_MOBILE_BANNER_AD=29]="GOOGLE_MOBILE_BANNER_AD",t[t.GOOGLE_SKYSCRAPER_AD=30]="GOOGLE_SKYSCRAPER_AD",t[t.CARD_HORIZONTAL=31]="CARD_HORIZONTAL",t[t.CARD_VERTICAL=32]="CARD_VERTICAL",t[t.PRINT_US_LETTER=33]="PRINT_US_LETTER",t[t.POSTER=34]="POSTER",t[t.BANNER_STANDARD=35]="BANNER_STANDARD",t[t.BANNER_WIDE=36]="BANNER_WIDE",t[t.BANNER_ULTRAWIDE=37]="BANNER_ULTRAWIDE",t[t.NAME_TAG_PORTRAIT=38]="NAME_TAG_PORTRAIT",t[t.NAME_TAG_LANDSCAPE=39]="NAME_TAG_LANDSCAPE",t[t.INSTA_REEL_COVER=40]="INSTA_REEL_COVER",t[t.ZOOM_BACKGROUND=41]="ZOOM_BACKGROUND"})(oI||(oI={}));var iI;(function(t){t[t.LIVE_FILE=0]="LIVE_FILE",t[t.HISTORY=1]="HISTORY",t[t.DETACHED_COMPONENTS=2]="DETACHED_COMPONENTS",t[t.PLAYGROUND=3]="PLAYGROUND",t[t.FIRST_DRAFT=4]="FIRST_DRAFT",t[t.HUB_FILE_EMBED=5]="HUB_FILE_EMBED",t[t.HUB_FILE_MOBILE=6]="HUB_FILE_MOBILE",t[t.FIGMASCOPE=7]="FIGMASCOPE",t[t.MOBILE=8]="MOBILE",t[t.COMPARE_CHANGES=9]="COMPARE_CHANGES",t[t.GARBAGE_COLLECTION_RESTORER=10]="GARBAGE_COLLECTION_RESTORER",t[t.TEMPLATE_COMMIT=11]="TEMPLATE_COMMIT",t[t.TEMPLATE_PREVIEW=12]="TEMPLATE_PREVIEW",t[t.FAKE_CLIPBOARD=13]="FAKE_CLIPBOARD",t[t.DEV_MODE_TYPOGRAPHY_PREVIEW=14]="DEV_MODE_TYPOGRAPHY_PREVIEW",t[t.SLIDE_THEME_STYLE_PREVIEW=15]="SLIDE_THEME_STYLE_PREVIEW",t[t.STYLE_SELECTION_PROPERTIES=16]="STYLE_SELECTION_PROPERTIES",t[t.EXPORTER_PAINT_ICON_RENDERING=17]="EXPORTER_PAINT_ICON_RENDERING",t[t.STYLE_RENDERING=18]="STYLE_RENDERING",t[t.AUTO_SUGGEST=19]="AUTO_SUGGEST",t[t.LINTER=20]="LINTER"})(iI||(iI={}));var te;(function(t){t[t.REDUX=0]="REDUX",t[t.PLUGIN=1]="PLUGIN",t[t.PROTOTYPE_LIB=2]="PROTOTYPE_LIB"})(te||(te={}));var aI;(function(t){t[t.NONE=0]="NONE",t[t.DOCUMENT=1]="DOCUMENT",t[t.CANVAS=2]="CANVAS",t[t.GROUP_DEPRECATED=3]="GROUP_DEPRECATED",t[t.FRAME=4]="FRAME",t[t.SYMBOL=5]="SYMBOL",t[t.INSTANCE=6]="INSTANCE",t[t.STICKY=7]="STICKY",t[t.SHAPE_WITH_TEXT=8]="SHAPE_WITH_TEXT",t[t.CONNECTOR=9]="CONNECTOR",t[t.CODE_BLOCK=10]="CODE_BLOCK",t[t.WIDGET=11]="WIDGET",t[t.STAMP=12]="STAMP",t[t.MEDIA=13]="MEDIA",t[t.SECTION=14]="SECTION",t[t.SECTION_OVERLAY=15]="SECTION_OVERLAY",t[t.TABLE=16]="TABLE",t[t.TABLE_CELL=17]="TABLE_CELL",t[t.SLIDE=18]="SLIDE",t[t.CANVAS_GRID=19]="CANVAS_GRID",t[t.CANVAS_ROW=20]="CANVAS_ROW",t[t.MODULE=21]="MODULE",t[t.VECTOR_OPERATION=22]="VECTOR_OPERATION",t[t.VECTOR=23]="VECTOR",t[t.HIGHLIGHT=24]="HIGHLIGHT",t[t.STAR=25]="STAR",t[t.LINE=26]="LINE",t[t.ELLIPSE=27]="ELLIPSE",t[t.RECTANGLE=28]="RECTANGLE",t[t.REGULAR_POLYGON=29]="REGULAR_POLYGON",t[t.ROUNDED_RECTANGLE=30]="ROUNDED_RECTANGLE",t[t.TEXT=31]="TEXT",t[t.SLICE=32]="SLICE",t[t.WASHI_TAPE=33]="WASHI_TAPE",t[t.VARIABLE=34]="VARIABLE",t[t.VARIABLE_SET=35]="VARIABLE_SET",t[t.ASSISTED_LAYOUT_DEPRECATED=36]="ASSISTED_LAYOUT_DEPRECATED",t[t.INTERACTIVE_SLIDE_ELEMENT=37]="INTERACTIVE_SLIDE_ELEMENT",t[t.VARIABLE_OVERRIDE=38]="VARIABLE_OVERRIDE",t[t.RESPONSIVE_SET=39]="RESPONSIVE_SET",t[t.CODE_COMPONENT=40]="CODE_COMPONENT",t[t.TEXT_PATH=41]="TEXT_PATH",t[t.CODE_INSTANCE=42]="CODE_INSTANCE",t[t.CODE_LIBRARY=43]="CODE_LIBRARY",t[t.CODE_FILE=44]="CODE_FILE",t[t.CODE_LAYER=45]="CODE_LAYER",t[t.BRUSH=46]="BRUSH",t[t.MANAGED_STRING=47]="MANAGED_STRING",t[t.TRANSFORM=48]="TRANSFORM",t[t.CMS_RICH_TEXT=49]="CMS_RICH_TEXT",t[t.REPEATER=50]="REPEATER",t[t.JSX=51]="JSX",t[t.EMBEDDED_PROTOTYPE=52]="EMBEDDED_PROTOTYPE",t[t.REACT_FIBER=53]="REACT_FIBER"})(aI||(aI={}));var sI;(function(t){t[t.IGNORE=0]="IGNORE",t[t.TRACK=1]="TRACK"})(sI||(sI={}));var lI;(function(t){t[t.NONE=0]="NONE",t[t.BUILD=1]="BUILD",t[t.COMPLETED=2]="COMPLETED"})(lI||(lI={}));var cI;(function(t){t[t.NONE=0]="NONE",t[t.AUTO=1]="AUTO",t[t.TOP=2]="TOP",t[t.LEFT=3]="LEFT",t[t.BOTTOM=4]="BOTTOM",t[t.RIGHT=5]="RIGHT",t[t.CENTER=6]="CENTER",t[t.EDGE=7]="EDGE",t[t.ABSOLUTE=8]="ABSOLUTE"})(cI||(cI={}));var dI;(function(t){t[t.FILL=0]="FILL",t[t.STROKE=1]="STROKE",t[t.WIDTH=2]="WIDTH",t[t.HEIGHT=3]="HEIGHT",t[t.MIN_WIDTH=4]="MIN_WIDTH",t[t.MIN_HEIGHT=5]="MIN_HEIGHT",t[t.MAX_WIDTH=6]="MAX_WIDTH",t[t.MAX_HEIGHT=7]="MAX_HEIGHT",t[t.STROKE_WIDTH=8]="STROKE_WIDTH",t[t.CORNER_RADIUS=9]="CORNER_RADIUS",t[t.EFFECT=10]="EFFECT",t[t.TEXT_STYLE=11]="TEXT_STYLE",t[t.TEXT_ALIGN_HORIZONTAL=12]="TEXT_ALIGN_HORIZONTAL",t[t.FONT_FAMILY=13]="FONT_FAMILY",t[t.FONT_SIZE=14]="FONT_SIZE",t[t.FONT_WEIGHT=15]="FONT_WEIGHT",t[t.LINE_HEIGHT=16]="LINE_HEIGHT",t[t.LETTER_SPACING=17]="LETTER_SPACING",t[t.STACK_SPACING=18]="STACK_SPACING",t[t.STACK_PADDING=19]="STACK_PADDING",t[t.STACK_MODE=20]="STACK_MODE",t[t.STACK_ALIGNMENT=21]="STACK_ALIGNMENT",t[t.OPACITY=22]="OPACITY",t[t.COMPONENT=23]="COMPONENT",t[t.FONT_STYLE=24]="FONT_STYLE"})(dI||(dI={}));var uI;(function(t){t[t.YELLOW=0]="YELLOW",t[t.ORANGE=1]="ORANGE",t[t.RED=2]="RED",t[t.PINK=3]="PINK",t[t.VIOLET=4]="VIOLET",t[t.BLUE=5]="BLUE",t[t.TEAL=6]="TEAL",t[t.GREEN=7]="GREEN"})(uI||(uI={}));var pI;(function(t){t[t.NONE=0]="NONE",t[t.ACCESSIBILITY=1]="ACCESSIBILITY",t[t.BEHAVIOR=2]="BEHAVIOR",t[t.CONTENT=3]="CONTENT",t[t.DEVELOPMENT=4]="DEVELOPMENT",t[t.INTERACTION=5]="INTERACTION"})(pI||(pI={}));var _I;(function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"})(_I||(_I={}));var hI;(function(t){t[t.LOCAL=0]="LOCAL",t[t.LIBRARY=1]="LIBRARY"})(hI||(hI={}));var mI;(function(t){t[t.NONE=0]="NONE",t[t.BUILDING_BLOCK=1]="BUILDING_BLOCK",t[t.GROUPED_COMPONENT=2]="GROUPED_COMPONENT"})(mI||(mI={}));var fI;(function(t){t[t.COMPONENT=0]="COMPONENT",t[t.STATE_GROUP=1]="STATE_GROUP"})(fI||(fI={}));var gI;(function(t){t[t.NONE=0]="NONE",t[t.CAP_HEIGHT=1]="CAP_HEIGHT"})(gI||(gI={}));var SI;(function(t){t[t.POLL=0]="POLL",t[t.EMBED=1]="EMBED",t[t.FACEPILE=2]="FACEPILE",t[t.ALIGNMENT=3]="ALIGNMENT",t[t.YOUTUBE=4]="YOUTUBE"})(SI||(SI={}));var AI;(function(t){t[t.RAW=0]="RAW",t[t.PIXELS=1]="PIXELS",t[t.PERCENT=2]="PERCENT"})(AI||(AI={}));var l_;(function(t){t[t.FILL=0]="FILL",t[t.STROKE=1]="STROKE",t[t.BACKGROUND__NO_LONGER_USED=2]="BACKGROUND__NO_LONGER_USED",t[t.TEXT=3]="TEXT",t[t.EFFECT=4]="EFFECT",t[t.GRID=5]="GRID",t[t.DEPRECATED_STROKE=6]="DEPRECATED_STROKE",t[t.NOT_SUPPORTED=7]="NOT_SUPPORTED"})(l_||(l_={}));var TI;(function(t){t[t.TOGGLE_BOLD=0]="TOGGLE_BOLD",t[t.INCREASE_BOLD=1]="INCREASE_BOLD",t[t.DECREASE_BOLD=2]="DECREASE_BOLD",t[t.TOGGLE_ITALIC=3]="TOGGLE_ITALIC",t[t.TOGGLE_UNDERLINE=4]="TOGGLE_UNDERLINE",t[t.TOGGLE_STRIKETHROUGH=5]="TOGGLE_STRIKETHROUGH",t[t.REMOVE_DECORATION=6]="REMOVE_DECORATION",t[t.SET_ORIGINAL_CASE=7]="SET_ORIGINAL_CASE",t[t.SET_UPPER_CASE=8]="SET_UPPER_CASE",t[t.SET_LOWER_CASE=9]="SET_LOWER_CASE",t[t.SET_TITLE_CASE=10]="SET_TITLE_CASE",t[t.INCREASE_LETTER_SPACING=11]="INCREASE_LETTER_SPACING",t[t.DECREASE_LETTER_SPACING=12]="DECREASE_LETTER_SPACING",t[t.INCREASE_LINE_HEIGHT=13]="INCREASE_LINE_HEIGHT",t[t.DECREASE_LINE_HEIGHT=14]="DECREASE_LINE_HEIGHT"})(TI||(TI={}));var EI;(function(t){t[t.SET_BOLD=0]="SET_BOLD",t[t.SET_UNBOLD=1]="SET_UNBOLD",t[t.INCREASE_BOLD=2]="INCREASE_BOLD",t[t.DECREASE_BOLD=3]="DECREASE_BOLD",t[t.SET_ITALIC=4]="SET_ITALIC",t[t.SET_UNITALIC=5]="SET_UNITALIC",t[t.SET_UNDERLINE=6]="SET_UNDERLINE",t[t.SET_STRIKETHROUGH=7]="SET_STRIKETHROUGH",t[t.REMOVE_DECORATION=8]="REMOVE_DECORATION",t[t.SET_ORIGINAL_CASE=9]="SET_ORIGINAL_CASE",t[t.SET_UPPER_CASE=10]="SET_UPPER_CASE",t[t.SET_LOWER_CASE=11]="SET_LOWER_CASE",t[t.SET_TITLE_CASE=12]="SET_TITLE_CASE",t[t.INCREASE_LETTER_SPACING=13]="INCREASE_LETTER_SPACING",t[t.DECREASE_LETTER_SPACING=14]="DECREASE_LETTER_SPACING",t[t.INCREASE_LINE_HEIGHT=15]="INCREASE_LINE_HEIGHT",t[t.DECREASE_LINE_HEIGHT=16]="DECREASE_LINE_HEIGHT"})(EI||(EI={}));var II;(function(t){t[t.NONE=0]="NONE",t[t.CREATED=1]="CREATED",t[t.EDITED=2]="EDITED",t[t.REMOVED=3]="REMOVED",t[t.INDIRECTLY_EDITED=4]="INDIRECTLY_EDITED",t[t.AFFECTED=5]="AFFECTED",t[t.LIBRARY_UPDATES=6]="LIBRARY_UPDATES"})(II||(II={}));var RI;(function(t){t[t.ALL_SCOPES=0]="ALL_SCOPES",t[t.TEXT_CONTENT=1]="TEXT_CONTENT",t[t.CORNER_RADIUS=2]="CORNER_RADIUS",t[t.WIDTH_HEIGHT=3]="WIDTH_HEIGHT",t[t.GAP=4]="GAP",t[t.ALL_FILLS=5]="ALL_FILLS",t[t.FRAME_FILL=6]="FRAME_FILL",t[t.SHAPE_FILL=7]="SHAPE_FILL",t[t.TEXT_FILL=8]="TEXT_FILL",t[t.STROKE=9]="STROKE",t[t.STROKE_FLOAT=10]="STROKE_FLOAT",t[t.EFFECT_FLOAT=11]="EFFECT_FLOAT",t[t.EFFECT_COLOR=12]="EFFECT_COLOR",t[t.OPACITY=13]="OPACITY",t[t.FONT_STYLE=14]="FONT_STYLE",t[t.FONT_FAMILY=15]="FONT_FAMILY",t[t.FONT_SIZE=16]="FONT_SIZE",t[t.LINE_HEIGHT=17]="LINE_HEIGHT",t[t.LETTER_SPACING=18]="LETTER_SPACING",t[t.PARAGRAPH_SPACING=19]="PARAGRAPH_SPACING",t[t.PARAGRAPH_INDENT=20]="PARAGRAPH_INDENT",t[t.FONT_VARIATIONS=21]="FONT_VARIATIONS"})(RI||(RI={}));var yI;(function(t){t[t.WEB=0]="WEB",t[t.ANDROID=1]="ANDROID",t[t.iOS=2]="iOS"})(yI||(yI={}));var vI;(function(t){t[t.DESIGN_LAYOUT=0]="DESIGN_LAYOUT",t[t.WHITEBOARD_LAYOUT=1]="WHITEBOARD_LAYOUT",t[t.VECTOR=2]="VECTOR",t[t.TEXT=3]="TEXT",t[t.RASTER=4]="RASTER",t[t.GRADIENT=5]="GRADIENT",t[t.PLACE_IMAGE=6]="PLACE_IMAGE",t[t.HISTORY=7]="HISTORY",t[t.PREVIEW=8]="PREVIEW",t[t.COMMENTS=9]="COMMENTS",t[t.BRANCHING=10]="BRANCHING",t[t.DEV_HANDOFF=11]="DEV_HANDOFF",t[t.COMPARE_CHANGES=12]="COMPARE_CHANGES",t[t.LIBRARY=13]="LIBRARY",t[t.DEV_HANDOFF_HISTORY=14]="DEV_HANDOFF_HISTORY",t[t.SLIDE_LAYOUT=15]="SLIDE_LAYOUT",t[t.MAGIC_LINK=16]="MAGIC_LINK",t[t.BUZZ_LAYOUT=17]="BUZZ_LAYOUT",t[t.PROGRESSIVE_BLUR=18]="PROGRESSIVE_BLUR",t[t.COOPER_BULK_CREATE=19]="COOPER_BULK_CREATE",t[t.CMS_BINDING_CONSTRAINED=20]="CMS_BINDING_CONSTRAINED",t[t.SITES_LAYOUT=21]="SITES_LAYOUT"})(vI||(vI={}));var CI;(function(t){t[t.FORWARD=0]="FORWARD",t[t.REVERSE=1]="REVERSE"})(CI||(CI={}));var c_;(function(t){t[t.STRETCH=0]="STRETCH",t[t.SCATTER=1]="SCATTER"})(c_||(c_={}));var OI;(function(t){t[t.USER_MESSAGE=0]="USER_MESSAGE",t[t.ASSISTANT_MESSAGE=1]="ASSISTANT_MESSAGE",t[t.TOOL_MESSAGE=2]="TOOL_MESSAGE",t[t.SYSTEM_MESSAGE=3]="SYSTEM_MESSAGE"})(OI||(OI={}));var bI;(function(t){t[t.HEADING1=0]="HEADING1",t[t.HEADING2=1]="HEADING2",t[t.HEADING3=2]="HEADING3",t[t.HEADING4=3]="HEADING4",t[t.HEADING5=4]="HEADING5",t[t.HEADING6=5]="HEADING6",t[t.PARAGRAPH=6]="PARAGRAPH",t[t.LINK=7]="LINK",t[t.BLOCKQUOTE=8]="BLOCKQUOTE"})(bI||(bI={}));var NI;(function(t){t[t.INITIAL=0]="INITIAL",t[t.SNAPSHOTTING=1]="SNAPSHOTTING",t[t.OK=2]="OK",t[t.SNAPSHOT_ERROR=3]="SNAPSHOT_ERROR"})(NI||(NI={}));var PI;(function(t){t[t.USER=0]="USER",t[t.ASSISTANT=1]="ASSISTANT",t[t.TOOL=2]="TOOL",t[t.SYSTEM=3]="SYSTEM"})(PI||(PI={}));var FI;(function(t){t[t.INVALID=0]="INVALID",t[t.TEXT=1]="TEXT"})(FI||(FI={}));var DI;(function(t){t[t.FLEX=0]="FLEX",t[t.FIXED=1]="FIXED",t[t.HUG=2]="HUG"})(DI||(DI={}));var wI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.MERGE_IN_PROGRESS=1]="MERGE_IN_PROGRESS",t[t.PARSE_ERROR=2]="PARSE_ERROR",t[t.VERSION_MISMATCH=3]="VERSION_MISMATCH",t[t.INTERNAL_ERROR=4]="INTERNAL_ERROR"})(wI||(wI={}));var xI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.PARSE_ERROR=1]="PARSE_ERROR",t[t.VERSION_MISMATCH=2]="VERSION_MISMATCH",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR"})(xI||(xI={}));var LI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.NO_MERGE_IN_PROGRESS=1]="NO_MERGE_IN_PROGRESS",t[t.INTERNAL_ERROR=2]="INTERNAL_ERROR",t[t.MISSING_BACKING_SYMBOL=3]="MISSING_BACKING_SYMBOL",t[t.VERSION_MISMATCH=4]="VERSION_MISMATCH"})(LI||(LI={}));var MI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.NO_MERGE_IN_PROGRESS=1]="NO_MERGE_IN_PROGRESS",t[t.INVALID_INDEX=2]="INVALID_INDEX",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t[t.INVALID_STATE_TRANSITION=4]="INVALID_STATE_TRANSITION"})(MI||(MI={}));var BI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILURE=1]="FAILURE"})(BI||(BI={}));var GI;(function(t){t[t.SOURCE=0]="SOURCE",t[t.BRANCH=1]="BRANCH",t[t.COMPARE=2]="COMPARE"})(GI||(GI={}));var UI;(function(t){t[t.UPDATED_LIBRARY=0]="UPDATED_LIBRARY",t[t.CREATED=1]="CREATED",t[t.REMOVED=2]="REMOVED",t[t.UPDATED=3]="UPDATED",t[t.UNMODIFIED=4]="UNMODIFIED"})(UI||(UI={}));var VI;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.NO_MERGE_IN_PROGRESS=1]="NO_MERGE_IN_PROGRESS",t[t.UNABLE_TO_UNDO_CHANGES=2]="UNABLE_TO_UNDO_CHANGES",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR"})(VI||(VI={}));var kI;(function(t){t[t.BASIS_PARENT=0]="BASIS_PARENT",t[t.PARENT=1]="PARENT"})(kI||(kI={}));var HI;(function(t){t[t.PREVIEW=0]="PREVIEW",t[t.STAGE=1]="STAGE"})(HI||(HI={}));var zI;(function(t){t[t.GENERIC=0]="GENERIC",t[t.STATE_GROUP=1]="STATE_GROUP",t[t.VARIABLE_COLLECTION=2]="VARIABLE_COLLECTION"})(zI||(zI={}));var WI;(function(t){t[t.STYLE_ATTACH=0]="STYLE_ATTACH",t[t.STYLE_DETACH=1]="STYLE_DETACH",t[t.VARIABLE_ATTACH=2]="VARIABLE_ATTACH",t[t.VARIABLE_DETACH=3]="VARIABLE_DETACH",t[t.IGNORE=4]="IGNORE",t[t.NONE=5]="NONE"})(WI||(WI={}));var KI;(function(t){t[t.DUPLICATION=0]="DUPLICATION",t[t.COPY_PASTE_FROM_SAME_FILE=1]="COPY_PASTE_FROM_SAME_FILE",t[t.COPY_PASTE_FROM_DIFFERENT_FILE=2]="COPY_PASTE_FROM_DIFFERENT_FILE",t[t.SWAPPING_FROM_LIBRARY_DRAG_AND_DROP=3]="SWAPPING_FROM_LIBRARY_DRAG_AND_DROP",t[t.SWAPPING_FROM_PROPERTIES_PANEL=4]="SWAPPING_FROM_PROPERTIES_PANEL",t[t.LIBRARY_DRAG_AND_DROP=5]="LIBRARY_DRAG_AND_DROP",t[t.PLAYGROUND=6]="PLAYGROUND",t[t.VIA_NODE_INSERTION=7]="VIA_NODE_INSERTION",t[t.DIRECT=8]="DIRECT",t[t.UNKNOWN=9]="UNKNOWN"})(KI||(KI={}));var YI;(function(t){t[t.APPLE=0]="APPLE",t[t.NOTO=1]="NOTO"})(YI||(YI={}));var QI;(function(t){t[t.PNG=0]="PNG",t[t.SVG=1]="SVG",t[t.RASTERIZE=2]="RASTERIZE"})(QI||(QI={}));var qI;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.YES_WITHOUT_REORDER=2]="YES_WITHOUT_REORDER"})(qI||(qI={}));var XI;(function(t){t[t.SHAPES_SIDEBAR_REGULAR=0]="SHAPES_SIDEBAR_REGULAR",t[t.SHAPES_SIDEBAR_RECENTS=1]="SHAPES_SIDEBAR_RECENTS",t[t.OTHER=2]="OTHER",t[t.NONE=3]="NONE"})(XI||(XI={}));var ZI;(function(t){t[t.CURRENT_TAB=0]="CURRENT_TAB",t[t.NEW_TAB=1]="NEW_TAB"})(ZI||(ZI={}));var JI;(function(t){t[t.SEARCH=0]="SEARCH",t[t.PREFERENCES=1]="PREFERENCES",t[t.HIDE_UI=2]="HIDE_UI"})(JI||(JI={}));var jI;(function(t){t[t.COPY_PASTE=0]="COPY_PASTE",t[t.COMPONENT_IMPORT=1]="COMPONENT_IMPORT",t[t.STATE_GROUP_IMPORT=2]="STATE_GROUP_IMPORT",t[t.STYLE_IMPORT=3]="STYLE_IMPORT",t[t.BRANCH_MERGE=4]="BRANCH_MERGE",t[t.TEMPLATE_INSERTION=5]="TEMPLATE_INSERTION",t[t.VARIABLE_IMPORT=6]="VARIABLE_IMPORT",t[t.VARIABLE_SET_IMPORT=7]="VARIABLE_SET_IMPORT",t[t.PLAYGROUND_INSERT=8]="PLAYGROUND_INSERT",t[t.MODULE_IMPORT=9]="MODULE_IMPORT"})(jI||(jI={}));var $I;(function(t){t[t.SOLID=0]="SOLID",t[t.DASHED=1]="DASHED",t[t.NONE=2]="NONE"})($I||($I={}));var eR;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES"})(eR||(eR={}));var tR;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES"})(tR||(tR={}));var rR;(function(t){t[t.ACTIVE_SCENE=0]="ACTIVE_SCENE",t[t.PLAYGROUND_SCENE=1]="PLAYGROUND_SCENE",t[t.LINTER_SCENE=2]="LINTER_SCENE"})(rR||(rR={}));var nR;(function(t){t[t.NONE=0]="NONE",t[t.BLACK=1]="BLACK",t[t.GRAY_DARK=2]="GRAY_DARK",t[t.GRAY=3]="GRAY",t[t.GRAY_LIGHT=4]="GRAY_LIGHT",t[t.RED=5]="RED",t[t.RED_LIGHT=6]="RED_LIGHT",t[t.ORANGE=7]="ORANGE",t[t.ORANGE_LIGHT=8]="ORANGE_LIGHT",t[t.YELLOW=9]="YELLOW",t[t.YELLOW_LIGHT=10]="YELLOW_LIGHT",t[t.GREEN=11]="GREEN",t[t.GREEN_LIGHT=12]="GREEN_LIGHT",t[t.BLUE=13]="BLUE",t[t.BLUE_LIGHT=14]="BLUE_LIGHT",t[t.VIOLET=15]="VIOLET",t[t.VIOLET_LIGHT=16]="VIOLET_LIGHT",t[t.WHITE=17]="WHITE",t[t.PINK=18]="PINK",t[t.PINK_LIGHT=19]="PINK_LIGHT",t[t.INDIGO=20]="INDIGO",t[t.INDIGO_LIGHT=21]="INDIGO_LIGHT",t[t.COBALT=22]="COBALT",t[t.COBALT_LIGHT=23]="COBALT_LIGHT",t[t.TEAL=24]="TEAL",t[t.TEAL_LIGHT=25]="TEAL_LIGHT",t[t.OLIVE=26]="OLIVE",t[t.OLIVE_LIGHT=27]="OLIVE_LIGHT",t[t.STICKY_GRAY=28]="STICKY_GRAY",t[t.STICKY_GRAY_UI3=29]="STICKY_GRAY_UI3",t[t.STICKY_RED=30]="STICKY_RED",t[t.STICKY_ORANGE=31]="STICKY_ORANGE",t[t.STICKY_YELLOW=32]="STICKY_YELLOW",t[t.STICKY_GREEN=33]="STICKY_GREEN",t[t.STICKY_BLUE=34]="STICKY_BLUE",t[t.STICKY_VIOLET=35]="STICKY_VIOLET",t[t.STICKY_PINK=36]="STICKY_PINK",t[t.STICKY_GRAY_LIGHT=37]="STICKY_GRAY_LIGHT",t[t.STICKY_INDIGO=38]="STICKY_INDIGO",t[t.STICKY_COBALT=39]="STICKY_COBALT",t[t.STICKY_TEAL=40]="STICKY_TEAL",t[t.STICKY_OLIVE=41]="STICKY_OLIVE",t[t.HIGHLIGHT_GRAY=42]="HIGHLIGHT_GRAY",t[t.HIGHLIGHT_RED=43]="HIGHLIGHT_RED",t[t.HIGHLIGHT_YELLOW=44]="HIGHLIGHT_YELLOW",t[t.HIGHLIGHT_GREEN=45]="HIGHLIGHT_GREEN",t[t.HIGHLIGHT_BLUE=46]="HIGHLIGHT_BLUE",t[t.HIGHLIGHT_VIOLET=47]="HIGHLIGHT_VIOLET",t[t.HIGHLIGHT_ORANGE=48]="HIGHLIGHT_ORANGE",t[t.HIGHLIGHT_WHITE=49]="HIGHLIGHT_WHITE",t[t.CODE_BLOCK_DRACULA=50]="CODE_BLOCK_DRACULA",t[t.CODE_BLOCK_DUOTONE_LIGHT=51]="CODE_BLOCK_DUOTONE_LIGHT",t[t.CODE_BLOCK_DUOTONE_SEA=52]="CODE_BLOCK_DUOTONE_SEA",t[t.CODE_BLOCK_DUOTONE_SPACE=53]="CODE_BLOCK_DUOTONE_SPACE",t[t.CODE_BLOCK_DUOTONE_EARTH=54]="CODE_BLOCK_DUOTONE_EARTH",t[t.CODE_BLOCK_DUOTONE_FOREST=55]="CODE_BLOCK_DUOTONE_FOREST",t[t.CUSTOM=56]="CUSTOM"})(nR||(nR={}));var oR;(function(t){t[t.LAYERS=0]="LAYERS",t[t.ASSETS=1]="ASSETS",t[t.CODE=2]="CODE",t[t.CHAT=3]="CHAT"})(oR||(oR={}));var iR;(function(t){t[t.NEXT=0]="NEXT",t[t.PREVIOUS=1]="PREVIOUS",t[t.COMMIT=2]="COMMIT",t[t.CANCEL=3]="CANCEL",t[t.CLEAR=4]="CLEAR"})(iR||(iR={}));var aR;(function(t){t[t.VISIBLE=0]="VISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.TRANSPARENT_CUSTOM=2]="TRANSPARENT_CUSTOM",t[t.HIDDEN=3]="HIDDEN"})(aR||(aR={}));var sR;(function(t){t[t.COPY_TO_CLIPBOARD=0]="COPY_TO_CLIPBOARD",t[t.COMPOSE_EMAIL=1]="COMPOSE_EMAIL"})(sR||(sR={}));var lR;(function(t){t[t.PLACEHOLDER=1]="PLACEHOLDER",t[t.COMMENTS_A11Y=2]="COMMENTS_A11Y"})(lR||(lR={}));var cR;(function(t){t[t.RULER=0]="RULER",t[t.GUIDE=1]="GUIDE",t[t.BOTH=2]="BOTH"})(cR||(cR={}));var dR;(function(t){t[t.GENERIC=0]="GENERIC",t[t.SNAP=1]="SNAP",t[t.LEVEL=2]="LEVEL"})(dR||(dR={}));var uR;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(uR||(uR={}));var pR;(function(t){t[t.FIGMA=0]="FIGMA",t[t.SITE=1]="SITE"})(pR||(pR={}));var _R;(function(t){t[t.TRANSLATE_TEXT=0]="TRANSLATE_TEXT",t[t.REWRITE_TEXT=1]="REWRITE_TEXT",t[t.SHORTEN_TEXT=2]="SHORTEN_TEXT",t[t.FIRST_DRAFT=3]="FIRST_DRAFT",t[t.FIRST_DRAFT_MAKE_CHANGES=4]="FIRST_DRAFT_MAKE_CHANGES",t[t.FIRST_DRAFT_MAKE_KIT_DEBUG=5]="FIRST_DRAFT_MAKE_KIT_DEBUG",t[t.FIND_INSPIRATION=6]="FIND_INSPIRATION",t[t.REMOVE_BACKGROUND=7]="REMOVE_BACKGROUND",t[t.AUTO_RENAME_LAYERS=8]="AUTO_RENAME_LAYERS",t[t.GENERATE_IMAGE=9]="GENERATE_IMAGE",t[t.MAGIC_LINK=10]="MAGIC_LINK",t[t.CONTENT_FILL=11]="CONTENT_FILL",t[t.SLIDES_REWRITE_TEXT=12]="SLIDES_REWRITE_TEXT",t[t.ASSISTANT_CHAT=13]="ASSISTANT_CHAT",t[t.MAKE_EDITS=14]="MAKE_EDITS",t[t.UPSCALE_IMAGE=15]="UPSCALE_IMAGE",t[t.FIRST_DRAFT_FINE_TUNE=16]="FIRST_DRAFT_FINE_TUNE",t[t.EDIT_IMAGE=17]="EDIT_IMAGE"})(_R||(_R={}));var hR;(function(t){t[t.CONTEXT_MENU=0]="CONTEXT_MENU",t[t.QUICK_ACTIONS=1]="QUICK_ACTIONS",t[t.CREATE_COMPONENT=2]="CREATE_COMPONENT",t[t.CREATE_FRAME=3]="CREATE_FRAME",t[t.DRAW_FRAME_AROUND_NODES=4]="DRAW_FRAME_AROUND_NODES",t[t.STACK_SELECTION=5]="STACK_SELECTION",t[t.FIRST_DRAFT_LINT=6]="FIRST_DRAFT_LINT",t[t.EXPORT_FRAME=7]="EXPORT_FRAME",t[t.EXPORT_PICKER=8]="EXPORT_PICKER",t[t.MAGIC_LINK=9]="MAGIC_LINK",t[t.READY_FOR_DEV=10]="READY_FOR_DEV",t[t.LAYERS_PANEL_ACTION_ROW=11]="LAYERS_PANEL_ACTION_ROW",t[t.LAYERS_PANEL_OVERFLOW_MENU=12]="LAYERS_PANEL_OVERFLOW_MENU"})(hR||(hR={}));var mR;(function(t){t[t.CURRENT=0]="CURRENT",t[t.FIRST_DRAFT=1]="FIRST_DRAFT"})(mR||(mR={}));var fR;(function(t){t[t.EMPTY=0]="EMPTY",t[t.RESIZING_WIDTH_AND_HEIGHT=1]="RESIZING_WIDTH_AND_HEIGHT",t[t.RESIZING_HEIGHT=2]="RESIZING_HEIGHT",t[t.RESIZING_NONE=3]="RESIZING_NONE",t[t.TRUNCATION_DISABLED=4]="TRUNCATION_DISABLED",t[t.TRUNCATION_ENABLED=5]="TRUNCATION_ENABLED",t[t.ALIGNMENT_LEFT=6]="ALIGNMENT_LEFT",t[t.ALIGNMENT_CENTER=7]="ALIGNMENT_CENTER",t[t.ALIGNMENT_RIGHT=8]="ALIGNMENT_RIGHT",t[t.ALIGNMENT_JUSTIFIED=9]="ALIGNMENT_JUSTIFIED",t[t.DECORATION_NONE=10]="DECORATION_NONE",t[t.DECORATION_UNDERLINE=11]="DECORATION_UNDERLINE",t[t.DECORATION_STRIKETHROUGH=12]="DECORATION_STRIKETHROUGH",t[t.LIST_STYLE_PLAIN=13]="LIST_STYLE_PLAIN",t[t.LIST_STYLE_UNORDERED=14]="LIST_STYLE_UNORDERED",t[t.LIST_STYLE_ORDERED=15]="LIST_STYLE_ORDERED",t[t.TEXT_CASE_ORIGINAL=16]="TEXT_CASE_ORIGINAL",t[t.TEXT_CASE_UPPER=17]="TEXT_CASE_UPPER",t[t.TEXT_CASE_LOWER=18]="TEXT_CASE_LOWER",t[t.TEXT_CASE_TITLE=19]="TEXT_CASE_TITLE",t[t.TEXT_CASE_SMALL_CAPS=20]="TEXT_CASE_SMALL_CAPS",t[t.TEXT_CASE_SMALL_CAPS_FORCED=21]="TEXT_CASE_SMALL_CAPS_FORCED",t[t.FRACTIONS_ON=22]="FRACTIONS_ON",t[t.FRACTIONS_OFF=23]="FRACTIONS_OFF",t[t.DISCRETIONARY_LIGATURES_ON=24]="DISCRETIONARY_LIGATURES_ON",t[t.DISCRETIONARY_LIGATURES_OFF=25]="DISCRETIONARY_LIGATURES_OFF",t[t.HISTORICAL_LIGATURES_ON=26]="HISTORICAL_LIGATURES_ON",t[t.HISTORICAL_LIGATURES_OFF=27]="HISTORICAL_LIGATURES_OFF",t[t.NUMERIC_STYLE_ORIGINAL=28]="NUMERIC_STYLE_ORIGINAL",t[t.NUMERIC_STYLE_UPPER_PROPORTIONAL=29]="NUMERIC_STYLE_UPPER_PROPORTIONAL",t[t.NUMERIC_STYLE_UPPER_MONOSPACE=30]="NUMERIC_STYLE_UPPER_MONOSPACE",t[t.NUMERIC_STYLE_LOWER_PROPORTIONAL=31]="NUMERIC_STYLE_LOWER_PROPORTIONAL",t[t.NUMERIC_STYLE_LOWER_MONOSPACE=32]="NUMERIC_STYLE_LOWER_MONOSPACE",t[t.NUMERIC_POSITION_SUB=33]="NUMERIC_POSITION_SUB",t[t.NUMERIC_POSITION_SUPER=34]="NUMERIC_POSITION_SUPER",t[t.NUMERIC_POSITION_NORMAL=35]="NUMERIC_POSITION_NORMAL",t[t.OPENTYPE_FEATURE_ON=36]="OPENTYPE_FEATURE_ON",t[t.OPENTYPE_FEATURE_OFF=37]="OPENTYPE_FEATURE_OFF",t[t.FONT_VARIATIONS=38]="FONT_VARIATIONS",t[t.LEADING_TRIM_CAP_HEIGHT=39]="LEADING_TRIM_CAP_HEIGHT",t[t.LEADING_TRIM_NONE=40]="LEADING_TRIM_NONE",t[t.HANGING_PUNCTUATION_ON=41]="HANGING_PUNCTUATION_ON",t[t.HANGING_PUNCTUATION_OFF=42]="HANGING_PUNCTUATION_OFF",t[t.HANGING_LISTS_ON=43]="HANGING_LISTS_ON",t[t.HANGING_LISTS_OFF=44]="HANGING_LISTS_OFF",t[t.DECORATION_STYLE_SOLID=45]="DECORATION_STYLE_SOLID",t[t.DECORATION_STYLE_DOTTED=46]="DECORATION_STYLE_DOTTED",t[t.DECORATION_STYLE_WAVY=47]="DECORATION_STYLE_WAVY",t[t.DECORATION_SKIP_INK_ON=48]="DECORATION_SKIP_INK_ON",t[t.DECORATION_SKIP_INK_OFF=49]="DECORATION_SKIP_INK_OFF"})(fR||(fR={}));var gR;(function(t){t[t.CURRENT_PAGE=0]="CURRENT_PAGE",t[t.ALL_PAGES=1]="ALL_PAGES",t[t.CURRENT_SELECTION=2]="CURRENT_SELECTION"})(gR||(gR={}));var SR;(function(t){t[t.LOADED=0]="LOADED",t[t.LOADING=1]="LOADING",t[t.FAILED=2]="FAILED"})(SR||(SR={}));var AR;(function(t){t[t.PLUGIN=0]="PLUGIN",t[t.NON_PLUGIN=1]="NON_PLUGIN"})(AR||(AR={}));var TR;(function(t){t[t.AUTOMATIC=0]="AUTOMATIC",t[t.WHEN_REQUESTED=1]="WHEN_REQUESTED"})(TR||(TR={}));var ER;(function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"})(ER||(ER={}));var IR;(function(t){t[t.MIN=0]="MIN",t[t.CENTER=1]="CENTER",t[t.MAX=2]="MAX",t[t.SPACE_EVENLY=3]="SPACE_EVENLY",t[t.SPACE_BETWEEN=4]="SPACE_BETWEEN"})(IR||(IR={}));var RR;(function(t){t[t.MIN=0]="MIN",t[t.CENTER=1]="CENTER",t[t.MAX=2]="MAX",t[t.BASELINE=3]="BASELINE"})(RR||(RR={}));var yR;(function(t){t[t.MIN=0]="MIN",t[t.CENTER=1]="CENTER",t[t.MAX=2]="MAX",t[t.STRETCH=3]="STRETCH",t[t.AUTO=4]="AUTO",t[t.BASELINE=5]="BASELINE"})(yR||(yR={}));var vR;(function(t){t[t.AUTO=0]="AUTO",t[t.ABSOLUTE=1]="ABSOLUTE"})(vR||(vR={}));var CR;(function(t){t[t.FIXED=0]="FIXED",t[t.RESIZE_TO_FIT=1]="RESIZE_TO_FIT",t[t.RESIZE_TO_FIT_WITH_IMPLICIT_SIZE=2]="RESIZE_TO_FIT_WITH_IMPLICIT_SIZE"})(CR||(CR={}));var OR;(function(t){t[t.PACKED=0]="PACKED",t[t.SPACE_BETWEEN=1]="SPACE_BETWEEN"})(OR||(OR={}));var bR;(function(t){t[t.PADDING_TOP=0]="PADDING_TOP",t[t.PADDING_RIGHT=1]="PADDING_RIGHT",t[t.PADDING_BOTTOM=2]="PADDING_BOTTOM",t[t.PADDING_LEFT=3]="PADDING_LEFT",t[t.PADDING_HORIZONTAL=4]="PADDING_HORIZONTAL",t[t.PADDING_VERTICAL=5]="PADDING_VERTICAL",t[t.PADDING_ALL=6]="PADDING_ALL",t[t.SPACING=7]="SPACING",t[t.COUNTER_SPACING=8]="COUNTER_SPACING"})(bR||(bR={}));var NR;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(NR||(NR={}));var PR;(function(t){t[t.SRGB=0]="SRGB",t[t.DISPLAY_P3=1]="DISPLAY_P3"})(PR||(PR={}));var FR;(function(t){t[t.LEGACY=0]="LEGACY",t[t.SRGB=1]="SRGB",t[t.DISPLAY_P3=2]="DISPLAY_P3"})(FR||(FR={}));var DR;(function(t){t[t.DOCUMENT=0]="DOCUMENT",t[t.SRGB=1]="SRGB",t[t.DISPLAY_P3_V4=2]="DISPLAY_P3_V4",t[t.CMYK=3]="CMYK"})(DR||(DR={}));var wR;(function(t){t[t.NO_CONVERSION=0]="NO_CONVERSION",t[t.SRGB_TO_DISPLAY_P3=1]="SRGB_TO_DISPLAY_P3",t[t.DISPLAY_P3_TO_SRGB=2]="DISPLAY_P3_TO_SRGB"})(wR||(wR={}));var xR;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT"})(xR||(xR={}));var LR;(function(t){t[t.NONE=0]="NONE",t[t.FILL=1]="FILL",t[t.STROKE=2]="STROKE",t[t.STROKE_PRESET=3]="STROKE_PRESET",t[t.EFFECT=4]="EFFECT",t[t.EXPORT=5]="EXPORT",t[t.LAYOUT_GRID=6]="LAYOUT_GRID",t[t.PLUGIN=7]="PLUGIN",t[t.PROTOTYPE_INTERACTION=8]="PROTOTYPE_INTERACTION",t[t.PROTOTYPE_INHERITED_INTERNAL_INTERACTION=9]="PROTOTYPE_INHERITED_INTERNAL_INTERACTION",t[t.PROTOTOTYPE_STARTING_POINT=10]="PROTOTOTYPE_STARTING_POINT",t[t.BEHAVIOR=11]="BEHAVIOR",t[t.TRANSFORM_MODIFIER=12]="TRANSFORM_MODIFIER",t[t.COMPONENT_PROP_ASSIGNMENT=13]="COMPONENT_PROP_ASSIGNMENT"})(LR||(LR={}));var MR;(function(t){t[t.NONE=0]="NONE",t[t.BOOL=1]="BOOL",t[t.TEXT=2]="TEXT",t[t.INSTANCE_SWAP=3]="INSTANCE_SWAP",t[t.VARIANT=4]="VARIANT",t[t.NUMBER=5]="NUMBER",t[t.IMAGE=6]="IMAGE",t[t.SLOT=7]="SLOT"})(MR||(MR={}));var BR;(function(t){t[t.NONE=0]="NONE",t[t.UNUSED_DEF_ERROR=1]="UNUSED_DEF_ERROR",t[t.CONFLICTING_NAMES_ERROR=2]="CONFLICTING_NAMES_ERROR",t[t.CONFLICTING_NAMES_WITH_VARIANT_ERROR=3]="CONFLICTING_NAMES_WITH_VARIANT_ERROR"})(BR||(BR={}));var GR;(function(t){t[t.NONE=0]="NONE",t[t.TOO_MANY_STATES_ERROR=1]="TOO_MANY_STATES_ERROR",t[t.MISSING_PROPERTIES_ERROR=2]="MISSING_PROPERTIES_ERROR",t[t.DUPLICATE_STATE_ERROR=3]="DUPLICATE_STATE_ERROR",t[t.PARSE_ERROR=4]="PARSE_ERROR"})(GR||(GR={}));var UR;(function(t){t[t.OVERRIDES_FOR_LAYER_AND_SUBLAYERS=0]="OVERRIDES_FOR_LAYER_AND_SUBLAYERS",t[t.EXPORTS=1]="EXPORTS",t[t.EFFECTS=2]="EFFECTS",t[t.LAYER=3]="LAYER",t[t.VISIBLE=4]="VISIBLE",t[t.NAME=5]="NAME",t[t.FILL=6]="FILL",t[t.STROKE=7]="STROKE",t[t.TEXT=8]="TEXT",t[t.TEXT_STYLE=9]="TEXT_STYLE",t[t.SIZE=10]="SIZE",t[t.OVERRIDDEN_SYMBOL=11]="OVERRIDDEN_SYMBOL",t[t.PROTOTYPE_INTERACTIONS=12]="PROTOTYPE_INTERACTIONS",t[t.OVERLAY=13]="OVERLAY",t[t.NUM_VALUES=14]="NUM_VALUES"})(UR||(UR={}));var VR;(function(t){t[t.ALWAYS=0]="ALWAYS",t[t.ONLY_WHEN_NOT_EMPTY=1]="ONLY_WHEN_NOT_EMPTY",t[t.ONLY_WHEN_NOT_DISABLED=2]="ONLY_WHEN_NOT_DISABLED"})(VR||(VR={}));var kR;(function(t){t[t.SOLID=0]="SOLID",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.GRID=2]="GRID"})(kR||(kR={}));var HR;(function(t){t[t.DESIGN=0]="DESIGN",t[t.WHITEBOARD=1]="WHITEBOARD",t[t.SLIDES=2]="SLIDES",t[t.DEV_HANDOFF=3]="DEV_HANDOFF",t[t.SITES=4]="SITES",t[t.COOPER=5]="COOPER",t[t.ILLUSTRATION=6]="ILLUSTRATION",t[t.FIGMAKE=7]="FIGMAKE"})(HR||(HR={}));var zR;(function(t){t[t.NONE=0]="NONE",t[t.FRAME=1]="FRAME",t[t.GROUP=2]="GROUP",t[t.STACK=3]="STACK",t[t.SECTION=4]="SECTION",t[t.RESPONSIVE_SET=5]="RESPONSIVE_SET",t[t.TRANSFORM=6]="TRANSFORM",t[t.GRID=7]="GRID"})(zR||(zR={}));var WR;(function(t){t[t.MISSING=0]="MISSING",t[t.CORNER_RADIUS=1]="CORNER_RADIUS",t[t.PARAGRAPH_SPACING=2]="PARAGRAPH_SPACING",t[t.PARAGRAPH_INDENT=3]="PARAGRAPH_INDENT",t[t.STROKE_WEIGHT=4]="STROKE_WEIGHT",t[t.STACK_SPACING=5]="STACK_SPACING",t[t.STACK_PADDING_LEFT=6]="STACK_PADDING_LEFT",t[t.STACK_PADDING_TOP=7]="STACK_PADDING_TOP",t[t.STACK_PADDING_RIGHT=8]="STACK_PADDING_RIGHT",t[t.STACK_PADDING_BOTTOM=9]="STACK_PADDING_BOTTOM",t[t.VISIBLE=10]="VISIBLE",t[t.TEXT_DATA=11]="TEXT_DATA",t[t.WIDTH=12]="WIDTH",t[t.HEIGHT=13]="HEIGHT",t[t.RECTANGLE_TOP_LEFT_CORNER_RADIUS=14]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",t[t.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=15]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",t[t.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=16]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",t[t.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=17]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",t[t.BORDER_TOP_WEIGHT=18]="BORDER_TOP_WEIGHT",t[t.BORDER_BOTTOM_WEIGHT=19]="BORDER_BOTTOM_WEIGHT",t[t.BORDER_LEFT_WEIGHT=20]="BORDER_LEFT_WEIGHT",t[t.BORDER_RIGHT_WEIGHT=21]="BORDER_RIGHT_WEIGHT",t[t.VARIANT_PROPERTIES=22]="VARIANT_PROPERTIES",t[t.STACK_COUNTER_SPACING=23]="STACK_COUNTER_SPACING",t[t.MIN_WIDTH=24]="MIN_WIDTH",t[t.MAX_WIDTH=25]="MAX_WIDTH",t[t.MIN_HEIGHT=26]="MIN_HEIGHT",t[t.MAX_HEIGHT=27]="MAX_HEIGHT",t[t.FONT_FAMILY=28]="FONT_FAMILY",t[t.FONT_STYLE=29]="FONT_STYLE",t[t.FONT_VARIATIONS=30]="FONT_VARIATIONS",t[t.OPACITY=31]="OPACITY",t[t.FONT_SIZE=32]="FONT_SIZE",t[t.LETTER_SPACING=34]="LETTER_SPACING",t[t.LINE_HEIGHT=36]="LINE_HEIGHT",t[t.OVERRIDDEN_SYMBOL_ID=37]="OVERRIDDEN_SYMBOL_ID",t[t.CMS_SERIALIZED_RICH_TEXT_DATA=38]="CMS_SERIALIZED_RICH_TEXT_DATA",t[t.HYPERLINK=39]="HYPERLINK",t[t.SLOT_CONTENT_ID=40]="SLOT_CONTENT_ID",t[t.GRID_ROW_GAP=41]="GRID_ROW_GAP",t[t.GRID_COLUMN_GAP=42]="GRID_COLUMN_GAP"})(WR||(WR={}));var KR;(function(t){t[t.NONE=0]="NONE",t[t.FILL=1]="FILL",t[t.TEXT=2]="TEXT",t[t.EFFECT=3]="EFFECT",t[t.GRID=4]="GRID"})(KR||(KR={}));var YR;(function(t){t[t.FIXED=0]="FIXED",t[t.HUG_CONTENT=1]="HUG_CONTENT",t[t.FILL_CONTAINER=2]="FILL_CONTAINER"})(YR||(YR={}));var QR;(function(t){t[t.CLICK=0]="CLICK",t[t.DRAG=1]="DRAG"})(QR||(QR={}));var qR;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(qR||(qR={}));var XR;(function(t){t[t.ROW=0]="ROW",t[t.COLUMN=1]="COLUMN"})(XR||(XR={}));var ZR;(function(t){t[t.FORWARD=0]="FORWARD",t[t.BACKWARD=1]="BACKWARD"})(ZR||(ZR={}));var JR;(function(t){t[t.NONE=0]="NONE",t[t.PIXEL_GRID=1]="PIXEL_GRID",t[t.DOT_GRID=16]="DOT_GRID"})(JR||(JR={}));var jR;(function(t){t[t.BLANK=0]="BLANK",t[t.DUPLICATE=1]="DUPLICATE"})(jR||(jR={}));var $R;(function(t){t[t.NONE=0]="NONE",t[t.PLACE=1]="PLACE",t[t.QUIT=2]="QUIT",t[t.BACK_TO_FILES=3]="BACK_TO_FILES",t[t.OPEN_FONT_SETTINGS=4]="OPEN_FONT_SETTINGS",t[t.SAVE=5]="SAVE",t[t.SAVE_AS=6]="SAVE_AS",t[t.CREATE_SAVEPOINT=7]="CREATE_SAVEPOINT",t[t.TOGGLE_VERSION_HISTORY=8]="TOGGLE_VERSION_HISTORY",t[t.EXPORT_SELECTED_EXPORTABLES=9]="EXPORT_SELECTED_EXPORTABLES",t[t.EXPORT_SELECTED_EXPORTABLES_DIRECT=10]="EXPORT_SELECTED_EXPORTABLES_DIRECT",t[t.EXPORT_NODE_DIRECT_COOPER=11]="EXPORT_NODE_DIRECT_COOPER",t[t.EXPORT_ASSETS_HANDOFF=12]="EXPORT_ASSETS_HANDOFF",t[t.EXPORT_ALL_EXPORTABLES=13]="EXPORT_ALL_EXPORTABLES",t[t.EXPORT_SELECTION_OR_CURRENT_PAGE=14]="EXPORT_SELECTION_OR_CURRENT_PAGE",t[t.EXPORT_SELECTED_VIDEO=15]="EXPORT_SELECTED_VIDEO",t[t.EXPORT_COOPER_ASSETS=16]="EXPORT_COOPER_ASSETS",t[t.IMPORT_FROM_CSV=17]="IMPORT_FROM_CSV",t[t.IMPORT=18]="IMPORT",t[t.PAGE_NEW=19]="PAGE_NEW",t[t.PAGE_PREVIOUS=20]="PAGE_PREVIOUS",t[t.PAGE_NEXT=21]="PAGE_NEXT",t[t.PAGE_DELETE=22]="PAGE_DELETE",t[t.PAGE_DUPLICATE=23]="PAGE_DUPLICATE",t[t.PAGE_MOVE_TO=24]="PAGE_MOVE_TO",t[t.PAGE_RENAME=25]="PAGE_RENAME",t[t.TRACK_PAGE_RENAME=26]="TRACK_PAGE_RENAME",t[t.BATCH_PAGE_RENAME=27]="BATCH_PAGE_RENAME",t[t.PAGE_MOVE_TO_MENU=28]="PAGE_MOVE_TO_MENU",t[t.PAGE_MOVE_TO_NEW_FILE=29]="PAGE_MOVE_TO_NEW_FILE",t[t.PAGE_COPY_LINK=30]="PAGE_COPY_LINK",t[t.COPY_LINK=31]="COPY_LINK",t[t.UNDO=32]="UNDO",t[t.REDO=33]="REDO",t[t.CUT=34]="CUT",t[t.COPY=35]="COPY",t[t.COPY_AS_MENU=36]="COPY_AS_MENU",t[t.COPY_PASTE_MENU=37]="COPY_PASTE_MENU",t[t.COPY_AS_CODE=38]="COPY_AS_CODE",t[t.COPY_AS_CSS=39]="COPY_AS_CSS",t[t.COPY_AS_CSS_RECURSIVE=40]="COPY_AS_CSS_RECURSIVE",t[t.COPY_AS_ANDROID=41]="COPY_AS_ANDROID",t[t.COPY_AS_IOS=42]="COPY_AS_IOS",t[t.COPY_AS_SVG=43]="COPY_AS_SVG",t[t.COPY_AS_PNG=44]="COPY_AS_PNG",t[t.PANELS_MENU=45]="PANELS_MENU",t[t.MASTER_COMPONENT_MENU=46]="MASTER_COMPONENT_MENU",t[t.COPY_PROPERTIES=47]="COPY_PROPERTIES",t[t.COPY_TEXT=48]="COPY_TEXT",t[t.COPY_LAYER_NAME=49]="COPY_LAYER_NAME",t[t.PASTE=50]="PASTE",t[t.PASTE_HERE=51]="PASTE_HERE",t[t.PASTE_PROPERTIES=52]="PASTE_PROPERTIES",t[t.PASTE_OVER_SELECTION=53]="PASTE_OVER_SELECTION",t[t.PASTE_TO_REPLACE=54]="PASTE_TO_REPLACE",t[t.PASTE_WIDGETS_AS_SUBLAYERS=55]="PASTE_WIDGETS_AS_SUBLAYERS",t[t.SHOW_ROTATION_ORIGIN=56]="SHOW_ROTATION_ORIGIN",t[t.SELECT_CHILD=57]="SELECT_CHILD",t[t.SELECT_PARENT=58]="SELECT_PARENT",t[t.SELECT_NEXT_SIBLING=59]="SELECT_NEXT_SIBLING",t[t.SELECT_PREVIOUS_SIBLING=60]="SELECT_PREVIOUS_SIBLING",t[t.SELECT_NEXT_NODE=61]="SELECT_NEXT_NODE",t[t.SELECT_PREVIOUS_NODE=62]="SELECT_PREVIOUS_NODE",t[t.SELECT_ALL=63]="SELECT_ALL",t[t.SELECT_ALL_WIDGETS=64]="SELECT_ALL_WIDGETS",t[t.SELECT_ALL_SLIDES=65]="SELECT_ALL_SLIDES",t[t.SELECT_INVERSE=66]="SELECT_INVERSE",t[t.MOVE_TEXT_SELECTION_END=67]="MOVE_TEXT_SELECTION_END",t[t.MOVE_TEXT_SELECTION_START=68]="MOVE_TEXT_SELECTION_START",t[t.EXTEND_TEXT_SELECTION_END=69]="EXTEND_TEXT_SELECTION_END",t[t.EXTEND_TEXT_SELECTION_START=70]="EXTEND_TEXT_SELECTION_START",t[t.MOVE_TEXT_SELECTION_FORWARD=71]="MOVE_TEXT_SELECTION_FORWARD",t[t.MOVE_TEXT_SELECTION_BACKWARD=72]="MOVE_TEXT_SELECTION_BACKWARD",t[t.EXTEND_TEXT_SELECTION_FORWARD=73]="EXTEND_TEXT_SELECTION_FORWARD",t[t.EXTEND_TEXT_SELECTION_BACKWARD=74]="EXTEND_TEXT_SELECTION_BACKWARD",t[t.SELECT_MATCHING=75]="SELECT_MATCHING",t[t.SELECT_SIMILAR=76]="SELECT_SIMILAR",t[t.SELECT_NODE=77]="SELECT_NODE",t[t.SELECT_NODE_MENU=78]="SELECT_NODE_MENU",t[t.SET_DEFAULT_STYLE=79]="SET_DEFAULT_STYLE",t[t.FIND_SYMBOL=80]="FIND_SYMBOL",t[t.FIND_COMPONENT_IN_FILE=81]="FIND_COMPONENT_IN_FILE",t[t.CREATE_SYMBOL=82]="CREATE_SYMBOL",t[t.CREATE_MULTIPLE_SYMBOLS=83]="CREATE_MULTIPLE_SYMBOLS",t[t.CREATE_MULTIPLE_SYMBOLS_AND_STATE_GROUP=84]="CREATE_MULTIPLE_SYMBOLS_AND_STATE_GROUP",t[t.PUBLISH_SELECTION=85]="PUBLISH_SELECTION",t[t.PUBLISH_CHANGES_TO_LIBRARY=86]="PUBLISH_CHANGES_TO_LIBRARY",t[t.PUBLISH_TEMPLATE=87]="PUBLISH_TEMPLATE",t[t.PUSH_CHANGES_TO_MAIN=88]="PUSH_CHANGES_TO_MAIN",t[t.RESET_SYMBOL=89]="RESET_SYMBOL",t[t.RESET_FAUXVERRIDE=90]="RESET_FAUXVERRIDE",t[t.RESET_SIZE=91]="RESET_SIZE",t[t.RESET_EXPORTS=92]="RESET_EXPORTS",t[t.RESET_EFFECTS=93]="RESET_EFFECTS",t[t.RESET_LAYER=94]="RESET_LAYER",t[t.RESET_VISIBLE=95]="RESET_VISIBLE",t[t.RESET_NAME=96]="RESET_NAME",t[t.RESET_FILL=97]="RESET_FILL",t[t.RESET_STROKE=98]="RESET_STROKE",t[t.RESET_TEXT=99]="RESET_TEXT",t[t.RESET_TEXT_STYLE=100]="RESET_TEXT_STYLE",t[t.RESET_PROTOTYPE_INTERACTIONS=101]="RESET_PROTOTYPE_INTERACTIONS",t[t.RESET_OVERLAY=102]="RESET_OVERLAY",t[t.RESTORE_SYMBOL_OR_STATE_GROUP=103]="RESTORE_SYMBOL_OR_STATE_GROUP",t[t.SWAP_TO_RELATED_SYMBOL=104]="SWAP_TO_RELATED_SYMBOL",t[t.ADD_VARIANT=105]="ADD_VARIANT",t[t.CREATE_STATE_GROUP=106]="CREATE_STATE_GROUP",t[t.CREATE_STATE=107]="CREATE_STATE",t[t.SWAP_TO_RELATED_STATE=108]="SWAP_TO_RELATED_STATE",t[t.CREATE_RESPONSIVE_SET=109]="CREATE_RESPONSIVE_SET",t[t.CREATE_TEMPLATE=110]="CREATE_TEMPLATE",t[t.CONVERT_TO_SLOT=111]="CONVERT_TO_SLOT",t[t.SWAP_NODES=112]="SWAP_NODES",t[t.DETACH_INSTANCE=113]="DETACH_INSTANCE",t[t.REMOVE_DETACHED_SYMBOL_ID=114]="REMOVE_DETACHED_SYMBOL_ID",t[t.UPDATE_INSTANCE_LAYOUT_VERSION=115]="UPDATE_INSTANCE_LAYOUT_VERSION",t[t.REGENERATE_ALL_INSTANCES=116]="REGENERATE_ALL_INSTANCES",t[t.REGENERATE_FILE_GEOMETRY=117]="REGENERATE_FILE_GEOMETRY",t[t.REGENERATE_MISSING_THUMBNAILS=118]="REGENERATE_MISSING_THUMBNAILS",t[t.BACKUP_ALL_OVERRIDES=119]="BACKUP_ALL_OVERRIDES",t[t.DETACH_ALL_INSTANCES=120]="DETACH_ALL_INSTANCES",t[t.TOGGLE_VARIABLES=121]="TOGGLE_VARIABLES",t[t.REMOVE_ORPHANED_VARIABLES=122]="REMOVE_ORPHANED_VARIABLES",t[t.REMOVE_RESPONSIVE_TEXT_STYLE_VARIANTS=123]="REMOVE_RESPONSIVE_TEXT_STYLE_VARIANTS",t[t.REPAIR_SELECTED_INSTANCES=124]="REPAIR_SELECTED_INSTANCES",t[t.REPAIR_BREAKPOINT_MULTIEDIT=125]="REPAIR_BREAKPOINT_MULTIEDIT",t[t.DETACH_DELETED_VARIABLES=126]="DETACH_DELETED_VARIABLES",t[t.REPAIR_STATE_GROUP_VERSIONS=127]="REPAIR_STATE_GROUP_VERSIONS",t[t.REPAIR_VARIABLE_CONNECTIONS=128]="REPAIR_VARIABLE_CONNECTIONS",t[t.REPAIR_VARIABLE_MODE_VALUES=129]="REPAIR_VARIABLE_MODE_VALUES",t[t.RESTORE_SOFT_DELETED_VARIABLE_SETS=130]="RESTORE_SOFT_DELETED_VARIABLE_SETS",t[t.RERESOLVE_VARIABLE_REFERENCES=131]="RERESOLVE_VARIABLE_REFERENCES",t[t.RESTORE_AUTOLAYOUT_POSITION=132]="RESTORE_AUTOLAYOUT_POSITION",t[t.RESET_TRANSFORM=133]="RESET_TRANSFORM",t[t.RESET_VARIABLE_MODES=134]="RESET_VARIABLE_MODES",t[t.FIND_SHARED_INSTANCES_NEED_RELINKING=135]="FIND_SHARED_INSTANCES_NEED_RELINKING",t[t.RELINK_INSTANCES_TO_LOCAL_COMPONENT=136]="RELINK_INSTANCES_TO_LOCAL_COMPONENT",t[t.CALC_DELETED_COMPONENT_PUBLISHED_VERSION=137]="CALC_DELETED_COMPONENT_PUBLISHED_VERSION",t[t.REPUBLISH_SELECTED_COMPONENTS=138]="REPUBLISH_SELECTED_COMPONENTS",t[t.REPUBLISH_AUTO_LAYOUT_COMPONENTS=139]="REPUBLISH_AUTO_LAYOUT_COMPONENTS",t[t.SELECT_BROKEN_FIXED_SCROLLING_NODES=140]="SELECT_BROKEN_FIXED_SCROLLING_NODES",t[t.CLEAR_SELECTION_COMPONENT_PROPS=141]="CLEAR_SELECTION_COMPONENT_PROPS",t[t.REGENERATE_COMPONENT_PROPS=142]="REGENERATE_COMPONENT_PROPS",t[t.PRUNE_INVALID_COMPONENT_PROP_REFS=143]="PRUNE_INVALID_COMPONENT_PROP_REFS",t[t.PRUNE_DERIVED_DATA=144]="PRUNE_DERIVED_DATA",t[t.REPAIR_MISSING_OVERRIDE_KEYS=145]="REPAIR_MISSING_OVERRIDE_KEYS",t[t.REPAIR_CORRUPT_OVERRIDE_KEYS_FOR_SELECTION=146]="REPAIR_CORRUPT_OVERRIDE_KEYS_FOR_SELECTION",t[t.RESTORE_SOFT_DELETED_SELECTION=147]="RESTORE_SOFT_DELETED_SELECTION",t[t.REPAIR_DUPLICATE_SUBSCRIBED_ASSETS=148]="REPAIR_DUPLICATE_SUBSCRIBED_ASSETS",t[t.REFLOW_IMMUTABLE_FRAMES=149]="REFLOW_IMMUTABLE_FRAMES",t[t.DISABLE_ALL_UNFRAMED_MASKS=150]="DISABLE_ALL_UNFRAMED_MASKS",t[t.RESIZE_TO_FIT=151]="RESIZE_TO_FIT",t[t.TOGGLE_FRAME_ORIENTATION=152]="TOGGLE_FRAME_ORIENTATION",t[t.START_CHAT=153]="START_CHAT",t[t.TOGGLE_FRAME_CLIPPING=154]="TOGGLE_FRAME_CLIPPING",t[t.HIDE_SIBLING_LAYERS=155]="HIDE_SIBLING_LAYERS",t[t.COLLAPSE_LAYERS=156]="COLLAPSE_LAYERS",t[t.DUPLICATE=157]="DUPLICATE",t[t.DUPLICATE_IN_PLACE=158]="DUPLICATE_IN_PLACE",t[t.QUICK_CREATE=159]="QUICK_CREATE",t[t.QUICK_CREATE_DIAGRAM_SIBLING=160]="QUICK_CREATE_DIAGRAM_SIBLING",t[t.FLIP_HORIZONTAL=161]="FLIP_HORIZONTAL",t[t.FLIP_VERTICAL=162]="FLIP_VERTICAL",t[t.ROTATE_180=163]="ROTATE_180",t[t.ROTATE_90_COUNTERCLOCKWISE=164]="ROTATE_90_COUNTERCLOCKWISE",t[t.ROTATE_90_CLOCKWISE=165]="ROTATE_90_CLOCKWISE",t[t.BRING_TO_FRONT=166]="BRING_TO_FRONT",t[t.BRING_FORWARD=167]="BRING_FORWARD",t[t.SEND_BACKWARD=168]="SEND_BACKWARD",t[t.SEND_TO_BACK=169]="SEND_TO_BACK",t[t.CONVERT_TO_RASTER=170]="CONVERT_TO_RASTER",t[t.FLATTEN_SELECTION=171]="FLATTEN_SELECTION",t[t.REMOVE_ANNOTATIONS=172]="REMOVE_ANNOTATIONS",t[t.ADD_ANNOTATION=173]="ADD_ANNOTATION",t[t.REMOVE_FILL=174]="REMOVE_FILL",t[t.REMOVE_GUIDE=175]="REMOVE_GUIDE",t[t.REMOVE_HORIZONTAL_GUIDES=176]="REMOVE_HORIZONTAL_GUIDES",t[t.REMOVE_VERTICAL_GUIDES=177]="REMOVE_VERTICAL_GUIDES",t[t.REMOVE_STROKE=178]="REMOVE_STROKE",t[t.SWAP_FILL_AND_STROKE=179]="SWAP_FILL_AND_STROKE",t[t.SELECT_SAME_FILL=180]="SELECT_SAME_FILL",t[t.SELECT_SAME_STROKE=181]="SELECT_SAME_STROKE",t[t.SELECT_SAME_EFFECT=182]="SELECT_SAME_EFFECT",t[t.SELECT_SAME_TEXT=183]="SELECT_SAME_TEXT",t[t.SELECT_SAME_FONT=184]="SELECT_SAME_FONT",t[t.SELECT_SAME_STYLE=185]="SELECT_SAME_STYLE",t[t.SELECT_SAME_INSTANCE=186]="SELECT_SAME_INSTANCE",t[t.SELECT_SAME_VARIANT=187]="SELECT_SAME_VARIANT",t[t.SELECT_ALL_TEXT=188]="SELECT_ALL_TEXT",t[t.REPLACE_SELECTED_TEXT=189]="REPLACE_SELECTED_TEXT",t[t.LOCK_ASPECT_RATIO=190]="LOCK_ASPECT_RATIO",t[t.UNLOCK_ASPECT_RATIO=191]="UNLOCK_ASPECT_RATIO",t[t.FRAME_SELECTION=192]="FRAME_SELECTION",t[t.GROUP_SELECTION=193]="GROUP_SELECTION",t[t.UNGROUP_SELECTION=194]="UNGROUP_SELECTION",t[t.CREATE_TEXT_NODE=195]="CREATE_TEXT_NODE",t[t.CREATE_TRIANGLE=196]="CREATE_TRIANGLE",t[t.CREATE_ELLIPSE=197]="CREATE_ELLIPSE",t[t.CREATE_ROUNDED_RECTANGLE=198]="CREATE_ROUNDED_RECTANGLE",t[t.CREATE_DIAMOND=199]="CREATE_DIAMOND",t[t.CREATE_COMMENT=200]="CREATE_COMMENT",t[t.CREATE_STICKY=201]="CREATE_STICKY",t[t.CREATE_SECTION=202]="CREATE_SECTION",t[t.CREATE_SLIDE=203]="CREATE_SLIDE",t[t.MASK_SELECTION=204]="MASK_SELECTION",t[t.RENAME_SELECTION=205]="RENAME_SELECTION",t[t.CREATE_SECTION_FROM_SELECTION=206]="CREATE_SECTION_FROM_SELECTION",t[t.CREATE_BREAKPOINT=207]="CREATE_BREAKPOINT",t[t.REMOVE_BREAKPOINT=208]="REMOVE_BREAKPOINT",t[t.SET_AS_PRIMARY_BREAKPOINT=209]="SET_AS_PRIMARY_BREAKPOINT",t[t.REPLACE_SELECTED_FRAME_WITH_SECTION=210]="REPLACE_SELECTED_FRAME_WITH_SECTION",t[t.REPLACE_SELECTED_SECTION_WITH_FRAME=211]="REPLACE_SELECTED_SECTION_WITH_FRAME",t[t.ADD_SELECTION_READY_STATUS=212]="ADD_SELECTION_READY_STATUS",t[t.MARK_INCOMPLETE=213]="MARK_INCOMPLETE",t[t.SET_SELECTION_COMPLETED_STATUS=214]="SET_SELECTION_COMPLETED_STATUS",t[t.REMOVE_SELECTION_STATUS=215]="REMOVE_SELECTION_STATUS",t[t.CONVERT_TABLE_TO_STICKY_GRID=216]="CONVERT_TABLE_TO_STICKY_GRID",t[t.FIND_INSPIRATION=217]="FIND_INSPIRATION",t[t.FIND_CODEBASE_SUGGESTIONS=218]="FIND_CODEBASE_SUGGESTIONS",t[t.INSPECT_FRAGMENT=219]="INSPECT_FRAGMENT",t[t.CREATE_BRUSH_MENU=220]="CREATE_BRUSH_MENU",t[t.CREATE_STRETCH_BRUSH=221]="CREATE_STRETCH_BRUSH",t[t.CREATE_SCATTER_BRUSH=222]="CREATE_SCATTER_BRUSH",t[t.MIGRATE_EFFECT_REPEATS_TO_TRANSFORMS=223]="MIGRATE_EFFECT_REPEATS_TO_TRANSFORMS",t[t.MIGRATE_PATTERN_SPACING=224]="MIGRATE_PATTERN_SPACING",t[t.STACK_SELECTION=225]="STACK_SELECTION",t[t.STACK_SELECTED_NODES=226]="STACK_SELECTED_NODES",t[t.UNSTACK_SELECTION=227]="UNSTACK_SELECTION",t[t.GRID_SELECTION=228]="GRID_SELECTION",t[t.SET_SELECTION_FILL_HORIZONTAL=229]="SET_SELECTION_FILL_HORIZONTAL",t[t.SET_SELECTION_HUG_HORIZONTAL=230]="SET_SELECTION_HUG_HORIZONTAL",t[t.SET_SELECTION_FILL_VERTICAL=231]="SET_SELECTION_FILL_VERTICAL",t[t.SET_SELECTION_HUG_VERTICAL=232]="SET_SELECTION_HUG_VERTICAL",t[t.APPLY_TRANSFORM_MODIFIERS=233]="APPLY_TRANSFORM_MODIFIERS",t[t.OUTLINE_STROKE=234]="OUTLINE_STROKE",t[t.LIVE_BOOLEAN_UNION=235]="LIVE_BOOLEAN_UNION",t[t.LIVE_BOOLEAN_SUBTRACT=236]="LIVE_BOOLEAN_SUBTRACT",t[t.LIVE_BOOLEAN_INTERSECT=237]="LIVE_BOOLEAN_INTERSECT",t[t.LIVE_BOOLEAN_XOR=238]="LIVE_BOOLEAN_XOR",t[t.ADD_TRANSFORM_MODIFIER_TO_SELECTION=239]="ADD_TRANSFORM_MODIFIER_TO_SELECTION",t[t.ADD_LINEAR_REPEAT_TO_SELECTION=240]="ADD_LINEAR_REPEAT_TO_SELECTION",t[t.ADD_SKEW_MODIFIER_TO_SELECTION=241]="ADD_SKEW_MODIFIER_TO_SELECTION",t[t.ALIGN_TOP=242]="ALIGN_TOP",t[t.ALIGN_VERTICAL_CENTER=243]="ALIGN_VERTICAL_CENTER",t[t.ALIGN_BOTTOM=244]="ALIGN_BOTTOM",t[t.ALIGN_LEFT=245]="ALIGN_LEFT",t[t.ALIGN_HORIZONTAL_CENTER=246]="ALIGN_HORIZONTAL_CENTER",t[t.ALIGN_RIGHT=247]="ALIGN_RIGHT",t[t.ALIGN_TOP_AS_GROUP=248]="ALIGN_TOP_AS_GROUP",t[t.ALIGN_VERTICAL_CENTER_AS_GROUP=249]="ALIGN_VERTICAL_CENTER_AS_GROUP",t[t.ALIGN_BOTTOM_AS_GROUP=250]="ALIGN_BOTTOM_AS_GROUP",t[t.ALIGN_LEFT_AS_GROUP=251]="ALIGN_LEFT_AS_GROUP",t[t.ALIGN_HORIZONTAL_CENTER_AS_GROUP=252]="ALIGN_HORIZONTAL_CENTER_AS_GROUP",t[t.ALIGN_RIGHT_AS_GROUP=253]="ALIGN_RIGHT_AS_GROUP",t[t.ROUND_TO_PIXELS=254]="ROUND_TO_PIXELS",t[t.ARRANGE_AS_GRID=255]="ARRANGE_AS_GRID",t[t.ARRANGE_AS_LIST=256]="ARRANGE_AS_LIST",t[t.TIDY_UP=257]="TIDY_UP",t[t.PACK_HORIZONTAL=258]="PACK_HORIZONTAL",t[t.PACK_VERTICAL=259]="PACK_VERTICAL",t[t.DISTRIBUTE_HORIZONTAL_SPACING=260]="DISTRIBUTE_HORIZONTAL_SPACING",t[t.DISTRIBUTE_VERTICAL_SPACING=261]="DISTRIBUTE_VERTICAL_SPACING",t[t.DISTRIBUTE_TOP=262]="DISTRIBUTE_TOP",t[t.DISTRIBUTE_VERTICAL_CENTER=263]="DISTRIBUTE_VERTICAL_CENTER",t[t.DISTRIBUTE_BOTTOM=264]="DISTRIBUTE_BOTTOM",t[t.DISTRIBUTE_LEFT=265]="DISTRIBUTE_LEFT",t[t.DISTRIBUTE_HORIZONTAL_CENTER=266]="DISTRIBUTE_HORIZONTAL_CENTER",t[t.DISTRIBUTE_RIGHT=267]="DISTRIBUTE_RIGHT",t[t.TOGGLE_BOLD=268]="TOGGLE_BOLD",t[t.TEXT_TOGGLE_ITALIC=269]="TEXT_TOGGLE_ITALIC",t[t.TEXT_BOLD_INCREASE=270]="TEXT_BOLD_INCREASE",t[t.TEXT_BOLD_DECREASE=271]="TEXT_BOLD_DECREASE",t[t.TEXT_TOGGLE_UNDERLINE=272]="TEXT_TOGGLE_UNDERLINE",t[t.TEXT_TOGGLE_STRIKETHROUGH=273]="TEXT_TOGGLE_STRIKETHROUGH",t[t.TEXT_REMOVE_DECORATION=274]="TEXT_REMOVE_DECORATION",t[t.TEXT_DELETE_SELECTION_OR_END=275]="TEXT_DELETE_SELECTION_OR_END",t[t.TEXT_DELETE_SELECTION_OR_NEXT_CHARACTER=276]="TEXT_DELETE_SELECTION_OR_NEXT_CHARACTER",t[t.TEXT_UPGRADE_TEXT_EXPLICIT_LAYOUT_VERSION=277]="TEXT_UPGRADE_TEXT_EXPLICIT_LAYOUT_VERSION",t[t.TEXT_UPGRADE_TO_BIDI=278]="TEXT_UPGRADE_TO_BIDI",t[t.TEXT_TOGGLE_ORDERED_LIST=279]="TEXT_TOGGLE_ORDERED_LIST",t[t.TEXT_TOGGLE_UNORDERED_LIST=280]="TEXT_TOGGLE_UNORDERED_LIST",t[t.TEXT_CLEAR_LIST_FORMATTING=281]="TEXT_CLEAR_LIST_FORMATTING",t[t.TEXT_INDENT_LIST=282]="TEXT_INDENT_LIST",t[t.TEXT_DEDENT_LIST=283]="TEXT_DEDENT_LIST",t[t.TEXT_DIRECTIONALITY_MENU=284]="TEXT_DIRECTIONALITY_MENU",t[t.SET_DIRECTIONALITY_LTR=285]="SET_DIRECTIONALITY_LTR",t[t.SET_DIRECTIONALITY_LTR_QA=286]="SET_DIRECTIONALITY_LTR_QA",t[t.SET_DIRECTIONALITY_RTL=287]="SET_DIRECTIONALITY_RTL",t[t.SET_DIRECTIONALITY_RTL_QA=288]="SET_DIRECTIONALITY_RTL_QA",t[t.TEXT_EDIT_HYPERLINK=289]="TEXT_EDIT_HYPERLINK",t[t.TEXT_CASE_MENU=290]="TEXT_CASE_MENU",t[t.TEXT_SET_ORIGINAL_CASE=291]="TEXT_SET_ORIGINAL_CASE",t[t.TEXT_SET_UPPER_CASE=292]="TEXT_SET_UPPER_CASE",t[t.TEXT_SET_LOWER_CASE=293]="TEXT_SET_LOWER_CASE",t[t.TEXT_SET_TITLE_CASE=294]="TEXT_SET_TITLE_CASE",t[t.TEXT_SET_SMALL_CAPS=295]="TEXT_SET_SMALL_CAPS",t[t.TEXT_SET_FORCED_SMALL_CAPS=296]="TEXT_SET_FORCED_SMALL_CAPS",t[t.TEXT_RELAYOUT=297]="TEXT_RELAYOUT",t[t.TEXT_ALIGN_MENU=298]="TEXT_ALIGN_MENU",t[t.TEXT_ALIGN_LEFT=299]="TEXT_ALIGN_LEFT",t[t.TEXT_ALIGN_CENTER=300]="TEXT_ALIGN_CENTER",t[t.TEXT_ALIGN_RIGHT=301]="TEXT_ALIGN_RIGHT",t[t.TEXT_ALIGN_JUSTIFIED=302]="TEXT_ALIGN_JUSTIFIED",t[t.TEXT_ALIGN_TOP=303]="TEXT_ALIGN_TOP",t[t.TEXT_ALIGN_MIDDLE=304]="TEXT_ALIGN_MIDDLE",t[t.TEXT_ALIGN_BOTTOM=305]="TEXT_ALIGN_BOTTOM",t[t.TEXT_STYLE_TITLE=306]="TEXT_STYLE_TITLE",t[t.TEXT_STYLE_H1=307]="TEXT_STYLE_H1",t[t.TEXT_STYLE_H2=308]="TEXT_STYLE_H2",t[t.TEXT_STYLE_H3=309]="TEXT_STYLE_H3",t[t.TEXT_STYLE_NORMAL=310]="TEXT_STYLE_NORMAL",t[t.TEXT_ADJUST_MENU=311]="TEXT_ADJUST_MENU",t[t.TEXT_LINE_HEIGHT_DECREASE=312]="TEXT_LINE_HEIGHT_DECREASE",t[t.TEXT_LINE_HEIGHT_INCREASE=313]="TEXT_LINE_HEIGHT_INCREASE",t[t.TEXT_FONT_SIZE_DECREASE=314]="TEXT_FONT_SIZE_DECREASE",t[t.TEXT_FONT_SIZE_INCREASE=315]="TEXT_FONT_SIZE_INCREASE",t[t.TEXT_LETTER_SPACING_DECREASE=316]="TEXT_LETTER_SPACING_DECREASE",t[t.TEXT_LETTER_SPACING_INCREASE=317]="TEXT_LETTER_SPACING_INCREASE",t[t.GOTO_LAYER=318]="GOTO_LAYER",t[t.COMMIT=319]="COMMIT",t[t.AFTER_UNDO_REDO_COMMIT=320]="AFTER_UNDO_REDO_COMMIT",t[t.PURGE_ALL_MEMORY=321]="PURGE_ALL_MEMORY",t[t.REDRAW_CANVAS=322]="REDRAW_CANVAS",t[t.AFTER_FIRST_RENDER=323]="AFTER_FIRST_RENDER",t[t.REQUEST_EDIT_MODE=324]="REQUEST_EDIT_MODE",t[t.REQUEST_EDIT_MODE_VIA_TOOLBAR=325]="REQUEST_EDIT_MODE_VIA_TOOLBAR",t[t.LEAVE_EDIT_MODE=326]="LEAVE_EDIT_MODE",t[t.TOGGLE_EDIT_MODE=327]="TOGGLE_EDIT_MODE",t[t.TOGGLE_GRADIENT_EDIT_MODE=328]="TOGGLE_GRADIENT_EDIT_MODE",t[t.TOGGLE_PROGRESSIVE_BLUR_EDIT_MODE=329]="TOGGLE_PROGRESSIVE_BLUR_EDIT_MODE",t[t.TOGGLE_RASTER_EDIT_MODE=330]="TOGGLE_RASTER_EDIT_MODE",t[t.CROP_IMAGE=331]="CROP_IMAGE",t[t.ADD_IMAGE_OVERLAY=332]="ADD_IMAGE_OVERLAY",t[t.REMOVE_IMAGE_OVERLAY=333]="REMOVE_IMAGE_OVERLAY",t[t.ROTATE_IMAGE_90_CLOCKWISE=334]="ROTATE_IMAGE_90_CLOCKWISE",t[t.ENTER_LAYOUT_MODE=335]="ENTER_LAYOUT_MODE",t[t.ENTER_PREVIEW_MODE=336]="ENTER_PREVIEW_MODE",t[t.ENTER_HISTORY_MODE=337]="ENTER_HISTORY_MODE",t[t.ENTER_BRANCHING_MODE=338]="ENTER_BRANCHING_MODE",t[t.ENTER_LIBRARY_MODE=339]="ENTER_LIBRARY_MODE",t[t.DEV_HANDOFF_FOCUS_PREVIOUS=340]="DEV_HANDOFF_FOCUS_PREVIOUS",t[t.DEV_HANDOFF_FOCUS_NEXT=341]="DEV_HANDOFF_FOCUS_NEXT",t[t.TOGGLE_UI=342]="TOGGLE_UI",t[t.TOGGLE_KEYBOARD_SHORTCUTS=343]="TOGGLE_KEYBOARD_SHORTCUTS",t[t.TOGGLE_HELP_WIDGET=344]="TOGGLE_HELP_WIDGET",t[t.TOGGLE_LAYERS=345]="TOGGLE_LAYERS",t[t.TOGGLE_PUBLISH=346]="TOGGLE_PUBLISH",t[t.TOGGLE_LIBRARY=347]="TOGGLE_LIBRARY",t[t.TOGGLE_COMPONENT_INSERT_MODAL=348]="TOGGLE_COMPONENT_INSERT_MODAL",t[t.TOGGLE_SIDEBAR=349]="TOGGLE_SIDEBAR",t[t.TOGGLE_SNAPPING_TO_PIXELS=350]="TOGGLE_SNAPPING_TO_PIXELS",t[t.TOGGLE_SNAPPING_TO_OBJECTS=351]="TOGGLE_SNAPPING_TO_OBJECTS",t[t.TOGGLE_SNAPPING_TO_GEOMETRY=352]="TOGGLE_SNAPPING_TO_GEOMETRY",t[t.TOGGLE_SMART_QUOTES=353]="TOGGLE_SMART_QUOTES",t[t.TOGGLE_FLIP_DURING_RESIZE=354]="TOGGLE_FLIP_DURING_RESIZE",t[t.DISABLE_PINCH_ZOOM_FIX=355]="DISABLE_PINCH_ZOOM_FIX",t[t.TOGGLE_LAYER_HOVER=356]="TOGGLE_LAYER_HOVER",t[t.TOGGLE_STICKY_TOOLS=357]="TOGGLE_STICKY_TOOLS",t[t.TOGGLE_COPY_RENAMING=358]="TOGGLE_COPY_RENAMING",t[t.TOGGLE_VIEWPORT_OVERLAY_HIDING=359]="TOGGLE_VIEWPORT_OVERLAY_HIDING",t[t.TOGGLE_KEYBOARD_ZOOM_TO_SELECTION=360]="TOGGLE_KEYBOARD_ZOOM_TO_SELECTION",t[t.TOGGLE_MULTIPLAYER_CURSORS=361]="TOGGLE_MULTIPLAYER_CURSORS",t[t.TOGGLE_SHOW_PROPERTY_LABELS=362]="TOGGLE_SHOW_PROPERTY_LABELS",t[t.ZOOM_IN=363]="ZOOM_IN",t[t.ZOOM_OUT=364]="ZOOM_OUT",t[t.ZOOM_RESET=365]="ZOOM_RESET",t[t.ZOOM_TO_FIT=366]="ZOOM_TO_FIT",t[t.ZOOM_TO_SELECTION=367]="ZOOM_TO_SELECTION",t[t.SHOW_SELECTED_NODES=368]="SHOW_SELECTED_NODES",t[t.HIDE_SELECTED_NODES=369]="HIDE_SELECTED_NODES",t[t.TOGGLE_SHOWN_FOR_SELECTED_NODES=370]="TOGGLE_SHOWN_FOR_SELECTED_NODES",t[t.UNHIDE_ALL=371]="UNHIDE_ALL",t[t.LOCK_SELECTED_NODES=372]="LOCK_SELECTED_NODES",t[t.LOCK_SELECTED_SECTION_ONLY=373]="LOCK_SELECTED_SECTION_ONLY",t[t.UNLOCK_SELECTED_NODES=374]="UNLOCK_SELECTED_NODES",t[t.TOGGLE_LOCKED_FOR_SELECTED_NODES=375]="TOGGLE_LOCKED_FOR_SELECTED_NODES",t[t.UNLOCK_ALL=376]="UNLOCK_ALL",t[t.DELETE_AND_HEAL_SELECTION=377]="DELETE_AND_HEAL_SELECTION",t[t.JOIN_SELECTION=378]="JOIN_SELECTION",t[t.SMOOTH_JOIN_SELECTION=379]="SMOOTH_JOIN_SELECTION",t[t.BREAK_VECTOR_NETWORK_INTO_PATHS=380]="BREAK_VECTOR_NETWORK_INTO_PATHS",t[t.DESELECT_ALL=381]="DESELECT_ALL",t[t.DELETE_SELECTION=382]="DELETE_SELECTION",t[t.TOGGLE_MENU=383]="TOGGLE_MENU",t[t.INSERT_INTERACTIVE_ELEMENT_INTO_ACTIVE_SLIDE=384]="INSERT_INTERACTIVE_ELEMENT_INTO_ACTIVE_SLIDE",t[t.TOGGLE_PREFERENCES=385]="TOGGLE_PREFERENCES",t[t.ENTER=386]="ENTER",t[t.ESCAPE=387]="ESCAPE",t[t.MULTI_EDIT_TEXT=388]="MULTI_EDIT_TEXT",t[t.FOCUS_MODE=389]="FOCUS_MODE",t[t.FOCUS_MODE_COMPONENT_SET_TOGGLE=390]="FOCUS_MODE_COMPONENT_SET_TOGGLE",t[t.FOCUS_MODE_RESPONSIVE_SET_TOGGLE=391]="FOCUS_MODE_RESPONSIVE_SET_TOGGLE",t[t.FOCUS_MODE_EXIT=392]="FOCUS_MODE_EXIT",t[t.CANVAS_SEARCH=393]="CANVAS_SEARCH",t[t.CANVAS_SEARCH_EXIT=394]="CANVAS_SEARCH_EXIT",t[t.CANVAS_SEARCH_NEXT=395]="CANVAS_SEARCH_NEXT",t[t.CANVAS_SEARCH_PREV=396]="CANVAS_SEARCH_PREV",t[t.CANVAS_SEARCH_REPLACE=397]="CANVAS_SEARCH_REPLACE",t[t.TOGGLE_RETINA_MODE=398]="TOGGLE_RETINA_MODE",t[t.TOGGLE_PIXEL_PREVIEW=399]="TOGGLE_PIXEL_PREVIEW",t[t.TOGGLE_GOOGLE_FONTS=400]="TOGGLE_GOOGLE_FONTS",t[t.TOGGLE_SHOW_SLICES=401]="TOGGLE_SHOW_SLICES",t[t.TOGGLE_SHOW_COMMENTS=402]="TOGGLE_SHOW_COMMENTS",t[t.TOGGLE_SHOW_ANNOTATIONS=403]="TOGGLE_SHOW_ANNOTATIONS",t[t.TOGGLE_SHOW_COMPONENT_ANNOTATIONS=404]="TOGGLE_SHOW_COMPONENT_ANNOTATIONS",t[t.TOGGLE_SHOW_DETACHED_COMPONENT_ANNOTATIONS=405]="TOGGLE_SHOW_DETACHED_COMPONENT_ANNOTATIONS",t[t.TOGGLE_ALWAYS_EXPAND_ANNOTATIONS=406]="TOGGLE_ALWAYS_EXPAND_ANNOTATIONS",t[t.TOGGLE_SHOW_MEASUREMENTS=407]="TOGGLE_SHOW_MEASUREMENTS",t[t.TOGGLE_DROPPER=408]="TOGGLE_DROPPER",t[t.TOGGLE_INVERT_ZOOM=409]="TOGGLE_INVERT_ZOOM",t[t.TOGGLE_CURSOR_HIGH_FIVE_WIGGLE=410]="TOGGLE_CURSOR_HIGH_FIVE_WIGGLE",t[t.TOGGLE_USE_NUMBERS_FOR_OPACITY=411]="TOGGLE_USE_NUMBERS_FOR_OPACITY",t[t.TOGGLE_USE_OLD_OUTLINE_SHORTCUTS=412]="TOGGLE_USE_OLD_OUTLINE_SHORTCUTS",t[t.TOGGLE_TEXT_SUGGESTIONS_PREFERENCE=413]="TOGGLE_TEXT_SUGGESTIONS_PREFERENCE",t[t.TOGGLE_CTRL_CLICK_CONTEXT_MENU=414]="TOGGLE_CTRL_CLICK_CONTEXT_MENU",t[t.SHOW_NUDGE_AMOUNT_PICKER=415]="SHOW_NUDGE_AMOUNT_PICKER",t[t.SET_OPACITY_0=416]="SET_OPACITY_0",t[t.SET_OPACITY_1=417]="SET_OPACITY_1",t[t.SET_OPACITY_2=418]="SET_OPACITY_2",t[t.SET_OPACITY_3=419]="SET_OPACITY_3",t[t.SET_OPACITY_4=420]="SET_OPACITY_4",t[t.SET_OPACITY_5=421]="SET_OPACITY_5",t[t.SET_OPACITY_6=422]="SET_OPACITY_6",t[t.SET_OPACITY_7=423]="SET_OPACITY_7",t[t.SET_OPACITY_8=424]="SET_OPACITY_8",t[t.SET_OPACITY_9=425]="SET_OPACITY_9",t[t.KEYBOARD_LAYOUT_US_QWERTY=426]="KEYBOARD_LAYOUT_US_QWERTY",t[t.KEYBOARD_LAYOUT_FRENCH_AZERTY=427]="KEYBOARD_LAYOUT_FRENCH_AZERTY",t[t.KEYBOARD_LAYOUT_GERMAN=428]="KEYBOARD_LAYOUT_GERMAN",t[t.KEYBOARD_LAYOUT_JAPANESE_KANA=429]="KEYBOARD_LAYOUT_JAPANESE_KANA",t[t.KEYBOARD_LAYOUT_DVORAK=430]="KEYBOARD_LAYOUT_DVORAK",t[t.KEYBOARD_LAYOUT_RESET=431]="KEYBOARD_LAYOUT_RESET",t[t.KEYBOARD_LAYOUT_UK_MAC=432]="KEYBOARD_LAYOUT_UK_MAC",t[t.KEYBOARD_LAYOUT_UK_PC=433]="KEYBOARD_LAYOUT_UK_PC",t[t.KEYBOARD_LAYOUT_SWEDISH=434]="KEYBOARD_LAYOUT_SWEDISH",t[t.KEYBOARD_LAYOUT_FINNISH=435]="KEYBOARD_LAYOUT_FINNISH",t[t.KEYBOARD_LAYOUT_DANISH=436]="KEYBOARD_LAYOUT_DANISH",t[t.KEYBOARD_LAYOUT_NORWEGIAN=437]="KEYBOARD_LAYOUT_NORWEGIAN",t[t.KEYBOARD_LAYOUT_ITALIAN=438]="KEYBOARD_LAYOUT_ITALIAN",t[t.KEYBOARD_LAYOUT_SPANISH=439]="KEYBOARD_LAYOUT_SPANISH",t[t.KEYBOARD_LAYOUT_SPANISH_LATAM=440]="KEYBOARD_LAYOUT_SPANISH_LATAM",t[t.KEYBOARD_LAYOUT_CHINESE=441]="KEYBOARD_LAYOUT_CHINESE",t[t.KEYBOARD_LAYOUT_PORTUGUESE=442]="KEYBOARD_LAYOUT_PORTUGUESE",t[t.KEYBOARD_LAYOUT_KOREAN=443]="KEYBOARD_LAYOUT_KOREAN",t[t.TOGGLE_LEADING_TRIM=444]="TOGGLE_LEADING_TRIM",t[t.TOGGLE_HANGING_PUNCTUATION=445]="TOGGLE_HANGING_PUNCTUATION",t[t.TOGGLE_HANGING_LIST=446]="TOGGLE_HANGING_LIST",t[t.TOGGLE_SPELL_CHECK=447]="TOGGLE_SPELL_CHECK",t[t.REDO_SPELL_CHECKING=448]="REDO_SPELL_CHECKING",t[t.TOGGLE_ENABLE_CODGEN_MCP_SERVER=449]="TOGGLE_ENABLE_CODGEN_MCP_SERVER",t[t.SET_DEFAULT_EMOJI_SKIN_TONE=450]="SET_DEFAULT_EMOJI_SKIN_TONE",t[t.SET_TOOL_FRAME=451]="SET_TOOL_FRAME",t[t.SET_TOOL_SLICE=452]="SET_TOOL_SLICE",t[t.SET_TOOL_SCALE=453]="SET_TOOL_SCALE",t[t.SET_TOOL_TYPE=454]="SET_TOOL_TYPE",t[t.SET_TOOL_LINE=455]="SET_TOOL_LINE",t[t.SET_TOOL_ARROW=456]="SET_TOOL_ARROW",t[t.SET_TOOL_PEN=457]="SET_TOOL_PEN",t[t.SET_TOOL_PENCIL=458]="SET_TOOL_PENCIL",t[t.SET_TOOL_BEND=459]="SET_TOOL_BEND",t[t.SET_TOOL_CUT=460]="SET_TOOL_CUT",t[t.SET_TOOL_OFFSET_PATH=461]="SET_TOOL_OFFSET_PATH",t[t.SET_TOOL_PAINT_BUCKET=462]="SET_TOOL_PAINT_BUCKET",t[t.SET_TOOL_SHAPE_BUILDER=463]="SET_TOOL_SHAPE_BUILDER",t[t.SET_TOOL_VECTOR_LASSO=464]="SET_TOOL_VECTOR_LASSO",t[t.SET_TOOL_VAR_WIDTH_POINT=465]="SET_TOOL_VAR_WIDTH_POINT",t[t.SET_TOOL_STAR=466]="SET_TOOL_STAR",t[t.SET_TOOL_ELLIPSE=467]="SET_TOOL_ELLIPSE",t[t.SET_TOOL_RECTANGLE=468]="SET_TOOL_RECTANGLE",t[t.SET_TOOL_REGULAR_POLYGON=469]="SET_TOOL_REGULAR_POLYGON",t[t.SET_TOOL_DEFAULT=470]="SET_TOOL_DEFAULT",t[t.SET_TOOL_DEFAULT_FIGJAM=471]="SET_TOOL_DEFAULT_FIGJAM",t[t.SET_TOOL_DEFAULT_DEV_HANDOFF=472]="SET_TOOL_DEFAULT_DEV_HANDOFF",t[t.SET_TOOL_HAND=473]="SET_TOOL_HAND",t[t.SET_TOOL_OLD_SELECT=474]="SET_TOOL_OLD_SELECT",t[t.SET_TOOL_MULTISELECT=475]="SET_TOOL_MULTISELECT",t[t.SET_TOOL_LASSO=476]="SET_TOOL_LASSO",t[t.SET_TOOL_COMMENTS=477]="SET_TOOL_COMMENTS",t[t.SPOTLIGHT_ME=478]="SPOTLIGHT_ME",t[t.FOLLOW_PRESENTER=479]="FOLLOW_PRESENTER",t[t.SET_TOOL_CONNECTOR_ELBOWED=480]="SET_TOOL_CONNECTOR_ELBOWED",t[t.SET_TOOL_CONNECTOR_STRAIGHT=481]="SET_TOOL_CONNECTOR_STRAIGHT",t[t.SET_TOOL_CONNECTOR_CURVED=482]="SET_TOOL_CONNECTOR_CURVED",t[t.SET_TOOL_CONNECTOR_STRAIGHT_NO_ENDPOINTS=483]="SET_TOOL_CONNECTOR_STRAIGHT_NO_ENDPOINTS",t[t.SET_TOOL_STICKY=484]="SET_TOOL_STICKY",t[t.SET_TOOL_STAMP=485]="SET_TOOL_STAMP",t[t.SET_TOOL_SHAPE_WHITEBOARD_SQUARE=486]="SET_TOOL_SHAPE_WHITEBOARD_SQUARE",t[t.SET_TOOL_SHAPE_WHITEBOARD_ELLIPSE=487]="SET_TOOL_SHAPE_WHITEBOARD_ELLIPSE",t[t.SET_TOOL_SHAPE_WHITEBOARD_DIAMOND=488]="SET_TOOL_SHAPE_WHITEBOARD_DIAMOND",t[t.SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_UP=489]="SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_UP",t[t.SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_DOWN=490]="SET_TOOL_SHAPE_WHITEBOARD_TRIANGLE_DOWN",t[t.SET_TOOL_SHAPE_WHITEBOARD_ROUNDED_RECTANGLE=491]="SET_TOOL_SHAPE_WHITEBOARD_ROUNDED_RECTANGLE",t[t.SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT=492]="SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT",t[t.SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT=493]="SET_TOOL_SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT",t[t.SET_TOOL_SHAPE_WHITEBOARD_ENG_DATABASE=494]="SET_TOOL_SHAPE_WHITEBOARD_ENG_DATABASE",t[t.SET_TOOL_SHAPE_WHITEBOARD_ENG_QUEUE=495]="SET_TOOL_SHAPE_WHITEBOARD_ENG_QUEUE",t[t.SET_TOOL_SHAPE_WHITEBOARD_ENG_FILE=496]="SET_TOOL_SHAPE_WHITEBOARD_ENG_FILE",t[t.SET_TOOL_SHAPE_WHITEBOARD_ENG_FOLDER=497]="SET_TOOL_SHAPE_WHITEBOARD_ENG_FOLDER",t[t.SET_TOOL_SHAPE_WHITEBOARD_TRAPEZOID=498]="SET_TOOL_SHAPE_WHITEBOARD_TRAPEZOID",t[t.SET_TOOL_SHAPE_WHITEBOARD_STAR=499]="SET_TOOL_SHAPE_WHITEBOARD_STAR",t[t.SET_TOOL_SHAPE_WHITEBOARD_SHIELD=500]="SET_TOOL_SHAPE_WHITEBOARD_SHIELD",t[t.SET_TOOL_SHAPE_WHITEBOARD_HEXAGON=501]="SET_TOOL_SHAPE_WHITEBOARD_HEXAGON",t[t.SET_TOOL_SHAPE_WHITEBOARD_PENTAGON=502]="SET_TOOL_SHAPE_WHITEBOARD_PENTAGON",t[t.SET_TOOL_SHAPE_WHITEBOARD_OCTAGON=503]="SET_TOOL_SHAPE_WHITEBOARD_OCTAGON",t[t.SET_TOOL_SHAPE_WHITEBOARD_PLUS=504]="SET_TOOL_SHAPE_WHITEBOARD_PLUS",t[t.SET_TOOL_SHAPE_WHITEBOARD_PREDEFINED_PROCESS=505]="SET_TOOL_SHAPE_WHITEBOARD_PREDEFINED_PROCESS",t[t.SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_SINGLE=506]="SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_SINGLE",t[t.SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE=507]="SET_TOOL_SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE",t[t.SET_TOOL_SHAPE_WHITEBOARD_MANUAL_INPUT=508]="SET_TOOL_SHAPE_WHITEBOARD_MANUAL_INPUT",t[t.SET_TOOL_SHAPE_WHITEBOARD_CHEVRON=509]="SET_TOOL_SHAPE_WHITEBOARD_CHEVRON",t[t.SET_TOOL_SHAPE_WHITEBOARD_ARROW_LEFT=510]="SET_TOOL_SHAPE_WHITEBOARD_ARROW_LEFT",t[t.SET_TOOL_SHAPE_WHITEBOARD_ARROW_RIGHT=511]="SET_TOOL_SHAPE_WHITEBOARD_ARROW_RIGHT",t[t.SET_TOOL_SHAPE_WHITEBOARD_SUMMING_JUNCTION=512]="SET_TOOL_SHAPE_WHITEBOARD_SUMMING_JUNCTION",t[t.SET_TOOL_SHAPE_WHITEBOARD_OR=513]="SET_TOOL_SHAPE_WHITEBOARD_OR",t[t.SET_TOOL_SHAPE_WHITEBOARD_SPEECH_BUBBLE=514]="SET_TOOL_SHAPE_WHITEBOARD_SPEECH_BUBBLE",t[t.SET_TOOL_SHAPE_WHITEBOARD_INTERNAL_STORAGE=515]="SET_TOOL_SHAPE_WHITEBOARD_INTERNAL_STORAGE",t[t.SET_TOOL_MINDMAP_TREE_NUCLEUS=516]="SET_TOOL_MINDMAP_TREE_NUCLEUS",t[t.SET_TOOL_SHAPE_WHITEBOARD_PLATFORM=517]="SET_TOOL_SHAPE_WHITEBOARD_PLATFORM",t[t.SET_TOOL_ERASER=518]="SET_TOOL_ERASER",t[t.SET_TOOL_HIGHLIGHTER=519]="SET_TOOL_HIGHLIGHTER",t[t.SET_TOOL_SECTION=520]="SET_TOOL_SECTION",t[t.SET_TOOL_WASHI_TAPE=521]="SET_TOOL_WASHI_TAPE",t[t.SET_TOOL_TABLE=522]="SET_TOOL_TABLE",t[t.SET_TOOL_ANNOTATE=523]="SET_TOOL_ANNOTATE",t[t.START_MAGIC_LINK=524]="START_MAGIC_LINK",t[t.END_MAGIC_LINK=525]="END_MAGIC_LINK",t[t.OPEN_MAKE_PROTOTYPE_MODAL=526]="OPEN_MAKE_PROTOTYPE_MODAL",t[t.SET_TOOL_MEASURE=527]="SET_TOOL_MEASURE",t[t.SET_TOOL_BRUSH=528]="SET_TOOL_BRUSH",t[t.SET_TOOL_KEYBOARD_SELECT=529]="SET_TOOL_KEYBOARD_SELECT",t[t.SET_TOOL_SLIDES_POLL=530]="SET_TOOL_SLIDES_POLL",t[t.SET_TOOL_SLIDES_EMBED=531]="SET_TOOL_SLIDES_EMBED",t[t.SET_TOOL_SLIDES_FACEPILE=532]="SET_TOOL_SLIDES_FACEPILE",t[t.SET_TOOL_SLIDES_ALIGNMENT_SCALE=533]="SET_TOOL_SLIDES_ALIGNMENT_SCALE",t[t.SET_TOOL_SLIDES_YOUTUBE=534]="SET_TOOL_SLIDES_YOUTUBE",t[t.SET_TOOL_SLIDE_NUMBER=535]="SET_TOOL_SLIDE_NUMBER",t[t.SET_TOOL_SITES_RESPONSIVE_SET=536]="SET_TOOL_SITES_RESPONSIVE_SET",t[t.SET_TOOL_SITES_LINK=537]="SET_TOOL_SITES_LINK",t[t.SET_TOOL_SITES_EMBED=538]="SET_TOOL_SITES_EMBED",t[t.SET_TOOL_CODE_COMPONENT=539]="SET_TOOL_CODE_COMPONENT",t[t.SET_TOOL_PATTERN_SOURCE_SELECTOR=540]="SET_TOOL_PATTERN_SOURCE_SELECTOR",t[t.SET_TOOL_JSX=541]="SET_TOOL_JSX",t[t.TOGGLE_SECTION_VISIBILITY=542]="TOGGLE_SECTION_VISIBILITY",t[t.OPEN_TIMER=543]="OPEN_TIMER",t[t.SET_TOOL_CODE_BLOCK=544]="SET_TOOL_CODE_BLOCK",t[t.ADD_CONNECTOR_TEXT=545]="ADD_CONNECTOR_TEXT",t[t.TOGGLE_ICON_DETECTION=546]="TOGGLE_ICON_DETECTION",t[t.TOGGLE_SHOW_GUIDS=547]="TOGGLE_SHOW_GUIDS",t[t.TEST_INDEPENDENT_LAYER_ANIMATION=548]="TEST_INDEPENDENT_LAYER_ANIMATION",t[t.TEST_INDEPENDENT_LAYER_ANIMATION_EASED=549]="TEST_INDEPENDENT_LAYER_ANIMATION_EASED",t[t.TEST_INDEPENDENT_LAYER_ANIMATION_OPACITY=550]="TEST_INDEPENDENT_LAYER_ANIMATION_OPACITY",t[t.TEST_NON_INDEPENDENT_LAYER_ANIMATION=551]="TEST_NON_INDEPENDENT_LAYER_ANIMATION",t[t.PRINT_VECTOR_NETWORK_AS_TEST_CODE=552]="PRINT_VECTOR_NETWORK_AS_TEST_CODE",t[t.DEBUG_TOGGLE_SHOW_VECTOR_NETWORK_LABELS=553]="DEBUG_TOGGLE_SHOW_VECTOR_NETWORK_LABELS",t[t.DOWNGRADE_VECTOR_OPERATION_VERSION=554]="DOWNGRADE_VECTOR_OPERATION_VERSION",t[t.FORCE_PUBLISH_STATE_GROUP=555]="FORCE_PUBLISH_STATE_GROUP",t[t.INSPECT_IN_FIGMASCOPE=556]="INSPECT_IN_FIGMASCOPE",t[t.TOGGLE_SHOW_QUICK_COMMAND_RANK_DEBUG=557]="TOGGLE_SHOW_QUICK_COMMAND_RANK_DEBUG",t[t.TOGGLE_SHOW_IMMUTABLE_FRAME_SUBLAYERS=558]="TOGGLE_SHOW_IMMUTABLE_FRAME_SUBLAYERS",t[t.TOGGLE_RESOURCE_USE=559]="TOGGLE_RESOURCE_USE",t[t.TOGGLE_MEMORY_USAGE_INDICATOR=560]="TOGGLE_MEMORY_USAGE_INDICATOR",t[t.TOGGLE_RULERS=561]="TOGGLE_RULERS",t[t.TOGGLE_PRINT_MARKS=562]="TOGGLE_PRINT_MARKS",t[t.TOGGLE_RULER_UNIT_PIXELS=563]="TOGGLE_RULER_UNIT_PIXELS",t[t.TOGGLE_RULER_UNIT_INCHES=564]="TOGGLE_RULER_UNIT_INCHES",t[t.TOGGLE_RULER_UNIT_CENTIMETERS=565]="TOGGLE_RULER_UNIT_CENTIMETERS",t[t.RULER_MENU=566]="RULER_MENU",t[t.TOGGLE_STACK_DEBUG_MODE=567]="TOGGLE_STACK_DEBUG_MODE",t[t.TOGGLE_STACK_SHADOWS=568]="TOGGLE_STACK_SHADOWS",t[t.TOGGLE_DYNAMIC_INSERTION_POINTS=569]="TOGGLE_DYNAMIC_INSERTION_POINTS",t[t.TOGGLE_AUTO_FILL_FULL_WIDTH_CHILDREN=570]="TOGGLE_AUTO_FILL_FULL_WIDTH_CHILDREN",t[t.RUN_MULTI_STACK_AUTO_LAYOUT=571]="RUN_MULTI_STACK_AUTO_LAYOUT",t[t.RUN_SET_RESPONSIVE_SETTINGS=572]="RUN_SET_RESPONSIVE_SETTINGS",t[t.DESTROY_ALL_AUTO_LAYOUT=573]="DESTROY_ALL_AUTO_LAYOUT",t[t.TOGGLE_ANNOTATIONS=574]="TOGGLE_ANNOTATIONS",t[t.TOGGLE_GRID=575]="TOGGLE_GRID",t[t.TOGGLE_PERF_HUD=576]="TOGGLE_PERF_HUD",t[t.TOGGLE_FAKE_MP_ACTIVITY=577]="TOGGLE_FAKE_MP_ACTIVITY",t[t.TOGGLE_TSMER_CONFIG=578]="TOGGLE_TSMER_CONFIG",t[t.TOGGLE_DEBUG_DOC_SYNC_LOGS=579]="TOGGLE_DEBUG_DOC_SYNC_LOGS",t[t.TOGGLE_DEBUG_USER_SYNC_LOGS=580]="TOGGLE_DEBUG_USER_SYNC_LOGS",t[t.TOGGLE_DEBUG_PAGE_SYNC_LOGS=581]="TOGGLE_DEBUG_PAGE_SYNC_LOGS",t[t.DEBUG_INCREMENTAL_LOADING_ALL_PAGES=582]="DEBUG_INCREMENTAL_LOADING_ALL_PAGES",t[t.DEBUG_INCREMENTAL_LOADING_CURRENT_ONLY=583]="DEBUG_INCREMENTAL_LOADING_CURRENT_ONLY",t[t.TOGGLE_DEBUG_LAYOUT_LOGS=584]="TOGGLE_DEBUG_LAYOUT_LOGS",t[t.TOGGLE_DEBUG_MATERIALIZER_LOGS=585]="TOGGLE_DEBUG_MATERIALIZER_LOGS",t[t.CLEAR_CONSTRAINT_INFO=586]="CLEAR_CONSTRAINT_INFO",t[t.TOGGLE_OUTLINES=587]="TOGGLE_OUTLINES",t[t.TOGGLE_OUTLINE_HIDDEN_LAYERS=588]="TOGGLE_OUTLINE_HIDDEN_LAYERS",t[t.TOGGLE_OUTLINE_OBJECT_BOUNDS=589]="TOGGLE_OUTLINE_OBJECT_BOUNDS",t[t.TOGGLE_SHOWN_LAYOUT_GRIDS=590]="TOGGLE_SHOWN_LAYOUT_GRIDS",t[t.TOGGLE_SHOW_MASKS=591]="TOGGLE_SHOW_MASKS",t[t.TOGGLE_SHOW_ARTBOARD_OUTLINES=592]="TOGGLE_SHOW_ARTBOARD_OUTLINES",t[t.TOGGLE_USE_REALMS_FOR_PLUGIN_DEV=593]="TOGGLE_USE_REALMS_FOR_PLUGIN_DEV",t[t.CLEAR_TOOL=594]="CLEAR_TOOL",t[t.PLACE_ALL_IMAGES=595]="PLACE_ALL_IMAGES",t[t.DISCARD_ALL_IMAGES=596]="DISCARD_ALL_IMAGES",t[t.TOGGLE_PEN_TOOL_AVOID_SINGLE_HANDLES=597]="TOGGLE_PEN_TOOL_AVOID_SINGLE_HANDLES",t[t.TOGGLE_SNAPPING_TO_DOTS=598]="TOGGLE_SNAPPING_TO_DOTS",t[t.TOGGLE_SHOW_DOT_GRID=599]="TOGGLE_SHOW_DOT_GRID",t[t.TOGGLE_SCROLL_WHEEL_ZOOM=600]="TOGGLE_SCROLL_WHEEL_ZOOM",t[t.TOGGLE_RIGHT_CLICK_PAN=601]="TOGGLE_RIGHT_CLICK_PAN",t[t.SET_SCROLL_WHEEL_ZOOM_ENABLED=602]="SET_SCROLL_WHEEL_ZOOM_ENABLED",t[t.SET_SCROLL_WHEEL_ZOOM_DISABLED=603]="SET_SCROLL_WHEEL_ZOOM_DISABLED",t[t.SET_RIGHT_CLICK_PAN_ENABLED=604]="SET_RIGHT_CLICK_PAN_ENABLED",t[t.SET_RIGHT_CLICK_PAN_DISABLED=605]="SET_RIGHT_CLICK_PAN_DISABLED",t[t.REMOVE_INTERACTIONS_ON_SELECTION=606]="REMOVE_INTERACTIONS_ON_SELECTION",t[t.REMOVE_INTERACTIONS_ON_PAGE=607]="REMOVE_INTERACTIONS_ON_PAGE",t[t.ADD_PROTOTYPE_STARTING_POINT=608]="ADD_PROTOTYPE_STARTING_POINT",t[t.DELETE_PROTOTYPE_STARTING_POINT=609]="DELETE_PROTOTYPE_STARTING_POINT",t[t.UPDATE_INTERACTIONS_STATE_MANAGEMENT_ON_PAGE=610]="UPDATE_INTERACTIONS_STATE_MANAGEMENT_ON_PAGE",t[t.TOGGLE_INLINE_PREVIEW=611]="TOGGLE_INLINE_PREVIEW",t[t.TOGGLE_INLINE_HTML_PREVIEW=612]="TOGGLE_INLINE_HTML_PREVIEW",t[t.INLINE_PREVIEW_RESET_SIZE=613]="INLINE_PREVIEW_RESET_SIZE",t[t.INLINE_PREVIEW_LOADED=614]="INLINE_PREVIEW_LOADED",t[t.INLINE_PREVIEW_PRESENTED_NODE_CHANGED=615]="INLINE_PREVIEW_PRESENTED_NODE_CHANGED",t[t.INLINE_PREVIEW_IFRAME_FOCUS_STATE_CHANGED=616]="INLINE_PREVIEW_IFRAME_FOCUS_STATE_CHANGED",t[t.OPEN_HELP=617]="OPEN_HELP",t[t.OPEN_SHORTCUTS=618]="OPEN_SHORTCUTS",t[t.OPEN_SUPPORT_FORUM=619]="OPEN_SUPPORT_FORUM",t[t.OPEN_TUTORIALS=620]="OPEN_TUTORIALS",t[t.OPEN_LEGAL_SUMMARY=621]="OPEN_LEGAL_SUMMARY",t[t.OPEN_RELEASE_NOTES=622]="OPEN_RELEASE_NOTES",t[t.OPEN_ACCOUNT_SETTINGS=623]="OPEN_ACCOUNT_SETTINGS",t[t.OPEN_PREFERENCES_MODAL=624]="OPEN_PREFERENCES_MODAL",t[t.SIMULATE_BACK_TO_FILES=625]="SIMULATE_BACK_TO_FILES",t[t.DUMP_PENDING_REGISTERS=626]="DUMP_PENDING_REGISTERS",t[t.DUMP_UNDO_HISTORY=627]="DUMP_UNDO_HISTORY",t[t.TOGGLE_RECORDING_INTERACTIONS=628]="TOGGLE_RECORDING_INTERACTIONS",t[t.TOGGLE_FEATURE_FLAG_BISECTOR=629]="TOGGLE_FEATURE_FLAG_BISECTOR",t[t.INSERT_LOTS_OF_TEXT=630]="INSERT_LOTS_OF_TEXT",t[t.ADD_FILL_TO_SELECTION=631]="ADD_FILL_TO_SELECTION",t[t.ADD_STROKE_TO_SELECTION=632]="ADD_STROKE_TO_SELECTION",t[t.ADD_FILL_TO_STYLE_SELECTION=633]="ADD_FILL_TO_STYLE_SELECTION",t[t.NEXT_ARTBOARD=634]="NEXT_ARTBOARD",t[t.PREVIOUS_ARTBOARD=635]="PREVIOUS_ARTBOARD",t[t.NEXT_ARTBOARD_SAME_ZOOM=636]="NEXT_ARTBOARD_SAME_ZOOM",t[t.PREVIOUS_ARTBOARD_SAME_ZOOM=637]="PREVIOUS_ARTBOARD_SAME_ZOOM",t[t.TEST_MULTIPLAYER_UPGRADE=638]="TEST_MULTIPLAYER_UPGRADE",t[t.TEST_REJECT_TOO_OLD=639]="TEST_REJECT_TOO_OLD",t[t.TEST_REJECT_INVALID_PERMISSIONS=640]="TEST_REJECT_INVALID_PERMISSIONS",t[t.TEST_REJECT_NOT_LOGGED_IN=641]="TEST_REJECT_NOT_LOGGED_IN",t[t.TEST_REJECT_TOO_MANY_CONNECTIONS=642]="TEST_REJECT_TOO_MANY_CONNECTIONS",t[t.PLUGINS_RUN_LAST=643]="PLUGINS_RUN_LAST",t[t.VIEW_WIDGET_DETAILS=644]="VIEW_WIDGET_DETAILS",t[t.OPEN_BROWSE_ALL_RESOURCES_MODAL=645]="OPEN_BROWSE_ALL_RESOURCES_MODAL",t[t.ENTER_DRAW_MODE=646]="ENTER_DRAW_MODE",t[t.ENTER_INSPECT_MODE=647]="ENTER_INSPECT_MODE",t[t.ENTER_DESIGN_MODE=648]="ENTER_DESIGN_MODE",t[t.ENTER_SLIDES_MODE=649]="ENTER_SLIDES_MODE",t[t.ENTER_SLIDES_DESIGN_MODE=650]="ENTER_SLIDES_DESIGN_MODE",t[t.SHOW_DESIGN_PANEL=651]="SHOW_DESIGN_PANEL",t[t.SHOW_PROTOTYPE_PANEL=652]="SHOW_PROTOTYPE_PANEL",t[t.SHOW_DEV_MODE_INSPECT_PANEL=653]="SHOW_DEV_MODE_INSPECT_PANEL",t[t.SHOW_DEV_MODE_PLUGINS_PANEL=654]="SHOW_DEV_MODE_PLUGINS_PANEL",t[t.TOGGLE_PROTOTYPING_INFO=655]="TOGGLE_PROTOTYPING_INFO",t[t.TOGGLE_ANIMATE_INFO=656]="TOGGLE_ANIMATE_INFO",t[t.ENTER_FOCUS_VIEW=657]="ENTER_FOCUS_VIEW",t[t.EXIT_FOCUS_VIEW=658]="EXIT_FOCUS_VIEW",t[t.TOGGLE_GRID_FOCUS_VIEW=659]="TOGGLE_GRID_FOCUS_VIEW",t[t.SHOW_CODE_PANEL=660]="SHOW_CODE_PANEL",t[t.DEBUG_SELECTION=661]="DEBUG_SELECTION",t[t.DOWNLOAD_WEBGL_TRACE=662]="DOWNLOAD_WEBGL_TRACE",t[t.EXPORT_ALL_FRAMES_TO_PDF=663]="EXPORT_ALL_FRAMES_TO_PDF",t[t.EXPORT_SLIDES_TO_PDF=664]="EXPORT_SLIDES_TO_PDF",t[t.PRINT_IMAGE_DIAGNOSTICS=665]="PRINT_IMAGE_DIAGNOSTICS",t[t.PRINT_RENDER_TREE=666]="PRINT_RENDER_TREE",t[t.ADD_TABLE_ROW_ABOVE=667]="ADD_TABLE_ROW_ABOVE",t[t.ADD_TABLE_ROW_BELOW=668]="ADD_TABLE_ROW_BELOW",t[t.MOVE_TABLE_ROW_UP=669]="MOVE_TABLE_ROW_UP",t[t.MOVE_TABLE_ROW_DOWN=670]="MOVE_TABLE_ROW_DOWN",t[t.ADD_TABLE_COLUMN_BEFORE=671]="ADD_TABLE_COLUMN_BEFORE",t[t.ADD_TABLE_COLUMN_AFTER=672]="ADD_TABLE_COLUMN_AFTER",t[t.MOVE_TABLE_COLUMN_LEFT=673]="MOVE_TABLE_COLUMN_LEFT",t[t.MOVE_TABLE_COLUMN_RIGHT=674]="MOVE_TABLE_COLUMN_RIGHT",t[t.DELETE_TABLE_CONTENTS=675]="DELETE_TABLE_CONTENTS",t[t.DELETE_CURRENT_TABLE_COLUMN=676]="DELETE_CURRENT_TABLE_COLUMN",t[t.DELETE_CURRENT_TABLE_ROW=677]="DELETE_CURRENT_TABLE_ROW",t[t.ADD_DEFAULT_CELL_STYLES_TO_TABLES=678]="ADD_DEFAULT_CELL_STYLES_TO_TABLES",t[t.TEST_ACTION=679]="TEST_ACTION",t[t.DEBUG_TOGGLE_WHITEBOARD_MODE=680]="DEBUG_TOGGLE_WHITEBOARD_MODE",t[t.DEBUG_TOGGLE_SLIDES_MODE=681]="DEBUG_TOGGLE_SLIDES_MODE",t[t.DEBUG_SET_SLIDES_GRID_MODE=682]="DEBUG_SET_SLIDES_GRID_MODE",t[t.DEBUG_TOGGLE_SITES_MODE=683]="DEBUG_TOGGLE_SITES_MODE",t[t.DEBUG_TOGGLE_FIGMAKE_MODE=684]="DEBUG_TOGGLE_FIGMAKE_MODE",t[t.DEBUG_LOG_CANVAS_SEARCH_INDEX=685]="DEBUG_LOG_CANVAS_SEARCH_INDEX",t[t.SET_IMAGE_AS_PROFILE_PICTURE=686]="SET_IMAGE_AS_PROFILE_PICTURE",t[t.TOGGLE_STRAIGHT_PENCIL=687]="TOGGLE_STRAIGHT_PENCIL",t[t.PRESENT_AS_PROTOTYPE=688]="PRESENT_AS_PROTOTYPE",t[t.PRESENT_SITES_FULL_PREVIEW=689]="PRESENT_SITES_FULL_PREVIEW",t[t.PRESENT_SLIDES_AUDIENCE_VIEW=690]="PRESENT_SLIDES_AUDIENCE_VIEW",t[t.PRESENT_SLIDES_PRESENTER_VIEW=691]="PRESENT_SLIDES_PRESENTER_VIEW",t[t.TOGGLE_COOPER_TOOL_MODE=692]="TOGGLE_COOPER_TOOL_MODE",t[t.COOPER_MAKE_BRAND_TEMPLATES=693]="COOPER_MAKE_BRAND_TEMPLATES",t[t.ASSIGN_DOCUMENT_COLOR_PROFILE_LEGACY=694]="ASSIGN_DOCUMENT_COLOR_PROFILE_LEGACY",t[t.ASSIGN_DOCUMENT_COLOR_PROFILE_DISPLAY_P3=695]="ASSIGN_DOCUMENT_COLOR_PROFILE_DISPLAY_P3",t[t.CONVERT_DOCUMENT_COLOR_PROFILE_DISPLAY_P3=696]="CONVERT_DOCUMENT_COLOR_PROFILE_DISPLAY_P3",t[t.ASSIGN_DOCUMENT_COLOR_PROFILE_SRGB=697]="ASSIGN_DOCUMENT_COLOR_PROFILE_SRGB",t[t.CONVERT_DOCUMENT_COLOR_PROFILE_SRGB=698]="CONVERT_DOCUMENT_COLOR_PROFILE_SRGB",t[t.CHANGE_DOCUMENT_COLOR_PROFILE_TO_DISPLAY_P3=699]="CHANGE_DOCUMENT_COLOR_PROFILE_TO_DISPLAY_P3",t[t.CHANGE_DOCUMENT_COLOR_PROFILE_TO_SRGB=700]="CHANGE_DOCUMENT_COLOR_PROFILE_TO_SRGB",t[t.TOGGLE_OVERLAY_UI_RENDERING=701]="TOGGLE_OVERLAY_UI_RENDERING",t[t.TOGGLE_ALLOW_TIME_SLICED_EDIT_RENDERING_OPTIMIZATION=702]="TOGGLE_ALLOW_TIME_SLICED_EDIT_RENDERING_OPTIMIZATION",t[t.TOGGLE_SYNC_CURSOR_RENDERING=703]="TOGGLE_SYNC_CURSOR_RENDERING",t[t.SIMPLIFY_SELECTED_INSTANCE_PANELS=704]="SIMPLIFY_SELECTED_INSTANCE_PANELS",t[t.TOGGLE_SIMILAR_DEFINITION=705]="TOGGLE_SIMILAR_DEFINITION",t[t.TOGGLE_SIMILAR_HIGHLIGHTS=706]="TOGGLE_SIMILAR_HIGHLIGHTS",t[t.TOGGLE_NOODLES_WITHOUT_DRAGGING=707]="TOGGLE_NOODLES_WITHOUT_DRAGGING",t[t.DEBUG_MAGIC_LINK_AI_MODEL=708]="DEBUG_MAGIC_LINK_AI_MODEL",t[t.SHOW_PROTOTYPE_INTERACTION_EDIT_MODAL=709]="SHOW_PROTOTYPE_INTERACTION_EDIT_MODAL",t[t.REPORT_NO_VIDEO_UPLOAD_PERMISSIONS=710]="REPORT_NO_VIDEO_UPLOAD_PERMISSIONS",t[t.TOGGLE_DISPLAY_DIRTY_RECTS=711]="TOGGLE_DISPLAY_DIRTY_RECTS",t[t.TOGGLE_DISPLAY_DIRTY_TILES=712]="TOGGLE_DISPLAY_DIRTY_TILES",t[t.TOGGLE_DISPLAY_EXPENSIVE_TILES=713]="TOGGLE_DISPLAY_EXPENSIVE_TILES",t[t.TOGGLE_DISPLAY_GPU_METRICS=714]="TOGGLE_DISPLAY_GPU_METRICS",t[t.TOGGLE_DISPLAY_CPU_TIMER_TREE=715]="TOGGLE_DISPLAY_CPU_TIMER_TREE",t[t.TOGGLE_PERF_MODE_MEDIUM=716]="TOGGLE_PERF_MODE_MEDIUM",t[t.SET_PROTOTYPE_VIEW_PRESENT=717]="SET_PROTOTYPE_VIEW_PRESENT",t[t.SET_PROTOTYPE_VIEW_PREVIEW=718]="SET_PROTOTYPE_VIEW_PREVIEW",t[t.SET_SITES_FULL_PREVIEW=719]="SET_SITES_FULL_PREVIEW",t[t.SET_SITES_INLINE_PREVIEW=720]="SET_SITES_INLINE_PREVIEW",t[t.SET_SLIDES_AUDIENCE_VIEW=721]="SET_SLIDES_AUDIENCE_VIEW",t[t.SET_SLIDES_PRESENTER_VIEW=722]="SET_SLIDES_PRESENTER_VIEW",t[t.DEBUG_TOGGLE_DIAGRAM_LAYOUT_PAUSED=723]="DEBUG_TOGGLE_DIAGRAM_LAYOUT_PAUSED",t[t.START_MIND_MAP=724]="START_MIND_MAP",t[t.REMOVE_IMAGE_BACKGROUND=725]="REMOVE_IMAGE_BACKGROUND",t[t.UPSCALE_IMAGE=726]="UPSCALE_IMAGE",t[t.GENERATE_IMAGE=727]="GENERATE_IMAGE",t[t.EDIT_IMAGE=728]="EDIT_IMAGE",t[t.AUTO_RENAME_LAYERS=729]="AUTO_RENAME_LAYERS",t[t.MAGIC_LINK=730]="MAGIC_LINK",t[t.FIRST_DRAFT=731]="FIRST_DRAFT",t[t.FIRST_DRAFT_MAKE_CHANGES=732]="FIRST_DRAFT_MAKE_CHANGES",t[t.FIRST_DRAFT_MAKE_KIT=733]="FIRST_DRAFT_MAKE_KIT",t[t.FIRST_DRAFT_MAKE_KIT_DEBUG=734]="FIRST_DRAFT_MAKE_KIT_DEBUG",t[t.FIRST_DRAFT_COMPONENTIZE=735]="FIRST_DRAFT_COMPONENTIZE",t[t.FIRST_DRAFT_SUGGEST_PROPS=736]="FIRST_DRAFT_SUGGEST_PROPS",t[t.FIRST_DRAFT_LINTING=737]="FIRST_DRAFT_LINTING",t[t.FIRST_DRAFT_DEBUG=738]="FIRST_DRAFT_DEBUG",t[t.MAKE_EDITS=739]="MAKE_EDITS",t[t.FIRST_DRAFT_FINE_TUNE=740]="FIRST_DRAFT_FINE_TUNE",t[t.LINK_TO_COMPONENT=741]="LINK_TO_COMPONENT",t[t.LINK_TO_EXISTING_COMPONENT=742]="LINK_TO_EXISTING_COMPONENT",t[t.DETECT_VIOLATIONS=743]="DETECT_VIOLATIONS",t[t.TRANSLATE_TEXT=744]="TRANSLATE_TEXT",t[t.REWRITE_TEXT=745]="REWRITE_TEXT",t[t.SHORTEN_TEXT=746]="SHORTEN_TEXT",t[t.CONTENT_FILL=747]="CONTENT_FILL",t[t.SLIDES_GENERATE_SPEAKER_NOTES=748]="SLIDES_GENERATE_SPEAKER_NOTES",t[t.SLIDES_REWRITE_TEXT=749]="SLIDES_REWRITE_TEXT",t[t.DEBUG_TOGGLE_SHOW_CANVAS_AXIS=750]="DEBUG_TOGGLE_SHOW_CANVAS_AXIS",t[t.DEBUG_TOGGLE_SHOW_MOUSE_POSITION=751]="DEBUG_TOGGLE_SHOW_MOUSE_POSITION",t[t.DEBUG_TOGGLE_WHITEBOARD_PDF_IMPORT_NODE_REPLACEMENT=752]="DEBUG_TOGGLE_WHITEBOARD_PDF_IMPORT_NODE_REPLACEMENT",t[t.TOGGLE_CANVAS_SEARCH_DEBUG=753]="TOGGLE_CANVAS_SEARCH_DEBUG",t[t.TOGGLE_ACCESSIBILITY_DOM_DEBUG=754]="TOGGLE_ACCESSIBILITY_DOM_DEBUG",t[t.OPEN_FPL_DEBUG=755]="OPEN_FPL_DEBUG",t[t.TOGGLE_SHOW_FIGMASCOPE=756]="TOGGLE_SHOW_FIGMASCOPE",t[t.PRINT_AS_TEST_CODE=757]="PRINT_AS_TEST_CODE",t[t.TOGGLE_UNDO_REDO_DEBUG=758]="TOGGLE_UNDO_REDO_DEBUG",t[t.TOGGLE_COLLABORATIVE_TEXT_DEBUG=759]="TOGGLE_COLLABORATIVE_TEXT_DEBUG",t[t.TOGGLE_PLUGIN_API_DEBUG=760]="TOGGLE_PLUGIN_API_DEBUG",t[t.FOCUS_PREVIOUS_AREA=761]="FOCUS_PREVIOUS_AREA",t[t.FOCUS_NEXT_AREA=762]="FOCUS_NEXT_AREA",t[t.CREATE_MAKE_FROM_DESIGN=763]="CREATE_MAKE_FROM_DESIGN",t[t.EDIT_MAKE_FROM_DESIGN=764]="EDIT_MAKE_FROM_DESIGN",t[t.SET_AS_DEFAULT_RESPONSIVE_SET=765]="SET_AS_DEFAULT_RESPONSIVE_SET",t[t.SITES_COPY_LINK=766]="SITES_COPY_LINK",t[t.SITES_FIX_ISSUE=767]="SITES_FIX_ISSUE",t[t.EDIT_CODE=768]="EDIT_CODE",t[t.CREATE_CODE_LAYER_FROM_DESIGN=769]="CREATE_CODE_LAYER_FROM_DESIGN",t[t.BULK_EXPORT_DESIGN_TO_REACT=770]="BULK_EXPORT_DESIGN_TO_REACT",t[t.RESTORE_DESIGN_IN_PLACE_FROM_CODE=771]="RESTORE_DESIGN_IN_PLACE_FROM_CODE",t[t.COPY_OUT_DESIGN_FROM_CODE=772]="COPY_OUT_DESIGN_FROM_CODE",t[t.SET_SITES_VIEW_FILE=773]="SET_SITES_VIEW_FILE",t[t.SET_SITES_VIEW_CODE=774]="SET_SITES_VIEW_CODE",t[t.SET_SITES_VIEW_CMS=775]="SET_SITES_VIEW_CMS",t[t.SET_SITES_INSERTS_OVERLAY=776]="SET_SITES_INSERTS_OVERLAY",t[t.GO_TO_REPEATER_COMPONENT=777]="GO_TO_REPEATER_COMPONENT",t[t.CREATE_CMS_RICH_TEXT=778]="CREATE_CMS_RICH_TEXT",t[t.DETACH_CMS_RICH_TEXT=779]="DETACH_CMS_RICH_TEXT",t[t.UNBIND_SELECTION=780]="UNBIND_SELECTION",t[t.FOCUS_NEXT_SLIDE=781]="FOCUS_NEXT_SLIDE",t[t.FOCUS_PREVIOUS_SLIDE=782]="FOCUS_PREVIOUS_SLIDE",t[t.FOCUS_SLIDE_UP=783]="FOCUS_SLIDE_UP",t[t.FOCUS_SLIDE_DOWN=784]="FOCUS_SLIDE_DOWN",t[t.SKIP_SLIDE=785]="SKIP_SLIDE",t[t.UNSKIP_SLIDE=786]="UNSKIP_SLIDE",t[t.SKIP_SLIDES=787]="SKIP_SLIDES",t[t.UNSKIP_SLIDES=788]="UNSKIP_SLIDES",t[t.ADD_SLIDE_OBJECT_ANIMATION=789]="ADD_SLIDE_OBJECT_ANIMATION",t[t.INSERT_SLIDE_NUMBERS_ALL_SLIDES=790]="INSERT_SLIDE_NUMBERS_ALL_SLIDES",t[t.FOCUS_NEXT_ASSET=791]="FOCUS_NEXT_ASSET",t[t.FOCUS_PREVIOUS_ASSET=792]="FOCUS_PREVIOUS_ASSET",t[t.ADD_PLATFORM_SHAPE_DEFINITION=793]="ADD_PLATFORM_SHAPE_DEFINITION",t[t.REMOVE_PLATFORM_SHAPE_DEFINITION=794]="REMOVE_PLATFORM_SHAPE_DEFINITION",t[t.OPEN_SHAPES_SIDEBAR=795]="OPEN_SHAPES_SIDEBAR",t[t.WHITEBOARD_GENERATE_CONTENT=796]="WHITEBOARD_GENERATE_CONTENT",t[t.SUMMARIZE_STICKIES=797]="SUMMARIZE_STICKIES",t[t.SORT_STICKIES_BY_TOPIC=798]="SORT_STICKIES_BY_TOPIC",t[t.SORT_STICKIES_BY_COLOR=799]="SORT_STICKIES_BY_COLOR",t[t.SORT_STICKIES_BY_AUTHOR=800]="SORT_STICKIES_BY_AUTHOR",t[t.SORT_STICKIES_BY_STAMP_COUNT=801]="SORT_STICKIES_BY_STAMP_COUNT",t[t.SORT_STICKIES_BY_STAMP_TYPE=802]="SORT_STICKIES_BY_STAMP_TYPE",t[t.MIND_MAP_GENERATE_IDEAS=803]="MIND_MAP_GENERATE_IDEAS",t[t.CREATE_IDEAS=804]="CREATE_IDEAS",t[t.ASSISTANT_CHAT=805]="ASSISTANT_CHAT",t[t.COPY_TO_FIGMA_SLIDES=806]="COPY_TO_FIGMA_SLIDES",t[t.IMAGE_TO_DESIGN=807]="IMAGE_TO_DESIGN",t[t.IMAGE_TO_DESIGN_ORACLE=808]="IMAGE_TO_DESIGN_ORACLE",t[t.SET_CONSTRAINTS_AUTOMATICALLY=809]="SET_CONSTRAINTS_AUTOMATICALLY",t[t.SET_CONSTRAINTS_MANUALLY=810]="SET_CONSTRAINTS_MANUALLY",t[t.SET_CONSTRAINTS_AUTOMATICALLY_TOGGLE=811]="SET_CONSTRAINTS_AUTOMATICALLY_TOGGLE",t[t.TOGGLE_SMART_TEXT_SUBSTITUTION=812]="TOGGLE_SMART_TEXT_SUBSTITUTION",t[t.EXPORT_SLIDES_TO=813]="EXPORT_SLIDES_TO",t[t.ENTER_STAGING_MODE=814]="ENTER_STAGING_MODE",t[t.COMMIT_STAGED_CHANGES=815]="COMMIT_STAGED_CHANGES",t[t.ROLLBACK_STAGED_CHANGES=816]="ROLLBACK_STAGED_CHANGES"})($R||($R={}));var ey;(function(t){t[t.LAYOUT=0]="LAYOUT",t[t.HISTORY=1]="HISTORY",t[t.PREVIEW=2]="PREVIEW",t[t.BRANCHING=3]="BRANCHING",t[t.DEV_HANDOFF=4]="DEV_HANDOFF",t[t.LIBRARY=5]="LIBRARY"})(ey||(ey={}));var ty;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DRAGGING=1]="DRAGGING",t[t.RESIZING=2]="RESIZING",t[t.ROTATING=3]="ROTATING",t[t.SELECTING_TEXT=4]="SELECTING_TEXT",t[t.CLICKING_TO_CHANGE_SELECTION=5]="CLICKING_TO_CHANGE_SELECTION"})(ty||(ty={}));var ry;(function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON",t[t.MIXED=2]="MIXED"})(ry||(ry={}));var ny;(function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR"})(ny||(ny={}));var oy;(function(t){t[t.NONE=0]="NONE",t[t.PHONE=1]="PHONE",t[t.TABLET=2]="TABLET",t[t.DESKTOP=3]="DESKTOP",t[t.WATCH=4]="WATCH",t[t.PAPER=5]="PAPER",t[t.SOCIALMEDIA=6]="SOCIALMEDIA",t[t.FIGMA=7]="FIGMA",t[t.PRESENTATION=8]="PRESENTATION",t[t.ARCHIVE=9]="ARCHIVE"})(oy||(oy={}));var iy;(function(t){t[t.NONE=0]="NONE",t[t.SELECT=1]="SELECT",t[t.HAND=2]="HAND",t[t.COMMENTS=3]="COMMENTS",t[t.DROPPER_COLOR=4]="DROPPER_COLOR",t[t.FRAME=5]="FRAME",t[t.SLICE=6]="SLICE",t[t.STACK=7]="STACK",t[t.SHAPE_STAR=8]="SHAPE_STAR",t[t.SHAPE_LINE=9]="SHAPE_LINE",t[t.SHAPE_ARROW=10]="SHAPE_ARROW",t[t.SHAPE_ELLIPSE=11]="SHAPE_ELLIPSE",t[t.SHAPE_RECTANGLE=12]="SHAPE_RECTANGLE",t[t.SHAPE_REGULAR_POLYGON=13]="SHAPE_REGULAR_POLYGON",t[t.VECTOR_PEN=14]="VECTOR_PEN",t[t.VECTOR_PENCIL=15]="VECTOR_PENCIL",t[t.VECTOR_BEND=16]="VECTOR_BEND",t[t.VECTOR_CUT=17]="VECTOR_CUT",t[t.VECTOR_PAINT_BUCKET=18]="VECTOR_PAINT_BUCKET",t[t.VECTOR_VAR_WIDTH_POINT=19]="VECTOR_VAR_WIDTH_POINT",t[t.SHAPE_BUILDER=20]="SHAPE_BUILDER",t[t.VECTOR_LASSO=21]="VECTOR_LASSO",t[t.TYPE=22]="TYPE",t[t.SCALE=23]="SCALE",t[t.STICKY=24]="STICKY",t[t.STAMP=25]="STAMP",t[t.SHAPE_WHITEBOARD_SQUARE=26]="SHAPE_WHITEBOARD_SQUARE",t[t.SHAPE_WHITEBOARD_ELLIPSE=27]="SHAPE_WHITEBOARD_ELLIPSE",t[t.SHAPE_WHITEBOARD_DIAMOND=28]="SHAPE_WHITEBOARD_DIAMOND",t[t.SHAPE_WHITEBOARD_TRIANGLE_UP=29]="SHAPE_WHITEBOARD_TRIANGLE_UP",t[t.SHAPE_WHITEBOARD_TRIANGLE_DOWN=30]="SHAPE_WHITEBOARD_TRIANGLE_DOWN",t[t.SHAPE_WHITEBOARD_ROUNDED_RECTANGLE=31]="SHAPE_WHITEBOARD_ROUNDED_RECTANGLE",t[t.SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT=32]="SHAPE_WHITEBOARD_PARALLELOGRAM_RIGHT",t[t.SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT=33]="SHAPE_WHITEBOARD_PARALLELOGRAM_LEFT",t[t.CONNECTOR_ELBOWED=34]="CONNECTOR_ELBOWED",t[t.CONNECTOR_STRAIGHT=35]="CONNECTOR_STRAIGHT",t[t.CONNECTOR_CURVED=36]="CONNECTOR_CURVED",t[t.CODE_BLOCK=37]="CODE_BLOCK",t[t.SHAPE_WHITEBOARD_ENG_DATABASE=38]="SHAPE_WHITEBOARD_ENG_DATABASE",t[t.SHAPE_WHITEBOARD_ENG_QUEUE=39]="SHAPE_WHITEBOARD_ENG_QUEUE",t[t.SHAPE_WHITEBOARD_ENG_FILE=40]="SHAPE_WHITEBOARD_ENG_FILE",t[t.SHAPE_WHITEBOARD_ENG_FOLDER=41]="SHAPE_WHITEBOARD_ENG_FOLDER",t[t.ERASER=42]="ERASER",t[t.HIGHLIGHTER=43]="HIGHLIGHTER",t[t.SECTION=44]="SECTION",t[t.WASHI_TAPE=45]="WASHI_TAPE",t[t.TABLE=46]="TABLE",t[t.SHAPE_WHITEBOARD_TRAPEZOID=47]="SHAPE_WHITEBOARD_TRAPEZOID",t[t.SHAPE_WHITEBOARD_STAR=48]="SHAPE_WHITEBOARD_STAR",t[t.SHAPE_WHITEBOARD_SHIELD=49]="SHAPE_WHITEBOARD_SHIELD",t[t.SHAPE_WHITEBOARD_HEXAGON=50]="SHAPE_WHITEBOARD_HEXAGON",t[t.SHAPE_WHITEBOARD_PENTAGON=51]="SHAPE_WHITEBOARD_PENTAGON",t[t.SHAPE_WHITEBOARD_OCTAGON=52]="SHAPE_WHITEBOARD_OCTAGON",t[t.SHAPE_WHITEBOARD_PLUS=53]="SHAPE_WHITEBOARD_PLUS",t[t.SHAPE_WHITEBOARD_PREDEFINED_PROCESS=54]="SHAPE_WHITEBOARD_PREDEFINED_PROCESS",t[t.SHAPE_WHITEBOARD_MANUAL_INPUT=55]="SHAPE_WHITEBOARD_MANUAL_INPUT",t[t.SHAPE_WHITEBOARD_CHEVRON=56]="SHAPE_WHITEBOARD_CHEVRON",t[t.SHAPE_WHITEBOARD_DOCUMENT_SINGLE=57]="SHAPE_WHITEBOARD_DOCUMENT_SINGLE",t[t.SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE=58]="SHAPE_WHITEBOARD_DOCUMENT_MULTIPLE",t[t.SHAPE_WHITEBOARD_ARROW_LEFT=59]="SHAPE_WHITEBOARD_ARROW_LEFT",t[t.SHAPE_WHITEBOARD_ARROW_RIGHT=60]="SHAPE_WHITEBOARD_ARROW_RIGHT",t[t.SHAPE_WHITEBOARD_SUMMING_JUNCTION=61]="SHAPE_WHITEBOARD_SUMMING_JUNCTION",t[t.SHAPE_WHITEBOARD_OR=62]="SHAPE_WHITEBOARD_OR",t[t.SHAPE_WHITEBOARD_SPEECH_BUBBLE=63]="SHAPE_WHITEBOARD_SPEECH_BUBBLE",t[t.SHAPE_WHITEBOARD_INTERNAL_STORAGE=64]="SHAPE_WHITEBOARD_INTERNAL_STORAGE",t[t.SHAPE_WHITEBOARD_MINDMAP_TREE_NUCLEUS=65]="SHAPE_WHITEBOARD_MINDMAP_TREE_NUCLEUS",t[t.SHAPE_WHITEBOARD_PLATFORM=66]="SHAPE_WHITEBOARD_PLATFORM",t[t.ANNOTATE=67]="ANNOTATE",t[t.IMAGE_OR_VIDEO=68]="IMAGE_OR_VIDEO",t[t.MEASURE=69]="MEASURE",t[t.SLIDES_POLL=70]="SLIDES_POLL",t[t.SLIDES_EMBED=71]="SLIDES_EMBED",t[t.SLIDES_FACEPILE=72]="SLIDES_FACEPILE",t[t.SLIDES_ALIGNMENT_SCALE=73]="SLIDES_ALIGNMENT_SCALE",t[t.SLIDES_YOUTUBE=74]="SLIDES_YOUTUBE",t[t.SLIDE_NUMBER=75]="SLIDE_NUMBER",t[t.HAND_SELECT=76]="HAND_SELECT",t[t.MULTISELECT=77]="MULTISELECT",t[t.LASSO=78]="LASSO",t[t.SITES_RESPONSIVE_SET=79]="SITES_RESPONSIVE_SET",t[t.SITES_LINK=80]="SITES_LINK",t[t.CODE_COMPONENT=81]="CODE_COMPONENT",t[t.SITES_EMBED=82]="SITES_EMBED",t[t.PATTERN_SOURCE_SELECTOR=83]="PATTERN_SOURCE_SELECTOR",t[t.BRUSH=84]="BRUSH",t[t.KEYBOARD_SELECT=85]="KEYBOARD_SELECT",t[t.JSX=86]="JSX",t[t.OFFSET_PATH=87]="OFFSET_PATH"})(iy||(iy={}));var ay;(function(t){t[t.MISSING=0]="MISSING",t[t.PRESENT=1]="PRESENT",t[t.MIXED=2]="MIXED",t[t.MIXED_VALUES_FIRST=3]="MIXED_VALUES_FIRST",t[t.MIXED_VALUES_NEXT=4]="MIXED_VALUES_NEXT"})(ay||(ay={}));var sy;(function(t){t[t.FRAME_PRESETS=0]="FRAME_PRESETS",t[t.PENCIL_TOOL=1]="PENCIL_TOOL",t[t.CANVAS_ITEM=2]="CANVAS_ITEM",t[t.TRANSFORM_ITEM=3]="TRANSFORM_ITEM",t[t.COMPONENT_ITEM=4]="COMPONENT_ITEM",t[t.INSTANCE_ITEM=5]="INSTANCE_ITEM",t[t.STATE_GROUP_ITEM=6]="STATE_GROUP_ITEM",t[t.CONSTRAINTS_ITEM=7]="CONSTRAINTS_ITEM",t[t.VECTOR_ITEM=8]="VECTOR_ITEM",t[t.GRIDS_ITEM=9]="GRIDS_ITEM",t[t.MASK_ITEM=10]="MASK_ITEM",t[t.LAYER_ITEM=11]="LAYER_ITEM",t[t.TYPE_ITEM=12]="TYPE_ITEM",t[t.FILL_ITEM=13]="FILL_ITEM",t[t.STROKE_ITEM=14]="STROKE_ITEM",t[t.EFFECTS_ITEM=15]="EFFECTS_ITEM",t[t.EXPORT_ITEM=16]="EXPORT_ITEM",t[t.STACK_ITEM=17]="STACK_ITEM",t[t.SCALE_ITEM=18]="SCALE_ITEM",t[t.REMOVE_GROUP_BACKGROUND_ITEM=19]="REMOVE_GROUP_BACKGROUND_ITEM",t[t.JSX_ITEM=20]="JSX_ITEM",t[t.OVERFLOW_ITEM=21]="OVERFLOW_ITEM",t[t.SELECTION_COLORS=22]="SELECTION_COLORS",t[t.VARIABLE_MODE_ITEM=23]="VARIABLE_MODE_ITEM",t[t.VARIABLE_PAGE_LEVEL_MODE_ITEM=24]="VARIABLE_PAGE_LEVEL_MODE_ITEM",t[t.SLIDES_ANIMATION=25]="SLIDES_ANIMATION",t[t.SLIDES_OBJECT_ANIMATION=26]="SLIDES_OBJECT_ANIMATION",t[t.SLIDES_EMBED=27]="SLIDES_EMBED",t[t.SLIDES_INTERACTIVE_WIDGET=28]="SLIDES_INTERACTIVE_WIDGET",t[t.SLIDES_OPACITY_ITEM=29]="SLIDES_OPACITY_ITEM",t[t.IMAGE_ITEM=30]="IMAGE_ITEM",t[t.SLIDES_THEME=31]="SLIDES_THEME",t[t.CODE_BLOCK_ITEM=32]="CODE_BLOCK_ITEM",t[t.SLIDE_NUMBER=33]="SLIDE_NUMBER",t[t.SITES_POSITION_ITEM=34]="SITES_POSITION_ITEM",t[t.SITES_LINK_ITEM=35]="SITES_LINK_ITEM",t[t.SITES_PAGE_METADATA_ITEM=36]="SITES_PAGE_METADATA_ITEM",t[t.SITES_ACCESSIBILITY_ITEM=37]="SITES_ACCESSIBILITY_ITEM",t[t.SITES_HTML_WIDGET_ITEM=38]="SITES_HTML_WIDGET_ITEM",t[t.SITES_INTERACTIONS_ITEM=39]="SITES_INTERACTIONS_ITEM",t[t.SITES_RESPONSIVENESS_ITEM=40]="SITES_RESPONSIVENESS_ITEM",t[t.SITES_CODE_COMPONENT_ITEM=41]="SITES_CODE_COMPONENT_ITEM",t[t.TRANSFORM_MODIFIERS_ITEM=42]="TRANSFORM_MODIFIERS_ITEM",t[t.VECTOR_TRANSFORM_UNIFIED_ITEM=43]="VECTOR_TRANSFORM_UNIFIED_ITEM",t[t.SLOT_ITEM=44]="SLOT_ITEM",t[t.NUM_VALUES=45]="NUM_VALUES"})(sy||(sy={}));var ly;(function(t){t[t.FRAME_PRESETS_ITEM=0]="FRAME_PRESETS_ITEM",t[t.CORNER_RADIUS=1]="CORNER_RADIUS",t[t.FRAME_OPTIONS=2]="FRAME_OPTIONS",t[t.COUNT=3]="COUNT",t[t.STAR_INNER_SCALE=4]="STAR_INNER_SCALE",t[t.RECTANGLE_CORNER_RADII=5]="RECTANGLE_CORNER_RADII",t[t.FIXED_FRAME_OPTIONS=6]="FIXED_FRAME_OPTIONS",t[t.ARC_DATA=7]="ARC_DATA",t[t.TRANSFORM=8]="TRANSFORM",t[t.SIZE=9]="SIZE",t[t.ANGLE=10]="ANGLE",t[t.SECTION_ITEM=11]="SECTION_ITEM",t[t.NUM_VALUES=12]="NUM_VALUES"})(ly||(ly={}));var cy;(function(t){t[t.TEXT_ALIGN_HORIZONTAL=0]="TEXT_ALIGN_HORIZONTAL",t[t.TEXT_ALIGN_VERTICAL=1]="TEXT_ALIGN_VERTICAL",t[t.TEXT_AUTO_RESIZE=2]="TEXT_AUTO_RESIZE",t[t.TEXT_STYLE=3]="TEXT_STYLE",t[t.TEXT_TRUNCATION=4]="TEXT_TRUNCATION",t[t.NUM_VALUES=5]="NUM_VALUES"})(cy||(cy={}));var dy;(function(t){t[t.NOT_APPLICABLE=0]="NOT_APPLICABLE",t[t.YES=1]="YES",t[t.NO=2]="NO"})(dy||(dy={}));var uy;(function(t){t[t.STATE_GROUP=0]="STATE_GROUP",t[t.STATE=1]="STATE",t[t.STATE_INSTANCE=2]="STATE_INSTANCE",t[t.STATE_OR_STATE_INSTANCE_SUBLAYER=3]="STATE_OR_STATE_INSTANCE_SUBLAYER",t[t.NON_STATE_COMPONENTS=4]="NON_STATE_COMPONENTS",t[t.NONE=5]="NONE"})(uy||(uy={}));var py;(function(t){t[t.NONE=0]="NONE",t[t.SINGLE_NODE=1]="SINGLE_NODE",t[t.MULTI_NODE=2]="MULTI_NODE"})(py||(py={}));var _y;(function(t){t[t.CANVAS=0]="CANVAS",t[t.PROPERTIES_PANEL=1]="PROPERTIES_PANEL",t[t.DRAG_TO_CREATE=2]="DRAG_TO_CREATE"})(_y||(_y={}));var hy;(function(t){t[t.NONE=0]="NONE",t[t.CONNECTOR=1]="CONNECTOR",t[t.LINE=2]="LINE",t[t.VECTOR=3]="VECTOR",t[t.VERTEX=4]="VERTEX",t[t.ENDPOINT=5]="ENDPOINT",t[t.PENCIL=6]="PENCIL",t[t.WASHI_TAPE=7]="WASHI_TAPE",t[t.SECTION=8]="SECTION"})(hy||(hy={}));var my;(function(t){t[t.NONE=0]="NONE",t[t.FRAME_NAME=1]="FRAME_NAME",t[t.FLOW_STARTING_POINT_NAME=2]="FLOW_STARTING_POINT_NAME",t[t.SECTION_NAME=3]="SECTION_NAME",t[t.MEASUREMENT_FREE_TEXT=4]="MEASUREMENT_FREE_TEXT",t[t.RESPONSIVE_SET_NAME=5]="RESPONSIVE_SET_NAME",t[t.CANVAS_GRID_ROW_NAME=6]="CANVAS_GRID_ROW_NAME",t[t.GRID_TRACK_SIZE=7]="GRID_TRACK_SIZE",t[t.VAR_WIDTH_SIZE=8]="VAR_WIDTH_SIZE"})(my||(my={}));var fy;(function(t){t[t.NONE=0]="NONE",t[t.INT=1]="INT",t[t.BOOL=2]="BOOL",t[t.FLOAT=3]="FLOAT",t[t.STRING=4]="STRING",t[t.JSON=5]="JSON",t[t.GRADIENT_STOP_SELECTION=7]="GRADIENT_STOP_SELECTION",t[t.SELECTED_PROPERTY=8]="SELECTED_PROPERTY",t[t.BOOL_ARRAY=9]="BOOL_ARRAY",t[t.GUID=10]="GUID",t[t.ON_CANVAS_NAME_EDITOR_INFO=11]="ON_CANVAS_NAME_EDITOR_INFO",t[t.EXPORT_SELECTION_SETTINGS=12]="EXPORT_SELECTION_SETTINGS",t[t.ACTIVE_EMBED_DATA=13]="ACTIVE_EMBED_DATA",t[t.VOTING_SESSION_INFO=14]="VOTING_SESSION_INFO",t[t.HOVERED_COMPONENT_PROP_DEF=15]="HOVERED_COMPONENT_PROP_DEF",t[t.TEXT_REVIEW_PLUGIN_INFO=16]="TEXT_REVIEW_PLUGIN_INFO",t[t.DEV_HANDOFF_CODE_LANGUAGE=17]="DEV_HANDOFF_CODE_LANGUAGE",t[t.DEV_HANDOFF_PREFERENCES=18]="DEV_HANDOFF_PREFERENCES",t[t.PROPERTIES_PANEL_PREFERENCES=19]="PROPERTIES_PANEL_PREFERENCES"})(fy||(fy={}));var gy;(function(t){t[t.UNJOINED=0]="UNJOINED",t[t.UNJOINED_FROM_ERROR=1]="UNJOINED_FROM_ERROR",t[t.UNJOINED_FROM_VALIDATION_FAILURE=2]="UNJOINED_FROM_VALIDATION_FAILURE",t[t.GOT_SCHEMA=3]="GOT_SCHEMA",t[t.JOINING_INITIAL_LOAD=4]="JOINING_INITIAL_LOAD",t[t.JOINING_RECONNECT=5]="JOINING_RECONNECT",t[t.JOINING_RECONNECT_AWAITING_QUERY_REPLY=6]="JOINING_RECONNECT_AWAITING_QUERY_REPLY",t[t.JOINED=7]="JOINED",t[t.SHOULD_UPGRADE=8]="SHOULD_UPGRADE",t[t.UPGRADING=9]="UPGRADING",t[t.WAITING_FOR_RELOAD=10]="WAITING_FOR_RELOAD",t[t.DETACHED=11]="DETACHED"})(gy||(gy={}));var Sy;(function(t){t[t.COMMENT=0]="COMMENT",t[t.EMPTY_LINE=1]="EMPTY_LINE",t[t.DECLARATION=2]="DECLARATION",t[t.BLOCK_COMMENT=3]="BLOCK_COMMENT"})(Sy||(Sy={}));var Ay;(function(t){t[t.DESIGN=0]="DESIGN",t[t.PROTOTYPE=1]="PROTOTYPE",t[t.INSPECT=2]="INSPECT",t[t.COMMENT=3]="COMMENT",t[t.EXPORT=4]="EXPORT",t[t.SLIDE=5]="SLIDE",t[t.SLIDE_ANIMATION=6]="SLIDE_ANIMATION",t[t.SITE=7]="SITE",t[t.COOPER=8]="COOPER",t[t.DAKOTA=9]="DAKOTA",t[t.ILLUSTRATION=10]="ILLUSTRATION"})(Ay||(Ay={}));var Ty;(function(t){t[t.PRIMARY=0]="PRIMARY",t[t.PLUGIN=1]="PLUGIN",t[t.STRING_MANAGEMENT=2]="STRING_MANAGEMENT",t[t.PROPERTIES=3]="PROPERTIES",t[t.COMPONENT=4]="COMPONENT",t[t.DEV_RESOURCES=5]="DEV_RESOURCES",t[t.ASSETS=6]="ASSETS"})(Ty||(Ty={}));var Ey;(function(t){t[t.PAN=0]="PAN",t[t.ZOOM=1]="ZOOM"})(Ey||(Ey={}));var Iy;(function(t){t[t.CSS=0]="CSS",t[t.IOS=1]="IOS",t[t.ANDROID=2]="ANDROID"})(Iy||(Iy={}));var Ry;(function(t){t[t.TABULAR=0]="TABULAR",t[t.CODE=1]="CODE"})(Ry||(Ry={}));var yy;(function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.REQUESTED=1]="REQUESTED",t[t.LOADED=2]="LOADED"})(yy||(yy={}));var vy;(function(t){t[t.NONE=0]="NONE",t[t.DIVIDER=1]="DIVIDER",t[t.WHITEBOARD_COLOR=2]="WHITEBOARD_COLOR",t[t.STICKY_COLOR=3]="STICKY_COLOR",t[t.HIGHLIGHT_COLOR=4]="HIGHLIGHT_COLOR",t[t.PENCIL_COLOR=5]="PENCIL_COLOR",t[t.WHITEBOARD_STROKE=6]="WHITEBOARD_STROKE",t[t.WHITEBOARD_SHAPE=7]="WHITEBOARD_SHAPE",t[t.WHITEBOARD_PLATFORM_SHAPE=8]="WHITEBOARD_PLATFORM_SHAPE",t[t.TEXT_DECORATION=9]="TEXT_DECORATION",t[t.HYPERLINK=10]="HYPERLINK",t[t.BULLETED_LIST=11]="BULLETED_LIST",t[t.WHITEBOARD_TEXT_STYLE=12]="WHITEBOARD_TEXT_STYLE",t[t.TEXT_ALIGN_H=13]="TEXT_ALIGN_H",t[t.TEXT_ALIGN_V=14]="TEXT_ALIGN_V",t[t.FONT_FAMILY=15]="FONT_FAMILY",t[t.CONNECTOR_LINE_STYLE=16]="CONNECTOR_LINE_STYLE",t[t.CONNECTOR_START_CAP=17]="CONNECTOR_START_CAP",t[t.CONNECTOR_END_CAP=18]="CONNECTOR_END_CAP",t[t.AUTHOR_VISIBILITY=19]="AUTHOR_VISIBILITY",t[t.ADD_TEXT=20]="ADD_TEXT",t[t.CODE_BLOCK_LANGUAGE=21]="CODE_BLOCK_LANGUAGE",t[t.CODE_BLOCK_THEME=22]="CODE_BLOCK_THEME",t[t.IMAGE=23]="IMAGE",t[t.BORDER=24]="BORDER",t[t.DESCRIPTION=25]="DESCRIPTION",t[t.EMBED_OPEN_EXTERNAL=26]="EMBED_OPEN_EXTERNAL",t[t.EMBED_MAXIMIZE=27]="EMBED_MAXIMIZE",t[t.EMBED_CONVERT_TO_TEXT=28]="EMBED_CONVERT_TO_TEXT",t[t.SECTION_SHOW_HIDE=29]="SECTION_SHOW_HIDE",t[t.SECTION_RENAME=30]="SECTION_RENAME",t[t.RESIZE_TO_FIT=31]="RESIZE_TO_FIT",t[t.WASHI_TAPE_PATTERN=32]="WASHI_TAPE_PATTERN",t[t.FACE_STAMP=33]="FACE_STAMP",t[t.START_MIND_MAP=34]="START_MIND_MAP",t[t.LOCK=35]="LOCK",t[t.REMOVE_IMAGE_BACKGROUND=36]="REMOVE_IMAGE_BACKGROUND",t[t.WIDGET=37]="WIDGET"})(vy||(vy={}));var Cy;(function(t){t[t.PNG=0]="PNG",t[t.JPEG=1]="JPEG",t[t.PDF=2]="PDF",t[t.CSV=3]="CSV"})(Cy||(Cy={}));var Oy;(function(t){t[t.STICKY=0]="STICKY",t[t.TABLE=1]="TABLE"})(Oy||(Oy={}));var by;(function(t){t[t.TRANSPARENT=0]="TRANSPARENT",t[t.WHITE=1]="WHITE",t[t.CHECKERBOARD=2]="CHECKERBOARD",t[t.HALF_CHECKERBOARD=3]="HALF_CHECKERBOARD",t[t.HALF_WHITE=4]="HALF_WHITE",t[t.CUSTOM_COLOR=5]="CUSTOM_COLOR"})(by||(by={}));var Ny;(function(t){t[t.ATTACHED_FILE_TIP=0]="ATTACHED_FILE_TIP",t[t.DETACHED_FILE_TIP=1]="DETACHED_FILE_TIP",t[t.DETACHED_BRANCH_TIP=2]="DETACHED_BRANCH_TIP",t[t.BRANCH_POINT=3]="BRANCH_POINT",t[t.PREVIEW_BRANCH_TIP=4]="PREVIEW_BRANCH_TIP",t[t.STAGED_BRANCH_TIP=5]="STAGED_BRANCH_TIP",t[t.STAGED_FILE_TIP=6]="STAGED_FILE_TIP"})(Ny||(Ny={}));var Py;(function(t){t[t.NONE=0]="NONE",t[t.BEGIN_PREVIEW=1]="BEGIN_PREVIEW",t[t.RECREATE_BRANCH_POINT=2]="RECREATE_BRANCH_POINT",t[t.PREVIEW_CHANGES=3]="PREVIEW_CHANGES",t[t.STAGE_CHANGES=4]="STAGE_CHANGES",t[t.RESET_TO_BRANCH_POINT=5]="RESET_TO_BRANCH_POINT",t[t.COMMIT=6]="COMMIT",t[t.ABANDON=7]="ABANDON",t[t.STAGE_CHANGES_WHILE_ATTACHED=8]="STAGE_CHANGES_WHILE_ATTACHED",t[t.BEGIN_MERGE=9]="BEGIN_MERGE"})(Py||(Py={}));var Fy;(function(t){t[t.RIGHT=0]="RIGHT",t[t.ABOVE=1]="ABOVE",t[t.CUSTOM_POSITION=2]="CUSTOM_POSITION",t[t.BELOW=3]="BELOW"})(Fy||(Fy={}));var Dy;(function(t){t[t.OFF=0]="OFF",t[t.ON_AND_LOCKED=1]="ON_AND_LOCKED",t[t.KEEP_UI=2]="KEEP_UI",t[t.HIDE_UI=3]="HIDE_UI"})(Dy||(Dy={}));var wy;(function(t){t[t.SELECTION=0]="SELECTION",t[t.SNAPPING=1]="SNAPPING"})(wy||(wy={}));var xy;(function(t){t[t.NONE=0]="NONE",t[t.MIXED=1]="MIXED",t[t.BLOCK=2]="BLOCK",t[t.BLOCK_WITH_IMAGE=3]="BLOCK_WITH_IMAGE",t[t.TEXT=4]="TEXT",t[t.IFRAME=5]="IFRAME"})(xy||(xy={}));var Ly;(function(t){t[t.NONE=0]="NONE",t[t.ARIA=1]="ARIA",t[t.ALT_TEXT=2]="ALT_TEXT",t[t.TITLE=3]="TITLE"})(Ly||(Ly={}));var My;(function(t){t[t.DONT_MERGE=0]="DONT_MERGE",t[t.TEXT_EDIT=1]="TEXT_EDIT",t[t.TEXT_LINE_HEIGHT=2]="TEXT_LINE_HEIGHT",t[t.TEXT_FONT_SIZE=3]="TEXT_FONT_SIZE",t[t.TEXT_LETTER_SPACING=4]="TEXT_LETTER_SPACING",t[t.LAYER_OPACITY=5]="LAYER_OPACITY",t[t.NUDGE=6]="NUDGE",t[t.SELECTION_PROPERTY=7]="SELECTION_PROPERTY",t[t.STYLE_SELECTION_PROPERTY=8]="STYLE_SELECTION_PROPERTY",t[t.CONTENT_FILL_INSERT_AND_GENERATE=9]="CONTENT_FILL_INSERT_AND_GENERATE",t[t.AI_TEXT_MANIPULATION_START=10]="AI_TEXT_MANIPULATION_START",t[t.AI_TEXT_MANIPULATION_DELTA=11]="AI_TEXT_MANIPULATION_DELTA",t[t.COLLABORATIVE_TEXT_EDIT=12]="COLLABORATIVE_TEXT_EDIT"})(My||(My={}));var By;(function(t){t[t.NO_SESSION=0]="NO_SESSION",t[t.JOINED=1]="JOINED",t[t.NOT_JOINED=2]="NOT_JOINED",t[t.ENDED=3]="ENDED"})(By||(By={}));var Gy;(function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_CENTER=1]="TOP_CENTER",t[t.TOP_RIGHT=2]="TOP_RIGHT",t[t.MIDDLE_LEFT=3]="MIDDLE_LEFT",t[t.MIDDLE_CENTER=4]="MIDDLE_CENTER",t[t.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",t[t.BOTTOM_LEFT=6]="BOTTOM_LEFT",t[t.BOTTOM_CENTER=7]="BOTTOM_CENTER",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(Gy||(Gy={}));var Uy;(function(t){t[t.PRESENT=0]="PRESENT",t[t.PREVIEW=1]="PREVIEW"})(Uy||(Uy={}));var Vy;(function(t){t[t.DEFINITELY_COVERED_ONLY=0]="DEFINITELY_COVERED_ONLY",t[t.DEFINITELY_COVERED_AND_OUTDATED=1]="DEFINITELY_COVERED_AND_OUTDATED"})(Vy||(Vy={}));var ky;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.ERROR_TEXT_SIZE=1]="ERROR_TEXT_SIZE",t[t.TIMEOUT=2]="TIMEOUT",t[t.ERROR_OTHER=3]="ERROR_OTHER"})(ky||(ky={}));var Hy;(function(t){t[t.MIRO=0]="MIRO",t[t.MURAL=1]="MURAL",t[t.LUCID=2]="LUCID",t[t.JAMBOARD=3]="JAMBOARD",t[t.UNKNOWN=4]="UNKNOWN"})(Hy||(Hy={}));var zy;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.YOUTUBE=1]="YOUTUBE",t[t.GOOGLE_MAP=2]="GOOGLE_MAP",t[t.MAILCHIMP=3]="MAILCHIMP",t[t.GENERIC=4]="GENERIC"})(zy||(zy={}));var Wy;(function(t){t[t.NONE=0]="NONE",t[t.IGNORE_COMMIT_FOR_CONTENT_FILL=1]="IGNORE_COMMIT_FOR_CONTENT_FILL"})(Wy||(Wy={}));var Ky;(function(t){t[t.TRACE=0]="TRACE",t[t.DBG=1]="DBG",t[t.INFO=2]="INFO",t[t.LOG=3]="LOG",t[t.WARN=4]="WARN",t[t.ERROR=5]="ERROR"})(Ky||(Ky={}));var Yy;(function(t){t[t.BOOLEAN=0]="BOOLEAN",t[t.STRING=1]="STRING",t[t.FLOAT=2]="FLOAT",t[t.INT=3]="INT",t[t.STRING_LIST=4]="STRING_LIST"})(Yy||(Yy={}));var Qy;(function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.CENTER=1]="CENTER"})(Qy||(Qy={}));var qy;(function(t){t[t.BOX=0]="BOX",t[t.PICK=1]="PICK"})(qy||(qy={}));var Xy;(function(t){t[t.COMPONENTS=0]="COMPONENTS",t[t.PROPS=1]="PROPS"})(Xy||(Xy={}));var Zy;(function(t){t[t.PIXEL=0]="PIXEL",t[t.SCALED=1]="SCALED"})(Zy||(Zy={}));var Jy;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.UNDO_REDO=1]="UNDO_REDO",t[t.ANNOTATIONS=2]="ANNOTATIONS",t[t.NODE_STATUS=3]="NODE_STATUS"})(Jy||(Jy={}));var jy;(function(t){t[t.FIT_TO_SCREEN=0]="FIT_TO_SCREEN",t[t.FIT_TO_WIDTH=1]="FIT_TO_WIDTH",t[t.FILL_SCREEN=2]="FILL_SCREEN"})(jy||(jy={}));var $y;(function(t){t[t.TEXT=0]="TEXT",t[t.BOX=1]="BOX"})($y||($y={}));var e0;(function(t){t[t.NORMAL=0]="NORMAL",t[t.MEDIUM=1]="MEDIUM",t[t.BOLD=2]="BOLD"})(e0||(e0={}));var t0;(function(t){t[t.NONE=0]="NONE",t[t.ABSOLUTE=1]="ABSOLUTE",t[t.EDGE=2]="EDGE",t[t.CENTER=3]="CENTER",t[t.TOP=4]="TOP",t[t.RIGHT=5]="RIGHT",t[t.LEFT=6]="LEFT",t[t.BOTTOM=7]="BOTTOM"})(t0||(t0={}));var r0;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(r0||(r0={}));var n0;(function(t){t[t.HIDE=0]="HIDE",t[t.REORDER_AND_APPEND_ONLY=1]="REORDER_AND_APPEND_ONLY",t[t.FULL=2]="FULL"})(n0||(n0={}));var o0;(function(t){t[t.AXIS=0]="AXIS",t[t.POINT=1]="POINT"})(o0||(o0={}));var i0;(function(t){t[t.UNSELECTED_NODES=0]="UNSELECTED_NODES",t[t.UNSELECTED_NODES_AND_SELECTED_FRAME_CONTENT=1]="UNSELECTED_NODES_AND_SELECTED_FRAME_CONTENT"})(i0||(i0={}));var a0;(function(t){t[t.EDITOR_TEMPLATE=0]="EDITOR_TEMPLATE",t[t.SLIDES_TEMPLATE=1]="SLIDES_TEMPLATE",t[t.SITES_TEMPLATE=2]="SITES_TEMPLATE",t[t.LITE_TEMPLATE=3]="LITE_TEMPLATE"})(a0||(a0={}));var s0;(function(t){t[t.ACTIONS_MENU=0]="ACTIONS_MENU",t[t.RFD_MENU=1]="RFD_MENU"})(s0||(s0={}));var l0;(function(t){t[t.SECTION=0]="SECTION",t[t.FRAME=1]="FRAME"})(l0||(l0={}));var c0;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.TRIGGERED_DETACH=1]="TRIGGERED_DETACH",t[t.INTERNAL_ERROR=2]="INTERNAL_ERROR"})(c0||(c0={}));var d0;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.NOT_DETACHED_ERROR=1]="NOT_DETACHED_ERROR",t[t.INTERNAL_ERROR=2]="INTERNAL_ERROR"})(d0||(d0={}));var u0;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.CONTAINING_PAGE=1]="CONTAINING_PAGE",t[t.PLUGIN=2]="PLUGIN"})(u0||(u0={}));var p0;(function(t){t[t.LEGACY_PLUGIN=0]="LEGACY_PLUGIN",t[t.PLUGIN_VALIDATION=1]="PLUGIN_VALIDATION",t[t.DYNAMIC_PLUGIN_LOAD_ALL=2]="DYNAMIC_PLUGIN_LOAD_ALL",t[t.SAVE_LOCAL_COPY=3]="SAVE_LOCAL_COPY",t[t.LEGACY_IMAGES_CODE=4]="LEGACY_IMAGES_CODE",t[t.FIND_AND_REPLACE=5]="FIND_AND_REPLACE",t[t.REPLACE_LIBRARIES=6]="REPLACE_LIBRARIES",t[t.LIBRARY_UPDATES=7]="LIBRARY_UPDATES",t[t.MISSING_FONTS=8]="MISSING_FONTS",t[t.BRANCHING_MODAL_OPEN=9]="BRANCHING_MODAL_OPEN",t[t.BRANCHING_MERGE_TO_MAIN=10]="BRANCHING_MERGE_TO_MAIN",t[t.DEBUG_TOOL=11]="DEBUG_TOOL"})(p0||(p0={}));var _0;(function(t){t[t.ASSET_UPDATE=0]="ASSET_UPDATE",t[t.AUTOSAVE=1]="AUTOSAVE",t[t.BRANCHING_MODAL_OPEN=2]="BRANCHING_MODAL_OPEN",t[t.BRANCHING_MERGE_TO_MAIN=3]="BRANCHING_MERGE_TO_MAIN",t[t.DEV_HANDOFF_STATUS=4]="DEV_HANDOFF_STATUS",t[t.HYPERLINK_PRELOAD=5]="HYPERLINK_PRELOAD",t[t.PAGE_INITIAL_LOAD=6]="PAGE_INITIAL_LOAD",t[t.PAGE_CHANGE=7]="PAGE_CHANGE",t[t.PAGE_DELETE=8]="PAGE_DELETE",t[t.PAGE_DIVIDER_CHECK=9]="PAGE_DIVIDER_CHECK",t[t.PAGE_DUPLICATE=10]="PAGE_DUPLICATE",t[t.PAGE_MOVE_TO=11]="PAGE_MOVE_TO",t[t.PLUGIN=12]="PLUGIN"})(_0||(_0={}));var h0;(function(t){t[t.MITER=0]="MITER",t[t.ROUND=1]="ROUND"})(h0||(h0={}));var m0;(function(t){t[t.EMBED=0]="EMBED",t[t.LINK_PREVIEW=1]="LINK_PREVIEW",t[t.WIDGET=2]="WIDGET"})(m0||(m0={}));var f0;(function(t){t[t.LOCAL=0]="LOCAL",t[t.REMOTE=1]="REMOTE"})(f0||(f0={}));var g0;(function(t){t[t.CREATE=0]="CREATE",t[t.DELETE=1]="DELETE",t[t.PROPERTY_CHANGE=2]="PROPERTY_CHANGE",t[t.STYLE_PROPERTY_CHANGE=3]="STYLE_PROPERTY_CHANGE",t[t.STYLE_CREATE=4]="STYLE_CREATE",t[t.STYLE_DELETE=5]="STYLE_DELETE"})(g0||(g0={}));var S0;(function(t){t[t.SINGLE_SLIDE=0]="SINGLE_SLIDE",t[t.GRID=1]="GRID"})(S0||(S0={}));var A0;(function(t){t[t.GROUP=0]="GROUP",t[t.UNION=1]="UNION",t[t.SUBTRACT=2]="SUBTRACT",t[t.INTERSECT=3]="INTERSECT",t[t.XOR=4]="XOR",t[t.STATE_GROUP=5]="STATE_GROUP"})(A0||(A0={}));var T0;(function(t){t[t.UNLOADED=0]="UNLOADED",t[t.NOT_ANIMATED=1]="NOT_ANIMATED",t[t.ANIMATED=2]="ANIMATED"})(T0||(T0={}));var E0;(function(t){t[t.KEYBOARD=0]="KEYBOARD",t[t.UNKNOWN_CONTROLLER=1]="UNKNOWN_CONTROLLER",t[t.XBOX_ONE=2]="XBOX_ONE",t[t.PS4=3]="PS4",t[t.SWITCH_PRO=4]="SWITCH_PRO"})(E0||(E0={}));var I0;(function(t){t[t.NONE=0]="NONE",t[t.PRESET=1]="PRESET",t[t.CUSTOM=2]="CUSTOM",t[t.PRESENTATION=3]="PRESENTATION"})(I0||(I0={}));var R0;(function(t){t[t.VALID=0]="VALID",t[t.NO_FRAMES=1]="NO_FRAMES",t[t.INVALID_START_NODE=2]="INVALID_START_NODE"})(R0||(R0={}));var y0;(function(t){t[t.SCROLLS=0]="SCROLLS",t[t.FIXED=1]="FIXED",t[t.STICKY_SCROLLS=2]="STICKY_SCROLLS"})(y0||(y0={}));var v0;(function(t){t[t.ROW=0]="ROW",t[t.COLUMN=1]="COLUMN"})(v0||(v0={}));var C0;(function(t){t[t.PLUGIN=0]="PLUGIN",t[t.INTERNAL=1]="INTERNAL"})(C0||(C0={}));var O0;(function(t){t[t.SET_AUTOLAYOUT_SPACING_AUTO=0]="SET_AUTOLAYOUT_SPACING_AUTO",t[t.SET_CLIP_CONTENT=1]="SET_CLIP_CONTENT",t[t.SET_CORNER_SMOOTHING_ZERO=2]="SET_CORNER_SMOOTHING_ZERO",t[t.USE_BLEND_MODE_MULTIPLY=3]="USE_BLEND_MODE_MULTIPLY",t[t.REMOVE_VERTICAL_TRIM=4]="REMOVE_VERTICAL_TRIM",t[t.REMOVE_VIDEO_FILL=5]="REMOVE_VIDEO_FILL",t[t.REMOVE_TEXTURE_PATTERN_FILL=6]="REMOVE_TEXTURE_PATTERN_FILL",t[t.REMOVE_TEXTURE_NOISE_FILL=7]="REMOVE_TEXTURE_NOISE_FILL",t[t.REMOVE_VIDEO_STROKE=8]="REMOVE_VIDEO_STROKE",t[t.REMOVE_STICKY=9]="REMOVE_STICKY",t[t.REMOVE_CONNECTOR=10]="REMOVE_CONNECTOR",t[t.REMOVE_WASHI_TAPE=11]="REMOVE_WASHI_TAPE",t[t.REMOVE_HIGHLIGHT=12]="REMOVE_HIGHLIGHT",t[t.REMOVE_SHAPE_WITH_TEXT=13]="REMOVE_SHAPE_WITH_TEXT",t[t.REMOVE_STAMP=14]="REMOVE_STAMP",t[t.REMOVE_TABLE=15]="REMOVE_TABLE",t[t.REMOVE_WIDGET=16]="REMOVE_WIDGET",t[t.REMOVE_STROKE=17]="REMOVE_STROKE",t[t.REMOVE_STROKE_GRADIENT=18]="REMOVE_STROKE_GRADIENT",t[t.REMOVE_STROKE_IMAGE=19]="REMOVE_STROKE_IMAGE",t[t.REMOVE_STROKE_BLEND_MODE=20]="REMOVE_STROKE_BLEND_MODE",t[t.REMOVE_CUSTOM_JOIN=21]="REMOVE_CUSTOM_JOIN",t[t.REMOVE_TEXT_INNER_SHADOW=22]="REMOVE_TEXT_INNER_SHADOW",t[t.SET_BLEND_MODE_NORMAL=23]="SET_BLEND_MODE_NORMAL",t[t.REMOVE_TEXT_BACKGROUND_BLUR=24]="REMOVE_TEXT_BACKGROUND_BLUR",t[t.REMOVE_BASELINE_ALIGNMENT=25]="REMOVE_BASELINE_ALIGNMENT",t[t.REMOVE_EFFECTS=26]="REMOVE_EFFECTS",t[t.REMOVE_OPEN_OVERLAY_ACTIONS=27]="REMOVE_OPEN_OVERLAY_ACTIONS",t[t.REMOVE_SWAP_OVERLAY_ACTIONS=28]="REMOVE_SWAP_OVERLAY_ACTIONS",t[t.REMOVE_CLOSE_OVERLAY_ACTIONS=29]="REMOVE_CLOSE_OVERLAY_ACTIONS",t[t.REMOVE_SET_VARIABLE_MODE_ACTIONS=30]="REMOVE_SET_VARIABLE_MODE_ACTIONS",t[t.REMOVE_SCROLL_TO_ACTIONS=31]="REMOVE_SCROLL_TO_ACTIONS",t[t.REMOVE_ON_DRAG_ACTIONS=32]="REMOVE_ON_DRAG_ACTIONS",t[t.REMOVE_GAMEPAD_ACTIONS=33]="REMOVE_GAMEPAD_ACTIONS",t[t.REMOVE_LINKS_TO_DELETED_NODES=34]="REMOVE_LINKS_TO_DELETED_NODES",t[t.REMOVE_MOUSE_IN_ACTIONS=35]="REMOVE_MOUSE_IN_ACTIONS",t[t.REMOVE_MOUSE_OUT_ACTIONS=36]="REMOVE_MOUSE_OUT_ACTIONS",t[t.REMOVE_NAVIGATE_ACTIONS_WITH_SMART_ANIMATE=37]="REMOVE_NAVIGATE_ACTIONS_WITH_SMART_ANIMATE",t[t.REMOVE_DISSOLVE_ANIMATIONS=38]="REMOVE_DISSOLVE_ANIMATIONS",t[t.REMOVE_SMART_ANIMATE=39]="REMOVE_SMART_ANIMATE",t[t.REMOVE_SMART_ANIMATE_FROM_ANCESTOR=40]="REMOVE_SMART_ANIMATE_FROM_ANCESTOR",t[t.REMOVE_UNSUPPORTED_VECTOR_OVERRIDES=41]="REMOVE_UNSUPPORTED_VECTOR_OVERRIDES",t[t.REMOVE_VECTOR_SET_VARIABLE_ACTIONS=42]="REMOVE_VECTOR_SET_VARIABLE_ACTIONS",t[t.SET_AUTOLAYOUT_SIZING_FIXED=43]="SET_AUTOLAYOUT_SIZING_FIXED",t[t.ADD_AUTOLAYOUT=44]="ADD_AUTOLAYOUT",t[t.REMOVE_AUTOLAYOUT=45]="REMOVE_AUTOLAYOUT",t[t.SET_POSITION_CONSTRAINTS_CENTER=46]="SET_POSITION_CONSTRAINTS_CENTER",t[t.REMOVE_FILL_CONTAINER=47]="REMOVE_FILL_CONTAINER",t[t.REMOVE_ROTATION=48]="REMOVE_ROTATION",t[t.REMOVE_SCROLLING=49]="REMOVE_SCROLLING",t[t.REMOVE_ON_CLICK_ACTIONS=50]="REMOVE_ON_CLICK_ACTIONS",t[t.REMOVE_TEXTURE_DYNAMIC_STROKE=51]="REMOVE_TEXTURE_DYNAMIC_STROKE",t[t.REMOVE_TEXTURE_BRUSH_STROKE=52]="REMOVE_TEXTURE_BRUSH_STROKE",t[t.REMOVE_GRAIN_EFFECT=53]="REMOVE_GRAIN_EFFECT",t[t.REMOVE_NOISE_EFFECT=54]="REMOVE_NOISE_EFFECT",t[t.REMOVE_PROGRESSIVE_BLUR=55]="REMOVE_PROGRESSIVE_BLUR",t[t.REMOVE_GLASS=56]="REMOVE_GLASS",t[t.REMOVE_IMAGE_ADJUSTMENTS=57]="REMOVE_IMAGE_ADJUSTMENTS",t[t.REMOVE_APPEAR_BEHAVIOR=58]="REMOVE_APPEAR_BEHAVIOR",t[t.REMOVE_SCROLL_TRANSFORM_BEHAVIOR=59]="REMOVE_SCROLL_TRANSFORM_BEHAVIOR",t[t.REMOVE_SCROLL_PARALLAX_BEHAVIOR=60]="REMOVE_SCROLL_PARALLAX_BEHAVIOR",t[t.REMOVE_HOVER_BEHAVIOR=61]="REMOVE_HOVER_BEHAVIOR",t[t.REMOVE_PRESS_BEHAVIOR=62]="REMOVE_PRESS_BEHAVIOR",t[t.REMOVE_ON_PRESS_ACTIONS=63]="REMOVE_ON_PRESS_ACTIONS",t[t.REMOVE_ON_HOVER_ACTIONS=64]="REMOVE_ON_HOVER_ACTIONS",t[t.REMOVE_CODE_BEHAVIORS=65]="REMOVE_CODE_BEHAVIORS",t[t.REMOVE_IMAGE_ROTATION=66]="REMOVE_IMAGE_ROTATION",t[t.REMOVE_ROTATED_IMAGE_FILL=67]="REMOVE_ROTATED_IMAGE_FILL",t[t.REMOVE_CURSOR_BEHAVIOR=68]="REMOVE_CURSOR_BEHAVIOR",t[t.REMOVE_MASK_TRANSFORM=69]="REMOVE_MASK_TRANSFORM"})(O0||(O0={}));var b0;(function(t){t[t.INACTIVE=0]="INACTIVE",t[t.ALL_FRAMES=1]="ALL_FRAMES",t[t.COMPONENT_SET=2]="COMPONENT_SET",t[t.RESPONSIVE_SET=3]="RESPONSIVE_SET"})(b0||(b0={}));var N0;(function(t){t[t.VARIABLES_MODAL=0]="VARIABLES_MODAL",t[t.VARIABLE_PICKER=1]="VARIABLE_PICKER",t[t.SLIDES_THEME=2]="SLIDES_THEME"})(N0||(N0={}));var P0;(function(t){t[t.AUTOMATIC_FIRST_COLLECTION=0]="AUTOMATIC_FIRST_COLLECTION",t[t.VARIABLES_MODAL=1]="VARIABLES_MODAL"})(P0||(P0={}));var F0;(function(t){t[t.SET_AS_DEFAULT=0]="SET_AS_DEFAULT",t[t.MOVE_COLUMN_LEFT=1]="MOVE_COLUMN_LEFT",t[t.MOVE_COLUMN_RIGHT=2]="MOVE_COLUMN_RIGHT",t[t.DRAG_AND_DROP=3]="DRAG_AND_DROP"})(F0||(F0={}));var D0;(function(t){t[t.ADD_CHANGES=0]="ADD_CHANGES",t[t.REPLACE_CHANGES=1]="REPLACE_CHANGES"})(D0||(D0={}));var w0;(function(t){t[t.NONE=0]="NONE",t[t.DISCONNECTED_AUTOSAVE_DISABLED=1]="DISCONNECTED_AUTOSAVE_DISABLED",t[t.DISCONNECTED_SERVER_ISSUES=2]="DISCONNECTED_SERVER_ISSUES",t[t.DISCONNECTED_OTHER=3]="DISCONNECTED_OTHER",t[t.SYNCING_AUTOSAVE_DISABLED=4]="SYNCING_AUTOSAVE_DISABLED",t[t.SYNCING_SERVER_ISSUES=5]="SYNCING_SERVER_ISSUES",t[t.SYNCING_OTHER=6]="SYNCING_OTHER",t[t.SUPPRESS_UNSAVED_CHANGES_UI=7]="SUPPRESS_UNSAVED_CHANGES_UI"})(w0||(w0={}));var x0;(function(t){t[t.NONE=0]="NONE",t[t.SCENEGRAPH_VALIDATION_ERROR=1]="SCENEGRAPH_VALIDATION_ERROR",t[t.NON_ATOMIC_SYNC_ERROR=2]="NON_ATOMIC_SYNC_ERROR"})(x0||(x0={}));var L0;(function(t){t[t.NEW_FILE=0]="NEW_FILE",t[t.INITIAL_LOAD=1]="INITIAL_LOAD",t[t.RECONNECT=2]="RECONNECT"})(L0||(L0={}));var M0;(function(t){t[t.NONE=0]="NONE",t[t.VARIABLES=1]="VARIABLES",t[t.STYLES=2]="STYLES"})(M0||(M0={}));var B0;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.CROSSHAIR=1]="CROSSHAIR",t[t.EYEDROPPER=2]="EYEDROPPER",t[t.HAND=3]="HAND",t[t.PAINT_BUCKET=4]="PAINT_BUCKET",t[t.PEN=5]="PEN",t[t.PENCIL=6]="PENCIL",t[t.MARKER=7]="MARKER",t[t.ERASER=8]="ERASER",t[t.HIGHLIGHTER=9]="HIGHLIGHTER",t[t.HIGH_FIVE=10]="HIGH_FIVE",t[t.LASSO=11]="LASSO"})(B0||(B0={}));var G0;(function(t){t[t.NONE=0]="NONE",t[t.STICKY=1]="STICKY",t[t.SHAPE_WITH_TEXT=2]="SHAPE_WITH_TEXT",t[t.SECTION=3]="SECTION",t[t.BUG_BASH=4]="BUG_BASH",t[t.STANDUP=5]="STANDUP",t[t.DESIGN_CRIT=6]="DESIGN_CRIT",t[t.USER_JOURNEY=7]="USER_JOURNEY",t[t.MAKE_SOMETHING_BRAINSTORM=8]="MAKE_SOMETHING_BRAINSTORM",t[t.MAKE_SOMETHING_TEAM_CHART=9]="MAKE_SOMETHING_TEAM_CHART",t[t.MAKE_SOMETHING_TEAM_UPDATES=10]="MAKE_SOMETHING_TEAM_UPDATES",t[t.MAKE_SOMETHING_PLANNING=11]="MAKE_SOMETHING_PLANNING",t[t.RETRO=12]="RETRO"})(G0||(G0={}));var U0;(function(t){t[t.BASIC=0]="BASIC",t[t.EXPANDED=1]="EXPANDED"})(U0||(U0={}));var V0;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t[t.PURPLE=3]="PURPLE",t[t.RED=4]="RED",t[t.YELLOW=5]="YELLOW"})(V0||(V0={}));var k0;(function(t){t[t.DIAGRAM=0]="DIAGRAM",t[t.ORG_CHART=1]="ORG_CHART"})(k0||(k0={}));var H0;(function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"})(H0||(H0={}));var z0;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.PURPLE=1]="PURPLE",t[t.BLUE=2]="BLUE",t[t.GREEN=3]="GREEN"})(z0||(z0={}));var W0;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t[t.PURPLE=3]="PURPLE",t[t.RED=4]="RED",t[t.YELLOW=5]="YELLOW"})(W0||(W0={}));var K0;(function(t){t[t.Eligible=0]="Eligible",t[t.Ineligible=1]="Ineligible",t[t.Ignored=2]="Ignored"})(K0||(K0={}));var Y0;(function(t){t[t.V100=0]="V100",t[t.V200=1]="V200",t[t.V300=2]="V300",t[t.V400=3]="V400",t[t.V500=4]="V500",t[t.V600=5]="V600",t[t.V700=6]="V700",t[t.V800=7]="V800",t[t.V900=8]="V900",t[t.V1000=9]="V1000"})(Y0||(Y0={}));var Q0;(function(t){t[t.SELECTION=0]="SELECTION",t[t.PENCIL_TOOL=1]="PENCIL_TOOL",t[t.SHAPE_TOOL=2]="SHAPE_TOOL",t[t.EDIT_PALETTE_MODAL=3]="EDIT_PALETTE_MODAL"})(Q0||(Q0={}));var q0;(function(t){t[t.ALL=0]="ALL",t[t.SECTION_STATUS_LABEL=1]="SECTION_STATUS_LABEL",t[t.SECTION_PRESET_PICKER=2]="SECTION_PRESET_PICKER",t[t.RESPONSIVE_SET_PLAY_BUTTON=3]="RESPONSIVE_SET_PLAY_BUTTON",t[t.RESPONSIVE_SET_PLUS_BUTTON=4]="RESPONSIVE_SET_PLUS_BUTTON",t[t.CMS_ITEM_BUTTON=5]="CMS_ITEM_BUTTON"})(q0||(q0={}));var X0;(function(t){t[t.NONE=0]="NONE",t[t.FADE=1]="FADE",t[t.SLIDE_FROM_LEFT=2]="SLIDE_FROM_LEFT",t[t.SLIDE_FROM_RIGHT=3]="SLIDE_FROM_RIGHT",t[t.SLIDE_FROM_TOP=4]="SLIDE_FROM_TOP",t[t.SLIDE_FROM_BOTTOM=5]="SLIDE_FROM_BOTTOM"})(X0||(X0={}));var Z0;(function(t){t[t.LEGACY=0]="LEGACY",t[t.DEFAULT=1]="DEFAULT",t[t.MERGE_MODAL=2]="MERGE_MODAL",t[t.RECOVERY=3]="RECOVERY",t[t.MAXIMUM=4]="MAXIMUM"})(Z0||(Z0={}));var J0;(function(t){t[t.IMAGE=0]="IMAGE",t[t.RENDERER=1]="RENDERER",t[t.JS=2]="JS"})(J0||(J0={}));var j0;(function(t){t[t.BUFFER=0]="BUFFER"})(j0||(j0={}));var pl;(function(t){t[t.TEXTURE=0]="TEXTURE",t[t.VERTEX_BUFFER=1]="VERTEX_BUFFER",t[t.INDEX_BUFFER=2]="INDEX_BUFFER",t[t.RENDERBUFFER=3]="RENDERBUFFER",t[t.UNIFORM_BUFFER=4]="UNIFORM_BUFFER"})(pl||(pl={}));var Rs;(function(t){t[t.COMPRESSED=0]="COMPRESSED",t[t.BUFFER=1]="BUFFER",t[t.BITMAP=2]="BITMAP"})(Rs||(Rs={}));var br;(function(t){t[t.BACKBUFFER=0]="BACKBUFFER",t[t.EYEDROPPER_BACKBUFFER_COPY=1]="EYEDROPPER_BACKBUFFER_COPY",t[t.EXPORT=2]="EXPORT",t[t.GLYPH_DATA=3]="GLYPH_DATA",t[t.GRADIENT=4]="GRADIENT",t[t.IMAGE=5]="IMAGE",t[t.OVERLAY_IMAGE=6]="OVERLAY_IMAGE",t[t.OVERLAY_NINE_GRID=7]="OVERLAY_NINE_GRID",t[t.OVERLAY_TEXT=8]="OVERLAY_TEXT",t[t.OVERLAY_TILE=9]="OVERLAY_TILE",t[t.SINGLE_PIXEL_TEXTURE=10]="SINGLE_PIXEL_TEXTURE",t[t.SWAP_CHAIN=11]="SWAP_CHAIN",t[t.TEST=12]="TEST",t[t.TILE_ATLAS=13]="TILE_ATLAS",t[t.TILE_STACK=14]="TILE_STACK",t[t.STENCIL=15]="STENCIL",t[t.CHROME_HACK=16]="CHROME_HACK"})(br||(br={}));var $0;(function(t){t[t.FULLSCREEN=0]="FULLSCREEN",t[t.NON_FULLSCREEN=1]="NON_FULLSCREEN"})($0||($0={}));var ev;(function(t){t[t.IGNORE_AUTOLAYOUT=0]="IGNORE_AUTOLAYOUT",t[t.FORCE_INSERTION=1]="FORCE_INSERTION",t[t.PREVENT_NESTING=2]="PREVENT_NESTING"})(ev||(ev={}));var tv;(function(t){t[t.None=0]="None",t[t.WebGL1=1]="WebGL1",t[t.WebGL2=2]="WebGL2",t[t.WebGPU=3]="WebGPU"})(tv||(tv={}));var rv;(function(t){t[t.LOW=0]="LOW",t[t.HIGH=1]="HIGH"})(rv||(rv={}));var nv;(function(t){t[t.GL_VERTEX_BUFFER_FAILURE=0]="GL_VERTEX_BUFFER_FAILURE",t[t.GL_TEXTURE_FAILURE=1]="GL_TEXTURE_FAILURE",t[t.GL_RENDERBUFFER_FAILURE=2]="GL_RENDERBUFFER_FAILURE",t[t.GL_UNIFORM_BUFFER_FAILURE=3]="GL_UNIFORM_BUFFER_FAILURE",t[t.GL_INDEX_BUFFER_FAILURE=4]="GL_INDEX_BUFFER_FAILURE",t[t.WASM_FAILURE=100]="WASM_FAILURE"})(nv||(nv={}));var ov;(function(t){t[t.GENERIC=0]="GENERIC"})(ov||(ov={}));var iv;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALWAYS=1]="ALWAYS",t[t.NEVER=2]="NEVER"})(iv||(iv={}));var av;(function(t){t[t.AFTER_INITIAL_JOIN_END=0]="AFTER_INITIAL_JOIN_END",t[t.AFTER_FIRST_RENDER=1]="AFTER_FIRST_RENDER",t[t.DOCUMENT_STARTED_SAVING=2]="DOCUMENT_STARTED_SAVING",t[t.DOCUMENT_FINISHED_SAVING=3]="DOCUMENT_FINISHED_SAVING"})(av||(av={}));var sv;(function(t){t[t.NONE=0]="NONE",t[t.FAST=1]="FAST",t[t.DEFAULT=6]="DEFAULT",t[t.BEST=9]="BEST"})(sv||(sv={}));var lv;(function(t){t[t.HASHES_ONLY=0]="HASHES_ONLY",t[t.HASHES_AND_DATA=1]="HASHES_AND_DATA"})(lv||(lv={}));var cv;(function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT",t[t.JUSTIFIED=3]="JUSTIFIED"})(cv||(cv={}));var dv;(function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"})(dv||(dv={}));var uv;(function(t){t[t.X=0]="X",t[t.Y=1]="Y"})(uv||(uv={}));var Ln;(function(t){t[t.NONE=0]="NONE",t[t.ODD_WINDING_NUMBER_COMPUTE=1]="ODD_WINDING_NUMBER_COMPUTE",t[t.NONZERO_WINDING_NUMBER_COMPUTE=2]="NONZERO_WINDING_NUMBER_COMPUTE",t[t.ODD_WINDING_NUMBER=3]="ODD_WINDING_NUMBER",t[t.ODD_WINDING_NUMBER_CLEAR=4]="ODD_WINDING_NUMBER_CLEAR",t[t.NONZERO_WINDING_NUMBER=5]="NONZERO_WINDING_NUMBER",t[t.NONZERO_WINDING_NUMBER_CLEAR=6]="NONZERO_WINDING_NUMBER_CLEAR",t[t.ODD_WINDING_NUMBER_FILL=7]="ODD_WINDING_NUMBER_FILL",t[t.NONZERO_WINDING_NUMBER_FILL=8]="NONZERO_WINDING_NUMBER_FILL",t[t.ODD_WINDING_NUMBER_STROKE=9]="ODD_WINDING_NUMBER_STROKE",t[t.NONZERO_WINDING_NUMBER_STROKE=10]="NONZERO_WINDING_NUMBER_STROKE",t[t.STROKE_INSIDE=11]="STROKE_INSIDE",t[t.STROKE_OUTSIDE=12]="STROKE_OUTSIDE",t[t.STROKE_CLEAR=13]="STROKE_CLEAR",t[t.OVERLAY_UI_COMPUTE_WINDING_NUMBER_ODD=14]="OVERLAY_UI_COMPUTE_WINDING_NUMBER_ODD",t[t.OVERLAY_UI_COMPUTE_WINDING_NUMBER_NONZERO=15]="OVERLAY_UI_COMPUTE_WINDING_NUMBER_NONZERO",t[t.OVERLAY_UI_COVER_ODD=16]="OVERLAY_UI_COVER_ODD",t[t.OVERLAY_UI_COVER_NONZERO=17]="OVERLAY_UI_COVER_NONZERO",t[t.OVERLAY_UI_COVER_EVEN=18]="OVERLAY_UI_COVER_EVEN",t[t.OVERLAY_UI_COVER_ZERO=19]="OVERLAY_UI_COVER_ZERO"})(Ln||(Ln={}));var mr;(function(t){t[t.ALL=0]="ALL",t[t.COLOR=1]="COLOR",t[t.DEPTH_STENCIL=2]="DEPTH_STENCIL"})(mr||(mr={}));var qe;(function(t){t[t.TRIANGLES=0]="TRIANGLES",t[t.TRIANGLE_STRIP=1]="TRIANGLE_STRIP"})(qe||(qe={}));var ga;(function(t){t[t.COPY=0]="COPY",t[t.KEEP=1]="KEEP",t[t.PREMULTIPLIED=2]="PREMULTIPLIED",t[t.PREMULTIPLIED_SRC_UNDER_TARGET=3]="PREMULTIPLIED_SRC_UNDER_TARGET",t[t.SCREEN=4]="SCREEN",t[t.LINEAR_DODGE=5]="LINEAR_DODGE",t[t.INTERPOLATE=6]="INTERPOLATE",t[t.UNPREMULTIPLIED=7]="UNPREMULTIPLIED"})(ga||(ga={}));var pv;(function(t){t[t.REQUEST_DEVICE_FAILURE=0]="REQUEST_DEVICE_FAILURE",t[t.WEBGPU_ERROR=1]="WEBGPU_ERROR",t[t.WEBGPU_OOM=2]="WEBGPU_OOM",t[t.JS_ERROR=3]="JS_ERROR",t[t.COMPATIBILITY_TEST_FAILURE=4]="COMPATIBILITY_TEST_FAILURE",t[t.DEBUGGING_HELPERS=5]="DEBUGGING_HELPERS"})(pv||(pv={}));var _v;(function(t){t[t.RGBA8=0]="RGBA8",t[t.RG32F=1]="RG32F",t[t.RGB32F=2]="RGB32F",t[t.RGBA32F=3]="RGBA32F",t[t.ASTC_6x6=4]="ASTC_6x6",t[t.BC3=5]="BC3",t[t.BGRA8=6]="BGRA8",t[t.DEPTH24_STENCIL8=7]="DEPTH24_STENCIL8",t[t.STENCIL8=8]="STENCIL8"})(_v||(_v={}));var hv;(function(t){t[t.HEX=0]="HEX",t[t.RGB=1]="RGB",t[t.CSS=2]="CSS",t[t.HSL=3]="HSL",t[t.HSB=4]="HSB",t[t.UIColor=5]="UIColor"})(hv||(hv={}));var mv;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES"})(mv||(mv={}));var fv;(function(t){t[t.LOCAL=0]="LOCAL",t[t.SUBSCRIBED=1]="SUBSCRIBED"})(fv||(fv={}));var gv;(function(t){t[t.NONE=0]="NONE",t[t.STATE_GROUP=1]="STATE_GROUP",t[t.STYLE=2]="STYLE",t[t.SYMBOL=3]="SYMBOL",t[t.VARIABLE=4]="VARIABLE",t[t.VARIABLE_SET=5]="VARIABLE_SET",t[t.VARIABLE_OVERRIDE=6]="VARIABLE_OVERRIDE",t[t.MODULE=7]="MODULE",t[t.RESPONSIVE_SET=8]="RESPONSIVE_SET",t[t.CONSTRAINED_TEMPLATE=9]="CONSTRAINED_TEMPLATE",t[t.CODE_LIBRARY=10]="CODE_LIBRARY",t[t.CODE_FILE=11]="CODE_FILE",t[t.CODE_COMPONENT=12]="CODE_COMPONENT",t[t.BRUSH=13]="BRUSH",t[t.MANAGED_STRING=14]="MANAGED_STRING"})(gv||(gv={}));var Sv;(function(t){t[t.NORMAL=0]="NORMAL",t[t.PROGRESSIVE=1]="PROGRESSIVE"})(Sv||(Sv={}));var Av;(function(t){t[t.LOCAL=0]="LOCAL",t[t.GOOGLE=1]="GOOGLE",t[t.SHARED=2]="SHARED"})(Av||(Av={}));var Tv;(function(t){t[t.FILL=0]="FILL",t[t.FIT=1]="FIT",t[t.STRETCH=2]="STRETCH",t[t.TILE=3]="TILE"})(Tv||(Tv={}));var Ev;(function(t){t[t.NON_ANIMATED_ONLY=0]="NON_ANIMATED_ONLY",t[t.LOW_RES_ONLY=1]="LOW_RES_ONLY",t[t.ALL=2]="ALL"})(Ev||(Ev={}));var Iv;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.UNSUPPORTED_MEDIA=1]="UNSUPPORTED_MEDIA",t[t.OTHER_FAILURE=2]="OTHER_FAILURE"})(Iv||(Iv={}));var Rv;(function(t){t[t.NONE=0]="NONE",t[t.PRESET=1]="PRESET",t[t.CUSTOM=2]="CUSTOM",t[t.PRESENTATION=3]="PRESENTATION"})(Rv||(Rv={}));var yv;(function(t){t[t.ALL=0]="ALL",t[t.BASE_SCREENS=1]="BASE_SCREENS",t[t.SCROLL_TO=2]="SCROLL_TO",t[t.STATES=3]="STATES",t[t.RESPONSIVE_SETS=4]="RESPONSIVE_SETS"})(yv||(yv={}));var vv;(function(t){t[t.NONE=0]="NONE",t[t.CCW_90=1]="CCW_90"})(vv||(vv={}));var Cv;(function(t){t[t.TRIGGER=0]="TRIGGER",t[t.AFTER_PREVIOUS=1]="AFTER_PREVIOUS"})(Cv||(Cv={}));var Ov;(function(t){t[t.PLAIN=0]="PLAIN",t[t.ORDERED_LIST=1]="ORDERED_LIST",t[t.UNORDERED_LIST=2]="UNORDERED_LIST",t[t.BLOCKQUOTE=3]="BLOCKQUOTE",t[t.HEADER=4]="HEADER"})(Ov||(Ov={}));var bv;(function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"})(bv||(bv={}));var Nv;(function(t){t[t.NONE=0]="NONE",t[t.SEMANTIC_WEIGHT=1]="SEMANTIC_WEIGHT",t[t.SEMANTIC_ITALIC=2]="SEMANTIC_ITALIC",t[t.TEXT_DECORATION=3]="TEXT_DECORATION",t[t.HYPERLINK=4]="HYPERLINK",t[t.TEXT_DECORATION_THICKNESS=5]="TEXT_DECORATION_THICKNESS",t[t.TEXT_UNDERLINE_OFFSET=6]="TEXT_UNDERLINE_OFFSET",t[t.TEXT_DECORATION_SKIP_INK=7]="TEXT_DECORATION_SKIP_INK",t[t.TEXT_DECORATION_FILL_PAINT_DATA=8]="TEXT_DECORATION_FILL_PAINT_DATA",t[t.TEXT_DECORATION_STYLE=9]="TEXT_DECORATION_STYLE",t[t.FONT_VARIANT_POSITION=10]="FONT_VARIANT_POSITION"})(Nv||(Nv={}));var Pv;(function(t){t[t.FIGJAM_DARK=0]="FIGJAM_DARK",t[t.DRACULA=1]="DRACULA",t[t.DUOTONE_SEA=2]="DUOTONE_SEA",t[t.DUOTONE_SPACE=3]="DUOTONE_SPACE",t[t.DUOTONE_EARTH=4]="DUOTONE_EARTH",t[t.DUOTONE_FOREST=5]="DUOTONE_FOREST",t[t.DUOTONE_LIGHT=6]="DUOTONE_LIGHT"})(Pv||(Pv={}));var Fv;(function(t){t[t.CENTER=0]="CENTER",t[t.INSIDE=1]="INSIDE",t[t.OUTSIDE=2]="OUTSIDE"})(Fv||(Fv={}));var Dv;(function(t){t[t.NONE=0]="NONE",t[t.FIGJAM=1]="FIGJAM",t[t.VIEWER=2]="VIEWER",t[t.DESIGN=3]="DESIGN",t[t.SLIDES=4]="SLIDES"})(Dv||(Dv={}));var wv;(function(t){t[t.READ=0]="READ",t[t.ELIDE=1]="ELIDE",t[t.SKIP=2]="SKIP"})(wv||(wv={}));var xv;(function(t){t[t.ELBOWED=0]="ELBOWED",t[t.STRAIGHT=1]="STRAIGHT",t[t.CURVED=2]="CURVED"})(xv||(xv={}));var Lv;(function(t){t[t.SWT_CREATED=0]="SWT_CREATED",t[t.SWT_DELETED=1]="SWT_DELETED",t[t.SWT_EDITED=2]="SWT_EDITED",t[t.SWT_RESIZED=3]="SWT_RESIZED",t[t.STICKY_DELETED=4]="STICKY_DELETED",t[t.STICKY_EDITED=5]="STICKY_EDITED",t[t.STICKY_RESIZED=6]="STICKY_RESIZED"})(Lv||(Lv={}));var Mv;(function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"})(Mv||(Mv={}));var Bv;(function(t){t[t.LIGHT=0]="LIGHT",t[t.DARK=1]="DARK"})(Bv||(Bv={}));var Gv;(function(t){t[t.NO_THEME_COLORS=0]="NO_THEME_COLORS",t[t.NONE_AVAILABLE=1]="NONE_AVAILABLE",t[t.SWAPPED=2]="SWAPPED",t[t.NO_THEME_FOUND=3]="NO_THEME_FOUND"})(Gv||(Gv={}));var Uv;(function(t){t[t.ON_CLICK=0]="ON_CLICK",t[t.AFTER_DELAY=1]="AFTER_DELAY"})(Uv||(Uv={}));var Vv;(function(t){t[t.NONE=0]="NONE",t[t.DISSOLVE=1]="DISSOLVE",t[t.SLIDE_FROM_LEFT=2]="SLIDE_FROM_LEFT",t[t.SLIDE_FROM_RIGHT=3]="SLIDE_FROM_RIGHT",t[t.SLIDE_FROM_TOP=4]="SLIDE_FROM_TOP",t[t.SLIDE_FROM_BOTTOM=5]="SLIDE_FROM_BOTTOM",t[t.PUSH_FROM_LEFT=6]="PUSH_FROM_LEFT",t[t.PUSH_FROM_RIGHT=7]="PUSH_FROM_RIGHT",t[t.PUSH_FROM_TOP=8]="PUSH_FROM_TOP",t[t.PUSH_FROM_BOTTOM=9]="PUSH_FROM_BOTTOM",t[t.MOVE_FROM_LEFT=10]="MOVE_FROM_LEFT",t[t.MOVE_FROM_RIGHT=11]="MOVE_FROM_RIGHT",t[t.MOVE_FROM_TOP=12]="MOVE_FROM_TOP",t[t.MOVE_FROM_BOTTOM=13]="MOVE_FROM_BOTTOM",t[t.SLIDE_OUT_TO_LEFT=14]="SLIDE_OUT_TO_LEFT",t[t.SLIDE_OUT_TO_RIGHT=15]="SLIDE_OUT_TO_RIGHT",t[t.SLIDE_OUT_TO_TOP=16]="SLIDE_OUT_TO_TOP",t[t.SLIDE_OUT_TO_BOTTOM=17]="SLIDE_OUT_TO_BOTTOM",t[t.MOVE_OUT_TO_LEFT=18]="MOVE_OUT_TO_LEFT",t[t.MOVE_OUT_TO_RIGHT=19]="MOVE_OUT_TO_RIGHT",t[t.MOVE_OUT_TO_TOP=20]="MOVE_OUT_TO_TOP",t[t.MOVE_OUT_TO_BOTTOM=21]="MOVE_OUT_TO_BOTTOM",t[t.SMART_ANIMATE=22]="SMART_ANIMATE"})(Vv||(Vv={}));var kv;(function(t){t[t.FILE=0]="FILE",t[t.CODE=1]="CODE",t[t.DAKOTA=2]="DAKOTA",t[t.SETTINGS=3]="SETTINGS",t[t.INSERT=4]="INSERT"})(kv||(kv={}));var Hv;(function(t){t[t.MORE_THAN_ONE_HIGHLEVEL_NODE_FOUND=0]="MORE_THAN_ONE_HIGHLEVEL_NODE_FOUND",t[t.INSERTED_NODES_TOO_LARGE=1]="INSERTED_NODES_TOO_LARGE",t[t.MAXIMUM_ATTACHMENTS_EXCEEDED=2]="MAXIMUM_ATTACHMENTS_EXCEEDED",t[t.USER_PASTED_FIGMA_LINK_IN_CHAT=3]="USER_PASTED_FIGMA_LINK_IN_CHAT",t[t.DESIGN_2_REACT_OTHER=4]="DESIGN_2_REACT_OTHER",t[t.DESIGN_2_REACT_STATE_GROUP=5]="DESIGN_2_REACT_STATE_GROUP",t[t.OTHER=6]="OTHER"})(Hv||(Hv={}));var zv;(function(t){t[t.EQUALS=0]="EQUALS"})(zv||(zv={}));var Wv;(function(t){t[t.MATCH_ALL=0]="MATCH_ALL",t[t.MATCH_ANY=1]="MATCH_ANY"})(Wv||(Wv={}));var Kv;(function(t){t[t.REPEAT=0]="REPEAT",t[t.SYMMETRY=1]="SYMMETRY",t[t.SKEW=2]="SKEW"})(Kv||(Kv={}));var Yv;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.X_AND_Y=2]="X_AND_Y"})(Yv||(Yv={}));var Qv;(function(t){t[t.LINEAR=0]="LINEAR",t[t.RADIAL=1]="RADIAL"})(Qv||(Qv={}));var qv;(function(t){t[t.PIXELS=0]="PIXELS",t[t.RELATIVE=1]="RELATIVE"})(qv||(qv={}));var Xv;(function(t){t[t.FORWARD=0]="FORWARD",t[t.REVERSE=1]="REVERSE"})(Xv||(Xv={}));var Zv;(function(t){t[t.TEXT=0]="TEXT",t[t.DATE=1]="DATE",t[t.TIME=2]="TIME",t[t.NUMBER=3]="NUMBER"})(Zv||(Zv={}));var Jv;(function(t){t[t.FullscreenApp=0]="FullscreenApp",t[t.PrototypeLib=1]="PrototypeLib",t[t.InteractionTest=2]="InteractionTest"})(Jv||(Jv={}));var jv;(function(t){t[t.FROM=0]="FROM",t[t.TO=1]="TO"})(jv||(jv={}));var $v;(function(t){t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=1]="SECONDARY"})($v||($v={}));var eC;(function(t){t[t.INVALID=0]="INVALID",t[t.PRIMARY_INSTANCE_BACKED_BY_SYMBOL=1]="PRIMARY_INSTANCE_BACKED_BY_SYMBOL",t[t.PRIMARY_INSTANCE_WITH_NESTED_SWAP_TO_SYMBOL=2]="PRIMARY_INSTANCE_WITH_NESTED_SWAP_TO_SYMBOL",t[t.PRIMARY_INSTANCE_WITH_TOP_LEVEL_PROP_ASSIGNMENT_TO_SYMBOL=3]="PRIMARY_INSTANCE_WITH_TOP_LEVEL_PROP_ASSIGNMENT_TO_SYMBOL",t[t.PRIMARY_INSTANCE_WITH_NESTED_PROP_ASSIGNMENT_TO_SYMBOL=4]="PRIMARY_INSTANCE_WITH_NESTED_PROP_ASSIGNMENT_TO_SYMBOL",t[t.PRODUCT_COMPONENT_WITH_PROP_DEF_TO_SYMBOL=5]="PRODUCT_COMPONENT_WITH_PROP_DEF_TO_SYMBOL",t[t.STATE_WITH_PROP_DEF_TO_SYMBOL=6]="STATE_WITH_PROP_DEF_TO_SYMBOL",t[t.SYMBOL_CONTAINING_PRIMARY_INSTANCE=7]="SYMBOL_CONTAINING_PRIMARY_INSTANCE"})(eC||(eC={}));var tC;(function(t){t[t.NONE=0]="NONE",t[t.TOO_MANY_VARIABLES_ERROR=1]="TOO_MANY_VARIABLES_ERROR",t[t.TOO_MANY_MODES_ERROR=2]="TOO_MANY_MODES_ERROR"})(tC||(tC={}));var rC;(function(t){t[t.NONE=0]="NONE",t[t.LESS_THAN_MIN_WIDTH=1]="LESS_THAN_MIN_WIDTH",t[t.LESS_THAN_MIN_HEIGHT=2]="LESS_THAN_MIN_HEIGHT",t[t.GREATER_THAN_MAX_WIDTH=3]="GREATER_THAN_MAX_WIDTH",t[t.GREATER_THAN_MAX_HEIGHT=4]="GREATER_THAN_MAX_HEIGHT",t[t.NEGATIVE=5]="NEGATIVE",t[t.NEGATIVE_OR_ZERO=6]="NEGATIVE_OR_ZERO",t[t.LESS_THAN_ONE=7]="LESS_THAN_ONE"})(rC||(rC={}));var nC;(function(t){t[t.BOOLEAN=0]="BOOLEAN",t[t.FLOAT=1]="FLOAT",t[t.STRING=2]="STRING",t[t.COLOR=3]="COLOR",t[t.MAP=4]="MAP",t[t.SYMBOL_ID=5]="SYMBOL_ID",t[t.FONT_STYLE=6]="FONT_STYLE",t[t.TEXT_DATA=7]="TEXT_DATA",t[t.IMAGE=8]="IMAGE",t[t.LINK=9]="LINK",t[t.JS_RUNTIME_ALIAS=10]="JS_RUNTIME_ALIAS",t[t.SLOT_CONTENT_ID=11]="SLOT_CONTENT_ID"})(nC||(nC={}));var oC;(function(t){t[t.BOOLEAN=0]="BOOLEAN",t[t.FLOAT=1]="FLOAT",t[t.STRING=2]="STRING",t[t.ALIAS=3]="ALIAS",t[t.COLOR=4]="COLOR",t[t.EXPRESSION=5]="EXPRESSION",t[t.MAP=6]="MAP",t[t.SYMBOL_ID=7]="SYMBOL_ID",t[t.FONT_STYLE=8]="FONT_STYLE",t[t.TEXT_DATA=9]="TEXT_DATA",t[t.INVALID=10]="INVALID",t[t.NODE_FIELD_ALIAS=11]="NODE_FIELD_ALIAS",t[t.CMS_ALIAS=12]="CMS_ALIAS",t[t.PROP_REF=13]="PROP_REF",t[t.IMAGE=14]="IMAGE",t[t.MANAGED_STRING_ALIAS=15]="MANAGED_STRING_ALIAS",t[t.LINK=16]="LINK",t[t.JS_RUNTIME_ALIAS=17]="JS_RUNTIME_ALIAS",t[t.SLOT_CONTENT_ID=18]="SLOT_CONTENT_ID",t[t.DATE=19]="DATE"})(oC||(oC={}));var iC;(function(t){t[t.ADDITION=0]="ADDITION",t[t.SUBTRACTION=1]="SUBTRACTION",t[t.RESOLVE_VARIANT=2]="RESOLVE_VARIANT",t[t.MULTIPLY=3]="MULTIPLY",t[t.DIVIDE=4]="DIVIDE",t[t.EQUALS=5]="EQUALS",t[t.NOT_EQUAL=6]="NOT_EQUAL",t[t.LESS_THAN=7]="LESS_THAN",t[t.LESS_THAN_OR_EQUAL=8]="LESS_THAN_OR_EQUAL",t[t.GREATER_THAN=9]="GREATER_THAN",t[t.GREATER_THAN_OR_EQUAL=10]="GREATER_THAN_OR_EQUAL",t[t.AND=11]="AND",t[t.OR=12]="OR",t[t.NOT=13]="NOT",t[t.STRINGIFY=14]="STRINGIFY",t[t.TERNARY=15]="TERNARY",t[t.VAR_MODE_LOOKUP=16]="VAR_MODE_LOOKUP",t[t.NEGATE=17]="NEGATE",t[t.IS_TRUTHY=18]="IS_TRUTHY"})(iC||(iC={}));var d_;(function(t){t[t.INTERACTION_TEST=0]="INTERACTION_TEST",t[t.VIEWER_TEST=1]="VIEWER_TEST"})(d_||(d_={}));var _l;(function(t){t[t.ALLOWED=0]="ALLOWED",t[t.DISALLOWED_CYCLE=1]="DISALLOWED_CYCLE",t[t.DISALLOWED_OTHER=2]="DISALLOWED_OTHER"})(_l||(_l={}));var hl;(function(t){t[t.MATERIALIZE_SWAPPED_OUT_TREE=0]="MATERIALIZE_SWAPPED_OUT_TREE",t[t.SKIP_MATERIALIZATION=1]="SKIP_MATERIALIZATION"})(hl||(hl={}));var In;(function(t){t[t.PENDING_INITIAL_LOAD=0]="PENDING_INITIAL_LOAD",t[t.PENDING_LOAD_AFTER_RECONNECT=1]="PENDING_LOAD_AFTER_RECONNECT",t[t.LOADED=2]="LOADED"})(In||(In={}));var aC;(function(t){t[t.NONE=0]="NONE",t[t.CONTAIN=1]="CONTAIN",t[t.SCALE_DOWN=2]="SCALE_DOWN",t[t.MIN_ZOOM=3]="MIN_ZOOM",t[t.FREE=4]="FREE",t[t.SCALE_DOWN_TO_FIT_WIDTH=5]="SCALE_DOWN_TO_FIT_WIDTH",t[t.FIT_WIDTH=6]="FIT_WIDTH",t[t.RESPONSIVE=7]="RESPONSIVE"})(aC||(aC={}));var sC;(function(t){t[t.FIXED=0]="FIXED",t[t.RESPONSIVE=1]="RESPONSIVE"})(sC||(sC={}));var lC;(function(t){t[t.MISSING_FONTS_ONLY=0]="MISSING_FONTS_ONLY",t[t.MISSING_OR_LOCAL_FONTS=1]="MISSING_OR_LOCAL_FONTS"})(lC||(lC={}));var cC;(function(t){t[t.CUT=0]="CUT",t[t.COPY=1]="COPY",t[t.PASTE=2]="PASTE"})(cC||(cC={}));var dC;(function(t){t[t.TEXT=0]="TEXT",t[t.KEY_PRESS=1]="KEY_PRESS",t[t.KEY_RELEASE=2]="KEY_RELEASE",t[t.MOUSE_MOVE=3]="MOUSE_MOVE",t[t.MOUSE_ENTER=4]="MOUSE_ENTER",t[t.MOUSE_LEAVE=5]="MOUSE_LEAVE",t[t.MOUSE_PRESS=6]="MOUSE_PRESS",t[t.MOUSE_DRAG=7]="MOUSE_DRAG",t[t.MOUSE_RELEASE=8]="MOUSE_RELEASE",t[t.MOUSE_WHEEL=9]="MOUSE_WHEEL",t[t.MOUSE_DROP=10]="MOUSE_DROP",t[t.MOUSE_ROTATE=11]="MOUSE_ROTATE",t[t.MOUSE_SCALE=12]="MOUSE_SCALE",t[t.MOUSE_SCALE_END=13]="MOUSE_SCALE_END",t[t.FOCUS_GAINED=14]="FOCUS_GAINED",t[t.FOCUS_LOST=15]="FOCUS_LOST",t[t.CLIPBOARD=16]="CLIPBOARD",t[t.MOUSE_MOVE_COALESCED=17]="MOUSE_MOVE_COALESCED",t[t.MOUSE_DRAG_COALESCED=18]="MOUSE_DRAG_COALESCED",t[t.CONTEXT_MENU_OPEN=19]="CONTEXT_MENU_OPEN",t[t.MOUSE_CANCEL=20]="MOUSE_CANCEL",t[t.APP_FOCUS_GAINED=21]="APP_FOCUS_GAINED",t[t.APP_FOCUS_LOST=22]="APP_FOCUS_LOST"})(dC||(dC={}));var uC;(function(t){t[t.MOUSE=0]="MOUSE",t[t.TOUCH=1]="TOUCH",t[t.STYLUS=2]="STYLUS",t[t.TRACKPAD=3]="TRACKPAD"})(uC||(uC={}));var pC;(function(t){t[t.MOBILE_NATIVE_NAVBAR=0]="MOBILE_NATIVE_NAVBAR"})(pC||(pC={}));var _C;(function(t){t[t.PREVIOUS=0]="PREVIOUS",t[t.NEXT=1]="NEXT"})(_C||(_C={}));var hC;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.US_QWERTY=1]="US_QWERTY",t[t.DVORAK=2]="DVORAK",t[t.GERMAN=3]="GERMAN",t[t.FRENCH_AZERTY=4]="FRENCH_AZERTY",t[t.HIRAGANA_KANA=5]="HIRAGANA_KANA",t[t.UK_MAC=6]="UK_MAC",t[t.UK_PC=7]="UK_PC",t[t.SWEDISH=8]="SWEDISH",t[t.FINNISH=9]="FINNISH",t[t.DANISH=10]="DANISH",t[t.NORWEGIAN=11]="NORWEGIAN",t[t.ITALIAN=12]="ITALIAN",t[t.SPANISH=13]="SPANISH",t[t.SPANISH_LATAM=14]="SPANISH_LATAM",t[t.CHINESE=15]="CHINESE",t[t.PORTUGUESE=16]="PORTUGUESE",t[t.KOREAN=17]="KOREAN"})(hC||(hC={}));var u_=class t{constructor(){this._isWebGL2Supported=!1;this._initializationStatus="webgl1_success";this._isWebGL2Supported=!1;let r=document.createElement("canvas").getContext("webgl2");if(!r){this._initializationStatus="webgl2_not_supported";return}let n=this.renderer(r);if(!n||/radeon/.test(n)){this._initializationStatus="webgl2_disallow_list";return}if(/swiftshader/.test(n)){let i=document.createElement("canvas").getContext("webgl"),a=this.renderer(i);if(!a||!/swiftshader/.test(a)){this._initializationStatus="webgl2_software_rendering";return}}this._initializationStatus="webgl2_success",this._isWebGL2Supported=!0}renderer(e){if(!e)return null;let r=e.getExtension("WEBGL_debug_renderer_info");return r&&(e.getParameter(r.UNMASKED_RENDERER_WEBGL)+"").toLowerCase()}static instance(){return t._instance||(t._instance=new t),t._instance}static isWebGL2Supported(){return t.instance()._isWebGL2Supported}static initializationStatus(){return t.instance()._initializationStatus}};var Vt;(L=>{function t(){return L._workerURL}L.getWorkerURL=t;function e(B){L._workerURL=B}L.setWorkerURL=e;function r(){return L._imagePrefixURL}L.getImagePrefixURL=r;function n(B){L._imagePrefixURL=B}L.setImagePrefixURL=n;function o(){return L._imageBatchURL}L.getImageBatchURL=o;function i(B){L._imageBatchURL=B}L.setImageBatchURL=i;function a(){return L._compressedTexturesAvailabilityURL}L.getCompressedTexturesAvailabilityURL=a;function s(B){L._compressedTexturesAvailabilityURL=B}L.setCompressedTexturesAvailabilityURL=s;function l(){return L._videoPrefixURL}L.getVideoPrefixUrl=l;function c(B){L._videoPrefixURL=B}L.setVideoPrefixUrl=c;function d(){return L._deviceInfoByIdentifier}L.getDeviceInfoByIdentifier=d;function u(B){L._deviceInfoByIdentifier=B}L.setDeviceInfoByIdentifier=u;function p(){return L._containerElement}L.getContainerElement=p;function _(B){L._containerElement=B}L.setContainerElement=_;function h(){return L._forceMobileOptimizations}L.forceMobileOptimizations=h;function A(B){L._forceMobileOptimizations=B}L.setForceMobileOptimizations=A;function m(){return L._shouldUseCompressedTextures}L.shouldUseCompressedTextures=m;function g(B){L._shouldUseCompressedTextures=B}L.setShouldUseCompressedTextures=g;function S(B){let V=D=>{if(!(D in B))throw new Error(`Missing required parameter '${D}'`);return B[D]},b=(D,U)=>D in B?B[D]:U;L._workerURL=V("workerURL"),L._deviceInfoByIdentifier=b("deviceInfoByIdentifier",L._deviceInfoByIdentifierDefault),L._containerElement=V("containerElement"),L._forceMobileOptimizations=b("forceMobileOptimizations",!1)}L.initialize=S,L._workerURL=null,L._imagePrefixURL=null,L._imageBatchURL=null,L._videoPrefixURL=null,L._deviceInfoByIdentifierDefault=null,L._deviceInfoByIdentifier=L._deviceInfoByIdentifierDefault,L._containerElement=null,L._forceMobileOptimizations=!1,L._shouldUseCompressedTextures=!1})(Vt||(Vt={}));var Wt;(m=>{let t;function e(g){t=g}m.initialize=e;function r(){return t!=null&&t.mac==!0}m.mac=r;function n(){return t!=null&&t.windows==!0}m.windows=n;function o(){return t!=null&&t.ios==!0}m.ios=o;function i(){return t!=null&&t.android==!0}m.android=i;function a(){return t!=null&&t.linux==!0}m.linux=a;function s(){return t!=null&&t.chrome==!0}m.chrome=s;function l(){return t!=null&&t.safari==!0}m.safari=l;function c(){return t!=null&&t.firefox==!0}m.firefox=c;function d(){return t!=null&&t.msedge==!0}m.edge=d;function u(){return t!=null&&t.msie==!0}m.msie=u;function p(g){return g==2||g==1}m.isMobile=p;function _(){return m.isMobile(m.current())||m.current()==4&&navigator.maxTouchPoints>0}m.isCurrentOSMobileOrIPad=_;function h(){return m.OS__current==0&&(m.OS__current=r()?4:n()?5:o()?2:i()?1:a()?3:0),m.OS__current}m.current=h,m.OS__current=0})(Wt||(Wt={}));var be;(v=>{let t;(b=>(b[b.LEGACY=0]="LEGACY",b[b.LOW=100]="LOW",b[b.MEDIUM=200]="MEDIUM",b[b.HIGH=300]="HIGH",b[b.MAX=400]="MAX",b[b.DEFAULT=100]="DEFAULT"))(t=v.ProfileLevel||(v.ProfileLevel={}));function e(w,I,C,L,B,V,b,D,U){v._internalTrackAnalyticsEvent=w,v._internalDefinedAnalyticsHandler=I,v._appTimerStart=C,v._appTimerStop=L,v._nextFrame=B,v._startProfile=V,v._stopProfile=b,v._internalLoadTimeTracker=D,v._internalSocketConnectionTracker=U}v.initialize=e;function r(w){let I=v._internalTrackAnalyticsEvent;return v._internalTrackAnalyticsEvent=w,()=>{v._internalTrackAnalyticsEvent=I}}v.mockTrackEvent=r,v.trackDefinedEvent=(w,I)=>{v._internalDefinedAnalyticsHandler!==null&&v._internalDefinedAnalyticsHandler.trackDefinedEvent(w,I)},v.trackDefinedMetric=(w,I)=>{v._internalDefinedAnalyticsHandler!==null&&v._internalDefinedAnalyticsHandler.trackDefinedMetric(w,I)};function i(w,I,C){v._internalTrackAnalyticsEvent!=null&&(0,v._internalTrackAnalyticsEvent)(w,I,C)}v.trackEvent=i;function a(w,I=0){let C=!1;return v._startProfile!=null&&(C=(0,v._startProfile)(w,I)),C&&v._appTimerStart!=null&&(0,v._appTimerStart)(w,I),C}v.appTimerStart=a;function s(w,I=0){v._stopProfile!=null&&(0,v._stopProfile)(w,I),v._appTimerStop!=null&&(0,v._appTimerStop)(w,I)}v.appTimerStop=s;function l(w,I=0,C){let L=a(w,I),B=C();return L&&s(w,I),B}v.perfTimerScope=l;function c(w){v._nextFrame!=null&&(0,v._nextFrame)(w)}v.nextFrame=c;function d(){v._internalLoadTimeTracker!==null&&v._internalLoadTimeTracker.handleMultiplayerOpenConnection()}v.handleMultiplayerOpenConnection=d;function u(){v._internalLoadTimeTracker!==null&&v._internalLoadTimeTracker.handleMultiplayerIFLSatisfied()}v.handleMultiplayerIFLSatisfied=u;function p(){v._internalLoadTimeTracker!==null&&v._internalLoadTimeTracker.handleMultiplayerFirstResponse()}v.handleMultiplayerFirstResponse=p;function _(){v._internalLoadTimeTracker!==null&&v._internalLoadTimeTracker.handleIFLCompleted()}v.handleIFLCompleted=_;function h(w){v._internalSocketConnectionTracker!==null&&v._internalSocketConnectionTracker.handleSocketDisconnect(w)}v.handleMultiplayerSocketDisconnected=h;function A(w,I,C,L){v._internalSocketConnectionTracker!==null&&(w||I>3)&&v._internalSocketConnectionTracker.handleSocketConnectionAttempt(w,I,C,L)}v.handleMultiplayerSocketConnectionAttempt=A,v._internalTrackAnalyticsEvent=null,v._internalDefinedAnalyticsHandler=null,v._internalLoadTimeTracker=null,v._internalSocketConnectionTracker=null,v._appTimerStart=null,v._appTimerStop=null,v._nextFrame=null,v._startProfile=null,v._stopProfile=null})(be||(be={}));function we(t){let e=typeof t=="string"?new Error(t):t;setTimeout(()=>{throw e},0)}function gD(t){let e=new Error(t);setTimeout(()=>{throw e},0)}function mC(t){gD(t)}var za;(a=>{function t(s){i=s}a.initialize=t;function e(s,l,c,d){i("DEBUG",s,l,c,d)}a.logd=e;function r(s,l,c,d){i("INFO",s,l,c,d)}a.logi=r;function n(s,l,c,d){i("WARN",s,l,c,d)}a.logw=n;function o(s,l,c,d){i("ERROR",s,l,c,d)}a.loge=o;let i=()=>{}})(za||(za={}));var Sa=null,yo=!1,_n=!1,fC=!1,ta=!1;function gC(){_n=!0}function SC(){fC=!0}function AC(){return _n||fC}function xr(){return yo||_n||ta}var gc=!0;var Wa=null,yg=null,p_,TC=new Promise((t,e)=>{Wa?t(Wa):p_=t});function Wd(){return TC}function __(t){if(Wa!=null){we("Attempt to initialize PrototypeLib, but PrototypeLib is already initialized");return}EC(t),yg.setSerialization(t.appState().serialization()),ta&&t.modules().interactionTestHelpers.setIsRunningViewerRenderServer()}function F(){return Wa}function EC(t){Wa=t,p_&&p_(t)}function h_(){Wa!=null&&Wa.reset(),EC(null),TC=new Promise((t,e)=>{Wa?t(Wa):p_=t})}function IC(t){yg=t}function m_(){return yg}var K;(ce=>{function t(){return b().clip_to_shape_bounds_reduction??!1}ce.clipToShapeBoundsReducton=t;function e(){return Br.getFeatureGate("viewer_cleanup_buffer_areas")}ce.viewerCleanupBufferAreas=e;function r(){return Br.getFeatureGate("mirror_use_inline_preview_api")}ce.mirrorShouldUseInlinePreviewFrameLoader=r;function n(){return Br.getFeatureGate("unaligned_axis_transform_overlap")}ce.nonAABBRenderingCheck=n;function o(){return Br.getFeatureGate("scatter_brush_instanced_rendering")}ce.scatterBrushInstancedRendering=o;function i(){return Br.getFeatureGate("override_disable_gpu_instancing")}ce.shouldOverrideDisableGpuInstancingSupport=i;function a(){return He()}ce.shouldEnableVertexBufferDiscardBytesAfterUpload=a;function s(){return!He()}ce.smartAnimateCacheTransform=s;function l(){return!He()}ce.viewerCreateVideoTriggersOpt=l;function c(){return!He()}ce.viewerLargeTilesDrawToScreen=c;function d(){return b().viewer_editor_renderer_unification??!1}ce.useUnifiedRenderer=d;function u(){return b().image_reduce_invalidation_time}ce.useReducedImageLoadingInvalidateDelay=u;function p(){return!He()}ce.viewerDoubleTileCompositionLimit=p;function _(){return b().viewer_lock_prerendering_ratio??!1}ce.shouldLockPreRenderingRatio=_;function h(){return!He()}ce.viewerScissorClear=h;function A(){return!He()}ce.enableCreateImageBitmap=A;function m(){return b().viewer_background_blur_opts}ce.useBackgroundBlurOpts=m;function g(){return b().viewer_fast_stroke_shadow}ce.useFastStrokeShadow=g;function S(){return b().viewer_flush_after_clear}ce.shouldFlushAfterClear=S;function R(){return b().viewer_flush_after_stencil_cover}ce.shouldFlushAfterStencilCover=R;function E(){return b().flush_after_draws}ce.shouldFlushAfterDraws=E;function P(){return He()&&Br.getFeatureGate("viewer_reclaim_tilestack_tiles")}ce.shouldReclaimTileStackTiles=P;function T(){return He()}ce.shouldPreventVolatileCaching=T;function f(){return u_.isWebGL2Supported()}ce.shouldUseWebGL2=f;function y(){return ta}ce.shouldUseDesktopCompressedTextureFormat=y;function v(){return He()||y()}ce.shouldUseCompressedTextures=v;function w(){return window.devicePixelRatio>3}ce.isHighDPR=w;function I(){return b().internal_only_debug_tools}ce.internalDebugTools=I;function C(){return ce._shouldPlayVideosLinearly}ce.shouldPlayVideosLinearly=C;function L(){return!w()}ce.useSSAA=L;function B(ze){return ce._bowser.version===null||ce._bowser.version===void 0?!1:ce._bowser.compareVersions([ce._bowser.version,ze])>=0}ce.isBrowserVersionAtLeast=B;function V(ze){return ce._bowser.osversion===null||ce._bowser.osversion===void 0?!1:ce._bowser.compareVersions([ce._bowser.osversion,ze])>=0}ce.isOSVersionAtLeast=V;function b(){return ce._featureFlags}ce.getFeatureFlags=b;function D(ze){var Ot,bt;ce._featureFlags=ze,yo?Sa.featureFlagsCppApi.updateFeatureFlags(ze):((bt=(Ot=F())==null?void 0:Ot.modules())==null?void 0:bt.featureFlagsCppApi)!=null&&F().modules().featureFlagsCppApi.updateFeatureFlags(ze),Br.clearFeatureGatesForTesting(),Br.setInRenderServerForViewerTests();for(let[xn,Go]of Object.entries(ze))Br.updateFeatureGateForTesting(xn,Go)}ce.setFeatureFlags=D;function U(ze){let Ot=Object.assign({},ce._featureFlags);D(Object.assign(Ot,ze))}ce.updateFeatureFlags=U;function H(){return ce._viewerMode}ce.getViewerMode=H;function k(ze){ce._viewerMode=ze}ce.setViewerMode=k;function z(){return ce._scrollToPan}ce.getScrollToPan=z;function q(ze){ce._scrollToPan=ze}ce.setScrollToPan=q;function Y(){return ce._dragToPan}ce.getDragToPan=Y;function j(ze){ce._dragToPan=ze}ce.setDragToPan=j;function ae(){return ce._disableKeyboardHandling}ce.disableKeyboardHandling=ae;function xe(){return ce._gameControllerListener}ce.gameControllerListener=xe;function Je(){return ce._isInlinePreview}ce.isInlinePreview=Je;function We(){return ce._isSlidesEmbed}ce.isSlidesEmbed=We;function pt(ze){ce.protoUseFrameEvictionForUnitTests=ze}ce.setProtoUseFrameEvictionForUnitTests=pt;function Mt(ze){ce._shouldPlayVideosLinearly=ze}ce.setShouldPlayVideosLinearly=Mt;function nr(){return _n?ce.protoUseFrameEvictionForUnitTests:He()}ce.protoUseFrameEviction=nr;function ir(ze){let Ot=Go=>{if(!(Go in ze))throw new Error(`Missing required parameter '${Go}'`);return ze[Go]},bt=(Go,_c)=>Go in ze?ze[Go]:_c,xn=Ot("featureFlags");D(xn),ce._viewerMode=tt.ViewerMode_create(Ot("viewerMode")),be.initialize(bt("trackAnalyticsEvent",null),bt("definedAnalyticsHandler",null),bt("appTimerStart",null),bt("appTimerStop",null),bt("nextFrame",null),bt("startProfile",null),bt("stopProfile",null),bt("loadTimeTracker",null),bt("socketConnectionTracker",null)),za.initialize(bt("logError",()=>{})),ce._bowser=Ot("bowser"),Wt.initialize(ce._bowser),ce._scrollToPan=bt("scrollToPan",ce._scrollToPanDefault),ce._disablePrototypeDeviceFrames=bt("disablePrototypeDeviceFrames",ce._disablePrototypeDeviceFramesDefault),ce._disableKeyboardHandling=bt("disableKeyboardHandling",ce._disableKeyboardHandlingDefault),ce._gameControllerListener=bt("gameControllerListener",null),ce._isInlinePreview=bt("isInlinePreview",!1),ce._isSlidesEmbed=bt("isSlidesEmbed",!1),ce._shouldPlayVideosLinearly=bt("shouldPlayVideosLinearly",!1)}ce.initialize=ir;function le(){return!ce._disablePrototypeDeviceFrames&&ce._viewerMode==1}ce.deviceFramesSupported=le;function Ut(ze){ce.prototypeBackgroundColorOverride=ze}ce.setPrototypeBackgroundColorOverride=Ut;function mt(){if(ce._htmlImageDecodeMethodIsPresent==null){let ze=new Image,Ot=ze.decode!==null&&ze.decode!==void 0;ce._htmlImageDecodeMethodIsPresent=new pe(Ot)}return ce._htmlImageDecodeMethodIsPresent.value}ce.htmlImageDecodeMethodIsPresent=mt;function He(){return(Wt.isMobile(Wt.current())||Wt.current()==4&&navigator.maxTouchPoints>0||Vt.forceMobileOptimizations()||ce.getFeatureFlags().force_mobile_optimizations)??!1}ce.shouldApplyMobileOptimizations=He;let et;(bt=>(bt[bt.MIRROR=0]="MIRROR",bt[bt.PROTOTYPE=1]="PROTOTYPE"))(et=ce.ViewerMode||(ce.ViewerMode={}));let tt;(Ot=>{function ze(bt){if(typeof bt=="string")switch(bt){case"MIRROR":return 0;case"PROTOTYPE":return 1}throw new Error(`Invalid viewer mode: ${bt}`)}Ot.ViewerMode_create=ze})(tt=ce.in_ViewerMode||(ce.in_ViewerMode={})),ce._bowser=null,ce._featureFlags={},ce._viewerMode=1,ce._scrollToPanDefault=!0,ce._scrollToPan=ce._scrollToPanDefault,ce._dragToPanDefault=!0,ce._dragToPan=ce._dragToPanDefault,ce._disablePrototypeDeviceFramesDefault=!1,ce._disablePrototypeDeviceFrames=ce._disablePrototypeDeviceFramesDefault,ce._disableKeyboardHandlingDefault=!1,ce._disableKeyboardHandling=ce._disableKeyboardHandlingDefault,ce._gameControllerListener=null,ce._isInlinePreview=!1,ce.protoUseFrameEvictionForUnitTests=!1,ce.prototypeBackgroundColorOverride=null,ce._htmlImageDecodeMethodIsPresent=null,ce.forceInitiateStateChangeForTests=!1,ce._isSlidesEmbed=!1,ce._shouldPlayVideosLinearly=!1})(K||(K={}));var Kr;(a=>{function t(s,l){if(o.set(s,l),!i.has(s))i.set(s,o.get(s));else{let c=i.get(s);i.set(s,Math.max(c,l))}}a.trackNumber=t;function e(s,l){if(o.has(s)?o.set(s,o.get(s)+l):o.set(s,l),!i.has(s))i.set(s,o.get(s));else{let c=i.get(s);i.set(s,Math.max(c,o.get(s)))}return o.get(s)}a.increment=e;function r(s){return i.has(s)?i.get(s):0}a.getMax=r;function n(){let s=window.performance.memory;s&&s.jsHeapSizeLimit&&s.usedJSHeapSize&&(t("JS Heap size (MB)",s.jsHeapSizeLimit/(1024*1024)|0),t("Used Heap size (MB)",s.usedJSHeapSize/(1024*1024)|0));let l={};for(let c of Array.from(o.keys())){let d=o.get(c);l[c]=Math.round(d*100)/100}return l}a.getStatsForDebugging=n;let o=new Map,i=new Map})(Kr||(Kr={}));var Lr=class t{constructor(){this.SHADER_NAME_U_TYPE="uType";this.SHADER_NAME_U_SHAPE_TYPE="uShapeType";this.SHADER_NAME_U_ELLIPSE_CENTER="uEllipseCenter";this.SHADER_NAME_U_ELLIPSE_RADII="uEllipseRadii";this.SHADER_NAME_U_RECT="uRect";this.SHADER_NAME_U_CORNER_RADII="uCornerRadii";this.SHADER_NAME_U_OPACITY="uOpacity";this.SHADER_NAME_TEXTURE0="texture0";this.SHADER_NAME_U_EMULATE_WRAP_ADDRESS="uEmulateWrapAddress";this.SHADER_NAME_U_EMULATE_BORDER_ADDRESS="uEmulateBorderAddress";this.SHADER_NAME_U_GLOBAL_TINT="uGlobalTint";this.SHADER_NAME_U_GLOBAL_COLOR="uGlobalColor";this.SHADER_NAME_U_GLOBAL_SHADOWS="uGlobalShadows";this.SHADER_NAME_U_GLOBAL_HIGHLIGHTS="uGlobalHighlights";this.SHADER_NAME_U_GLOBAL_EXPOSURE="uGlobalExposure";this.SHADER_NAME_U_GLOBAL_TEMPERATURE="uGlobalTemperature";this.SHADER_NAME_U_GLOBAL_CONTRAST="uGlobalContrast";this.SHADER_NAME_U_PROGRESS="uProgress";this.SHADER_NAME_TEXTURE1="texture1";this.SHADER_NAME_U_PATH_SIZE="uPathSize";this.SHADER_NAME_U_PIXEL_RATIO="uPixelRatio";this.SHADER_NAME_U_PAINT_TRANSFORM0="uPaintTransform0";this.SHADER_NAME_U_UV_SCALE="uUvScale";this.SHADER_NAME_U_VERTEX_TRANSFORM="uVertexTransform";this.SHADER_NAME_A_POSITION2="aPosition2";this.SHADER_NAME_U_COLOR="uColor";this.SHADER_NAME_U_PAINT_TRANSFORM1="uPaintTransform1";this.SHADER_NAME_U_COUNT="uCount";this.SHADER_NAME_U_BLUR_DELTA="uBlurDelta";this.SHADER_NAME_U_BLUR_CLAMP="uBlurClamp";this.SHADER_NAME_INCREASE_MAX_RADIUS_FOR_BLURS="increaseMaxRadiusForBlurs";this.SHADER_NAME_START_COUNT="startCount";this.SHADER_NAME_END_COUNT="endCount";this.SHADER_NAME_BLUR_DELTA="blurDelta";this.SHADER_NAME_BLUR_CLAMP="blurClamp";this.SHADER_NAME_BLUR_GRADIENT_START="blurGradientStart";this.SHADER_NAME_BLUR_GRADIENT_END="blurGradientEnd";this.SHADER_NAME_RADIUS_IN_PIXEL_SPACE="radiusInPixelSpace";this.SHADER_NAME_SCALE="scale";this.SHADER_NAME_NODE_SIZE="nodeSize";this.SHADER_NAME_NOISE_SIZE="noiseSize";this.SHADER_NAME_NODE_TO_TILE_SPACE="nodeToTileSpace";this.SHADER_NAME_TILE_TO_NODE_SPACE="tileToNodeSpace";this.SHADER_NAME_NODE_SPACE_CENTER_POINT="nodeSpaceCenterPoint";this.SHADER_NAME_U_SEED="uSeed";this.SHADER_NAME_U_QUAD="uQuad";this.SHADER_NAME_U_SOURCE="uSource";this.SHADER_NAME_U_UV_SPACE_CLAMPING_RECT="uUvSpaceClampingRect";this.SHADER_NAME_U_UV_SPACE_SOURCE_RECT="uUvSpaceSourceRect";this.SHADER_NAME_U_TO_CLIP_SPACE_TRANSFORM="uToClipSpaceTransform";this.SHADER_NAME_U_DESTINATION_RECT="uDestinationRect";this.SHADER_NAME_TEXTURE2="texture2";this.SHADER_NAME_CORNER_RADIUS_IN_PIXEL_SPACE="cornerRadiusInPixelSpace";this.SHADER_NAME_CORNER_SMOOTHING="cornerSmoothing";this.SHADER_NAME_REFL_RADIUS_IN_PIXEL_SPACE="reflRadiusInPixelSpace";this.SHADER_NAME_REFRACTION_INTENSITY="refractionIntensity";this.SHADER_NAME_REFRACTION_DISTANCE="refractionDistance";this.SHADER_NAME_LIGHT_INTENSITY="lightIntensity";this.SHADER_NAME_LIGHT_ANGLE="lightAngle";this.SHADER_NAME_BEVEL_SIZE="bevelSize";this.SHADER_NAME_CHROMATIC_ABERRATION="chromaticAberration";this.SHADER_NAME_TINT_COLOR="tintColor";this.SHADER_NAME_QUAD="quad";this.SHADER_NAME_SOURCE="source";this.SHADER_NAME_BLUR_RANGE_SOURCE="blurRangeSource";this.SHADER_NAME_POSITION2="position2";this.SHADER_NAME_U_TEXTURE_SIZE="uTextureSize";this.SHADER_NAME_U_TEXTURE_PX="uTexturePx";this.SHADER_NAME_PATTERN_TEX_SIZE_PIXELS="patternTexSizePixels";this.SHADER_NAME_PATTERN_BOUNDS_OFFSET_PIXELS="patternBoundsOffsetPixels";this.SHADER_NAME_TILE_SIZE_PIXELS="tileSizePixels";this.SHADER_NAME_FILL_SIZE_PIXELS="fillSizePixels";this.SHADER_NAME_OFFSET_PIXELS="offsetPixels";this.SHADER_NAME_PATTERN_TILE_TYPE="patternTileType";this.SHADER_NAME_PAINT_TRANSFORM="paintTransform";this.SHADER_NAME_VERTEX_TRANSFORM="vertexTransform";this.SHADER_NAME_COORD3="coord3";this.SHADER_NAME_TEXTURE0_UV_SPACE_SCISSOR="texture0UvSpaceScissor";this.SHADER_NAME_TEXTURE1_UV_SPACE_SCISSOR="texture1UvSpaceScissor";this.SHADER_NAME_A_COORD3="aCoord3";this.SHADER_NAME_CANVAS_SPACE_TO_CLIP_SPACE_TRANSFORM="canvasSpaceToClipSpaceTransform";this.SHADER_NAME_INSTANCE_TRANSFORM0="instanceTransform0";this.SHADER_NAME_INSTANCE_TRANSFORM1="instanceTransform1";this.SHADER_NAME_U_NOISE_TYPE="uNoiseType";this.SHADER_NAME_U_NOISE_SIZE="uNoiseSize";this.SHADER_NAME_U_TILE_TO_NODE_SPACE="uTileToNodeSpace";this.SHADER_NAME_U_DENSITY="uDensity";this.SHADER_NAME_U_SECONDARY_COLOR="uSecondaryColor";this.SHADER_NAME_U_NODE_SPACE_CENTER_POINT="uNodeSpaceCenterPoint";this.SHADER_NAME_U_BLUR_RADIUS="uBlurRadius";this.SHADER_NAME_A_POSITION4="aPosition4";this.SHADER_NAME_U_HOTSPOT_OPACITY="uHotspotOpacity";this.SHADER_NAME_U_STROKE_PROPORTION="uStrokeProportion";this.SHADER_NAME_U_UV_HOTSPOT_CLIPPING_RECT="uUvHotspotClippingRect";this.SHADER_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS="uHalfSizeOverBlurRadius";this.SHADER_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS="uCornerRadiusOverBlurRadius";this.SHADER_NAME_A_COORD4="aCoord4";this.SHADER_NAME_TILE_ATLAS_TILE_SIZE="tileAtlasTileSize";this.SHADER_NAME_SCALE_TO_UNADJUST="scaleToUnadjust";K.shouldUseWebGL2()?(this.SHADER_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform sampler2D texture0;in vec2 vNodeSpacePoint;in vec2 vGradientSampleUV;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);fig_FragColor =ditherColor(texture(texture0, coord) * uOpacity) * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb *= color.a;fig_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb = pipeline(color.rgb) * color.a;fig_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vNodeSpacePoint;in vec2 vGradientSampleUV;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);vec4 lerped =mix(texture(texture0, coord), texture(texture1, coord), uProgress);fig_FragColor = ditherColor(lerped * uOpacity) * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;in vec2 vPaintBSample;in vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb *= lerped.a;fig_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;in vec2 vPaintBSample;in vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;fig_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vNodeSpacePoint;out vec2 vGradientSampleUV;out vec2 vPaintASample;out vec2 vStepA;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform vec4 uColor;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);fig_FragColor = uColor * uOpacity * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vNodeSpacePoint;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;uniform mat3 uPaintTransform1;in vec2 aPosition2;out vec2 vPaintASample;out vec2 vStepA;out vec2 vPaintBSample;out vec2 vStepB;out vec2 vNodeSpacePoint;out vec2 vGradientSampleUV;void setMSAAVaryingsForImagePaintB(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintBSample = (uPaintTransform1 * vec3(shapeUv, 1)).xy;vStepB =(uPaintTransform1 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintBSample;}void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);setMSAAVaryingsForImagePaintB(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_BLEND_MODE_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;uniform float uOpacity;uniform int uType;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;float minv3(vec3 c) { return min(min(c.r, c.g), c.b); }float maxv3(vec3 c) { return max(max(c.r, c.g), c.b); }float satv3(vec3 c) { return maxv3(c) - minv3(c); }float lumv3(vec3 c) {return dot(c, vec3(0.30, 0.59, 0.11)); }vec3 setLum(vec3 cbase, vec3 clum) {cbase = clamp(cbase, 0.0, 1.0);clum = clamp(clum, 0.0, 1.0);float llum = lumv3(clum);vec3 color = cbase + (llum - lumv3(cbase));float minc = minv3(color);float maxc = maxv3(color);if (minc < 0.0) {color = mix(vec3(llum), color, llum / (llum - minc));} else if (maxc > 1.0) {color = mix(vec3(llum), color, (1.0 - llum) / (maxc - llum));}return color;}vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum) {float sbase = satv3(cbase);vec3 color = vec3(0.0);if (sbase > 0.0) {float minbase = minv3(cbase);float ssat = satv3(csat);color = (cbase - minbase) * ssat / sbase;}return setLum(color, clum);}out vec4 fig_FragColor;void main() {const int DARKEN = 2;const int MULTIPLY = 3;const int LINEAR_BURN = 4;const int COLOR_BURN = 5;const int LIGHTEN = 6;const int SCREEN = 7;const int LINEAR_DODGE = 8;const int COLOR_DODGE = 9;const int OVERLAY = 10;const int SOFT_LIGHT = 11;const int HARD_LIGHT = 12;const int DIFFERENCE = 13;const int EXCLUSION = 14;const int HUE = 15;const int SATURATION = 16;const int COLOR = 17;const int LUMINOSITY = 18;vec4 source = texture(texture0, vCoord2) * uOpacity;vec4 target = texture(texture1, vCoord2);float Sa = source.a;float Da = target.a;vec3 Dca = target.rgb;if (Sa == 0.0) {fig_FragColor = vec4(Dca, Da);}else {float epsilon = 0.000001;vec3 Sca = source.rgb;vec3 color = Sca * (1.0 - Da) + Dca * (1.0 - Sa);if (uType == DARKEN) {color += min(Sca * Da, Dca * Sa);}else if (uType == MULTIPLY) {color += Sca * Dca;}else if (uType == LINEAR_BURN) {color = max(vec3(0.0), Sca + Dca - Sa * Da);}else if (uType == COLOR_BURN) {vec3 denominator = max(Sca * Da, DITHER_FACTOR);vec3 numerator = (Da - Dca) * Sa * step(DITHER_FACTOR, Da - Dca);color += Sa * Da * (1.0 - min(vec3(1.0), numerator / denominator));}else if (uType == LIGHTEN) {color += max(Sca * Da, Dca * Sa);}else if (uType == SCREEN) {color = Sca + Dca - Sca * Dca;}else if (uType == LINEAR_DODGE) {color = min(vec3(1.0), Sca + Dca);}else if (uType == COLOR_DODGE) {vec3 denominator = max(Da * (Sa - Sca), DITHER_FACTOR);vec3 numerator = Dca * Sa * step(DITHER_FACTOR, Dca);color += Sa * Da * min(vec3(1.0), numerator / denominator);}else if (uType == OVERLAY) {color += mix(Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca), 2.0 * Sca * Dca,vec3(lessThanEqual(2.0 * Dca, vec3(Da))));}else if (uType == HARD_LIGHT) {color += mix(2.0 * Sca * Dca, Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),vec3(greaterThan(2.0 * Sca, vec3(Sa))));}else if (uType == DIFFERENCE) {color += abs(Dca * Sa - Sca * Da);}else if (uType == EXCLUSION) {color += Sca * Da + Dca * Sa - 2.0 * Sca * Dca;}else {vec3 delta = vec3(0.0);vec3 Sc = Sca;vec3 Dc = Dca;if (Sa > 0.0)Sc /= Sa;if (Da > 0.0)Dc /= Da;if (uType == SOFT_LIGHT) {vec3 c0 = 1.0 - Dc;vec3 c1 = (16.0 * Dc - 12.0) * Dc + 3.0;vec3 c2 = inversesqrt(Dc + epsilon) - 1.0;vec3 c = mix(c1, c2, vec3(greaterThan(Dc, vec3(0.25))));c = mix(c, c0, vec3(greaterThan(Sc, vec3(0.50))));delta = Dc * (1.0 + c * (2.0 * Sc - 1.0));}else if (uType == HUE) {delta = setLumSat(Sc, Dc, Dc);}else if (uType == SATURATION) {delta = setLumSat(Dc, Sc, Dc);}else if (uType == COLOR) {delta = setLum(Sc, Dc);}else if (uType == LUMINOSITY) {delta = setLum(Dc, Sc);}color += Sa * Da * delta;}fig_FragColor = vec4(color, Sa + Da - Sa * Da);}}`,this.SHADER_SOURCE_BLEND_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = texture(texture0, vCoord2) * uOpacity; }`,this.SHADER_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform vec4 uBlurClamp;uniform int increaseMaxRadiusForBlurs;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord2 = clamp(vCoord2, uBlurClamp.xy, uBlurClamp.zw);float weight = uCount;vec4 result = texture(texture0, coord2) * weight;float total = weight;for (int i = 1; i < 64; i += 2) {if (!bool(increaseMaxRadiusForBlurs)) {if (i >= 32) {break;}}if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = coord2 - uBlurDelta * t0;vec2 coord0_pos = coord2 + uBlurDelta * t0;vec2 coord1_neg = coord2 - uBlurDelta * t1;vec2 coord1_pos = coord2 + uBlurDelta * t1;float weight0_neg =(uCount - t0) *float(coord0_neg == clamp(coord0_neg, uBlurClamp.xy, uBlurClamp.zw));float weight0_pos =(uCount - t0) *float(coord0_pos == clamp(coord0_pos, uBlurClamp.xy, uBlurClamp.zw));float weight1_neg =(uCount - t1) *float(coord1_neg == clamp(coord1_neg, uBlurClamp.xy, uBlurClamp.zw));float weight1_pos =(uCount - t1) *float(coord1_pos == clamp(coord1_pos, uBlurClamp.xy, uBlurClamp.zw));float weight_neg = weight0_neg + weight1_neg;float weight_pos = weight0_pos + weight1_pos;vec2 coord_neg =(coord0_neg * weight0_neg + coord1_neg * weight1_neg) / weight_neg;vec2 coord_pos =(coord0_pos * weight0_pos + coord1_pos * weight1_pos) / weight_pos;result += texture(texture0, coord_neg) * weight_neg +texture(texture0, coord_pos) * weight_pos;total += weight_neg + weight_pos;}fig_FragColor = result / total;}`,this.SHADER_SOURCE_CLAMPED_GRADIENT_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}const int LARGE_TILE_MULTIPLIER = 1;const int maxRadiusInTexelsForBlurs = 64;uniform float startCount;uniform float endCount;uniform vec2 blurDelta;uniform vec4 blurClamp;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform sampler2D texture0;in vec2 _coord2;in vec2 _coord2Source;out vec4 fig_FragColor;void main() {vec2 coord2 = _coord2;vec2 coord2Source = clamp(_coord2Source, blurClamp.xy, blurClamp.zw);float coord2_x_scaling = coord2Source.x / _coord2Source.x;float coord2_y_scaling = coord2Source.y / _coord2Source.y;coord2.x = coord2.x * coord2_x_scaling;coord2.y = coord2.y * coord2_y_scaling;float weight = 0.0;float total = 0.0;vec4 result = vec4(0.0, 0.0, 0.0, 0.0);float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;if (radius < 0.001) {radius = 0.001;}const int maxRadiuxInTexelsAccountingForMultiplier =maxRadiusInTexelsForBlurs * LARGE_TILE_MULTIPLIER;for (int i = 0; i < maxRadiuxInTexelsAccountingForMultiplier; i += 2) {if (float(i) > radius) {break;}float t0 = min(float(i), radius);float t1 = min(float(i) + 1.0, radius);vec2 coord0_neg = coord2 - blurDelta * t0;vec2 coord0_pos = coord2 + blurDelta * t0;vec2 coord1_neg = coord2 - blurDelta * t1;vec2 coord1_pos = coord2 + blurDelta * t1;vec2 coord2Source_coord0_neg = coord2Source - blurDelta * t0;vec2 coord2Source_coord0_pos = coord2Source + blurDelta * t0;vec2 coord2Source_coord1_neg = coord2Source - blurDelta * t1;vec2 coord2Source_coord1_pos = coord2Source + blurDelta * t1;float weight0_neg =(radius - t0) *float(coord2Source_coord0_neg ==clamp(coord2Source_coord0_neg, blurClamp.xy, blurClamp.zw));float weight0_pos =(radius - t0) *float(coord2Source_coord0_pos ==clamp(coord2Source_coord0_pos, blurClamp.xy, blurClamp.zw));float weight1_neg =(radius - t1) *float(coord2Source_coord1_neg ==clamp(coord2Source_coord1_neg, blurClamp.xy, blurClamp.zw));float weight1_pos =(radius - t1) *float(coord2Source_coord1_pos ==clamp(coord2Source_coord1_pos, blurClamp.xy, blurClamp.zw));if (i == 0) {weight0_neg = weight0_neg / 2.0;weight0_pos = weight0_pos / 2.0;}const float minimumContribution = 1.0 / 256.0;if (abs(blurDelta.x * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution ||abs(blurDelta.y * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution) {if (weight0_neg > 0.0 || weight1_neg > 0.0) {float weightCoordNegSum = weight0_neg + weight1_neg;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) /weightCoordNegSum;result += texture(texture0, coord_neg) * weightCoordNegSum;total += weightCoordNegSum;}if (weight0_pos > 0.0 || weight1_pos > 0.0) {float weightCoordPosSum = weight0_pos + weight1_pos;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) /weightCoordPosSum;result += texture(texture0, coord_pos) * weightCoordPosSum;total += weightCoordPosSum;}} else {if (weight0_neg > 0.0) {result += texture(texture0, coord0_neg) * weight0_neg;total += weight0_neg;}if (weight0_pos > 0.0) {result += texture(texture0, coord0_pos) * weight0_pos;total += weight0_pos;}if (weight1_neg > 0.0) {result += texture(texture0, coord1_neg) * weight1_neg;total += weight1_neg;}if (weight1_pos > 0.0) {result += texture(texture0, coord1_pos) * weight1_pos;total += weight1_pos;}}}fig_FragColor = result / total;}`,this.SHADER_SOURCE_CLAMPED_GRAIN_FRAGMENT=`#version 300 es
precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2; out vec4 fig_FragColor;uniform float radiusInPixelSpace;uniform float scale;uniform vec2 nodeSize;uniform float noiseSize;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform int uSeed;void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;float a = turbulence(0 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);float b = turbulence(1 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);vec2 amt = vec2(a, b);vec2 untransformedSamplingPoint = vCoord2;vec2 samplingPoint = nodeSpacePixelPoint + amt * radiusInPixelSpace;vec2 finalSamplingPoint = (nodeToTileSpace * vec3(samplingPoint, 1.0)).xy;vec2 expandedRegionSamplingPoint =((((finalSamplingPoint - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 sourceTexel = texture(texture1, untransformedSamplingPoint);vec4 destTexel = texture(texture0, expandedRegionSamplingPoint);float fixedAmountScaling = pow(sourceTexel.a, 0.2) * pow(destTexel.a, 0.2);vec2 samplingPointAlphaAdjusted =nodeSpacePixelPoint + amt * radiusInPixelSpace * fixedAmountScaling;vec2 finalSamplingPointAlphaAdjusted =(nodeToTileSpace * vec3(samplingPointAlphaAdjusted, 1.0)).xy;vec2 expandedRegionSamplingPointAlphaAdjusted =((((finalSamplingPointAlphaAdjusted - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 fixedDestTexel =texture(texture0, expandedRegionSamplingPointAlphaAdjusted);if (sourceTexel.a > 0.0 && fixedDestTexel.a > 0.0) {fig_FragColor = fixedDestTexel;} else {fig_FragColor = sourceTexel;}}`,this.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX=`#version 300 es
precision highp float;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(aPosition2 * 2.0 - 1.0, 0.0, 1.0);}`,this.SHADER_SOURCE_COPY_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;in vec2 aPosition2;void main() { gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2), 0, 1); }`,this.SHADER_SOURCE_DOWNSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = texture(texture0, vCoord2); }`,this.SHADER_SOURCE_DOWNSAMPLE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform vec4 uSource;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}`,this.SHADER_SOURCE_DRAW_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform vec4 uUvSpaceClampingRect;uniform vec4 uUvSpaceSourceRect;uniform sampler2D texture0;in vec2 vCoord2;const bool drawDebugStuff = false;out vec4 fig_FragColor;void main() {vec2 sampleCoordinates =clamp(vCoord2, uUvSpaceClampingRect.xy, uUvSpaceClampingRect.zw);fig_FragColor = texture(texture0, sampleCoordinates) * uOpacity;if (drawDebugStuff) {vec2 tt = 2.0 * abs((vCoord2 - uUvSpaceSourceRect.xy) /(uUvSpaceSourceRect.zw - uUvSpaceSourceRect.xy) -0.5);float t = max(tt.x, tt.y);if (t > 0.99) {fig_FragColor = vec4(1.0, 0.0, 0.0, 1.0);}}}`,this.SHADER_SOURCE_DRAW_TEXTURE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uUvSpaceSourceRect;uniform mat3 uToClipSpaceTransform;uniform vec4 uDestinationRect;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uUvSpaceSourceRect.xy, uUvSpaceSourceRect.zw, aPosition2);gl_Position = vec4((uToClipSpaceTransform *vec3(mix(uDestinationRect.xy, uDestinationRect.zw, aPosition2), 1.0)).xy,0, 1);}`,this.SHADER_SOURCE_GLASS_FRAGMENT=`#version 300 es
precision highp float;float sdBox(vec2 p, vec2 halfSize) {vec2 d = abs(p) - halfSize;return length(max(d, vec2(0.0))) + min(max(d.x, d.y), 0.0);}float sdRoundBox(vec2 p, vec2 halfSize, float cornerRadius) {float rn = min(cornerRadius, min(halfSize.x, halfSize.y));return sdBox(p, halfSize - rn) - rn;}mat2 rot(float t) {float cosT = cos(t);float sinT = sin(t);return mat2(cosT, -sinT, sinT, cosT);}const int NUM_NEWTON_ITERATIONS =2; const int NUM_NEWTON_START_POINTS =3; const float NEWTON_DAMPING_FACTOR = 1.0; int solveCubic(float a, float b, float c, out vec3 roots) {float p = b - a * a / 3.0;float q = a * (2.0 * a * a - 9.0 * b) / 27.0 + c;float p3 = p * p * p;float discriminant = q * q + 4.0 * p3 / 27.0;float offset = -a / 3.0; if (discriminant >= 0.0) {float z = sqrt(discriminant);float u = (-q + z) / 2.0;float v = (-q - z) / 2.0;u = sign(u) * pow(abs(u), 1.0 / 3.0);v = sign(v) * pow(abs(v), 1.0 / 3.0);roots[0] = offset + u + v;float f = ((roots[0] + a) * roots[0] + b) * roots[0] + c; float f1 = (3. * roots[0] + 2. * a) * roots[0] + b;       roots[0] -= f / f1; return 1; }float u = sqrt(-p / 3.0);float v = acos(-sqrt(-27.0 / p3) * q / 2.0) / 3.0;float m = cos(v), n = sin(v) * 1.732050808; roots[0] = offset + u * (m + m); roots[1] = offset - u * (n + m); roots[2] = offset + u * (n - m); vec3 f = ((roots + a) * roots + b) * roots + c; vec3 f1 = (3.0 * roots + 2.0 * a) * roots + b;  roots -= f / f1;                                return 3; }float cubicBezierSign(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {float cu = (-p0.y + 3.0 * p1.y - 3.0 * p2.y + p3.y); float qu = (3.0 * p0.y - 6.0 * p1.y + 3.0 * p2.y);   float li = (-3.0 * p0.y + 3.0 * p1.y);               float co = p0.y - uv.y; vec3 roots;int numRoots = solveCubic(qu / cu, li / cu, co / cu, roots);int numIntersections = 0;for (int i = 0; i < 3; i++) {if (i < numRoots) {if (roots[i] >= 0.0 && roots[i] <= 1.0) {float t = roots[i];float xPos = ((((-p0.x + 3. * p1.x - 3. * p2.x + p3.x) * t +(3. * p0.x - 6. * p1.x + 3. * p2.x)) *t) +(-3. * p0.x + 3. * p1.x)) *t +p0.x;if (xPos < uv.x) {numIntersections++;}}}}vec2 tangStart = p0.xy - p1.xy;vec2 tangEnd = p2.xy - p3.xy;vec2 normStart = vec2(tangStart.y, -tangStart.x);vec2 normEnd = vec2(tangEnd.y, -tangEnd.x);if (p0.y < p1.y) {if ((uv.y <= p0.y) && (dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}} else {if (!(uv.y <= p0.y) && !(dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}}if (p2.y < p3.y) {if (!(uv.y <= p3.y) && dot(uv - p3.xy, normEnd) < 0.0) {numIntersections++;}} else {if ((uv.y <= p3.y) && !(dot(uv - p3.xy, normEnd) < 0.0)) {numIntersections++;}}if (numIntersections == 0 || numIntersections == 2 || numIntersections == 4) {return 1.0; } else {return -1.0; }}float cubicBezierNormalIteration(float t, vec2 a0, vec2 a1, vec2 a2, vec2 a3) {vec2 a_2 = a2 + t * a3;  vec2 a_1 = a1 + t * a_2; vec2 b_2 = a_2 + t * a3; vec2 uvToP =a0 + t * a_1; vec2 tang = a_1 + t * b_2; float tanLenSq =dot(tang, tang); float projection = dot(tang, uvToP); return t - NEWTON_DAMPING_FACTOR * projection / tanLenSq;}float cubicBezierDistApproxSq(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {vec2 a3 = (-p0 + 3.0 * p1 - 3.0 * p2 + p3); vec2 a2 = (3.0 * p0 - 6.0 * p1 + 3.0 * p2); vec2 a1 = (-3.0 * p0 + 3.0 * p1);           vec2 a0 = p0 - uv; float d0 = 1.0e38; float t0 = 0.;     float t;           for (int i = 0; i < NUM_NEWTON_START_POINTS; i++) {t = t0; for (int j = 0; j < NUM_NEWTON_ITERATIONS; j++) {t = cubicBezierNormalIteration(t, a0, a1, a2, a3);}t = clamp(t, 0.0, 1.0);vec2 uvToP = ((a3 * t + a2) * t + a1) * t + a0;d0 = min(d0, dot(uvToP, uvToP)); t0 += 1. / float(NUM_NEWTON_START_POINTS - 1);}return d0; }float cubicBezierDistApprox(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {return sqrt(cubicBezierDistApproxSq(uv, p0, p1, p2, p3));}float sdSmoothRoundCorner(vec2 uv, float radius, float smoothing) {float PI = 3.14159265359;float HALF_PI = PI * 0.5;float SQRT_2 = 1.41421356237;float bezAngle = 0.5 * HALF_PI * smoothing;float arcAngle = HALF_PI * (1.0 - smoothing);float requiredEdgeLength = (1.0 + smoothing) * radius;float dOverC = tan(bezAngle);float l = sin(arcAngle * 0.5) * radius * SQRT_2;float c = radius * tan(bezAngle * 0.5) * cos(bezAngle);float d = c * dOverC;float b = ((requiredEdgeLength - l) - (1.0 + dOverC) * c) / 3.0;float a = 2.0 * b;uv = rot(PI * -0.25) * uv;uv.x = -abs(uv.x);vec2 cp = uv + vec2(0.0, 1.414213) * radius;float angle = atan(cp.x, cp.y);uv = rot(PI * 0.25) * uv;vec2 p0 = vec2(-requiredEdgeLength, 0.0);vec2 p1 = p0 + vec2(a, 0.0);vec2 p2 = p1 + vec2(b, 0.0);vec2 p3 = p2 + vec2(c, -d);vec2 cornerCenter = uv + requiredEdgeLength;if (cornerCenter.x < 0.0) {return cornerCenter.y - requiredEdgeLength;} else if (abs(angle) < arcAngle * 0.5) {return length(cp) - radius;}float dis = cubicBezierDistApprox(uv, p0, p1, p2, p3);float sgn = -cubicBezierSign(uv, p0, p1, p2, p3);return dis * sgn;}float sdSmoothRoundBox(vec2 uv, vec2 halfSize, float radius, float smoothing) {vec2 p = abs(uv) - halfSize;float minHalfSize = min(halfSize.x, halfSize.y);float requiredLength = radius * (1.0 + smoothing);float overlap = max(0.0, requiredLength - minHalfSize) / radius;float finalSmoothing = max(0.0, smoothing - overlap);float finalRadius = min(minHalfSize, radius);return sdSmoothRoundCorner(p, finalRadius, finalSmoothing);}const float HALF_PI = 1.57079632679;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2;in vec2 vCoord2; out vec4 fig_FragColor;uniform float cornerRadiusInPixelSpace;uniform float cornerSmoothing;uniform float scale;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform float reflRadiusInPixelSpace;uniform float refractionIntensity;uniform float refractionDistance;uniform float lightIntensity;uniform float lightAngle;uniform float bevelSize;uniform float chromaticAberration;uniform vec4 tintColor;float linearstep(float a, float b, float t) {return clamp((t - a) / max(0.00001, b - a), 0.0, 1.0);}vec2 nodeSpaceToExpandedTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;vec2 expandedRegionSourceSamplingPoint =((((tileSpacePosition - 0.5) * 2.0) * scale) / 2.0) + 0.5;return expandedRegionSourceSamplingPoint;}vec2 nodeSpaceToStandardTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;return tileSpacePosition;}vec4 getRefractedTexture(vec2 p) {vec2 finalSamplingPositionInTileSpace =nodeSpaceToExpandedTileSpacePosition(p);return texture(texture0, finalSamplingPositionInTileSpace);}vec4 getRefractedTextureWithChromaticAberration(vec2 p, vec2 refrDir,float chromaAmt) {const int CHROMA_KERNEL_SIZE = 8;vec4 chromaBlurredColor = vec4(0.0, 0.0, 0.0, 0.0);float invKernelSize = 1.0 / float(CHROMA_KERNEL_SIZE - 1);float sum = 0.0;for (int i = 0; i < CHROMA_KERNEL_SIZE; i++) {float fi = float(i) * invKernelSize - 0.5; float window = 1.0 - abs(fi * 2.0);        vec4 red = getRefractedTexture(p + (fi + 0.5) * chromaAmt * refrDir);vec4 green = getRefractedTexture(p + fi * chromaAmt * refrDir);vec4 blue = getRefractedTexture(p + (fi - 0.5) * chromaAmt * refrDir);float alpha = max(max(red.a, green.a), blue.a);chromaBlurredColor += vec4(red.r, green.g, blue.b, alpha) * window;sum += window;}return chromaBlurredColor / sum;}vec2 getGlassRectNormal(vec2 p, vec2 halfSize, float cornerRad) {float r = min(min(halfSize.x, halfSize.y), cornerRad);vec2 d = abs(p) - (halfSize - r);return normalize(d + max(-min(d.x, d.y), 1.0e-5)) * sign(p);}vec2 getGlassRectRefractionDir(vec2 p, vec2 halfSize, float cornerRad,float refractionDistance) {return getGlassRectNormal(p, halfSize, max(cornerRad, refractionDistance));}void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;vec2 boundsSize = nodeSpaceCenterPoint * 2.0;vec2 halfBoundsSize = boundsSize * 0.5;float minHalfSize = min(halfBoundsSize.x, halfBoundsSize.y);vec2 boundsCenter = nodeSpaceCenterPoint;vec2 pBox = nodeSpacePixelPoint - nodeSpaceCenterPoint;float boxDist = sdSmoothRoundBox(pBox, halfBoundsSize,cornerRadiusInPixelSpace, cornerSmoothing);float BEVEL_SIZE = bevelSize;float BEVEL_REFRACTION_MULT = 0.2; float REFRACTION_STRENGTH = refractionIntensity;float refractionDistance = min(minHalfSize, refractionDistance);float refrArea =linearstep(-refractionDistance - BEVEL_SIZE, -BEVEL_SIZE, boxDist);float refrMult = pow(refrArea, 3.5) * refractionDistance;float maxRefrOffset = 0.999 * refractionDistance;float dishRefrOffset =clamp(refrMult * REFRACTION_STRENGTH, -maxRefrOffset, maxRefrOffset);float bevelRefrOffset =REFRACTION_STRENGTH * BEVEL_REFRACTION_MULT * maxRefrOffset;float isBevel = linearstep(-BEVEL_SIZE - 0.0001, -BEVEL_SIZE * 0.3, boxDist);vec2 glassNormal =getGlassRectRefractionDir(pBox, halfBoundsSize, cornerRadiusInPixelSpace,max(BEVEL_SIZE, refractionDistance));vec2 refrDir = -glassNormal * mix(dishRefrOffset, bevelRefrOffset, isBevel);vec2 p = nodeSpacePixelPoint;vec4 nonGlassBg = texture(texture2, nodeSpaceToStandardTileSpacePosition(p));vec4 col = vec4(0.0);p += refrDir;if (chromaticAberration < 0.001) {col = getRefractedTexture(p);} else {col = getRefractedTextureWithChromaticAberration(p, refrDir,chromaticAberration);}col = col * (1.0 - tintColor.a) + tintColor;float LIGHT_INTENSITY = lightIntensity;float SPECULAR_HARDNESS = 0.2;float halfSpecThk = BEVEL_SIZE * 0.5;float rim =smoothstep(-BEVEL_SIZE - 0.001, -BEVEL_SIZE * SPECULAR_HARDNESS, boxDist);float frameRot =atan(nodeToTileSpace[1][0],nodeToTileSpace[0][0]); float SPECULAR_FALLOFF = 0.35;   float BOTTOM_LIGHT_MULT = 0.6;float specularAngle = lightAngle + frameRot + HALF_PI;vec2 specularNormal =getGlassRectNormal(pBox, halfBoundsSize, cornerRadiusInPixelSpace);vec2 lightDir = vec2(cos(specularAngle), sin(specularAngle));col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, -lightDir)) *rim * LIGHT_INTENSITY;col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, lightDir)) *rim * LIGHT_INTENSITY * BOTTOM_LIGHT_MULT;float DISH_SHADE_STRENGTH = 0.05;float shadeSize = refractionDistance;float shadeMult =pow(linearstep(-shadeSize, -BEVEL_SIZE + 0.0001, boxDist), 2.0);float shadeAmt = dot(glassNormal, lightDir);col.xyz += shadeAmt * shadeMult * DISH_SHADE_STRENGTH * LIGHT_INTENSITY;col = mix(col, nonGlassBg, step(0.0, boxDist));fig_FragColor = col;}`,this.SHADER_SOURCE_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord = _gradientCoord(vCoord2);fig_FragColor = ditherColor(texture(texture0, coord) * uOpacity);}`,this.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 quad;uniform vec4 source;uniform vec4 blurRangeSource;in vec2 position2;out vec2 _coord2;out vec2 _coord2Source;void main() {_coord2Source = mix(blurRangeSource.xy, blurRangeSource.zw, position2);_coord2 = mix(source.xy, source.zw, position2);gl_Position = vec4(mix(quad.xy, quad.zw, position2) * 2.0 - 1.0, 0, 1);}`,this.SHADER_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = float(texture(texture0, vCoord2).a > 0.0) * uColor;}`,this.SHADER_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform vec4 uColor;uniform float uTextureSize;uniform float uTexturePx;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coordInSSAA = vCoord2 * vec2(uTextureSize);vec2 lowerLeftInSSAA = floor(coordInSSAA - vec2(0.5)) + 0.5;vec2 lowerLeftTexelCoord = lowerLeftInSSAA * uTexturePx;vec2 lowerRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, 0.0);vec2 upperLeftTexelCoord = lowerLeftTexelCoord + vec2(0.0, uTexturePx);vec2 upperRightTexelCoord =lowerLeftTexelCoord + vec2(uTexturePx, uTexturePx);float lowerLeftAlpha = texture(texture0, lowerLeftTexelCoord).a;float lowerRightAlpha = texture(texture0, lowerRightTexelCoord).a;float upperLeftAlpha = texture(texture0, upperLeftTexelCoord).a;float upperRightAlpha = texture(texture0, upperRightTexelCoord).a;float hardMaskedLowerLeftAlpha = float(lowerLeftAlpha > 0.0);float hardMaskedLowerRightAlpha = float(lowerRightAlpha > 0.0);float hardMaskedUpperLeftAlpha = float(upperLeftAlpha > 0.0);float hardMaskedUpperRightAlpha = float(upperRightAlpha > 0.0);float rightWeight = coordInSSAA.x - lowerLeftInSSAA.x;float leftWeight = 1.0 - rightWeight;float topWeight = coordInSSAA.y - lowerLeftInSSAA.y;float bottomWeight = 1.0 - topWeight;float downsampledHardMaskedAlpha = (hardMaskedLowerLeftAlpha * leftWeight +hardMaskedLowerRightAlpha * rightWeight) *bottomWeight +(hardMaskedUpperLeftAlpha * leftWeight +hardMaskedUpperRightAlpha * rightWeight) *topWeight;fig_FragColor = downsampledHardMaskedAlpha * uColor;}`,this.SHADER_SOURCE_IMAGE_FRAGMENT=`#version 300 es
precision highp float;uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb *= color.a;fig_FragColor = color * uOpacity;}`,this.SHADER_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb = pipeline(color.rgb) * color.a;fig_FragColor = color * uOpacity;}`,this.SHADER_SOURCE_IMAGE_PATTERN_FRAGMENT=`#version 300 es
precision highp float;uniform vec2 patternTexSizePixels;uniform vec2 patternBoundsOffsetPixels;uniform float tileSizePixels;uniform vec2 fillSizePixels;uniform vec2 offsetPixels;uniform int patternTileType;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {const int RECTANGULAR = 0;const int HORIZONTAL_HEXAGONAL = 1;const int VERTICAL_HEXAGONAL = 2;float xRepeats = fillSizePixels.x / patternTexSizePixels.x;float yRepeats = fillSizePixels.y / patternTexSizePixels.y;vec2 offsetMultiplier = vec2(offsetPixels.x / patternTexSizePixels.x,offsetPixels.y / patternTexSizePixels.y);vec2 coord2 = vec2(vCoord2.x * xRepeats, vCoord2.y * yRepeats);vec2 patternBoundsOffsetUV =vec2(patternBoundsOffsetPixels.x / patternTexSizePixels.x,patternBoundsOffsetPixels.y / patternTexSizePixels.y);coord2 -= offsetMultiplier;coord2 += patternBoundsOffsetUV;if (patternTileType == HORIZONTAL_HEXAGONAL) {coord2.x += (1.0 + step(1., mod(coord2.y, 2.0))) * 0.5;} else if (patternTileType == VERTICAL_HEXAGONAL) {coord2.y += (1.0 + step(1., mod(coord2.x, 2.0))) * 0.5;}coord2 = fract(coord2);vec2 percentage = patternTexSizePixels / tileSizePixels;vec2 clampPercentage = (patternTexSizePixels - 0.5) / tileSizePixels;fig_FragColor = texture(texture0, min(coord2 * percentage, clampPercentage));}`,this.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = texture(texture0, vCoord2); }`,this.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_VERTEX=`#version 300 es
precision highp float;uniform mat3 paintTransform;uniform mat3 vertexTransform;in vec2 position2;in vec3 coord3; out vec2 vCoord2;void main() {vCoord2 = (paintTransform * coord3).xy;gl_Position = vec4(vertexTransform * vec3(position2, 1), 0).xywz;}`,this.SHADER_SOURCE_LERP_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord = _gradientCoord(vCoord2);vec4 lerped =mix(texture(texture0, coord), texture(texture1, coord), uProgress);fig_FragColor = ditherColor(lerped * uOpacity);}`,this.SHADER_SOURCE_LERP_IMAGE_FRAGMENT=`#version 300 es
precision highp float;uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;in vec2 vCoord2b;out vec4 fig_FragColor;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb *= lerped.a;fig_FragColor = lerped * uOpacity;}`,this.SHADER_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;in vec2 vCoord2b;out vec4 fig_FragColor;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;fig_FragColor = lerped * uOpacity;}`,this.SHADER_SOURCE_LERP_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 texture0UvSpaceScissor;uniform vec4 texture1UvSpaceScissor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 texture0Color = all(greaterThan(vCoord2, texture0UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture0UvSpaceScissor.zw))? texture(texture0, vCoord2): vec4(0.0);vec4 texture1Color = all(greaterThan(vCoord2, texture1UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture1UvSpaceScissor.zw))? texture(texture1, vCoord2): vec4(0.0);fig_FragColor = mix(texture0Color, texture1Color, uOpacity);}`,this.SHADER_SOURCE_LOOP_BLINN_FRAGMENT=`#version 300 es
precision highp float;in vec3 vCoord3;out vec4 fig_FragColor;void main() {if (vCoord3.x * vCoord3.x * vCoord3.x > vCoord3.y * vCoord3.z) {discard;}}`,this.SHADER_SOURCE_LOOP_BLINN_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec2 aPosition2;in vec3 aCoord3;out vec3 vCoord3;void main() {vCoord3 = aCoord3;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.SHADER_SOURCE_LOOP_BLINN_INSTANCED_VERTEX=`#version 300 es
mat3 constructInstanceTransform(vec3 instTransform0, vec3 instTransform1) {return mat3(vec3(instTransform0.x, instTransform1.x, 0.0),vec3(instTransform0.y, instTransform1.y, 0.0),vec3(instTransform0.z, instTransform1.z, 1.0));}precision highp float;uniform mat3 canvasSpaceToClipSpaceTransform;in vec2 aPosition2;in vec3 aCoord3;in vec3 instanceTransform0;in vec3 instanceTransform1;out vec3 vCoord3;void main() {vCoord3 = aCoord3;mat3 instanceTransform =constructInstanceTransform(instanceTransform0, instanceTransform1);mat3 vertexTransform = canvasSpaceToClipSpaceTransform * instanceTransform;gl_Position = vec4(vertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {if (texture(texture1, vCoord2).a == 0.0) {discard;}fig_FragColor = texture(texture0, vCoord2);}`,this.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = (1.0 - texture(texture0, vCoord2).a) *texture(texture1, vCoord2).a * uColor;}`,this.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float texture1HardMasked = float(texture(texture1, vCoord2).a > 0.0);fig_FragColor =(1.0 - texture(texture0, vCoord2).a) * texture1HardMasked * uColor;}`,this.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor =texture(texture0, vCoord2) * float(texture(texture1, vCoord2).a == 0.);}`,this.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; in vec2 vCoord2;out vec4 fig_FragColor;void main() {float geometryAlpha = texture(texture2, vCoord2).a;fig_FragColor = mix(texture(texture1, vCoord2),texture(texture0, vCoord2) * float(geometryAlpha == 0.),1.0 - geometryAlpha);}`,this.SHADER_SOURCE_MASK_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = texture(texture0, vCoord2) * texture(texture1, vCoord2).a;}`,this.SHADER_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec3 rgb = texture(texture1, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);fig_FragColor =texture(texture0, vCoord2) * luminance * texture(texture1, vCoord2).a;}`,this.SHADER_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec3 rgb = texture(texture2, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);fig_FragColor = mix(texture(texture1, vCoord2),texture(texture0, vCoord2),texture(texture2, vCoord2).a * luminance);}`,this.SHADER_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = mix(texture(texture1, vCoord2), texture(texture0, vCoord2),texture(texture2, vCoord2).a);}`,this.SHADER_SOURCE_NOISE_EFFECT_FRAGMENT=`#version 300 es
precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;in vec2 vCoord2; out vec4 fig_FragColor;uniform int uNoiseType;uniform float uNoiseSize;uniform mat3 uTileToNodeSpace;uniform float uDensity; uniform vec4 uColor;uniform vec4 uSecondaryColor;uniform vec2 uNodeSpaceCenterPoint;uniform int uSeed;void main() {vec2 nodeSpacePixelPoint = (uTileToNodeSpace * vec3(vCoord2, 1.0)).xy;float r = roundHelper((turbulence(0 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float g = roundHelper((turbulence(1 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float b = roundHelper((turbulence(2 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float a = roundHelper((turbulence(3 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);vec4 sourceValue = texture(texture0, vCoord2);if (uNoiseType == 0) {r = 2.0 * r - 0.5;g = 2.0 * g - 0.5;b = 2.0 * b - 0.5;a = filter_val(a, uDensity, false);a *= uColor.a;a *= sourceValue.a;fig_FragColor = vec4(r * a, g * a, b * a, a);} else if (uNoiseType == 1) {a = roundHelper(0.213 * r + 0.715 * g + 0.072 * b);a = filter_val(a, uDensity, false);a *= uColor.a;a *= sourceValue.a;fig_FragColor = vec4(uColor.rgb * a, a);} else {a = roundHelper(0.213 * r + 0.715 * g + 0.072 * b);float a1 = filter_val(a, uDensity, false);float a2 = filter_val(a, uDensity, true);if (a1 == 1.0) {a1 *= uSecondaryColor.a;a1 *= sourceValue.a;fig_FragColor = vec4(uSecondaryColor.rgb * a1, a1);} else {a2 *= uColor.a;a2 *= sourceValue.a;fig_FragColor = vec4(uColor.rgb * a2, a2);}}}`,this.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_RECTANGLE_BLUR_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}uniform vec4 uColor;in vec4 vCoord4;out vec4 fig_FragColor;void main() {float alpha = (integrateTriangle(vCoord4.x) - integrateTriangle(vCoord4.z)) *(integrateTriangle(vCoord4.y) - integrateTriangle(vCoord4.w));fig_FragColor = ditherColor(uColor * alpha);}`,this.SHADER_SOURCE_RECTANGLE_BLUR_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform vec4 uQuad;uniform float uBlurRadius;in vec2 aPosition2;out vec4 vCoord4;void main() {vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord4 = (vec4(vertex, vertex) - uQuad) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}`,this.SHADER_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D texture0;in vec4 vPosition4;out vec4 fig_FragColor;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;uv.y = 1.0 - uv.y;fig_FragColor = texture(texture0, uv);}`,this.SHADER_SOURCE_RENDER_DEVICE_FRAME_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aPosition4;out vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}`,this.SHADER_SOURCE_RENDER_HOTSPOT_FRAGMENT=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform float uHotspotOpacity;uniform vec2 uStrokeProportion;uniform vec4 uUvHotspotClippingRect;in vec4 vPosition4;const vec3 HOTSPOT_COLOR = vec3(48.0 / 255.0, 194.0 / 255.0, 255.0 / 255.0);bool contains(vec4 rect, vec2 point) {return (rect.z >= 0.0 && rect.w >= 0.0 &&clamp(point.x, rect.x, rect.x + rect.z) == point.x &&clamp(point.y, rect.y, rect.y + rect.w) == point.y);}out vec4 fig_FragColor;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;if (contains(uUvHotspotClippingRect, position)) {if (uv.x < uStrokeProportion.x || uv.x > 1.0 - uStrokeProportion.x ||uv.y < uStrokeProportion.y || uv.y > 1.0 - uStrokeProportion.y) {fig_FragColor = vec4(HOTSPOT_COLOR, 1.0 * uHotspotOpacity);} else {fig_FragColor = vec4(HOTSPOT_COLOR, 0.5 * uHotspotOpacity);}} else {fig_FragColor = vec4(0.0);}}`,this.SHADER_SOURCE_RENDER_HOTSPOT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aPosition4;out vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}`,this.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}uniform vec4 uColor;uniform vec2 uHalfSizeOverBlurRadius;uniform float uCornerRadiusOverBlurRadius;in vec2 vCoord2;float triangle(float x) { return max(0.0, (1.0 - abs(x))); }float roundedRectangleBlurHorizontal(float x, float y, float cornerRadius,vec2 halfSize) {float deltaY = min(halfSize.y - cornerRadius - abs(y), 0.0);float roundedRectX =halfSize.x - cornerRadius +sqrt(max(0.0, cornerRadius * cornerRadius - deltaY * deltaY));vec2 xRelativeToLowerAndUpper = vec2(x + roundedRectX, x - roundedRectX);return integrateTriangle(xRelativeToLowerAndUpper.x) -integrateTriangle(xRelativeToLowerAndUpper.y);}out vec4 fig_FragColor;void main() {float alpha;if (all(lessThan(abs(vCoord2),uHalfSizeOverBlurRadius - vec2(uCornerRadiusOverBlurRadius +1.0 )))) {alpha = 1.0;} else {float low = vCoord2.y - uHalfSizeOverBlurRadius.y;float high = vCoord2.y + uHalfSizeOverBlurRadius.y;float start = clamp(-1.0 , low, high);float end = clamp(1.0 , low, high);if (start == end) {alpha = 0.0;} else {const int numSamples = 4;float step = (end - start) / float(numSamples);float y = start + step * 0.5;float weightSum = 0.0;float result = 0.0;for (int i = 0; i < numSamples; i++) {float currentWeight = triangle(y);result += roundedRectangleBlurHorizontal(vCoord2.x, vCoord2.y - y,uCornerRadiusOverBlurRadius,uHalfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;alpha = result * weightNormalizationFactor;}}fig_FragColor = ditherColor(uColor * alpha);}`,this.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform float uBlurRadius;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vCoord2;void main() {vec2 center = (uQuad.xy + uQuad.zw) * 0.5;vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord2 = (vertex - center) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}`,this.SHADER_SOURCE_SMOOTH_PATH_FRAGMENT=`#version 300 es
precision highp float;in vec2 vCoord2;in vec4 vCoord4;out vec4 fig_FragColor;void main() { fig_FragColor = vCoord4 * min(1.0, min(vCoord2.x, vCoord2.y)); }`,this.SHADER_SOURCE_SMOOTH_PATH_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aCoord4;in vec4 aPosition4;out vec2 vCoord2;out vec4 vCoord4;void main() {vCoord2 = aPosition4.zw;vCoord4 = aCoord4;gl_Position = vec4(uVertexTransform * vec3(aPosition4.xy, 1.0), 0.0).xywz;}`,this.SHADER_SOURCE_SOLID_COLOR_PAINT_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform vec4 uColor;out vec4 fig_FragColor;void main() { fig_FragColor = uColor * uOpacity; }`,this.SHADER_SOURCE_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.SHADER_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform int tileAtlasTileSize;in vec2 vCoord2;out vec4 fig_FragColor;void main() {int SSAA_4X4_DIMENSION = tileAtlasTileSize * 4;float SSAA_4X4_PX = 1.0 / float(SSAA_4X4_DIMENSION);vec4 downsampledColor =0.25 * (texture(texture0, vCoord2 + vec2(-SSAA_4X4_PX, -SSAA_4X4_PX)) +texture(texture0, vCoord2 + vec2(SSAA_4X4_PX, -SSAA_4X4_PX)) +texture(texture0, vCoord2 + vec2(SSAA_4X4_PX, SSAA_4X4_PX)) +texture(texture0, vCoord2 + vec2(-SSAA_4X4_PX, SSAA_4X4_PX)));fig_FragColor = downsampledColor * uOpacity;}`,this.SHADER_SOURCE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uQuad.xy, uQuad.zw, aPosition2);gl_Position = vec4(vCoord2 * 2.0 - 1.0, 0, 1);}`,this.SHADER_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;uniform mat3 uPaintTransform1;in vec2 aPosition2;out vec2 vCoord2;out vec2 vCoord2b;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;vCoord2b = (uPaintTransform1 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.SHADER_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform int increaseMaxRadiusForBlurs;uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float weight = uCount;vec4 result = texture(texture0, vCoord2) * weight;float total = weight;for (int i = 1; i < 64; i += 2) {if (!bool(increaseMaxRadiusForBlurs)) {if (i >= 32) {break;}}if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = vCoord2 - uBlurDelta * t0;vec2 coord0_pos = vCoord2 + uBlurDelta * t0;vec2 coord1_neg = vCoord2 - uBlurDelta * t1;vec2 coord1_pos = vCoord2 + uBlurDelta * t1;float weight0 = uCount - t0;float weight1 = uCount - t1;float weightSum = weight0 + weight1;vec2 coord_neg = (coord0_neg * weight0 + coord1_neg * weight1) / weightSum;vec2 coord_pos = (coord0_pos * weight0 + coord1_pos * weight1) / weightSum;result += weightSum *(texture(texture0, coord_neg) + texture(texture0, coord_pos));total += 2.0 * weightSum;}fig_FragColor = result / total;}`,this.SHADER_SOURCE_UNCLAMPED_GRADIENT_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}const int LARGE_TILE_MULTIPLIER = 1;const int maxRadiusInTexelsForBlurs = 64;uniform float startCount;uniform float endCount;uniform vec2 blurDelta;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform sampler2D texture0;in vec2 _coord2;in vec2 _coord2Source;out vec4 fig_FragColor;void main() {vec2 coord2 = _coord2;vec2 coord2Source = _coord2Source;float weight = 0.0;float total = 0.0;vec4 result = vec4(0.0, 0.0, 0.0, 0.0);float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;if (radius < 0.001) {radius = 0.001;}const int maxRadiuxInTexelsAccountingForMultiplier =maxRadiusInTexelsForBlurs * LARGE_TILE_MULTIPLIER;for (int i = 0; i < maxRadiuxInTexelsAccountingForMultiplier; i += 2) {if (float(i) > radius) {break;}float t0 = min(float(i), radius);float t1 = min(float(i) + 1.0, radius);vec2 coord0_neg = coord2 - blurDelta * t0;vec2 coord0_pos = coord2 + blurDelta * t0;vec2 coord1_neg = coord2 - blurDelta * t1;vec2 coord1_pos = coord2 + blurDelta * t1;float weight0_neg = (radius - t0);float weight0_pos = (radius - t0);float weight1_neg = (radius - t1);float weight1_pos = (radius - t1);if (i == 0) {weight0_neg = weight0_neg / 2.0;weight0_pos = weight0_pos / 2.0;}const float minimumContribution = 1.0 / 256.0;if (abs(blurDelta.x * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution ||abs(blurDelta.y * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution) {if (weight0_neg > 0.0 || weight1_neg > 0.0) {float weightCoordNegSum = weight0_neg + weight1_neg;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) /weightCoordNegSum;result += texture(texture0, coord_neg) * weightCoordNegSum;total += weightCoordNegSum;}if (weight0_pos > 0.0 || weight1_pos > 0.0) {float weightCoordPosSum = weight0_pos + weight1_pos;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) /weightCoordPosSum;result += texture(texture0, coord_pos) * weightCoordPosSum;total += weightCoordPosSum;}} else {if (weight0_neg > 0.0) {result += texture(texture0, coord0_neg) * weight0_neg;total += weight0_neg;}if (weight0_pos > 0.0) {result += texture(texture0, coord0_pos) * weight0_pos;total += weight0_pos;}if (weight1_neg > 0.0) {result += texture(texture0, coord1_neg) * weight1_neg;total += weight1_neg;}if (weight1_pos > 0.0) {result += texture(texture0, coord1_pos) * weight1_pos;total += weight1_pos;}}}fig_FragColor = result / total;}`,this.SHADER_SOURCE_UNCLAMPED_GRAIN_FRAGMENT=`#version 300 es
precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;in vec2 vCoord2; out vec4 fig_FragColor;uniform float radiusInPixelSpace;uniform float scale;uniform float noiseSize;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform int uSeed;void main() {fig_FragColor = vec4(0.0, 0.0, 1.0, 1.0);vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;float a = turbulence(0 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);float b = turbulence(1 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);vec2 amt = vec2(a, b);vec2 samplingPoint = nodeSpacePixelPoint + amt * radiusInPixelSpace;vec2 finalSamplingPoint = (nodeToTileSpace * vec3(samplingPoint, 1.0)).xy;vec2 expandedRegionSamplingPoint =((((finalSamplingPoint - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 destTexel = texture(texture0, expandedRegionSamplingPoint);fig_FragColor = destTexel;}`,this.SHADER_SOURCE_UPSAMPLE_AND_BLEND_GRADIENT_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}uniform sampler2D texture0;uniform sampler2D texture1;uniform float startCount;uniform float endCount;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform float scaleToUnadjust;in vec2 _coord2;in vec2 _coord2Source;out vec4 fig_FragColor;void main() {float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;vec2 centerUnadjustedSamplePoint =((((_coord2Source.xy - 0.5) * 2.0) / scaleToUnadjust) + 1.0) / 2.0;if (radius < 1.0) {fig_FragColor = texture(texture1, centerUnadjustedSamplePoint);} else {float weightCenter = radius * radius;float weightBlur =(((radius - 1.0) * (radius - 1.0)) + (2.0 * (radius - 1.0)));weightBlur = weightBlur * 2.0; weightBlur = weightBlur * weightBlur;fig_FragColor =(weightBlur * texture(texture0, _coord2) +weightCenter * texture(texture1, centerUnadjustedSamplePoint)) /(weightBlur + weightCenter);}}`,this.SHADER_SOURCE_UPSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform sampler2D texture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() { fig_FragColor = ditherColor(texture(texture0, vCoord2)); }`,this.SHADER_SOURCE_UPSAMPLE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform vec4 uSource;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}`):(this.SHADER_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);gl_FragColor =ditherColor(texture2D(texture0, coord) * uOpacity) * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb *= color.a;gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform float uOpacity;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb = pipeline(color.rgb) * color.a;gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);vec4 lerped =mix(texture2D(texture0, coord), texture2D(texture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity) * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb *= lerped.a;gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform sampler2D texture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(texture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) /8.;}uniform sampler2D texture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(texture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) /8.;}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;varying vec2 vPaintASample;varying vec2 vStepA;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter,in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) /(ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) /(ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds,vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf =ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant =ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter,uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform vec4 uColor;varying vec2 vNodeSpacePoint;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);gl_FragColor = uColor * uOpacity * coverageAlpha;}`,this.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample,out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA =(uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintASample;}uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform mat3 uVertexTransform;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vPaintASample;varying vec2 vStepA;varying vec2 vPaintBSample;varying vec2 vStepB;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void setMSAAVaryingsForImagePaintB(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintBSample = (uPaintTransform1 * vec3(shapeUv, 1)).xy;vStepB =(uPaintTransform1 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy -vPaintBSample;}void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);setMSAAVaryingsForImagePaintB(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_BLEND_MODE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;uniform float uOpacity;uniform int uType;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;float minv3(vec3 c) { return min(min(c.r, c.g), c.b); }float maxv3(vec3 c) { return max(max(c.r, c.g), c.b); }float satv3(vec3 c) { return maxv3(c) - minv3(c); }float lumv3(vec3 c) {return dot(c, vec3(0.30, 0.59, 0.11)); }vec3 setLum(vec3 cbase, vec3 clum) {cbase = clamp(cbase, 0.0, 1.0);clum = clamp(clum, 0.0, 1.0);float llum = lumv3(clum);vec3 color = cbase + (llum - lumv3(cbase));float minc = minv3(color);float maxc = maxv3(color);if (minc < 0.0) {color = mix(vec3(llum), color, llum / (llum - minc));} else if (maxc > 1.0) {color = mix(vec3(llum), color, (1.0 - llum) / (maxc - llum));}return color;}vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum) {float sbase = satv3(cbase);vec3 color = vec3(0.0);if (sbase > 0.0) {float minbase = minv3(cbase);float ssat = satv3(csat);color = (cbase - minbase) * ssat / sbase;}return setLum(color, clum);}void main() {const int DARKEN = 2;const int MULTIPLY = 3;const int LINEAR_BURN = 4;const int COLOR_BURN = 5;const int LIGHTEN = 6;const int SCREEN = 7;const int LINEAR_DODGE = 8;const int COLOR_DODGE = 9;const int OVERLAY = 10;const int SOFT_LIGHT = 11;const int HARD_LIGHT = 12;const int DIFFERENCE = 13;const int EXCLUSION = 14;const int HUE = 15;const int SATURATION = 16;const int COLOR = 17;const int LUMINOSITY = 18;vec4 source = texture2D(texture0, vCoord2) * uOpacity;vec4 target = texture2D(texture1, vCoord2);float Sa = source.a;float Da = target.a;vec3 Dca = target.rgb;if (Sa == 0.0) {gl_FragColor = vec4(Dca, Da);}else {float epsilon = 0.000001;vec3 Sca = source.rgb;vec3 color = Sca * (1.0 - Da) + Dca * (1.0 - Sa);if (uType == DARKEN) {color += min(Sca * Da, Dca * Sa);}else if (uType == MULTIPLY) {color += Sca * Dca;}else if (uType == LINEAR_BURN) {color = max(vec3(0.0), Sca + Dca - Sa * Da);}else if (uType == COLOR_BURN) {vec3 denominator = max(Sca * Da, DITHER_FACTOR);vec3 numerator = (Da - Dca) * Sa * step(DITHER_FACTOR, Da - Dca);color += Sa * Da * (1.0 - min(vec3(1.0), numerator / denominator));}else if (uType == LIGHTEN) {color += max(Sca * Da, Dca * Sa);}else if (uType == SCREEN) {color = Sca + Dca - Sca * Dca;}else if (uType == LINEAR_DODGE) {color = min(vec3(1.0), Sca + Dca);}else if (uType == COLOR_DODGE) {vec3 denominator = max(Da * (Sa - Sca), DITHER_FACTOR);vec3 numerator = Dca * Sa * step(DITHER_FACTOR, Dca);color += Sa * Da * min(vec3(1.0), numerator / denominator);}else if (uType == OVERLAY) {color += mix(Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca), 2.0 * Sca * Dca,vec3(lessThanEqual(2.0 * Dca, vec3(Da))));}else if (uType == HARD_LIGHT) {color += mix(2.0 * Sca * Dca, Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),vec3(greaterThan(2.0 * Sca, vec3(Sa))));}else if (uType == DIFFERENCE) {color += abs(Dca * Sa - Sca * Da);}else if (uType == EXCLUSION) {color += Sca * Da + Dca * Sa - 2.0 * Sca * Dca;}else {vec3 delta = vec3(0.0);vec3 Sc = Sca;vec3 Dc = Dca;if (Sa > 0.0)Sc /= Sa;if (Da > 0.0)Dc /= Da;if (uType == SOFT_LIGHT) {vec3 c0 = 1.0 - Dc;vec3 c1 = (16.0 * Dc - 12.0) * Dc + 3.0;vec3 c2 = inversesqrt(Dc + epsilon) - 1.0;vec3 c = mix(c1, c2, vec3(greaterThan(Dc, vec3(0.25))));c = mix(c, c0, vec3(greaterThan(Sc, vec3(0.50))));delta = Dc * (1.0 + c * (2.0 * Sc - 1.0));}else if (uType == HUE) {delta = setLumSat(Sc, Dc, Dc);}else if (uType == SATURATION) {delta = setLumSat(Dc, Sc, Dc);}else if (uType == COLOR) {delta = setLum(Sc, Dc);}else if (uType == LUMINOSITY) {delta = setLum(Dc, Sc);}color += Sa * Da * delta;}gl_FragColor = vec4(color, Sa + Da - Sa * Da);}}",this.SHADER_SOURCE_BLEND_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = texture2D(texture0, vCoord2) * uOpacity; }",this.SHADER_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform vec4 uBlurClamp;uniform int increaseMaxRadiusForBlurs;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec2 coord2 = clamp(vCoord2, uBlurClamp.xy, uBlurClamp.zw);float weight = uCount;vec4 result = texture2D(texture0, coord2) * weight;float total = weight;for (int i = 1; i < 64; i += 2) {if (!bool(increaseMaxRadiusForBlurs)) {if (i >= 32) {break;}}if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = coord2 - uBlurDelta * t0;vec2 coord0_pos = coord2 + uBlurDelta * t0;vec2 coord1_neg = coord2 - uBlurDelta * t1;vec2 coord1_pos = coord2 + uBlurDelta * t1;float weight0_neg =(uCount - t0) *float(coord0_neg == clamp(coord0_neg, uBlurClamp.xy, uBlurClamp.zw));float weight0_pos =(uCount - t0) *float(coord0_pos == clamp(coord0_pos, uBlurClamp.xy, uBlurClamp.zw));float weight1_neg =(uCount - t1) *float(coord1_neg == clamp(coord1_neg, uBlurClamp.xy, uBlurClamp.zw));float weight1_pos =(uCount - t1) *float(coord1_pos == clamp(coord1_pos, uBlurClamp.xy, uBlurClamp.zw));float weight_neg = weight0_neg + weight1_neg;float weight_pos = weight0_pos + weight1_pos;vec2 coord_neg =(coord0_neg * weight0_neg + coord1_neg * weight1_neg) / weight_neg;vec2 coord_pos =(coord0_pos * weight0_pos + coord1_pos * weight1_pos) / weight_pos;result += texture2D(texture0, coord_neg) * weight_neg +texture2D(texture0, coord_pos) * weight_pos;total += weight_neg + weight_pos;}gl_FragColor = result / total;}",this.SHADER_SOURCE_CLAMPED_GRADIENT_BLUR_TILE_FRAGMENT="precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}const int LARGE_TILE_MULTIPLIER = 1;const int maxRadiusInTexelsForBlurs = 64;uniform float startCount;uniform float endCount;uniform vec2 blurDelta;uniform vec4 blurClamp;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform sampler2D texture0;varying vec2 _coord2;varying vec2 _coord2Source;void main() {vec2 coord2 = _coord2;vec2 coord2Source = clamp(_coord2Source, blurClamp.xy, blurClamp.zw);float coord2_x_scaling = coord2Source.x / _coord2Source.x;float coord2_y_scaling = coord2Source.y / _coord2Source.y;coord2.x = coord2.x * coord2_x_scaling;coord2.y = coord2.y * coord2_y_scaling;float weight = 0.0;float total = 0.0;vec4 result = vec4(0.0, 0.0, 0.0, 0.0);float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;if (radius < 0.001) {radius = 0.001;}const int maxRadiuxInTexelsAccountingForMultiplier =maxRadiusInTexelsForBlurs * LARGE_TILE_MULTIPLIER;for (int i = 0; i < maxRadiuxInTexelsAccountingForMultiplier; i += 2) {if (float(i) > radius) {break;}float t0 = min(float(i), radius);float t1 = min(float(i) + 1.0, radius);vec2 coord0_neg = coord2 - blurDelta * t0;vec2 coord0_pos = coord2 + blurDelta * t0;vec2 coord1_neg = coord2 - blurDelta * t1;vec2 coord1_pos = coord2 + blurDelta * t1;vec2 coord2Source_coord0_neg = coord2Source - blurDelta * t0;vec2 coord2Source_coord0_pos = coord2Source + blurDelta * t0;vec2 coord2Source_coord1_neg = coord2Source - blurDelta * t1;vec2 coord2Source_coord1_pos = coord2Source + blurDelta * t1;float weight0_neg =(radius - t0) *float(coord2Source_coord0_neg ==clamp(coord2Source_coord0_neg, blurClamp.xy, blurClamp.zw));float weight0_pos =(radius - t0) *float(coord2Source_coord0_pos ==clamp(coord2Source_coord0_pos, blurClamp.xy, blurClamp.zw));float weight1_neg =(radius - t1) *float(coord2Source_coord1_neg ==clamp(coord2Source_coord1_neg, blurClamp.xy, blurClamp.zw));float weight1_pos =(radius - t1) *float(coord2Source_coord1_pos ==clamp(coord2Source_coord1_pos, blurClamp.xy, blurClamp.zw));if (i == 0) {weight0_neg = weight0_neg / 2.0;weight0_pos = weight0_pos / 2.0;}const float minimumContribution = 1.0 / 256.0;if (abs(blurDelta.x * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution ||abs(blurDelta.y * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution) {if (weight0_neg > 0.0 || weight1_neg > 0.0) {float weightCoordNegSum = weight0_neg + weight1_neg;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) /weightCoordNegSum;result += texture2D(texture0, coord_neg) * weightCoordNegSum;total += weightCoordNegSum;}if (weight0_pos > 0.0 || weight1_pos > 0.0) {float weightCoordPosSum = weight0_pos + weight1_pos;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) /weightCoordPosSum;result += texture2D(texture0, coord_pos) * weightCoordPosSum;total += weightCoordPosSum;}} else {if (weight0_neg > 0.0) {result += texture2D(texture0, coord0_neg) * weight0_neg;total += weight0_neg;}if (weight0_pos > 0.0) {result += texture2D(texture0, coord0_pos) * weight0_pos;total += weight0_pos;}if (weight1_neg > 0.0) {result += texture2D(texture0, coord1_neg) * weight1_neg;total += weight1_neg;}if (weight1_pos > 0.0) {result += texture2D(texture0, coord1_pos) * weight1_pos;total += weight1_pos;}}}gl_FragColor = result / total;}",this.SHADER_SOURCE_CLAMPED_GRAIN_FRAGMENT="precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;uniform float radiusInPixelSpace;uniform float scale;uniform vec2 nodeSize;uniform float noiseSize;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform int uSeed;void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;float a = turbulence(0 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);float b = turbulence(1 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);vec2 amt = vec2(a, b);vec2 untransformedSamplingPoint = vCoord2;vec2 samplingPoint = nodeSpacePixelPoint + amt * radiusInPixelSpace;vec2 finalSamplingPoint = (nodeToTileSpace * vec3(samplingPoint, 1.0)).xy;vec2 expandedRegionSamplingPoint =((((finalSamplingPoint - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 sourceTexel = texture2D(texture1, untransformedSamplingPoint);vec4 destTexel = texture2D(texture0, expandedRegionSamplingPoint);float fixedAmountScaling = pow(sourceTexel.a, 0.2) * pow(destTexel.a, 0.2);vec2 samplingPointAlphaAdjusted =nodeSpacePixelPoint + amt * radiusInPixelSpace * fixedAmountScaling;vec2 finalSamplingPointAlphaAdjusted =(nodeToTileSpace * vec3(samplingPointAlphaAdjusted, 1.0)).xy;vec2 expandedRegionSamplingPointAlphaAdjusted =((((finalSamplingPointAlphaAdjusted - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 fixedDestTexel =texture2D(texture0, expandedRegionSamplingPointAlphaAdjusted);if (sourceTexel.a > 0.0 && fixedDestTexel.a > 0.0) {gl_FragColor = fixedDestTexel;} else {gl_FragColor = sourceTexel;}}",this.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX="precision highp float;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(aPosition2 * 2.0 - 1.0, 0.0, 1.0);}",this.SHADER_SOURCE_COPY_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;void main() { gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2), 0, 1); }",this.SHADER_SOURCE_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = texture2D(texture0, vCoord2); }",this.SHADER_SOURCE_DOWNSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}",this.SHADER_SOURCE_DRAW_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uUvSpaceClampingRect;uniform vec4 uUvSpaceSourceRect;uniform sampler2D texture0;varying vec2 vCoord2;const bool drawDebugStuff = false;void main() {vec2 sampleCoordinates =clamp(vCoord2, uUvSpaceClampingRect.xy, uUvSpaceClampingRect.zw);gl_FragColor = texture2D(texture0, sampleCoordinates) * uOpacity;if (drawDebugStuff) {vec2 tt = 2.0 * abs((vCoord2 - uUvSpaceSourceRect.xy) /(uUvSpaceSourceRect.zw - uUvSpaceSourceRect.xy) -0.5);float t = max(tt.x, tt.y);if (t > 0.99) {gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);}}}",this.SHADER_SOURCE_DRAW_TEXTURE_VERTEX="precision highp float;uniform vec4 uUvSpaceSourceRect;uniform mat3 uToClipSpaceTransform;uniform vec4 uDestinationRect;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uUvSpaceSourceRect.xy, uUvSpaceSourceRect.zw, aPosition2);gl_Position = vec4((uToClipSpaceTransform *vec3(mix(uDestinationRect.xy, uDestinationRect.zw, aPosition2), 1.0)).xy,0, 1);}",this.SHADER_SOURCE_GLASS_FRAGMENT="precision highp float;float sdBox(vec2 p, vec2 halfSize) {vec2 d = abs(p) - halfSize;return length(max(d, vec2(0.0))) + min(max(d.x, d.y), 0.0);}float sdRoundBox(vec2 p, vec2 halfSize, float cornerRadius) {float rn = min(cornerRadius, min(halfSize.x, halfSize.y));return sdBox(p, halfSize - rn) - rn;}mat2 rot(float t) {float cosT = cos(t);float sinT = sin(t);return mat2(cosT, -sinT, sinT, cosT);}const int NUM_NEWTON_ITERATIONS =2; const int NUM_NEWTON_START_POINTS =3; const float NEWTON_DAMPING_FACTOR = 1.0; int solveCubic(float a, float b, float c, out vec3 roots) {float p = b - a * a / 3.0;float q = a * (2.0 * a * a - 9.0 * b) / 27.0 + c;float p3 = p * p * p;float discriminant = q * q + 4.0 * p3 / 27.0;float offset = -a / 3.0; if (discriminant >= 0.0) {float z = sqrt(discriminant);float u = (-q + z) / 2.0;float v = (-q - z) / 2.0;u = sign(u) * pow(abs(u), 1.0 / 3.0);v = sign(v) * pow(abs(v), 1.0 / 3.0);roots[0] = offset + u + v;float f = ((roots[0] + a) * roots[0] + b) * roots[0] + c; float f1 = (3. * roots[0] + 2. * a) * roots[0] + b;       roots[0] -= f / f1; return 1; }float u = sqrt(-p / 3.0);float v = acos(-sqrt(-27.0 / p3) * q / 2.0) / 3.0;float m = cos(v), n = sin(v) * 1.732050808; roots[0] = offset + u * (m + m); roots[1] = offset - u * (n + m); roots[2] = offset + u * (n - m); vec3 f = ((roots + a) * roots + b) * roots + c; vec3 f1 = (3.0 * roots + 2.0 * a) * roots + b;  roots -= f / f1;                                return 3; }float cubicBezierSign(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {float cu = (-p0.y + 3.0 * p1.y - 3.0 * p2.y + p3.y); float qu = (3.0 * p0.y - 6.0 * p1.y + 3.0 * p2.y);   float li = (-3.0 * p0.y + 3.0 * p1.y);               float co = p0.y - uv.y; vec3 roots;int numRoots = solveCubic(qu / cu, li / cu, co / cu, roots);int numIntersections = 0;for (int i = 0; i < 3; i++) {if (i < numRoots) {if (roots[i] >= 0.0 && roots[i] <= 1.0) {float t = roots[i];float xPos = ((((-p0.x + 3. * p1.x - 3. * p2.x + p3.x) * t +(3. * p0.x - 6. * p1.x + 3. * p2.x)) *t) +(-3. * p0.x + 3. * p1.x)) *t +p0.x;if (xPos < uv.x) {numIntersections++;}}}}vec2 tangStart = p0.xy - p1.xy;vec2 tangEnd = p2.xy - p3.xy;vec2 normStart = vec2(tangStart.y, -tangStart.x);vec2 normEnd = vec2(tangEnd.y, -tangEnd.x);if (p0.y < p1.y) {if ((uv.y <= p0.y) && (dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}} else {if (!(uv.y <= p0.y) && !(dot(uv - p0.xy, normStart) < 0.0)) {numIntersections++;}}if (p2.y < p3.y) {if (!(uv.y <= p3.y) && dot(uv - p3.xy, normEnd) < 0.0) {numIntersections++;}} else {if ((uv.y <= p3.y) && !(dot(uv - p3.xy, normEnd) < 0.0)) {numIntersections++;}}if (numIntersections == 0 || numIntersections == 2 || numIntersections == 4) {return 1.0; } else {return -1.0; }}float cubicBezierNormalIteration(float t, vec2 a0, vec2 a1, vec2 a2, vec2 a3) {vec2 a_2 = a2 + t * a3;  vec2 a_1 = a1 + t * a_2; vec2 b_2 = a_2 + t * a3; vec2 uvToP =a0 + t * a_1; vec2 tang = a_1 + t * b_2; float tanLenSq =dot(tang, tang); float projection = dot(tang, uvToP); return t - NEWTON_DAMPING_FACTOR * projection / tanLenSq;}float cubicBezierDistApproxSq(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {vec2 a3 = (-p0 + 3.0 * p1 - 3.0 * p2 + p3); vec2 a2 = (3.0 * p0 - 6.0 * p1 + 3.0 * p2); vec2 a1 = (-3.0 * p0 + 3.0 * p1);           vec2 a0 = p0 - uv; float d0 = 1.0e38; float t0 = 0.;     float t;           for (int i = 0; i < NUM_NEWTON_START_POINTS; i++) {t = t0; for (int j = 0; j < NUM_NEWTON_ITERATIONS; j++) {t = cubicBezierNormalIteration(t, a0, a1, a2, a3);}t = clamp(t, 0.0, 1.0);vec2 uvToP = ((a3 * t + a2) * t + a1) * t + a0;d0 = min(d0, dot(uvToP, uvToP)); t0 += 1. / float(NUM_NEWTON_START_POINTS - 1);}return d0; }float cubicBezierDistApprox(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3) {return sqrt(cubicBezierDistApproxSq(uv, p0, p1, p2, p3));}float sdSmoothRoundCorner(vec2 uv, float radius, float smoothing) {float PI = 3.14159265359;float HALF_PI = PI * 0.5;float SQRT_2 = 1.41421356237;float bezAngle = 0.5 * HALF_PI * smoothing;float arcAngle = HALF_PI * (1.0 - smoothing);float requiredEdgeLength = (1.0 + smoothing) * radius;float dOverC = tan(bezAngle);float l = sin(arcAngle * 0.5) * radius * SQRT_2;float c = radius * tan(bezAngle * 0.5) * cos(bezAngle);float d = c * dOverC;float b = ((requiredEdgeLength - l) - (1.0 + dOverC) * c) / 3.0;float a = 2.0 * b;uv = rot(PI * -0.25) * uv;uv.x = -abs(uv.x);vec2 cp = uv + vec2(0.0, 1.414213) * radius;float angle = atan(cp.x, cp.y);uv = rot(PI * 0.25) * uv;vec2 p0 = vec2(-requiredEdgeLength, 0.0);vec2 p1 = p0 + vec2(a, 0.0);vec2 p2 = p1 + vec2(b, 0.0);vec2 p3 = p2 + vec2(c, -d);vec2 cornerCenter = uv + requiredEdgeLength;if (cornerCenter.x < 0.0) {return cornerCenter.y - requiredEdgeLength;} else if (abs(angle) < arcAngle * 0.5) {return length(cp) - radius;}float dis = cubicBezierDistApprox(uv, p0, p1, p2, p3);float sgn = -cubicBezierSign(uv, p0, p1, p2, p3);return dis * sgn;}float sdSmoothRoundBox(vec2 uv, vec2 halfSize, float radius, float smoothing) {vec2 p = abs(uv) - halfSize;float minHalfSize = min(halfSize.x, halfSize.y);float requiredLength = radius * (1.0 + smoothing);float overlap = max(0.0, requiredLength - minHalfSize) / radius;float finalSmoothing = max(0.0, smoothing - overlap);float finalRadius = min(minHalfSize, radius);return sdSmoothRoundCorner(p, finalRadius, finalSmoothing);}const float HALF_PI = 1.57079632679;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2;varying vec2 vCoord2;uniform float cornerRadiusInPixelSpace;uniform float cornerSmoothing;uniform float scale;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform float reflRadiusInPixelSpace;uniform float refractionIntensity;uniform float refractionDistance;uniform float lightIntensity;uniform float lightAngle;uniform float bevelSize;uniform float chromaticAberration;uniform vec4 tintColor;float linearstep(float a, float b, float t) {return clamp((t - a) / max(0.00001, b - a), 0.0, 1.0);}vec2 nodeSpaceToExpandedTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;vec2 expandedRegionSourceSamplingPoint =((((tileSpacePosition - 0.5) * 2.0) * scale) / 2.0) + 0.5;return expandedRegionSourceSamplingPoint;}vec2 nodeSpaceToStandardTileSpacePosition(vec2 nodeSpacePosition) {vec2 tileSpacePosition = (nodeToTileSpace * vec3(nodeSpacePosition, 1.0)).xy;return tileSpacePosition;}vec4 getRefractedTexture(vec2 p) {vec2 finalSamplingPositionInTileSpace =nodeSpaceToExpandedTileSpacePosition(p);return texture2D(texture0, finalSamplingPositionInTileSpace);}vec4 getRefractedTextureWithChromaticAberration(vec2 p, vec2 refrDir,float chromaAmt) {const int CHROMA_KERNEL_SIZE = 8;vec4 chromaBlurredColor = vec4(0.0, 0.0, 0.0, 0.0);float invKernelSize = 1.0 / float(CHROMA_KERNEL_SIZE - 1);float sum = 0.0;for (int i = 0; i < CHROMA_KERNEL_SIZE; i++) {float fi = float(i) * invKernelSize - 0.5; float window = 1.0 - abs(fi * 2.0);        vec4 red = getRefractedTexture(p + (fi + 0.5) * chromaAmt * refrDir);vec4 green = getRefractedTexture(p + fi * chromaAmt * refrDir);vec4 blue = getRefractedTexture(p + (fi - 0.5) * chromaAmt * refrDir);float alpha = max(max(red.a, green.a), blue.a);chromaBlurredColor += vec4(red.r, green.g, blue.b, alpha) * window;sum += window;}return chromaBlurredColor / sum;}vec2 getGlassRectNormal(vec2 p, vec2 halfSize, float cornerRad) {float r = min(min(halfSize.x, halfSize.y), cornerRad);vec2 d = abs(p) - (halfSize - r);return normalize(d + max(-min(d.x, d.y), 1.0e-5)) * sign(p);}vec2 getGlassRectRefractionDir(vec2 p, vec2 halfSize, float cornerRad,float refractionDistance) {return getGlassRectNormal(p, halfSize, max(cornerRad, refractionDistance));}void main() {vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;vec2 boundsSize = nodeSpaceCenterPoint * 2.0;vec2 halfBoundsSize = boundsSize * 0.5;float minHalfSize = min(halfBoundsSize.x, halfBoundsSize.y);vec2 boundsCenter = nodeSpaceCenterPoint;vec2 pBox = nodeSpacePixelPoint - nodeSpaceCenterPoint;float boxDist = sdSmoothRoundBox(pBox, halfBoundsSize,cornerRadiusInPixelSpace, cornerSmoothing);float BEVEL_SIZE = bevelSize;float BEVEL_REFRACTION_MULT = 0.2; float REFRACTION_STRENGTH = refractionIntensity;float refractionDistance = min(minHalfSize, refractionDistance);float refrArea =linearstep(-refractionDistance - BEVEL_SIZE, -BEVEL_SIZE, boxDist);float refrMult = pow(refrArea, 3.5) * refractionDistance;float maxRefrOffset = 0.999 * refractionDistance;float dishRefrOffset =clamp(refrMult * REFRACTION_STRENGTH, -maxRefrOffset, maxRefrOffset);float bevelRefrOffset =REFRACTION_STRENGTH * BEVEL_REFRACTION_MULT * maxRefrOffset;float isBevel = linearstep(-BEVEL_SIZE - 0.0001, -BEVEL_SIZE * 0.3, boxDist);vec2 glassNormal =getGlassRectRefractionDir(pBox, halfBoundsSize, cornerRadiusInPixelSpace,max(BEVEL_SIZE, refractionDistance));vec2 refrDir = -glassNormal * mix(dishRefrOffset, bevelRefrOffset, isBevel);vec2 p = nodeSpacePixelPoint;vec4 nonGlassBg = texture2D(texture2, nodeSpaceToStandardTileSpacePosition(p));vec4 col = vec4(0.0);p += refrDir;if (chromaticAberration < 0.001) {col = getRefractedTexture(p);} else {col = getRefractedTextureWithChromaticAberration(p, refrDir,chromaticAberration);}col = col * (1.0 - tintColor.a) + tintColor;float LIGHT_INTENSITY = lightIntensity;float SPECULAR_HARDNESS = 0.2;float halfSpecThk = BEVEL_SIZE * 0.5;float rim =smoothstep(-BEVEL_SIZE - 0.001, -BEVEL_SIZE * SPECULAR_HARDNESS, boxDist);float frameRot =atan(nodeToTileSpace[1][0],nodeToTileSpace[0][0]); float SPECULAR_FALLOFF = 0.35;   float BOTTOM_LIGHT_MULT = 0.6;float specularAngle = lightAngle + frameRot + HALF_PI;vec2 specularNormal =getGlassRectNormal(pBox, halfBoundsSize, cornerRadiusInPixelSpace);vec2 lightDir = vec2(cos(specularAngle), sin(specularAngle));col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, -lightDir)) *rim * LIGHT_INTENSITY;col.xyz += smoothstep(SPECULAR_FALLOFF, 1.0, dot(specularNormal, lightDir)) *rim * LIGHT_INTENSITY * BOTTOM_LIGHT_MULT;float DISH_SHADE_STRENGTH = 0.05;float shadeSize = refractionDistance;float shadeMult =pow(linearstep(-shadeSize, -BEVEL_SIZE + 0.0001, boxDist), 2.0);float shadeAmt = dot(glassNormal, lightDir);col.xyz += shadeAmt * shadeMult * DISH_SHADE_STRENGTH * LIGHT_INTENSITY;col = mix(col, nonGlassBg, step(0.0, boxDist));gl_FragColor = col;}",this.SHADER_SOURCE_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);gl_FragColor = ditherColor(texture2D(texture0, coord) * uOpacity);}",this.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX="precision highp float;uniform vec4 quad;uniform vec4 source;uniform vec4 blurRangeSource;attribute vec2 position2;varying vec2 _coord2;varying vec2 _coord2Source;void main() {_coord2Source = mix(blurRangeSource.xy, blurRangeSource.zw, position2);_coord2 = mix(source.xy, source.zw, position2);gl_Position = vec4(mix(quad.xy, quad.zw, position2) * 2.0 - 1.0, 0, 1);}",this.SHADER_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = float(texture2D(texture0, vCoord2).a > 0.0) * uColor;}",this.SHADER_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform vec4 uColor;uniform float uTextureSize;uniform float uTexturePx;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec2 coordInSSAA = vCoord2 * vec2(uTextureSize);vec2 lowerLeftInSSAA = floor(coordInSSAA - vec2(0.5)) + 0.5;vec2 lowerLeftTexelCoord = lowerLeftInSSAA * uTexturePx;vec2 lowerRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, 0.0);vec2 upperLeftTexelCoord = lowerLeftTexelCoord + vec2(0.0, uTexturePx);vec2 upperRightTexelCoord =lowerLeftTexelCoord + vec2(uTexturePx, uTexturePx);float lowerLeftAlpha = texture2D(texture0, lowerLeftTexelCoord).a;float lowerRightAlpha = texture2D(texture0, lowerRightTexelCoord).a;float upperLeftAlpha = texture2D(texture0, upperLeftTexelCoord).a;float upperRightAlpha = texture2D(texture0, upperRightTexelCoord).a;float hardMaskedLowerLeftAlpha = float(lowerLeftAlpha > 0.0);float hardMaskedLowerRightAlpha = float(lowerRightAlpha > 0.0);float hardMaskedUpperLeftAlpha = float(upperLeftAlpha > 0.0);float hardMaskedUpperRightAlpha = float(upperRightAlpha > 0.0);float rightWeight = coordInSSAA.x - lowerLeftInSSAA.x;float leftWeight = 1.0 - rightWeight;float topWeight = coordInSSAA.y - lowerLeftInSSAA.y;float bottomWeight = 1.0 - topWeight;float downsampledHardMaskedAlpha = (hardMaskedLowerLeftAlpha * leftWeight +hardMaskedLowerRightAlpha * rightWeight) *bottomWeight +(hardMaskedUpperLeftAlpha * leftWeight +hardMaskedUpperRightAlpha * rightWeight) *topWeight;gl_FragColor = downsampledHardMaskedAlpha * uColor;}",this.SHADER_SOURCE_IMAGE_FRAGMENT="precision highp float;uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb *= color.a;gl_FragColor = color * uOpacity;}",this.SHADER_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D texture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(texture0, vCoord2);color.rgb = pipeline(color.rgb) * color.a;gl_FragColor = color * uOpacity;}",this.SHADER_SOURCE_IMAGE_PATTERN_FRAGMENT="precision highp float;uniform vec2 patternTexSizePixels;uniform vec2 patternBoundsOffsetPixels;uniform float tileSizePixels;uniform vec2 fillSizePixels;uniform vec2 offsetPixels;uniform int patternTileType;uniform sampler2D texture0;varying vec2 vCoord2;void main() {const int RECTANGULAR = 0;const int HORIZONTAL_HEXAGONAL = 1;const int VERTICAL_HEXAGONAL = 2;float xRepeats = fillSizePixels.x / patternTexSizePixels.x;float yRepeats = fillSizePixels.y / patternTexSizePixels.y;vec2 offsetMultiplier = vec2(offsetPixels.x / patternTexSizePixels.x,offsetPixels.y / patternTexSizePixels.y);vec2 coord2 = vec2(vCoord2.x * xRepeats, vCoord2.y * yRepeats);vec2 patternBoundsOffsetUV =vec2(patternBoundsOffsetPixels.x / patternTexSizePixels.x,patternBoundsOffsetPixels.y / patternTexSizePixels.y);coord2 -= offsetMultiplier;coord2 += patternBoundsOffsetUV;if (patternTileType == HORIZONTAL_HEXAGONAL) {coord2.x += (1.0 + step(1., mod(coord2.y, 2.0))) * 0.5;} else if (patternTileType == VERTICAL_HEXAGONAL) {coord2.y += (1.0 + step(1., mod(coord2.x, 2.0))) * 0.5;}coord2 = fract(coord2);vec2 percentage = patternTexSizePixels / tileSizePixels;vec2 clampPercentage = (patternTexSizePixels - 0.5) / tileSizePixels;gl_FragColor = texture2D(texture0, min(coord2 * percentage, clampPercentage));}",this.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_FRAGMENT="precision highp float;uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = texture2D(texture0, vCoord2); }",this.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_VERTEX="precision highp float;uniform mat3 paintTransform;uniform mat3 vertexTransform;attribute vec2 position2;attribute vec3 coord3;varying vec2 vCoord2;void main() {vCoord2 = (paintTransform * coord3).xy;gl_Position = vec4(vertexTransform * vec3(position2, 1), 0).xywz;}",this.SHADER_SOURCE_LERP_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t = uType == LINEAR    ? uv.x + 0.5: uType == RADIAL  ? 2.0 * length(uv): uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)): uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)): 0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);vec4 lerped =mix(texture2D(texture0, coord), texture2D(texture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity);}",this.SHADER_SOURCE_LERP_IMAGE_FRAGMENT="precision highp float;uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb *= lerped.a;gl_FragColor = lerped * uOpacity;}",this.SHADER_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold =dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) *(lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) /(0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos =(1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor =min(lFactor,2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint,float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339, 0.3575761, 0.7151522,0.1191920, 0.1804375, 0.0721750, 0.9503041) *color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0, 500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve =contrast < 0.0 ? (lLAB.x - scaledThreshold) * 0.2 + 50.0 : lLAB.x;float contrastRightCurve =contrast < 0.0 ? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) *100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434, -1.5371385, 1.8760108,-0.2040259, -0.4985314, 0.0415560, 1.0572252) *lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor =rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint,uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform int uEmulateWrapAddress;uniform int uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (bool(uEmulateWrapAddress)) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (bool(uEmulateBorderAddress) && coord != clamp(coord, 0.0, 1.0))color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(texture0, vCoord2),sampleImage(texture1, vCoord2b), uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;gl_FragColor = lerped * uOpacity;}",this.SHADER_SOURCE_LERP_TILE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 texture0UvSpaceScissor;uniform vec4 texture1UvSpaceScissor;varying vec2 vCoord2;void main() {vec4 texture0Color = all(greaterThan(vCoord2, texture0UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture0UvSpaceScissor.zw))? texture2D(texture0, vCoord2): vec4(0.0);vec4 texture1Color = all(greaterThan(vCoord2, texture1UvSpaceScissor.xy)) &&all(lessThan(vCoord2, texture1UvSpaceScissor.zw))? texture2D(texture1, vCoord2): vec4(0.0);gl_FragColor = mix(texture0Color, texture1Color, uOpacity);}",this.SHADER_SOURCE_LOOP_BLINN_FRAGMENT="precision highp float;varying vec3 vCoord3;void main() {if (vCoord3.x * vCoord3.x * vCoord3.x > vCoord3.y * vCoord3.z) {discard;}}",this.SHADER_SOURCE_LOOP_BLINN_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;attribute vec3 aCoord3;varying vec3 vCoord3;void main() {vCoord3 = aCoord3;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.SHADER_SOURCE_LOOP_BLINN_INSTANCED_VERTEX="mat3 constructInstanceTransform(vec3 instTransform0, vec3 instTransform1) {return mat3(vec3(instTransform0.x, instTransform1.x, 0.0),vec3(instTransform0.y, instTransform1.y, 0.0),vec3(instTransform0.z, instTransform1.z, 1.0));}precision highp float;uniform mat3 canvasSpaceToClipSpaceTransform;attribute vec2 aPosition2;attribute vec3 aCoord3;attribute vec3 instanceTransform0;attribute vec3 instanceTransform1;varying vec3 vCoord3;void main() {vCoord3 = aCoord3;mat3 instanceTransform =constructInstanceTransform(instanceTransform0, instanceTransform1);mat3 vertexTransform = canvasSpaceToClipSpaceTransform * instanceTransform;gl_Position = vec4(vertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {if (texture2D(texture1, vCoord2).a == 0.0) {discard;}gl_FragColor = texture2D(texture0, vCoord2);}",this.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = (1.0 - texture2D(texture0, vCoord2).a) *texture2D(texture1, vCoord2).a * uColor;}",this.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {float texture1HardMasked = float(texture2D(texture1, vCoord2).a > 0.0);gl_FragColor =(1.0 - texture2D(texture0, vCoord2).a) * texture1HardMasked * uColor;}",this.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {gl_FragColor =texture2D(texture0, vCoord2) * float(texture2D(texture1, vCoord2).a == 0.);}",this.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; varying vec2 vCoord2;void main() {float geometryAlpha = texture2D(texture2, vCoord2).a;gl_FragColor = mix(texture2D(texture1, vCoord2),texture2D(texture0, vCoord2) * float(geometryAlpha == 0.),1.0 - geometryAlpha);}",this.SHADER_SOURCE_MASK_TILE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(texture0, vCoord2) * texture2D(texture1, vCoord2).a;}",this.SHADER_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;varying vec2 vCoord2;void main() {vec3 rgb = texture2D(texture1, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor =texture2D(texture0, vCoord2) * luminance * texture2D(texture1, vCoord2).a;}",this.SHADER_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; varying vec2 vCoord2;void main() {vec3 rgb = texture2D(texture2, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor = mix(texture2D(texture1, vCoord2),texture2D(texture0, vCoord2),texture2D(texture2, vCoord2).a * luminance);}",this.SHADER_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D texture0;uniform sampler2D texture1;uniform sampler2D texture2; varying vec2 vCoord2;void main() {gl_FragColor = mix(texture2D(texture1, vCoord2), texture2D(texture0, vCoord2),texture2D(texture2, vCoord2).a);}",this.SHADER_SOURCE_NOISE_EFFECT_FRAGMENT="precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;varying vec2 vCoord2;uniform int uNoiseType;uniform float uNoiseSize;uniform mat3 uTileToNodeSpace;uniform float uDensity; uniform vec4 uColor;uniform vec4 uSecondaryColor;uniform vec2 uNodeSpaceCenterPoint;uniform int uSeed;void main() {vec2 nodeSpacePixelPoint = (uTileToNodeSpace * vec3(vCoord2, 1.0)).xy;float r = roundHelper((turbulence(0 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float g = roundHelper((turbulence(1 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float b = roundHelper((turbulence(2 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);float a = roundHelper((turbulence(3 + uSeed, nodeSpacePixelPoint - uNodeSpaceCenterPoint,uNoiseSize, uNoiseSize, 3, true) +1.0) /2.0);vec4 sourceValue = texture2D(texture0, vCoord2);if (uNoiseType == 0) {r = 2.0 * r - 0.5;g = 2.0 * g - 0.5;b = 2.0 * b - 0.5;a = filter_val(a, uDensity, false);a *= uColor.a;a *= sourceValue.a;gl_FragColor = vec4(r * a, g * a, b * a, a);} else if (uNoiseType == 1) {a = roundHelper(0.213 * r + 0.715 * g + 0.072 * b);a = filter_val(a, uDensity, false);a *= uColor.a;a *= sourceValue.a;gl_FragColor = vec4(uColor.rgb * a, a);} else {a = roundHelper(0.213 * r + 0.715 * g + 0.072 * b);float a1 = filter_val(a, uDensity, false);float a2 = filter_val(a, uDensity, true);if (a1 == 1.0) {a1 *= uSecondaryColor.a;a1 *= sourceValue.a;gl_FragColor = vec4(uSecondaryColor.rgb * a1, a1);} else {a2 *= uColor.a;a2 *= sourceValue.a;gl_FragColor = vec4(uColor.rgb * a2, a2);}}}",this.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}uniform vec4 uColor;varying vec4 vCoord4;void main() {float alpha = (integrateTriangle(vCoord4.x) - integrateTriangle(vCoord4.z)) *(integrateTriangle(vCoord4.y) - integrateTriangle(vCoord4.w));gl_FragColor = ditherColor(uColor * alpha);}",this.SHADER_SOURCE_RECTANGLE_BLUR_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform vec4 uQuad;uniform float uBlurRadius;attribute vec2 aPosition2;varying vec4 vCoord4;void main() {vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord4 = (vec4(vertex, vertex) - uQuad) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.SHADER_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT="precision highp float;uniform sampler2D texture0;varying vec4 vPosition4;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;uv.y = 1.0 - uv.y;gl_FragColor = texture2D(texture0, uv);}",this.SHADER_SOURCE_RENDER_DEVICE_FRAME_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.SHADER_SOURCE_RENDER_HOTSPOT_FRAGMENT="precision highp float;uniform mat3 uVertexTransform;uniform float uHotspotOpacity;uniform vec2 uStrokeProportion;uniform vec4 uUvHotspotClippingRect;varying vec4 vPosition4;const vec3 HOTSPOT_COLOR = vec3(48.0 / 255.0, 194.0 / 255.0, 255.0 / 255.0);bool contains(vec4 rect, vec2 point) {return (rect.z >= 0.0 && rect.w >= 0.0 &&clamp(point.x, rect.x, rect.x + rect.z) == point.x &&clamp(point.y, rect.y, rect.y + rect.w) == point.y);}void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;if (contains(uUvHotspotClippingRect, position)) {if (uv.x < uStrokeProportion.x || uv.x > 1.0 - uStrokeProportion.x ||uv.y < uStrokeProportion.y || uv.y > 1.0 - uStrokeProportion.y) {gl_FragColor = vec4(HOTSPOT_COLOR, 1.0 * uHotspotOpacity);} else {gl_FragColor = vec4(HOTSPOT_COLOR, 0.5 * uHotspotOpacity);}} else {gl_FragColor = vec4(0.0);}}",this.SHADER_SOURCE_RENDER_HOTSPOT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) {return 0.0;} else if (x < 0.0) {return 0.5 * (x + 1.0) * (x + 1.0);} else if (x < 1.0) {return 0.5 - 0.5 * x * (x - 2.0);} else {return 1.0;}}uniform vec4 uColor;uniform vec2 uHalfSizeOverBlurRadius;uniform float uCornerRadiusOverBlurRadius;varying vec2 vCoord2;float triangle(float x) { return max(0.0, (1.0 - abs(x))); }float roundedRectangleBlurHorizontal(float x, float y, float cornerRadius,vec2 halfSize) {float deltaY = min(halfSize.y - cornerRadius - abs(y), 0.0);float roundedRectX =halfSize.x - cornerRadius +sqrt(max(0.0, cornerRadius * cornerRadius - deltaY * deltaY));vec2 xRelativeToLowerAndUpper = vec2(x + roundedRectX, x - roundedRectX);return integrateTriangle(xRelativeToLowerAndUpper.x) -integrateTriangle(xRelativeToLowerAndUpper.y);}void main() {float alpha;if (all(lessThan(abs(vCoord2),uHalfSizeOverBlurRadius - vec2(uCornerRadiusOverBlurRadius +1.0 )))) {alpha = 1.0;} else {float low = vCoord2.y - uHalfSizeOverBlurRadius.y;float high = vCoord2.y + uHalfSizeOverBlurRadius.y;float start = clamp(-1.0 , low, high);float end = clamp(1.0 , low, high);if (start == end) {alpha = 0.0;} else {const int numSamples = 4;float step = (end - start) / float(numSamples);float y = start + step * 0.5;float weightSum = 0.0;float result = 0.0;for (int i = 0; i < numSamples; i++) {float currentWeight = triangle(y);result += roundedRectangleBlurHorizontal(vCoord2.x, vCoord2.y - y,uCornerRadiusOverBlurRadius,uHalfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor =(integrateTriangle(end) - integrateTriangle(start)) / weightSum;alpha = result * weightNormalizationFactor;}}gl_FragColor = ditherColor(uColor * alpha);}",this.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX="precision highp float;uniform vec4 uQuad;uniform float uBlurRadius;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vec2 center = (uQuad.xy + uQuad.zw) * 0.5;vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord2 = (vertex - center) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.SHADER_SOURCE_SMOOTH_PATH_FRAGMENT="precision highp float;varying vec2 vCoord2;varying vec4 vCoord4;void main() { gl_FragColor = vCoord4 * min(1.0, min(vCoord2.x, vCoord2.y)); }",this.SHADER_SOURCE_SMOOTH_PATH_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aCoord4;attribute vec4 aPosition4;varying vec2 vCoord2;varying vec4 vCoord4;void main() {vCoord2 = aPosition4.zw;vCoord4 = aCoord4;gl_Position = vec4(uVertexTransform * vec3(aPosition4.xy, 1.0), 0.0).xywz;}",this.SHADER_SOURCE_SOLID_COLOR_PAINT_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uColor;void main() { gl_FragColor = uColor * uOpacity; }",this.SHADER_SOURCE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.SHADER_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D texture0;uniform int tileAtlasTileSize;varying vec2 vCoord2;void main() {int SSAA_4X4_DIMENSION = tileAtlasTileSize * 4;float SSAA_4X4_PX = 1.0 / float(SSAA_4X4_DIMENSION);vec4 downsampledColor =0.25 * (texture2D(texture0, vCoord2 + vec2(-SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(texture0, vCoord2 + vec2(SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(texture0, vCoord2 + vec2(SSAA_4X4_PX, SSAA_4X4_PX)) +texture2D(texture0, vCoord2 + vec2(-SSAA_4X4_PX, SSAA_4X4_PX)));gl_FragColor = downsampledColor * uOpacity;}",this.SHADER_SOURCE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uQuad.xy, uQuad.zw, aPosition2);gl_Position = vec4(vCoord2 * 2.0 - 1.0, 0, 1);}",this.SHADER_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;vCoord2b = (uPaintTransform1 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.SHADER_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform int increaseMaxRadiusForBlurs;uniform sampler2D texture0;varying vec2 vCoord2;void main() {float weight = uCount;vec4 result = texture2D(texture0, vCoord2) * weight;float total = weight;for (int i = 1; i < 64; i += 2) {if (!bool(increaseMaxRadiusForBlurs)) {if (i >= 32) {break;}}if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = vCoord2 - uBlurDelta * t0;vec2 coord0_pos = vCoord2 + uBlurDelta * t0;vec2 coord1_neg = vCoord2 - uBlurDelta * t1;vec2 coord1_pos = vCoord2 + uBlurDelta * t1;float weight0 = uCount - t0;float weight1 = uCount - t1;float weightSum = weight0 + weight1;vec2 coord_neg = (coord0_neg * weight0 + coord1_neg * weight1) / weightSum;vec2 coord_pos = (coord0_pos * weight0 + coord1_pos * weight1) / weightSum;result += weightSum *(texture2D(texture0, coord_neg) + texture2D(texture0, coord_pos));total += 2.0 * weightSum;}gl_FragColor = result / total;}",this.SHADER_SOURCE_UNCLAMPED_GRADIENT_BLUR_TILE_FRAGMENT="precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}const int LARGE_TILE_MULTIPLIER = 1;const int maxRadiusInTexelsForBlurs = 64;uniform float startCount;uniform float endCount;uniform vec2 blurDelta;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform sampler2D texture0;varying vec2 _coord2;varying vec2 _coord2Source;void main() {vec2 coord2 = _coord2;vec2 coord2Source = _coord2Source;float weight = 0.0;float total = 0.0;vec4 result = vec4(0.0, 0.0, 0.0, 0.0);float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;if (radius < 0.001) {radius = 0.001;}const int maxRadiuxInTexelsAccountingForMultiplier =maxRadiusInTexelsForBlurs * LARGE_TILE_MULTIPLIER;for (int i = 0; i < maxRadiuxInTexelsAccountingForMultiplier; i += 2) {if (float(i) > radius) {break;}float t0 = min(float(i), radius);float t1 = min(float(i) + 1.0, radius);vec2 coord0_neg = coord2 - blurDelta * t0;vec2 coord0_pos = coord2 + blurDelta * t0;vec2 coord1_neg = coord2 - blurDelta * t1;vec2 coord1_pos = coord2 + blurDelta * t1;float weight0_neg = (radius - t0);float weight0_pos = (radius - t0);float weight1_neg = (radius - t1);float weight1_pos = (radius - t1);if (i == 0) {weight0_neg = weight0_neg / 2.0;weight0_pos = weight0_pos / 2.0;}const float minimumContribution = 1.0 / 256.0;if (abs(blurDelta.x * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution ||abs(blurDelta.y * float(maxRadiuxInTexelsAccountingForMultiplier)) <minimumContribution) {if (weight0_neg > 0.0 || weight1_neg > 0.0) {float weightCoordNegSum = weight0_neg + weight1_neg;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) /weightCoordNegSum;result += texture2D(texture0, coord_neg) * weightCoordNegSum;total += weightCoordNegSum;}if (weight0_pos > 0.0 || weight1_pos > 0.0) {float weightCoordPosSum = weight0_pos + weight1_pos;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) /weightCoordPosSum;result += texture2D(texture0, coord_pos) * weightCoordPosSum;total += weightCoordPosSum;}} else {if (weight0_neg > 0.0) {result += texture2D(texture0, coord0_neg) * weight0_neg;total += weight0_neg;}if (weight0_pos > 0.0) {result += texture2D(texture0, coord0_pos) * weight0_pos;total += weight0_pos;}if (weight1_neg > 0.0) {result += texture2D(texture0, coord1_neg) * weight1_neg;total += weight1_neg;}if (weight1_pos > 0.0) {result += texture2D(texture0, coord1_pos) * weight1_pos;total += weight1_pos;}}}gl_FragColor = result / total;}",this.SHADER_SOURCE_UNCLAMPED_GRAIN_FRAGMENT="precision highp float;precision highp float;float roundHelper(float value) {lowp float val = value;return val;}float filter_val(float value, float density, bool reverse) {float low, high;if (reverse) {low = 10.0 * (0.75 - density / 4.0);} else {low = 10.0 * (0.25 - density / 4.0);}high = low + 10.0 * (density / 2.0);value = value * 10.0;return step(low, value) * (1.0 - step(high, value));}highp float rand_from_vec2(vec2 co) {float a = 12.9898;float b = 78.233;float c = 438.5453;float dt = roundHelper(dot(co.xy, vec2(a, b)));float md = roundHelper(mod(dt, 3.14159));return roundHelper(fract(sin(md * 2.71828) * c + 1.73205));}float randHelper(vec2 coord, vec2 r_vec, float seed) {float r = dot(r_vec, coord);r = roundHelper(r) * .25;r = roundHelper(sin(roundHelper(r) * .25)) * (seed + 312.0);float result = 2.0 * (fract(r) - 0.5);return roundHelper(result);}float randomizeFloat(float x) {return fract(sin(x * 91.3458 + 12.345) * 43758.5453);}vec2 rand_unit_vec(vec2 input_coord, float nColorChannelRandomized) {float r = rand_from_vec2(input_coord);float seed1 = roundHelper(nColorChannelRandomized * r * 1.61803 + 18.345);float seed2 = roundHelper(nColorChannelRandomized * r * 0.61803 + 21.543);vec2 coordCopy = input_coord.xy;float r1 = randHelper(coordCopy,vec2(12.42, 78.23) *randomizeFloat(nColorChannelRandomized + 2.6457),seed1);float r2 = randHelper(coordCopy,vec2(-19.98, 31.21) *randomizeFloat(nColorChannelRandomized + 3.6055),seed2);float s = length(vec2(r1, r2));r1 = roundHelper(r1 / s);r2 = roundHelper(r2 / s);return vec2(r1, r2);}float s_curve(float t) { return t * t * (3.0 - 2.0 * t); }float lerp(float t, float a, float b) { return a + t * (b - a); }float perlin_noise(float nColorChannelRandomized, vec2 vec) {float bx0, bx1, by0, by1;float rx0, rx1, ry0, ry1, sx, sy, a, b, u, v;bx0 = floor(vec.x);bx1 = bx0 + 1.0;rx0 = fract(vec.x);rx1 = rx0 - 1.0;by0 = floor(vec.y);by1 = by0 + 1.0;ry0 = fract(vec.y);ry1 = ry0 - 1.0;sx = s_curve(rx0);sy = s_curve(ry0);vec2 q = rand_unit_vec(vec2(bx0, by0), nColorChannelRandomized);u = dot(vec2(rx0, ry0), q);q = rand_unit_vec(vec2(bx1, by0), nColorChannelRandomized);v = dot(vec2(rx1, ry0), q);a = lerp(sx, u, v);q = rand_unit_vec(vec2(bx0, by1), nColorChannelRandomized);u = dot(vec2(rx0, ry1), q);q = rand_unit_vec(vec2(bx1, by1), nColorChannelRandomized);v = dot(vec2(rx1, ry1), q);b = lerp(sx, u, v);return roundHelper(lerp(sy, a, b));}float randomizeColorChannelOctave(int channel, int octave) {float f = float(channel);float o = float(octave);return fract(sin(f * 91.3458 + o * 57.123 + 12.345) * 43758.5453);}float turbulence(int nColorChannel, vec2 point, float fBaseFreqX,float fBaseFreqY, int nNumOctaves, bool isFractalNoise) {float fSum = 0.0;vec2 vec = point * vec2(fBaseFreqX, fBaseFreqY);float v_x = roundHelper(vec.x);float v_y = roundHelper(vec.y);vec = vec2(v_x, v_y);float ratio = 1.0;const int MAX_OCTAVES = 10;for (int nOctave = 0; nOctave < MAX_OCTAVES; ++nOctave) {if (nOctave >= nNumOctaves) {break;}float nColorChannelRandomized =randomizeColorChannelOctave(nColorChannel, nOctave);float n = perlin_noise(nColorChannelRandomized, vec);if (!isFractalNoise) {n = abs(n);}n = roundHelper(n / ratio);fSum += n;vec *= 2.0;ratio *= 2.0;}return roundHelper(fSum);}uniform sampler2D texture0;varying vec2 vCoord2;uniform float radiusInPixelSpace;uniform float scale;uniform float noiseSize;uniform mat3 nodeToTileSpace;uniform mat3 tileToNodeSpace;uniform vec2 nodeSpaceCenterPoint;uniform int uSeed;void main() {gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);vec2 nodeSpacePixelPoint = (tileToNodeSpace * vec3(vCoord2, 1.0)).xy;float a = turbulence(0 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);float b = turbulence(1 + uSeed, nodeSpacePixelPoint - nodeSpaceCenterPoint,noiseSize, noiseSize, 3, true);vec2 amt = vec2(a, b);vec2 samplingPoint = nodeSpacePixelPoint + amt * radiusInPixelSpace;vec2 finalSamplingPoint = (nodeToTileSpace * vec3(samplingPoint, 1.0)).xy;vec2 expandedRegionSamplingPoint =((((finalSamplingPoint - 0.5) * 2.0) * scale) / 2.0) + 0.5;vec4 destTexel = texture2D(texture0, expandedRegionSamplingPoint);gl_FragColor = destTexel;}",this.SHADER_SOURCE_UPSAMPLE_AND_BLEND_GRADIENT_BLUR_TILE_FRAGMENT="precision highp float;float percentageAlongVector(vec2 sourcePoint, vec2 startPoint, vec2 endPoint) {vec2 gradientVector = endPoint - startPoint;vec2 sourceVector = sourcePoint - startPoint;float projectionLength =dot(sourceVector, gradientVector) / dot(gradientVector, gradientVector);return clamp(projectionLength, 0.0, 1.0);}uniform sampler2D texture0;uniform sampler2D texture1;uniform float startCount;uniform float endCount;uniform vec2 blurGradientStart;uniform vec2 blurGradientEnd;uniform float scaleToUnadjust;varying vec2 _coord2;varying vec2 _coord2Source;void main() {float distanceRatio =percentageAlongVector(_coord2Source, blurGradientStart, blurGradientEnd);float radius = (endCount - startCount) * distanceRatio + startCount;vec2 centerUnadjustedSamplePoint =((((_coord2Source.xy - 0.5) * 2.0) / scaleToUnadjust) + 1.0) / 2.0;if (radius < 1.0) {gl_FragColor = texture2D(texture1, centerUnadjustedSamplePoint);} else {float weightCenter = radius * radius;float weightBlur =(((radius - 1.0) * (radius - 1.0)) + (2.0 * (radius - 1.0)));weightBlur = weightBlur * 2.0; weightBlur = weightBlur * weightBlur;gl_FragColor =(weightBlur * texture2D(texture0, _coord2) +weightCenter * texture2D(texture1, centerUnadjustedSamplePoint)) /(weightBlur + weightCenter);}}",this.SHADER_SOURCE_UPSAMPLE_TILE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform sampler2D texture0;varying vec2 vCoord2;void main() { gl_FragColor = ditherColor(texture2D(texture0, vCoord2)); }",this.SHADER_SOURCE_UPSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}")}static instance(){return t._instance||(t._instance=new t),t._instance}};function Kd(t,e={},r=null){r||(r=document.createElement("canvas"));let n=null;try{n=t?r.getContext("webgl2",e):r.getContext("webgl",e)}catch{}return n}var f_=class{constructor(e){this._context=null,this._ext=null,this._activeQuery=null,this._isRunning=!1,this._eventsPendingTimestamps=[],this._resolvedEvents=[],this._context=e,this._ext=e.getExtension("EXT_disjoint_timer_query")}start(){if(this._ext==null)throw new Error("EXT_disjoint_timer_query WebGL extension is not available. Cannot start profiler.");if(this._isRunning)throw new Error("Profiler is already running");let e=this._context.getExtension("WEBGL_debug_renderer_info");if(e!==null){let r=this._context.getParameter(e.UNMASKED_RENDERER_WEBGL);if(r.indexOf("NVIDIA GeForce GT 750M")!=-1)throw new Error(`${r} cards seem to have a buggy implementation of EXT_disjoint_timer_query. Refusing to profile to avoid confusing results.`)}this._isRunning=!0,this._eventsPendingTimestamps.length=0,this._resolvedEvents.length=0,this._activeQuery=this._ext.createQueryEXT(),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery)}stop(){if(this._ext!=null){if(!this._isRunning)throw new Error("Profiler is already stopped");this._isRunning=!1,this._activeQuery=null,this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT)}}isRunning(){return this._isRunning}_markAction(e){if(this._ext==null)return;if(this._activeQuery==null)throw new Error("Cannot mark actions while no profile is active");let r=this._activeQuery;this._activeQuery=this._ext.createQueryEXT(),this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery),this._eventsPendingTimestamps.push(new vg(e,r))}pushFrame(e){this._markAction(new g_(0,e))}popFrame(e){this._markAction(new g_(1,e))}resolveEventsIfPossible(){if(this._ext==null)return;let e=0;for(;e<this._eventsPendingTimestamps.length;){let r=this._eventsPendingTimestamps[e],n=r.query;if(!this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_AVAILABLE_EXT))break;if(this._context.getParameter(this._ext.GPU_DISJOINT_EXT))throw new Error("GPU_DISJOINT_EXT");let o=this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_EXT);this._ext.deleteQueryEXT(n);let a=(this._resolvedEvents.length==0?0:ie.List_last(this._resolvedEvents).timestamp)+o;this._resolvedEvents.push(new Cg(r.action,a)),e=e+1}e>0&&(this._eventsPendingTimestamps=this._eventsPendingTimestamps.slice(e))}hasPendingResults(){return this._eventsPendingTimestamps.length!=0}resolvedEvents(){return this._resolvedEvents}exportSpeedscopeProfile(){let e=[],r=[];if(this._resolvedEvents.length==0)throw new Error("Profile is empty");let n={type:"evented",name:"GPU Profile",unit:"nanoseconds",startValue:0,endValue:ie.List_last(this._resolvedEvents).timestamp,events:r},o={$schema:"https://www.speedscope.app/file-format-schema.json",shared:{frames:e},profiles:[n]},i=new Map,a=c=>(i.has(c)||(i.set(c,e.length),e.push({name:c})),i.get(c)),s="O",l="C";for(let c of this._resolvedEvents)r.push({type:c.action.type==0?s:l,frame:a(c.action.name),at:c.timestamp});return JSON.stringify(o)}};var g_=class{constructor(e,r){this.type=e,this.name=r}},vg=class{constructor(e,r){this.action=e,this.query=r}},Cg=class{constructor(e,r){this.action=e,this.timestamp=r}},Ac;(o=>{function t(i,a,s){Yd?i.annotateBlock(a,s):s()}o.WebGLRenderingContext_annotateBlock=t;function e(i,a,s){return Yd?i.annotateBlock(a,s):s()}o.WebGLRenderingContext_annotateBlockAndReturn=e;function r(i,a,s){Yd?i.annotateProfile(a,s):s()}o.WebGLRenderingContext_annotateProfile=r;function n(i,a){return i.TEXTURE0+a}o.WebGLRenderingContext_TEXTURE_N=n})(Ac||(Ac={}));var Yd=!1;function RC(t,e){console.log("WebGL intercepts are enabled. This records all calls.");let r=window.requestAnimationFrame,n=0,o=new f_(e);window.requestAnimationFrame=()=>(n=n+1,o.hasPendingResults()&&o.resolveEventsIfPossible(),r.apply(window,arguments));let i=e,a=t.width,s=t.height,l=n,c=[],d={},u="  ",p=f=>{c.push(u+f)},_=()=>{n!=l&&(l=n,p("yield;"))},h=(f,y)=>{_(),p(`{ // ${f}`);let v=u;u+="  ",o.isRunning()&&o.pushFrame(f);let w=y();return o.isRunning()&&o.popFrame(f),u=v,p("}"),w},A=(f,y)=>{o.isRunning()&&o.pushFrame(f),y(),o.isRunning()&&o.popFrame(f)},m=()=>{let f=`function* render(gl) {

`;f+=`  // Recorded using https://github.com/evanw/webgl-recorder
`;for(let y in d)f+="  var "+y+`s = [];
`;for(let y of c)f+=y+`
`;return f+=`}
`,f},g=(f,y)=>{let v=document.createElement("a");v.href=URL.createObjectURL(new Blob([f],{type:"application/javascript"})),v.download=y??"trace.js",document.body.appendChild(v),v.click(),document.body.removeChild(v)},S=f=>{g(m(),f??"trace.js")},R=()=>{o.start()},E=f=>{o.stop();let y=()=>{o.hasPendingResults()?r(y):g(o.exportSpeedscopeProfile(),`viewer-${+new Date}.speedscope.json`)};y()},P=f=>{if(f instanceof WebGLActiveInfo||f instanceof WebGLBuffer||f instanceof WebGLFramebuffer||f instanceof WebGLProgram||f instanceof WebGLRenderbuffer||f instanceof WebGLShader||f instanceof WebGLShaderPrecisionFormat||f instanceof WebGLTexture||f instanceof WebGLUniformLocation){let y=f.constructor.name,v=y in d?d[y]:d[y]=[],w=v.indexOf(f);return w==-1&&(w=v.length,v.push(f)),y+"s["+w+"]"}return null},T={traceLines:c,compileTrace:m,downloadTrace:S,startProfile:R,stopProfile:E,annotateBlock:h,annotateProfile:A};p(`gl.canvas.width = ${a};`),p(`gl.canvas.height = ${s};`);for(let f in i){let y=i[f];if(typeof y=="function"){let v=((w,I)=>()=>{let C=[];_(),(t.width!=a||t.height!=s)&&(a=t.width,s=t.height,p(`gl.canvas.width = ${a};`),p(`gl.canvas.height = ${s};`));for(let b=0,D=arguments.length;b<D;b=b+1){let U=arguments[b];if(typeof U=="number"||typeof U=="boolean"||typeof U=="string"||Array.isArray(U)||U===null)C.push(JSON.stringify(U));else if(ArrayBuffer.isView(U))C.push(`new ${U.constructor.name}([${Array.prototype.slice.call(U)}])`);else{let H=P(U);H!=null?C.push(H):(console.warn("unsupported value:",U),C.push("null"))}}let L=`gl.${w}(`;for(let b=0,D=C.length;b<D;b=b+1)b!=0&&(L+=", "),L+=C[b];L+=");",o.isRunning()&&w.startsWith("draw")&&o.pushFrame(L);let B=I.apply(i,arguments);o.isRunning()&&w.startsWith("draw")&&o.popFrame(L);let V=P(B);return V!=null&&(L=V+" = "+L),p(L),B})(f,y);T[f]=v}else(v=>{Object.defineProperty(T,v,{set:w=>{i[v]=w},get:()=>i[v]})})(f)}return window.recordingContext=T,T}var fr;(i=>{function t(a){let s=[];for(let l=0,c=a.length;l<c;l=l+1)s.push(a[l]);return s}i.asList=t;function e(a,s,l){a.addEventListener(s,l)}i.on1=e;function r(a,s,l,c){a.addEventListener(s,l,c)}i.on2=r;function n(a,s,l){a.removeEventListener(s,l)}i.off=n;function o(a){a.preventDefault()}i.preventDefault=o})(fr||(fr={}));function Qd(t,e={}){let r=Kd(t,e);return Yd?RC(r.canvas,r):r}var S_;(r=>{function t(n){return n.result}r.FileReader_resultAsArrayBuffer=t;function e(n){return n.result}r.FileReader_resultAsString=e})(S_||(S_={}));var ml;(e=>{function t(r){return r&&r.now?r.now():+new Date}e.Performance_now=t})(ml||(ml={}));var sr;(P=>{function t(T,f,y){fr.on1(T,f,y)}P.EventTarget_addEventListener1=t;function e(T,f,y){fr.on1(T,f,y)}P.EventTarget_addEventListener2=e;function r(T,f,y){fr.on1(T,f,y)}P.EventTarget_addEventListener3=r;function n(T,f,y){fr.on1(T,f,y)}P.EventTarget_addEventListener4=n;function o(T,f,y){fr.on1(T,f,y)}P.EventTarget_addEventListener5=o;function i(T,f,y){fr.on1(T,f,y)}P.EventTarget_addEventListener6=i;function a(T,f,y){fr.on1(T,f,y)}P.EventTarget_addEventListener7=a;function s(T,f,y,v){fr.on2(T,f,y,v)}P.EventTarget_addEventListener8=s;function l(T,f,y,v){fr.on2(T,f,y,v)}P.EventTarget_addEventListener9=l;function c(T,f,y,v){fr.on2(T,f,y,v)}P.EventTarget_addEventListener10=c;function d(T,f,y,v){fr.on2(T,f,y,v)}P.EventTarget_addEventListener11=d;function u(T,f,y,v){fr.on2(T,f,y,v)}P.EventTarget_addEventListener12=u;function p(T,f,y,v){fr.on2(T,f,y,v)}P.EventTarget_addEventListener13=p;function _(T,f,y,v){fr.on2(T,f,y,v)}P.EventTarget_addEventListener14=_;function h(T,f,y){fr.off(T,f,y)}P.EventTarget_removeEventListener1=h;function A(T,f,y){fr.off(T,f,y)}P.EventTarget_removeEventListener2=A;function m(T,f,y){fr.off(T,f,y)}P.EventTarget_removeEventListener3=m;function g(T,f,y){fr.off(T,f,y)}P.EventTarget_removeEventListener4=g;function S(T,f,y){fr.off(T,f,y)}P.EventTarget_removeEventListener5=S;function R(T,f,y){fr.off(T,f,y)}P.EventTarget_removeEventListener6=R;function E(T,f,y){fr.off(T,f,y)}P.EventTarget_removeEventListener7=E})(sr||(sr={}));var A_;(e=>{function t(r){return r.isConnected}e.Node_isConnected=t})(A_||(A_={}));var T_;(e=>{function t(r){let n=r.getBoundingClientRect(),o=n.x+n.width/2,i=n.y+n.height/2;return r.ownerDocument.elementFromPoint(o,i)===r}e.Element_isVisible=t})(T_||(T_={}));var xi;(e=>{function t(r){fr.preventDefault(r)}e.Event_preventDefault=t})(xi||(xi={}));var E_;(r=>{function t(n){return fr.asList(n.types)}r.DataTransfer_types=t;function e(n){return fr.asList(n.files)}r.DataTransfer_files=e})(E_||(E_={}));var yC;(e=>{function t(r){if(typeof r.buttons>"u"){let n=r.which;return n<2?n:n==3?2:4}return r.buttons}e.MouseEvent_buttons=t})(yC||(yC={}));var I_;(n=>{function t(o){return fr.asList(o.touches)}n.TouchEvent_touches=t;function e(o){return fr.asList(o.targetTouches)}n.TouchEvent_targetTouches=e;function r(o){return fr.asList(o.changedTouches)}n.TouchEvent_changedTouches=r})(I_||(I_={}));function Mn(){return self}var N;(k=>{function t(z){return z&255}k.red=t;function e(z){return z>>8&255}k.green=e;function r(z){return z>>16&255}k.blue=r;function n(z){return z>>>24}k.alpha=n;function o(z){return t(z)/255}k.redF=o;function i(z){return e(z)/255}k.greenF=i;function a(z){return r(z)/255}k.blueF=a;function s(z){return n(z)/255}k.alphaF=s;function l(z,q){return R(t(z),e(z),r(z),q)}k.withAlpha=l;function c(z){let q=s(z);return E(o(z)*q,i(z)*q,a(z)*q,q)}k.premultiplied=c;function d(z){let q=s(z);return E(o(z)/q,i(z)/q,a(z)/q,q)}k.unpremultiplied=d;function u(z,q){return z&16777215|T(s(z)*q)<<24}k.multiplyOpacity=u;function p(z){return`Color(${t(z)}, ${e(z)}, ${r(z)}, ${n(z)})`}k.toString=p;function _(z){return n(z)==255}k.isOpaque=_;function h(z){return"#"+w(t(z))+w(e(z))+w(r(z))}k.toCSS=h;function A(z){return{red:o(z),green:i(z),blue:a(z),alpha:s(z)}}k.toColorF=A;function m(z){return{r:t(z),g:e(z),b:r(z),a:n(z)}}k.asInttoJSON=m;function g(z){return{r:o(z),g:i(z),b:a(z),a:s(z)}}k.asFloattoJSON=g;function S(z,q,Y){return R(z,q,Y,255)}k.new1=S;function R(z,q,Y,j){return z|q<<8|Y<<16|j<<24}k.new2=R;function E(z,q,Y,j){return R(T(z),T(q),T(Y),T(j))}k.new3=E;function P(z){return E(z.red,z.green,z.blue,z.alpha)}k.fromColorF=P;function T(z){return z<0?0:z>=1?255:Math.round(z*255)|0}k._clamp=T;function f(z,q,Y){return E(o(z)+(o(q)-o(z))*Y,i(z)+(i(q)-i(z))*Y,a(z)+(a(q)-a(z))*Y,s(z)+(s(q)-s(z))*Y)}k.mix=f;function y(z,q){let Y=s(z),j=s(q),ae=Y*(1-j),xe=ae+j,Je=ae/xe,We=j/xe;return E(o(z)*Je+o(q)*We,i(z)*Je+i(q)*We,a(z)*Je+a(q)*We,xe)}k.blend=y;function v(z,q){return E(o(z)*(1-s(q))+o(q),i(z)*(1-s(q))+i(q),a(z)*(1-s(q))+a(q),s(z)*(1-s(q))+s(q))}k.over=v;function w(z){let q=z.toString(16);return(q.length==1?"0"+q:q).toUpperCase()}k.asCSSComponent=w,k.TRANSPARENT=R(0,0,0,0),k.BLACK=S(0,0,0),k.WHITE=S(255,255,255),k.RED=S(255,0,0),k.GREEN=S(0,255,0),k.BLUE=S(0,0,255),k.YELLOW=S(255,255,0),k.CYAN=S(0,255,255),k.MAGENTA=S(255,0,255)})(N||(N={}));var Bn=class t{constructor(e){e?(this._capacity=0,this._bytes=e,this._count=this._capacity=e.length,this._view=new DataView(e.buffer,e.byteOffset,e.length)):(this._count=0,this._capacity=256,this._bytes=new Uint8Array(this._capacity),this._view=new DataView(this._bytes.buffer))}clear(){this._count=0}clone(){return new t(new Uint8Array(this.bytes()))}isEmpty(){return this._count==0}byteCount(){return this._count}bytes(){return this._bytes.subarray(0,this._count)}floatAt(e){return this._view.getFloat32(e,!0)}byteAt(e){return this._bytes[e]}appendFloat(e){return this._count+4>this._capacity&&this._grow(this._count+4),this._view.setFloat32(this._count,e,!0),this._count=this._count+4,this}appendByte(e){return this._count+1>this._capacity&&this._grow(this._count+1),this._bytes[this._count]=e,this._count=this._count+1,this}prependBytes(e){let r=e.byteCount();return this._count+r>this._capacity&&this._grow(this._count+r),this._bytes.set(this.bytes(),r),this._bytes.set(e.bytes()),this._count=this._count+r,this}appendBytes(e){let r=e.byteCount();return this._count+r>this._capacity&&this._grow(this._count+r),this._bytes.set(e.bytes(),this._count),this._count=this._count+r,this}setFloatAt(e,r){this._view.setFloat32(e,r,!0)}_grow(e){this._capacity=e*2;let r=new Uint8Array(this._capacity);this._bytes!=null&&r.set(this._bytes),this._bytes=r,this._view=new DataView(r.buffer)}},R_;(e=>{function t(r,n){if(r==null||n==null||r.byteCount()!=n.byteCount())return!1;for(let o=0,i=r.byteCount();o<i;o=o+1)if(r.byteAt(o)!=n.byteAt(o))return!1;return!0}e.FrozenDataArray_equals=t})(R_||(R_={}));var O=class t{constructor(e,r){this._x=0,this._y=0,this._x=e,this._y=r}isContainedInSimpleHull(e){let r=0;for(let n=0;n<e.length;n++){let o=e[n],i=e[(n+1)%e.length];if(o.y()<=this.y()&&i.y()>this.y()||o.y()>this.y()&&i.y()<=this.y()){let a=(this.y()-o.y())/(i.y()-o.y());this.x()<o.x()+a*(i.x()-o.x())&&r++}}return r%2!==0}x(){return this._x}y(){return this._y}setX(e){this._x=e}setY(e){this._y=e}multiplyScalar(e){return new t(this.x()*e,this.y()*e)}multiply(e){return new t(this.x()*e.x(),this.y()*e.y())}addScalar(e){return new t(this.x()+e,this.y()+e)}add(e){return new t(this.x()+e.x(),this.y()+e.y())}negative(){return new t(-this.x(),-this.y())}subtractScalar(e){return new t(this.x()-e,this.y()-e)}subtract(e){return new t(this.x()-e.x(),this.y()-e.y())}divideScalar(e){return new t(this.x()/e,this.y()/e)}divide(e){return new t(this.x()/e.x(),this.y()/e.y())}clone(){return new t(this.x(),this.y())}dot(e){return this.x()*e.x()+this.y()*e.y()}equals(e){return this.x()==e.x()&&this.y()==e.y()}floatEquals(e,r=1e-5){return Math.abs(this.x()-e.x())<=r&&Math.abs(this.y()-e.y())<=r}freeze(){return this.clone()}isZero(){return this.x()==0&&this.y()==0}isPositive(){return this.x()>0&&this.y()>0}length(){return Math.sqrt(this.x()*this.x()+this.y()*this.y())}maxComponent(){return Math.max(this.x(),this.y())}max(e){return new t(Math.max(this.x(),e.x()),Math.max(this.y(),e.y()))}minComponent(){return Math.min(this.x(),this.y())}min(e){return new t(Math.min(this.x(),e.x()),Math.min(this.y(),e.y()))}distanceTo(e){return Math.sqrt(this.squaredDistanceTo(e))}withOnesForZeros(){return new t(this.x()==0?1:this.x(),this.y()==0?1:this.y())}area(){return this.x()*this.y()}squaredDistanceTo(e){let r=this.x()-e.x(),n=this.y()-e.y();return r*r+n*n}approximatelyEquals(e,r){return this.squaredDistanceTo(e)<=r*r}mixedWith(e,r){return new t(this.x()+(e.x()-this.x())*r,this.y()+(e.y()-this.y())*r)}flipped(){return new t(this._y,this._x)}mixWith(e,r){this._x+=(e.x()-this.x())*r,this._y+=(e.y()-this.y())*r}addUpdate(e){this._x+=e,this._y+=e}addUpdate1(e){this._x+=e.x(),this._y+=e.y()}subtractUpdate(e){this._x-=e,this._y-=e}subtractUpdate1(e){this._x-=e.x(),this._y-=e.y()}multiplyUpdate(e){this._x*=e,this._y*=e}multiplyUpdate1(e){this._x*=e.x(),this._y*=e.y()}divideUpdate(e){this._x/=e,this._y/=e}divideUpdate1(e){this._x/=e.x(),this._y/=e.y()}rounded(){return new t(Math.round(this._x),Math.round(this._y))}setTo(e,r){return this._x=e,this._y=r,this}copyFrom(e){return this._x=e.x(),this._y=e.y(),this}makeAbs(){return this._x=Math.abs(this._x),this._y=Math.abs(this._y),this}toString(){return`Vector(${this.x()}, ${this.y()})`}toJSON(){return{x:this._x,y:this._y}}static new(e=void 0){return e?new t(e.x(),e.y()):new t(0,0)}static cross(e,r){return e.x()*r.y()-e.y()*r.x()}static lerp(e,r,n){return e.multiplyScalar(1-n).add(r.multiplyScalar(n))}static equals_(e,r){return e==null!=(r==null)?!1:e==null?!0:e.equals(r)}},ge;(s=>{function t(){return O.new()}s.FrozenVector_new1=t;function e(l){return l}s.FrozenVector_new2=e;function r(l){return O.new(l)}s.FrozenVector_new3=r;function n(l,c){return new O(l,c)}s.FrozenVector_new4=n,s.FrozenVector_ZERO=t(),s.FrozenVector_ONE=n(1,1),s.FrozenVector_INFINITY=n(1/0,1/0)})(ge||(ge={}));var $n=class $n{static createInterpolateBlendState(e){return new $n(ga.INTERPOLATE,10,11,10,11,e)}constructor(e,r,n,o,i,a){this.type=e,this.sourceColor=r,this.targetColor=n,this.sourceAlpha=o,this.targetAlpha=i,this.constant=a}};$n.ZERO=new $n(void 0,0,0,0,0,0),$n.COPY=new $n(ga.COPY,1,0,1,0,0),$n.KEEP=new $n(ga.KEEP,0,1,0,1,0),$n.PREMULTIPLIED=new $n(ga.PREMULTIPLIED,1,8,1,8,0),$n.UNPREMULTIPLIED=new $n(ga.UNPREMULTIPLIED,6,8,6,8,0),$n.SCREEN=new $n(ga.SCREEN,1,4,1,8,0),$n.LINEAR_DODGE=new $n(ga.LINEAR_DODGE,1,1,1,8,0);var lt=$n;var _i=class _i{};_i.FILL=128,_i.STROKE=64,_i.NOT_FILL=255^_i.FILL,_i.NOT_STROKE=255^_i.STROKE,_i.FILL_AND_STROKE=_i.FILL|_i.STROKE,_i.WINDING_MASK=255^_i.FILL_AND_STROKE;var Mr=_i,y_=class y_{equals(e){return this==e||this.comparison==e.comparison&&this.stencilFail==e.stencilFail&&this.stencilPassDepthPass==e.stencilPassDepthPass}constructor(e,r,n){this.comparison=e,this.stencilFail=r,this.stencilPassDepthPass=n}};y_.NONE=new y_(6,5,5);var Rn=y_,or=class or{constructor(e,r,n,o,i,a,s){this.type=e,this.isEnabled=s,this.frontFace=r,this.backFace=n,this.readMask=o,this.writeMask=i,this.reference=a}static both(e,r,n,o,i){return new or(e,r,r,n,o,i,!0)}equals(e){return this==e||this.type===e.type&&this.isEnabled==e.isEnabled&&this.frontFace.equals(e.frontFace)&&this.backFace.equals(e.backFace)&&this.readMask===e.readMask&&this.writeMask===e.writeMask&&this.reference===e.reference}};or.NONE=new or(Ln.NONE,Rn.NONE,Rn.NONE,0,-1,0,!1),or.ODD_WINDING_NUMBER_COMPUTE=or.both(Ln.ODD_WINDING_NUMBER_COMPUTE,new Rn(0,5,4),1,1,0),or.NONZERO_WINDING_NUMBER_COMPUTE=new or(Ln.NONZERO_WINDING_NUMBER_COMPUTE,new Rn(0,5,3),new Rn(0,5,1),Mr.WINDING_MASK,Mr.WINDING_MASK,0,!0),or.ODD_WINDING_NUMBER=or.both(Ln.ODD_WINDING_NUMBER,new Rn(7,5,5),1,0,0),or.NONZERO_WINDING_NUMBER=or.both(Ln.NONZERO_WINDING_NUMBER,new Rn(7,5,5),Mr.WINDING_MASK,0,0),or.ODD_WINDING_NUMBER_CLEAR=or.both(Ln.ODD_WINDING_NUMBER_CLEAR,new Rn(7,7,7),1,Mr.WINDING_MASK,0),or.NONZERO_WINDING_NUMBER_CLEAR=or.both(Ln.NONZERO_WINDING_NUMBER_CLEAR,new Rn(7,7,7),Mr.WINDING_MASK,Mr.WINDING_MASK,0),or.ODD_WINDING_NUMBER_FILL=or.both(Ln.ODD_WINDING_NUMBER_FILL,new Rn(7,5,6),1,Mr.NOT_STROKE,Mr.FILL),or.NONZERO_WINDING_NUMBER_FILL=or.both(Ln.NONZERO_WINDING_NUMBER_FILL,new Rn(7,5,6),Mr.WINDING_MASK,Mr.NOT_STROKE,Mr.FILL),or.ODD_WINDING_NUMBER_STROKE=or.both(Ln.ODD_WINDING_NUMBER_STROKE,new Rn(7,5,6),1,Mr.NOT_FILL,Mr.STROKE),or.NONZERO_WINDING_NUMBER_STROKE=or.both(Ln.NONZERO_WINDING_NUMBER_STROKE,new Rn(7,5,6),Mr.WINDING_MASK,Mr.NOT_FILL,Mr.STROKE),or.STROKE_INSIDE=or.both(Ln.STROKE_INSIDE,new Rn(1,5,5),Mr.FILL_AND_STROKE,0,Mr.FILL_AND_STROKE),or.STROKE_OUTSIDE=or.both(Ln.STROKE_OUTSIDE,new Rn(1,5,5),Mr.FILL_AND_STROKE,0,Mr.STROKE),or.STROKE_INSIDE_CLEAR=or.both(Ln.STROKE_CLEAR,new Rn(1,7,7),Mr.FILL_AND_STROKE,-1,Mr.FILL_AND_STROKE),or.STROKE_OUTSIDE_CLEAR=or.both(Ln.STROKE_CLEAR,new Rn(1,7,7),Mr.FILL_AND_STROKE,-1,Mr.STROKE);var _r=or;function AD(t){return t==0?4:1}function vC(t){window.testFakeLostContext=()=>{let e=t.getExtension("WEBGL_lose_context");if(e==null)return;e.loseContext();let r=3;setTimeout(()=>{console.log(`waiting ${r} seconds to restore the context...`)},500),setTimeout(()=>{e.restoreContext()},r*1e3)},window.testRealLostContext=()=>{let e=[];for(let r=0;r<32;r=r+1)e.push(Qd(K.shouldUseWebGL2()))}}function CC(t){let e=t==null?void 0:t.graphicsCardName();return e!=null&&e.indexOf("SwiftShader")!=-1}var ra=class{constructor(e,r){this.canvasSize=e,this.webGLDidAdjustCanvasSize=r}};var Og=class{constructor(e,r,n,o,i=!1){this.name=e,this.type=r,this.count=n,this.byteOffset=o,this.isInstanced=i}},It=class t{constructor(){this._supportsInstancing=!1;this._attributes=[],this._stride=0}supportsInstancing(){return this._supportsInstancing}attributes(){return this._attributes}stride(){return this._stride}add(e,r,n,o=!1){return this._attributes.push(new Og(e,r,n,this._stride,o)),this._stride=this._stride+n*AD(r),o&&(this._supportsInstancing=o),this}static getPositionF2(){return t._POSITION_F2||(t._POSITION_F2=new t().add(Lr.instance().SHADER_NAME_A_POSITION2,0,2)),t._POSITION_F2}static getPositionF2CoordF3(){return t._POSITION_F2_COORD_F3||(t._POSITION_F2_COORD_F3=new t().add(Lr.instance().SHADER_NAME_A_POSITION2,0,2).add(Lr.instance().SHADER_NAME_A_COORD3,0,3)),t._POSITION_F2_COORD_F3}static getPositionF4CoordF4(){return t._POSITION_F4_COORD_F4||(t._POSITION_F4_COORD_F4=new t().add(Lr.instance().SHADER_NAME_A_POSITION4,0,4).add(Lr.instance().SHADER_NAME_A_COORD4,0,4)),t._POSITION_F4_COORD_F4}static getPositionF4CoordB4(){return t._POSITION_F4_COORD_B4||(t._POSITION_F4_COORD_B4=new t().add(Lr.instance().SHADER_NAME_A_POSITION4,0,4).add(Lr.instance().SHADER_NAME_A_COORD4,1,4)),t._POSITION_F4_COORD_B4}static getPositionF4(){return t._POSITION_F4||(t._POSITION_F4=new t().add(Lr.instance().SHADER_NAME_A_POSITION4,0,4)),t._POSITION_F4}static getInstanceTransform_F3_F3(){return t._INSTANCETRANSFORM_F3_F3||(t._INSTANCETRANSFORM_F3_F3=new t().add(Lr.instance().SHADER_NAME_INSTANCE_TRANSFORM0,0,3,!0).add(Lr.instance().SHADER_NAME_INSTANCE_TRANSFORM1,0,3,!0)),t._INSTANCETRANSFORM_F3_F3}},_t=class t{constructor(e){this._supportsInstancing=!1;this._vertexFormats=e;for(var r of e)r.supportsInstancing()&&(this._supportsInstancing=!0)}inputs(){return this._vertexFormats}numInputs(){return this._vertexFormats.length}input(e){return this._vertexFormats[e]}supportsInstancing(){return this._supportsInstancing}static getPositionF2(){return t._POSITION_F2||(t._POSITION_F2=new t(new Array(It.getPositionF2()))),t._POSITION_F2}static getPositionF2CoordF3(){return t._POSITION_F2_COORD_F3||(t._POSITION_F2_COORD_F3=new t(new Array(It.getPositionF2CoordF3()))),t._POSITION_F2_COORD_F3}static getPositionF4CoordF4(){return t._POSITION_F4_COORD_F4||(t._POSITION_F4_COORD_F4=new t(new Array(It.getPositionF4CoordF4()))),t._POSITION_F4_COORD_F4}static getPositionF4CoordB4(){return t._POSITION_F4_COORD_B4||(t._POSITION_F4_COORD_B4=new t(new Array(It.getPositionF4CoordB4()))),t._POSITION_F4_COORD_B4}static getPositionF4(){return t._POSITION_F4||(t._POSITION_F4=new t(new Array(It.getPositionF4()))),t._POSITION_F4}static getPositionF2CoordF3_InstanceTransform_F3_F3(){return t._POSITION_F2_COORD_F3_INSTANCETRANSFORM_F3_F3||(t._POSITION_F2_COORD_F3_INSTANCETRANSFORM_F3_F3=new t(new Array(It.getPositionF2CoordF3(),It.getInstanceTransform_F3_F3()))),t._POSITION_F2_COORD_F3_INSTANCETRANSFORM_F3_F3}};var co=class co{constructor(e,r,n,o){this.pixelFormat=e,this.minFilter=r,this.magFilter=n,this.wrap=o}isCompressedFormat(){return fl.PixelFormat_isCompressedFormat(this.pixelFormat)}};co.RGBA_LINEAR_CLAMP=new co(0,1,1,1),co.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP=new co(0,1,0,1),co.RGBA_NEAREST_CLAMP=new co(0,0,0,1),co.RGBA_NEAREST_REPEAT=new co(0,0,0,0),co.STENCIL=new co(1,0,0,1),co.ASTC_6X6_NEAREST_CLAMP=new co(2,0,0,1),co.BC3_NEAREST_CLAMP=new co(3,0,0,1);var Me=co,Tc=class{constructor(e,r){this.texture=null,this.uvSpaceRect=null,this.texture=e,this.uvSpaceRect=r}},Ya=class{bufferArea(){var e;return(e=this._bufferArea)!=null&&e.hasBuffer()||(this._bufferArea=this._recreateBufferArea()),this._bufferArea}constructor(e){this._recreateBufferArea=e,this._bufferArea=this._recreateBufferArea()}},ys=class t{constructor(e,r){this._rectPoints=[O.new(),O.new(),O.new(),O.new()],this._inside=[],this._material=null,this._outside=[],this._vertices=new Bn,this._context=null,this._pixelScale=1,this._previousColor=N.TRANSPARENT,this._previousU=0,this._previousV=0,this._previousX=0,this._previousY=0,this._context=e,this._pool=r,this._materialStrings=Lr.instance(),this._material=e.createMaterial("smooth",_t.getPositionF4CoordB4(),this._materialStrings.SHADER_SOURCE_SMOOTH_PATH_VERTEX,this._materialStrings.SHADER_SOURCE_SMOOTH_PATH_FRAGMENT)}pixelScale(){return this._pixelScale}setTransformAndPixelScale(e,r){!0,Oe.Material_setUniformMat32(this._material,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,e),this._pixelScale=r}flush(){let e=this._pool.allocate(It.getPositionF4CoordB4(),this._vertices.bytes());e!=null&&(this._context.draw(qe.TRIANGLE_STRIP,this._material,e,lt.PREMULTIPLIED,_r.NONE,null),e.free()),this._vertices.clear()}_loadPoints(e){this._rectPoints[0].setTo(e.left(),e.top()),this._rectPoints[1].setTo(e.right(),e.top()),this._rectPoints[2].setTo(e.right(),e.bottom()),this._rectPoints[3].setTo(e.left(),e.bottom())}fillRect(e,r){this._loadPoints(e),this.fillConvexPolygon(this._rectPoints,r)}strokeRect(e,r,n){this._loadPoints(e),this.strokeNonOverlappingPolyline(this._rectPoints,r,n,t.Loop.CLOSED)}fillConvexPolygon(e,r){let n=this._inside,o=this._outside,i=e.length;if(!(i<3)){for(r=N.premultiplied(r);n.length<i;)n.push(O.new()),o.push(O.new());for(let a=0,s=i;a<s;a=a+1){let l=e[Ft.int_remainder(a+i-1,i)],c=e[a],d=e[Ft.int_remainder(a+1,i)],u=l.y()-c.y(),p=c.x()-l.x(),_=this._length(u,p),h=c.y()-d.y(),A=d.x()-c.x(),m=this._length(h,A),g=u/_+h/m,S=p/_+A/m,R=.5*this._pixelScale*_/(u*g+p*S),E=g*R,P=S*R;o[a].setTo(c.x()-E,c.y()-P),n[a].setTo(c.x()+E,c.y()+P)}for(let a=0,s=i-1;a<=s;a=a+1,s=s-1){let l=n[a],c=n[s];this._appendVertex(l.x(),l.y(),1,1,r),a==0&&this._appendPreviousVertex(),a<s&&this._appendVertex(c.x(),c.y(),1,1,r)}this._appendPreviousVertex();for(let a=0;a<=i;a=a+1){let s=Ft.int_remainder(a,i),l=n[s],c=o[s];this._appendVertex(c.x(),c.y(),0,0,r),a==0&&this._appendPreviousVertex(),this._appendVertex(l.x(),l.y(),1,1,r)}this._appendPreviousVertex()}}strokeNonOverlappingPolyline(e,r,n,o){let i=(n+this._pixelScale)/this._pixelScale,a=(n+this._pixelScale)/2,s=e.length;if(s<2)return;if(r=N.premultiplied(r),o==t.Loop.OPEN){let d=e[0],u=e[1],p=u.x()-d.x(),_=u.y()-d.y(),h=this._length(p,_),A=.5*this._pixelScale/h,m=p*A,g=_*A,S=a/h,R=-_*S,E=p*S;this._appendVertex(d.x()-m-R,d.y()-g-E,0,-i,r),this._appendPreviousVertex(),this._appendVertex(d.x()-m+R,d.y()-g+E,-i,0,r),this._appendVertex(d.x()+m-R,d.y()+g-E,0,i,r),this._appendVertex(d.x()+m+R,d.y()+g+E,i,0,r)}let l=o==t.Loop.CLOSED?0:1,c=o==t.Loop.CLOSED?s+1:s-1;for(let d=l,u=c;d<u;d=d+1){let p=e[Ft.int_remainder(d+s-1,s)],_=e[Ft.int_remainder(d,s)],h=e[Ft.int_remainder(d+1,s)],A=p.y()-_.y(),m=_.x()-p.x(),g=this._length(A,m),S=_.y()-h.y(),R=h.x()-_.x(),E=this._length(S,R),P=A/g+S/E,T=m/g+R/E,f=a*g/(A*P+m*T),y=P*f,v=T*f;this._appendVertex(_.x()-y,_.y()-v,0,i,r),d==0&&this._appendPreviousVertex(),this._appendVertex(_.x()+y,_.y()+v,i,0,r)}if(o==t.Loop.OPEN){let d=e[s-2],u=e[s-1],p=u.x()-d.x(),_=u.y()-d.y(),h=this._length(p,_),A=.5*this._pixelScale/h,m=p*A,g=_*A,S=a/h,R=-_*S,E=p*S;this._appendVertex(u.x()-m-R,u.y()-g-E,0,i,r),this._appendVertex(u.x()-m+R,u.y()-g+E,i,0,r),this._appendVertex(u.x()+m-R,u.y()+g-E,0,-i,r),this._appendVertex(u.x()+m+R,u.y()+g+E,-i,0,r)}this._appendPreviousVertex()}_appendVertex(e,r,n,o,i){this._previousX=e,this._previousY=r,this._previousU=n,this._previousV=o,this._previousColor=i,this._vertices.appendFloat(e).appendFloat(r).appendFloat(n).appendFloat(o),this._vertices.appendByte(N.red(i)).appendByte(N.green(i)).appendByte(N.blue(i)).appendByte(N.alpha(i))}_appendPreviousVertex(){this._appendVertex(this._previousX,this._previousY,this._previousU,this._previousV,this._previousColor)}_length(e,r){return Math.sqrt(e*e+r*r)}};(e=>{let t;(o=>(o[o.CLOSED=0]="CLOSED",o[o.OPEN=1]="OPEN"))(t=e.Loop||(e.Loop={}))})(ys||(ys={}));var C_=(n=>(n[n.WEBGL_TEXTURE=0]="WEBGL_TEXTURE",n[n.WEBGL_BUFFER=1]="WEBGL_BUFFER",n[n.WEBGL_RENDERBUFFER=2]="WEBGL_RENDERBUFFER",n))(C_||{}),v_=class{increment(e,r,n){var l,c;let o=this._vramUsedByTypeAndPurpose.get(e)||new Map,a=(o.get(r)||0)+n;o.set(r,a),this._vramUsedByTypeAndPurpose.has(e)||this._vramUsedByTypeAndPurpose.set(e,o),Kr.trackNumber(C_[e]+` (${r})`,a);let s=(c=(l=F())==null?void 0:l.modules())==null?void 0:c.corePerfInfo;switch(e){case 0:{if(!(r in br))break;let d=r;n>=0?s==null||s.textureMemStatsAlloc(d,n):s==null||s.textureMemStatsFree(d,-n);break}case 1:{let d=r;n>=0?s==null||s.rendererMemStatsAlloc(pl.VERTEX_BUFFER,n):s==null||s.rendererMemStatsFree(pl.VERTEX_BUFFER,-n);break}case 2:{n>=0?s==null||s.rendererMemStatsAlloc(pl.RENDERBUFFER,n):s==null||s.rendererMemStatsFree(pl.RENDERBUFFER,-n);break}}}decrement(e,r,n){this.increment(e,r,-n)}resetOnContextRestored(){this._vramUsedByTypeAndPurpose=new Map}constructor(){this._vramUsedByTypeAndPurpose=new Map}forType(e){if(!this._vramUsedByTypeAndPurpose.has(e))return 0;let r=0,n=this._vramUsedByTypeAndPurpose.get(e);for(let o of n.values())r+=o;return r}total(){let e=0;for(let r of this._vramUsedByTypeAndPurpose.values())for(let n of r.values())e+=n;return e}},Oe;(o=>{function t(i,a,s){i.setUniformVec21(a,s.x(),s.y())}o.Material_setUniformVec22=t;function e(i,a,s){i.setUniformVec41(a,N.redF(s),N.greenF(s),N.blueF(s),N.alphaF(s))}o.Material_setUniformVec42=e;function r(i,a,s){i.setUniformVec41(a,s.x(),s.y(),s.x()+s.width(),s.y()+s.height())}o.Material_setUniformVec43=r;function n(i,a,s){i.setUniformMat31(a,s.m00(),s.m01(),s.m02(),s.m10(),s.m11(),s.m12())}o.Material_setUniformMat32=n})(Oe||(Oe={}));var fl;(r=>{function t(n){switch(n){case 2:case 3:return 3.58/8;case 1:case 0:default:return 4}}r.PixelFormat_byteCount=t;function e(n){switch(n){case 2:case 3:return!0;default:return!1}}r.PixelFormat_isCompressedFormat=e})(fl||(fl={}));var hi;(n=>{function t(o,i,a){o.resize1(i,a,null,!1)}n.Texture_resize2=t;function e(o,i,a,s){o.resize1(i,a,s,!1)}n.Texture_resize3=e;function r(o){return o.width()*o.height()*fl.PixelFormat_byteCount(o.format().pixelFormat)}n.Texture_totalVRAM=r})(hi||(hi={}));var O_=!0;var Qa;(c=>{function t(){let d=Kd(K.shouldUseWebGL2());if(d==null)return!1;let u=d.canvas;document.body.appendChild(u);let p=d.createProgram();if(p==null)return!1;let _=d.createShader(d.VERTEX_SHADER);if(_==null)return!1;d.shaderSource(_,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),d.compileShader(_),d.attachShader(p,_);let h=d.createShader(d.FRAGMENT_SHADER);if(h==null)return!1;d.shaderSource(h,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0., 0., 0., 1.);
        }
      `),d.compileShader(h),d.attachShader(p,h),d.bindAttribLocation(p,0,"pos"),d.linkProgram(p);let A=d.createBuffer();if(A==null)return!1;d.bindBuffer(d.ARRAY_BUFFER,A);let m=new Float32Array([0,0,1,0,0,1,1,1]);d.bufferData(d.ARRAY_BUFFER,m.length*4,d.DYNAMIC_DRAW),d.bufferSubData(d.ARRAY_BUFFER,0,m),d.enableVertexAttribArray(0),d.vertexAttribPointer(0,2,d.FLOAT,!1,8,0),d.canvas.width=10,d.canvas.height=1;let g=d.createFramebuffer();if(g==null)return!1;d.bindFramebuffer(d.FRAMEBUFFER,g);let S=d.createTexture();if(S==null)return!1;d.bindTexture(d.TEXTURE_2D,S),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,S),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.canvas.width,d.canvas.height,0,d.RGBA,d.UNSIGNED_BYTE,null),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,S,0),d.useProgram(p),d.bindFramebuffer(d.FRAMEBUFFER,g),d.viewport(0,0,d.canvas.width/2|0,d.canvas.height),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,d.canvas.width/2|0,d.canvas.height),d.drawArrays(d.TRIANGLE_STRIP,0,4);let R=new Uint8Array(4);return d.readPixels((d.canvas.width/2|0)+2,0,1,1,d.RGBA,d.UNSIGNED_BYTE,R),document.body.removeChild(u),R[3]!=0}c._featureDetectViewportBug=t;function e(){let d=Kd(K.shouldUseWebGL2());if(d==null)return!1;let u=d.canvas;document.body.appendChild(u),d.canvas.width=1,d.canvas.height=1;let p=d.createTexture();if(p==null)return!1;d.bindTexture(d.TEXTURE_2D,p),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,p),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.canvas.width,d.canvas.height,0,d.RGBA,d.UNSIGNED_BYTE,null),d.bindTexture(d.TEXTURE_2D,p);let _=d.createFramebuffer();if(_==null)return!1;d.bindFramebuffer(d.FRAMEBUFFER,_),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,p,0);let h=d.createBuffer();if(h==null)return!1;d.bindBuffer(d.ARRAY_BUFFER,h),d.bufferData(d.ARRAY_BUFFER,32,d.DYNAMIC_DRAW),d.bufferSubData(d.ARRAY_BUFFER,0,new Float32Array([1,1,1,-1,-1,1,-1,-1])),d.vertexAttribPointer(0,2,d.FLOAT,!1,8,0),d.enableVertexAttribArray(0),d.bindBuffer(d.ARRAY_BUFFER,h);let A=d.createProgram();if(A==null)return!1;let m=d.createShader(d.VERTEX_SHADER);if(m==null)return!1;d.shaderSource(m,`
        precision highp float;
        attribute vec2 pos;
        varying vec2 uv;
        void main(){
          uv = (pos + vec2(1.0)) / 2.0;
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),d.compileShader(m),d.attachShader(A,m);let g=d.createShader(d.FRAGMENT_SHADER);if(g==null)return!1;d.shaderSource(g,`
        precision highp float;
        uniform sampler2D texture;
        varying vec2 uv;
        void main(){
          gl_FragColor=texture2D(texture, uv);
        }
      `),d.compileShader(g),d.attachShader(A,g),d.linkProgram(A);let S=d.createProgram();if(S==null)return!1;let R=d.createShader(d.VERTEX_SHADER);if(R==null)return!1;d.shaderSource(R,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos,0.,1.);
        }
      `),d.compileShader(R),d.attachShader(S,R);let E=d.createShader(d.FRAGMENT_SHADER);if(E==null)return!1;d.shaderSource(E,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0.,0.,1.,1.);
        }
      `),d.compileShader(E),d.attachShader(S,E),d.bindAttribLocation(S,0,"pos"),d.linkProgram(S),d.clearColor(1,0,0,1),d.bindFramebuffer(d.FRAMEBUFFER,_),d.useProgram(S),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.bindFramebuffer(d.FRAMEBUFFER,null),d.useProgram(A),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.bindFramebuffer(d.FRAMEBUFFER,_),d.clear(d.COLOR_BUFFER_BIT),d.bindFramebuffer(d.FRAMEBUFFER,null),d.useProgram(A),d.drawArrays(d.TRIANGLE_STRIP,0,4);let P=new Uint8Array(4);return d.readPixels(0,0,1,1,d.RGBA,d.UNSIGNED_BYTE,P),document.body.removeChild(u),P[0]!=255}c._featureDetectDrawClearReorderingBug=e;function r(){return c._hasViewportBug==null?(we("Called hasViewportBug before running feature detection"),!1):c._hasViewportBug.value}c.hasViewportBug=r;function n(){return c._hasDrawClearReorderingBug==null?(we("Called hasDrawClearReorderingBug before running feature detection"),!1):c._hasDrawClearReorderingBug.value}c.hasDrawClearReorderingBug=n;function o(){return c._hasUnexpectedCompositingBug==null?(we("Called hasDrawClearReorderingBug before running feature detection"),!1):c._hasUnexpectedCompositingBug.value}c.hasUnexpectedCompositingBug=o;function i(){c._hasViewportBug=new pe(t()),r()&&console.warn("GPUBugs: device has buggy implementation of gl.viewport. Will apply workarounds."),c._hasDrawClearReorderingBug=new pe(e()),n()&&console.warn("GPUBugs: Device may re-order draw/clear commands. Will apply workarounds.");let d=navigator.userAgent,u=(d.indexOf("iPhone OS 14_0")|0)!=-1,p=(d.indexOf("iPhone OS 14_1")|0)!=-1,_=u||p,h=(d.indexOf("iPad; CPU OS 14_0")|0)!=-1,A=(d.indexOf("iPad; CPU OS 14_1")|0)!=-1,m=h||A,S=(d.indexOf("Version/14")|0)!=-1&&(d.indexOf("Safari")|0)!=-1&&(navigator.maxTouchPoints|0)>0;c._hasUnexpectedCompositingBug=new pe(_||m||S)}c.detect=i,c._hasViewportBug=null,c._hasDrawClearReorderingBug=null,c._hasUnexpectedCompositingBug=null})(Qa||(Qa={}));var gl=class gl{static instance(){return gl._instance==null&&(gl._instance=new gl),gl._instance}requestLibrary(){this.startLibLoad()}onLoadComplete(e){this._videoJsLib=e,this.onSuccess!=null&&this.onSuccess()}hasRequestedLibrary(){return this._requestStarted}isLibAvailable(){return this._videoJsLib!==null}getPlayer(e,r){return this._videoJsLib===null?(console.warn("VideoJS used before initialized"),null):this._videoJsLib.videoJs(e,{preload:r}).player()}constructor(){this._videoJsLib=null,this._requestStarted=!1,this.startLibLoad=null,this.onSuccess=null}};gl._instance=null;var vo=gl,qd;(e=>{function t(r){let n=document.getElementById(r.id());return(n==null?void 0:n.getElementsByTagName("video"))[0]}e.VideoJsPlayer_getBackingVideo=t})(qd||(qd={}));var hn=class hn{static fromMinAndMax(e,r,n,o){return new hn(e,r,n-e,o-r)}static fromRect(e){return new hn(e.x(),e.y(),e.width(),e.height())}constructor(e,r,n,o){this._x=0,this._y=0,this._width=0,this._height=0,this._x=e,this._y=r,this._width=n,this._height=o}intersectsLineSegment(e,r){let n=this.left(),o=this.right(),i=this.top(),a=this.bottom(),s=e.x(),l=e.y(),c=r.x(),d=r.y();return this._intersectsLineSegment(s,l,c,d,n,i,n,a)||this._intersectsLineSegment(s,l,c,d,n,a,o,a)||this._intersectsLineSegment(s,l,c,d,o,a,o,i)||this._intersectsLineSegment(s,l,c,d,o,i,n,i)}_intersectsLineSegment(e,r,n,o,i,a,s,l){let c=(i-s)*(r-o)-(a-l)*(e-n);if(Math.abs(c)<1e-10)return!1;let d=((i-e)*(r-o)-(a-r)*(e-n))/c,u=-((i-s)*(a-r)-(a-l)*(i-e))/c;return d>=0&&d<=1&&u>=0&&u<=1}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}setX(e){this._x=e}setY(e){this._y=e}setWidth(e){this._width=e}setHeight(e){this._height=e}clone(){return new hn(this.x(),this.y(),this.width(),this.height())}freeze(){return this.clone()}left(){return this.x()}top(){return this.y()}right(){return this.x()+this.width()}bottom(){return this.y()+this.height()}centerX(){return this.x()+this.width()/2}centerY(){return this.y()+this.height()/2}area(){return this.width()*this.height()}isEmpty(){return!(this.width()>0&&this.height()>0)}isInvalid(){return!(this.width()>=0&&this.height()>=0)}isFinite(){return isFinite(this._x)&&isFinite(this._y)&&isFinite(this._width)&&isFinite(this._height)}equals(e){return this.x()==e.x()&&this.y()==e.y()&&this.width()==e.width()&&this.height()==e.height()}contains1(e){return this.isEmpty()||e.isEmpty()?!1:this._x<=e.x()&&this._y<=e.y()&&this._x+this._width>=e.x()+e.width()&&this._y+this._height>=e.y()+e.height()}contains2(e){return!this.isEmpty()&&e!=null&&this.left()<=e.x()&&e.x()<this.right()&&this.top()<=e.y()&&e.y()<this.bottom()}overlaps(e){return!this.isEmpty()&&e!=null&&!e.isEmpty()&&this.left()<e.right()&&e.left()<this.right()&&this.top()<e.bottom()&&e.top()<this.bottom()}distanceTo(e){let r=Math.max(0,Math.abs(this.centerX()-e.centerX())-(this.width()+e.width())/2),n=Math.max(0,Math.abs(this.centerY()-e.centerY())-(this.height()+e.height())/2);return Math.sqrt(r*r+n*n)}topLeft(){return new O(this.left(),this.top())}topRight(){return new O(this.right(),this.top())}bottomLeft(){return new O(this.left(),this.bottom())}bottomRight(){return new O(this.right(),this.bottom())}size(){return new O(this.width(),this.height())}center(){return new O(this.x()+this.width()/2,this.y()+this.height()/2)}centerSelf(){return this.translate2(this.center().negative()),this}translate1(e,r){this._x+=e,this._y+=r}translate2(e){this._x+=e.x(),this._y+=e.y()}translatedBy(e){let r=this.clone();return r.translate2(e),r}scaleFromCenter(e){e-=1,this.expand2(this.width()*e,this.height()*e)}scaledBy1(e){return this.scaledBy2(new O(e,e))}scaledBy2(e){return this.isInvalid()?this.copyFrom(hn.INVALID):this.isFinite()?(this._x=this._x*e.x(),this._y=this._y*e.y(),this._width=this._width*e.x(),this._height=this._height*e.y(),this):this.copyFrom(hn.INFINITE)}expandToInts(){let e=Math.floor(this._x),r=Math.floor(this._y);this._width=Math.ceil(this._x+this._width)-e,this._height=Math.ceil(this._y+this._height)-r,this._x=e,this._y=r}setTo1(e,r,n,o){return this._x=e,this._y=r,this._width=n,this._height=o,this}setTo2(e,r){return this._x=e.x(),this._y=e.y(),this._width=r.x(),this._height=r.y(),this}copyFrom(e){return this.setX(e.x()),this.setY(e.y()),this.setWidth(e.width()),this.setHeight(e.height()),this}expand1(e){this._x-=e,this._y-=e,this._width+=2*e,this._height+=2*e}contract(e){this.expand1(-e)}expandedBy1(e){return this.expand1(e),this}expandedBy2(e,r){return this.expand2(e,r),this}expand2(e,r){this._x-=e,this._y-=r,this._width+=2*e,this._height+=2*r}expandToInclude(e){if(e.isEmpty())return;if(this.isEmpty()){this.copyFrom(e);return}let r=Math.min(this._x,e.x()),n=Math.min(this._y,e.y());this._width=Math.max(this._x+this._width,e.x()+e.width())-r,this._height=Math.max(this._y+this._height,e.y()+e.height())-n,this._x=r,this._y=n}intersectedWith(e){return this.intersectWith(e),this}intersectWith(e){if(this.isEmpty()||e.isEmpty())this.copyFrom(Gr.FrozenRect_EMPTY);else{let r=Math.max(this._x,e.x()),n=Math.max(this._y,e.y());this._width=Math.min(this._x+this._width,e.x()+e.width())-r,this._height=Math.min(this._y+this._height,e.y()+e.height())-n,this._x=r,this._y=n}}round(){let e=Math.round(this._x),r=Math.round(this._y),n=Math.round(this._x+this._width),o=Math.round(this._y+this._height);this._x=e,this._y=r,this._width=n-e,this._height=o-r}rounded(){return this.round(),this}toString(){return`Rect(${this.x()}, ${this.y()}, ${this.width()}, ${this.height()})`}transformInto1(e,r){Et.INSTANCE.reset();let n=O.new();for(let o=0;o<4;o=o+1)n.setTo(this._x+this._width*(o&1),this._y+this._height*(o>>1)),r.transformPoint(n),Et.INSTANCE.include2(n);Et.INSTANCE.buildTo(e)}transformBy1(e){this.transformInto1(this,e)}transformInto2(e,r){Et.INSTANCE.reset();let n=O.new();for(let o=0;o<4;o=o+1)n.setTo(this._x+this._width*(o&1),this._y+this._height*(o>>1)),r.transformPoint(n),Et.INSTANCE.include2(n);Et.INSTANCE.buildTo(e)}transformBy2(e){this.transformInto2(this,e)}leftThird(){return new hn(this._x,this._y,this._width/3,this._height)}rightThird(){let e=this._width/3;return new hn(this._x+2*e,this._y,this._width/3,this._height)}static new2(){return new hn(0,0,0,0)}static new3(e){return new hn(e.x(),e.y(),e.width(),e.height())}static new4(e,r){return new hn(e.x(),e.y(),r.x(),r.y())}};hn.INVALID=new hn(1/0,1/0,-1/0,-1/0),hn.INFINITE=new hn(-1/0,-1/0,1/0,1/0),hn.CLIP=hn.fromMinAndMax(-1,-1,1,1),hn.UNIT=new hn(0,0,1,1);var x=hn,b_=class b_{constructor(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this.reset()}isValid(){return this._minX<this._maxX&&this._minY<this._maxY}isValidOrZeroArea(){return this._minX<=this._maxX&&this._minY<=this._maxY}reset(){this._minX=1/0,this._minY=1/0,this._maxX=-1/0,this._maxY=-1/0}include1(e,r){this._minX=Math.min(this._minX,e),this._minY=Math.min(this._minY,r),this._maxX=Math.max(this._maxX,e),this._maxY=Math.max(this._maxY,r)}include2(e){this.include1(e.x(),e.y())}include3(e){e!=null&&!e.isEmpty()&&(this.include1(e.left(),e.top()),this.include1(e.right(),e.bottom()))}include4(e,r){if(!e.isEmpty()){let n=x.new2();e.transformInto1(n,r),this.include3(n)}}buildTo(e){e.setTo1(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY)}build(){let e=x.new2();return this.buildTo(e),e}};b_.INSTANCE=new b_;var Et=b_,na=class t{constructor(){if(arguments[0]==0){let[,e,r,n,o]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=x.new4(e,r),this._nodeRadius=n,this._cornerSmoothing=o}else if(arguments[0]==1){let[,e,r,n,o]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=x.new4(e,r),this._vertexRadii=n,this._cornerSmoothing=o}else if(arguments[0]==2){let[,e,r,n,o]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=e,this._nodeRadius=r,this._vertexRadii=n}}clone(){var e;return new t(2,this._rect.clone(),this._nodeRadius,(e=this._vertexRadii)==null?void 0:e.slice(),this._cornerSmoothing)}cornerSmoothing(){return this._cornerSmoothing}left(){return this._rect.x()}top(){return this._rect.top()}width(){return this._rect.width()}height(){return this._rect.height()}rect(){return this._rect}nodeRadius(){return this._nodeRadius}vertexRadii(){return this._vertexRadii}isRounded(){return this._nodeRadius>0||this._vertexRadii!=null&&this._vertexRadii.some(e=>e>0)}isUniform(){return this._nodeRadius>0&&this._vertexRadii==null||this._vertexRadii!=null&&this._vertexRadii[0]==this._vertexRadii[1]&&this._vertexRadii[1]==this._vertexRadii[2]&&this._vertexRadii[2]==this._vertexRadii[3]}isSimpleRoundedRect(){return this.isUniform()&&this._cornerSmoothing==0}transform(e){e.transformRect(this._rect)}contract(e){this._rect.contract(e)}expand(e){this._rect.expand1(e)}adjustCornerRadiiForSpread(e){if(this._vertexRadii!=null)for(let r=0,n=this.vertexRadii().length;r<n;r=r+1)this._vertexRadii[r]!=0&&(this._vertexRadii[r]=Math.max(this._vertexRadii[r]+e,0));else this._nodeRadius!=0&&(this._nodeRadius=Math.max(this._nodeRadius+e,0))}},Gr;(i=>{function t(){return x.new2()}i.FrozenRect_new1=t;function e(a){return a}i.FrozenRect_new2=e;function r(a){return x.new3(a)}i.FrozenRect_new3=r;function n(a,s,l,c){return new x(a,s,l,c)}i.FrozenRect_new4=n,i.FrozenRect_EMPTY=t()})(Gr||(Gr={}));var X=class t{constructor(e,r,n,o,i,a){this._m00=0,this._m01=0,this._m02=0,this._m10=0,this._m11=0,this._m12=0,this._m00=e,this._m01=r,this._m02=n,this._m10=o,this._m11=i,this._m12=a}m00(){return this._m00}m01(){return this._m01}m02(){return this._m02}m10(){return this._m10}m11(){return this._m11}m12(){return this._m12}setM00(e){this._m00=e}setM01(e){this._m01=e}setM02(e){this._m02=e}setM10(e){this._m10=e}setM11(e){this._m11=e}setM12(e){this._m12=e}axisX(){return new O(this.m00(),this.m10())}axisY(){return new O(this.m01(),this.m11())}clone(){return new t(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12())}toAngle(){return Math.atan2(-this.m01(),this.m00())}scale1(){return new O(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}hasPerpendicularAxes(e){return Math.abs(this.m00()*this.m10()+this.m01()*this.m11())<e}isAxisAligned(e){return Math.abs(this.m00())<e&&Math.abs(this.m11())<e||Math.abs(this.m01())<e&&Math.abs(this.m10())<e}isAxisAlignedScaleInvariant(e){let r=Math.sqrt(this._m00*this._m00+this._m10*this._m10)*e,n=Math.sqrt(this._m01*this._m01+this._m11*this._m11)*e;return Math.abs(this.m00())<r&&Math.abs(this.m11())<n||Math.abs(this.m01())<r&&Math.abs(this.m10())<n}valueEquals(e,r){return e==r||isNaN(e)&&isNaN(r)}equals1(e){return this.valueEquals(this._m00,e.m00())&&this.valueEquals(this._m01,e.m01())&&this.valueEquals(this._m02,e.m02())&&this.valueEquals(this._m10,e.m10())&&this.valueEquals(this._m11,e.m11())&&this.valueEquals(this._m12,e.m12())}equals2(e,r){return Math.abs(this._m00-e.m00())<r&&Math.abs(this._m01-e.m01())<r&&Math.abs(this._m02-e.m02())<r&&Math.abs(this._m10-e.m10())<r&&Math.abs(this._m11-e.m11())<r&&Math.abs(this._m12-e.m12())<r}translation(){return new O(this._m02,this._m12)}translate1(e){this.translate2(e.x(),e.y())}translate2(e,r){this._m02+=e*this.m00()+r*this.m01(),this._m12+=e*this.m10()+r*this.m11()}preTranslate(e){this._m02+=e.x(),this._m12+=e.y()}translatedBy1(e){return this.translate1(e),this}translatedBy2(e,r){return this.translate2(e,r),this}rotatedBy(e){return this.rotate(e),this}rotate(e){let r=Math.sin(e),n=Math.cos(e),o=n*this.m00()+r*this.m01(),i=n*this.m01()-r*this.m00(),a=n*this.m10()+r*this.m11(),s=n*this.m11()-r*this.m10();this._m00=o,this._m01=i,this._m10=a,this._m11=s}scale2(e){this.scale4(e,e)}scale3(e){this.scale4(e.x(),e.y())}scale4(e,r){this._m00*=e,this._m01*=r,this._m10*=e,this._m11*=r}skewX(e){let r=Math.tan(e);this._m01+=this._m00*r,this._m11+=this._m10*r}skewY(e){let r=Math.tan(e);this._m00+=this._m01*r,this._m10+=this._m10*r}scaledBy1(e){return this.scale3(e),this}scaledBy2(e){return this.scale2(e),this}scaledBy3(e,r){return this.scale4(e,r),this}multiply(e){let r=this.m00()*e.m00()+this.m01()*e.m10(),n=this.m00()*e.m01()+this.m01()*e.m11(),o=this.m00()*e.m02()+this.m01()*e.m12()+this.m02(),i=this.m10()*e.m00()+this.m11()*e.m10(),a=this.m10()*e.m01()+this.m11()*e.m11(),s=this.m10()*e.m02()+this.m11()*e.m12()+this.m12();this._m00=r,this._m01=n,this._m02=o,this._m10=i,this._m11=a,this._m12=s}rightMultiply(e){this.multiply(e)}leftMultiply(e){let r=this.m00()*e.m00()+this.m10()*e.m01(),n=this.m01()*e.m00()+this.m11()*e.m01(),o=this.m02()*e.m00()+this.m12()*e.m01()+e.m02(),i=this.m00()*e.m10()+this.m10()*e.m11(),a=this.m01()*e.m10()+this.m11()*e.m11(),s=this.m02()*e.m10()+this.m12()*e.m11()+e.m12();this._m00=r,this._m01=n,this._m02=o,this._m10=i,this._m11=a,this._m12=s}multipliedBy1(e){return this.multiply(e),this}multipliedBy2(e){return this.multipliedBy1(yt.FrozenAffineTransform_new6(e))}determinant(){return this.m00()*this.m11()-this.m01()*this.m10()}invert(){let e=1/this.determinant();if(!isFinite(e))return!1;let r=this.m11()*e,n=-this.m01()*e,o=(this.m01()*this.m12()-this.m11()*this.m02())*e,i=-this.m10()*e,a=this.m00()*e,s=(this.m10()*this.m02()-this.m00()*this.m12())*e;return this._m00=r,this._m01=n,this._m02=o,this._m10=i,this._m11=a,this._m12=s,!0}inverse(){let e=this.clone(),r=e.invert();return e}transformPoint(e){let r=this.m00()*e.x()+this.m01()*e.y()+this.m02(),n=this.m10()*e.x()+this.m11()*e.y()+this.m12();return e.setX(r),e.setY(n),e}transformPoints(e){for(let r=0,n=e.length;r<n;r=r+1){let o=e[r],i=this.m00()*o.x()+this.m01()*o.y()+this.m02(),a=this.m10()*o.x()+this.m11()*o.y()+this.m12();o.setX(i),o.setY(a)}return e}transformDirection(e){let r=this.m00()*e.x()+this.m01()*e.y(),n=this.m10()*e.x()+this.m11()*e.y();return e.setX(r),e.setY(n),e}transformRect(e){if(e.isInvalid())return e.copyFrom(x.INVALID);if(!e.isFinite())return e.copyFrom(x.INFINITE);let r=new Et;return r.include2(this.transformPoint(e.topLeft())),r.include2(this.transformPoint(e.topRight())),r.include2(this.transformPoint(e.bottomLeft())),r.include2(this.transformPoint(e.bottomRight())),r.buildTo(e),e}setTo(e,r,n,o,i,a){return this._m00=e,this._m01=r,this._m02=n,this._m10=o,this._m11=i,this._m12=a,this}copyFrom(e){return this._m00=e.m00(),this._m01=e.m01(),this._m02=e.m02(),this._m10=e.m10(),this._m11=e.m11(),this._m12=e.m12(),this}postTranslate(e){let r=t.new2();r.translate1(e),this.leftMultiply(r)}postRotate(e){let r=t.new2();r.rotate(e),this.leftMultiply(r)}postScale(e){let r=t.new2();r.scale3(e),this.leftMultiply(r)}offset(){return new O(this.m02(),this.m12())}toString(){return`AffineTransform(${this.m00()}, ${this.m01()}, ${this.m02()}, ${this.m10()}, ${this.m11()}, ${this.m12()})`}static new2(){return new t(1,0,0,0,1,0)}static new3(e){return new t(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12())}static new4(e){return new t(e.scale(),0,e.offset().x(),0,e.scale(),e.offset().y())}static translated(e,r){let n=t.new2();return n.translate2(e,r),n}static forRotationAboutPoint(e,r){let n=t.translated(r.x(),r.y());return n.rotate(e),n.translate1(r.negative()),n}},yt;(s=>{function t(){return X.new2()}s.FrozenAffineTransform_new1=t;function e(l){return l}s.FrozenAffineTransform_new2=e;function r(l){return X.new3(l)}s.FrozenAffineTransform_new3=r;function n(l,c,d,u,p,_){return new X(l,c,d,u,p,_)}s.FrozenAffineTransform_new4=n;function o(l){return X.new4(l)}s.FrozenAffineTransform_new5=o;function i(l){return X.new4(l)}s.FrozenAffineTransform_new6=i,s.FrozenAffineTransform_IDENTITY=t()})(yt||(yt={}));var bg=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},Sl=class{constructor(e,r,n,o){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=o,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){let r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,r}_skip(e){return this._offset+=e,this}_scan(e,r=0){let n=this._offset,o=0;for(;this._dataView.getUint8(this._offset)!==r&&o<e;)o++,this._offset++;return o<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,o)}};var jU=new Uint8Array([0]),Co=[171,75,84,88,32,50,48,187,13,10,26,10];function OC(t){return new TextDecoder().decode(t)}function bC(t){let e=new Uint8Array(t.buffer,t.byteOffset,Co.length);if(e[0]!==Co[0]||e[1]!==Co[1]||e[2]!==Co[2]||e[3]!==Co[3]||e[4]!==Co[4]||e[5]!==Co[5]||e[6]!==Co[6]||e[7]!==Co[7]||e[8]!==Co[8]||e[9]!==Co[9]||e[10]!==Co[10]||e[11]!==Co[11])throw new Error("Missing KTX 2.0 identifier.");let r=new bg,n=17*Uint32Array.BYTES_PER_ELEMENT,o=new Sl(t,Co.length,n,!0);r.vkFormat=o._nextUint32(),r.typeSize=o._nextUint32(),r.pixelWidth=o._nextUint32(),r.pixelHeight=o._nextUint32(),r.pixelDepth=o._nextUint32(),r.layerCount=o._nextUint32(),r.faceCount=o._nextUint32();let i=o._nextUint32();r.supercompressionScheme=o._nextUint32();let a=o._nextUint32(),s=o._nextUint32(),l=o._nextUint32(),c=o._nextUint32(),d=o._nextUint64(),u=o._nextUint64(),p=i*3*8,_=new Sl(t,Co.length+n,p,!0);for(let k=0;k<i;k++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+_._nextUint64(),_._nextUint64()),uncompressedByteLength:_._nextUint64()});let h=new Sl(t,a,s,!0),A={vendorId:h._skip(4)._nextUint16(),descriptorType:h._nextUint16(),versionNumber:h._nextUint16(),descriptorBlockSize:h._nextUint16(),colorModel:h._nextUint8(),colorPrimaries:h._nextUint8(),transferFunction:h._nextUint8(),flags:h._nextUint8(),texelBlockDimension:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],bytesPlane:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],samples:[]},S=(A.descriptorBlockSize/4-6)/4;for(let k=0;k<S;k++){let z={bitOffset:h._nextUint16(),bitLength:h._nextUint8(),channelType:h._nextUint8(),samplePosition:[h._nextUint8(),h._nextUint8(),h._nextUint8(),h._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};z.channelType&64?(z.sampleLower=h._nextInt32(),z.sampleUpper=h._nextInt32()):(z.sampleLower=h._nextUint32(),z.sampleUpper=h._nextUint32()),A.samples[k]=z}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(A);let R=new Sl(t,l,c,!0);for(;R._offset<c;){let k=R._nextUint32(),z=R._scan(k),q=OC(z);if(r.keyValue[q]=R._nextUint8Array(k-z.byteLength-1),q.match(/^ktx/i)){let j=OC(r.keyValue[q]);r.keyValue[q]=j.substring(0,j.lastIndexOf("\0"))}let Y=k%4?4-k%4:0;R._skip(Y)}if(u<=0)return r;let E=new Sl(t,d,u,!0),P=E._nextUint16(),T=E._nextUint16(),f=E._nextUint32(),y=E._nextUint32(),v=E._nextUint32(),w=E._nextUint32(),I=[];for(let k=0;k<i;k++)I.push({imageFlags:E._nextUint32(),rgbSliceByteOffset:E._nextUint32(),rgbSliceByteLength:E._nextUint32(),alphaSliceByteOffset:E._nextUint32(),alphaSliceByteLength:E._nextUint32()});let C=d+E._offset,L=C+f,B=L+y,V=B+v,b=new Uint8Array(t.buffer,t.byteOffset+C,f),D=new Uint8Array(t.buffer,t.byteOffset+L,y),U=new Uint8Array(t.buffer,t.byteOffset+B,v),H=new Uint8Array(t.buffer,t.byteOffset+V,w);return r.globalData={endpointCount:P,selectorCount:T,imageDescs:I,endpointsData:b,selectorsData:D,tablesData:U,extendedData:H},r}var N_=class{seconds(){return ml.Performance_now(Mn().performance)/1e3}milliseconds(){return ml.Performance_now(Mn().performance)}constructor(){}};var Uo=class{constructor(){this._seconds=0}reset(){this._seconds=0}advanceSeconds(e){this._seconds+=e}setCurrentTime(e){this._seconds=e/1e3}seconds(){return this._seconds}milliseconds(){return this._seconds*1e3}},Xd=class{seconds(){return Xe.seconds()}milliseconds(){return Xe.milliseconds()}},Xe;(a=>{function t(s){a._implementations.push(s)}a.dangerouslyPushMockTime=t;function e(){if(a._implementations.length==1)throw new Error("Popping last time implementation");ie.List_removeLast(a._implementations)}a.popMockTime=e;function r(){return ie.List_last(a._implementations).seconds()}a.seconds=r;function n(){return ie.List_last(a._implementations).milliseconds()}a.milliseconds=n;function o(s){let l=r(),c=r();for(;c-l<s;)c=r()}a.spin=o,a._implementations=[new N_]})(Xe||(Xe={}));var Ng=class{constructor(e){this._byteLength=0,this._cachedPx=null,this._cachedFrameIdx=null,this._byteLength=e,this._cachedPx=new Uint8Array(this._byteLength)}save(e,r){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(this._cachedPx.set(r),this._cachedFrameIdx=new pe(e))}saveEmpty(e){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(e!=0&&we("Saving empty frame for idx \u2260 0"),this._cachedPx.fill(0),this._cachedFrameIdx=new pe(e))}getLastNonDisposedFrame(){return this._cachedFrameIdx==null&&we("Attempting to get cached non-disposed frame while cache index has not been set"),this._cachedPx}},Li=class Li{constructor(e){this._width=0,this._height=0,this._frameCount=0,this._loopCount=0,this._currentLoop=0,this._frameByteLength=0,this._buf=null,this._frameInfos=null,this._startedPlayingMs=-1,this._currentFrame=-1,this._desiredFrameStartTimeMs=0,this._currentFramePx=null,this._prevDisposal=0,this._needPreviousFrame=!1,this._previousFrameCache=null,this._width=e.width,this._height=e.height,this._frameCount=e.frameCount,this._loopCount=e.loopCount,this._frameByteLength=this._width*this._height*4,this._buf=e.buf,this._frameInfos=e.frameInfos,this._currentFramePx=new Uint8Array(this._frameByteLength),this._needPreviousFrame=e.needLastNonDisposed,this._needPreviousFrame&&(this._previousFrameCache=new Ng(this._frameByteLength)),this._timeSource=new Xd}width(){return this._width}height(){return this._height}frameCount(){return this._frameCount}loopCount(){return this._loopCount}loopsForever(){return this._loopCount==0}frameInfo(e){return(e<0||e>=this._frameInfos.length)&&Li.fail("Frame index out of range."),this._frameInfos[e]}_shouldAdvance(){if(!this.loopsForever()&&this._currentFrame==this._frameCount-1&&(this._loopCount==-1||this._loopCount==this._currentLoop))return Li.ShouldAdvance.NO;if(this._startedPlayingMs<0)return this._startedPlayingMs=this._timeSource.milliseconds(),Li.ShouldAdvance.ONCE;let e=this.loopsForever()?Li.ShouldAdvance.UNTIL_CAUGHT_UP:Li.ShouldAdvance.ONCE;return this._timeSource.milliseconds()-this._startedPlayingMs>=this._desiredFrameStartTimeMs?e:Li.ShouldAdvance.NO}_advanceFrame(){this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=Ft.int_remainder(this._currentFrame,this._frameCount));let e=this.frameInfo(this._currentFrame).delay*10;return e<=10&&(e=100),this._desiredFrameStartTimeMs+=e,this._blitFrame()}nextFrameIfNecessary(){let e=this._shouldAdvance();if(e==Li.ShouldAdvance.NO)return null;let r=this._timeSource.milliseconds(),n=this._advanceFrame();if(e==Li.ShouldAdvance.UNTIL_CAUGHT_UP)for(;this._shouldAdvance()!=Li.ShouldAdvance.NO;){if(this._timeSource.milliseconds()-r>=16){this._desiredFrameStartTimeMs=this._timeSource.milliseconds()+this.frameInfo(this._currentFrame).delay*10-this._startedPlayingMs;break}n=this._advanceFrame()}return n}nextFrameForTesting(){return this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=Ft.int_remainder(this._currentFrame,this._frameCount)),this._blitFrame()}setAutoplay(e){this.replaceTimeSource(e?new Xd:new Uo)}replaceTimeSource(e){let r=this._timeSource;return this._timeSource=e,this.restart(),r}restart(){this._startedPlayingMs=-1,this._desiredFrameStartTimeMs=0,this._currentFrame=-1,this._currentLoop=0}toString(){let e=o=>"["+o.map(i=>`${i}`).join(", ")+"]",r=this._loopCount==0?"infinite":`${this._loopCount}`,n=this._frameInfos.map(o=>o.disposal);return ie.List_removeDuplicates(n),`GIF
 size: ${this._width} x ${this._height}
 loopCount: ${r}
 frameCount: ${this._frameCount}
 disposals: ${e(n)}`}_forEachRowIndexPairInSubrect(e,r){for(let n=e.y,o=e.y+e.height;n<o;n=n+1){let i=this.width()*4*n;r(i+e.x*4,i+(e.x+e.width)*4)}}_clearLastFrameToBackground(){let e=this._currentFrame>0?this._frameInfos[this._currentFrame-1]:null;e==null||e.width==this.width()&&e.height==this.height()?this._currentFramePx.fill(0):this._forEachRowIndexPairInSubrect(e,(r,n)=>{this._currentFramePx.subarray(r,n).fill(0)})}_blitFrame(){let e=this._frameInfos[this._currentFrame];if(this._currentFrame==0)this._clearLastFrameToBackground();else switch(this._prevDisposal){case 0:case 1:break;case 2:{this._clearLastFrameToBackground();break}case 3:{let h=this._currentFrame>0?this._currentFrame-1:this._frameCount-1,A=this._frameInfos[h],m=this._previousFrameCache.getLastNonDisposedFrame();A==null||m==null?this._clearLastFrameToBackground():A.width==this.width()&&A.height==this.height()?this._currentFramePx.set(m):this._forEachRowIndexPairInSubrect(A,(g,S)=>{let R=this._currentFramePx.subarray(g,S),E=m.subarray(g,S);R.set(E)});break}default:{console.error(`Disposal flag ${this._prevDisposal} not recognized`);break}}let r=e.width*e.height,n=new Uint8Array(r);this._LZWOutputIndexStream(this._buf,e.dataOffset,n,r);let o=e.paletteOffset,i=e.transparentIndex,a=e.width,s=this.width()-a,l=a,c=(e.y*this.width()+e.x)*4,d=((e.y+e.height)*this.width()-(this.width()-e.width-e.x))*4,u=c,p=s*4;e.interlaced&&(p=p+this.width()*4*7);let _=8;for(let h=0,A=n.length;h<A;h=h+1){let m=n[h];if(l==0&&(u=u+p,l=a,u>=d&&(p=s*4+this.width()*4*(_-1),u=c+(a+s)*(_<<1),_>>=1)),m==i)u=u+4;else{let g=this._buf[o+m*3],S=this._buf[o+m*3+1],R=this._buf[o+m*3+2];this._currentFramePx[u++]=g,this._currentFramePx[u++]=S,this._currentFramePx[u++]=R,this._currentFramePx[u++]=255}l=l-1}return this._prevDisposal=e.disposal,this._needPreviousFrame&&(this._prevDisposal<2?this._previousFrameCache.save(this._currentFrame,this._currentFramePx):this._currentFrame==0&&this._previousFrameCache.saveEmpty(this._currentFrame)),this._currentFramePx}_LZWOutputIndexStream(e,r,n,o){let i=e[r++],a=1<<i,s=a+1,l=s+1,c=i+1,d=(1<<c)-1,u=0,p=0,_=0,h=e[r++],A=new Int32Array(4096),m=-1;for(;;){for(;u<16&&h!=0;)p|=e[r++]<<u,u=u+8,h==1?h=e[r++]:h=h-1;if(u<c)break;let g=p&d;if(p>>=c,u=u-c,g==a){l=s+1,c=i+1,d=(1<<c)-1,m=-1;continue}else if(g==s)break;let S=g<l?g:m,R=0,E=S;for(;E>a;)E=A[E]>>8,R=R+1;let P=E;if(_+R+(S!=g?1:0)>o){console.warn("Warning, gif stream longer than expected.");return}n[_++]=P,_=_+R;let f=_;for(S!=g&&(n[_++]=P),E=S;(R=R-1)- -1!=0;)E=A[E],n[f=f-1]=E&255,E>>=8;m!=-1&&l<4096&&(A[l++]=m<<8|P,l>=d+1&&c<12&&(c=c+1,d=d<<1|1)),m=g}if(_!=o){console.warn("Warning, gif stream shorter than expected.");return}}decodedSize(){return this._buf.length}static fail(e){throw new Error(e)}};Li.DEBUG_LOG=!1;var Gn=Li;(n=>{let t;(s=>(s[s.ONCE=0]="ONCE",s[s.UNTIL_CAUGHT_UP=1]="UNTIL_CAUGHT_UP",s[s.NO=2]="NO"))(t=n.ShouldAdvance||(n.ShouldAdvance={}));class e{constructor(i,a,s,l,c,d,u){this.width=i,this.height=a,this.frameCount=s,this.loopCount=l,this.buf=c,this.frameInfos=d,this.needLastNonDisposed=u}}n.DecodeResult=e;class r{toString(){return`Frame [x=${this.x}, y=${this.y}] [w=${this.width}, h=${this.height}] [delay=${this.delay}] [localPalette=${this.hasLocalPalette}] [interlaced=${this.interlaced}]`}constructor(i,a,s,l,c,d,u,p,_,h,A,m,g){this.x=i,this.y=a,this.width=s,this.height=l,this.hasLocalPalette=c,this.paletteOffset=d,this.paletteSize=u,this.dataOffset=p,this.dataLength=_,this.transparentIndex=h,this.interlaced=A,this.delay=m,this.disposal=g}}n.Frame=r})(Gn||(Gn={}));function NC(){let t,e,n={promise:new Promise((o,i)=>{t=o,e=i}),resolve:o=>{n.status="resolved",n.result=o,t(o)},reject:o=>{n.status="rejected",n.error=o,e(o)},status:"pending"};return n}var Pg=class{constructor(){this.onMessage=e=>{if(this.pendingWAFVerification&&e.data==="waf-successful"){if(this.pendingWAFVerification.type==="challenge"){let{deferred:r,iframe:n}=this.pendingWAFVerification;this.pendingWAFVerification=void 0,r.resolve(),n.remove()}window.removeEventListener("message",this.onMessage)}}}waitForWAFValidation(e){if(this.pendingWAFVerification)return this.pendingWAFVerification.deferred.promise;let r=NC();if(e==="challenge"){let n=document.createElement("iframe");return n.src=`${window.location.origin}/waf-validation`,n.id="waf-iframe",document.body.appendChild(n),window.addEventListener("message",this.onMessage),this.pendingWAFVerification={type:"challenge",deferred:r,iframe:n},r.promise}else if(e==="captcha")throw new Error("Unhandled")}},PC=new Pg;function FC(t){if(!t.responseURL||!t.responseURL.startsWith(window.location.origin))return null;let e=t.getResponseHeader("x-amzn-waf-action");return e?e==="challenge"?"challenge":"captcha":null}var Zd=class{constructor(e){this.status=e}},wC,xC,Vo=class{constructor(e){this.currentUserId=(xC=(wC=Mn().INITIAL_OPTIONS)==null?void 0:wC.user_data)==null?void 0:xC.id;this._url=e,this._method=null,this._headers=new Map,this._state=0,this._format=0,this._progressCallback=null,this._xhr=new XMLHttpRequest,this._formData=null,this._blob=null}state(){return this._state}get(e={handleWAFChallenge:!0}){return e.handleWAFChallenge?this.sendWithWaf("GET"):this.tryOnce("GET")}put(){return this.sendWithWaf("PUT")}head(){return this.sendWithWaf("HEAD")}setProgressCallback(e){this._progressCallback=e}header(e,r){return this._headers.set(e,r),this}userIdHeader(){return this._headers.set("X-Figma-User-ID",this.currentUserId??""),this}format(e){return this._format=e,this}send1(e,r,n){if(!1)return this.sendWithWaf(e);if(zd==3){this._blob=r;for(let o of Array.from(n.keys()))this._headers.set(o,n.get(o));return this.sendWithWaf(e)}else throw new Error("unimplemented")}send2(e,r){if(!1)return this.sendWithWaf(e);if(zd==3)return this._blob=r,this.sendWithWaf(e);throw new Error("unimplemented")}async sendWithWaf(e){var o;let r=await this.tryOnce(e);return!_n&&!xr()&&r.wafChallenge&&(this._state=0,await((o=PC)==null?void 0:o.waitForWAFValidation(r.wafChallenge)),r=await this.tryOnce(e)),r}async tryOnce(e){if(!1)return new Promise((r,n)=>{if(DC==null){n(new Zd(0));return}let o=DC(this._url);if(o==200){let i=new P_;i.url=this._url,i.status=200,r(i)}else n(new Zd(o))});if(zd==3){this._xhr.open(e,this._url);let r=null,n=null,o=new Promise((i,a)=>{r=i,n=a});o.then(null,i=>{this.cancel()});for(let i of Array.from(this._headers.keys()))this._xhr.setRequestHeader(i,this._headers.get(i));switch(this._format){case 1:{this._xhr.responseType="arraybuffer";break}}return this._xhr.onload=()=>{if(this._state==2)return;let i=new P_;switch(i.url=this._url,i.status=this._xhr.status,i.contentType=this._xhr.getResponseHeader("Content-Type"),i.wafChallenge=FC(this._xhr),this._format){case 0:{i.text=this._xhr.response;break}case 1:{i.bytes=new Uint8Array(this._xhr.response);break}}r(i)},this._xhr.onprogress=i=>{this._state!=2&&this._progressCallback!=null&&i.lengthComputable&&this._progressCallback(i.loaded/i.total)},this._xhr.onloadend=()=>{n(new Zd(this._xhr.status))},this._formData!=null?this._xhr.send(this._formData):this._xhr.send(this._blob),this._state=1,o}else throw new Error("unimplemented")}cancel(){if(!0)if(zd==3)this._state==1&&this._xhr.abort(),(this._state==0||this._state==1)&&(this._state=2);else throw new Error("unimplemented")}},P_=class{mimeType(){let e=this.contentType!=null?this.contentType.indexOf(";"):-1;return e!=-1?this.contentType.slice(0,e):this.contentType}wasSuccessful(){return this.status>=200&&this.status<=299}constructor(){this.status=0,this.contentType=null,this.text=null,this.bytes=null,this.url=null,this.wafChallenge=null}};var DC=null;var Fg;(e=>{function t(r,n){let o=Array.from(r);return Wr(o,Array.from(n)),new Uint8Array(o)}e.concat=t})(Fg||(Fg={}));var LC;(e=>{function t(r,n){if(r.byteLength!=n.byteLength)return!1;for(let o=0,i=r.byteLength;o<i;o=o+1)if(r[o]!=n[o])return!1;return!0}e.Uint8Array_equals=t})(LC||(LC={}));var F_;(e=>{function t(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}e.DataView_new1=t})(F_||(F_={}));var D_;(u=>{function t(p,_){if(_.value+1>p.length)return null;let h=new pe(p[_.value]);return _.value=_.value+1,h}u._read8=t;function e(p,_,h){if(_.value+2>p.length)return null;let A=p[_.value],m=p[_.value+1];return _.value=_.value+2,new pe(h==1?A|m<<8:m|A<<8)}u._read16=e;function r(p,_,h){if(_.value+2>p.length)return null;let A=p[_.value],m=p[_.value+1],g=p[_.value+2],S=p[_.value+3];return _.value=_.value+4,new pe(h==1?A|m<<8|g<<16|S<<24:S|g<<8|m<<16|A<<24)}u._read32=r;function n(p){let _=[255,216,255];if(p.length<_.length)return null;for(let A=0,m=_.length;A<m;A=A+1)if(_[A]!=p[A])return null;let h=new pe(2);for(;h.value+4<=p.length;){let A=e(p,h,0);if(A==null||A.value>>8!=255)return null;let m=e(p,h,0);if(m==null||m.value<2)return null;if(h.value=h.value-2,A.value==65505){let g=o(p,h.value);if(g!=null)return g}h.value=h.value+m.value}return null}u.readFromJPEG=n;function o(p,_){let h=new pe(_),A=e(p,h,0);if(A==null||A.value<6)return null;let m=r(p,h,0);if(m==null||m.value!=1165519206)return null;let g=e(p,h,0);if(g==null||g.value!=0)return null;let S=r(p,h,0);if(S==null||S.value!=1229531648&&S.value!=1296891946)return null;let E=S.value==1229531648?1:0,P=r(p,h,E);if(P==null)return null;h.value=h.value+P.value-8;let T=e(p,h,E);if(T==null)return null;let f=T.value,y=-1;for(let v=0;v<f;v=v+1){let w=e(p,h,E);if(w==null)break;let I=w.value,C=e(p,h,E);if(C==null)break;let L=C.value,B=r(p,h,E);if(B==null)break;let V=B.value,b=new pe(h.value);if(h.value=h.value+4,!(I!=u.EXIF_TAG_ORIENTATION||V!=1)){if(L==u.EXIF_FORMAT_BYTE){let D=t(p,b);if(D==null)return null;y=D.value}else if(L==u.EXIF_FORMAT_SHORT){let D=e(p,b,E);if(D==null)return null;y=D.value}else if(L==u.EXIF_FORMAT_LONG||L==u.EXIF_FORMAT_SLONG){let D=r(p,b,E);if(D==null)return null;y=D.value}else continue;switch(y){case 1:return new pe(0);case 6:return new pe(1);case 3:return new pe(2);case 8:return new pe(3);case 2:return new pe(4);case 5:return new pe(5);case 4:return new pe(6);case 7:return new pe(7)}}}return null}u._decodeExifOrientation=o;let i;(h=>(h[h.BIG=0]="BIG",h[h.LITTLE=1]="LITTLE"))(i=u.Endianness||(u.Endianness={})),u.EXIF_TAG_ORIENTATION=274,u.EXIF_FORMAT_BYTE=1,u.EXIF_FORMAT_SHORT=3,u.EXIF_FORMAT_LONG=4,u.EXIF_FORMAT_SLONG=9})(D_||(D_={}));var Jd;(r=>{function t(n){switch(n){case 0:case 4:return 0;case 1:case 5:return 90;case 2:case 6:return 180;case 3:case 7:return 270;default:return 0}}r.ImageOrientation_rotationDegrees=t;function e(n){return n==4||n==5||n==6||n==7}r.ImageOrientation_shouldFlip=e})(Jd||(Jd={}));var jd;(C=>{function t(L){return L<0?0:L>255?255:L}C._clip=t;function e(L){return t(L+64>>7)}C._CF=e;function r(L,B){let V=0,b=L[B+4]<<11,D=L[B+6],U=L[B+2],H=L[B+1],k=L[B+7],z=L[B+5],q=L[B+3],Y=0;if((b|D|U|H|k|z|q)==0){let j=L[B]<<3;L[B]=j,L[B+1]=j,L[B+2]=j,L[B+3]=j,L[B+4]=j,L[B+5]=j,L[B+6]=j,L[B+7]=j;return}V=(L[B]<<11)+128,Y=C._W7*(H+k),H=Y+(C._W1-C._W7)*H,k=Y-(C._W1+C._W7)*k,Y=C._W3*(z+q),z=Y-(C._W3-C._W5)*z,q=Y-(C._W3+C._W5)*q,Y=V+b,V=V-b,b=C._W6*(U+D),D=b-(C._W2+C._W6)*D,U=b+(C._W2-C._W6)*U,b=H+z,H=H-z,z=k+q,k=k-q,q=Y+U,Y=Y-U,U=V+D,V=V-D,D=181*(H+k)+128>>8,H=181*(H-k)+128>>8,L[B]=q+b>>8,L[B+1]=U+D>>8,L[B+2]=V+H>>8,L[B+3]=Y+z>>8,L[B+4]=Y-z>>8,L[B+5]=V-H>>8,L[B+6]=U-D>>8,L[B+7]=q-b>>8}C._rowInverseDCT=r;function n(L,B,V,b,D){let U=0,H=L[B+8*4]<<8,k=L[B+8*6],z=L[B+8*2],q=L[B+8*1],Y=L[B+8*7],j=L[B+8*5],ae=L[B+8*3],xe=0;if((H|k|z|q|Y|j|ae)==0){let Je=t((L[B]+32>>6)+128);for(let We=8;We!=0;We=We-1)V[b]=Je,b=b+D;return}U=(L[B]<<8)+8192,xe=C._W7*(q+Y)+4,q=xe+(C._W1-C._W7)*q>>3,Y=xe-(C._W1+C._W7)*Y>>3,xe=C._W3*(j+ae)+4,j=xe-(C._W3-C._W5)*j>>3,ae=xe-(C._W3+C._W5)*ae>>3,xe=U+H,U=U-H,H=C._W6*(z+k)+4,k=H-(C._W2+C._W6)*k>>3,z=H+(C._W2-C._W6)*z>>3,H=q+j,q=q-j,j=Y+ae,Y=Y-ae,ae=xe+z,xe=xe-z,z=U+k,U=U-k,k=181*(q+Y)+128>>8,q=181*(q-Y)+128>>8,V[b]=t((ae+H>>14)+128),b=b+D,V[b]=t((z+k>>14)+128),b=b+D,V[b]=t((U+q>>14)+128),b=b+D,V[b]=t((xe+j>>14)+128),b=b+D,V[b]=t((xe-j>>14)+128),b=b+D,V[b]=t((U-q>>14)+128),b=b+D,V[b]=t((z-k>>14)+128),b=b+D,V[b]=t((ae-H>>14)+128)}C._colInverseDCT=n;let o;(U=>(U[U.OK=0]="OK",U[U.NO_JPEG=1]="NO_JPEG",U[U.UNSUPPORTED=2]="UNSUPPORTED",U[U.SYNTAX_ERROR=3]="SYNTAX_ERROR",U[U.FINISHED=4]="FINISHED"))(o=C.Result||(C.Result={}));class i{upsampleH(){let B=this.width-3,V=0,b=0,D=new Uint8Array(this.width*this.height*2);for(let U=this.height;U!=0;U=U-1){D[b]=e(C._CF2A*this.pixels[V]+C._CF2B*this.pixels[V+1]),D[b+1]=e(C._CF3X*this.pixels[V]+C._CF3Y*this.pixels[V+1]+C._CF3Z*this.pixels[V+2]),D[b+2]=e(C._CF3A*this.pixels[V]+C._CF3B*this.pixels[V+1]+C._CF3C*this.pixels[V+2]);for(let H=0;H<B;H=H+1)D[b+H*2+3]=e(C._CF4A*this.pixels[V+H]+C._CF4B*this.pixels[V+H+1]+C._CF4C*this.pixels[V+H+2]+C._CF4D*this.pixels[V+H+3]),D[b+H*2+4]=e(C._CF4D*this.pixels[V+H]+C._CF4C*this.pixels[V+H+1]+C._CF4B*this.pixels[V+H+2]+C._CF4A*this.pixels[V+H+3]);V=V+this.stride,b=b+this.width*2,D[b+-3]=e(C._CF3A*this.pixels[V-1]+C._CF3B*this.pixels[V-2]+C._CF3C*this.pixels[V-3]),D[b+-2]=e(C._CF3X*this.pixels[V-1]+C._CF3Y*this.pixels[V-2]+C._CF3Z*this.pixels[V-3]),D[b+-1]=e(C._CF2A*this.pixels[V-1]+C._CF2B*this.pixels[V-2])}this.width<<=1,this.stride=this.width,this.pixels=D}upsampleV(){let B=this.width,V=this.stride,b=V+V,D=new Uint8Array(this.width*this.height*2);for(let U=0;U<B;U=U+1){let H=U,k=U;D[k]=e(C._CF2A*this.pixels[H]+C._CF2B*this.pixels[H+V]),k=k+B,D[k]=e(C._CF3X*this.pixels[H]+C._CF3Y*this.pixels[H+V]+C._CF3Z*this.pixels[H+b]),k=k+B,D[k]=e(C._CF3A*this.pixels[H]+C._CF3B*this.pixels[H+V]+C._CF3C*this.pixels[H+b]),k=k+B,H=H+V;for(let z=this.height-3;z!=0;z=z-1)D[k]=e(C._CF4A*this.pixels[H+-V]+C._CF4B*this.pixels[H]+C._CF4C*this.pixels[H+V]+C._CF4D*this.pixels[H+b]),k=k+B,D[k]=e(C._CF4D*this.pixels[H+-V]+C._CF4C*this.pixels[H]+C._CF4B*this.pixels[H+V]+C._CF4A*this.pixels[H+b]),k=k+B,H=H+V;H=H+V,D[k]=e(C._CF3A*this.pixels[H]+C._CF3B*this.pixels[H-V]+C._CF3C*this.pixels[H-b]),k=k+B,D[k]=e(C._CF3X*this.pixels[H]+C._CF3Y*this.pixels[H-V]+C._CF3Z*this.pixels[H-b]),k=k+B,D[k]=e(C._CF2A*this.pixels[H]+C._CF2B*this.pixels[H-V])}this.height<<=1,this.stride=this.width,this.pixels=D}constructor(){this.id=0,this.ssx=0,this.ssy=0,this.width=0,this.height=0,this.stride=0,this.quantizationTableIndex=0,this.acTableIndex=0,this.dcTableIndex=0,this.dcPred=0,this.pixels=null}}C.Component=i;class a{constructor(){}}C.Stop=a;let s;(q=>(q[q.NONE=0]="NONE",q[q.ROTATE_0=1]="ROTATE_0",q[q.FLIP_ROTATE_0=2]="FLIP_ROTATE_0",q[q.ROTATE_180=3]="ROTATE_180",q[q.FLIP_ROTATE_180=4]="FLIP_ROTATE_180",q[q.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",q[q.ROTATE_90=6]="ROTATE_90",q[q.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",q[q.ROTATE_270=8]="ROTATE_270"))(s=C.Orientation||(C.Orientation={}));class l{constructor(){this._bitBuffer=0,this._bitCount=0,this._block=new Int32Array(64),this._bytes=null,this._componentCount=0,this._components=[],this._error=0,this._exifOrientation=1,this._height=0,this._heightInMacroBlocks=0,this._huffmanTable=[],this._length=0,this._macroBlockSizeX=0,this._macroBlockSizeY=0,this._offset=0,this._quantizationTable=[],this._restartInterval=0,this._rgb=null,this._size=0,this._width=0,this._widthInMacroBlocks=0,this._getVLC_code=0;for(let B=0;B<4;B=B+1)this._quantizationTable.push(new Uint8Array(64)),this._huffmanTable.push(new Uint16Array(65536)),this._components.push(new i)}_throw(B){throw this._error=B,new a}_showBits(B){if(B==0)return 0;for(;this._bitCount<B;){if(this._size<=0){this._bitBuffer=this._bitBuffer<<8|255,this._bitCount=this._bitCount+8;continue}let V=this._bytes[this._offset];if(this._offset=this._offset+1,this._size=this._size-1,this._bitCount=this._bitCount+8,this._bitBuffer=this._bitBuffer<<8|V,V==255){this._size==0&&this._throw(3);let b=this._bytes[this._offset];this._offset=this._offset+1,this._size=this._size-1,b==217?this._size=0:b!=0&&b!=255&&((b&248)!=208&&this._throw(3),this._bitBuffer=this._bitBuffer<<8|b,this._bitCount=this._bitCount+8)}}return this._bitBuffer>>this._bitCount-B&(1<<B)-1}_skipBits(B){this._bitCount<B&&this._showBits(B),this._bitCount=this._bitCount-B}_getBits(B){let V=this._showBits(B);return this._skipBits(B),V}_byteAlign(){this._bitCount&=248}_skip(B){this._offset=this._offset+B,this._size=this._size-B,this._length=this._length-B,this._size<0&&this._throw(3)}_decodeBig16(B){return this._bytes[B]<<8|this._bytes[B+1]}_decodeBig32(B){return this._bytes[B]<<24|this._bytes[B+1]<<16|this._bytes[B+2]<<8|this._bytes[B+3]}_decode16(B,V){return V==l.Endianness.LITTLE?this._bytes[B]|this._bytes[B+1]<<8:this._decodeBig16(B)}_decode32(B,V){return V==l.Endianness.LITTLE?this._bytes[B]|this._bytes[B+1]<<8|this._bytes[B+2]<<16|this._bytes[B+3]<<24:this._decodeBig32(B)}_decodeLength(){this._size<2&&this._throw(3),this._length=this._decodeBig16(this._offset),this._length>this._size&&this._throw(3),this._skip(2)}_skipMarker(){this._decodeLength(),this._skip(this._length)}_decodeSOF(){let B=0,V=0,b=null;this._decodeLength(),this._length<9&&this._throw(3),this._bytes[this._offset]!=8&&this._throw(2),this._height=this._decodeBig16(this._offset+1),this._width=this._decodeBig16(this._offset+3),this._componentCount=this._bytes[this._offset+5],this._skip(6),this._componentCount!=1&&this._componentCount!=3&&this._throw(2),this._length<this._componentCount*3&&this._throw(3);for(let D=0;D<this._componentCount;D=D+1)b=this._components[D],b.id=this._bytes[this._offset],b.ssx=this._bytes[this._offset+1]>>4,b.ssy=this._bytes[this._offset+1]&15,b.quantizationTableIndex=this._bytes[this._offset+2],(b.ssx==0||b.ssy==0||(b.quantizationTableIndex&252)!=0)&&this._throw(3),((b.ssx&b.ssx-1)!=0||(b.ssy&b.ssy-1)!=0)&&this._throw(2),this._skip(3),b.ssx>B&&(B=b.ssx),b.ssy>V&&(V=b.ssy);this._componentCount==1&&(b=this._components[0],b.ssx=b.ssy=B=V=1),this._macroBlockSizeX=B<<3,this._macroBlockSizeY=V<<3,this._widthInMacroBlocks=(this._width+this._macroBlockSizeX-1)/this._macroBlockSizeX|0,this._heightInMacroBlocks=(this._height+this._macroBlockSizeY-1)/this._macroBlockSizeY|0;for(let D=0;D<this._componentCount;D=D+1)b=this._components[D],b.width=(this._width*b.ssx+B-1)/B|0,b.height=(this._height*b.ssy+V-1)/V|0,b.stride=this._widthInMacroBlocks*this._macroBlockSizeX*b.ssx/B|0,(b.width<3&&b.ssx!=B||b.height<3&&b.ssy!=V)&&this._throw(2),b.pixels=new Uint8Array(b.stride*(this._heightInMacroBlocks*this._macroBlockSizeY*b.ssy/V|0));this._rgb=new Uint8Array(this._width*this._height*3),this._skip(this._length)}_decodeDHT(){for(this._decodeLength();this._length>=17;){let B=this._bytes[this._offset];(B&236)!=0&&this._throw(3),(B&2)!=0&&this._throw(2),B=(B|B>>3)&3;let V=new Uint8Array(16);for(let k=1;k<=16;k=k+1)V[k-1]=this._bytes[this._offset+k];this._skip(17);let b=this._huffmanTable[B],D=0,U=65536,H=65536;for(let k=1;k<=16;k=k+1){H>>=1;let z=V[k-1];if(z!=0){this._length<z&&this._throw(3),U=U-(z<<16-k),U<0&&this._throw(3);for(let q=0;q<z;q=q+1){let Y=this._bytes[this._offset+q];for(let j=H;j!=0;j=j-1)D<65536&&(b[D]=k<<8|Y,D=D+1)}this._skip(z)}}for(;U!=0;)U=U-1,D<65536&&(b[D]=b[D]&65280,D=D+1)}this._length!=0&&this._throw(3)}_decodeDQT(){for(this._decodeLength();this._length>=65;){let B=this._bytes[this._offset];(B&252)!=0&&this._throw(3);let V=this._quantizationTable[B];for(let b=0;b<64;b=b+1)V[b]=this._bytes[this._offset+b+1];this._skip(65)}this._length!=0&&this._throw(3)}_decodeDRI(){this._decodeLength(),this._length<2&&this._throw(3),this._restartInterval=this._decodeBig16(this._offset),this._skip(this._length)}_getVLC(B){let V=this._showBits(16),b=B[V]>>8;return b==0&&this._throw(3),this._skipBits(b),V=B[V]&255,this._getVLC_code=V,b=V&15,b==0?0:(V=this._getBits(b),V<1<<b-1&&(V=V+((-1<<b)+1)),V)}_decodeBlock(B,V){let b=0;for(this._block=new Int32Array(64),B.dcPred=B.dcPred+this._getVLC(this._huffmanTable[B.dcTableIndex]),this._block[0]=B.dcPred*this._quantizationTable[B.quantizationTableIndex][0];b<63;){let D=this._getVLC(this._huffmanTable[B.acTableIndex]);if(this._getVLC_code==0)break;(this._getVLC_code&15)==0&&this._getVLC_code!=240&&this._throw(3),b=b+((this._getVLC_code>>4)+1),b>63&&this._throw(3),this._block[C._zigZagTable[b]]=D*this._quantizationTable[B.quantizationTableIndex][b]}for(let D=0;D<64;D=D+8)r(this._block,D);for(let D=0;D<8;D=D+1)n(this._block,D,B.pixels,V+D,B.stride)}_decodeScan(){let B=this._restartInterval,V=0;this._decodeLength(),this._length<4+2*this._componentCount&&this._throw(3),this._bytes[this._offset]!=this._componentCount&&this._throw(2),this._skip(1);for(let b=0;b<this._componentCount;b=b+1){let D=this._components[b];this._bytes[this._offset]!=D.id&&this._throw(3),(this._bytes[this._offset+1]&238)!=0&&this._throw(3),D.dcTableIndex=this._bytes[this._offset+1]>>4,D.acTableIndex=this._bytes[this._offset+1]&1|2,this._skip(2)}(this._bytes[this._offset]!=0||this._bytes[this._offset+1]!=63||this._bytes[this._offset+2]!=0)&&this._throw(2),this._skip(this._length);for(let b=0;b<this._heightInMacroBlocks;b=b+1)for(let D=0;D<this._widthInMacroBlocks;D=D+1){if((D!=0||b!=0)&&this._restartInterval!=0&&(B=B-1,B==0)){this._byteAlign();let U=this._getBits(16);((U&65528)!=65488||(U&7)!=V)&&this._throw(3),V=V+1&7,B=this._restartInterval;for(let H=0;H<4;H=H+1)this._components[H].dcPred=0}for(let U=0;U<this._componentCount;U=U+1){let H=this._components[U];for(let k=0;k<H.ssy;k=k+1)for(let z=0;z<H.ssx;z=z+1)this._decodeBlock(H,(b*H.ssy+k)*H.stride+D*H.ssx+z<<3)}}this._error=4}_decodeEXIF(){if(this._decodeLength(),this._length<6||this._decodeBig32(this._offset)!=1165519206||this._decodeBig16(this._offset+4)!=0){this._skip(this._length);return}this._skip(6);let B=this._offset;this._length<8&&this._throw(3);let V=this._decodeBig32(B),b=V==1229531648?l.Endianness.LITTLE:l.Endianness.BIG;b==l.Endianness.BIG&&V!=1296891946&&this._throw(3);let D=274,U=1,H=3,k=4,z=9,q=B+this._decode32(B+4,b),Y=this._decode16(q,b);q=q+2;for(let j=0,ae=Y;j<ae;j=j+1){let xe=this._decode16(q,b),Je=this._decode16(q+2,b),We=this._decode32(q+4,b);if(q=q+8,xe==D&&We==1){this._exifOrientation=0,Je==U?this._exifOrientation=this._bytes[q]:Je==H?this._exifOrientation=this._decode16(q,b):(Je==k||Je==z)&&(this._exifOrientation=this._decode32(q,b)),(this._exifOrientation<1||this._exifOrientation>8)&&(this._exifOrientation=1);break}q=q+4}this._skip(this._length)}_convert(){for(let b=0;b<this._componentCount;b=b+1){let D=this._components[b];for(;D.width<this._width||D.height<this._height;)D.width<this._width&&D.upsampleH(),D.height<this._height&&D.upsampleV()}let B=this._components[0],V=this._rgb;if(this._componentCount==1){let b=0,D=0;for(let U=this._height;U!=0;U=U-1){for(let H=0;H<this._width;H=H+1){let k=B.pixels[D+H];V[b]=k,V[b+1]=k,V[b+2]=k,b=b+3}D=D+B.stride}}else{let b=this._components[1],D=this._components[2],U=0,H=0,k=0,z=0;for(let q=this._height;q!=0;q=q-1){for(let Y=0;Y<this._width;Y=Y+1){let j=B.pixels[H+Y]<<8,ae=b.pixels[k+Y]-128,xe=D.pixels[z+Y]-128;V[U]=t(j+359*xe+128>>8),V[U+1]=t(j-88*ae-183*xe+128>>8),V[U+2]=t(j+454*ae+128>>8),U=U+3}H=H+B.stride,k=k+b.stride,z=z+D.stride}}}_orient(){if(this._exifOrientation==1)return;let B=this._width,V=this._height,b=this._exifOrientation>=5,D=b?V:B,U=b?B:V,H=this._rgb,k=new Uint8Array(D*U*3);for(let z=0,q=0;z<V;z=z+1){let Y=0,j=0;switch(this._exifOrientation){case 2:{Y=z*D+D-1,j=-1;break}case 3:{Y=(V-z-1)*D+D-1,j=-1;break}case 4:{Y=(V-z-1)*D,j=1;break}case 5:{Y=z,j=D;break}case 6:{Y=V-z-1,j=D;break}case 7:{Y=V-z-1+D*(U-1),j=-D;break}case 8:{Y=z+D*(U-1),j=-D;break}}Y=Y*3,j=j*3;for(let ae=0;ae<B;ae=ae+1,q=q+3)k[Y]=H[q],k[Y+1]=H[q+1],k[Y+2]=H[q+2],Y=Y+j}this._width=D,this._height=U,this._rgb=k}decodeBytes(B){try{for(this._bytes=B,this._offset=0,this._size=B.length,(this._size<2||this._bytes[0]!=255||this._bytes[1]!=216)&&this._throw(1),this._skip(2);this._error==0;){(this._size<2||this._bytes[this._offset]!=255)&&this._throw(3),this._skip(2);let V=this._bytes[this._offset-1];V==192?this._decodeSOF():V==196?this._decodeDHT():V==219?this._decodeDQT():V==221?this._decodeDRI():V==218?this._decodeScan():V==225?this._decodeEXIF():V==254?this._skipMarker():(V&240)==224?this._skipMarker():this._throw(2)}this._error!=4?this._error=3:(this._convert(),this._orient(),this._error=0)}catch{}return this._error}width(){return this._width}height(){return this._height}rgb(){return this._rgb}}C.Decoder=l,(B=>{let L;(D=>(D[D.BIG=0]="BIG",D[D.LITTLE=1]="LITTLE"))(L=B.Endianness||(B.Endianness={}))})(l=C.Decoder||(C.Decoder={})),C._zigZagTable=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],C._W1=2841,C._W2=2676,C._W3=2408,C._W5=1609,C._W6=1108,C._W7=565,C._CF4A=-9,C._CF4B=111,C._CF4C=29,C._CF4D=-3,C._CF3A=28,C._CF3B=109,C._CF3C=-9,C._CF3X=104,C._CF3Y=27,C._CF3Z=-3,C._CF2A=139,C._CF2B=-11})(jd||(jd={}));var Un=class{constructor(){this._state=0,this._promise=null,this._resolve=null,this._reject=null,this._promise=new Promise((e,r)=>{this._resolve=e,this._reject=r})}realPromise(){return this._promise}then1(e){this.then2(e,null)}then2(e,r){this._promise.then(e,r)}resolve(e){return this._state==0&&(this._state=1,this._resolve(e)),this}reject(e){return this._state==0&&(this._state=2,this._error=e,this._reject(e)),this}state(){return this._state}},w_=class w_{constructor(){}};w_.VOID=new w_;var vs=w_;function x_(t){Promise.resolve(vs.VOID).then(e=>{t()})}var Al=class{elapsedSeconds(){return Xe.seconds()-this._start}reset(){this._start=Xe.seconds()}constructor(){this._start=Xe.seconds()}};var Tl=class t{constructor(e){this._worker=null,this._queue=[],this._workerFailedToDownload=!1,this.onmessage=null,this.mainThreadFallback=null;let r=()=>{this._workerFailedToDownload=!0,this.mainThreadFallback!=null&&console.warn(`failed to download worker code from ${e}, falling back to running it on the main thread (this is slower)`);for(let n of this._queue)this.postMessage2(n.message,n.transfer)};new Vo(e).get({handleWAFChallenge:!1}).then(n=>{if(n.wasSuccessful()){try{this._worker=new Worker(URL.createObjectURL(new Blob([n.text])))}catch{r();return}this._worker.onmessage=o=>{this.onmessage!=null&&this.onmessage(o)};for(let o of this._queue)this.postMessage2(o.message,o.transfer)}else r()},n=>{r()})}postMessage1(e){this.postMessage2(e,null)}postMessage2(e,r){this._workerFailedToDownload?this.mainThreadFallback!=null&&this.onmessage!=null&&setTimeout(()=>{this.onmessage({data:this.mainThreadFallback(e)})},0):this._worker==null?this._queue.push(new t.Item(e,r)):r!=null?this._worker.postMessage(e,r):this._worker.postMessage(e)}};(e=>{class t{constructor(n,o){this.message=n,this.transfer=o}}e.Item=t})(Tl||(Tl={}));function Cc(t){let e=t.length;for(;--e>=0;)t[e]=0}var TD=0,TO=1,ED=2,ID=3,RD=258,tS=29,_u=256,iu=_u+1+tS,Rc=30,rS=19,EO=2*iu+1,El=15,Dg=16,yD=7,nS=256,IO=16,RO=17,yO=18,Yg=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),V_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),vD=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),vO=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),CD=512,Xa=new Array((iu+2)*2);Cc(Xa);var ru=new Array(Rc*2);Cc(ru);var au=new Array(CD);Cc(au);var su=new Array(RD-ID+1);Cc(su);var oS=new Array(tS);Cc(oS);var k_=new Array(Rc);Cc(k_);function wg(t,e,r,n,o){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=o,this.has_stree=t&&t.length}var CO,OO,bO;function xg(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}var NO=t=>t<256?au[t]:au[256+(t>>>7)],lu=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},ko=(t,e,r)=>{t.bi_valid>Dg-r?(t.bi_buf|=e<<t.bi_valid&65535,lu(t,t.bi_buf),t.bi_buf=e>>Dg-t.bi_valid,t.bi_valid+=r-Dg):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},Ta=(t,e,r)=>{ko(t,r[e*2],r[e*2+1])},PO=(t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},OD=t=>{t.bi_valid===16?(lu(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},bD=(t,e)=>{let r=e.dyn_tree,n=e.max_code,o=e.stat_desc.static_tree,i=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,l=e.stat_desc.max_length,c,d,u,p,_,h,A=0;for(p=0;p<=El;p++)t.bl_count[p]=0;for(r[t.heap[t.heap_max]*2+1]=0,c=t.heap_max+1;c<EO;c++)d=t.heap[c],p=r[r[d*2+1]*2+1]+1,p>l&&(p=l,A++),r[d*2+1]=p,!(d>n)&&(t.bl_count[p]++,_=0,d>=s&&(_=a[d-s]),h=r[d*2],t.opt_len+=h*(p+_),i&&(t.static_len+=h*(o[d*2+1]+_)));if(A!==0){do{for(p=l-1;t.bl_count[p]===0;)p--;t.bl_count[p]--,t.bl_count[p+1]+=2,t.bl_count[l]--,A-=2}while(A>0);for(p=l;p!==0;p--)for(d=t.bl_count[p];d!==0;)u=t.heap[--c],!(u>n)&&(r[u*2+1]!==p&&(t.opt_len+=(p-r[u*2+1])*r[u*2],r[u*2+1]=p),d--)}},FO=(t,e,r)=>{let n=new Array(El+1),o=0,i,a;for(i=1;i<=El;i++)o=o+r[i-1]<<1,n[i]=o;for(a=0;a<=e;a++){let s=t[a*2+1];s!==0&&(t[a*2]=PO(n[s]++,s))}},ND=()=>{let t,e,r,n,o,i=new Array(El+1);for(r=0,n=0;n<tS-1;n++)for(oS[n]=r,t=0;t<1<<Yg[n];t++)su[r++]=n;for(su[r-1]=n,o=0,n=0;n<16;n++)for(k_[n]=o,t=0;t<1<<V_[n];t++)au[o++]=n;for(o>>=7;n<Rc;n++)for(k_[n]=o<<7,t=0;t<1<<V_[n]-7;t++)au[256+o++]=n;for(e=0;e<=El;e++)i[e]=0;for(t=0;t<=143;)Xa[t*2+1]=8,t++,i[8]++;for(;t<=255;)Xa[t*2+1]=9,t++,i[9]++;for(;t<=279;)Xa[t*2+1]=7,t++,i[7]++;for(;t<=287;)Xa[t*2+1]=8,t++,i[8]++;for(FO(Xa,iu+1,i),t=0;t<Rc;t++)ru[t*2+1]=5,ru[t*2]=PO(t,5);CO=new wg(Xa,Yg,_u+1,iu,El),OO=new wg(ru,V_,0,Rc,El),bO=new wg(new Array(0),vD,0,rS,yD)},DO=t=>{let e;for(e=0;e<iu;e++)t.dyn_ltree[e*2]=0;for(e=0;e<Rc;e++)t.dyn_dtree[e*2]=0;for(e=0;e<rS;e++)t.bl_tree[e*2]=0;t.dyn_ltree[nS*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},wO=t=>{t.bi_valid>8?lu(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},MC=(t,e,r,n)=>{let o=e*2,i=r*2;return t[o]<t[i]||t[o]===t[i]&&n[e]<=n[r]},Lg=(t,e,r)=>{let n=t.heap[r],o=r<<1;for(;o<=t.heap_len&&(o<t.heap_len&&MC(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!MC(e,n,t.heap[o],t.depth));)t.heap[r]=t.heap[o],r=o,o<<=1;t.heap[r]=n},BC=(t,e,r)=>{let n,o,i=0,a,s;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+i++]&255,n+=(t.pending_buf[t.sym_buf+i++]&255)<<8,o=t.pending_buf[t.sym_buf+i++],n===0?Ta(t,o,e):(a=su[o],Ta(t,a+_u+1,e),s=Yg[a],s!==0&&(o-=oS[a],ko(t,o,s)),n--,a=NO(n),Ta(t,a,r),s=V_[a],s!==0&&(n-=k_[a],ko(t,n,s)));while(i<t.sym_next);Ta(t,nS,e)},Qg=(t,e)=>{let r=e.dyn_tree,n=e.stat_desc.static_tree,o=e.stat_desc.has_stree,i=e.stat_desc.elems,a,s,l=-1,c;for(t.heap_len=0,t.heap_max=EO,a=0;a<i;a++)r[a*2]!==0?(t.heap[++t.heap_len]=l=a,t.depth[a]=0):r[a*2+1]=0;for(;t.heap_len<2;)c=t.heap[++t.heap_len]=l<2?++l:0,r[c*2]=1,t.depth[c]=0,t.opt_len--,o&&(t.static_len-=n[c*2+1]);for(e.max_code=l,a=t.heap_len>>1;a>=1;a--)Lg(t,r,a);c=i;do a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Lg(t,r,1),s=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=s,r[c*2]=r[a*2]+r[s*2],t.depth[c]=(t.depth[a]>=t.depth[s]?t.depth[a]:t.depth[s])+1,r[a*2+1]=r[s*2+1]=c,t.heap[1]=c++,Lg(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],bD(t,e),FO(r,l,t.bl_count)},GC=(t,e,r)=>{let n,o=-1,i,a=e[0*2+1],s=0,l=7,c=4;for(a===0&&(l=138,c=3),e[(r+1)*2+1]=65535,n=0;n<=r;n++)i=a,a=e[(n+1)*2+1],!(++s<l&&i===a)&&(s<c?t.bl_tree[i*2]+=s:i!==0?(i!==o&&t.bl_tree[i*2]++,t.bl_tree[IO*2]++):s<=10?t.bl_tree[RO*2]++:t.bl_tree[yO*2]++,s=0,o=i,a===0?(l=138,c=3):i===a?(l=6,c=3):(l=7,c=4))},UC=(t,e,r)=>{let n,o=-1,i,a=e[0*2+1],s=0,l=7,c=4;for(a===0&&(l=138,c=3),n=0;n<=r;n++)if(i=a,a=e[(n+1)*2+1],!(++s<l&&i===a)){if(s<c)do Ta(t,i,t.bl_tree);while(--s!==0);else i!==0?(i!==o&&(Ta(t,i,t.bl_tree),s--),Ta(t,IO,t.bl_tree),ko(t,s-3,2)):s<=10?(Ta(t,RO,t.bl_tree),ko(t,s-3,3)):(Ta(t,yO,t.bl_tree),ko(t,s-11,7));s=0,o=i,a===0?(l=138,c=3):i===a?(l=6,c=3):(l=7,c=4)}},PD=t=>{let e;for(GC(t,t.dyn_ltree,t.l_desc.max_code),GC(t,t.dyn_dtree,t.d_desc.max_code),Qg(t,t.bl_desc),e=rS-1;e>=3&&t.bl_tree[vO[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},FD=(t,e,r,n)=>{let o;for(ko(t,e-257,5),ko(t,r-1,5),ko(t,n-4,4),o=0;o<n;o++)ko(t,t.bl_tree[vO[o]*2+1],3);UC(t,t.dyn_ltree,e-1),UC(t,t.dyn_dtree,r-1)},DD=t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(r=32;r<_u;r++)if(t.dyn_ltree[r*2]!==0)return 1;return 0},VC=!1,wD=t=>{VC||(ND(),VC=!0),t.l_desc=new xg(t.dyn_ltree,CO),t.d_desc=new xg(t.dyn_dtree,OO),t.bl_desc=new xg(t.bl_tree,bO),t.bi_buf=0,t.bi_valid=0,DO(t)},xO=(t,e,r,n)=>{ko(t,(TD<<1)+(n?1:0),3),wO(t),lu(t,r),lu(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},xD=t=>{ko(t,TO<<1,3),Ta(t,nS,Xa),OD(t)},LD=(t,e,r,n)=>{let o,i,a=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=DD(t)),Qg(t,t.l_desc),Qg(t,t.d_desc),a=PD(t),o=t.opt_len+3+7>>>3,i=t.static_len+3+7>>>3,i<=o&&(o=i)):o=i=r+5,r+4<=o&&e!==-1?xO(t,e,r,n):t.strategy===4||i===o?(ko(t,(TO<<1)+(n?1:0),3),BC(t,Xa,ru)):(ko(t,(ED<<1)+(n?1:0),3),FD(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),BC(t,t.dyn_ltree,t.dyn_dtree)),DO(t),n&&wO(t)},MD=(t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(su[r]+_u+1)*2]++,t.dyn_dtree[NO(e)*2]++),t.sym_next===t.sym_end),BD=wD,GD=xO,UD=LD,VD=MD,kD=xD,HD={_tr_init:BD,_tr_stored_block:GD,_tr_flush_block:UD,_tr_tally:VD,_tr_align:kD},zD=(t,e,r,n)=>{let o=t&65535|0,i=t>>>16&65535|0,a=0;for(;r!==0;){a=r>2e3?2e3:r,r-=a;do o=o+e[n++]|0,i=i+o|0;while(--a);o%=65521,i%=65521}return o|i<<16|0},cu=zD,WD=()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},KD=new Uint32Array(WD()),YD=(t,e,r,n)=>{let o=KD,i=n+r;t^=-1;for(let a=n;a<i;a++)t=t>>>8^o[(t^e[a])&255];return t^-1},Vn=YD,yl={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Oc={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:QD,_tr_stored_block:qg,_tr_flush_block:qD,_tr_tally:bs,_tr_align:XD}=HD,{Z_NO_FLUSH:Ns,Z_PARTIAL_FLUSH:ZD,Z_FULL_FLUSH:JD,Z_FINISH:Mi,Z_BLOCK:kC,Z_OK:to,Z_STREAM_END:HC,Z_STREAM_ERROR:Ea,Z_DATA_ERROR:jD,Z_BUF_ERROR:Mg,Z_DEFAULT_COMPRESSION:$D,Z_FILTERED:ew,Z_HUFFMAN_ONLY:L_,Z_RLE:tw,Z_FIXED:rw,Z_DEFAULT_STRATEGY:nw,Z_UNKNOWN:ow,Z_DEFLATED:W_}=Oc,iw=9,aw=15,sw=8,lw=29,cw=256,Xg=cw+1+lw,dw=30,uw=19,pw=2*Xg+1,_w=15,Jt=3,Os=258,Ia=Os+Jt+1,hw=32,yc=42,iS=57,Zg=69,Jg=73,jg=91,$g=103,Il=113,eu=666,Oo=1,bc=2,vl=3,Nc=4,mw=3,Rl=(t,e)=>(t.msg=yl[e],e),zC=t=>t*2-(t>4?9:0),Cs=t=>{let e=t.length;for(;--e>=0;)t[e]=0},fw=t=>{let e,r,n,o=t.w_size;e=t.hash_size,n=e;do r=t.head[--n],t.head[n]=r>=o?r-o:0;while(--e);e=o,n=e;do r=t.prev[--n],t.prev[n]=r>=o?r-o:0;while(--e)},gw=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask,Ps=gw,mi=t=>{let e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},fi=(t,e)=>{qD(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,mi(t.strm)},lr=(t,e)=>{t.pending_buf[t.pending++]=e},$d=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},eS=(t,e,r,n)=>{let o=t.avail_in;return o>n&&(o=n),o===0?0:(t.avail_in-=o,e.set(t.input.subarray(t.next_in,t.next_in+o),r),t.state.wrap===1?t.adler=cu(t.adler,e,o,r):t.state.wrap===2&&(t.adler=Vn(t.adler,e,o,r)),t.next_in+=o,t.total_in+=o,o)},LO=(t,e)=>{let r=t.max_chain_length,n=t.strstart,o,i,a=t.prev_length,s=t.nice_match,l=t.strstart>t.w_size-Ia?t.strstart-(t.w_size-Ia):0,c=t.window,d=t.w_mask,u=t.prev,p=t.strstart+Os,_=c[n+a-1],h=c[n+a];t.prev_length>=t.good_match&&(r>>=2),s>t.lookahead&&(s=t.lookahead);do if(o=e,!(c[o+a]!==h||c[o+a-1]!==_||c[o]!==c[n]||c[++o]!==c[n+1])){n+=2,o++;do;while(c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&n<p);if(i=Os-(p-n),n=p-Os,i>a){if(t.match_start=e,a=i,i>=s)break;_=c[n+a-1],h=c[n+a]}}while((e=u[e&d])>l&&--r!==0);return a<=t.lookahead?a:t.lookahead},vc=t=>{let e=t.w_size,r,n,o;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Ia)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),fw(t),n+=e),t.strm.avail_in===0)break;if(r=eS(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=r,t.lookahead+t.insert>=Jt)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=Ps(t,t.ins_h,t.window[o+1]);t.insert&&(t.ins_h=Ps(t,t.ins_h,t.window[o+Jt-1]),t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<Jt)););}while(t.lookahead<Ia&&t.strm.avail_in!==0)},MO=(t,e)=>{let r=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,o,i,a=0,s=t.strm.avail_in;do{if(n=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i||(i=t.strm.avail_out-i,o=t.strstart-t.block_start,n>o+t.strm.avail_in&&(n=o+t.strm.avail_in),n>i&&(n=i),n<r&&(n===0&&e!==Mi||e===Ns||n!==o+t.strm.avail_in)))break;a=e===Mi&&n===o+t.strm.avail_in?1:0,qg(t,0,0,a),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,mi(t.strm),o&&(o>n&&(o=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+o),t.strm.next_out),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o,t.block_start+=o,n-=o),n&&(eS(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(a===0);return s-=t.strm.avail_in,s&&(s>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=s&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-s,t.strm.next_in),t.strstart),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),a?Nc:e!==Ns&&e!==Mi&&t.strm.avail_in===0&&t.strstart===t.block_start?bc:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(eS(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,r=i>t.w_size?t.w_size:i,o=t.strstart-t.block_start,(o>=r||(o||e===Mi)&&e!==Ns&&t.strm.avail_in===0&&o<=i)&&(n=o>i?i:o,a=e===Mi&&t.strm.avail_in===0&&n===o?1:0,qg(t,t.block_start,n,a),t.block_start+=n,mi(t.strm)),a?vl:Oo)},Bg=(t,e)=>{let r,n;for(;;){if(t.lookahead<Ia){if(vc(t),t.lookahead<Ia&&e===Ns)return Oo;if(t.lookahead===0)break}if(r=0,t.lookahead>=Jt&&(t.ins_h=Ps(t,t.ins_h,t.window[t.strstart+Jt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-Ia&&(t.match_length=LO(t,r)),t.match_length>=Jt)if(n=bs(t,t.strstart-t.match_start,t.match_length-Jt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Jt){t.match_length--;do t.strstart++,t.ins_h=Ps(t,t.ins_h,t.window[t.strstart+Jt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Ps(t,t.ins_h,t.window[t.strstart+1]);else n=bs(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(fi(t,!1),t.strm.avail_out===0))return Oo}return t.insert=t.strstart<Jt-1?t.strstart:Jt-1,e===Mi?(fi(t,!0),t.strm.avail_out===0?vl:Nc):t.sym_next&&(fi(t,!1),t.strm.avail_out===0)?Oo:bc},Ec=(t,e)=>{let r,n,o;for(;;){if(t.lookahead<Ia){if(vc(t),t.lookahead<Ia&&e===Ns)return Oo;if(t.lookahead===0)break}if(r=0,t.lookahead>=Jt&&(t.ins_h=Ps(t,t.ins_h,t.window[t.strstart+Jt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Jt-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-Ia&&(t.match_length=LO(t,r),t.match_length<=5&&(t.strategy===ew||t.match_length===Jt&&t.strstart-t.match_start>4096)&&(t.match_length=Jt-1)),t.prev_length>=Jt&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-Jt,n=bs(t,t.strstart-1-t.prev_match,t.prev_length-Jt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=o&&(t.ins_h=Ps(t,t.ins_h,t.window[t.strstart+Jt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Jt-1,t.strstart++,n&&(fi(t,!1),t.strm.avail_out===0))return Oo}else if(t.match_available){if(n=bs(t,0,t.window[t.strstart-1]),n&&fi(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Oo}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=bs(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Jt-1?t.strstart:Jt-1,e===Mi?(fi(t,!0),t.strm.avail_out===0?vl:Nc):t.sym_next&&(fi(t,!1),t.strm.avail_out===0)?Oo:bc},Sw=(t,e)=>{let r,n,o,i,a=t.window;for(;;){if(t.lookahead<=Os){if(vc(t),t.lookahead<=Os&&e===Ns)return Oo;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Jt&&t.strstart>0&&(o=t.strstart-1,n=a[o],n===a[++o]&&n===a[++o]&&n===a[++o])){i=t.strstart+Os;do;while(n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&o<i);t.match_length=Os-(i-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Jt?(r=bs(t,1,t.match_length-Jt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=bs(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(fi(t,!1),t.strm.avail_out===0))return Oo}return t.insert=0,e===Mi?(fi(t,!0),t.strm.avail_out===0?vl:Nc):t.sym_next&&(fi(t,!1),t.strm.avail_out===0)?Oo:bc},Aw=(t,e)=>{let r;for(;;){if(t.lookahead===0&&(vc(t),t.lookahead===0)){if(e===Ns)return Oo;break}if(t.match_length=0,r=bs(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(fi(t,!1),t.strm.avail_out===0))return Oo}return t.insert=0,e===Mi?(fi(t,!0),t.strm.avail_out===0?vl:Nc):t.sym_next&&(fi(t,!1),t.strm.avail_out===0)?Oo:bc};function Aa(t,e,r,n,o){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=o}var tu=[new Aa(0,0,0,0,MO),new Aa(4,4,8,4,Bg),new Aa(4,5,16,8,Bg),new Aa(4,6,32,32,Bg),new Aa(4,4,16,16,Ec),new Aa(8,16,32,32,Ec),new Aa(8,16,128,128,Ec),new Aa(8,32,128,256,Ec),new Aa(32,128,258,1024,Ec),new Aa(32,258,258,4096,Ec)],Tw=t=>{t.window_size=2*t.w_size,Cs(t.head),t.max_lazy_match=tu[t.level].max_lazy,t.good_match=tu[t.level].good_length,t.nice_match=tu[t.level].nice_length,t.max_chain_length=tu[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Jt-1,t.match_available=0,t.ins_h=0};function Ew(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=W_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(pw*2),this.dyn_dtree=new Uint16Array((2*dw+1)*2),this.bl_tree=new Uint16Array((2*uw+1)*2),Cs(this.dyn_ltree),Cs(this.dyn_dtree),Cs(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(_w+1),this.heap=new Uint16Array(2*Xg+1),Cs(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Xg+1),Cs(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var hu=t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.status!==yc&&e.status!==iS&&e.status!==Zg&&e.status!==Jg&&e.status!==jg&&e.status!==$g&&e.status!==Il&&e.status!==eu?1:0},BO=t=>{if(hu(t))return Rl(t,Ea);t.total_in=t.total_out=0,t.data_type=ow;let e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?iS:e.wrap?yc:Il,t.adler=e.wrap===2?0:1,e.last_flush=-2,QD(e),to},GO=t=>{let e=BO(t);return e===to&&Tw(t.state),e},Iw=(t,e)=>hu(t)||t.state.wrap!==2?Ea:(t.state.gzhead=e,to),UO=(t,e,r,n,o,i)=>{if(!t)return Ea;let a=1;if(e===$D&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),o<1||o>iw||r!==W_||n<8||n>15||e<0||e>9||i<0||i>rw||n===8&&a!==1)return Rl(t,Ea);n===8&&(n=9);let s=new Ew;return t.state=s,s.strm=t,s.status=yc,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=o+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+Jt-1)/Jt),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<o+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=e,s.strategy=i,s.method=r,GO(t)},Rw=(t,e)=>UO(t,e,W_,aw,sw,nw),yw=(t,e)=>{if(hu(t)||e>kC||e<0)return t?Rl(t,Ea):Ea;let r=t.state;if(!t.output||t.avail_in!==0&&!t.input||r.status===eu&&e!==Mi)return Rl(t,t.avail_out===0?Mg:Ea);let n=r.last_flush;if(r.last_flush=e,r.pending!==0){if(mi(t),t.avail_out===0)return r.last_flush=-1,to}else if(t.avail_in===0&&zC(e)<=zC(n)&&e!==Mi)return Rl(t,Mg);if(r.status===eu&&t.avail_in!==0)return Rl(t,Mg);if(r.status===yc&&r.wrap===0&&(r.status=Il),r.status===yc){let o=W_+(r.w_bits-8<<4)<<8,i=-1;if(r.strategy>=L_||r.level<2?i=0:r.level<6?i=1:r.level===6?i=2:i=3,o|=i<<6,r.strstart!==0&&(o|=hw),o+=31-o%31,$d(r,o),r.strstart!==0&&($d(r,t.adler>>>16),$d(r,t.adler&65535)),t.adler=1,r.status=Il,mi(t),r.pending!==0)return r.last_flush=-1,to}if(r.status===iS){if(t.adler=0,lr(r,31),lr(r,139),lr(r,8),r.gzhead)lr(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),lr(r,r.gzhead.time&255),lr(r,r.gzhead.time>>8&255),lr(r,r.gzhead.time>>16&255),lr(r,r.gzhead.time>>24&255),lr(r,r.level===9?2:r.strategy>=L_||r.level<2?4:0),lr(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(lr(r,r.gzhead.extra.length&255),lr(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=Vn(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=Zg;else if(lr(r,0),lr(r,0),lr(r,0),lr(r,0),lr(r,0),lr(r,r.level===9?2:r.strategy>=L_||r.level<2?4:0),lr(r,mw),r.status=Il,mi(t),r.pending!==0)return r.last_flush=-1,to}if(r.status===Zg){if(r.gzhead.extra){let o=r.pending,i=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+i>r.pending_buf_size;){let s=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>o&&(t.adler=Vn(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex+=s,mi(t),r.pending!==0)return r.last_flush=-1,to;o=0,i-=s}let a=new Uint8Array(r.gzhead.extra);r.pending_buf.set(a.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending+=i,r.gzhead.hcrc&&r.pending>o&&(t.adler=Vn(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex=0}r.status=Jg}if(r.status===Jg){if(r.gzhead.name){let o=r.pending,i;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(t.adler=Vn(t.adler,r.pending_buf,r.pending-o,o)),mi(t),r.pending!==0)return r.last_flush=-1,to;o=0}r.gzindex<r.gzhead.name.length?i=r.gzhead.name.charCodeAt(r.gzindex++)&255:i=0,lr(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(t.adler=Vn(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex=0}r.status=jg}if(r.status===jg){if(r.gzhead.comment){let o=r.pending,i;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(t.adler=Vn(t.adler,r.pending_buf,r.pending-o,o)),mi(t),r.pending!==0)return r.last_flush=-1,to;o=0}r.gzindex<r.gzhead.comment.length?i=r.gzhead.comment.charCodeAt(r.gzindex++)&255:i=0,lr(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(t.adler=Vn(t.adler,r.pending_buf,r.pending-o,o))}r.status=$g}if(r.status===$g){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(mi(t),r.pending!==0))return r.last_flush=-1,to;lr(r,t.adler&255),lr(r,t.adler>>8&255),t.adler=0}if(r.status=Il,mi(t),r.pending!==0)return r.last_flush=-1,to}if(t.avail_in!==0||r.lookahead!==0||e!==Ns&&r.status!==eu){let o=r.level===0?MO(r,e):r.strategy===L_?Aw(r,e):r.strategy===tw?Sw(r,e):tu[r.level].func(r,e);if((o===vl||o===Nc)&&(r.status=eu),o===Oo||o===vl)return t.avail_out===0&&(r.last_flush=-1),to;if(o===bc&&(e===ZD?XD(r):e!==kC&&(qg(r,0,0,!1),e===JD&&(Cs(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),mi(t),t.avail_out===0))return r.last_flush=-1,to}return e!==Mi?to:r.wrap<=0?HC:(r.wrap===2?(lr(r,t.adler&255),lr(r,t.adler>>8&255),lr(r,t.adler>>16&255),lr(r,t.adler>>24&255),lr(r,t.total_in&255),lr(r,t.total_in>>8&255),lr(r,t.total_in>>16&255),lr(r,t.total_in>>24&255)):($d(r,t.adler>>>16),$d(r,t.adler&65535)),mi(t),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?to:HC)},vw=t=>{if(hu(t))return Ea;let e=t.state.status;return t.state=null,e===Il?Rl(t,jD):to},Cw=(t,e)=>{let r=e.length;if(hu(t))return Ea;let n=t.state,o=n.wrap;if(o===2||o===1&&n.status!==yc||n.lookahead)return Ea;if(o===1&&(t.adler=cu(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){o===0&&(Cs(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(r-n.w_size,r),0),e=l,r=n.w_size}let i=t.avail_in,a=t.next_in,s=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,vc(n);n.lookahead>=Jt;){let l=n.strstart,c=n.lookahead-(Jt-1);do n.ins_h=Ps(n,n.ins_h,n.window[l+Jt-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--c);n.strstart=l,n.lookahead=Jt-1,vc(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Jt-1,n.match_available=0,t.next_in=a,t.input=s,t.avail_in=i,n.wrap=o,to},Ow=Rw,bw=UO,Nw=GO,Pw=BO,Fw=Iw,Dw=yw,ww=vw,xw=Cw,Lw="pako deflate (from Nodeca project)",nu={deflateInit:Ow,deflateInit2:bw,deflateReset:Nw,deflateResetKeep:Pw,deflateSetHeader:Fw,deflate:Dw,deflateEnd:ww,deflateSetDictionary:xw,deflateInfo:Lw},Mw=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Bw=function(t){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let r=e.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let n in r)Mw(r,n)&&(t[n]=r[n])}}return t},Gw=t=>{let e=0;for(let n=0,o=t.length;n<o;n++)e+=t[n].length;let r=new Uint8Array(e);for(let n=0,o=0,i=t.length;n<i;n++){let a=t[n];r.set(a,o),o+=a.length}return r},K_={assign:Bw,flattenChunks:Gw},VO=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{VO=!1}var du=new Uint8Array(256);for(let t=0;t<256;t++)du[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;du[254]=du[254]=1;var Uw=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,n,o,i,a=t.length,s=0;for(o=0;o<a;o++)r=t.charCodeAt(o),(r&64512)===55296&&o+1<a&&(n=t.charCodeAt(o+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),o++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(s),i=0,o=0;i<s;o++)r=t.charCodeAt(o),(r&64512)===55296&&o+1<a&&(n=t.charCodeAt(o+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),o++)),r<128?e[i++]=r:r<2048?(e[i++]=192|r>>>6,e[i++]=128|r&63):r<65536?(e[i++]=224|r>>>12,e[i++]=128|r>>>6&63,e[i++]=128|r&63):(e[i++]=240|r>>>18,e[i++]=128|r>>>12&63,e[i++]=128|r>>>6&63,e[i++]=128|r&63);return e},Vw=(t,e)=>{if(e<65534&&t.subarray&&VO)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r},kw=(t,e)=>{let r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let n,o,i=new Array(r*2);for(o=0,n=0;n<r;){let a=t[n++];if(a<128){i[o++]=a;continue}let s=du[a];if(s>4){i[o++]=65533,n+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&n<r;)a=a<<6|t[n++]&63,s--;if(s>1){i[o++]=65533;continue}a<65536?i[o++]=a:(a-=65536,i[o++]=55296|a>>10&1023,i[o++]=56320|a&1023)}return Vw(i,o)},Hw=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)===128;)r--;return r<0||r===0?e:r+du[t[r]]>e?r:e},uu={string2buf:Uw,buf2string:kw,utf8border:Hw};function zw(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var kO=zw,HO=Object.prototype.toString,{Z_NO_FLUSH:Ww,Z_SYNC_FLUSH:Kw,Z_FULL_FLUSH:Yw,Z_FINISH:Qw,Z_OK:H_,Z_STREAM_END:qw,Z_DEFAULT_COMPRESSION:Xw,Z_DEFAULT_STRATEGY:Zw,Z_DEFLATED:Jw}=Oc;function mu(t){this.options=K_.assign({level:Xw,method:Jw,chunkSize:16384,windowBits:15,memLevel:8,strategy:Zw},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kO,this.strm.avail_out=0;let r=nu.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==H_)throw new Error(yl[r]);if(e.header&&nu.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=uu.string2buf(e.dictionary):HO.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,r=nu.deflateSetDictionary(this.strm,n),r!==H_)throw new Error(yl[r]);this._dict_set=!0}}mu.prototype.push=function(t,e){let r=this.strm,n=this.options.chunkSize,o,i;if(this.ended)return!1;for(e===~~e?i=e:i=e===!0?Qw:Ww,typeof t=="string"?r.input=uu.string2buf(t):HO.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(i===Kw||i===Yw)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(o=nu.deflate(r,i),o===qw)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),o=nu.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===H_;if(r.avail_out===0){this.onData(r.output);continue}if(i>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};mu.prototype.onData=function(t){this.chunks.push(t)};mu.prototype.onEnd=function(t){t===H_&&(this.result=K_.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function aS(t,e){let r=new mu(e);if(r.push(t,!0),r.err)throw r.msg||yl[r.err];return r.result}function jw(t,e){return e=e||{},e.raw=!0,aS(t,e)}function $w(t,e){return e=e||{},e.gzip=!0,aS(t,e)}var ex=mu,tx=aS,rx=jw,nx=$w,ox=Oc,ix={Deflate:ex,deflate:tx,deflateRaw:rx,gzip:nx,constants:ox},M_=16209,ax=16191,sx=function(e,r){let n,o,i,a,s,l,c,d,u,p,_,h,A,m,g,S,R,E,P,T,f,y,v,w,I=e.state;n=e.next_in,v=e.input,o=n+(e.avail_in-5),i=e.next_out,w=e.output,a=i-(r-e.avail_out),s=i+(e.avail_out-257),l=I.dmax,c=I.wsize,d=I.whave,u=I.wnext,p=I.window,_=I.hold,h=I.bits,A=I.lencode,m=I.distcode,g=(1<<I.lenbits)-1,S=(1<<I.distbits)-1;e:do{h<15&&(_+=v[n++]<<h,h+=8,_+=v[n++]<<h,h+=8),R=A[_&g];t:for(;;){if(E=R>>>24,_>>>=E,h-=E,E=R>>>16&255,E===0)w[i++]=R&65535;else if(E&16){P=R&65535,E&=15,E&&(h<E&&(_+=v[n++]<<h,h+=8),P+=_&(1<<E)-1,_>>>=E,h-=E),h<15&&(_+=v[n++]<<h,h+=8,_+=v[n++]<<h,h+=8),R=m[_&S];r:for(;;){if(E=R>>>24,_>>>=E,h-=E,E=R>>>16&255,E&16){if(T=R&65535,E&=15,h<E&&(_+=v[n++]<<h,h+=8,h<E&&(_+=v[n++]<<h,h+=8)),T+=_&(1<<E)-1,T>l){e.msg="invalid distance too far back",I.mode=M_;break e}if(_>>>=E,h-=E,E=i-a,T>E){if(E=T-E,E>d&&I.sane){e.msg="invalid distance too far back",I.mode=M_;break e}if(f=0,y=p,u===0){if(f+=c-E,E<P){P-=E;do w[i++]=p[f++];while(--E);f=i-T,y=w}}else if(u<E){if(f+=c+u-E,E-=u,E<P){P-=E;do w[i++]=p[f++];while(--E);if(f=0,u<P){E=u,P-=E;do w[i++]=p[f++];while(--E);f=i-T,y=w}}}else if(f+=u-E,E<P){P-=E;do w[i++]=p[f++];while(--E);f=i-T,y=w}for(;P>2;)w[i++]=y[f++],w[i++]=y[f++],w[i++]=y[f++],P-=3;P&&(w[i++]=y[f++],P>1&&(w[i++]=y[f++]))}else{f=i-T;do w[i++]=w[f++],w[i++]=w[f++],w[i++]=w[f++],P-=3;while(P>2);P&&(w[i++]=w[f++],P>1&&(w[i++]=w[f++]))}}else if((E&64)===0){R=m[(R&65535)+(_&(1<<E)-1)];continue r}else{e.msg="invalid distance code",I.mode=M_;break e}break}}else if((E&64)===0){R=A[(R&65535)+(_&(1<<E)-1)];continue t}else if(E&32){I.mode=ax;break e}else{e.msg="invalid literal/length code",I.mode=M_;break e}break}}while(n<o&&i<s);P=h>>3,n-=P,h-=P<<3,_&=(1<<h)-1,e.next_in=n,e.next_out=i,e.avail_in=n<o?5+(o-n):5-(n-o),e.avail_out=i<s?257+(s-i):257-(i-s),I.hold=_,I.bits=h},Ic=15,WC=852,KC=592,YC=0,Gg=1,QC=2,lx=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),cx=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dx=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ux=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),px=(t,e,r,n,o,i,a,s)=>{let l=s.bits,c=0,d=0,u=0,p=0,_=0,h=0,A=0,m=0,g=0,S=0,R,E,P,T,f,y=null,v,w=new Uint16Array(Ic+1),I=new Uint16Array(Ic+1),C=null,L,B,V;for(c=0;c<=Ic;c++)w[c]=0;for(d=0;d<n;d++)w[e[r+d]]++;for(_=l,p=Ic;p>=1&&w[p]===0;p--);if(_>p&&(_=p),p===0)return o[i++]=1<<24|64<<16|0,o[i++]=1<<24|64<<16|0,s.bits=1,0;for(u=1;u<p&&w[u]===0;u++);for(_<u&&(_=u),m=1,c=1;c<=Ic;c++)if(m<<=1,m-=w[c],m<0)return-1;if(m>0&&(t===YC||p!==1))return-1;for(I[1]=0,c=1;c<Ic;c++)I[c+1]=I[c]+w[c];for(d=0;d<n;d++)e[r+d]!==0&&(a[I[e[r+d]]++]=d);if(t===YC?(y=C=a,v=20):t===Gg?(y=lx,C=cx,v=257):(y=dx,C=ux,v=0),S=0,d=0,c=u,f=i,h=_,A=0,P=-1,g=1<<_,T=g-1,t===Gg&&g>WC||t===QC&&g>KC)return 1;for(;;){L=c-A,a[d]+1<v?(B=0,V=a[d]):a[d]>=v?(B=C[a[d]-v],V=y[a[d]-v]):(B=96,V=0),R=1<<c-A,E=1<<h,u=E;do E-=R,o[f+(S>>A)+E]=L<<24|B<<16|V|0;while(E!==0);for(R=1<<c-1;S&R;)R>>=1;if(R!==0?(S&=R-1,S+=R):S=0,d++,--w[c]===0){if(c===p)break;c=e[r+a[d]]}if(c>_&&(S&T)!==P){for(A===0&&(A=_),f+=u,h=c-A,m=1<<h;h+A<p&&(m-=w[h+A],!(m<=0));)h++,m<<=1;if(g+=1<<h,t===Gg&&g>WC||t===QC&&g>KC)return 1;P=S&T,o[P]=_<<24|h<<16|f-i|0}}return S!==0&&(o[f+S]=c-A<<24|64<<16|0),s.bits=_,0},ou=px,_x=0,zO=1,WO=2,{Z_FINISH:qC,Z_BLOCK:hx,Z_TREES:B_,Z_OK:Cl,Z_STREAM_END:mx,Z_NEED_DICT:fx,Z_STREAM_ERROR:Bi,Z_DATA_ERROR:KO,Z_MEM_ERROR:YO,Z_BUF_ERROR:gx,Z_DEFLATED:XC}=Oc,Y_=16180,ZC=16181,JC=16182,jC=16183,$C=16184,eO=16185,tO=16186,rO=16187,nO=16188,oO=16189,z_=16190,qa=16191,Ug=16192,iO=16193,Vg=16194,aO=16195,sO=16196,lO=16197,cO=16198,G_=16199,U_=16200,dO=16201,uO=16202,pO=16203,_O=16204,hO=16205,kg=16206,mO=16207,fO=16208,Yr=16209,QO=16210,qO=16211,Sx=852,Ax=592,Tx=15,Ex=Tx,gO=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function Ix(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Ol=t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.mode<Y_||e.mode>qO?1:0},XO=t=>{if(Ol(t))return Bi;let e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Y_,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Sx),e.distcode=e.distdyn=new Int32Array(Ax),e.sane=1,e.back=-1,Cl},ZO=t=>{if(Ol(t))return Bi;let e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,XO(t)},JO=(t,e)=>{let r;if(Ol(t))return Bi;let n=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Bi:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,ZO(t))},jO=(t,e)=>{if(!t)return Bi;let r=new Ix;t.state=r,r.strm=t,r.window=null,r.mode=Y_;let n=JO(t,e);return n!==Cl&&(t.state=null),n},Rx=t=>jO(t,Ex),SO=!0,Hg,zg,yx=t=>{if(SO){Hg=new Int32Array(512),zg=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ou(zO,t.lens,0,288,Hg,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ou(WO,t.lens,0,32,zg,0,t.work,{bits:5}),SO=!1}t.lencode=Hg,t.lenbits=9,t.distcode=zg,t.distbits=5},$O=(t,e,r,n)=>{let o,i=t.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(e.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(o=i.wsize-i.wnext,o>n&&(o=n),i.window.set(e.subarray(r-n,r-n+o),i.wnext),n-=o,n?(i.window.set(e.subarray(r-n,r),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=o,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=o))),0},vx=(t,e)=>{let r,n,o,i,a,s,l,c,d,u,p,_,h,A,m=0,g,S,R,E,P,T,f,y,v=new Uint8Array(4),w,I,C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ol(t)||!t.output||!t.input&&t.avail_in!==0)return Bi;r=t.state,r.mode===qa&&(r.mode=Ug),a=t.next_out,o=t.output,l=t.avail_out,i=t.next_in,n=t.input,s=t.avail_in,c=r.hold,d=r.bits,u=s,p=l,y=Cl;e:for(;;)switch(r.mode){case Y_:if(r.wrap===0){r.mode=Ug;break}for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.wrap&2&&c===35615){r.wbits===0&&(r.wbits=15),r.check=0,v[0]=c&255,v[1]=c>>>8&255,r.check=Vn(r.check,v,2,0),c=0,d=0,r.mode=ZC;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((c&255)<<8)+(c>>8))%31){t.msg="incorrect header check",r.mode=Yr;break}if((c&15)!==XC){t.msg="unknown compression method",r.mode=Yr;break}if(c>>>=4,d-=4,f=(c&15)+8,r.wbits===0&&(r.wbits=f),f>15||f>r.wbits){t.msg="invalid window size",r.mode=Yr;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=c&512?oO:qa,c=0,d=0;break;case ZC:for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.flags=c,(r.flags&255)!==XC){t.msg="unknown compression method",r.mode=Yr;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=Yr;break}r.head&&(r.head.text=c>>8&1),r.flags&512&&r.wrap&4&&(v[0]=c&255,v[1]=c>>>8&255,r.check=Vn(r.check,v,2,0)),c=0,d=0,r.mode=JC;case JC:for(;d<32;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.head&&(r.head.time=c),r.flags&512&&r.wrap&4&&(v[0]=c&255,v[1]=c>>>8&255,v[2]=c>>>16&255,v[3]=c>>>24&255,r.check=Vn(r.check,v,4,0)),c=0,d=0,r.mode=jC;case jC:for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.head&&(r.head.xflags=c&255,r.head.os=c>>8),r.flags&512&&r.wrap&4&&(v[0]=c&255,v[1]=c>>>8&255,r.check=Vn(r.check,v,2,0)),c=0,d=0,r.mode=$C;case $C:if(r.flags&1024){for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.length=c,r.head&&(r.head.extra_len=c),r.flags&512&&r.wrap&4&&(v[0]=c&255,v[1]=c>>>8&255,r.check=Vn(r.check,v,2,0)),c=0,d=0}else r.head&&(r.head.extra=null);r.mode=eO;case eO:if(r.flags&1024&&(_=r.length,_>s&&(_=s),_&&(r.head&&(f=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(i,i+_),f)),r.flags&512&&r.wrap&4&&(r.check=Vn(r.check,n,_,i)),s-=_,i+=_,r.length-=_),r.length))break e;r.length=0,r.mode=tO;case tO:if(r.flags&2048){if(s===0)break e;_=0;do f=n[i+_++],r.head&&f&&r.length<65536&&(r.head.name+=String.fromCharCode(f));while(f&&_<s);if(r.flags&512&&r.wrap&4&&(r.check=Vn(r.check,n,_,i)),s-=_,i+=_,f)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=rO;case rO:if(r.flags&4096){if(s===0)break e;_=0;do f=n[i+_++],r.head&&f&&r.length<65536&&(r.head.comment+=String.fromCharCode(f));while(f&&_<s);if(r.flags&512&&r.wrap&4&&(r.check=Vn(r.check,n,_,i)),s-=_,i+=_,f)break e}else r.head&&(r.head.comment=null);r.mode=nO;case nO:if(r.flags&512){for(;d<16;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.wrap&4&&c!==(r.check&65535)){t.msg="header crc mismatch",r.mode=Yr;break}c=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=qa;break;case oO:for(;d<32;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}t.adler=r.check=gO(c),c=0,d=0,r.mode=z_;case z_:if(r.havedict===0)return t.next_out=a,t.avail_out=l,t.next_in=i,t.avail_in=s,r.hold=c,r.bits=d,fx;t.adler=r.check=1,r.mode=qa;case qa:if(e===hx||e===B_)break e;case Ug:if(r.last){c>>>=d&7,d-=d&7,r.mode=kg;break}for(;d<3;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}switch(r.last=c&1,c>>>=1,d-=1,c&3){case 0:r.mode=iO;break;case 1:if(yx(r),r.mode=G_,e===B_){c>>>=2,d-=2;break e}break;case 2:r.mode=sO;break;case 3:t.msg="invalid block type",r.mode=Yr}c>>>=2,d-=2;break;case iO:for(c>>>=d&7,d-=d&7;d<32;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if((c&65535)!==(c>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Yr;break}if(r.length=c&65535,c=0,d=0,r.mode=Vg,e===B_)break e;case Vg:r.mode=aO;case aO:if(_=r.length,_){if(_>s&&(_=s),_>l&&(_=l),_===0)break e;o.set(n.subarray(i,i+_),a),s-=_,i+=_,l-=_,a+=_,r.length-=_;break}r.mode=qa;break;case sO:for(;d<14;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.nlen=(c&31)+257,c>>>=5,d-=5,r.ndist=(c&31)+1,c>>>=5,d-=5,r.ncode=(c&15)+4,c>>>=4,d-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Yr;break}r.have=0,r.mode=lO;case lO:for(;r.have<r.ncode;){for(;d<3;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.lens[C[r.have++]]=c&7,c>>>=3,d-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,w={bits:r.lenbits},y=ou(_x,r.lens,0,19,r.lencode,0,r.work,w),r.lenbits=w.bits,y){t.msg="invalid code lengths set",r.mode=Yr;break}r.have=0,r.mode=cO;case cO:for(;r.have<r.nlen+r.ndist;){for(;m=r.lencode[c&(1<<r.lenbits)-1],g=m>>>24,S=m>>>16&255,R=m&65535,!(g<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(R<16)c>>>=g,d-=g,r.lens[r.have++]=R;else{if(R===16){for(I=g+2;d<I;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(c>>>=g,d-=g,r.have===0){t.msg="invalid bit length repeat",r.mode=Yr;break}f=r.lens[r.have-1],_=3+(c&3),c>>>=2,d-=2}else if(R===17){for(I=g+3;d<I;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}c>>>=g,d-=g,f=0,_=3+(c&7),c>>>=3,d-=3}else{for(I=g+7;d<I;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}c>>>=g,d-=g,f=0,_=11+(c&127),c>>>=7,d-=7}if(r.have+_>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Yr;break}for(;_--;)r.lens[r.have++]=f}}if(r.mode===Yr)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=Yr;break}if(r.lenbits=9,w={bits:r.lenbits},y=ou(zO,r.lens,0,r.nlen,r.lencode,0,r.work,w),r.lenbits=w.bits,y){t.msg="invalid literal/lengths set",r.mode=Yr;break}if(r.distbits=6,r.distcode=r.distdyn,w={bits:r.distbits},y=ou(WO,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,w),r.distbits=w.bits,y){t.msg="invalid distances set",r.mode=Yr;break}if(r.mode=G_,e===B_)break e;case G_:r.mode=U_;case U_:if(s>=6&&l>=258){t.next_out=a,t.avail_out=l,t.next_in=i,t.avail_in=s,r.hold=c,r.bits=d,sx(t,p),a=t.next_out,o=t.output,l=t.avail_out,i=t.next_in,n=t.input,s=t.avail_in,c=r.hold,d=r.bits,r.mode===qa&&(r.back=-1);break}for(r.back=0;m=r.lencode[c&(1<<r.lenbits)-1],g=m>>>24,S=m>>>16&255,R=m&65535,!(g<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(S&&(S&240)===0){for(E=g,P=S,T=R;m=r.lencode[T+((c&(1<<E+P)-1)>>E)],g=m>>>24,S=m>>>16&255,R=m&65535,!(E+g<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}c>>>=E,d-=E,r.back+=E}if(c>>>=g,d-=g,r.back+=g,r.length=R,S===0){r.mode=hO;break}if(S&32){r.back=-1,r.mode=qa;break}if(S&64){t.msg="invalid literal/length code",r.mode=Yr;break}r.extra=S&15,r.mode=dO;case dO:if(r.extra){for(I=r.extra;d<I;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=uO;case uO:for(;m=r.distcode[c&(1<<r.distbits)-1],g=m>>>24,S=m>>>16&255,R=m&65535,!(g<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if((S&240)===0){for(E=g,P=S,T=R;m=r.distcode[T+((c&(1<<E+P)-1)>>E)],g=m>>>24,S=m>>>16&255,R=m&65535,!(E+g<=d);){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}c>>>=E,d-=E,r.back+=E}if(c>>>=g,d-=g,r.back+=g,S&64){t.msg="invalid distance code",r.mode=Yr;break}r.offset=R,r.extra=S&15,r.mode=pO;case pO:if(r.extra){for(I=r.extra;d<I;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Yr;break}r.mode=_O;case _O:if(l===0)break e;if(_=p-l,r.offset>_){if(_=r.offset-_,_>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Yr;break}_>r.wnext?(_-=r.wnext,h=r.wsize-_):h=r.wnext-_,_>r.length&&(_=r.length),A=r.window}else A=o,h=a-r.offset,_=r.length;_>l&&(_=l),l-=_,r.length-=_;do o[a++]=A[h++];while(--_);r.length===0&&(r.mode=U_);break;case hO:if(l===0)break e;o[a++]=r.length,l--,r.mode=U_;break;case kg:if(r.wrap){for(;d<32;){if(s===0)break e;s--,c|=n[i++]<<d,d+=8}if(p-=l,t.total_out+=p,r.total+=p,r.wrap&4&&p&&(t.adler=r.check=r.flags?Vn(r.check,o,p,a-p):cu(r.check,o,p,a-p)),p=l,r.wrap&4&&(r.flags?c:gO(c))!==r.check){t.msg="incorrect data check",r.mode=Yr;break}c=0,d=0}r.mode=mO;case mO:if(r.wrap&&r.flags){for(;d<32;){if(s===0)break e;s--,c+=n[i++]<<d,d+=8}if(r.wrap&4&&c!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=Yr;break}c=0,d=0}r.mode=fO;case fO:y=mx;break e;case Yr:y=KO;break e;case QO:return YO;case qO:default:return Bi}return t.next_out=a,t.avail_out=l,t.next_in=i,t.avail_in=s,r.hold=c,r.bits=d,(r.wsize||p!==t.avail_out&&r.mode<Yr&&(r.mode<kg||e!==qC))&&$O(t,t.output,t.next_out,p-t.avail_out),u-=t.avail_in,p-=t.avail_out,t.total_in+=u,t.total_out+=p,r.total+=p,r.wrap&4&&p&&(t.adler=r.check=r.flags?Vn(r.check,o,p,t.next_out-p):cu(r.check,o,p,t.next_out-p)),t.data_type=r.bits+(r.last?64:0)+(r.mode===qa?128:0)+(r.mode===G_||r.mode===Vg?256:0),(u===0&&p===0||e===qC)&&y===Cl&&(y=gx),y},Cx=t=>{if(Ol(t))return Bi;let e=t.state;return e.window&&(e.window=null),t.state=null,Cl},Ox=(t,e)=>{if(Ol(t))return Bi;let r=t.state;return(r.wrap&2)===0?Bi:(r.head=e,e.done=!1,Cl)},bx=(t,e)=>{let r=e.length,n,o,i;return Ol(t)||(n=t.state,n.wrap!==0&&n.mode!==z_)?Bi:n.mode===z_&&(o=1,o=cu(o,e,r,0),o!==n.check)?KO:(i=$O(t,e,r,r),i?(n.mode=QO,YO):(n.havedict=1,Cl))},Nx=ZO,Px=JO,Fx=XO,Dx=Rx,wx=jO,xx=vx,Lx=Cx,Mx=Ox,Bx=bx,Gx="pako inflate (from Nodeca project)",Za={inflateReset:Nx,inflateReset2:Px,inflateResetKeep:Fx,inflateInit:Dx,inflateInit2:wx,inflate:xx,inflateEnd:Lx,inflateGetHeader:Mx,inflateSetDictionary:Bx,inflateInfo:Gx};function Ux(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Vx=Ux,eb=Object.prototype.toString,{Z_NO_FLUSH:kx,Z_FINISH:Hx,Z_OK:pu,Z_STREAM_END:Wg,Z_NEED_DICT:Kg,Z_STREAM_ERROR:zx,Z_DATA_ERROR:AO,Z_MEM_ERROR:Wx}=Oc;function fu(t){this.options=K_.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kO,this.strm.avail_out=0;let r=Za.inflateInit2(this.strm,e.windowBits);if(r!==pu)throw new Error(yl[r]);if(this.header=new Vx,Za.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=uu.string2buf(e.dictionary):eb.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=Za.inflateSetDictionary(this.strm,e.dictionary),r!==pu)))throw new Error(yl[r])}fu.prototype.push=function(t,e){let r=this.strm,n=this.options.chunkSize,o=this.options.dictionary,i,a,s;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?Hx:kx,eb.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),i=Za.inflate(r,a),i===Kg&&o&&(i=Za.inflateSetDictionary(r,o),i===pu?i=Za.inflate(r,a):i===AO&&(i=Kg));r.avail_in>0&&i===Wg&&r.state.wrap>0&&t[r.next_in]!==0;)Za.inflateReset(r),i=Za.inflate(r,a);switch(i){case zx:case AO:case Kg:case Wx:return this.onEnd(i),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(r.avail_out===0||i===Wg))if(this.options.to==="string"){let l=uu.utf8border(r.output,r.next_out),c=r.next_out-l,d=uu.buf2string(r.output,l);r.next_out=c,r.avail_out=n-c,c&&r.output.set(r.output.subarray(l,l+c),0),this.onData(d)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(i===pu&&s===0)){if(i===Wg)return i=Za.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};fu.prototype.onData=function(t){this.chunks.push(t)};fu.prototype.onEnd=function(t){t===pu&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=K_.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function sS(t,e){let r=new fu(e);if(r.push(t),r.err)throw r.msg||yl[r.err];return r.result}function Kx(t,e){return e=e||{},e.raw=!0,sS(t,e)}var Yx=fu,Qx=sS,qx=Kx,Xx=sS,Zx=Oc,Jx={Inflate:Yx,inflate:Qx,inflateRaw:qx,ungzip:Xx,constants:Zx},{Deflate:LV,deflate:MV,deflateRaw:jx,gzip:BV}=ix,{Inflate:GV,inflate:UV,inflateRaw:$x,ungzip:VV}=Jx;var tb=jx;var rb=$x;var gi;(r=>{function t(n){return rb(n)}r.inflateRaw=t;function e(n){return tb(n)}r.deflateRaw=e})(gi||(gi={}));var lS;(n=>{class t{constructor(){}}let o=class o{_decode(a){for(this._count=a.length,this._view=F_.DataView_new1(a),(this._readInt()!=o._ID(137,80,78,71)||this._readInt()!=o._ID(13,10,26,10))&&o._fail();this._offset+12<=this._count;){let s=this._offset,l=this._readInt(),c=this._readInt(),d=s+8,u=d+l;switch(s+12+l>this._count&&(console.error("truncated png image"),o._fail()),c){case o._ID(73,72,68,82):{let p=this._readInt(),_=this._readInt(),h=this._readByte(),A=this._readByte(),m=this._readByte(),g=this._readByte(),S=this._readByte(),R=p<=0||_<=0||m!=0||g!=0||S!=0&&S!=1;if(!R)switch(A){case o.COLOR_TYPE_GRAY:{R=h!=1&&h!=2&&h!=4&&h!=8&&h!=16;break}case o.COLOR_TYPE_INDEXED:{R=h!=1&&h!=2&&h!=4&&h!=8;break}case o.COLOR_TYPE_RGB:case o.COLOR_TYPE_GRAY_ALPHA:case o.COLOR_TYPE_RGBA:{R=h!=8&&h!=16;break}default:{R=!0;break}}R&&(console.error("invalid png header"),o._fail()),this._width=p,this._height=_,this._bitDepth=h,this._colorType=A,this._isInterlaced=S==1;break}case o._ID(80,76,84,69):{this._palette=a.subarray(d,u),(l<3||l>256*3||l%3!=0)&&(console.error("invalid palette in png image"),o._fail());break}case o._ID(73,68,65,84):{this._dataStreamChunks.push(a.subarray(d,u)),this._dataStreamCount=this._dataStreamCount+l;break}case o._ID(116,82,78,83):{this._transparency=a.subarray(d,u);break}case o._ID(73,69,78,68):return n.DEBUG_LOG&&console.log(`png header: ${this._width}x${this._height}, ${this._bitDepth} bits per sample, `+new Map([[o.COLOR_TYPE_GRAY,"gray"],[o.COLOR_TYPE_RGB,"rgb"],[o.COLOR_TYPE_INDEXED,"indexed"],[o.COLOR_TYPE_GRAY_ALPHA,"gray_alpha"],[o.COLOR_TYPE_RGBA,"rgba"]]).get(this._colorType)+(this._isInterlaced?", interlaced":", non_interlaced")),this._decodeImage();default:{n.DEBUG_LOG&&console.warn(`unsupported png chunk '${pi.string_fromCodePoints([c>>>24,c>>16&255,c>>8&255,c&255])}'`);break}}this._offset=s+l+12}return o._fail(),null}_readInt(){return this._offset=this._offset+4,this._offset>this._count&&(console.error("truncated png image"),o._fail()),this._view.getInt32(this._offset-4)}_readByte(){return this._offset=this._offset+1,this._offset>this._count&&(console.error("truncated png image"),o._fail()),this._view.getUint8(this._offset-1)}_decompressStream(){let a=new Uint8Array(this._dataStreamCount),s=0;for(let c of this._dataStreamChunks)a.set(c,s),s=s+c.length;let l=null;try{l=gi.inflateRaw(a.subarray(2))}catch{console.error("invalid zip stream in png image"),o._fail()}return l}_decodeImage(){(this._width<=0||this._height<=0||this._dataStreamCount==0)&&(console.error("incomplete png image"),o._fail());let a=this._decompressStream(),s=this._colorType==o.COLOR_TYPE_GRAY_ALPHA?2:this._colorType==o.COLOR_TYPE_RGB?3:this._colorType==o.COLOR_TYPE_RGBA?4:1,l=this._bitDepth*s,c=l+7>>3,d=this._width*l+7>>3,u=new Uint8Array(d*this._height),p=0;a.length!=(d+1)*this._height&&(console.error("invalid decompressed png stream"),o._fail());for(let A=0,m=this._height;A<m;A=A+1){let g=A*d,S=g-c,R=g-d,E=R-c,P=a[p];switch(p=p+1,P){case o.FILTER_TYPE_NONE:{u.set(a.subarray(p,p+d),g),p=p+d;break}case o.FILTER_TYPE_SUB:{for(let T=0,f=d;T<f;T=T+1)u[g+T]=a[p]+(T<c?0:u[S+T]),p=p+1;break}case o.FILTER_TYPE_UP:{for(let T=0,f=d;T<f;T=T+1)u[g+T]=a[p]+(A==0?0:u[R+T]),p=p+1;break}case o.FILTER_TYPE_AVERAGE:{for(let T=0,f=d;T<f;T=T+1){let y=T<c?0:u[S+T],v=A==0?0:u[R+T];u[g+T]=a[p]+(y+v>>1),p=p+1}break}case o.FILTER_TYPE_PAETH:{for(let T=0,f=d;T<f;T=T+1){let y=T<c?0:u[S+T],v=A==0?0:u[R+T],w=T<c||A==0?0:u[E+T],I=y+v-w,C=Math.abs(I-y),L=Math.abs(I-v),B=Math.abs(I-w);u[g+T]=a[p]+(C<=L&&C<=B?y:L<=B?v:w),p=p+1}break}default:{console.error(`invalid png filter type ${P}`),o._fail();break}}}if(this._bitDepth==16){let A=new Uint8Array(u.length>>1);for(let m=0,g=A.length;m<g;m=m+1)A[m]=u[m*2];u=A,l>>=1,c>>=1,d>>=1,this._bitDepth=8}let _=this._width*this._height*4,h=s==4?u:new Uint8Array(_);switch(s){case 1:{let A=0,m=0,g=(1<<l)-1,S=g==1?255:255/g|0,R=this._colorType==o.COLOR_TYPE_INDEXED,E=this._palette,P=E!=null?E.length:0,T=this._transparency,f=T!=null?T.length:0;for(let y=0,v=this._height;y<v;y=y+1){let w=0,I=0;for(let C=0,L=this._width;C<L;C=C+1){w==0&&(I=u[A],w=8,A=A+1),w=w-l;let B=I>>w&g;if(R){let V=B*3;V>P-3&&(console.error(`invalid palette index ${B} in png image`),o._fail()),h[m]=E[V],h[m+1]=E[V+1],h[m+2]=E[V+2]}else B=B*S,h[m]=B,h[m+1]=B,h[m+2]=B;h[m+3]=R&&B<f?T[B]:255,m=m+4}}break}case 2:{for(let A=0,m=0;m<_;A=A+2,m=m+4){let g=u[A];h[m]=g,h[m+1]=g,h[m+2]=g,h[m+3]=u[A+1]}break}case 3:{for(let A=0,m=0;m<_;A=A+3,m=m+4){let g=u[A],S=u[A+1],R=u[A+2];h[m]=g,h[m+1]=S,h[m+2]=R,h[m+3]=255}break}}return cr.createFromPixels(this._width,this._height,h)}static _fail(){throw new t}static _ID(a,s,l,c){return a<<24|s<<16|l<<8|c}static decodeBytes(a){return new o()._decode(a)}constructor(){this._count=0,this._offset=0,this._palette=null,this._transparency=null,this._view=null,this._dataStreamChunks=[],this._dataStreamCount=0,this._width=0,this._height=0,this._bitDepth=0,this._colorType=0,this._isInterlaced=!1}};o.COLOR_TYPE_GRAY=0,o.COLOR_TYPE_RGB=2,o.COLOR_TYPE_INDEXED=3,o.COLOR_TYPE_GRAY_ALPHA=4,o.COLOR_TYPE_RGBA=6,o.FILTER_TYPE_NONE=0,o.FILTER_TYPE_SUB=1,o.FILTER_TYPE_UP=2,o.FILTER_TYPE_AVERAGE=3,o.FILTER_TYPE_PAETH=4;let e=o;n.Decoder=o,n.DEBUG_LOG=!1})(lS||(lS={}));var Q_=class t{_decode(e){let r=0;(e[r++]!=71||e[r++]!=73||e[r++]!=70||e[r++]!=56||(e[r++]+1&253)!=56||e[r++]!=97)&&Gn.fail("Invalid GIF 87a/89a header.");let n=e[r++]|e[r++]<<8,o=e[r++]|e[r++]<<8,i=e[r++],a=!!(i>>7),l=1<<(i&7)+1;r=r+1,r=r+1;let c=0,d=0;a&&(c=r,d=l,r=r+l*3);let u=!0,p=[],_=!1,h=0,A=256,m=0,g=-1,S=!0;e:for(;u&&r<e.length;)switch(e[r++]){case 33:{switch(e[r++]){case 255:{if(e[r]!=11||e[r+1]==78&&e[r+2]==69&&e[r+3]==84&&e[r+4]==83&&e[r+5]==67&&e[r+6]==65&&e[r+7]==80&&e[r+8]==69&&e[r+9]==50&&e[r+10]==46&&e[r+11]==48&&e[r+12]==3&&e[r+13]==1&&e[r+16]==0)r=r+14,g=e[r++]|e[r++]<<8,r=r+1;else for(r=r+12;;){let R=e[r++];if(R>=0||Gn.fail("Invalid block size"),R==0)break;r=r+R}break}case 249:{(e[r++]!=4||e[r+4]!=0)&&Gn.fail("Invalid graphics extension block.");let R=e[r++];h=e[r++]|e[r++]<<8,A=e[r++],(R&1)==0&&(A=256),m=R>>2&7,!_&&m==3&&(_=!0),R>>1&1,r=r+1;break}case 254:case 1:{for(;;){let R=e[r++];if(R>=0||Gn.fail("Invalid block size"),R==0)break;r=r+R}break}default:{let R=e[r-1].toString(16);Gn.fail(`Unknown graphic control label: 0x${R}`);break}}break}case 44:{let R=e[r++]|e[r++]<<8,E=e[r++]|e[r++]<<8,P=e[r++]|e[r++]<<8,T=e[r++]|e[r++]<<8,f=e[r++],y=!!(f>>7),v=f>>6&1,I=1<<(f&7)+1,C=c,L=d,B=!1;y&&(B=!0,C=r,L=I,r=r+I*3);let V=r,b=!1;for(r=r+1;;){let D=e[r++];if(D===void 0){b=!0;break}if(D>=0||Gn.fail("Invalid block size"),D==0)break;r=r+D}b||p.push(new Gn.Frame(R,E,P,T,B,C,L,V,r-V,A,!!v,h,m)),(P==n&&T==o||!B||h>0)&&(S=!1);break}case 59:{u=!1;break e}default:{let R=e[r-1].toString(16);Gn.fail(`Unknown gif block: 0x${R}`);break}}if(S){let R="May have encountered multi-image/single-canvas GIF";R+=`
  GIF metadata: [${n} x ${o}], loopCount=${g}, disposal=${m}`;for(let E of p)R+=`
    ${E}`;console.warn(R)}return new Gn.DecodeResult(n,o,p.length,g,e,p,_)}static decodeBytes(e){{let r=new t()._decode(e);return cr.createFromGif(r.width,r.height,r)}}constructor(){}},ke=class ke{static createFromPixels(e,r,n){return new ke(e,r,n)}static createFromCanvas(e){return new ke(e.width,e.height,null,e)}static createFromImage(e,r,n){return new ke(e,r,null,null,n)}static createFromGif(e,r,n){return new ke(e,r,null,null,null,n)}static createFromImageBitmap(e,r,n){return new ke(e,r,null,null,null,null,n)}constructor(e,r,n,o,i,a,s){this.width=e,this.height=r,this.gif=null,this.pixels=null,o!=null?this.pixels=ke.Pixels.createFromCanvas(o):i!=null?this.pixels=ke.Pixels.createFromImage(i):a!=null?this.gif=a:s!=null?this.pixels=ke.Pixels.createFromImageBitmap(s):this.pixels=ke.Pixels.createFromPixels(n)}static isPowerOf2(e){return e!=0&&(e&e-1)==0}static nextPowerOf2(e){return e=e-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e=e+1,e}isGIF(){return this.gif!=null}memorySize(){return this.gif?this.gif.buf.length:this.pixels.memorySize()}pixelAtIndex(e,r){if(e<0||e>=this.width||r<0||r>=this.height)return N.TRANSPARENT;if(this.pixels.array!=null){let n=this.pixels.array,o=r*this.width*4+e*4,i=n[o],a=n[o+1],s=n[o+2],l=n[o+3];return N.new2(i,a,s,l)}else{if(this.pixels.img!=null)throw new Error("pixelAtIndex not implemented for image-based buffers");{let n=this.pixels.canvas.getContext("2d").getImageData(e,r,1,1).data;return N.new2(n[0],n[1],n[2],n[3])}}}expandToPowerOfTwo(){if(this.isGIF())return console.warn("ImageBuffer#expandToPowerOfTwo: unimplemented for GIF resources"),this;if(this.pixels.array!=null){let e=this.pixels.array,r=ke.nextPowerOf2(this.width),n=ke.nextPowerOf2(this.height),o=new Uint8Array(r*n*4);for(let i=0;i<r;i=i+1)for(let a=0;a<n;a=a+1)for(let s=0;s<4;s=s+1)o[s+(i+a*r)*4]=i<this.width&&a<this.height?e[s+(i+a*this.width)*4]:0;return ke.createFromPixels(r,n,o)}else{if(this.pixels.img!=null)throw new Error("expandToPowerOfTwo not implemented for image-based buffers");{let e=document.createElement("canvas");return e.width=ke.nextPowerOf2(this.width),e.height=ke.nextPowerOf2(this.height),e.getContext("2d").drawImage(this.pixels.canvas,0,0,this.pixels.canvas.width,this.pixels.canvas.height),ke.createFromCanvas(e)}}}static initialize(){ke._worker==null&&(ke._worker=new Tl(Vt.getWorkerURL()??"ts-imagedecoder.js"),ke._worker.mainThreadFallback=e=>ke.handleWorkerEvent(e),ke._worker.onmessage=e=>{let r=e.data;if(r==null){console.log("No data received from image decode worker");return}let n=Xt.IntMap_get(ke._pendingRequests,r.id,null);if(n==null)return;if(ke._pendingRequests.delete(r.id),r.width>0&&r.height>0&&r.pixels!=null){let d=ke.createFromPixels(r.width,r.height,r.pixels);ke.dimensionsNeedDownsizing(r.width,r.height,ke.computeMaxRes())&&(console.log("downsampling after worker"),d=ke._downsampleBilinear(d,ke.getMaxRes())),console.log(`image decode succeeded, got ${d.width}x${d.height} image`),n.resolve(d);return}else if(r.width>0&&r.height>0&&r.gif!=null){let d=ke.createFromGif(r.width,r.height,r.gif);console.log(`GIF decode succeeded, got ${d.width}x${d.height} image`),n.resolve(d);return}console.log("image decode failed, falling back to the browser's image decoder instead");let o=new Image,i=D_.readFromJPEG(n.bytes),a=i!=null?Jd.ImageOrientation_rotationDegrees(i.value):0,s=i!=null?Jd.ImageOrientation_shouldFlip(i.value):!1,l=URL.createObjectURL(new Blob([n.bytes]));o.onerror=()=>{URL.revokeObjectURL(l),n.reject()};let c=()=>{URL.revokeObjectURL(l);let d=ke._context!=null?ke._context:document.createElement("canvas").getContext("2d"),u=d.canvas;if(o.width>0&&o.height>0){console.log(`image decode fallback succeeded, got ${o.width}x${o.height} image`);let p=a==0||a==180?o.width:o.height,_=a==0||a==180?o.height:o.width;u.width=p,u.height=_,d.save(),s&&(d.translate(u.width,0),d.scale(-1,1)),a==90?(d.translate(p,0),d.rotate(a*Math.PI/180)):a==180?(d.translate(p/2|0,_/2|0),d.rotate(a*Math.PI/180),d.translate(-p/2|0,-_/2|0)):a==270&&(d.translate(0,_),d.rotate(a*Math.PI/180)),d.drawImage(o,0,0,o.width,o.height),d.restore();let h=ke.createFromPixels(p,_,new Uint8Array(d.getImageData(0,0,p,_).data.buffer));ke.dimensionsNeedDownsizing(p,_,ke.computeMaxRes())&&(h=ke._downsampleBilinear(h,ke.getMaxRes())),n.resolve(h);return}console.log("image decode fallback failed, giving up"),n.reject()};o.onload=()=>{K.htmlImageDecodeMethodIsPresent()?o.decode().then(d=>{c()},d=>{ke.trackImageDecodeFailure("Slow decode fallback decode"),c()}):c()},o.src=l})}static trackImageDecodeFailure(e){ke.numDecodeFailuresLogged>=ke.LOG_MAX_DECODE_FAILURES||(be.trackEvent("image_decode_failed",{reason:e}),ke.numDecodeFailuresLogged+=1)}static setRamInUse(e){ke._ramInUse=e}static setVRamInUse(e){ke._vramInUse=e}static setMaxRes(e){ke._maxRes=e}static getMaxRes(){return ke._maxRes}static computeMaxRes(){if(!K.shouldApplyMobileOptimizations())return ke._maxRes;let e=2048;return ke._vramInUse>200||ke._ramInUse>200?e=256:ke._vramInUse>150||ke._ramInUse>150?e=512:(ke._vramInUse>100||ke._ramInUse>100)&&(e=1024),e!=ke._maxRes&&(ke._maxRes=e),e}static decodeImageBuffer(e,r){return e=new Uint8Array(e),new Promise((n,o)=>{ke.initialize(),ke._worker.postMessage1(new cS(ke._nextID,e,ke.computeMaxRes(),r)),ke._pendingRequests.set(ke._nextID,new ke.PendingRequest(e,n,()=>{o(new vs)})),ke._nextID=ke._nextID+1})}static dimensionsNeedDownsizing(e,r,n){return n<=0||e<=ke._maxRes&&r<=ke._maxRes&&(e<13||r<13)||e*r<n*n*.5?!1:e>n||r>n}static handleWorkerEvent(e){var n;let r=null;if(e.isGIF)r=Q_.decodeBytes(e.bytes);else{try{r=lS.Decoder.decodeBytes(e.bytes)}catch{}r==null&&(r=ke._decodeJPEG(e.bytes)),r!=null&&ke.dimensionsNeedDownsizing(r.width,r.height,e.maxRes)&&(r=ke._downsampleBilinear(r,e.maxRes))}return new dS(e.id,r!=null?r.width:0,r!=null?r.height:0,r!=null?(n=r.pixels)==null?void 0:n.array:null,r!=null?r.gif:null)}static _decodeJPEG(e){let r=new jd.Decoder;if(r.decodeBytes(e)!=jd.Result.OK)return null;let n=r.width(),o=r.height(),i=r.rgb(),a=new Uint8Array(n*o*4),s=0,l=0;for(let c=0,d=n*o;c<d;c=c+1)a[l]=i[s],a[l+1]=i[s+1],a[l+2]=i[s+2],a[l+3]=255,s=s+3,l=l+4;return ke.createFromPixels(n,o,a)}static redIndex(e,r,n){return(r*n+e)*4}static _downsampleBilinear(e,r){let n=Math.max(e.width,e.height);if(n<=0||r<=0)return e;let o=r/n,i=1/o,a=e.width*o|0,s=e.height*o|0,l=new Uint8Array(a*s*4),c=e.pixels.array;for(let d=0;d<s;d=d+1){let u=i*d,p=u-(u|0),_=d*a*4;for(let h=0;h<a;h=h+1){let A=i*h,m=A-(A|0),g=ke.redIndex(h*i|0,d*i|0,e.width),S=c[g],R=c[g+1],E=c[g+2],P=c[g+3];h<a-1&&(g=ke.redIndex((h*i|0)+1,d*i|0,e.width));let T=c[g],f=c[g+1],y=c[g+2],v=c[g+3];d<s-1?g=ke.redIndex(h*i|0,(d*i|0)+1,e.width):g=ke.redIndex(h*i|0,d*i|0,e.width);let w=c[g],I=c[g+1],C=c[g+2],L=c[g+3];d<s-1&&h<a-1&&(g=ke.redIndex((h*i|0)+1,(d*i|0)+1,e.width));let B=c[g],V=c[g+1],b=c[g+2],D=c[g+3],U=1-m,H=1-p;l[_]=(S*U+T*m)*H+(w*U+B*m)*p|0,l[_+1]=(R*U+f*m)*H+(I*U+V*m)*p|0,l[_+2]=(E*U+y*m)*H+(C*U+b*m)*p|0,l[_+3]=(P*U+v*m)*H+(L*U+D*m)*p|0,_=_+4}}return ke.createFromPixels(a,s,l)}};ke.LOG_MAX_DECODE_FAILURES=3,ke.numDecodeFailuresLogged=0,ke._pendingRequests=new Map,ke._worker=null,ke._nextID=0,ke._context=null,ke._handleResponse=null,ke._ramInUse=0,ke._vramInUse=0,ke._maxRes=4096;var cr=ke;(r=>{class t{static createFromPixels(o){return new t(o,null,null,null)}static createFromCanvas(o){return new t(null,o,null,null)}static createFromImage(o){return new t(null,null,o,null)}static createFromImageBitmap(o){return new t(null,null,null,o)}constructor(o,i,a,s){this.array=o,this.canvas=i,this.img=a,this.imageBitmap=s}memorySize(){return this.array!=null?this.array.length:this.canvas!=null?this.canvas.width*this.canvas.height*4:this.img!=null?this.img.width*this.img.height*4:this.imageBitmap!=null?this.imageBitmap.width*this.imageBitmap.height*4:0}}r.Pixels=t;class e{constructor(o,i,a){this.bytes=o,this.resolve=i,this.reject=a}}r.PendingRequest=e})(cr||(cr={}));var Ja=(r=>(r[r.ANIMATED=0]="ANIMATED",r[r.STATIC_IMAGE=1]="STATIC_IMAGE",r))(Ja||{}),cS=class{constructor(e,r,n,o){this.id=0,this.bytes=null,this.maxRes=0,this.isGIF=!1,this.id=e,this.bytes=r,this.maxRes=n,this.isGIF=o==0}},dS=class t{static empty(e){return new t(e,0,0,null,null)}constructor(e,r,n,o,i){this.id=e,this.width=r,this.height=n,this.pixels=o,this.gif=i}};var gS=new Uint8Array([171,75,84,88,32,50,48,187,13,10,26,10]).toString(),uS=5;var bo=class bo{constructor(e,r,n,o){this._numImageFetchRetries=0;this._compressedData=null,this._imageType=1,this._gif=null,this._fetchAndDecodePromise=null,this._decodedData=null,this._texture=null,this._url=e,this._downloadUrl=e,this._compressedTextureUrl=null,this._isCompressedTexture=!1,this._imageType=r,this._hash=n,this._allowDownscaling=o,n!=null&&!yo&&(Vt.getImageBatchURL()!=null&&nb(n),Vt.shouldUseCompressedTextures()&&Vt.getCompressedTexturesAvailabilityURL()!=null&&ob(n))}fetchAndDecodePromise(){return this._fetchAndDecodePromise}width(){return this.texture()!=null?this.texture().width():this._decodedData!=null?this._decodedData.width:0}height(){return this.texture()!=null?this.texture().height():this._decodedData!=null?this._decodedData.height:0}primeWithCompressedData(e){var n,o;this._compressedData=e;let r=(o=(n=F())==null?void 0:n.modules())==null?void 0:o.corePerfInfo;r==null||r.imageMemStatsAlloc(Rs.COMPRESSED,this._compressedData.byteLength),this._downloadUrl=URL.createObjectURL(new Blob([this._compressedData]))}imageType(){return this._imageType}isGIF(){return this._imageType==0}gif(){return this._gif}url(){return this._url}hash(){return this._hash}state(){return this.isDecoded()?2:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==2?3:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==0?1:0}failureIsRetryable(){var e;return this.loadDidFail()&&![1,2].includes((e=this._fetchAndDecodePromise)==null?void 0:e._error)}loadDidFail(){return this.state()==3}_fetchImageBytesForSlowDecode(){let e=new Un;if(this._compressedData!=null)e.resolve(this._compressedData);else{let r=()=>{new Vo(this._isCompressedTexture?this._compressedTextureUrl:this._downloadUrl).format(1).get().then(n=>{n.wasSuccessful()?e.resolve(n.bytes):this._numImageFetchRetries<bo.MAX_IMAGE_FETCH_RETRIES?(this._numImageFetchRetries+=1,r()):e.reject(0)},n=>{this._numImageFetchRetries<bo.MAX_IMAGE_FETCH_RETRIES?(this._numImageFetchRetries+=1,r()):e.reject(1)})};r()}return e}decodedData(){return this._decodedData}texture(){return this._texture}setTexture(e){this._texture=e}isDecoded(){return this._gif!=null||this._decodedData!=null||this._texture!=null}isCompressedTexture(){return this._isCompressedTexture}setIsCompressedTexture(e){this._isCompressedTexture=e}fetchAndDecode(e,r,n){if(this._decodedData!=null){r(this._decodedData);return}let o=this._fetchAndDecodePromise!=null;o||(this._fetchAndDecodePromise=new Un),this._fetchAndDecodePromise.then2(r,n),!o&&(this._hash==null||Vt.getImageBatchURL()==null?this._fetchAndDecode(e):nb(this._hash).then2(i=>{this._fetchAndDecodePromise!=null&&(this._downloadUrl=i.url,i.compressedTexturesUrl?(this._compressedTextureUrl=i.compressedTexturesUrl,ob(this._hash).then2(a=>{this._isCompressedTexture=a,this._fetchAndDecode(e)},()=>{this._fetchAndDecode(e)})):this._fetchAndDecode(e))},i=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(i)}))}_fetchAndDecode(e){this._canUseFastFetchAndDecode()?this._fastFetchAndDecode(e):this._slowFetchAndDecode()}_canUseFastFetchAndDecode(){return bo.browserSupportsFastImageDecoding()&&this._imageType==1&&!(Vt.shouldUseCompressedTextures()&&this._isCompressedTexture)}_fetchHTMLImageObject(){let e=new Un,r=new Image,n=()=>{r.crossOrigin="anonymous",r.src=this._downloadUrl,r.onload=()=>{e.resolve(r)},r.onerror=()=>{this._numImageFetchRetries<bo.MAX_IMAGE_FETCH_RETRIES?(this._numImageFetchRetries+=1,n()):e.reject(0)}};return n(),e}_fastDecodeHelper(e,r){e.decode().then(n=>{if(this._fetchAndDecodePromise==null)return;if(r!=0){this._handleDecodeSuccess(cr.createFromImage(e.naturalWidth,e.naturalHeight,e));return}let o=document.createElement("canvas");if(!(this._allowDownscaling&&K.shouldApplyMobileOptimizations()))o.width=e.naturalWidth,o.height=e.naturalHeight;else{let s=Math.max(e.naturalWidth,e.naturalHeight),c=Math.min(2048,s)/s;o.width=Math.round(e.naturalWidth*c)|0,o.height=Math.round(e.naturalHeight*c)|0}let a=o.getContext("2d");a==null?(cr.trackImageDecodeFailure("Canvas context creation failed"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(2)):(a.drawImage(e,0,0,o.width,o.height),this._handleDecodeSuccess(cr.createFromCanvas(o)))},n=>{cr.trackImageDecodeFailure("Image.decode"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(2)})}_fastFetchAndDecode(e){this._fetchHTMLImageObject().then2(r=>{this._fetchAndDecodePromise!=null&&(e!=0&&bo.browserSupportsCreateImageBitmap()&&K.enableCreateImageBitmap()?createImageBitmap(r,{premultiplyAlpha:"none"}).then(n=>{this._fetchAndDecodePromise!=null&&this._handleDecodeSuccess(cr.createFromImageBitmap(n.width,n.height,n))},n=>{cr.trackImageDecodeFailure("createImageBitmap"),this._fastDecodeHelper(r,e)}):this._fastDecodeHelper(r,e))},r=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(0)})}_handleDecodeSuccess(e){var n,o;if(this._fetchAndDecodePromise==null)return;let r=(o=(n=F())==null?void 0:n.modules())==null?void 0:o.corePerfInfo;r==null||r.imageMemStatsAlloc(Rs.BUFFER,e.memorySize()),this._decodedData=e,this._imageType==0?(this._gif=new Gn(e.gif),cr.setRamInUse(Kr.increment("Decoded image data in RAM (MB)",1*this._gif.decodedSize()/(1024*1024)))):cr.setRamInUse(Kr.increment("Decoded image data in RAM (MB)",1*e.width*e.height*4/(1024*1024))),this._fetchAndDecodePromise.resolve(e),Kr.increment("# Decoded images",1)}_slowFetchAndDecode(){this._fetchImageBytesForSlowDecode().then2(e=>{if(this._fetchAndDecodePromise!=null){if(Vt.shouldUseCompressedTextures()&&this._isCompressedTexture&&e.slice(0,12).toString()===gS){let r=bC(e),n=r.levels[0].levelData,o=cr.createFromPixels(r.pixelWidth,r.pixelHeight,n);this._handleDecodeSuccess(o);return}cr.decodeImageBuffer(e,this._imageType).then(r=>{this._handleDecodeSuccess(r)},r=>{cr.trackImageDecodeFailure("unknown"),console.error(`failed to load image '${this}'`),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(2)})}},e=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(e)})}freeMemoryForDecodedData(){var r,n;let e=!1;if(this._decodedData!=null){let o=(n=(r=F())==null?void 0:r.modules())==null?void 0:n.corePerfInfo;o==null||o.imageMemStatsFree(Rs.BUFFER,this._decodedData.memorySize()),Kr.increment("# Decoded images",-1),cr.setRamInUse(Kr.increment("Decoded image data in RAM (MB)",-1*this.width()*this.height()*4/(1024*1024))),this._decodedData=null,e=!0}return e}freeMemoryForDecodedDataAndTexture(){let e=!1;return this.freeMemoryForDecodedData(),this._gif!=null&&(cr.setRamInUse(Kr.increment("Decoded image data in RAM (MB)",-1*this._gif.decodedSize()/(1024*1024))),this._gif=null,e=!0),this.texture()!=null&&(this.texture().deleteTexture(),this.setTexture(null),e=!0),this._fetchAndDecodePromise!=null&&(this._fetchAndDecodePromise.reject(3),this._fetchAndDecodePromise=null,e=!0),e}objectHash(){return`ImageResourceImpl(${this._url}, ${Ja[this._imageType]})`}toString(){return`ImageResourceImpl(${this._url}, ${Ja[this._imageType]})`}static browserSupportsCreateImageBitmap(){return Wt.chrome()||Wt.firefox()&&K.isBrowserVersionAtLeast("93")||Wt.safari()}static browserSupportsFastImageDecoding(){return(Wt.chrome()&&K.isBrowserVersionAtLeast("81")||Wt.firefox()&&K.isBrowserVersionAtLeast("77")||Wt.safari()&&!Wt.ios()&&K.isBrowserVersionAtLeast("13.1")||Wt.safari()&&Wt.ios()&&K.isBrowserVersionAtLeast("13.4")||Wt.safari()&&Wt.ios()&&K.isOSVersionAtLeast("13.4.1"))&&K.htmlImageDecodeMethodIsPresent()}static getEmojiImageUrlForKey(e,r){return"https://static.figma.com/emoji/5/"+e+"/medium/"+r+".png"}static getEmojiImageUrl(e,r){let n=e.map(o=>o.toString(16)).join("-");return bo.getEmojiImageUrlForKey(r,n)}static createEmojiImage1(e,r){let n=e.map(o=>o.toString(16)).join("-");return bo.createEmojiImage2(n,r)}static createEmojiImage2(e,r){return new bo(bo.getEmojiImageUrlForKey(r,e),1,null,!0)}static createDeviceImage(e){let r=e.url,n=Mn().INITIAL_OPTIONS,o=n?n.cluster_name:"missing-cluster",i=r+`?cachebreaker=${o}`;return new bo(i,1,null,!1)}static createImage(e,r,n){let o=bo.bytesToHex(e),i=Vt.getImagePrefixURL(),s=`${i.endsWith("/")?i:i+"/"}${o}`,l=new bo(s,n,o,!0);return r!=null&&l.primeWithCompressedData(r),l}static bytesToHex(e){let r="";for(let n=0,o=e.length;n<o;n=n+1)r+=(e[n]|256).toString(16).slice(-2);return r}static hexToBytes(e){let r=[];for(let n=0;n<e.length;n=n+2)r.push(parseInt(e.substr(n,2),16));return new Uint8Array(r)}};bo.MAX_IMAGE_FETCH_RETRIES=2;var nn=bo;function rL(){let t=Vt.getImageBatchURL(),e=_S;_S=[],pS=0;let r=o=>{var c;let i=new Vo(t),a=new Map,s=(c=Mn().INITIAL_OPTIONS)==null?void 0:c.user_data;s&&a.set("x-figma-user-id",s.id),i.send1("POST",new Blob([JSON.stringify({sha1s:o,needs_compressed_textures:Vt.shouldUseCompressedTextures()})],{type:"application/json"}),a).then(d=>{if(!d.wasSuccessful()){for(let h of o){let A=t+":"+h,m=ja.get(A);m&&m.reject(1)}return}let u;try{if(u=JSON.parse(d.text),!u)throw new Error("ImageResource: Response did not contain correct JSON payload")}catch(h){for(let A of o){let m=t+":"+A,g=ja.get(m);g&&g.reject(1)}throw h}let p=u.meta.s3_urls,_=u.meta.compressed_texture_s3_urls;for(let h of Object.keys(p)){let A=t+":"+h,m=ja.get(A),g=Vt.shouldUseCompressedTextures()&&!!_&&h in _,S={url:p[h],compressedTexturesUrl:g?_[h]:void 0};m&&m.state()==0&&m.resolve(S)}for(let h of o)if(!(h in p)){let A=t+":"+h,m=ja.get(A);m&&m.reject(1)}},d=>{for(let u of o){let p=t+":"+u,_=ja.get(p);_&&(be.trackDefinedEvent("prototype.image_url_request_failed",{status:d.status}),_.reject(1))}})},n=100;for(let o=0;o<=((e.length-1)/n|0);o=o+1){let i=e.slice(o*n,Math.min((o+1)*n,e.length));r(i)}}function q_(t,e){let r=Vt.getCompressedTexturesAvailabilityURL();for(let n of t){let o=r+":"+n,i=fS.get(o);i&&i.resolve(e)}}function nL(){let t=Vt.getCompressedTexturesAvailabilityURL(),e=(n,o)=>{let i=new Vo(t),a=new Map,s=Mn().INITIAL_OPTIONS.user_data;s&&a.set("x-figma-user-id",s.id);let l=i.send1("POST",new Blob([JSON.stringify({sha1s:n})],{type:"application/json"}),a),c=500*(1<<Math.min(o,3));l.then(d=>{if(!d.wasSuccessful())o<uS?setTimeout(()=>e(n,o+1),c):q_(n,!1);else{let u;try{u=JSON.parse(d.text)}catch(A){if(!(A instanceof SyntaxError))throw A;let m=new Error("ImageResource: Response was not valid JSON");throw m.sentryContext={response:d.text},m}let p=[],_=[],h=[];for(let A in u.meta.results)switch(u.meta.results[A]){case"generated":h.push(A);break;case"generating":if(o<uS){p.push(A);break}case"failed":case null:_.push(A)}p.length>0&&setTimeout(()=>e(p,o+1),c),q_(_,!1),q_(h,!0)}},d=>{o<uS?setTimeout(()=>e(n,o+1),c):q_(n,!1)})};hS=0;let r=100;for(;mS.length>0;){let n=mS.splice(0,r);e(n,0)}}function nb(t){let e=Vt.getImageBatchURL()+":"+t;return ja.has(e)||(_S.push(t),ja.set(e,new Un),pS==0&&(pS=setTimeout(()=>{rL()},0))),ja.get(e)}function ob(t){let e=Vt.getCompressedTexturesAvailabilityURL()+":"+t,r=fS.get(e);if(r)return r;mS.push(t);let n=new Un;return fS.set(e,n),hS==0&&(hS=setTimeout(()=>{nL()},0)),n}var pS=0,_S=[],ja=new Map,hS=0,mS=[],fS=new Map;var X_=class{equals(e){return this.url==e.url&&this.scaleFactor==e.scaleFactor&&this.nonRotatedImageSize.equals(e.nonRotatedImageSize)&&this.nonRotatedOffset.equals(e.nonRotatedOffset)&&this.nonRotatedFramePresetSize.equals(e.nonRotatedFramePresetSize)}constructor(e,r,n,o,i){this.url=e,this.scaleFactor=r,this.nonRotatedImageSize=n,this.nonRotatedOffset=o,this.nonRotatedFramePresetSize=i}},Gi=class Gi{static deserializeVector(e){return new O(e.x,e.y)}static initialize(){let e=Vt.getDeviceInfoByIdentifier();if(e!==null){Gi._infoByIdentifier=new Map;for(let r in e){let n=e[r];Gi._infoByIdentifier.set(r,new X_(n.url,n.scaleFactor,Gi.deserializeVector(n.imageSize),Gi.deserializeVector(n.offset),Gi.deserializeVector(n.framePresetSize)))}}}static infoForDevice(e){return Gi._infoByIdentifier==null||e==null||e.type!="PRESET"?null:Qe.StringMap_get(Gi._infoByIdentifier,e.presetIdentifier,null)}static adjustNodeBoundsForDevice(e,r){let n=Gi.infoForDevice(r);if(n==null)return e;let o=r.canvasSpaceTopLeftOffset(n),i=r.canvasSpaceImageSize(n),a=e.clone();return a.setX(e.x()-o.x()),a.setY(e.y()-o.y()),a.setWidth(i.x()),a.setHeight(i.y()),a}static canvasSpaceContentSize(e,r){let n=Gi.infoForDevice(r);return n==null?e:r.canvasSpaceImageSize(n)}clearOnContextReset(){for(let e of Array.from(this._imageByURL.keys()))this._imageByURL.delete(e)}getImage(e,r){this._imageByURL.has(e.url)||this._imageByURL.set(e.url,nn.createDeviceImage(e));let n=this._imageByURL.get(e.url),o=new Promise((i,a)=>{n.texture()==null&&n.fetchAndDecode(0,s=>{let l=r.createTexture(Me.RGBA_LINEAR_CLAMP,1,1,br.IMAGE);n.setTexture(l);let c=s.expandToPowerOfTwo();n.texture().resize1(c.width,c.height,c,!0),i()},s=>{a(s)})});return{imageResource:n,loadPromise:o}}constructor(){this._imageByURL=new Map}};Gi._infoByIdentifier=null;var ro=Gi;var Q;(d=>{function t(u){return u!="-1:-1"&&u!=""}d.isValid=t;function e(u,p){let _=r(u),h=r(p),A=Ft.int_compare(_.sessionID,h.sessionID);return A==0&&(A=Ft.int_compare(_.localID,h.localID)),A}d.compare=e;function r(u){let p=u.split(":");if(p.length==2){let _={};return _.sessionID=parseInt(p[0]),_.localID=parseInt(p[1]),_}return null}d.toFigGUID=r;function n(){return"-1:-1"}d.invalid=n;function o(u){if(u==null)return null;let p=r(u);return p==null?null:p.sessionID<0||p.localID<0?"-1:-1":u}d.fromString=o;function i(u,p){return u<0||p<0?"-1:-1":`${u}:${p}`}d._new=i;function a(u){return i(u.sessionID,u.localID)}d.fromFigGUID=a;function s(u,p){return u==p}d.equals=s;function l(u,p){if(u.length!=p.length)return!1;for(let _=0,h=u.length;_<h;_=_+1)if(u[_]!=p[_])return!1;return!0}d.isSamePath=l;function c(u){return u=="0:0"}d.isRoot=c})(Q||(Q={}));var mn=class t{constructor(e,r){this._offset=null,this._scale=0,this._offset=e,this._scale=r}offset(){return this._offset}scale(){return this._scale}setOffset(e){this._offset=e}setScale(e){this._scale=e}clone(){return new t(this.offset(),this.scale())}equals(e){return this._offset.equals(e.offset())&&this._scale==e.scale()}translate1(e,r){this._offset.setX(this._offset.x()+e*this._scale),this._offset.setY(this._offset.y()+r*this._scale)}translate2(e){this.translate1(e.x(),e.y())}translatedBy1(e){return this.translatedBy2(e.x(),e.y())}translatedBy2(e,r){return this.translate1(e,r),this}scaledBy(e){return this._scale=this._scale*e,this}multiply(e){this._offset=this._offset.add(e.offset().multiplyScalar(this._scale)),this._scale=this._scale*e.scale()}multipliedBy(e){return this.multiply(e),this}transformRect(e){if(e.isInvalid())return e.copyFrom(x.INVALID);if(!e.isFinite())return e.copyFrom(x.INFINITE);let r=new Et;return r.include2(this.transformPoint(e.topLeft())),r.include2(this.transformPoint(e.bottomRight())),r.buildTo(e),e}inverseTransformRect(e){if(e.isInvalid())return e.copyFrom(x.INVALID);if(!e.isFinite())return e.copyFrom(x.INFINITE);let r=new Et;return r.include2(this.inverseTransformPoint(e.topLeft())),r.include2(this.inverseTransformPoint(e.bottomRight())),r.buildTo(e),e}transformPoint(e){return e.multiplyUpdate(this._scale),e.addUpdate1(this._offset),e}inverseTransformPoint(e){return e.subtractUpdate1(this._offset),e.divideUpdate(this._scale),e}transformDirection(e){return e.multiplyUpdate(this._scale),e}inverseTransformDirection(e){return e.divideUpdate(this._scale),e}invert(){let e=1/this.scale();return isNaN(e)?!1:(this._offset=this._offset.negative().multiplyScalar(e),this._scale=e,!0)}copyFrom(e){return this._offset.copyFrom(e.offset()),this._scale=e.scale(),this}toString(){return`SimpleTransform({${this.offset().x()}, ${this.offset().y()}}, ${this.scale()})`}static new2(){return new t(O.new(),1)}static new3(e){return new t(e.offset(),e.scale())}},ab;(i=>{function t(){return mn.new2()}i.FrozenSimpleTransform_new1=t;function e(a){return a}i.FrozenSimpleTransform_new2=e;function r(a){return mn.new3(a)}i.FrozenSimpleTransform_new3=r;function n(a,s){return new mn(a,s)}i.FrozenSimpleTransform_new4=n,i.FrozenSimpleTransform_IDENTITY=t()})(ab||(ab={}));var No=class{constructor(e){this._keyByHash=new Map,this._valueByKeyHash=new Map,this._hashKey=e}count(){return this._keyByHash.size}_in(e){let r=this._hashKey(e);return this._keyByHash.has(r)}set(e,r){let n=this._hashKey(e);this._keyByHash.set(n,e),this._valueByKeyHash.set(n,r)}get(e,r=null){let n=this._hashKey(e);return Qe.StringMap_get(this._valueByKeyHash,n,r)}remove(e){let r=this._hashKey(e);this._keyByHash.delete(r),this._valueByKeyHash.delete(r)}clear(){this._keyByHash=new Map,this._valueByKeyHash=new Map}keys(){return Array.from(this._keyByHash.values())}values(){return Array.from(this._valueByKeyHash.values())}each(e){this.keys().forEach(r=>{e(r,this.get(r))})}isEmpty(){return this.count()==0}},Ui=class{constructor(e){this._hash=new No(e)}add(e){this._hash.set(e,!0)}addList(e){for(let r of e)this.add(r)}_in(e){return this._hash._in(e)}remove(e){this._hash.remove(e)}count(){return this._hash.count()}asList(){return this._hash.keys()}each(e){this._hash.keys().forEach(e)}map(e){return this._hash.keys().map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let r of this._hash.keys())if(!e._in(r))return!1;return!0}clear(){this._hash.clear()}};var Dl=(S=>(S[S.NONE=0]="NONE",S[S.WINDOW_VISIBILITY=1]="WINDOW_VISIBILITY",S[S.WINDOW_RESIZE=2]="WINDOW_RESIZE",S[S.WINDOW_FRAME=3]="WINDOW_FRAME",S[S.MOUSE_MOVE=4]="MOUSE_MOVE",S[S.MOUSE_PRESS=5]="MOUSE_PRESS",S[S.MOUSE_DRAG=6]="MOUSE_DRAG",S[S.MOUSE_RELEASE=7]="MOUSE_RELEASE",S[S.MOUSE_SCROLL=8]="MOUSE_SCROLL",S[S.MOUSE_DROP=9]="MOUSE_DROP",S[S.MOUSE_LEAVE=10]="MOUSE_LEAVE",S[S.TOUCH_PRESS=11]="TOUCH_PRESS",S[S.TOUCH_DRAG=12]="TOUCH_DRAG",S[S.TOUCH_RELEASE=13]="TOUCH_RELEASE",S[S.KEY_PRESS=14]="KEY_PRESS",S[S.KEY_RELEASE=15]="KEY_RELEASE",S[S.GAMEPAD_DOWN=16]="GAMEPAD_DOWN",S[S.ON_MEDIA_HIT=17]="ON_MEDIA_HIT",S))(Dl||{}),oa=class{type(){return this._type}target(){return this._target}modifiers(){return this._modifiers}asMouseEvent(){return null}asTouchEvent(){return null}asKeyEvent(){return null}asGamepadEvent(){return null}isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}constructor(e,r,n){this._type=e,this._target=r,this._modifiers=n,this._isAccepted=!1}};var bl=class t extends oa{constructor(r,n,o,i,a,s,l,c){super(r,n,o);this._type=r;this._target=n;this._modifiers=o;this.locationInWindow=i,this.previousLocationInWindow=a,this.scrollDelta=s,this.clickCount=l,this.droppedFiles=c}interactionType(){return 0}asMouseEvent(){return this}interactionCount(){return 1}locationInView(r){let n=r.absoluteBounds();return new O(this.locationInWindow.x()-n.x(),this.locationInWindow.y()-n.y())}previousLocationInView(r){let n=r.absoluteBounds();return new O(this.previousLocationInWindow.x()-n.x(),this.previousLocationInWindow.y()-n.y())}delta(){return this.locationInWindow.subtract(this.previousLocationInWindow)}clone(){return new t(this.type(),this.target(),this.modifiers(),this.locationInWindow,this.previousLocationInWindow,this.scrollDelta,this.clickCount,this.droppedFiles)}},Pc=class{locationInView(e){let r=e.absoluteBounds();return new O(this.locationInWindow.x()-r.x(),this.locationInWindow.y()-r.y())}previousLocationInView(e){let r=e.absoluteBounds();return new O(this.previousLocationInWindow.x()-r.x(),this.previousLocationInWindow.y()-r.y())}constructor(e,r,n,o){this.id=e,this.originalTarget=r,this.locationInWindow=n,this.previousLocationInWindow=o}},SS=class{constructor(e,r,n){this.centroid=e,this.distance=r,this.count=n}},Ho=class Ho extends oa{constructor(r,n,o,i,a){super(r,n,o);this._type=r;this._target=n;this._modifiers=o;this.touches=i,this.allTouches=a,this.scrollDelta=null}getPinchScale(){if(!this.isPinching()||this.touches.length!==2)return null;let r=this.touches[0],n=this.touches[1],o=r.locationInWindow.distanceTo(n.locationInWindow),i=r.previousLocationInWindow.distanceTo(n.previousLocationInWindow);if(Math.abs(o-i)<Ho.TOUCH_PINCH_THRESHOLD)return 1;let a=o/i;return a>1?Math.max(a,1.01):Math.min(a,.99)}getPinchCenter(){if(!this.isPinching()||this.touches.length!==2)return null;let r=this.touches[0],n=this.touches[1];return r.locationInWindow.add(n.locationInWindow).divideScalar(2)}interactionType(){return 1}asTouchEvent(){return this}interactionCount(){return this.touches.length}locationInView(r){return this.touches[0].locationInView(r)}previousLocationInView(r){return this.touches[0].previousLocationInView(r)}isPinching(){if(this.touches.length!==2)return!1;let r=this.touches[0],n=this.touches[1],o=r.locationInWindow.subtract(r.previousLocationInWindow),i=n.locationInWindow.subtract(n.previousLocationInWindow),a=o.length(),s=i.length();if(a>Ho.TOUCH_MOVEMENT_THRESHOLD||s>Ho.TOUCH_MOVEMENT_THRESHOLD){let d=o.dot(i);if(Math.abs(d/(a*s))>Ho.TOUCH_PARALLEL_THRESHOLD&&d>0)return!1}let l=r.locationInWindow.distanceTo(n.locationInWindow),c=r.previousLocationInWindow.distanceTo(n.previousLocationInWindow);return Math.abs(l-c)>Ho.TOUCH_PINCH_THRESHOLD}summaryInView(r){return r==null?Ho._summarizeTouches(this.touches,n=>n.locationInWindow):Ho._summarizeTouches(this.touches,n=>n.locationInView(r))}previousSummaryInView(r){return r==null?Ho._summarizeTouches(this.touches,n=>n.previousLocationInWindow):Ho._summarizeTouches(this.touches,n=>n.previousLocationInView(r))}delta(){return this.summaryInView(null).centroid.subtract(this.previousSummaryInView(null).centroid)}static _summarizeTouches(r,n){let o=O.new(),i=0;if(r.length!=0){for(let a of r)o.addUpdate1(n(a));o.divideUpdate(r.length);for(let a of r)i+=n(a).distanceTo(o);i/=r.length}return new SS(o,i,r.length)}};Ho.TOUCH_MOVEMENT_THRESHOLD=.05,Ho.TOUCH_PARALLEL_THRESHOLD=.95,Ho.TOUCH_PINCH_THRESHOLD=.1;var Nl=Ho,Pl=class extends oa{constructor(r,n,o,i,a){super(r,n,o);this._type=r;this._target=n;this._modifiers=o;this.key=i,this.isRepeat=a}asKeyEvent(){return this}},Z_=class extends oa{constructor(r,n,o,i,a){super(r,n,o);this._type=r;this._target=n;this._modifiers=o;this.button=i,this.controllerType=a}asGamepadEvent(){return this}},fn;(n=>{function t(o){return o.length}n.handlerCount=t;function e(o,i){ie.List_appendOne(o,i)}n.addUpdate=e;function r(o,i){ie.List_removeOne(o,i)}n.subtractUpdate=r})(fn||(fn={}));var rr;(T=>{function t(f){return E(f,1)}T.windowVisibility=t;function e(f){return E(f,2)}T.windowResize=e;function r(f){return E(f,3)}T.windowFrame=r;function n(f){return E(f,4)}T.mouseMove=n;function o(f){return E(f,5)}T.mousePress=o;function i(f){return E(f,6)}T.mouseDrag=i;function a(f){return E(f,7)}T.mouseRelease=a;function s(f){return E(f,8)}T.mouseScroll=s;function l(f){return E(f,9)}T.mouseDrop=l;function c(f){return E(f,10)}T.mouseLeave=c;function d(f){return E(f,11)}T.touchPress=d;function u(f){return E(f,12)}T.touchDrag=u;function p(f){return E(f,13)}T.touchRelease=p;function _(f){return E(f,14)}T.keyPress=_;function h(f){return E(f,15)}T.keyRelease=h;function A(f){return E(f,16)}T.gamepadDown=A;function m(f,y,v){ie.List_appendOne(E(f,y),v)}T.on=m;function g(f,y,v){let w=R(f,y);w!=null&&ie.List_removeOne(w,v)}T.off=g;function S(f,y){let v=R(f,y.type());if(v!=null){for(let w of v)if(w(y),y.isAccepted())break}}T.trigger=S;function R(f,y){return Xt.IntMap_get(f,y,null)}T._handlers=R;function E(f,y){let v=Xt.IntMap_get(f,y,null);return v==null&&(v=[],f.set(y,v)),v}T._createHandlers=E;function P(){return new Map}T._new=P})(rr||(rr={}));var sb;(e=>{function t(){return new Map}e._new=t})(sb||(sb={}));var J_;(r=>{function t(n){return Qe.StringMap_get(r._triggerDeviceMap,n,"UNKNOWN_CONTROLLER")}r.stringToTriggerDevice=t,r._triggerDeviceMap=new Map([["KEYBOARD","KEYBOARD"],["UNKNOWN_CONTROLLER","UNKNOWN_CONTROLLER"],["XBOX_ONE","XBOX_ONE"],["PS4","PS4"],["SWITCH_PRO","SWITCH_PRO"]])})(J_||(J_={}));var Fc;(r=>{function t(n,o,i,a){return Xt.IntMap_get(n,o<<8|i,a)}r.KeyShortcutMap_get=t;function e(n,o,i,a){n.set(o<<8|i,a)}r.KeyShortcutMap_set=e})(Fc||(Fc={}));var Fs;(s=>{function t(l){return l==1||l==2||l==3}s.ViewerEventType_isWindowEventType=t;function e(l){return l==4||l==5||l==6||l==7||l==8||l==9||l==10}s.ViewerEventType_isMouseEventType=e;function r(l){return l==11||l==12||l==13}s.ViewerEventType_isTouchEventType=r;function n(l){return l==14||l==15}s.ViewerEventType_isKeyEventType=n;function o(l){return l==11||l==13||l==5||l==7||l==8||l==9}s.ViewerEventType_isTypeToBeBlockedByDeviceFrame=o;function i(l){return Qe.StringMap_get(s.ViewerEventType__eventTypeFromString,l,0)}s.ViewerEventType_fromString=i,s.ViewerEventType__eventTypeFromString=new Map([["NONE",0],["WINDOW_VISIBILITY",1],["WINDOW_RESIZE",2],["WINDOW_FRAME",3],["MOUSE_MOVE",4],["MOUSE_PRESS",5],["MOUSE_DRAG",6],["MOUSE_RELEASE",7],["MOUSE_SCROLL",8],["MOUSE_DROP",9],["MOUSE_LEAVE",10],["TOUCH_PRESS",11],["TOUCH_DRAG",12],["TOUCH_RELEASE",13],["KEY_PRESS",14],["KEY_RELEASE",15],["GAMEPAD_DOWN",16]])})(Fs||(Fs={}));var gu;(r=>{function t(n){return n>=105&&n<=108}r.Key_isModifier=t;function e(n){return Xt.IntMap_get(iL,n,[0])}r.Key_keyToKeyCode=e})(gu||(gu={}));var Fl;(e=>{function t(){return Wt.current()==4?2:8}e.Modifiers_currentPlatformModifier=t})(Fl||(Fl={}));function oL(t){let e=new Map;return Xt.IntMap_each(t,(r,n)=>{let o=n;if(e.has(o)){e.get(o).push(r);return}e.set(o,[r])}),e}var AS=new Map([[8,1],[9,2],[10,3],[13,3],[16,107],[17,108],[18,105],[19,5],[20,6],[27,7],[32,8],[33,9],[34,10],[35,11],[36,12],[37,13],[38,14],[39,15],[40,16],[44,17],[45,18],[46,19],[48,20],[49,21],[50,22],[51,23],[52,24],[53,25],[54,26],[55,27],[56,28],[57,29],[59,90],[61,93],[63,30],[65,31],[66,32],[67,33],[68,34],[69,35],[70,36],[71,37],[72,38],[73,39],[74,40],[75,41],[76,42],[77,43],[78,44],[79,45],[80,46],[81,47],[82,48],[83,49],[84,50],[85,51],[86,52],[87,53],[88,54],[89,55],[90,56],[91,106],[92,106],[93,57],[96,58],[97,59],[98,60],[99,61],[100,62],[101,63],[102,64],[103,65],[104,66],[105,67],[106,68],[107,69],[109,70],[110,71],[111,72],[112,76],[113,77],[114,78],[115,79],[116,80],[117,81],[118,82],[119,83],[120,84],[121,85],[122,86],[123,87],[144,88],[145,89],[173,91],[186,90],[187,93],[188,94],[189,91],[190,95],[191,96],[192,104],[219,99],[220,100],[221,101],[222,98],[224,106]]),iL=oL(AS);function aL(){let t=new Map,e=window.location.search;if(e.length==0)return t;e=e.slice(1);for(let r of e.split("&")){let n=r.split("=");n.length==2&&t.set(n[0],n[1])}return t}function zo(){if(!lb){lb=!0;let t=aL(),e=Qe.StringMap_get(t,"force-dpr",null);if(e!=null){let r=+parseFloat(e);isNaN(r)||(TS=new pe(Ir.Math_clamp(r,.1,4)))}}return TS!=null?TS.value:window.devicePixelRatio}var lb=!1,TS=null;var eh=(n=>(n[n.NONE=0]="NONE",n[n.POINTER=1]="POINTER",n[n.TOUCH=2]="TOUCH",n))(eh||{}),ia=class ia{parent(){return this._parent}window(){return this._window}children(){return this._children}events(){return this._events}focus(){this._window.setFocusedView(this)}absoluteBounds(){if(this._cachedAbsoluteBounds!=null)return this._cachedAbsoluteBounds;let e=null;if(this.parent()!=null)e=this.parent().absoluteBounds();else if(this==this.window().root())e=new x(0,0,this.window().width(),this.window().height());else return null;let r=e.width()|0,n=e.height()|0,o=this._minX+(this._alignX==2?r:0),i=this._maxX+(this._alignX!=0?r:0),a=this._minY+(this._alignY==2?n:0),s=this._maxY+(this._alignY!=0?n:0);return this._cachedAbsoluteBounds=new x(e.x()+o,e.y()+a,Math.max(0,i-o),Math.max(0,s-a)),e}viewFromPoint(e){let r=this.children().length;for(let n=0,o=r;n<o;n=n+1){let i=this.children()[r-n-1];if(i.absoluteBounds().contains2(e))return i.viewFromPoint(e)}return this}invalidateBounds(){this.forSelfAndDescendents(e=>{e._cachedAbsoluteBounds=null})}isEqualToOrParentOf(e){for(;e!=null;){if(e==this)return!0;e=e.parent()}return!1}selfAndParents(){let e=[];for(let r=this;r!=null;r=r.parent())e.push(r);return e}selfAndChildren(){let e=[],r=[this];for(;r.length!=0;){let n=r.pop(),o=n.children().length;e.push(n);for(let i=0,a=o;i<a;i=i+1)r.push(n.children()[o-i-1])}return e}setLayout(e,r,n,o,i,a){(this._alignX!=e||this._minX!=r||this._maxX!=n||this._alignY!=o||this._minY!=i||this._maxY!=a)&&(this._alignX=e,this._minX=r,this._maxX=n,this._alignY=o,this._minY=i,this._maxY=a,this._handleLayoutChange(),this.invalidateBounds())}setParent(e){if(e==this._parent)return;this._parent!=null&&ie.List_removeOne(this._parent.children(),this),e!=null&&e.children().push(this),this._handleParentChange(this._parent,e),this._parent=e,this.invalidateBounds();let r=e==null?void 0:e._window;this._window!=r&&this.forSelfAndDescendents(n=>{n._window=r})}forSelfAndDescendents(e){e(this);for(let r of this.children())r.forSelfAndDescendents(e)}setCursor(e){ia._appendCursorStyleIfNecessary(),e!=this._cursor&&(this._element.classList.remove(ia._cssCursorClassName(this._cursor)),this._cursor=e,this._element.classList.add(ia._cssCursorClassName(this._cursor)))}cursor(){return this._cursor}element(){return this._element==null&&(this._element=document.createElement("div"),this._element.style.position="absolute",this._handleLayoutChange()),this._element}becomeRoot(e){this._window=e}_handleParentChange(e,r){r!=null&&r._element!=null?r._element.appendChild(this.element()):e._element!=null&&e._element.removeChild(this.element())}_handleLayoutChange(){if(this._element!=null){let e=this._element.style;e.left=this._alignX==2?"auto":this._minX.toString()+"px",e.top=this._alignY==2?"auto":this._minY.toString()+"px",e.right=this._alignX==0?"auto":this._maxX.toString()+"px",e.bottom=this._alignY==0?"auto":this._maxY.toString()+"px",e.width=this._alignX==1?"auto":(this._maxX-this._minX).toString()+"px",e.height=this._alignY==1?"auto":(this._maxY-this._minY).toString()+"px"}}static _appendCursorStyleIfNecessary(){if(ia._cursorStyle!=null)return;let e=(d,u,p,_)=>`
      cursor: url("${p}"), auto; /* Edge, IE */
      cursor: url("${d}") 30 30, pointer; /* Legacy */
      cursor: url("${_}") 30 30, pointer; /* FF */
      cursor: -webkit-image-set(url("${d}") 1x, url("${u}") 2x) 30 30, pointer; /* Webkit */
      `,r="/images/viewer/cursor-touch.png",n="/images/viewer/cursor-touch.cur",o="/images/viewer/cursor-touch@2x.png",i="/images/viewer/cursor-touch.svg",a="/images/viewer/cursor-touch-down.png",s="/images/viewer/cursor-touch-down.cur",l="/images/viewer/cursor-touch-down@2x.png",c="/images/viewer/cursor-touch-down.svg";ia._cursorStyle=document.createElement("style"),ia._cursorStyle.nonce=Mn().INITIAL_OPTIONS.csp_nonce,ia._cursorStyle.textContent=`
    .cursor-default {
      cursor: default;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .cursor-touch {
      ${e(r,o,n,i)}
    }

    .cursor-touch:active {
      ${e(a,l,s,c)}
    }

    /*
      We provide a mechanism for the app outside of the viewer to disable all
      viewer cursors. This is useful e.g. in comments mode where the containing
      react application is responsible for setting the cursor instead of code
      inside the viewer library. To use this, the containing application would
      add the viewer-cursors-disabled class to the HTMLElement that hosts the
      viewer canvas.
    */

    .viewer-cursors-disabled .cursor-default {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-pointer {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch:active {
      cursor: inherit;
    }
`,document.head.appendChild(ia._cursorStyle)}static _cssCursorClassName(e){switch(e){case 0:return"cursor-default";case 1:return"cursor-pointer";case 2:return"cursor-touch"}}constructor(){this._parent=null,this._window=null,this._children=[],this._events=rr._new(),this._alignX=1,this._minX=0,this._maxX=0,this._alignY=1,this._minY=0,this._maxY=0,this._cachedAbsoluteBounds=null,this._element=null,this._cursor=0}};ia._cursorStyle=null;var Su=ia,ES=class{name(){return this._file.name}mimeType(){return this._file.type}bytes(){return this._promise==null&&(this._promise=new Promise((e,r)=>{let n=new FileReader;n.onload=()=>{e(new Uint8Array(S_.FileReader_resultAsArrayBuffer(n)))},n.onloadend=()=>{r(vs.VOID)},n.readAsArrayBuffer(this._file)})),this._promise}constructor(e){this._file=e,this._promise=null}},j_=class{constructor(e,r,n,o,i){this._root=null,this._width=0,this._height=0,this._devicePixelRatio=0,this._eventHandlersBefore=rr._new(),this._eventHandlersAfter=rr._new(),this._isInlinePreviewCallback=i,this._disableKeyboardHandlingCallback=o,this._events=rr._new(),this._recordInteractionCallback=null,this._isActive=!0,this._focusedView=null,this._containerElement=null,this._disableOwnOnFrameCallback=!1,this._internalOnFrameID=0,this.forceFrame=null,this.internalOnFrame=null,this._containerElement=e,this._disableOwnOnFrameCallback=n,this._root=new Su,this._root.becomeRoot(this);let a=null,s=null,l=null,c=null,d=null,u=null,p=document,_=window,h=this.root().element(),A=b=>{xi.Event_preventDefault(b)},m=(b,D)=>{sr.EventTarget_removeEventListener3(b,"mousemove",s),sr.EventTarget_removeEventListener3(b,"mouseup",l),sr.EventTarget_removeEventListener5(b,"touchmove",d),sr.EventTarget_removeEventListener5(b,"touchend",u),sr.EventTarget_addEventListener4(D,"mousemove",s),sr.EventTarget_addEventListener4(D,"mouseup",l),sr.EventTarget_addEventListener6(D,"touchmove",d),sr.EventTarget_addEventListener6(D,"touchend",u)};this.forceFrame=()=>{this._resize(),rr.trigger(this.events(),new oa(3,this.root(),0))},this.internalOnFrame=()=>{this._resize();try{rr.trigger(this.events(),new oa(3,this.root(),0))}catch(b){we(b)}this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))};let g=()=>{this._isActive=!p.hidden,rr.trigger(this.events(),new oa(1,this.root(),0)),m(p,h)},S=b=>{let D=(b.altKey?1:0)|(b.metaKey?2:0)|(b.shiftKey?4:0)|(b.ctrlKey?8:0);return Fl.Modifiers_currentPlatformModifier()&D?D|16:D},R=(b,D)=>{for(let U=this.root().element();U!=null;U=U.offsetParent)b=b-U.offsetLeft,D=D-U.offsetTop;return new O(b,D)},E=0,P=0,T=0,f=0,y=b=>{let D=0,U=ml.Performance_now(_.performance);return D=1,f!=0&&U-f<500&&Math.abs(b.pageX-E)<4&&Math.abs(b.pageY-P)<4&&(D=T+1),E=b.pageX,P=b.pageY,T=D,f=U,D},v=null,w=null,I=!1,C=(b,D,U,H)=>{let k=R(b.pageX,b.pageY),z=w??this.root().viewFromPoint(k),q=new bl(D==4&&I?6:D,z,S(b),k,v??k,U,D==5?y(b):0,H);v=k,this.notify(q),q.isAccepted()&&(q.type()==5&&b.button==0||xi.Event_preventDefault(b),D==5&&(w=z)),D==5?I=!0:D==7&&(w=null,I=!1)},L=new Map,B=(b,D)=>{let U=new Map,H=[];Array.from(L.values()).forEach(z=>{ie.List_appendOne(H,z.originalTarget)});let k=I_.TouchEvent_touches(b).map(z=>{let q=z.identifier,Y=R(z.pageX,z.pageY),j=Xt.IntMap_get(L,q,null),ae=j!=null?j.originalTarget:this.root().viewFromPoint(Y),xe=new Pc(q,ae,Y,j!=null?j.locationInWindow:Y);return U.set(q,xe),ie.List_appendOne(H,ae),xe});L=U;for(let z of H){let q=new Nl(D,z,S(b),k.filter(Y=>Y.originalTarget==z),k);this.notify(q),q.isAccepted()&&xi.Event_preventDefault(b)}},V=(b,D)=>{if(this._disableKeyboardHandlingCallback())return;let U=Xt.IntMap_get(AS,b.which,0),H=S(b),k=(Fl.Modifiers_currentPlatformModifier()&H)!=0&&(U==91||U==93||U==20),z=this.focusedView();k&&xi.Event_preventDefault(b);let q=Y=>{for(;Y!==p;){if(Y.className.split(" ").indexOf("viewer-forward-keyevents")!=-1)return!0;Y=Y.parentNode}return!1};if((k||p.activeElement==null||p.activeElement==p.body||q(p.activeElement))&&U!=0&&z!=null){let Y=new Pl(D,z,H,U,!1);this.notify(Y),(Y.isAccepted()||U==1)&&(xi.Event_preventDefault(b),b.stopPropagation())}};if(a=b=>{m(h,p),C(b,5,null,null),window.focus(),document.activeElement!=null&&document.activeElement.blur()},s=b=>{C(b,4,null,null)},l=b=>{m(p,h),C(b,7,null,null)},c=b=>{B(b,11)},d=b=>{B(b,12)},u=b=>{B(b,13)},sr.EventTarget_addEventListener3(p,"keydown",b=>{V(b,14)}),sr.EventTarget_addEventListener3(p,"keyup",b=>{V(b,15)}),sr.EventTarget_addEventListener7(h,"wheel",b=>{let D=b.deltaMode,U=D==b.DOM_DELTA_LINE?10:D==b.DOM_DELTA_PAGE?100:1;C(b,8,new O(b.deltaX*U,b.deltaY*U),null)}),sr.EventTarget_addEventListener14(p,"wheel",b=>{b.ctrlKey&&xi.Event_preventDefault(b)},{passive:!1}),sr.EventTarget_addEventListener5(p,"drop",b=>{xi.Event_preventDefault(b),C(b,9,null,E_.DataTransfer_files(b.dataTransfer).map(D=>new ES(D)))}),sr.EventTarget_addEventListener4(p,"mouseenter",b=>{v=null}),sr.EventTarget_addEventListener4(h,"mouseleave",b=>{C(b,10,null,null)}),r!=null){let b=r;b.onPress(D=>{let U=new Z_(16,this.root(),0,D.buttons[0],J_.stringToTriggerDevice(D.controllerType));this.notifyAll(U)}),b.start()}sr.EventTarget_addEventListener1(_,"resize",()=>{this._resize()}),sr.EventTarget_addEventListener1(_,"visibilitychange",g),sr.EventTarget_addEventListener2(h,"contextmenu",A),sr.EventTarget_addEventListener4(h,"mousedown",a),sr.EventTarget_addEventListener6(h,"touchstart",c),sr.EventTarget_addEventListener2(p,"dragenter",A),sr.EventTarget_addEventListener2(p,"dragover",A),this._containerElement!=null&&this._containerElement.appendChild(h),this._focusedView=this.root(),g(),this._resize(),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}root(){return this._root}width(){return this._width}height(){return this._height}size(){return new O(this._width,this._height)}isActive(){return this._isActive}focusedView(){return this._focusedView}devicePixelRatio(){return this._devicePixelRatio}eventsBefore(){return this._eventHandlersBefore}eventsAfter(){return this._eventHandlersAfter}events(){return this._events}setRecordInteractionCallback(e){this._recordInteractionCallback=e}stopRecordingInteractions(){this._recordInteractionCallback=null}maybeRecordInteraction(e){this._recordInteractionCallback!=null&&this._recordInteractionCallback(e)}notify(e){this.maybeRecordInteraction(e);let r=e.target().selfAndParents();if(rr.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let n of r)if(rr.trigger(n.events(),e),e.isAccepted())return;rr.trigger(this._eventHandlersAfter,e)}}notifyAll(e){let r=e.target().selfAndChildren();if(rr.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let n of r)if(rr.trigger(n.events(),e),e.isAccepted())return;rr.trigger(this._eventHandlersAfter,e)}}dangerouslyDisableOnFrameCallbackForTesting(){this._disableOwnOnFrameCallback=!0}_resize(){if(this._containerElement==null)return;let e=document.body,r=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().width:this._containerElement==e?window.innerWidth:this._containerElement.clientWidth,n=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().height:this._containerElement==e?window.innerHeight:this._containerElement.clientHeight,o=zo();(this._width!=r||this._height!=n||this._devicePixelRatio!=o)&&(this._width=r,this._height=n,this._devicePixelRatio=o,this.root().invalidateBounds(),this.notifyAll(new oa(2,this.root(),0)))}setFocusedView(e){this._focusedView=e}createDiv(){return document.createElement("div")}setNewContainerElement(e){if(e==null)throw new Error("Can't mount the viewer in a null DOM node");this._containerElement=e,e.appendChild(this.root().element()),this._resize(),this._internalOnFrameID!=0&&cancelAnimationFrame(this._internalOnFrameID),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}resetStateForTests(){this._width=0,this._height=0,this._devicePixelRatio=0}};var cb;(r=>{function t(){return[]}r.new1=t;function e(n){return n.slice()}r.new2=e})(cb||(cb={}));var Yt;(S=>{function t(R){return R.length}S.FrozenList_count=t;function e(R){return R.length==0}S.FrozenList_isEmpty=e;function r(R,E){return R[E]}S.FrozenList_get=r;function n(R){return ie.List_last(R)}S.FrozenList_last=n;function o(R,E){return R.some(E)}S.FrozenList_any=o;function i(R,E){return R.filter(E)}S.FrozenList_filter=i;function a(R,E){R.forEach(E)}S.FrozenList_each=a;function s(R){return R[0]}S.FrozenList_first=s;function l(R,E){return R.map(E)}S.FrozenList_map=l;function c(R){return R.slice()}S.FrozenList_clone=c;function d(R,E,P){return R.slice(E,P)}S.FrozenList_slice=d;function u(R,E){let P=R.slice();return ie.List_appendOne(P,E),P}S.FrozenList_cloneAndAppendOne=u;function p(R,E){let P=R.slice();return ie.List_removeOne(P,E),P}S.FrozenList_cloneAndRemoveOne=p;function _(R,E,P){return ie.List_equalsWithComparison(R,E,P)}S.FrozenList_equals=_;function h(R,E){return R.indexOf(E)!=-1}S._in=h;function A(R,E){for(let P of R)if(E(P))return!0;return!1}S.FrozenList_contains=A;function m(R,E){let P=R.slice();return P.sort(E),P}S.FrozenList_sorted=m;function g(R,E){let P=R.slice();return P.push(E),P}S.FrozenList_cloneAndAppend=g})(Yt||(Yt={}));var dn=class{add(e){this._observers=Yt.FrozenList_cloneAndAppendOne(this._observers,e)}remove(e){this._observers=Yt.FrozenList_cloneAndRemoveOne(this._observers,e)}forEach(e){let r=this._observers;r.forEach(n=>{(r==this._observers||this._observers.indexOf(n)!=-1)&&e(n)})}constructor(){this._observers=[]}};var gr;(p=>{function t(_,h){return pi.string_compare(_,h)}p.compare=t;function e(_,h){return _==h}p.equals=e;function r(_){return _}p.toString=r;function n(_){return _.length>0}p.isValid=n;function o(_){let h=_,A=h.length-1,m=A;for(;m>=0;){let g=h.charCodeAt(m);if(g>p.LOWER+1)return h.slice(0,m)+String.fromCharCode(g-1);m=m-1}return h.slice(0,A)+String.fromCharCode(p.LOWER)+String.fromCharCode(p.UPPER)}p.before=o;function i(_){let h=_,A=h.length-1;for(;A>=0;){let m=h.charCodeAt(A);if(m<p.UPPER)return h.slice(0,A)+String.fromCharCode(m+1);A=A-1}return h+String.fromCharCode(p.LOWER+1)}p.after=i;function a(_){if(_==null||_==""||_.charCodeAt(_.length-1)==p.LOWER)return null;for(let h=0,A=_.length;h<A;h=h+1)if(_.charCodeAt(h)<p.LOWER||_.charCodeAt(h)>p.UPPER)return null;return _}p.fromString=a;function s(_,h){let A=_,m=h,g=A.length,S=m.length,R="",E=!1;for(let P=0,T=Math.max(g,S);P<T;P=P+1){let f=P<g?A.charCodeAt(P):p.LOWER,y=P<S&&!E?m.charCodeAt(P):p.UPPER;if(f==y)R+=String.fromCharCode(f);else if(y-f>1){R+=String.fromCharCode(f+y>>1),E=!1;break}else R+=String.fromCharCode(f),E=!0}return E&&(R+=String.fromCharCode(p.LOWER+p.UPPER>>1)),R}p.between=s,p.LOWER=32,p.UPPER=126,p.FIRST_POSITION=String.fromCharCode(p.LOWER+1),p.SECOND_POSITION=String.fromCharCode(p.LOWER+2)})(gr||(gr={}));var un=class t{toString(){return`${this.id};${gr.toString(this.position)}`}equals(e){return Q.equals(this.id,e.id)&&gr.equals(this.position,e.position)}static fromString(e){let r=e.indexOf(";");if(r==-1)return null;let n=e.slice(0,r);if(n=="-1:-1")return null;let o=Q.fromString(n);return new t(o,gr.fromString(e.slice(r+1)))}constructor(e,r){this.id=e,this.position=r}};var ot;(ir=>{function t(le){try{if(r(le))return le.toString();if(n(le))return E(le).toString();if(o(le))return P(le).toString();if(a(le))return le;if(le instanceof Array)return le.length===0?"[]":"toString"in le[0]?"["+le.map(Ut=>Ut.toString()).join(", ")+"]":"[...]";if("toString"in le)return le.toString()}catch{}return"?"}ir.toString=t;function e(le,Ut){return r(le)&&r(Ut)?le.equals1(Ut):s(le)&&s(Ut)?le.equals(Ut):(n(le)||o(le)||a(le)||fc(le),le==Ut)}ir.equals=e;function r(le){return le instanceof X}ir.isAffineTransform=r;function n(le){return typeof le=="boolean"}ir.isBool=n;function o(le){return typeof le=="number"}ir.isDouble=o;function i(le){return le.guid!==void 0&&le.ref!==void 0}ir.isStyleId=i;function a(le){return typeof le=="string"}ir.isString=a;function s(le){return le instanceof O}ir.isVector=s;function l(le){return le instanceof Array}ir.isList=l;function c(le){return le instanceof un}ir.isParentIndex=c;function d(le){return typeof le=="string"}ir.isGUID=d;function u(le){return typeof le=="string"}ir.isScrollDirection=u;function p(le){return typeof le=="string"}ir.isPosition=p;function _(le){return typeof le=="string"}ir.isScrollBehavior=_;function h(le){return typeof le=="string"}ir.isNavigationType=h;function A(le){return typeof le=="string"}ir.isOverlayPositionType=A;function m(le){return typeof le=="string"}ir.isOverlayBackgroundInteraction=m;function g(le){return typeof le=="string"}ir.isShapeWithTextType=g;function S(le){return le.autoplay!==void 0&&le.mediaLoop!==void 0&&le.muted!==void 0&&le.showControls!==void 0}ir.isVideoPlayback=S;function R(le){return le}ir.asAffineTransform=R;function E(le){return!!le}ir.asBool=E;function P(le){return+le}ir.asDouble=P;function T(le){return le}ir.asStyleId=T;function f(le){return le}ir.asInt=f;function y(le){return le}ir.asString=y;function v(le,Ut){return a(le)?le:Ut}ir.asStringEnum=v;function w(le){return le}ir.asVector=w;function I(le){return le}ir.asPaintList=I;function C(le){return le}ir.asPaintData=C;function L(le){return le}ir.asEffectList=L;function B(le){return le}ir.asTransformModifierList=B;function V(le){return le}ir.asExportSettingsList=V;function b(le){return le}ir.asParentIndex=b;function D(le){return le}ir.asGUID=D;function U(le){return le}ir.asScrollDirection=U;function H(le){return le}ir.asPosition=H;function k(le){return le}ir.asScrollBehavior=k;function z(le){return le}ir.asNavigationType=z;function q(le){return le}ir.asOverlayPositionType=q;function Y(le){return le}ir.asOverlayBackgroundInteraction=Y;function j(le){return le}ir.asArcData=j;function ae(le){return le}ir.asShapeWithTextType=ae;function xe(le){return le}ir.asVideoPlayback=xe,ir.ZERO_VECTOR=ge.FrozenVector_new1(),ir.IDENTITY_TRANSFORM=yt.FrozenAffineTransform_new1(),ir.EMPTY_PAINT_LIST=[],ir.EMPTY_EFFECT_LIST=[],ir.DEFAULT_ARC_DATA={startingAngle:0,endingAngle:2*Math.PI,innerRadius:0}})(ot||(ot={}));var Ht=class t{static getEventEmitter(){return t._eventEmitter||(t._eventEmitter=new t),t._eventEmitter}on(e,r){ie.List_appendOne(this._list(e),r)}off(e,r){ie.List_removeOne(this._list(e),r)}trigger(e,r){let n=this._list(e).slice();for(let o of n)o(r)}constructor(){this._callbacks=new Map}_list(e){return this._callbacks.has(e)?this._callbacks.get(e):(this._callbacks.set(e,[]),this._callbacks.get(e))}};(r=>{class t{constructor(){this._emitter=r.getEventEmitter()}handleAction(o,i){switch(o){case 5:{this._emitter.trigger("mirrorTap");break}case 6:{this._emitter.trigger("canvasMouseDown",ot.asVector(i).toJSON());break}case 7:{this._emitter.trigger("canvasMouseMove",ot.asVector(i).toJSON());break}case 8:{this._emitter.trigger("canvasMouseDrag",ot.asVector(i).toJSON());break}case 9:{this._emitter.trigger("canvasMouseUp",ot.asVector(i).toJSON());break}case 10:{this._emitter.trigger("canvasTouchDown",ot.asVector(i).toJSON());break}}}}r.ActionHandler=t;class e{constructor(o){this._emitter=r.getEventEmitter();this._state=o,this._visible=!1}onFrame(){let o=this._state.baseScreenNode()!=null;this._visible!=o&&(this._visible=o,this._emitter.trigger("baseScreenVisibilityChange",this._visible))}}r.AppHandler=e})(Ht||(Ht={}));var Tu=class{constructor(e){this.MAX_ACTIVE_EMBEDDED_PROTOTYPES=2;this.PRELOAD_WINDOW_NUM_UPCOMING_SLIDES=3;this.PRELOAD_WINDOW_NUM_PREVIOUS_SLIDES=1;this.appState=e,this.appState.prototypeState().addObserver(this),this._emitter=Ht.getEventEmitter(),this._activePrototypes=[],this._requestedPrototypes=new Set,this._prototypeToSessionIdMap=new Map}getPrototypesForBaseScreen(e){let r=new Set;return e.forEachDescendantPreorder(n=>{n.isEmbeddedPrototype()&&r.add(n.id())}),r}getRequestedPrototypes(){return Array.from(this._requestedPrototypes).reverse()}getPreloadWindowBaseScreenIds(){let e=this.appState.prototypeState().getCurrentBaseScreenId(),r=this.appState.prototypeStructure().topLevelPrototypeNodesInOrder(),n=r.findIndex(s=>s===e);if(n===-1)return[];let o=r.slice(n+1,n+1+this.PRELOAD_WINDOW_NUM_UPCOMING_SLIDES),i=r.slice(n-this.PRELOAD_WINDOW_NUM_PREVIOUS_SLIDES,n).reverse();return[e,...o,...i]}reset(){this._activePrototypes=[],this._requestedPrototypes=new Set}_recomputePreloadedPrototypes(){let e=this.getPreloadWindowBaseScreenIds(),r=[],n=this.getRequestedPrototypes();for(let o of e){let i=this.appState.scene().findNode(o);if(i==null)continue;let a=this.getPrototypesForBaseScreen(i);for(let s of n)a.has(s)&&(r.push(s),a.delete(s));for(let s of a)r.push(s)}this._activePrototypes=r}_broadcastState(){let e=[];for(let r of this.activePrototypes())e.push({nodeId:Q.toFigGUID(r),sessionId:this._prototypeToSessionIdMap.get(r)??-1});this._emitter.trigger("embeddedPrototypeDataChange",e),this.appState.prototypeState().notifyMultiplayerEmbeddedPrototypeDataChange(e)}activePrototypes(e=!1){return e?this._activePrototypes:this._activePrototypes.slice(0,this.MAX_ACTIVE_EMBEDDED_PROTOTYPES)}isActiveSlidesEmbeddedPrototype(e){return this.activePrototypes().includes(e)}requestPrototype(e){this._requestedPrototypes.delete(e),this._requestedPrototypes.add(e),this._recomputePreloadedPrototypes(),this._broadcastState()}setSessionId(e,r){r==null?this._prototypeToSessionIdMap.delete(e):this._prototypeToSessionIdMap.set(e,r),this._broadcastState()}handleStateChangeCommitted(e,r){this._recomputePreloadedPrototypes(),this._broadcastState()}handleRestartPrototype(){this.reset(),this._recomputePreloadedPrototypes()}handleStateChangeAborted(e){}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,r){}};var no=class t{add(e){this._hash.set(e,!0)}_in(e){return this._hash.has(e)}remove(e){this._hash.delete(e)}count(){return this._hash.size}asList(){return Array.from(this._hash.keys())}each(e){Array.from(this._hash.keys()).forEach(e)}map(e){return Array.from(this._hash.keys()).map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let r of Array.from(this._hash.keys()))if(!e._in(r))return!1;return!0}static fromList(e){let r=new t;for(let n of e)r.add(n);return r}constructor(){this._hash=new Map}};var yn=class yn{count(){return this._heap.length}peek(){if(this.count()==0)throw new Error("Peeking on an empty queue");return this._heap[yn.ROOT_INDEX].value}insertOrUpdate(e,r){if(this._indexByElement.has(e)){this.remove(e),this.insertOrUpdate(e,r);return}let n=new yn.Element(e,r);this._heap.push(n),this._indexByElement.set(n.value,this.count()-1),this._siftUp(this.count()-1)}getPriority(e){if(!this._indexByElement.has(e))return null;let r=this._indexByElement.get(e),n=this._heap[r];return new pe(n.priority)}remove(e){if(!this._indexByElement.has(e))return;let r=this._indexByElement.get(e),n=this.count()-1;n>r&&this._swap(r,n);let o=this._heap.pop();this._indexByElement.delete(o.value),r!=n&&(this._siftDown(r),this._siftUp(r))}allValues(){return this._heap.map(e=>e.value)}maxPriority(){if(this.count()==0)throw new Error("Calling maxPriority on an empty queue");return this._heap[yn.ROOT_INDEX].priority}pop(){if(this.count()==0)throw new Error("Popping an empty queue");let e=this.peek();return this.remove(e),e}_isGreater(e,r){return this._compare(this._heap[e].priority,this._heap[r].priority)>0}_swap(e,r){let n=this._heap[e];this._heap[e]=this._heap[r],this._heap[r]=n,this._indexByElement.set(this._heap[e].value,e),this._indexByElement.set(this._heap[r].value,r)}_siftUp(e){let r=e;for(;r>yn.ROOT_INDEX&&this._isGreater(r,yn.indexOfParent(r));)this._swap(r,yn.indexOfParent(r)),r=yn.indexOfParent(r)}_siftDown(e){let r=e;for(;yn.indexOfLeftChild(r)<this.count()&&this._isGreater(yn.indexOfLeftChild(r),r)||yn.indexOfRightChild(r)<this.count()&&this._isGreater(yn.indexOfRightChild(r),r);){let n=yn.indexOfRightChild(r)<this.count()&&this._isGreater(yn.indexOfRightChild(r),yn.indexOfLeftChild(r))?yn.indexOfRightChild(r):yn.indexOfLeftChild(r);this._swap(r,n),r=n}}static indexOfParent(e){return((e+1)/2|0)-1}static indexOfLeftChild(e){return e*2+1}static indexOfRightChild(e){return(e+1)*2}constructor(e){this._heap=[],this._indexByElement=new Map,this._compare=e}};yn.ROOT_INDEX=0;var $a=yn;(e=>{class t{constructor(n,o){this.value=n,this.priority=o}}e.Element=t})($a||($a={}));var th=class{constructor(e,r,n,o){this.bufferArea=e,this.hasNoCurves=r,this.hasNoOverlaps=n,this.hasNoCurvesAndSameOrientation=o}},St;(R=>{function t(E){return`SCROLL_OFFSET::${E}`}R.forScrollOffset=t;function e(E){return`OVERLAY_POSITION::${E}`}R.forOverlayPosition=e;function r(E){return`ANIMATEABLE_TRANSLATION::${E}`}R.forAnimateableTranslation=r;function n(E){return`SHADOW_TRANSFORMATION::${E}`}R.forShadowTransformation=n;function o(E){return`ANIMATEABLE_OPACITY::${E}`}R.forAnimateableOpacity=o;function i(E){return`ANIMATEABLE_DISSOLVE::${E}`}R.forAnimateableDissolve=i;function a(E){return`DYNAMIC_GEOMETRY::${E}`}R.forDynamicGeometry=a;function s(E){return E.id.startsWith("SCROLL_OFFSET")}R.isScrollingTransform=s;function l(E){return`EFFECT::${E}`}R.forAnimateableEffect=l,R.ENTERING_TLF="ENTERING_TLF",R.EXITING_TLF="EXITING_TLF",R.ENTERING_OVERLAY="ENTERING_OVERLAY",R.EXITING_OVERLAY="EXITING_OVERLAY",R.ENTERING_OVERLAY_BACKGROUND="ENTERING_OVERLAY_BACKGROUND",R.EXITING_OVERLAY_BACKGROUND="EXITING_OVERLAY_BACKGROUND",R.OVERLAY_BACKGROUND="OVERLAY_BACKGROUND",R.SMART_ANIMATE_OVERLAY_TRANSLATION="SMART_ANIMATE_OVERLAY_TRANSLATION",R.OVERLAY_BACKGROUND_DISSOLVE="OVERLAY_BACKGROUND_DISSOLVE",R.DISSOLVE_TRANSITION="DISSOLVE_TRANSITION"})(St||(St={}));var rh=(n=>(n[n.FULL_SIZE=0]="FULL_SIZE",n[n.THUMBNAIL=1]="THUMBNAIL",n[n.EMOJI=2]="EMOJI",n))(rh||{}),Ra=class{hash(){return`${this.image.objectHash()}:${rh[this.purpose]}`}constructor(e,r){this.image=e,this.purpose=r}};var Eu=(i=>(i[i.OTHER=0]="OTHER",i[i.PRERENDER_FULLSIZE=1]="PRERENDER_FULLSIZE",i[i.PRERENDER_THUMB=2]="PRERENDER_THUMB",i[i.ON_SCREEN_FULLSIZE=3]="ON_SCREEN_FULLSIZE",i[i.ON_SCREEN_THUMB=4]="ON_SCREEN_THUMB",i))(Eu||{}),aa=class aa{compare(e){let r=Ft.int_compare(this.type,e.type);return r!=0?r:Ft.int_compare(this.generation,e.generation)}toString(){return`${Eu[this.type]}:${this.generation}`}static advanceGeneration(){aa._generation=aa._generation+1}static forType(e){return new aa(e,aa._generation)}static forOnScreenPurpose(e){let r=Ds.ImagePriorityType_forOnScreenPurpose(e);return aa.forType(r)}static forPrerenderPurpose(e){let r=Ds.ImagePriorityType_forPrerenderPurpose(e);return aa.forType(r)}static max(e,r){return e.compare(r)>0?e:r}constructor(e,r){this.type=e,this.generation=r}};aa.OTHER=new aa(0,0),aa._generation=0;var vn=aa,nh=class{insertOrUpdate(e,r){let n=this._queue.getPriority(e);(n==null||r.compare(n.value)>0)&&this._queue.insertOrUpdate(e,r)}peek(){return this._queue.peek()}getPriority(e){let r=this._queue.getPriority(e);return r!=null?new pe(r.value):null}maxPriority(){return this._queue.count()==0?null:new pe(this._queue.maxPriority())}remove(e){this._queue.remove(e)}clear(){this._queue=new $a((e,r)=>e.compare(r))}allImages(){return this._queue.allValues()}count(){return this._queue.count()}isEmpty(){return this.count()==0}takeFirst(){return this._queue.pop()}constructor(){this._queue=new $a((e,r)=>e.compare(r))}},Ds;(o=>{function t(i){return i==3||i==4}o.ImagePriorityType_isOnScreen=t;function e(i){return i==1||i==2}o.ImagePriorityType_isPrerender=e;function r(i){switch(i){case 0:return 3;case 1:case 2:return 4}}o.ImagePriorityType_forOnScreenPurpose=r;function n(i){switch(i){case 0:return 1;case 1:case 2:return 2}}o.ImagePriorityType_forPrerenderPurpose=n})(Ds||(Ds={}));var ws;(e=>{function t(r){return r!="NONE"&&r!="PRESENTATION"}e.hasDevice=t})(ws||(ws={}));var Qt;(i=>{function t(a){return a=="BOOLEAN_OPERATION"||a=="VECTOR"||a=="STAR"||a=="LINE"||a=="ELLIPSE"||a=="RECTANGLE"||a=="REGULAR_POLYGON"||a=="ROUNDED_RECTANGLE"||a=="TEXT"||a=="STAMP"||a=="WASHI_TAPE"}i.isGeometryLeaf=t;function e(a){return a=="FRAME"||a=="SYMBOL"||a=="INSTANCE"||a=="SECTION"||o(a)||a=="TABLE_CELL"||a=="SLIDE"||a=="MODULE"||a=="CODE_INSTANCE"}i.isFrameLike=e;function r(a){return a=="CODE_LAYER"||a=="CODE_COMPONENT"||a=="CODE_INSTANCE"}i.supportsCodeSnapshot=r;function n(a){return a=="RECTANGLE"||a=="ROUNDED_RECTANGLE"||a=="ELLIPSE"||a=="STAMP"||e(a)}i.isRectOrEllipseLike=n;function o(a){return a=="STICKY"||a=="SHAPE_WITH_TEXT"||a=="CONNECTOR"||a=="CODE_BLOCK"||a=="MEDIA"||a=="SECTION_OVERLAY"||a=="TABLE"}i.isImmutableFrame=o})(Qt||(Qt={}));var xs;(r=>{function t(n){return`${n.sessionID}:${n.localID}`}r.toString=t;function e(n,o){return n.sessionID==o.sessionID&&n.localID==o.localID}r.equals=e})(xs||(xs={}));var Iu;(e=>{function t(r){return r.guid!==void 0?"VariableID:"+xs.toString(r.guid):r.assetRef!==void 0&&r.assetRef.key!=null&&r.assetRef.version!=null?"VariableID:"+r.assetRef.key+"/"+r.assetRef.version:""}e.toString=t})(Iu||(Iu={}));var oh;(e=>{function t(r){return r.guid!==void 0?"ManagedStringId:"+xs.toString(r.guid):r.assetRef!==void 0&&r.assetRef.key!=null&&r.assetRef.version!=null?"ManagedStringId:"+r.assetRef.key+"/"+r.assetRef.version:""}e.toString=t})(oh||(oh={}));var gn;(a=>{function t(s){let l=s.depth!==void 0?s.depth:-1;return`${n(s)}-${l}`}a.hash=t;function e(s,l){return t(s)==t(l)}a.equals=e;function r(s){return t(s)}a.toString=r;function n(s){let l=s.startingNode!==void 0?s.startingNode:null;return l!=null?`${l.sessionID}:${l.localID}`:"-1:-1"}a.nodeIdString=n;function o(s){let l=s.startingNode!==void 0?s.startingNode:null,c=l!=null?`${l.sessionID}:${l.localID}`:"-1:-1",d=s.depth!==void 0?s.depth:-1;return`${c}-${d}`}a.serializeForMultiplayerURL=o;function i(s,l){if((s.depth!==void 0?s.depth:-1)!=0)return!1;let d=s.startingNode!==void 0?s.startingNode:null;for(;l!=null;){if(xs.equals(Q.toFigGUID(l.id()),d))return!0;l=l.parent()}return!1}a.fullyLoadsNode=i})(gn||(gn={}));var RS;(r=>{function t(){return Q._new(-1,r._nextLocalID=r._nextLocalID+1)}r.generateId=t,r._nextLocalID=0})(RS||(RS={}));var db=null;function ub(t){db=t}function Ve(){return db}function pb(t,e){let r=e(t)||0;switch(r){case 1:return 1;case 0:break;case 2:return 0}for(let n=0,o=t.childCount();n<o;n=n+1)if(t.childAt1(n)!==void 0)switch(r=pb(t.childAt1(n),e),r){case 1:return 1;case 0:break;case 2:return 0}return 0}function kn(t,e){pb(t,e)}var Lt=(Z=>(Z[Z.MISSING__=0]="MISSING__",Z[Z.TEXT_ALIGN_HORIZONTAL=1]="TEXT_ALIGN_HORIZONTAL",Z[Z.TEXT_ALIGN_VERTICAL=2]="TEXT_ALIGN_VERTICAL",Z[Z.FONT_SIZE=3]="FONT_SIZE",Z[Z.TEXT_DATA=4]="TEXT_DATA",Z[Z.DERIVED_TEXT_DATA=5]="DERIVED_TEXT_DATA",Z[Z.HYPERLINK=6]="HYPERLINK",Z[Z.MENTION=7]="MENTION",Z[Z.VISIBLE=8]="VISIBLE",Z[Z.IS_BACKGROUND_ENABLED=9]="IS_BACKGROUND_ENABLED",Z[Z.IS_MASK=10]="IS_MASK",Z[Z.IS_MASK_OUTLINE__DEPRECATED=11]="IS_MASK_OUTLINE__DEPRECATED",Z[Z.IS_INTERNAL_ONLY=12]="IS_INTERNAL_ONLY",Z[Z.IS_FRAME_MASK_DISABLED=13]="IS_FRAME_MASK_DISABLED",Z[Z.IS_RESIZE_TO_FIT=14]="IS_RESIZE_TO_FIT",Z[Z.RECTANGLE_CORNER_RADII_INDEPENDENT=15]="RECTANGLE_CORNER_RADII_INDEPENDENT",Z[Z.RECTANGLE_CORNER_TOOL_INDEPENDENT=16]="RECTANGLE_CORNER_TOOL_INDEPENDENT",Z[Z.INTERACTION_MAINTAINED__DEPRECATED=17]="INTERACTION_MAINTAINED__DEPRECATED",Z[Z.TRANSITION_PRESERVE_SCROLL__DEPRECATED=18]="TRANSITION_PRESERVE_SCROLL__DEPRECATED",Z[Z.TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED=19]="TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED",Z[Z.BORDER_TOP_WEIGHT=20]="BORDER_TOP_WEIGHT",Z[Z.BORDER_BOTTOM_WEIGHT=21]="BORDER_BOTTOM_WEIGHT",Z[Z.BORDER_LEFT_WEIGHT=22]="BORDER_LEFT_WEIGHT",Z[Z.BORDER_RIGHT_WEIGHT=23]="BORDER_RIGHT_WEIGHT",Z[Z.BORDER_STROKE_WEIGHTS_INDEPENDENT=24]="BORDER_STROKE_WEIGHTS_INDEPENDENT",Z[Z.TYPE=25]="TYPE",Z[Z.HORIZONTAL_CONSTRAINT=26]="HORIZONTAL_CONSTRAINT",Z[Z.VERTICAL_CONSTRAINT=27]="VERTICAL_CONSTRAINT",Z[Z.BLEND_MODE=28]="BLEND_MODE",Z[Z.STROKE_ALIGN=29]="STROKE_ALIGN",Z[Z.RELATIVE_TRANSFORM=30]="RELATIVE_TRANSFORM",Z[Z.OVERLAY_TRANSFORM=31]="OVERLAY_TRANSFORM",Z[Z.PARENT_INDEX=32]="PARENT_INDEX",Z[Z.CONNECTION_TYPE__DEPRECATED=33]="CONNECTION_TYPE__DEPRECATED",Z[Z.TRANSITION_TYPE__DEPRECATED=34]="TRANSITION_TYPE__DEPRECATED",Z[Z.EASING_TYPE__DEPRECATED=35]="EASING_TYPE__DEPRECATED",Z[Z.INTERACTION_TYPE__DEPRECATED=36]="INTERACTION_TYPE__DEPRECATED",Z[Z.NAVIGATION_TYPE__DEPRECATED=37]="NAVIGATION_TYPE__DEPRECATED",Z[Z.OVERLAY_POSITION_TYPE=38]="OVERLAY_POSITION_TYPE",Z[Z.OVERLAY_BACKGROUND_INTERACTION=39]="OVERLAY_BACKGROUND_INTERACTION",Z[Z.STYLE_TYPE=40]="STYLE_TYPE",Z[Z.OVERFLOW_DIRECTION=41]="OVERFLOW_DIRECTION",Z[Z.SCROLL_BEHAVIOR=42]="SCROLL_BEHAVIOR",Z[Z.MASK_TYPE=43]="MASK_TYPE",Z[Z.OPACITY=44]="OPACITY",Z[Z.LOCAL_OPACITY=45]="LOCAL_OPACITY",Z[Z.BACKGROUND_OPACITY=46]="BACKGROUND_OPACITY",Z[Z.RECTANGLE_TOP_LEFT_CORNER_RADIUS=47]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",Z[Z.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=48]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",Z[Z.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=49]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",Z[Z.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=50]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",Z[Z.STROKE_WEIGHT=51]="STROKE_WEIGHT",Z[Z.CORNER_RADIUS=52]="CORNER_RADIUS",Z[Z.CORNER_SMOOTHING=53]="CORNER_SMOOTHING",Z[Z.TRANSITION_DURATION__DEPRECATED=54]="TRANSITION_DURATION__DEPRECATED",Z[Z.TRANSITION_TIMEOUT__DEPRECATED=55]="TRANSITION_TIMEOUT__DEPRECATED",Z[Z.INTERACTION_DURATION__DEPRECATED=56]="INTERACTION_DURATION__DEPRECATED",Z[Z.SIZE_VECTOR_F=57]="SIZE_VECTOR_F",Z[Z.OVERRIDE_KEY=58]="OVERRIDE_KEY",Z[Z.OVERRIDDEN_SYMBOL_ID=59]="OVERRIDDEN_SYMBOL_ID",Z[Z.OVERLAY_RELATIVE_POSITION__DEPRECATED=60]="OVERLAY_RELATIVE_POSITION__DEPRECATED",Z[Z.FILL_PAINT_DATA=61]="FILL_PAINT_DATA",Z[Z.STROKE_PAINT_DATA=62]="STROKE_PAINT_DATA",Z[Z.TEXT_DECORATION_FILL_PAINT_DATA=63]="TEXT_DECORATION_FILL_PAINT_DATA",Z[Z.EFFECT_DATA=64]="EFFECT_DATA",Z[Z.NAME=65]="NAME",Z[Z.ARC_DATA=66]="ARC_DATA",Z[Z.BACKGROUND_COLOR=67]="BACKGROUND_COLOR",Z[Z.PROTOTYPE_BACKGROUND_COLOR=68]="PROTOTYPE_BACKGROUND_COLOR",Z[Z.PROTOTYPE_DEVICE=69]="PROTOTYPE_DEVICE",Z[Z.OVERLAY_BACKGROUND_APPEARANCE=70]="OVERLAY_BACKGROUND_APPEARANCE",Z[Z.EXPORT_SETTINGS_DATA=71]="EXPORT_SETTINGS_DATA",Z[Z.PROTOTYPE_START_NODE_ID=72]="PROTOTYPE_START_NODE_ID",Z[Z.CONNECTION_URL_DEPRECATED=73]="CONNECTION_URL_DEPRECATED",Z[Z.TRANSITION_NODE_ID_DEPRECATED=74]="TRANSITION_NODE_ID_DEPRECATED",Z[Z.VIDEO_PLAYBACK=75]="VIDEO_PLAYBACK",Z[Z.FILL_GEOMETRY=76]="FILL_GEOMETRY",Z[Z.STROKE_GEOMETRY=77]="STROKE_GEOMETRY",Z[Z.SYMBOL_DATA=78]="SYMBOL_DATA",Z[Z.COMPILED_VECTOR_DATA=79]="COMPILED_VECTOR_DATA",Z[Z.STACK_MODE=80]="STACK_MODE",Z[Z.STACK_PADDING_LEFT=81]="STACK_PADDING_LEFT",Z[Z.STACK_PADDING_TOP=82]="STACK_PADDING_TOP",Z[Z.STACK_PADDING_RIGHT=83]="STACK_PADDING_RIGHT",Z[Z.STACK_PADDING_BOTTOM=84]="STACK_PADDING_BOTTOM",Z[Z.STACK_SPACING=85]="STACK_SPACING",Z[Z.STACK_REVERSE_Z_INDEX=86]="STACK_REVERSE_Z_INDEX",Z[Z.STACK_COUNTER_SPACING=87]="STACK_COUNTER_SPACING",Z[Z.KEY_TRIGGER__DEPRECATED=88]="KEY_TRIGGER__DEPRECATED",Z[Z.IS_STATE_GROUP=89]="IS_STATE_GROUP",Z[Z.PROTOTYPE_INTERACTIONS=90]="PROTOTYPE_INTERACTIONS",Z[Z.OBJECT_ANIMATIONS=91]="OBJECT_ANIMATIONS",Z[Z.VOICE_EVENT_PHRASE__DEPRECATED=92]="VOICE_EVENT_PHRASE__DEPRECATED",Z[Z.PROTOTYPE_STARTING_POINT=93]="PROTOTYPE_STARTING_POINT",Z[Z.SHAPE_WITH_TEXT_TYPE=94]="SHAPE_WITH_TEXT_TYPE",Z[Z.INTERACTIVE_SLIDE_CONFIG_DATA=95]="INTERACTIVE_SLIDE_CONFIG_DATA",Z[Z.INTERACTIVE_SLIDE_PARTICIPANT_DATA=96]="INTERACTIVE_SLIDE_PARTICIPANT_DATA",Z[Z.INTERACTIVE_SLIDE_ELEMENT_TYPE=97]="INTERACTIVE_SLIDE_ELEMENT_TYPE",Z[Z.SCROLL_OFFSET=98]="SCROLL_OFFSET",Z[Z.USED_AS_BASE_SCREEN=99]="USED_AS_BASE_SCREEN",Z[Z.CURRENT_VIEWPORT_SIZE=100]="CURRENT_VIEWPORT_SIZE",Z[Z.HAS_BEEN_LOADED=101]="HAS_BEEN_LOADED",Z[Z.STYLE_ID_FOR_FILL=102]="STYLE_ID_FOR_FILL",Z[Z.STYLE_ID_FOR_STROKE_FILL=103]="STYLE_ID_FOR_STROKE_FILL",Z[Z.STYLE_ID_FOR_TEXT=104]="STYLE_ID_FOR_TEXT",Z[Z.STYLE_ID_FOR_EFFECT=105]="STYLE_ID_FOR_EFFECT",Z[Z.STYLE_ID_FOR_GRID=106]="STYLE_ID_FOR_GRID",Z[Z.PAGE_TYPE=107]="PAGE_TYPE",Z[Z.SLIDE_THUMBNAIL_HASH=108]="SLIDE_THUMBNAIL_HASH",Z[Z.SLIDE_SPEAKER_NOTES=109]="SLIDE_SPEAKER_NOTES",Z[Z.BEHAVIORS=110]="BEHAVIORS",Z[Z.IS_SKIPPED_SLIDE=111]="IS_SKIPPED_SLIDE",Z[Z.CODE_SNAPSHOT=112]="CODE_SNAPSHOT",Z[Z.TRANSFORM_MODIFIERS=113]="TRANSFORM_MODIFIERS",Z[Z.PHASE=114]="PHASE",Z[Z.END__=115]="END__",Z))(Lt||{});var Sr;(d=>{function t(u,p){let _=s();for(let h=0,A=u.length;h<A;h=h+1)r(_,u[h],p[h]);return _}d.new1=t;function e(u,p){return u.has(Lt[p])}d._in=e;function r(u,p,_){let h=Lt[p];d._remapKey.set(h,p),u.set(h,_)}d.set=r;function n(u,p,_=null){return Qe.StringMap_get(u,Lt[p],_)}d.get=n;function o(u,p){u.delete(Lt[p])}d.remove=o;function i(u,p){Qe.StringMap_each(u,(_,h)=>{p(d._remapKey.get(_),h)})}d.each=i;function a(u){let p=[];return Qe.StringMap_each(u,(_,h)=>{p.push(`${_}=${ot.toString(h)}`)}),`{${p.join(", ")}}`}d.toString=a;function s(){return new Map}d._new=s,d._remapKey=new Map,d.EMPTY=s()})(Sr||(Sr={}));var ya;(o=>{function t(i,a){return Sr._in(i,a)}o._in=t;function e(i,a,s=null){return Sr.get(i,a,s)}o.get=e;function r(i,a){Sr.each(i,a)}o.each=r;function n(i){return Sr.toString(i)}o.toString=n})(ya||(ya={}));var Wo=class t{constructor(){this._float=null,this._int=null,this._value=0,this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer)}reset(){this._value=0}value(){return this._value}hash1(e){this._float[0]=e,this._value=t.combine(this._value,this._int[0])}hash2(e){this._value=t.combine(this._value,e)}static combine(e,r){return r+-1640531527+(e<<6)+(e>>2)}};function _b(t,e,r){if(e==5&&t[4].equals(t[0])&&(e=e-1),e!=4)return!1;let s=.001,l=0,c=0;for(let d=0;d<e;d=d+1){let u=t[d],p=0;if(u.x()<r.left()+s)if(u.y()<r.top()+s)p=0;else if(u.y()>r.bottom()-s)p=2;else return!1;else if(u.x()>r.right()-s)if(u.y()<r.top()+s)p=1;else if(u.y()>r.bottom()-s)p=3;else return!1;else return!1;if(d>0){let _=l^p;if(_!=1&&_!=2)return!1}c|=1<<p,l=p}return c==15}var Ru=class{constructor(e,r){this.bounds=e,this.isRect=r}},$e=class t{constructor(){this.VERTEX_PATTERN_COUNT=5;this.VERTEX_PATTERN=[null,null,null,null,null];this._data=arguments[0],arguments.length==1?(this._cachedInfo=null,this._hash=null):arguments.length==3&&(this._cachedInfo=arguments[1],this._hash=new pe(arguments[2]))}_invalidateCachedData(){this._cachedInfo=null,this._hash=null}equals2(e){return e instanceof t?this.equals1(e):!1}equals1(e){return this._data.byteCount()!=e._data.byteCount()||this.hash()!=e.hash()?!1:R_.FrozenDataArray_equals(this._data,e._data)}clone(){return this.getMutableClone()}getMutableClone(){return new Bt(this._data.clone())}isEmpty(){return this._data.isEmpty()}start(){return 0}bounds(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.bounds}isRect(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.isRect}asRoundedRectPath(){return null}canBeAnalyticallyAntialiased(){return!1}hash(){if(this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._hash==null){let e=new Wo;for(let r=0,n=this._data.byteCount();r<n;r=r+1)e.hash2(this._data.byteAt(r));this._hash=new pe(e.value())}return this._hash.value}countCommands(){let e=0;for(let r=this.start();t.Command.isValid(r,this);r=t.Command.next(r,this))e=e+1;return e}_computeBoundsAndRectInfo(){let e=Et.INSTANCE;e.reset();for(let c=0,d=this.VERTEX_PATTERN_COUNT;c<d;c=c+1)this.VERTEX_PATTERN[c]=null;let r=!1,n=!1,o=0,i=O.new(),a=c=>{o<this.VERTEX_PATTERN_COUNT&&(this.VERTEX_PATTERN[o]=c),e.include2(c),o=o+1};for(let c=this.start();t.Command.isValid(c,this);c=t.Command.next(c,this))switch(t.Command.kind(c,this)){case t.Command.Kind.CLOSE:{n=!1;break}case t.Command.Kind.MOVE_TO:{i=t.Command.point(c,this),n=!1;break}case t.Command.Kind.LINE_TO:case t.Command.Kind.QUADRATIC_TO:case t.Command.Kind.CUBIC_TO:{n||(a(i),n=!0),t.Command.kind(c,this)==t.Command.Kind.QUADRATIC_TO?(e.include2(t.Command.control1(c,this)),r=!0):t.Command.kind(c,this)==t.Command.Kind.CUBIC_TO&&(e.include2(t.Command.control1(c,this)),e.include2(t.Command.control2(c,this)),r=!0),i=t.Command.point(c,this),a(i);break}default:break}let s=e.isValid()?e.build():x.INVALID,l=!r&&o<=this.VERTEX_PATTERN_COUNT&&_b(this.VERTEX_PATTERN,o,s);return new Ru(s,l)}toBezierPath(){return this}toString(){let e="";for(let r=this.start();t.Command.isValid(r,this);r=t.Command.next(r,this))switch(r!=this.start()&&(e+=" "),t.Command.kind(r,this)){case t.Command.Kind.CLOSE:{e+="Z";break}case t.Command.Kind.MOVE_TO:{e+=`M ${t.Command.moveToX(r,this)} ${t.Command.moveToY(r,this)}`;break}case t.Command.Kind.LINE_TO:{e+=`L ${t.Command.lineToX(r,this)} ${t.Command.lineToY(r,this)}`;break}case t.Command.Kind.QUADRATIC_TO:{e+=`Q ${t.Command.quadraticToFirstX(r,this)} ${t.Command.quadraticToFirstY(r,this)} ${t.Command.quadraticToX(r,this)} ${t.Command.quadraticToY(r,this)}`;break}case t.Command.Kind.CUBIC_TO:{e+=`C ${t.Command.cubicToFirstX(r,this)} ${t.Command.cubicToFirstY(r,this)} ${t.Command.cubicToSecondX(r,this)} ${t.Command.cubicToSecondY(r,this)} ${t.Command.cubicToX(r,this)} ${t.Command.cubicToY(r,this)}`;break}default:{break}}return e}data(){return this._data}};(e=>{let t;(q=>{function r(Y,j){return j.data().byteAt(Y)}q.kind=r;function n(Y,j){let ae=r(Y,j);return Y+(ae==4?1+4*6:ae==3?1+4*4:ae==0?1:1+4*2)}q.next=n;function o(Y,j){if(Y>=j.data().byteCount())return!1;let ae=0;switch(r(Y,j)){case 0:{ae=1;break}case 1:case 2:{ae=1+1*8;break}case 3:{ae=1+2*8;break}case 4:{ae=1+3*8;break}default:return!1}return Y+ae<=j.data().byteCount()}q.isValid=o;function i(Y,j){return l(Y,j,r(Y,j)==3?1:r(Y,j)==4?2:0)}q.point=i;function a(Y,j){return l(Y,j,0)}q.control1=a;function s(Y,j){return l(Y,j,1)}q.control2=s;function l(Y,j,ae){return new O(j.data().floatAt(Y+1+8*ae),j.data().floatAt(Y+1+8*ae+4))}q.pointAtIndex=l;function c(Y,j){return j.data().floatAt(Y+1)}q.moveToX=c;function d(Y,j){return j.data().floatAt(Y+5)}q.moveToY=d;function u(Y,j,ae){j.setFloatAt(Y+1,ae)}q.setMoveToX=u;function p(Y,j,ae){j.setFloatAt(Y+5,ae)}q.setMoveToY=p;function _(Y,j){return j.data().floatAt(Y+1)}q.lineToX=_;function h(Y,j){return j.data().floatAt(Y+5)}q.lineToY=h;function A(Y,j,ae){j.setFloatAt(Y+1,ae)}q.setLineToX=A;function m(Y,j,ae){j.setFloatAt(Y+5,ae)}q.setLineToY=m;function g(Y,j){return j.data().floatAt(Y+1)}q.quadraticToFirstX=g;function S(Y,j){return j.data().floatAt(Y+5)}q.quadraticToFirstY=S;function R(Y,j){return j.data().floatAt(Y+(1+4*2))}q.quadraticToX=R;function E(Y,j){return j.data().floatAt(Y+(1+4*3))}q.quadraticToY=E;function P(Y,j,ae){j.setFloatAt(Y+1,ae)}q.setQuadraticToFirstX=P;function T(Y,j,ae){j.setFloatAt(Y+5,ae)}q.setQuadraticToFirstY=T;function f(Y,j,ae){j.setFloatAt(Y+(1+4*2),ae)}q.setQuadraticToX=f;function y(Y,j,ae){j.setFloatAt(Y+(1+4*3),ae)}q.setQuadraticToY=y;function v(Y,j){return j.data().floatAt(Y+1)}q.cubicToFirstX=v;function w(Y,j){return j.data().floatAt(Y+5)}q.cubicToFirstY=w;function I(Y,j){return j.data().floatAt(Y+(1+4*2))}q.cubicToSecondX=I;function C(Y,j){return j.data().floatAt(Y+(1+4*3))}q.cubicToSecondY=C;function L(Y,j){return j.data().floatAt(Y+(1+4*4))}q.cubicToX=L;function B(Y,j){return j.data().floatAt(Y+(1+4*5))}q.cubicToY=B;function V(Y,j,ae){j.setFloatAt(Y+1,ae)}q.setCubicToFirstX=V;function b(Y,j,ae){j.setFloatAt(Y+5,ae)}q.setCubicToFirstY=b;function D(Y,j,ae){j.setFloatAt(Y+(1+4*2),ae)}q.setCubicToSecondX=D;function U(Y,j,ae){j.setFloatAt(Y+(1+4*3),ae)}q.setCubicToSecondY=U;function H(Y,j,ae){j.setFloatAt(Y+(1+4*4),ae)}q.setCubicToX=H;function k(Y,j,ae){j.setFloatAt(Y+(1+4*5),ae)}q.setCubicToY=k;let z;(We=>(We[We.CLOSE=0]="CLOSE",We[We.MOVE_TO=1]="MOVE_TO",We[We.LINE_TO=2]="LINE_TO",We[We.QUADRATIC_TO=3]="QUADRATIC_TO",We[We.CUBIC_TO=4]="CUBIC_TO"))(z=q.Kind||(q.Kind={}))})(t=e.Command||(e.Command={}))})($e||($e={}));var At=class At extends $e{constructor(e){super(e)}static mutableData(e){return e._data}append(e){this._invalidateCachedData(),!this.isEmpty()&&!e.isEmpty()&&$e.Command.kind(e.start(),e)!=1&&this.moveTo1(0,0),this._data.appendBytes(e.data())}setFloatAt(e,r){this._invalidateCachedData(),this._data.setFloatAt(e,r)}moveTo1(e,r){return this._invalidateCachedData(),this._data.appendByte(1),this._data.appendFloat(e),this._data.appendFloat(r),this}moveTo2(e){return this.moveTo1(e.x(),e.y())}lineTo(e,r){return this._invalidateCachedData(),this._data.appendByte(2),this._data.appendFloat(e),this._data.appendFloat(r),this}quadraticTo(e,r,n,o){return this._invalidateCachedData(),this._data.appendByte(3),this._data.appendFloat(e),this._data.appendFloat(r),this._data.appendFloat(n),this._data.appendFloat(o),this}cubicTo1(e,r,n,o,i,a){return this._invalidateCachedData(),this._data.appendByte(4),this._data.appendFloat(e),this._data.appendFloat(r),this._data.appendFloat(n),this._data.appendFloat(o),this._data.appendFloat(i),this._data.appendFloat(a),this}cubicTo2(e,r,n){return this.cubicTo1(e.x(),e.y(),r.x(),r.y(),n.x(),n.y())}close(){return this._invalidateCachedData(),this._data.appendByte(0),this}transformBy(e){this._invalidateCachedData(),!this.isEmpty()&&$e.Command.kind(this.start(),this)!=1&&this._data.prependBytes(new At(new Bn).moveTo1(0,0)._data);for(let r=this.start();$e.Command.isValid(r,this);r=$e.Command.next(r,this))switch($e.Command.kind(r,this)){case 0:break;case 1:{At._p0.setTo($e.Command.moveToX(r,this),$e.Command.moveToY(r,this)),e.transformPoint(At._p0),$e.Command.setMoveToX(r,this,At._p0.x()),$e.Command.setMoveToY(r,this,At._p0.y());break}case 2:{At._p0.setTo($e.Command.lineToX(r,this),$e.Command.lineToY(r,this)),e.transformPoint(At._p0),$e.Command.setLineToX(r,this,At._p0.x()),$e.Command.setLineToY(r,this,At._p0.y());break}case 3:{At._p0.setTo($e.Command.quadraticToFirstX(r,this),$e.Command.quadraticToFirstY(r,this)),e.transformPoint(At._p0),$e.Command.setQuadraticToFirstX(r,this,At._p0.x()),$e.Command.setQuadraticToFirstY(r,this,At._p0.y()),At._p0.setTo($e.Command.quadraticToX(r,this),$e.Command.quadraticToY(r,this)),e.transformPoint(At._p0),$e.Command.setQuadraticToX(r,this,At._p0.x()),$e.Command.setQuadraticToY(r,this,At._p0.y());break}case 4:{At._p0.setTo($e.Command.cubicToFirstX(r,this),$e.Command.cubicToFirstY(r,this)),e.transformPoint(At._p0),$e.Command.setCubicToFirstX(r,this,At._p0.x()),$e.Command.setCubicToFirstY(r,this,At._p0.y()),At._p0.setTo($e.Command.cubicToSecondX(r,this),$e.Command.cubicToSecondY(r,this)),e.transformPoint(At._p0),$e.Command.setCubicToSecondX(r,this,At._p0.x()),$e.Command.setCubicToSecondY(r,this,At._p0.y()),At._p0.setTo($e.Command.cubicToX(r,this),$e.Command.cubicToY(r,this)),e.transformPoint(At._p0),$e.Command.setCubicToX(r,this,At._p0.x()),$e.Command.setCubicToY(r,this,At._p0.y());break}default:break}}static new2(){return new At(new Bn)}static fromRect(e){return At._fromRect(e.x(),e.y(),e.width(),e.height())}static _fromRect(e,r,n,o){let i=At.new2();return i.moveTo1(e,r).lineTo(e+n,r).lineTo(e+n,r+o).lineTo(e,r+o).close(),i}static fromRoundedRectWithSpread(e,r){return e.adjustCornerRadiiForSpread(r),At.fromRoundedRect1(e)}static fromRoundedRect1(e){return e.vertexRadii()!=null?At.fromRoundedRect3(e.left(),e.top(),e.width(),e.height(),e.vertexRadii()):At.fromRoundedRect2(e.left(),e.top(),e.width(),e.height(),e.nodeRadius())}static fromRoundedRect2(e,r,n,o,i){if(i=Math.min(i,Math.min(n/2,o/2)),i==0)return At._fromRect(e,r,n,o);let a=At.new2(),s=At.CIRCLE_APPROXIMATION_CONSTANT*i;return a.moveTo1(e,r+i).cubicTo1(e,r+i-s,e+i-s,r,e+i,r).lineTo(e+n-i,r).cubicTo1(e+n-i+s,r,e+n,r+i-s,e+n,r+i).lineTo(e+n,r+o-i).cubicTo1(e+n,r+o-i+s,e+n-i+s,r+o,e+n-i,r+o).lineTo(e+i,r+o).cubicTo1(e+i-s,r+o,e,r+o-i+s,e,r+o-i).close(),a}static fromRoundedRect3(e,r,n,o,i){let a=!0;for(let c=0,d=i.length;c<d;c=c+1)i[c]!=0&&(a=!1),i[c]=Math.min(i[c],Math.min(n/2,o/2));if(a)return At._fromRect(e,r,n,o);let s=At.new2(),l=i.map(c=>At.CIRCLE_APPROXIMATION_CONSTANT*c);return s.moveTo1(e,r+i[0]).cubicTo1(e,r+i[0]-l[0],e+i[0]-l[0],r,e+i[0],r).lineTo(e+n-i[1],r).cubicTo1(e+n-i[1]+l[1],r,e+n,r+i[1]-l[1],e+n,r+i[1]).lineTo(e+n,r+o-i[2]).cubicTo1(e+n,r+o-i[2]+l[2],e+n-i[2]+l[2],r+o,e+n-i[2],r+o).lineTo(e+i[3],r+o).cubicTo1(e+i[3]-l[3],r+o,e,r+o-i[3]+l[3],e,r+o-i[3]).close(),s}static forEllipse(e){let r=new O(e.left()+e.width()/2,e.top()+e.height()/2),n=new O(e.width()/2,0),o=new O(0,e.height()/2),i=n.multiplyScalar(At.CIRCLE_APPROXIMATION_CONSTANT),a=o.multiplyScalar(At.CIRCLE_APPROXIMATION_CONSTANT),s=At.new2();return s.moveTo2(r.add(n)).cubicTo2(r.add(n).add(a),r.add(i).add(o),r.add(o)).cubicTo2(r.subtract(i).add(o),r.subtract(n).add(a),r.subtract(n)).cubicTo2(r.subtract(n).subtract(a),r.subtract(i).subtract(o),r.subtract(o)).cubicTo2(r.add(i).subtract(o),r.add(n).subtract(a),r.add(n)).close(),s}static forCenterStrokeAroundRect(e,r){let n=e.x(),o=e.y(),i=e.width(),a=e.height(),s=r/2,l=At.new2();return l.moveTo1(n-s,o-s).lineTo(n+i+s,o-s).lineTo(n+i+s,o+a+s).lineTo(n-s,o+a+s).lineTo(n-s,o-s).lineTo(n+s,o+s).lineTo(n+s,o+a-s).lineTo(n+i-s,o+a-s).lineTo(n+i-s,o+s).lineTo(n+s,o+s).close(),l}};At.CIRCLE_APPROXIMATION_CONSTANT=4/3*(Math.sqrt(2)-1),At._p0=O.new(),At._p1=O.new(),At._p2=O.new(),At._p3=O.new(),At._r=x.new2();var Bt=At;var ih;(D=>{function t(U,H){D._p.setTo(0,0);for(let k=U.start();$e.Command.isValid(k,U);k=$e.Command.next(k,U)){switch($e.Command.kind(k,U)){case $e.Command.Kind.CLOSE:break;case $e.Command.Kind.MOVE_TO:{D._p3.setTo($e.Command.moveToX(k,U),$e.Command.moveToY(k,U)),D._p.copyFrom(D._p3);break}case $e.Command.Kind.LINE_TO:{D._p3.setTo($e.Command.lineToX(k,U),$e.Command.lineToY(k,U)),p(H,D._p,D._p0,D._p3);break}case $e.Command.Kind.QUADRATIC_TO:{let z=D._p0.x(),q=D._p0.y(),Y=$e.Command.quadraticToFirstX(k,U),j=$e.Command.quadraticToFirstY(k,U),ae=$e.Command.quadraticToX(k,U),xe=$e.Command.quadraticToY(k,U);D._p1.setTo(Y+(z-Y)/3,j+(q-j)/3),D._p2.setTo(Y+(ae-Y)/3,j+(xe-j)/3),D._p3.setTo(ae,xe),p(H,D._p,D._p0,D._p3),s(H,D._p0,D._p1,D._p2,D._p3,0,0);break}case $e.Command.Kind.CUBIC_TO:{D._p1.setTo($e.Command.cubicToFirstX(k,U),$e.Command.cubicToFirstY(k,U)),D._p2.setTo($e.Command.cubicToSecondX(k,U),$e.Command.cubicToSecondY(k,U)),D._p3.setTo($e.Command.cubicToX(k,U),$e.Command.cubicToY(k,U)),p(H,D._p,D._p0,D._p3),s(H,D._p0,D._p1,D._p2,D._p3,0,0);break}default:break}D._p0.copyFrom(D._p3)}}D.compile=t;function e(U){return Math.abs(U)<D._EPSILON?0:U}D._roundToZero=e;function r(U,H){return U.squaredDistanceTo(H)<D._EPSILON*D._EPSILON}D._approxEqual=r;function n(U,H,k){let z=(k.x()-H.x())*(H.y()-U.y())-(k.y()-H.y())*(H.x()-U.x());return z<0?-1:z>0?1:0}D._orientation=n;function o(U,H,k,z){return n(U,H,k)!=n(U,H,z)&&n(k,z,U)!=n(k,z,H)}D._linesIntersect=o;function i(U,H,k,z){let q=z.x()-H.x(),Y=z.y()-H.y(),j=k.x()-H.x(),ae=k.y()-H.y(),xe=U.x()-H.x(),Je=U.y()-H.y(),We=q*q+Y*Y,pt=q*j+Y*ae,Mt=q*xe+Y*Je,nr=j*j+ae*ae,ir=j*xe+ae*Je,le=We*nr-pt*pt;if(le==0)return!1;let Ut=1/le,mt=(nr*Mt-pt*ir)*Ut,He=(We*ir-pt*Mt)*Ut,et=1e-4;return mt>=-et&&He>=-et&&mt+He<=1+et}D._pointInTriangle=i;function a(U,H,k){return U.x*(H.y*k.z-H.z*k.y)+U.y*(H.z*k.x-H.x*k.z)+U.z*(H.x*k.y-H.y*k.x)}D._dotCross=a;function s(U,H,k,z,q,Y,j){if(Y==0||j<4){let mt=q.x()-H.x(),He=q.y()-H.y(),et=(k.x()-H.x())*He-(k.y()-H.y())*mt,tt=(z.x()-H.x())*He-(z.y()-H.y())*mt,wt=3*et-3*tt,zt=-4*et+2*tt,kt=et,Xr=zt*zt-4*kt*wt;if(Xr>0){let ln=-zt/(2*wt),En=Math.sqrt(Xr)/(2*wt),Xn=ln+En,Ji=ln-En;if(0<Xn&&Xn<1&&0<Ji&&Ji<1){let Or=(Xn+Ji)/2;for(let ue=0;ue<10;ue=ue+1){let De=et-tt,ve=tt-2*et,Le=Or*(Or*(Or*De+ve)+et),ce=Or*(3*Or*De+2*ve)+et;Or-=Le/ce}let lo=H.mixedWith(k,Or),Pi=k.mixedWith(z,Or),Zn=z.mixedWith(q,Or),Fi=lo.mixedWith(Pi,Or),Di=Pi.mixedWith(Zn,Or),di=Fi.mixedWith(Di,Or);s(U,H,lo,Fi,di,1,j+1),s(U,di,Di,Zn,q,1,j+1),p(U,H,di,q);return}}}D._b0.setTo(H.x(),H.y(),1),D._b1.setTo(k.x(),k.y(),1),D._b2.setTo(z.x(),z.y(),1),D._b3.setTo(q.x(),q.y(),1);let ae=a(D._b0,D._b3,D._b2),xe=a(D._b1,D._b0,D._b3),Je=a(D._b2,D._b1,D._b0),We=ae-2*xe+3*Je,pt=-xe+3*Je,Mt=3*Je,nr=1/Math.sqrt(We*We+pt*pt+Mt*Mt);We*=nr,pt*=nr,Mt*=nr;let ir=3*pt*pt-4*We*Mt,le=We*We*ir;switch(We=e(We),pt=e(pt),Mt=e(Mt),le=e(le),r(D._b0,D._b1)&&r(D._b0,D._b2)&&r(D._b0,D._b3)?0:le<0?4:le>0?5:We==0&&pt==0?Mt==0?1:2:We==0?3:ir<0?4:5){case 5:{let mt=Math.sqrt(Math.max(0,9*pt*pt-12*We*Mt)),He=3*pt-mt,et=6*We,tt=3*pt+mt,wt=et,zt=et-He,kt=wt-tt;c(U,H,He*tt,He*He*He,tt*tt*tt,k,(3*He*tt-He*wt-et*tt)/3,He*He*(He-et),tt*tt*(tt-wt),z,(et*(wt-2*tt)+He*(3*tt-2*wt))/3,zt*zt*He,kt*kt*tt,q,zt*kt,-zt*zt*zt,-kt*kt*kt);break}case 4:{let mt=Math.sqrt(Math.max(0,4*We*Mt-3*pt*pt)),He=pt-mt,et=2*We,tt=pt+mt,wt=et;if(Y!=2||j<4){let Xr=He/et,ln=tt/wt,En=D._EPSILON<Xr&&Xr<1-D._EPSILON,Xn=D._EPSILON<ln&&ln<1-D._EPSILON;if(En&&Xn){l(U,H,k,z,q,Math.min(Xr,ln),Math.max(Xr,ln),j+1);return}if(En){l(U,H,k,z,q,Xr,-1,j+1);return}if(Xn){l(U,H,k,z,q,ln,-1,j+1);return}}let zt=et-He,kt=wt-tt;c(U,H,He*tt,He*He*tt,He*tt*tt,k,(-He*wt-et*tt+3*He*tt)/3,-He*(He*(wt-3*tt)+2*et*tt)/3,-tt*(He*(2*wt-3*tt)+et*tt)/3,z,(et*(wt-2*tt)+He*(3*tt-2*wt))/3,(et-He)*(He*(2*wt-3*tt)+et*tt)/3,(wt-tt)*(He*(wt-3*tt)+2*et*tt)/3,q,zt*kt,-zt*zt*kt,-zt*kt*kt);break}case 3:{let mt=Mt,He=3*pt,et=mt-He;c(U,H,mt,mt*mt*mt,1,k,mt-He/3,mt*mt*et,1,z,mt-He*(2/3),et*et*mt,1,q,et,et*et*et,1);break}case 2:{c(U,H,0,0,0,k,1/3,0,1/3,z,2/3,1/3,2/3,q,1,1,1);break}}}D._compileCubic=s;function l(U,H,k,z,q,Y,j,ae){let xe=H.mixedWith(k,Y),Je=k.mixedWith(z,Y),We=z.mixedWith(q,Y),pt=xe.mixedWith(Je,Y),Mt=Je.mixedWith(We,Y),nr=pt.mixedWith(Mt,Y);if(p(U,H,nr,q),s(U,H,xe,pt,nr,2,ae+1),j==-1){s(U,nr,Mt,We,q,2,ae+1);return}let ir=nr,le=Mt,Ut=We,mt=q,He=(j-Y)/(1-Y),et=ir.mixedWith(le,He),tt=le.mixedWith(Ut,He),wt=Ut.mixedWith(mt,He),zt=et.mixedWith(tt,He),kt=tt.mixedWith(wt,He),Xr=zt.mixedWith(kt,He);s(U,ir,et,zt,Xr,2,ae+1),s(U,Xr,kt,wt,mt,2,ae+1)}D._compileSubdividedCubic=l;function c(U,H,k,z,q,Y,j,ae,xe,Je,We,pt,Mt,nr,ir,le,Ut){D._v0.set(H,k,z,q),D._v1.set(Y,j,ae,xe),D._v2.set(Je,We,pt,Mt),D._v3.set(nr,ir,le,Ut);let mt=(k+ir)*(.9/2)+(j+We)*(.1/2),He=(z+le)*(.9/2)+(ae+pt)*(.1/2),et=(q+Ut)*(.9/2)+(xe+Mt)*(.1/2),tt=mt*mt*mt-He*et>0,wt=0,zt=0;for(let En=0;En<4;En=En+1){let Xn=Ft.int_remainder(En+1,4),Ji=Ft.int_remainder(En+2,4),Or=Ft.int_remainder(En+3,4),lo=D._v[Xn].xy,Pi=D._v[Ji].xy,Zn=D._v[Or].xy,Fi=lo.distanceTo(Pi),Di=Pi.distanceTo(Zn),di=Zn.distanceTo(lo),ue=(Fi+Di+di)/2,De=ue*(ue-Fi)*(ue-Di)*(ue-di);De>wt&&(wt=De,zt=En)}let kt=Ft.int_remainder(zt+1,4),Xr=Ft.int_remainder(zt+2,4),ln=Ft.int_remainder(zt+3,4);if(i(D._v[zt].xy,D._v[kt].xy,D._v[Xr].xy,D._v[ln].xy)){_(U,D._v[kt],D._v[Xr],D._v[ln],tt);return}o(H,Je,Y,nr)?H.squaredDistanceTo(Je)<Y.squaredDistanceTo(nr)?(_(U,D._v0,D._v1,D._v2,tt),_(U,D._v0,D._v2,D._v3,tt)):(_(U,D._v0,D._v1,D._v3,tt),_(U,D._v1,D._v2,D._v3,tt)):o(H,nr,Y,Je)?H.squaredDistanceTo(nr)<Y.squaredDistanceTo(Je)?(_(U,D._v0,D._v1,D._v3,!tt),_(U,D._v0,D._v3,D._v2,tt)):(_(U,D._v0,D._v1,D._v2,tt),_(U,D._v2,D._v1,D._v3,tt)):H.squaredDistanceTo(Y)<Je.squaredDistanceTo(nr)?(_(U,D._v0,D._v2,D._v1,tt),_(U,D._v0,D._v1,D._v3,tt)):(_(U,D._v0,D._v2,D._v3,tt),_(U,D._v3,D._v2,D._v1,tt))}D._appendQuad=c;function d(U,H,k){return U.equals(H)||U.equals(k)||H.equals(k)}D._isEmptyTriangle=d;function u(U,H,k,z,q,Y){U.appendFloat(H).appendFloat(k),U.appendFloat(z).appendFloat(q).appendFloat(Y)}D._appendVertex=u;function p(U,H,k,z){d(H,k,z)||(u(U,H.x(),H.y(),.5,.5,.5),u(U,k.x(),k.y(),.5,.5,.5),u(U,z.x(),z.y(),.5,.5,.5))}D._appendTriangle1=p;function _(U,H,k,z,q){if(!d(H.xy,k.xy,z.xy)){let Y=q?-1:1;u(U,H.xy.x(),H.xy.y(),H.k*Y,H.l*Y,H.m),u(U,k.xy.x(),k.xy.y(),k.k*Y,k.l*Y,k.m),u(U,z.xy.x(),z.xy.y(),z.k*Y,z.l*Y,z.m)}}D._appendTriangle2=_;class h{setTo(H,k,z){this.x=H,this.y=k,this.z=z}squaredDistanceTo(H){let k=this.x-H.x,z=this.y-H.y,q=this.z-H.z;return k*k+z*z+q*q}constructor(){this.x=0,this.y=0,this.z=0}}D.Vector3=h;class A{set(H,k,z,q){this.xy=H,this.k=k,this.l=z,this.m=q}constructor(){this.xy=null,this.k=0,this.l=0,this.m=0}}D.Vector5=A;let m;(z=>(z[z.INITIAL=0]="INITIAL",z[z.SUBDIVIDED_BECAUSE_OF_CROSSING=1]="SUBDIVIDED_BECAUSE_OF_CROSSING",z[z.SUBDIVIDED_BECAUSE_OF_LOOP=2]="SUBDIVIDED_BECAUSE_OF_LOOP"))(m=D.CompileState||(D.CompileState={}));let g;(j=>(j[j.POINT=0]="POINT",j[j.LINE=1]="LINE",j[j.QUADRATIC=2]="QUADRATIC",j[j.CUSP=3]="CUSP",j[j.LOOP=4]="LOOP",j[j.SERPENTINE=5]="SERPENTINE"))(g=D.SegmentClass||(D.SegmentClass={})),D._EPSILON=5e-4,D._p=O.new(),D._p0=O.new(),D._p1=O.new(),D._p2=O.new(),D._p3=O.new(),D._b0=new h,D._b1=new h,D._b2=new h,D._b3=new h,D._v0=new A,D._v1=new A,D._v2=new A,D._v3=new A,D._v=[D._v0,D._v1,D._v2,D._v3]})(ih||(ih={}));var ah=class{constructor(e,r){this.key=e,this.value=r}},Vi=class{each(e){Xt.IntMap_each(this._buckets,(r,n)=>{for(let o of n)e(o.key,o.value)})}getOrInsertFallback(e){let r=this._hash(e),n=Xt.IntMap_get(this._buckets,r,null);if(n!=null){for(let i of n)if(this._equals(e,i.key))return i.value}else n=[],this._buckets.set(r,n);let o=this._fallback(e);return n.push(new ah(e,o)),o}get(e,r){let n=this._hash(e),o=Xt.IntMap_get(this._buckets,n,null);if(o!=null){for(let i of o)if(this._equals(e,i.key))return i.value}return r}getOrNull(e){return this.get(e,null)}set(e,r){let n=this._hash(e),o=Xt.IntMap_get(this._buckets,n,null);o==null&&(o=[],this._buckets.set(n,o));for(let i of o)if(this._equals(e,i.key)){i.value=r;return}o.push(new ah(e,r))}remove(e){let r=this._hash(e),n=Xt.IntMap_get(this._buckets,r,null);if(n!=null){for(let o=0,i=n.length;o<i;o=o+1)if(this._equals(e,n[o].key)){n.splice(o,1),n.length==0&&this._buckets.delete(r);break}}}constructor(e,r,n){this._buckets=new Map,this._hash=e,this._equals=r,this._fallback=n}};var yS=class{initialize(e){this._bindings=e}bindContext(e,r){var n;(n=this._bindings)==null||n.bindContext(e,r)}getNewProgramId(){return this._bindings.getNewProgramId()}},yu=new yS;var es;(o=>{let t;(s=>(s.SCENE_GRAPH_RENDERING="_sceneGraphRendering",s.OVERLAY_UI_RENDERING="_overlayUIRendering"))(t=o.GpuSubMetricsType||(o.GpuSubMetricsType={}));class e{constructor(){this._drawCalls=0;this._triangles=0;this._tristrips=0;this._trilists=0;this._vertices=0;this._clears=0;this._flushes=0;this._uniqueShaderPrograms=0;this._shaderChanges=0;this._glEnables=0;this._glDisables=0;this._framebufferBinds=0;this._uniformVariablesSet=0;this._texturesCreated=0;this._texturesDestroyed=0;this._textureBinds=0;this._texturesReferenced=0;this._vertexBuffersCreated=0;this._vertexBuffersDestroyed=0;this._vertexBuffersReferenced=0;this._uniformBuffersCreated=0;this._uniformBuffersDestroyed=0;this._uniformBuffersReferenced=0;this._totalBandwidth=0;this._readBandwidth=0;this._writeBandwidth=0;this._pixelReadBandwidth=0;this._textureWriteBandwidth=0;this._vertexBufferWriteBandwidth=0;this._uniformBufferWriteBandwidth=0;this._uniformVarsWriteBandwidth=0;this._uniformBufferUsedAreaWriteBandwidth=0;this._textureUploadCount=0;this._vertexBufferUploadCount=0;this._uniformBufferUploadCount=0;this.reset()}reset(){this._drawCalls=0,this._triangles=0,this._tristrips=0,this._trilists=0,this._vertices=0,this._clears=0,this._flushes=0,this._uniqueShaderPrograms=0,this._shaderChanges=0,this._glEnables=0,this._glDisables=0,this._framebufferBinds=0,this._uniformVariablesSet=0,this._texturesCreated=0,this._texturesDestroyed=0,this._textureBinds=0,this._texturesReferenced=0,this._vertexBuffersCreated=0,this._vertexBuffersDestroyed=0,this._vertexBuffersReferenced=0,this._uniformBuffersCreated=0,this._uniformBuffersDestroyed=0,this._uniformBuffersReferenced=0,this._totalBandwidth=0,this._readBandwidth=0,this._writeBandwidth=0,this._pixelReadBandwidth=0,this._textureWriteBandwidth=0,this._vertexBufferWriteBandwidth=0,this._uniformBufferWriteBandwidth=0,this._uniformVarsWriteBandwidth=0,this._uniformBufferUsedAreaWriteBandwidth=0,this._textureUploadCount=0,this._vertexBufferUploadCount=0,this._uniformBufferUploadCount=0}}o.GpuSubMetrics=e;class r{constructor(){this._frameIndex=0;this._gpuSubMetrics={_sceneGraphRendering:new e,_overlayUIRendering:new e};this._bgtIsWorkExceedingBudget=!1;this._bgtBrokeRenderAt="";this._bgtDidCompleteInterruptedFrame=!1;this._bgtHasPendingInterruptForNextFrame=!1;this._bgtTimePastRenderingDeadline=0;this._bgtTilesRendersRemaining=0;this._bgtTileCacheCapacityRemaining=0;this._bgtFrameBufferSwitchRemaining=0;this._bgtDidRasterWork=!1;this._bgtBlitToScreen=!1;this._bgtOnScreenTileCompletionCount=0;this._bgtOnScreenTileReuseCount=0;this._bgtOffScreenTileCompletionCount=0;this._bgtOptionalTileCompletionCount=0;this._bgtClearedExistingInterrupt=!1;this._currentFrameSubMetricsType="_sceneGraphRendering";this._gpuSubMetrics._sceneGraphRendering=new e,this._gpuSubMetrics._overlayUIRendering=new e,this.reset(0)}updateFrameBudgetInfo(a){this._bgtIsWorkExceedingBudget=!a.permitsMoreWork(),this._bgtTimePastRenderingDeadline=a.pastRenderingBudgetTime(),this._bgtTilesRendersRemaining=a.tileRenderingBudgetRemaining(),this._bgtTileCacheCapacityRemaining=a.tileCacheCapacityRemaining(),this._bgtFrameBufferSwitchRemaining=a.frameBufferSwitchBudgetRemaining()}logUniformVariableSet(a){this._gpuSubMetrics[this._currentFrameSubMetricsType]._uniformVariablesSet++,this._gpuSubMetrics[this._currentFrameSubMetricsType]._totalBandwidth+=a,this._gpuSubMetrics[this._currentFrameSubMetricsType]._writeBandwidth+=a,this._gpuSubMetrics[this._currentFrameSubMetricsType]._uniformVarsWriteBandwidth+=a}getCurrentFrameGPUSubMetrics(){return this._gpuSubMetrics[this._currentFrameSubMetricsType]}setCurrentFrameSubMetricsType(a){this._currentFrameSubMetricsType=a}reset(a){this._frameIndex=a,this._gpuSubMetrics._sceneGraphRendering.reset(),this._gpuSubMetrics._overlayUIRendering.reset(),this._bgtIsWorkExceedingBudget=!1,this._bgtBrokeRenderAt="",this._bgtDidCompleteInterruptedFrame=!1,this._bgtHasPendingInterruptForNextFrame=!1,this._bgtTimePastRenderingDeadline=0,this._bgtTilesRendersRemaining=0,this._bgtTileCacheCapacityRemaining=0,this._bgtFrameBufferSwitchRemaining=0,this._bgtDidRasterWork=!1,this._bgtBlitToScreen=!1,this._bgtOnScreenTileCompletionCount=0,this._bgtOnScreenTileReuseCount=0,this._bgtOffScreenTileCompletionCount=0,this._bgtOptionalTileCompletionCount=0,this._bgtClearedExistingInterrupt=!1}}o.GpuMetrics=r;class n{constructor(){this._defaultBufferSize=0;this._currentFrame=0;this._framesBuffered=0;this._metricsBuffer=[];this._frameIndex=0;this._referencedShaderPrograms=new Set}getCurrentFrameIndex(){return this._currentFrame}nextFrame(a){this._metricsBuffer.length==0&&this.setBufferSize(this._defaultBufferSize),this._frameIndex=a,this._currentFrame=(this._currentFrame+1)%this._metricsBuffer.length,this._framesBuffered=Math.min(this._framesBuffered+1,this._metricsBuffer.length),this._metricsBuffer[this._currentFrame].reset(this._frameIndex),this._referencedShaderPrograms=new Set}getBuffer(){let a=[];if(this._framesBuffered>0){let s=this._currentFrame==this._metricsBuffer.length-1?0:this._currentFrame+1,l=0;for(let c=s;c<this._metricsBuffer.length&&l<this._framesBuffered;c++,l++)a[l]=Object.assign({},this._metricsBuffer[c]);for(let c=0;l<this._framesBuffered;c++,l++)a[l]=Object.assign({},this._metricsBuffer[c])}return a}getBufferSize(){return this._metricsBuffer.length}jsonReplacerForTests(a,s){if(!(a=="_frameIndex"||a=="_bgtIsWorkExceedingBudget"||a=="_bgtTimePastRenderingDeadline"||a=="_bgtTilesRendersRemaining"||a=="_bgtTileCacheCapacityRemaining"||a=="_bgtFrameBufferSwitchRemaining"||s===0))return s}getBufferJsonForTest(){let a=this.getBuffer();for(let s=0;s<a.length;s++)delete a[s]._frameIndex;return JSON.stringify(a,this.jsonReplacerForTests)}getCurrentFrameGPUSubMetrics(){return this._metricsBuffer[this._currentFrame].getCurrentFrameGPUSubMetrics()}getCurrentFrameGPUMetrics(){return this._metricsBuffer[this._currentFrame]}getPreviousFrameGPUMetrics(){return this._framesBuffered<2?null:this._currentFrame>0?this._metricsBuffer[this._currentFrame-1]:this._metricsBuffer[this._metricsBuffer.length-1]}setBufferSize(a){if(a<2)return!1;if(a==this._metricsBuffer.length)return!0;this._currentFrame=0,this._framesBuffered=0,this._metricsBuffer=[];for(let s=0;s<a;s++)this._metricsBuffer.push(new r);return this._referencedShaderPrograms=new Set,!0}referenceShaderProgram(a){this._referencedShaderPrograms.add(a),this.getCurrentFrameGPUSubMetrics()._uniqueShaderPrograms=this._referencedShaderPrograms.size}}o.GpuMetricsCollection=n})(es||(es={}));var wl=class wl{totalVRAM(){return this._chunks.length*wl.CHUNK_SIZE_IN_BYTES}usedVRAM(){return this._chunks.reduce((e,r)=>e+r.getBytesUsed(),0)}allocateVertexBufferAreas(e,r,n){let o=[],i=this.chunkSizeInBytes(),a=r.stride();if(e==qe.TRIANGLES){let s=i-Ft.int_remainder(i,a*3),l=(n.length+s-1)/s|0;for(let c=0,d=l;c<d;c=c+1){let u=n.subarray(c*s,c*s+s),p=this.allocate(r,u);p!=null&&o.push(p)}l>1&&console.debug(`splitting ${n.length} byte geometry buffer into ${l} chunks`)}else if(e==qe.TRIANGLE_STRIP){let l=Math.floor(4+2*((i-4*a)/(2*a)))*a,c=(n.length-1)/l|0,d=0;for(;;){let u=n.subarray(d,d+Math.min(l,n.length-d)),p=this.allocate(r,u);if(p!=null){if(o.push(p),d+=l,d>=n.length)break;d-=2*r.stride()}}c>1&&console.debug(`splitting ${n.length} byte geometry buffer into ${c} chunks`)}return o}allocate(e,r){if(r.length==0)return null;r.length<=wl.CHUNK_SIZE_IN_BYTES;let n=this._enableDiscardBytesAfterUpload,o=e.stride();for(let a of this._chunks){let s=a.tryToAllocate(o,r,n);if(s!=null)return s}let i=new CS(this,this._bufferProvider.createVertexBuffer(wl.CHUNK_SIZE_IN_BYTES,this._enableDiscardBytesAfterUpload));return this._chunks.push(i),i.tryToAllocate(o,r,n)}allocateSmallManagedArea(e,r){let n=new Uint8Array(r);return new Ya(()=>this.allocate(e,n))}chunkSizeInBytes(){return wl.CHUNK_SIZE_IN_BYTES}constructor(e,r){this._context=e,this._bufferProvider=r,this._chunks=[],this._enableDiscardBytesAfterUpload=K.shouldEnableVertexBufferDiscardBytesAfterUpload(),this._enableDiscardBytesAfterUpload&&this._context.addContextResetHandler(()=>{var n;for(let o of this._chunks)for(let i of o.areas)(n=i.unwrap())==null||n.invalidate();this._chunks=[]})}};wl.CHUNK_SIZE_IN_BYTES=4*1024*1024;var ts=wl,vS=class t{constructor(e,r,n){this._area=e,this._areaWeakRef=r,this._byteCount=n}static wrap(e){return K.viewerCleanupBufferAreas()?new t(null,new WeakRef(e),e.byteCount()):new t(e,null,e.byteCount())}unwrap(){var e;return this._area??((e=this._areaWeakRef)==null?void 0:e.deref())??null}wasFreed(){var e;return((e=this.unwrap())==null?void 0:e.wasFreed())??!0}wasReclaimedBySystem(){return this._areaWeakRef&&!this._areaWeakRef.deref()}byteCount(){var e;return((e=this._area)==null?void 0:e.byteCount())??this._byteCount}},CS=class t{tryToAllocate(e,r,n){let o=r.length,i=this.areas,a=null;if(this.getBytesUsed()+o<=ts.CHUNK_SIZE_IN_BYTES){for(;i.length!=0&&ie.List_last(i).wasFreed();)ie.List_removeLast(i);a=this.allocateAtEnd(e,r),a==null&&!n&&(this.runCompactingGC(),a=this.allocateAtEnd(e,r)),a!=null&&(this.buffer.setBytesForUpload(r,a.byteOffset()),K.viewerCleanupBufferAreas()||(this.bytesUsed=this.bytesUsed+o),i.push(vS.wrap(a)))}return a}allocateAtEnd(e,r){let n=this.validAreas(),o=n.length==0?0:t._alignToNextMultiple(ie.List_last(n).byteOffset()+ie.List_last(n).byteCount(),e);return o+r.length<=ts.CHUNK_SIZE_IN_BYTES?new xl(this,r.length,e,o,r):null}validAreas(){return this.areas.map(e=>e.unwrap()).filter(e=>e!=null)}runCompactingGC(){var r;let e=0;if(ie.List_removeIf(this.areas,n=>{let o=n.unwrap();return o==null||o.wasFreed()?!0:(e=t._alignToNextMultiple(e,o.stride()),o.byteOffset()!=e&&(this.buffer.moveBytesForUpload(o.byteOffset(),e,o.byteCount()),o.wasMovedTo(e)),e=e+o.byteCount(),!1)}),!O_)for(let n of this.areas)(r=n.unwrap())==null||r.assertBytesAreAsExpected()}getBytesUsed(){if(K.viewerCleanupBufferAreas()){let e=0;for(let r of this.areas)e+=r.wasFreed()?0:r.byteCount();return e}else return this.bytesUsed}static _alignToNextMultiple(e,r){return e+Ft.int_remainder(r-Ft.int_remainder(e,r),r)}constructor(e,r){this.pool=e,this.buffer=r,this.areas=[],this.bytesUsed=0}},xl=class{constructor(e,r,n,o,i){this._wasFreed=!1,this._expectedArray=null,this._chunk=e,this._byteCount=r,this._stride=n,this._byteOffset=o,O_||this._saveBytes(i)}_saveBytes(e){this._expectedArray=new Uint8Array(e)}assertBytesAreAsExpected(){if(O_||this._expectedArray===null||this._chunk===null)return;let e=this._chunk.buffer.bytesForUpload();if(e!=null)for(let r=0,n=this._byteCount;r<n;r=r+1)this._expectedArray[r]!=e[r+this._byteOffset]}byteCount(){return this._byteCount}stride(){return this._stride}byteOffset(){return this._byteOffset}wasFreed(){return this._wasFreed}buffer(){var e;return((e=this._chunk)==null?void 0:e.buffer)??null}hasBuffer(){var e;return((e=this._chunk)==null?void 0:e.buffer)!=null}bufferBytesForUpload(){var e,r;return((r=(e=this._chunk)==null?void 0:e.buffer)==null?void 0:r.bytesForUpload())??null}free(){!this._wasFreed&&this._chunk!=null&&(this._wasFreed=!0,K.viewerCleanupBufferAreas()||(this._chunk.bytesUsed-=this.byteCount()))}wasMovedTo(e){this._byteOffset=e}invalidate(){this._chunk=null}};var sh=class{constructor(e,r,n){this._context=e,this._name=r,this._inputLayout=n,Wd().then(o=>{this._wasmMutableMaterial=o.modules().wasmRendererBindings.createMaterialObject(r),this._emscriptenProgramId=this._wasmMutableMaterial.getId()})}inputLayout(){return this._inputLayout}setUniformFloat(e,r){throw new Error("Method not implemented.")}setUniformInt(e,r){throw new Error("Method not implemented.")}setUniformVec21(e,r,n){throw new Error("Method not implemented.")}setUniformVec41(e,r,n,o,i){throw new Error("Method not implemented.")}setUniformMat31(e,r,n,o,i,a,s){throw new Error("Method not implemented.")}setUniformSampler(e,r,n){throw new Error("Method not implemented.")}context(){return this._context}name(){return this._name}program(){throw new Error("Method not implemented.")}getEmscriptenProgramId(){return this._emscriptenProgramId}prepare(){this._context.useMaterial(this)}bind(e,r){this._wasmMutableMaterial.bindWithoutTextures(e,r)}static from(e){return e}};function xc(){return MS}function lL(t){MS=t}var OS=class{constructor(){this._currentAttribIsInstanced=new Array(16)}},bS=class{constructor(){this._currentVertexBuffers=new Array(32);this._currentVertexBufferOffsets=new Array(32);this._numVertexBuffers=0;this._bufferStateDirty=!1;this._inputLayoutStateDirty=!1}},NS=class{constructor(e){this._context=e}createVertexBuffer(e,r){return new wc(this._context,e,r)}},Si=class Si{constructor(e){this._drawArraysInstancedInternal=null;this._vertexAttribDivisorInternal=null;this._gl2=null;this._resetState(),this._stats=new v_,this._contextResetHandlers=[],this._forceStateUpdate=!0,this._generation=1,this._cachedSize=new O(0,0),this._defaultViewport=x.new2(),this._mockMaximumDrawingBufferSize=null,this._hasLoggedHighpPrecisionUnsupported=!1,this._gpuMetricsCollection=new es.GpuMetricsCollection,this._gpuMetricsCollection.setBufferSize(2);let r={antialias:!1,depth:!1,stencil:!1,alpha:e.needsAlpha,preserveDrawingBuffer:ta,powerPreference:"high-performance"};if(this._gl=Qd(K.shouldUseWebGL2(),r),this._gl==null&&(r.powerPreference="default",this._gl=Qd(K.shouldUseWebGL2(),r)),this._gl==null)throw console.error("WebGL initialization failed"),new Error("Could not initialize WebGL");if(this._gl!==null)if(this._gl instanceof WebGL2RenderingContext)this._gl2=this._gl,this._drawArraysInstancedInternal=(i,a,s,l)=>{this._gl2.drawArraysInstanced(i,a,s,l)},this._vertexAttribDivisorInternal=(i,a)=>{this._gl2.vertexAttribDivisor(i,a)};else{let i=this._gl.getExtension("ANGLE_instanced_arrays");i!==null&&(this._drawArraysInstancedInternal=(a,s,l,c)=>{i.drawArraysInstancedANGLE(a,s,l,c)},this._vertexAttribDivisorInternal=(a,s)=>{i.vertexAttribDivisorANGLE(a,s)})}K.useUnifiedRenderer()&&Wd().then(i=>{yu.bindContext(this._gl,r),i.initializeRenderer()}),this._loadASTCCompressedTexturesExtension(),this._loadS3TCCompressedTexturesExtension(),this._loadOESStandardDerivativesExtension(!0);let n=this._gl.canvas,o=n.style;n.width=0,n.height=0,o.display="block",o.left="0",o.top="0",sr.EventTarget_addEventListener2(n,"webglcontextlost",i=>{console.warn("WebGL context was lost"),xi.Event_preventDefault(i)}),sr.EventTarget_addEventListener1(n,"webglcontextrestored",()=>{console.warn("WebGL context was restored"),this._resetState(),this._forceStateUpdate=!0,this._loadOESStandardDerivativesExtension(!1),this._generation=this._generation+1,this._stats.resetOnContextRestored();for(let i of this._contextResetHandlers)i()}),vC(this._gl),this._blendOperationMap=new Map([[0,this._gl.ZERO],[1,this._gl.ONE],[2,this._gl.SRC_COLOR],[3,this._gl.DST_COLOR],[4,this._gl.ONE_MINUS_SRC_COLOR],[5,this._gl.ONE_MINUS_DST_COLOR],[6,this._gl.SRC_ALPHA],[7,this._gl.DST_ALPHA],[8,this._gl.ONE_MINUS_SRC_ALPHA],[9,this._gl.ONE_MINUS_DST_ALPHA],[10,this._gl.CONSTANT_COLOR],[11,this._gl.ONE_MINUS_CONSTANT_COLOR]]),this._comparisonMap=new Map([[0,this._gl.ALWAYS],[1,this._gl.EQUAL],[2,this._gl.GREATER],[3,this._gl.GEQUAL],[4,this._gl.LESS],[5,this._gl.LEQUAL],[6,this._gl.NEVER],[7,this._gl.NOTEQUAL]]),this._operationMap=new Map([[0,this._gl.DECR],[1,this._gl.DECR_WRAP],[2,this._gl.INCR],[3,this._gl.INCR_WRAP],[4,this._gl.INVERT],[5,this._gl.KEEP],[6,this._gl.REPLACE],[7,this._gl.ZERO]]),this._cachedGraphicsCardName=null,this._cachedMaxTextureSize=Math.min(4096,this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE))|0,cr.setMaxRes(this._cachedMaxTextureSize),this.hackToAvoidMissingTextureWarningInChrome=new va(this,Me.RGBA_NEAREST_CLAMP,1,1,cr.createFromPixels(1,1,new Uint8Array(4)),null,br.CHROME_HACK),this._shouldFlushAfterDraws=this._detectShouldFlushAfterDraws()}getGpuMetricsCollection(){return this._gpuMetricsCollection}stats(){return this._stats}width(){return this._cachedSize.x()|0}height(){return this._cachedSize.y()|0}maxTextureSize(){return this._cachedMaxTextureSize}supportsCompressedTextures(){return this._astc_extension!=null||K.shouldUseDesktopCompressedTextureFormat()&&this._s3tc_extension!=null}astcExtension(){return this._astc_extension}_loadASTCCompressedTexturesExtension(){K.shouldUseCompressedTextures()&&K.shouldUseWebGL2()&&(this._astc_extension=this._gl.getExtension("WEBGL_compressed_texture_astc"))}s3tcExtension(){return this._s3tc_extension}_loadS3TCCompressedTexturesExtension(){K.shouldUseCompressedTextures()&&K.shouldUseWebGL2()&&(this._s3tc_extension=this._gl.getExtension("WEBGL_compressed_texture_s3tc"))}glInternalFormat(e){switch(e){case 3:if(this.supportsCompressedTextures())return this.s3tcExtension().COMPRESSED_RGBA_S3TC_DXT5_EXT;case 2:if(this.supportsCompressedTextures())return this.astcExtension().COMPRESSED_RGBA_ASTC_6x6_KHR;case 1:case 0:default:return this.gl().RGBA}}_loadOESStandardDerivativesExtension(e){let r=this._gl.getExtension("OES_standard_derivatives"),n=K.shouldUseWebGL2();lL(n||r!==null),e&&!MS&&!n&&be.trackEvent("missing_webgl_extensions",{extensions:["OES_standard_derivatives"]})}_resetState(){this._attributeCount=0,this._currentClearColor=N.TRANSPARENT,this._currentProgramInUse=null,this._currentInputLayout=null,this._oldBlendState=null,this._oldBlendOperations=0,this._oldScissors=null,this._oldStencilState=_r.NONE,this._oldFramebuffer=null,this._oldViewport=x.new2(),this._boundWebGLFramebuffer=null,this._webGLFramebufferUsedForLastClearOrDraw=null,this._materialsToCheckProgramCreationStatus=[],this._numFramebufferSwitches=0,this._boundState=new OS,this._drawState=new bS}gl(){return this._gl}generation(){return this._generation}addContextResetHandler(e){ie.List_appendOne(this._contextResetHandlers,e)}removeContextResetHandler(e){ie.List_removeOne(this._contextResetHandlers,e)}beginFrame(){this._checkMaterialProgramCreationStatuses()}supportsGpuInstancing(){return!K.shouldOverrideDisableGpuInstancingSupport()&&this._drawArraysInstancedInternal!==null}flush(){this._gl.flush(),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._flushes++}readPixels(e,r,n,o,i){var c;let a=o*i*4,s=new Uint8Array(a),l=(c=vu.from(e))==null?void 0:c.framebuffer();return this.bindWebGLFramebufferAndTrackForBudget(l),this._gl.readPixels(r,n,o,i,this.gl().RGBA,this.gl().UNSIGNED_BYTE,s),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._totalBandwidth+=a,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._readBandwidth+=a,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._pixelReadBandwidth+=a,s}_reportClearOrDraw(){this._boundWebGLFramebuffer!=this._webGLFramebufferUsedForLastClearOrDraw&&this._numFramebufferSwitches++,this._webGLFramebufferUsedForLastClearOrDraw=this._boundWebGLFramebuffer}draw(e,r,n,o,i,a,s,l){n!==null&&Ac.WebGLRenderingContext_annotateBlock(this._gl,`material:${r.name()}`,()=>{if(n instanceof Ya&&(n=n.bufferArea()),n===null){we("Tried to draw using null vertex buffer area");return}if(!(n instanceof xl)){we("Tried to draw using non-html vertex buffer area");return}i==null&&(i=_r.NONE),this._updateFramebufferAndViewport(a,l),r.prepare();let c=n.buffer();if(c==null)return;let d=wc.from(c);d.prepareForBinding(),this._updateBlendState(o),this._updateStencilState(i),this._updateScissorState(s),this.setVertexBuffer(d,0),this.prepareForDraw();let u=n.byteCount()/n.stride();switch(this._gl.drawArrays(e==qe.TRIANGLES?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,n.byteOffset()/n.stride()|0,u|0),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._drawCalls++,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._vertices+=u,e){case qe.TRIANGLES:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._triangles+=u/3;break;case qe.TRIANGLE_STRIP:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._tristrips++;break;default:break}this._forceStateUpdate=!1,this._shouldFlushAfterDraws&&this.flush(),this._reportClearOrDraw()})}drawInstanced(e,r,n,o,i,a,s,l,c){n===null||o===null||Ac.WebGLRenderingContext_annotateBlock(this._gl,`material:${r.name()}`,()=>{if(n instanceof Ya&&(n=n.bufferArea()),n===null){we("Tried to draw using null vertex buffer area");return}if(!(n instanceof xl)||!(o instanceof xl)){we("Tried to draw using non-html vertex buffer area");return}a==null&&(a=_r.NONE),this._updateFramebufferAndViewport(s,c),r.prepare();let d=n.buffer(),u=o.buffer();if(d==null||u==null)return;let p=wc.from(d),_=wc.from(u);p.prepareForBinding(),_.prepareForBinding(),this._updateBlendState(i),this._updateStencilState(a),this._updateScissorState(l),this.setVertexBuffers2(p,n.byteOffset(),_,o.byteOffset()),this.prepareForDraw();let h=o.byteCount()/o.stride()|0,A=n.byteCount()/n.stride()|0;switch(this._drawArraysInstancedInternal(e==qe.TRIANGLES?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,0,A,h),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._drawCalls++,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._vertices+=A,e){case qe.TRIANGLES:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._triangles+=A/3;break;case qe.TRIANGLE_STRIP:this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._tristrips++;break;default:break}this._forceStateUpdate=!1,this._shouldFlushAfterDraws&&this.flush(),this._reportClearOrDraw()})}_setCanvasSize(e,r){this._mockMaximumDrawingBufferSize!=null&&(e=Math.min(this._mockMaximumDrawingBufferSize.value,e)|0,r=Math.min(this._mockMaximumDrawingBufferSize.value,r)|0);let n=e/zo(),o=r/zo(),i=this._gl.canvas;i.width=e,i.height=r,i.style.width=`${n}px`,i.style.height=`${o}px`;let a=this._gl.drawingBufferWidth,s=this._gl.drawingBufferHeight,l=a!=e||s!=r;return l&&(n=a/zo(),o=s/zo(),i.width=a,i.height=s,i.style.width=`${n}px`,i.style.height=`${o}px`),new ra(new O(a,s),l)}resizeDefaultFramebuffer(e,r){let n=!1;if((this._cachedSize.x()|0)!=e||(this._cachedSize.y()|0)!=r){let o=this._setCanvasSize(e,r);this._cachedSize=o.canvasSize,n=o.webGLDidAdjustCanvasSize,this._defaultViewport.setTo1(0,0,this._cachedSize.x()|0,this._cachedSize.y()|0)}return new ra(this._cachedSize,n)}_detectShouldFlushAfterDraws(){return!!(Si.detectFaultyAdrenoGPU(this.graphicsCardName())||K.shouldFlushAfterDraws())}static detectFaultyAdrenoGPU(e){return/Adreno \(TM\) ([78])\d{2}/.test(e)}_shouldFlushAfterClear(){return!!(Qa.hasDrawClearReorderingBug()||["Mesa Intel(R) Graphics (ADL GT2)","Mesa Intel(R) Xe Graphics (TGL GT2)"].indexOf(this.graphicsCardName())!=-1||K.shouldFlushAfterClear())}clear(e,r,n,o,i){var a,s;r==null&&(r=N.TRANSPARENT),this._updateFramebufferAndViewport(n,i),this._oldBlendState==lt.KEEP&&this._updateBlendState(lt.COPY),this._updateScissorState(o),r!=this._currentClearColor&&(this._gl.clearColor(N.redF(r),N.greenF(r),N.blueF(r),N.alphaF(r)),this._currentClearColor=r),this._gl.clear((e!=mr.DEPTH_STENCIL?this._gl.COLOR_BUFFER_BIT:0)|(e!=mr.COLOR?this._gl.DEPTH_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT:0)),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._clears++,this._shouldFlushAfterClear()&&(this._gl.flush(),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._flushes++),n!=null&&((e==mr.ALL||e==mr.COLOR)&&((a=n.colorTexture())==null||a.markContentHasBeenInitialized()),(e==mr.ALL||e==mr.DEPTH_STENCIL)&&((s=n.depthStencilTexture())==null||s.markContentHasBeenInitialized())),this._reportClearOrDraw()}useMaterial(e){if(e instanceof lh){let r=K.useUnifiedRenderer()?this._currentProgramInUseId!=e.getEmscriptenProgramId():this._currentProgramInUse!=e.program();(this._forceStateUpdate||r)&&(this._gl.useProgram(e.program()),this._gpuMetricsCollection.referenceShaderProgram(e.program()),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._shaderChanges++)}else e.bind(this._currentProgramInUseId,this._forceStateUpdate);K.useUnifiedRenderer()?this._currentProgramInUseId=e.getEmscriptenProgramId():this._currentProgramInUse=e.program(),this.setInputLayout(e.inputLayout())}bindVertexBuffer(e){return this._forceStateUpdate||this._boundState._currentVertexBuffer!==e?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._vertexBuffersReferenced++,this._boundState._currentVertexBuffer=e,!0):!1}setInputLayout(e){this._currentInputLayout!==e&&(this._currentInputLayout=e,this._drawState._inputLayoutStateDirty=!0)}setVertexBuffer(e,r){this.setVertexBufferInternal(0,e,r),this._drawState._numVertexBuffers!==1&&(this._drawState._numVertexBuffers=1,this._drawState._bufferStateDirty=!0)}setVertexBuffers2(e,r,n,o){this.setVertexBufferInternal(0,e,r),this.setVertexBufferInternal(1,n,o),this._drawState._numVertexBuffers!==2&&(this._drawState._bufferStateDirty=!0),this._drawState._numVertexBuffers=2}setVertexBufferInternal(e,r,n){let o=this._drawState._currentVertexBuffers[e]!==r||this._drawState._currentVertexBufferOffsets[e]!==n;return this._drawState._currentVertexBuffers[e]=r,this._drawState._currentVertexBufferOffsets[e]=n,o&&(this._drawState._bufferStateDirty=!0),o}prepareForDraw(){let e=this._currentInputLayout.numInputs();if(e!==this._drawState._numVertexBuffers)return;let r=this._gl;if(this._forceStateUpdate||this._drawState._bufferStateDirty||this._drawState._inputLayoutStateDirty){let n=0;for(let o=0;o<e;o++){let i=this._drawState._currentVertexBuffers[o],a=this._currentInputLayout.input(o);this.bindVertexBuffer(i.buffer());let s=a.attributes(),l=this._drawState._currentVertexBufferOffsets[o];for(let c of s){let d=c.type===1;r.vertexAttribPointer(n++,c.count,d?r.UNSIGNED_BYTE:r.FLOAT,d,a.stride(),l+c.byteOffset),this._vertexAttribDivisorInternal!==null&&this._boundState._currentAttribIsInstanced[n-1]!==c.isInstanced&&(this._vertexAttribDivisorInternal(n-1,c.isInstanced?1:0),this._boundState._currentAttribIsInstanced[n-1]=c.isInstanced)}}for(;this._attributeCount<n;)r.enableVertexAttribArray(this._attributeCount),this._attributeCount=this._attributeCount+1;for(;this._attributeCount>n;)this._attributeCount=this._attributeCount-1,r.disableVertexAttribArray(this._attributeCount);this._attributeCount=n}for(let n=0;n<this._drawState._numVertexBuffers;n++)this._drawState._currentVertexBuffers[n].uploadForDraw();this._drawState._bufferStateDirty=!1,this._drawState._inputLayoutStateDirty=!1}isContextLost(){return this._gl.isContextLost()}graphicsCardName(){if(this._cachedGraphicsCardName!=null)return this._cachedGraphicsCardName;let e=this._gl.getExtension("WEBGL_debug_renderer_info");return e===null?this._cachedGraphicsCardName="Unknown":this._cachedGraphicsCardName=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._cachedGraphicsCardName}isVisible(){let e=this._gl.canvas;return!e||!A_.Node_isConnected(e)?!1:T_.Element_isVisible(e)}setMaximumDrawingBufferSizeForTesting(e){this._mockMaximumDrawingBufferSize=new pe(e)}clearMaximumDrawingBufferSizeForTesting(){this._mockMaximumDrawingBufferSize=null}createMaterial(e,r,n,o){return new lh(this,e,r,n,o)}createVertexBufferPool(){return new ts(this,new NS(this))}createTexture(e,r,n,o){return this.createTextureWithPixels(e,r,n,null,o)}createTextureWithPixels(e,r,n,o,i){return new va(this,e,r,n,cr.createFromPixels(r,n,o),null,i)}createTextureWithVideo(e,r,n){return new va(this,e,r.videoWidth,r.videoHeight,null,r,n)}createFramebuffer(e,r,n){return new vu(this,va.from(e),va.from(r),n)}annotate(e,r){r()}annotateAndReturn(e,r){return r()}addMaterialToCheckProgramCreationStatusAsync(e){this._materialsToCheckProgramCreationStatus.push(e)}_checkMaterialProgramCreationStatuses(){if(this._materialsToCheckProgramCreationStatus.length!=0){for(let e of this._materialsToCheckProgramCreationStatus)e.haveCheckedProgramCreationStatus()||e.checkProgramCreationStatus();this._materialsToCheckProgramCreationStatus.length=0}}annotateProfile(e,r){r()}takeSpectorSnapshot(){Ms.takeSnapshot(this.gl().canvas)}_updateFramebufferAndViewport(e,r){let n=vu.from(e),o=r??(n==null?void 0:n.bounds());n||(o=this._defaultViewport);let i=this._gl;if(this._forceStateUpdate||this._oldFramebuffer!=n){let a=n==null?void 0:n.framebuffer();this.bindWebGLFramebufferAndTrackForBudget(a),this._oldFramebuffer=n,Qa.hasViewportBug()&&this._oldViewport.equals(o)&&(this._oldViewport.setX(o.x()+1),i.viewport(this._oldViewport.x()|0,this._oldViewport.y()|0,this._oldViewport.width()|0,this._oldViewport.height()|0),i.clear(0),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._clears++)}(this._forceStateUpdate||!this._oldViewport.equals(o))&&(i.viewport(o.x()|0,o.y()|0,o.width()|0,o.height()|0),this._oldViewport.copyFrom(o))}_updateBlendState(e){let r=Si._packBlendModes(e.sourceColor,e.targetColor,e.sourceAlpha,e.targetAlpha);if(this._forceStateUpdate||this._oldBlendOperations!=r||this._oldBlendState.constant!=e.constant){let n=this._gl,o=r,i=this._oldBlendOperations,a=o&255,s=o>>8&255,l=o>>16&255,c=o>>24,d=e.constant;o==Si.KEEP_BLEND_OPERATIONS?n.colorMask(!1,!1,!1,!1):((this._forceStateUpdate||i==Si.KEEP_BLEND_OPERATIONS)&&n.colorMask(!0,!0,!0,!0),o==Si.COPY_BLEND_OPERATIONS?(n.disable(n.BLEND),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glDisables++):((this._forceStateUpdate||i==Si.COPY_BLEND_OPERATIONS||i==Si.KEEP_BLEND_OPERATIONS)&&(n.enable(n.BLEND),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glEnables++),n.blendFuncSeparate(this._blendOperationMap.get(a),this._blendOperationMap.get(s),this._blendOperationMap.get(l),this._blendOperationMap.get(c)),n.blendColor(d,d,d,d))),this._oldBlendState=e,this._oldBlendOperations=r}}_updateStencilState(e){let r=this._gl,n=this._oldStencilState,o=e,i=o.frontFace,a=o.backFace,s=i==a?r.FRONT_AND_BACK:r.FRONT;(this._forceStateUpdate||!n.equals(o))&&((this._forceStateUpdate||n.isEnabled!=o.isEnabled)&&(o.isEnabled?(r.enable(r.STENCIL_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glEnables++):(r.disable(r.STENCIL_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glDisables++)),r.stencilFuncSeparate(s,this._comparisonMap.get(i.comparison),o.reference,o.readMask),r.stencilOpSeparate(s,this._operationMap.get(i.stencilFail),this._operationMap.get(i.stencilPassDepthPass),this._operationMap.get(i.stencilPassDepthPass)),r.stencilMaskSeparate(s,o.writeMask),i!=a&&(r.stencilFuncSeparate(r.BACK,this._comparisonMap.get(a.comparison),o.reference,o.readMask),r.stencilOpSeparate(r.BACK,this._operationMap.get(a.stencilFail),this._operationMap.get(a.stencilPassDepthPass),this._operationMap.get(a.stencilPassDepthPass)),r.stencilMaskSeparate(r.BACK,o.writeMask)),this._oldStencilState=o)}_updateScissorState(e){let r=e??null;r==null?(this._oldScissors!=null&&(this._gl.disable(this._gl.SCISSOR_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glDisables++),this._oldScissors=null):(this._oldScissors==null&&(this._gl.enable(this._gl.SCISSOR_TEST),this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._glEnables++),(this._oldScissors==null||!r.equals(this._oldScissors))&&(this._gl.scissor(r.x()|0,r.y()|0,Math.max(r.width(),0)|0,Math.max(r.height(),0)|0),this._oldScissors==null&&(this._oldScissors=x.new2()),this._oldScissors.copyFrom(r)))}hasLoggedHighpPrecisionUnsupported(){return this._hasLoggedHighpPrecisionUnsupported}setHasLoggedHighpPrecisionUnsupported(){this._hasLoggedHighpPrecisionUnsupported=!0}static from(e){return e}static _packBlendModes(e,r,n,o){return e|r<<8|n<<16|o<<24}getNumFramebufferSwitches(){return this._numFramebufferSwitches}resetNumFramebufferSwitches(){this._numFramebufferSwitches=0}bindWebGLFramebufferAndTrackForBudget(e){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._boundWebGLFramebuffer=e,this._gpuMetricsCollection.getCurrentFrameGPUSubMetrics()._framebufferBinds++}};Si.COPY_BLEND_OPERATIONS=Si._packBlendModes(1,0,1,0),Si.KEEP_BLEND_OPERATIONS=Si._packBlendModes(0,1,0,1);var ki=Si,Ls=class{location(){let e=ki.from(this._material.context());return this._generation!=e.generation()&&(this._location=e.gl().getUniformLocation(this._material.program(),this._name),this._generation=e.generation()),this._location}constructor(e,r){this._material=e,this._name=r,this._generation=0,this._location=null,this._isDirty=!0}},PS=class extends Ls{set(e){e!=this._x&&(this._x=e,this._isDirty=!0)}prepare(){let e=ki.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform1f(this.location(),this._x),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(4))}constructor(e,r){super(e,r),this._x=0}},FS=class extends Ls{set(e){e!=this._x&&(this._x=e,this._isDirty=!0)}prepare(){let e=ki.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform1i(this.location(),this._x),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(4))}constructor(e,r){super(e,r),this._x=0}},DS=class extends Ls{set(e,r){(e!=this._x||r!=this._y)&&(this._x=e,this._y=r,this._isDirty=!0)}prepare(){let e=ki.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform2f(this.location(),this._x,this._y),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(8))}constructor(e,r){super(e,r),this._x=0,this._y=0}},wS=class extends Ls{set(e,r,n,o){(e!=this._x||r!=this._y||n!=this._z||o!=this._w)&&(this._x=e,this._y=r,this._z=n,this._w=o,this._isDirty=!0)}prepare(){let e=ki.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniform4f(this.location(),this._x,this._y,this._z,this._w),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(16))}constructor(e,r){super(e,r),this._x=0,this._y=0,this._z=0,this._w=0}},Po=class Po extends Ls{set(e,r,n,o,i,a){Po._cachedFloat32Values[0]=e,Po._cachedFloat32Values[1]=o,Po._cachedFloat32Values[3]=r,Po._cachedFloat32Values[4]=i,Po._cachedFloat32Values[6]=n,Po._cachedFloat32Values[7]=a;for(let s=0;s<9;s=s+1)if(!(Number.isNaN(Po._cachedFloat32Values[s])&&Number.isNaN(this._float32Values[s])||Po._cachedFloat32Values[s]===1/0&&this._float32Values[s]===1/0||Po._cachedFloat32Values[s]===-1/0&&this._float32Values[s]===-1/0)&&Math.abs(Po._cachedFloat32Values[s]-this._float32Values[s])>=1e-5){let l=this._float32Values;this._float32Values=Po._cachedFloat32Values,Po._cachedFloat32Values=l,this._isDirty=!0;break}}prepare(){let e=ki.from(this._material.context());(this._generation!=e.generation()||this._isDirty)&&(e.gl().uniformMatrix3fv(this.location(),!1,this._float32Values),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(36))}constructor(e,r){super(e,r),this._float32Values=new Float32Array([1,0,0,0,1,0,0,0,1])}};Po._cachedFloat32Values=new Float32Array([1,0,0,0,1,0,0,0,1]);var xS=Po,LS=class extends Ls{set(e,r){(this._texture!=e||this._index!=r)&&(this._texture=va.from(e),this._index=r,this._isDirty=!0)}prepare(){let e=ki.from(this._material.context()),r=this._texture,n=e.gl();r==null&&(r=e.hackToAvoidMissingTextureWarningInChrome),(this._generation!=e.generation()||this._isDirty)&&(n.uniform1i(this.location(),this._index),this._isDirty=!1,e.getGpuMetricsCollection().getCurrentFrameGPUMetrics().logUniformVariableSet(4)),n.activeTexture(Ac.WebGLRenderingContext_TEXTURE_N(n,this._index)),n.bindTexture(n.TEXTURE_2D,r.texture()),e.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesReferenced++}constructor(e,r){super(e,r),this._texture=null,this._index=-1}},lh=class{constructor(e,r,n,o,i){this._context=null,this._name=null,this._vertexSource=null,this._fragmentSource=null,this._uniformsMap=new Map,this._uniformsList=[],this._generation=0,this._program=null,this._haveCheckedProgramCreationStatus=!1,this._context=e,this._name=r,this._inputLayout=n,this._vertexSource=o,this._fragmentSource=i,this._createProgram(),K.useUnifiedRenderer()&&Wd().then(()=>{this._emscriptenProgramId=yu.getNewProgramId()}),this._context.addMaterialToCheckProgramCreationStatusAsync(this)}context(){return this._context}name(){return this._name}inputLayout(){return this._inputLayout}setUniformFloat(e,r){let n=Qe.StringMap_get(this._uniformsMap,e,null);n==null&&(n=new PS(this,e),this._uniformsMap.set(e,n),this._uniformsList.push(n)),n.set(r)}setUniformInt(e,r){let n=Qe.StringMap_get(this._uniformsMap,e,null);n==null&&(n=new FS(this,e),this._uniformsMap.set(e,n),this._uniformsList.push(n)),n.set(r)}setUniformVec21(e,r,n){let o=Qe.StringMap_get(this._uniformsMap,e,null);o==null&&(o=new DS(this,e),this._uniformsMap.set(e,o),this._uniformsList.push(o)),o.set(r,n)}setUniformVec41(e,r,n,o,i){let a=Qe.StringMap_get(this._uniformsMap,e,null);a==null&&(a=new wS(this,e),this._uniformsMap.set(e,a),this._uniformsList.push(a)),a.set(r,n,o,i)}setUniformMat31(e,r,n,o,i,a,s){let l=Qe.StringMap_get(this._uniformsMap,e,null);l==null&&(l=new xS(this,e),this._uniformsMap.set(e,l),this._uniformsList.push(l)),l.set(r,n,o,i,a,s)}setUniformSampler(e,r,n){let o=Qe.StringMap_get(this._uniformsMap,e,null);o==null&&(o=new LS(this,e),this._uniformsMap.set(e,o),this._uniformsList.push(o)),o.set(r,n)}program(){return this._generation!=this._context.generation()&&(this._createProgram(),this.checkProgramCreationStatus()),this._program}getEmscriptenProgramId(){return this._emscriptenProgramId}prepare(){this._context.useMaterial(this);for(let e of this._uniformsList)e.prepare()}haveCheckedProgramCreationStatus(){return this._haveCheckedProgramCreationStatus}checkProgramCreationStatus(){if(this._generation!=this._context.generation())return;let e=this._context.gl();(()=>{if(e.getProgramParameter(this._program,e.LINK_STATUS))return;let n=a=>a.replace(new RegExp("\\bhighp\\b","g"),"mediump"),o=e.getAttachedShaders(this._program);if(o==null)throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`);let i=!1;for(let a of o){if(e.getShaderParameter(a,e.COMPILE_STATUS))continue;i=!0;let s=e.getShaderParameter(a,e.SHADER_TYPE);if(s===e.VERTEX_SHADER)this._vertexSource=n(this._vertexSource);else if(s===e.FRAGMENT_SHADER)this._fragmentSource=n(this._fragmentSource);else{if(e.isContextLost())return;throw new Error(`Unexpected shader type: ${s}`)}}if(!i){if(e.isContextLost())return;throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`)}if(this._createProgram(),e.getProgramParameter(this._program,e.LINK_STATUS)){this.context().hasLoggedHighpPrecisionUnsupported()||(be.trackEvent("highp_unsupported_device",{}),this.context().setHasLoggedHighpPrecisionUnsupported());return}if(o=e.getAttachedShaders(this._program),o==null)throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`);for(let a of o)if(!e.getShaderParameter(a,e.COMPILE_STATUS)){if(e.isContextLost())return;{let s=e.getShaderInfoLog(a);throw new Error(s)}}if(!e.isContextLost())throw new Error(`Failed to link shader ${this.name()}: ${e.getProgramInfoLog(this._program)}`)})(),this._haveCheckedProgramCreationStatus=!0}_createProgram(){let e=this._context.gl();if(this._program=e.createProgram(),Ms.addDebugMetadataToWebGLObject(this._program,{name:this._name}),!this._compileShader(e,e.VERTEX_SHADER,this._vertexSource)||!this._compileShader(e,e.FRAGMENT_SHADER,this._fragmentSource))return;let r=0;for(let n=0,o=this.inputLayout().numInputs();n<o;n++){let a=this.inputLayout().input(n).attributes();for(let s=0,l=a.length;s<l;s++)e.bindAttribLocation(this._program,r++,a[s].name)}e.linkProgram(this._program),this._generation=this._context.generation(),this._haveCheckedProgramCreationStatus=!1}_compileShader(e,r,n){let o=e.createShader(r);return o?(e.shaderSource(o,n),e.compileShader(o),e.attachShader(this._program,o),!0):!1}static from(e){return e}},Dc=class Dc{constructor(e,r,n){this._generation=0,this._initialGeneration=e.generation(),this._buffer=null,this._isDirty=!0,this._dirtyMin=Dc.INT_MAX,this._dirtyMax=0,this._totalMin=Dc.INT_MAX,this._totalMax=0,this._byteCount=0,this._glByteCount=0,this._context=e,this._byteCount=r,this._discardBytesAfterUpload=n,this._bytesForUploadMin=0,this._discardBytesAfterUpload?this._bytesForUploadMax=0:(this._bytesForUpload=new Uint8Array(r),this._bytesForUploadMax=this._byteCount)}buffer(){return this._buffer}context(){return this._context}bytesForUpload(){return this._bytesForUpload}byteCount(){return this._byteCount}moveBytesForUpload(e,r,n){e!=r&&n!=0&&(this._bytesForUpload.set(this._bytesForUpload.subarray(e,e+n),r),this._growDirtyRegion(Math.min(e,r),Math.max(e,r)+n))}setBytesForUpload(e,r){if(this._growDirtyRegion(r,r+e.length),!this._discardBytesAfterUpload){this._bytesForUpload.set(e,r);return}if(this._bytesForUpload==null){this._bytesForUpload=new Uint8Array(e),this._bytesForUploadMin=r,this._bytesForUploadMax=r+e.length;return}let n=Math.min(this._bytesForUploadMin,r),o=Math.max(this._bytesForUploadMax,r+e.length),i=this._bytesForUpload;this._bytesForUpload=new Uint8Array(o-n),this._bytesForUpload.set(i,this._bytesForUploadMin-n),this._bytesForUpload.set(e,r-n),this._bytesForUploadMin=n,this._bytesForUploadMax=o}uploadForDraw(){let e=this._context.gl();if(this._isDirty||this._dirtyMin<this._dirtyMax){if(this._context.bindVertexBuffer(this._buffer),this._isDirty){let r=this._glByteCount;e.bufferData(e.ARRAY_BUFFER,this._byteCount,e.DYNAMIC_DRAW),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._totalBandwidth+=this._byteCount,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._writeBandwidth+=this._byteCount,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBufferWriteBandwidth+=this._byteCount,this._glByteCount=this.byteCount(),this._context.stats().increment(1,"all",this._glByteCount-r),this._dirtyMin=this._totalMin,this._dirtyMax=this._totalMax,this._isDirty=!1}if(this._dirtyMin<this._dirtyMax){let r=this._bytesForUpload.subarray(this._dirtyMin-this._bytesForUploadMin,this._dirtyMax-this._bytesForUploadMin);e.bufferSubData(e.ARRAY_BUFFER,this._dirtyMin,r),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._totalBandwidth+=r.length,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._writeBandwidth+=r.length,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBufferWriteBandwidth+=r.length,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBufferUploadCount+=1,this._dirtyMin=Dc.INT_MAX,this._dirtyMax=0,this._discardBytesAfterUpload&&(this._bytesForUpload=null,this._bytesForUploadMin=0,this._bytesForUploadMax=0)}}}prepareForBinding(){let e=this._context.gl();if(this._initialGeneration!=this._context.generation()&&this._discardBytesAfterUpload){we("unexpectedly tried to re-create a vertex buffer with discardBytesAfterUpload");return}this._generation!=this._context.generation()&&(this._buffer=e.createBuffer(),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._vertexBuffersCreated++,Ms.addDebugMetadataToWebGLObject(this._buffer,{purpose:"Vertex Buffer"}),this._generation=this._context.generation(),this._isDirty=!0)}_growDirtyRegion(e,r){this._dirtyMin=Math.min(this._dirtyMin,e),this._dirtyMax=Math.max(this._dirtyMax,r),this._totalMin=Math.min(this._totalMin,e),this._totalMax=Math.max(this._totalMax,r)}static from(e){return e}};Dc.INT_MAX=2147483647;var wc=Dc,va=class{context(){return this._context}format(){return this._format}width(){return this._width}height(){return this._height}hasContentBeenInitialized(){return this.isRenderbuffer()?this.renderbuffer():this.texture(),this._hasContentBeenInitialized}markContentHasBeenInitialized(){this._hasContentBeenInitialized=!0}setShouldUnloadImageBuffer(e){this._shouldUnloadImageBuffer=e}_currentGlTextureSizeInBytes(){let e=this._glTextureWidth*this._glTextureHeight*fl.PixelFormat_byteCount(this._format.pixelFormat);return this._useMipmap&&(e+=e*.33),e|0}deleteTexture(){this._texture!=null?(this._context.gl().deleteTexture(this._texture),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesDestroyed++,this._context.stats().decrement(0,this._purpose,this._currentGlTextureSizeInBytes())):this._renderbuffer!=null&&(this._context.gl().deleteRenderbuffer(this._renderbuffer),this._context.stats().decrement(2,this._purpose,this._width*this._height*4))}resize1(e,r,n,o){this._width=e,this._height=r,this._pixels=n,this._useMipmap=o,this._isContentDirty=!0}_needsUploadToGPUTexture(){return this._isContentDirty||this._video!=null}setFormat(e){this._format!=e&&(this._format=e,this._isFormatDirty=!0)}isRenderbuffer(){return this._format.pixelFormat==1}invalidateVideoFrame(){this._isVideoFrameDirty=!0}texture(){let e=this._context.gl();if(this._generation!=this._context.generation()){if(this._texture=e.createTexture(),this._texture==null)return this._texture;this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesCreated++,Ms.addDebugMetadataToWebGLObject(this._texture,{purpose:this._purpose}),this._generation=this._context.generation(),this._isFormatDirty=!0,this._isContentDirty=!0,this._hasContentBeenInitialized=!1}if(this._isFormatDirty&&(e.bindTexture(e.TEXTURE_2D,this._texture),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesReferenced++,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.format().magFilter==0?e.NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.format().minFilter==0?e.NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.format().wrap==0?e.REPEAT:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.format().wrap==0?e.REPEAT:e.CLAMP_TO_EDGE),this._isFormatDirty=!1),this._needsUploadToGPUTexture()){let r=this._currentGlTextureSizeInBytes();e.bindTexture(e.TEXTURE_2D,this._texture),this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._texturesReferenced++;let n=this._width*this._height*fl.PixelFormat_byteCount(this.format().pixelFormat);if(this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._totalBandwidth+=n,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._writeBandwidth+=n,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._textureWriteBandwidth+=n,this._context.getGpuMetricsCollection().getCurrentFrameGPUSubMetrics()._textureUploadCount+=1,this._video!=null)this._isVideoFrameDirty&&(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._video),this._isVideoFrameDirty=!1,this._hasContentBeenInitialized=!0);else{if(this._pixels==null)return we("Tried to reupload image data after unloading it"),this._texture;let i=this._pixels.pixels;if(this._context.supportsCompressedTextures()&&this.format().isCompressedFormat()){let a=this._context.glInternalFormat(this.format().pixelFormat);e.compressedTexImage2D(e.TEXTURE_2D,0,a,this._width,this._height,0,i.array),this._hasContentBeenInitialized=i.array!=null}else i.imageBitmap!=null?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.imageBitmap),this._hasContentBeenInitialized=!0):i.img!=null?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.img),this._hasContentBeenInitialized=!0):i.canvas!=null?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.canvas),this._hasContentBeenInitialized=!0):(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this._width,this._height,0,e.RGBA,e.UNSIGNED_BYTE,i.array),this._hasContentBeenInitialized=i.array!=null);if(this._shouldUnloadImageBuffer){let a=F().modules().corePerfInfo;a==null||a.imageMemStatsFree(Rs.BUFFER,this._pixels.memorySize()),this._pixels=null}}this._glTextureWidth=this._width,this._glTextureHeight=this._height,this._useMipmap&&(e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR));let o=this._currentGlTextureSizeInBytes();this._context.stats().increment(0,this._purpose,o-r),this._isContentDirty=!1}return this._texture}renderbuffer(){let e=this._context.gl();if(this._generation!=this._context.generation()){if(this._renderbuffer=e.createRenderbuffer(),this.renderbuffer==null)return this.renderbuffer;Ms.addDebugMetadataToWebGLObject(this._renderbuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isContentDirty=!0,this._hasContentBeenInitialized=!1}if(this._isContentDirty){e.bindRenderbuffer(e.RENDERBUFFER,this._renderbuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this._width,this._height);let r=this._width*this._height*4;this._context.stats().increment(2,this._purpose,r),this._isContentDirty=!1,this._hasContentBeenInitialized=!1}return this._renderbuffer}static from(e){return e}constructor(e,r,n,o,i,a,s){this._context=e,this._format=r,this._width=n,this._height=o,this._pixels=i,this._video=a,this._purpose=s,this._shouldUnloadImageBuffer=!1,this._useMipmap=!1,this._renderbuffer=null,this._texture=null,this._generation=0,this._isFormatDirty=!0,this._isContentDirty=!0,this._isVideoFrameDirty=!0,this._hasContentBeenInitialized=!1,this._glTextureWidth=0,this._glTextureHeight=0}},vu=class{context(){return this._context}colorTexture(){return this._colorTexture}depthStencilTexture(){return this._depthStencilTexture}setColorTexture(e){this._colorTexture!=e&&(this._colorTexture=va.from(e),this._isDirty=!0)}resize(e,r){this._colorTexture!=null&&(e!=this._colorTexture.width()||r!=this._colorTexture.height())&&(this._colorTexture.resize1(e,r,null,!1),this._isDirty=!0),this._depthStencilTexture!=null&&(e!=this._depthStencilTexture.width()||r!=this._depthStencilTexture.height())&&(this._depthStencilTexture.resize1(e,r,null,!1),this._isDirty=!0)}setDepthStencil(e){this._depthStencilTexture!=e&&(this._depthStencilTexture=va.from(e),this._isDirty=!0)}framebuffer(){let e=this._context.gl();if(this._generation!=this._context.generation()){if(this._framebuffer=e.createFramebuffer(),this._framebuffer==null)return this._framebuffer;Ms.addDebugMetadataToWebGLObject(this._framebuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isDirty=!0}return this._isDirty&&(this._context.bindWebGLFramebufferAndTrackForBudget(this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._colorTexture.texture(),0),this._depthStencilTexture!=null&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this._depthStencilTexture.renderbuffer()),this._isDirty=!1),this._framebuffer}deleteTexture(){var e,r;(e=this._colorTexture)==null||e.deleteTexture(),(r=this._depthStencilTexture)==null||r.deleteTexture(),this._context.gl().deleteFramebuffer(this._framebuffer)}bounds(){var e,r;return new x(0,0,((e=this._colorTexture)==null?void 0:e.width())??0,((r=this._colorTexture)==null?void 0:r.height())??0)}static from(e){return e}constructor(e,r,n,o){this._context=e,this._colorTexture=r,this._depthStencilTexture=n,this._purpose=o,this._framebuffer=null,this._generation=0,this._isDirty=!0}},Ms;(l=>{function t(c){if(!window.spector){console.error("Can't take a Spector.js snapshot because Spector isn't loaded. Go here to install the Chrome extension: https://chrome.google.com/webstore/detail/spectorjs/denbgaamihkadbghdceggmchnflmhpmk?hl=en");return}window.spector.captureNextFrame(c)}l.takeSnapshot=t;function e(c,d){}l.addDebugMetadataToWebGLObject=e;function r(c,d){d()}l.annotate=r;function n(c,d){return d()}l.annotateAndReturn=n;function o(c){l._scopeStack.push(c),a()}l._beginScope=o;function i(c){l._scopeStack.pop(),a()}l._endScope=i;function a(){if(l._scopeStack.length==0)window.spector.clearMarker();else{let c=l._scopeStack.join(" > ");window.spector.setMarker(c)}}l._updateMarker=a,l._scopeStack=[]})(Ms||(Ms={}));var MS=!0;var Hn=class Hn{constructor(e,r){this._rect=null,this._radii=null,this._hash=0,this._cachedBezier=null,this._rect=e,this._radii=r.clippedForRectOfBounds(e),Hn.hasher.reset(),Hn.hasher.hash1(this._rect.x()),Hn.hasher.hash1(this._rect.y()),Hn.hasher.hash1(this._rect.width()),Hn.hasher.hash1(this._rect.height()),Hn.hasher.hash1(this._radii.topLeft),Hn.hasher.hash1(this._radii.topRight),Hn.hasher.hash1(this._radii.bottomRight),Hn.hasher.hash1(this._radii.bottomLeft),this._hash=Hn.hasher.value()}radii(){return this._radii}bounds(){return this._rect}equals2(e){return e instanceof Hn?this.equals1(e):!1}equals1(e){return this._rect.equals(e._rect)&&this._radii.equals(e._radii)}clone(){return new Hn(this._rect.clone(),this._radii)}hash(){return this._hash}isRect(){return this._radii.isZeros()}canBeAnalyticallyAntialiased(){return xc()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Bt.fromRoundedRect3(this._rect.x(),this._rect.y(),this._rect.width(),this._rect.height(),this._radii.toList())),this._cachedBezier}asRoundedRectPath(){return this}static fromRect(e){return new Hn(e,Ko.fromNodeRadius(0))}static fromRoundedRect(e){let r=e.vertexRadii()!=null?Ko.fromList(e.vertexRadii()):e.nodeRadius()!=0?Ko.fromNodeRadius(e.nodeRadius()):Ko.ZEROS;return new Hn(e.rect(),r)}static isRoundedRectSupportedIgnoringCornerSmoothing(e){if(e==null)return!1;let r=e.vertexRadii();if(r!=null){let n=Math.max(Math.max(r[0],r[1]),Math.max(r[2],r[3])),o=Math.min(e.width()/2,e.height()/2);if(n>o)return!1}return!0}static isRoundedRectSupported(e){return e==null||e.cornerSmoothing()!=0?!1:Hn.isRoundedRectSupportedIgnoringCornerSmoothing(e)}};Hn.hasher=new Wo;var vt=Hn,rs=class rs{constructor(e,r,n,o){this.topLeft=0,this.topRight=0,this.bottomRight=0,this.bottomLeft=0,this.topLeft=Math.max(e,0),this.topRight=Math.max(r,0),this.bottomRight=Math.max(n,0),this.bottomLeft=Math.max(o,0)}isZeros(){return this.topLeft==0&&this.topRight==0&&this.bottomRight==0&&this.bottomLeft==0}isUniform(){return this.topRight==this.topLeft&&this.bottomRight==this.topLeft&&this.bottomLeft==this.topLeft}equals(e){return this.topLeft==e.topLeft&&this.topRight==e.topRight&&this.bottomRight==e.bottomRight&&this.bottomLeft==e.bottomLeft}clippedForRectOfBounds(e){let r=Math.min(e.width()/2,e.height()/2);return new rs(Math.min(this.topLeft,r),Math.min(this.topRight,r),Math.min(this.bottomRight,r),Math.min(this.bottomLeft,r))}toList(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]}static fromList(e){return new rs(e[0],e[1],e[2],e[3])}static fromNodeRadius(e){return new rs(e,e,e,e)}static fromRoundedRect(e){return e.vertexRadii()!=null?rs.fromList(e.vertexRadii()):rs.fromNodeRadius(e.nodeRadius())}};rs.ZEROS=new rs(0,0,0,0);var Ko=rs;var Fo=class t{constructor(e){this.handle=0,this._cachedInfo=null,this._hash=0,this.handle=e}_updateCachedInfoIfNecessary(){if(this._cachedInfo==null){let e=F().modules().uniquePath_Internal.bounds(this.handle),r=e.max.x-e.min.x,n=e.max.y-e.min.y,o=new x(e.min.x,e.min.y,r,n);this._cachedInfo=new Ru(o,F().modules().uniquePath_Internal.isRect(this.handle))}}bounds(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.bounds}equals2(e){return e instanceof t?this.handle==e.handle:!1}clone(){return new t(this.handle)}hash(){return this._hash==null&&(this._hash=F().modules().uniquePath_Internal.getHash(this.handle)),this._hash}isRect(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.isRect}canBeAnalyticallyAntialiased(){return!1}toBezierPath(){throw new Error("We should never need to copy UniquePath data into JS")}asRoundedRectPath(){return null}compileLoopBlinnAndReturnVolatileTriangles(){let e=F().modules().uniquePath_Internal.loopBlinnCompile(this.handle);return e??(we("Failed to compile UniquePath"),cL)}},cL=new Uint8Array([]);var Cu=class Cu{each(e){this._innerMap.each((r,n)=>{let o=n.deref();o&&e(r,o)})}getOrInsertFallback(e){var n;let r=(n=this._innerMap.getOrNull(e))==null?void 0:n.deref();return r||(r=this._fallback(e),this.set(e,r)),r}get(e,r){var n;return((n=this._innerMap.getOrNull(e))==null?void 0:n.deref())??r}getOrNull(e){return this.get(e,null)}set(e,r){this.remove(e);let n=new WeakRef(r);this._innerMap.set(e,n),Cu._cacheFinalizer.register(r,this.getNonSelfRetainingCleanupCallback(e),n)}remove(e){let r=this._innerMap.getOrNull(e);r&&(this._innerMap.remove(e),Cu._cacheFinalizer.unregister(r))}getNonSelfRetainingCleanupCallback(e){let r=new WeakRef(this);return function(){var o;let n=r.deref();n&&!((o=n._innerMap.getOrNull(e))!=null&&o.deref())&&n._innerMap.remove(e)}}constructor(e,r,n){this._innerMap=new Vi(e,r,o=>{throw new Error("Cannot use fallback on WeakHashTable::_innerMap")}),this._fallback=n}};Cu._cacheFinalizer=new FinalizationRegistry(e=>{e()});var Ou=Cu;var Ai;(d=>{function t(u,p){if(Ft.int_remainder(u.byteCount(),d.NUM_BYTES_PER_FLOAT)!=0)return!1;let _=u.byteCount()/d.NUM_BYTES_PER_FLOAT|0;if(Ft.int_remainder(_,d.NUM_FLOATS_PER_VERTEX)!=0)return!1;let h=_/d.NUM_FLOATS_PER_VERTEX|0;if(Ft.int_remainder(h,3)!=0)return!1;if(u.byteCount()>p)throw new Error("This triangles chunk exceeds the maximum buffer size and will crash if we try to render it");return!0}d.isValid=t;function e(u){return u.byteCount()/(d.NUM_BYTES_PER_FLOAT*d.NUM_FLOATS_PER_VERTEX)|0}d.numVertices=e;function r(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_)}d.xValueAt=r;function n(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_+1*d.NUM_BYTES_PER_FLOAT)}d.yValueAt=n;function o(u,p){let _=r(u,p),h=n(u,p);return new O(_,h)}d.xyValueAt=o;function i(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_+2*d.NUM_BYTES_PER_FLOAT)}d.kValueAt=i;function a(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_+3*d.NUM_BYTES_PER_FLOAT)}d.lValueAt=a;function s(u,p){let _=p*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return u.floatAt(_+4*d.NUM_BYTES_PER_FLOAT)}d.mValueAt=s,d.NUM_BYTES_PER_FLOAT=4,d.NUM_FLOATS_PER_VERTEX=5})(Ai||(Ai={}));var Jr=class Jr{constructor(e,r){this._cachedTriangles=null;this._cachedTriangles=null,this._path=e,this._windingRule=r}static get uniqueValuesWeakRef(){return Jr._uniqueValuesWeakRef??(Jr._uniqueValuesWeakRef=new Ou(e=>e.hash,(e,r)=>e.equals(r),e=>new Jr(e.path,e.windingRule)))}static UNIT_RECT(){return Jr._UNIT_RECT!=null||(Jr._UNIT_RECT=new Jr(vt.fromRect(new x(0,0,1,1)),"NONZERO")),Jr._UNIT_RECT}static getOrCreate(e,r){return K.viewerCleanupBufferAreas()?Jr.uniqueValuesWeakRef.getOrInsertFallback(new Jr.PathAndWindingRuleArgs(e,r)):Jr._uniqueValues.getOrInsertFallback(new Jr.PathAndWindingRuleArgs(e,r))}equals(e){return e==null?!1:this._windingRule==e._windingRule&&this._path.equals2(e._path)}bounds(){return this._path.bounds()}isRect(){return this._path.isRect()}path(){return this._path}windingRule(){return this._windingRule}triangles(e,r){return be.perfTimerScope("generate-triangles-viewer",be.ProfileLevel.LOW,()=>{let n=this._cachedTriangles==null;if(n)this._cachedTriangles=this._convertToTriangles(e,r);else for(let o of this._cachedTriangles)if(o.bufferArea!=null&&!o.bufferArea.hasBuffer()){n=!0;break}}),this._cachedTriangles}_allTrianglesHaveSameOrientation(e){let r=0;for(let n=0;n<Ai.numVertices(e);n=n+3){let o=Ai.xyValueAt(e,n),i=Ai.xyValueAt(e,n+1),a=Ai.xyValueAt(e,n+2),s=O.cross(i.subtract(o),a.subtract(o)),l=s<0?-1:s>0?1:0;if(l!=0){if(r==-l)return!1;r=l}}return!0}_convertToTriangles(e,r){var a;let n=[],o;if(this._path instanceof Fo)o=this._path.compileLoopBlinnAndReturnVolatileTriangles();else{Jr.TEMP_ARRAY.clear();let s=this._path.toBezierPath();ih.compile(s,Jr.TEMP_ARRAY),o=Jr.TEMP_ARRAY.bytes()}let i=e.allocateVertexBufferAreas(qe.TRIANGLES,r,o);for(let s=0;s<i.length;s=s+1){let l=i[s].byteOffset(),c=i[s].byteCount(),d=K.shouldEnableVertexBufferDiscardBytesAfterUpload()?i[s].bufferBytesForUpload():(a=i[s].bufferBytesForUpload())==null?void 0:a.subarray(l,l+c);if(!d)continue;let u=new Bn(d),p=!0;for(let A=0,m=Ai.numVertices(u);A<m;A=A+1){let g=Ai.kValueAt(u,A),S=Ai.lValueAt(u,A),R=Ai.mValueAt(u,A);if(g!=.5||S!=.5||R!=.5){p=!1;break}}let _=Ai.numVertices(u)==3||this.isRect(),h=p&&this._allTrianglesHaveSameOrientation(u);n.push(new th(i[s],p,_,h))}return n}};Jr.TEMP_ARRAY=new Bn,Jr._UNIT_RECT=null,Jr._uniqueValues=new Vi(e=>e.hash,(e,r)=>e.equals(r),e=>new Jr(e.path,e.windingRule)),Jr._uniqueValuesWeakRef=void 0;var Nt=Jr;(e=>{class t{constructor(n,o){this.path=n,this.windingRule=o,this.hash=Wo.combine(n.hash(),o=="ODD"?1:0)}equals(n){return this.windingRule==n.windingRule&&this.path.equals2(n.path)}}e.PathAndWindingRuleArgs=t})(Nt||(Nt={}));var ch=class{path(){throw new Error("Not implemented")}bounds(){throw new Error("Not implemented")}geometryEquals(e){throw new Error("Not implemented")}constructor(e,r,n){this.type=e,this.windingRule=r,this.styleID=n}},jr=class t extends ch{constructor(e,r,n,o){super(0,e,r),this._path=null,this._bounds=null,this._path=n,this._bounds=o}path(){return this._path}bounds(){return this._bounds}geometryEquals(e){return e instanceof t?e.windingRule==this.windingRule&&e.bounds().equals(this._bounds)&&e.path().equals2(this._path):!1}},bu=class extends ch{constructor(e,r,n,o){super(1,e,r),this._computePath=null,this._maxBounds=null,this._computePath=n,this._maxBounds=o}path(){return this._computePath()}bounds(){return this._maxBounds}geometryEquals(e){return e==this}},Yo=class{constructor(e){this._overrideTable=null,this._overrideTable=e}get(e,r){if(this._overrideTable!=null&&this._overrideTable._in(e)){let n=this._overrideTable.styleByID1(e),o=n!=null?ya.get(n,102,null):null,i=o!=null?r.findStyle(ot.asStyleId(o)):null;if(i!=null&&i.styleType()=="FILL")return i.fillPaints();let a=n!=null?ya.get(n,61,null):null;if(a!=null)return ot.asPaintList(a)}return null}forEachPaint(e,r){var n;(n=this._overrideTable)==null||n.forEachFillPaint(e,r)}table(){return this._overrideTable}},$r=class{geometryEquals(e){return e==null?!1:ie.List_equalsWithComparison(this.regions,e.regions,(r,n)=>r.geometryEquals(n))}isRect(){return this.regions.length==1?Nt.getOrCreate(this.regions[0].path(),this.regions[0].windingRule).isRect():!1}toString(){return`Geometry(bounds: ${this.bounds} with ${this.regions.length} regions)`}constructor(e,r,n,o){this.regions=e,this.styleIDs=r,this.bounds=n,this.paintOverrides=o}},dh=class extends $r{constructor(e,r,n,o,i,a,s,l){super(e,r,n,o),this.emojiCodepoints=i,this.emojiRotationWidthHeights=a,this.emojiImageSet=s,this.decorationRegions=l}decorationRegionsEquals(e){return ie.List_equalsWithComparison(this.decorationRegions,e.decorationRegions,(r,n)=>r.geometryEquals(n))}},ht=class t{static equals(e,r){if(e!=null&&r!=null&&e.guids.length==r.guids.length){for(let n=0,o=e.guids.length;n<o;n=n+1)if(!Q.equals(e.guids[n],r.guids[n]))return!1;return!0}return e==r}static equalsGUID(e,r){return e!=null&&r!=null&&e.guids.length==1?Q.equals(e.guids[0],r):e==null&&r==null}toString(){return`[${this.guids.map(e=>e).join(", ")}]`}startsWith(e){if(this.guids==null)return e.guids==null;if(this.guids.length<e.guids.length)return!1;for(let r=0,n=e.guids.length;r<n;r=r+1)if(!Q.equals(e.guids[r],this.guids[r]))return!1;return!0}slice1(e){return this.slice2(e,this.guids.length)}slice2(e,r){return new t(this.guids.slice(e,r))}cloneAndAppend(e){let r=this.guids.slice();return Wr(r,e.guids),new t(r)}static fromString(e){if(e!=null&&e.length>=2&&e.startsWith("[")&&e.endsWith("]")){let r=e.slice(1,e.length-1).split(","),n=[];for(let o of r){let i=Q.fromString(o.trim());if(i==null)return null;n.push(i)}return new t(n)}return null}constructor(e){this.guids=e}static ROOT_STABLE_PATH(){return new t([])}},Ti;(o=>{function t(i){return i}o.map=t;function e(i){let a=[];return i.each((s,l)=>{a.push(`
  `+s.toString()+": "+Sr.toString(l))}),a.join(", ")}o.toString=e;function r(){return new No(i=>i.toString())}o._new=r;function n(i,a){let s=new No(l=>l.toString());for(let l=0,c=i.length;l<c;l=l+1)s.set(i[l],a[l]);return s}o.new1=n})(Ti||(Ti={}));var ns=class{toString(){return`SymbolData(id=${this.masterID}, overrides=[${Ti.toString(this.instanceOverrides)}])`}constructor(e,r){this.masterID=e,this.instanceOverrides=r}},uh=class{constructor(e,r){this.value=e,this.units=r}toString(){return`${this.value} ${this.units}`}},ph=class{constructor(e,r,n){this.family=e,this.style=r,this.postscript=n}toString(){return`${this.family} ${this.style}`}},Lc=class{constructor(e,r){this.type=e,this.value=r}},_h=class{constructor(e,r,n,o){this.suffix=e,this.imageType=r,this.constraint=n,this.contentsOnly=o}},sa=class t{static DEFAULT_FOR_TESTS(){return new t("DEFAULT_FLOW_FOR_TESTS","default flow for tests",gr.FIRST_POSITION)}constructor(e,r,n){this.name=e,this.description=r,this.position=n}},hh=class hh{size(){switch(this.rotation){case"NONE":return this.nonRotatedSize;case"CCW_90":return this.nonRotatedSize.flipped()}}canvasSpaceImageSize(e){let r=e.nonRotatedImageSize.divideScalar(e.scaleFactor);switch(this.rotation){case"NONE":return r;case"CCW_90":return r.flipped()}}canvasSpaceTopLeftOffset(e){let r=e.nonRotatedOffset,n=e.nonRotatedImageSize.divideScalar(e.scaleFactor),o=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return r;case"CCW_90":return new O(r.y(),n.x()-o.x()-r.x())}}canvasSpaceFramePresetSize(e){let r=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return r;case"CCW_90":return r.flipped()}}os(){return this.presetIdentifier==null||this.presetIdentifier==""?0:this.presetIdentifier.indexOf("APPLE")!=-1?this.presetIdentifier.indexOf("MACBOOK")!=-1?4:2:this.presetIdentifier.indexOf("GOOGLE")!=-1||this.presetIdentifier.indexOf("ANDROID")!=-1?1:this.presetIdentifier.indexOf("MICROSOFT")!=-1?5:(console.error(`${this.presetIdentifier} OS could not be inferred`),0)}toString(){return`PrototypeDevice(${this.type}, ${this.nonRotatedSize}, ${this.presetIdentifier}, ${this.rotation})`}toJSON(){return{type:this.type,size:{x:this.nonRotatedSize.x(),y:this.nonRotatedSize.y()},presetIdentifier:this.presetIdentifier,rotation:this.rotation}}constructor(e,r,n,o){this.type=e,this.nonRotatedSize=r,this.presetIdentifier=n,this.rotation=o}};hh.DEFAULT=new hh("NONE",new O(0,0),null,"NONE");var Cn=hh,la=class{constructor(){arguments.length==0?(this.backgroundType="NONE",this.backgroundColor=N.new3(0,0,0,.25)):arguments.length==2&&(this.backgroundType=arguments[0],this.backgroundColor=arguments[1])}},Sn=class{constructor(e=new Map){this._styleByID=e}_in(e){return this._styleByID.has(e)}styleByID1(e){return this._styleByID.get(e)}forEachStyle(e){for(let r of Array.from(this._styleByID.keys()))e(r,this._styleByID.get(r))}styleByID2(){return this._styleByID}forEachFillPaint(e,r){this.forEachStyle((n,o)=>{let i=ya.get(o,102,null),a=i!=null?e.findStyle(ot.asStyleId(i)):null;if(a!=null){let s=a.fillPaints();s!=null&&r(s)}else if(ya._in(o,61)){let s=ot.asPaintList(ya.get(o,61,null));s!=null&&r(s)}})}};var Nu=class{constructor(e,r,n){this.exitingTransitionRoot=e,this.swappedStablePath=r,this.hotspotInExitingTree=n}};function hb(t){return!t.hasNodeProperty(93)||t.prototypeStartingPoint()==null?!1:t.prototypeStartingPoint().name!=""||t.prototypeStartingPoint().description!=""||t.prototypeStartingPoint().position!=null&&gr.isValid(t.prototypeStartingPoint().position)}var Mc=class{constructor(e,r,n,o,i){this.paints=e,this.offset=r,this.layoutSize=n,this.canvasSize=o,this.devicePixelRatio=i}};var mh=class{constructor(e,r,n,o){this.ax=0,this.bx=0,this.cx=0,this.cy=0,this.by=0,this.ay=0,this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(o-r)-this.cy,this.ay=1-this.cy-this.by}_sampleCurveX(e){return((this.ax*e+this.bx)*e+this.cx)*e}_sampleCurveY(e){return((this.ay*e+this.by)*e+this.cy)*e}_sampleCurveDerivativeX(e){return(3*this.ax*e+2*this.bx)*e+this.cx}_sampleCurveDerivativeY(e){return(3*this.ay*e+2*this.by)*e+this.cy}_solveCurveX(e,r){let n=0,o=0,i=0,a=0,s=0;i=e;for(let l=0;l<8;l=l+1){if(a=this._sampleCurveX(i)-e,Math.abs(a)<r)return i;if(s=this._sampleCurveDerivativeX(i),Math.abs(s)<1e-6)break;i=i-a/s}if(n=0,o=1,i=e,i<n)return n;if(i>o)return o;for(;n<o;){if(a=this._sampleCurveX(i),Math.abs(a-e)<r)return i;e>a?n=i:o=i,i=(o-n)*.5+n}return i}solve(e,r){return this._sampleCurveY(this._solveCurveX(e,r))}getYDerivativeForXValue(e,r){let n=this._solveCurveX(e,r),o=this._sampleCurveDerivativeX(n);return Math.abs(o)>0?this._sampleCurveDerivativeY(n)/o:this._sampleCurveDerivativeY(n)}},fh=class{constructor(e,r){this._bezier=null,this._bezierInverse=null,this._durationSeconds=0,this._bezier=this.bezierForEasingFunction(e),this._bezierInverse=this.inverseBezierForEasingFunction(e),this._durationSeconds=r}bezierForEasingFunction(e){return e==null||e.length!=4?null:new mh(e[0],e[1],e[2],e[3])}inverseBezierForEasingFunction(e){return e==null||e.length!=4?null:new mh(e[1],e[0],e[3],e[2])}_solveEpsilon(e){return 1/(200*e)}getYValueForXValue(e){if(this._bezier==null)return e;let r=this._solveEpsilon(this._durationSeconds);return this._bezier.solve(e,r)}getDerivative(e,r){if(this._bezier==null)return 1;let n=this._solveEpsilon(this._durationSeconds);return this._bezier.getYDerivativeForXValue(e,n)}invert(e){if(this._bezier==null)return e;let r=this._solveEpsilon(this._durationSeconds);return this._bezierInverse.solve(e,r)}};var BS=class{constructor(e,r,n,o){this.m_w0=0,this.m_zeta=0,this.m_wd=0,this.m_A=0,this.m_B=0,this.m_w0=Math.sqrt(r/e),this.m_zeta=n/(2*Math.sqrt(r*e)),this.m_zeta<1?(this.m_wd=this.m_w0*Math.sqrt(1-this.m_zeta*this.m_zeta),this.m_A=1,this.m_B=(this.m_zeta*this.m_w0+-o)/this.m_wd):(this.m_A=1,this.m_B=-o+this.m_w0)}solve(e){return this.m_zeta<1?e=Math.exp(-e*this.m_zeta*this.m_w0)*(this.m_A*Math.cos(this.m_wd*e)+this.m_B*Math.sin(this.m_wd*e)):e=(this.m_A+this.m_B*e)*Math.exp(-e*this.m_w0),1-e}solveInverse(e){let r=0,n=0,o=Math.PI/this.m_w0,i=this.solve(o),a=0,s=.001,l=15;for(let c=0;c<l;c=c+1){a=(e-n)/(i-n)*(o-r)+r;let d=this.solve(a);if(Math.abs(d-e)<s)return a;d>e?(r=a,n=d):(o=a,i=d)}return a}},gh=class{constructor(e,r){this._spring=null,this._durationSeconds=0,this._spring=this.convertFunctionToUnitSpring(e),this._durationSeconds=r}convertFunctionToUnitSpring(e){return e==null||e.length!=4?null:new BS(e[0],e[1],e[2],e[3])}getYValueForXValue(e){if(this._spring==null)return e;let r=e*this._durationSeconds;return this._spring.solve(r)}getDerivative(e,r){return this._spring==null?1:r}invert(e){return this._spring==null?e:this._spring.solveInverse(e)/this._durationSeconds}};var oo=class oo{static easingFunctionCallbackCleanup(e){oo.easingFunctionCache.delete(e)}static cleanCache(){for(var e of oo.easingFunctionCache.entries())e[1].deref()===void 0&&(oo.easingFunctionCache.delete(e[0]),oo.easingFunctionCacheFinalizer.unregister(e[1]))}static makeEasingFunctionWithEasingType(e,r,n){oo.cleanCache();let o=null;o=this.createCacheKey(e,r,this.getAnimationType(n));let i=oo.easingFunctionCache.get(o);if(i!==void 0)return i.deref();let a=new oo(e,r,n),s=new WeakRef(a);return oo.easingFunctionCache.set(o,s),oo.easingFunctionCacheFinalizer.register(a,o,s),a}static makeEasingFunction(e,r){return oo.makeEasingFunctionWithEasingType(e,r)}static createCacheKey(e,r,n){let o=[];for(var i of e)o.push(i.toFixed(2));return o.push(";"),o.push(r.toFixed(2)),o.push(n),o.join()}static getAnimationType(e){return e=="GENTLE_SPRING"||e=="SPRING_PRESET_ONE"||e=="SPRING_PRESET_TWO"||e=="SPRING_PRESET_THREE"||e=="CUSTOM_SPRING"?1:0}constructor(e,r,n){this._easingFunction=e,this._animationType=oo.getAnimationType(n),this._durationSeconds=r,this._createAnimationUnit(this._easingFunction),this.bounds=oo.boundsForEasingFunction(this._easingFunction)}_createAnimationUnit(e){this._animationType==0?this._animationFunction=new fh(e,this._durationSeconds):this._animationType==1&&(this._animationFunction=new gh(e,this._durationSeconds))}get(e){return this._animationFunction.getYValueForXValue(e)}getDerivative(e,r){return this._animationFunction.getDerivative(e,r)}invert(e){return this._animationFunction.invert(e)}static boundsForEasingFunction(e){if(e==null)return Gr.FrozenRect_new3(x.fromMinAndMax(0,0,1,1));let r=ge.FrozenVector_new4(0,0),n=ge.FrozenVector_new4(e[0],e[1]),o=ge.FrozenVector_new4(e[2],e[3]),i=ge.FrozenVector_new4(1,1),a=r.clone(),s=i.clone(),l=r.negative().add(n),c=r.subtract(n.multiplyScalar(2)).add(o),d=r.negative().add(n.multiplyScalar(3)).subtract(o.multiplyScalar(3)).add(i),u=c.multiply(c).subtract(d.multiply(l));if(u.x()>0){u.setX(Math.sqrt(u.x()));for(let p of[(-c.x()-u.x())/d.x(),(-c.x()+u.x())/d.x()])if(p>0&&p<1){let _=1-p,h=_*_*_*r.x()+3*_*_*p*n.x()+3*_*p*p*o.x()+p*p*p*i.x();a.setX(Math.min(a.x(),h)),s.setX(Math.max(s.x(),h))}}if(u.y()>0){u.setY(Math.sqrt(u.y()));for(let p of[(-c.y()-u.y())/d.y(),(-c.y()+u.y())/d.y()])if(p>0&&p<1){let _=1-p,h=_*_*_*r.y()+3*_*_*p*n.y()+3*_*p*p*o.y()+p*p*p*i.y();a.setY(Math.min(a.y(),h)),s.setY(Math.max(s.y(),h))}}return x.fromMinAndMax(a.x(),a.y(),s.x(),s.y())}static easingValuesForPreset(e){switch(e){case"IN_CUBIC":return[.42,0,1,1];case"OUT_CUBIC":return[0,0,.58,1];case"INOUT_CUBIC":return[.42,0,.58,1];case"LINEAR":return[0,0,1,1];case"IN_BACK_CUBIC":return[.3,-.05,.7,-.5];case"OUT_BACK_CUBIC":return[.45,1.45,.8,1];case"INOUT_BACK_CUBIC":return[.7,-.4,.4,1.4];case"CUSTOM_CUBIC":return[0,0,.58,1];case"GENTLE_SPRING":return[1,100,15,0];case"SPRING_PRESET_ONE":return[1,300,20,0];case"SPRING_PRESET_TWO":return[1,600,15,0];case"SPRING_PRESET_THREE":return[1,80,20,0];case"CUSTOM_SPRING":return[1,100,15,0]}return[0,0,.58,1]}};oo.easingFunctionCache=new Map,oo.easingFunctionCacheFinalizer=new FinalizationRegistry(oo.easingFunctionCallbackCleanup);var uo=oo;var zn;(a=>{function t(s){return s=="PUSH_FROM_LEFT"||s=="PUSH_FROM_RIGHT"||s=="PUSH_FROM_TOP"||s=="PUSH_FROM_BOTTOM"}a.isPush=t;function e(s){return s=="MOVE_FROM_LEFT"||s=="MOVE_FROM_RIGHT"||s=="MOVE_FROM_TOP"||s=="MOVE_FROM_BOTTOM"}a.isMove=e;function r(s){return s=="SLIDE_FROM_LEFT"||s=="SLIDE_FROM_RIGHT"||s=="SLIDE_FROM_TOP"||s=="SLIDE_FROM_BOTTOM"}a.isSlide=r;function n(s){return s=="MOVE_OUT_TO_LEFT"||s=="MOVE_OUT_TO_RIGHT"||s=="MOVE_OUT_TO_TOP"||s=="MOVE_OUT_TO_BOTTOM"}a.isMoveOut=n;function o(s){return s=="SLIDE_OUT_TO_LEFT"||s=="SLIDE_OUT_TO_RIGHT"||s=="SLIDE_OUT_TO_TOP"||s=="SLIDE_OUT_TO_BOTTOM"}a.isSlideOut=o;function i(s){return t(s)||e(s)||n(s)||r(s)||o(s)}a.supportsSmartAnimate=i})(zn||(zn={}));var Hi=class Hi{constructor(e,r,n,o,i){this._isDeleted=!1,this._stateManagementVersion=0,this._hoverLastHandledFrameNum=-1,this._id=e,this._event=r,this._actions=n,this._isDeleted=o,this._stateManagementVersion=i,this._allActions=this.getAllActions()}getAllActions(){let e=[];for(let r of this.actions())if(e.push(r),r.connectionType()=="CONDITIONAL")for(let n of r.conditionalActions())for(let o of n.actions())e.push(o);return e}id(){return this._id!=null?this._id:Q.invalid()}event(){return this._event!=null?this._event:po.createDefault()}action(){return this._actions!=null&&this._actions.length!=0?new pe(this._actions[0]):null}actions(){return this._actions!=null?this._actions:[]}allActions(){return this._allActions!=null?this._allActions:[]}isDeleted(){return this._isDeleted}stateManagementVersion(){return this._stateManagementVersion}withEvent(e){return new Hi(this._id,e,this._actions,this._isDeleted,this._stateManagementVersion)}withActions(e){return new Hi(this._id,this._event,e,this._isDeleted,this._stateManagementVersion)}withStateManagementVersion(e){return new Hi(this._id,this._event,this._actions,this._isDeleted,e)}isValid(){if(this.event().interactionType()=="NONE"||this._actions==null||this._actions.length==0)return!1;let e=this.action();return e!=null&&e.value.connectionType()!="NONE"}apply(e){let r=this.action(),n=e.action(),o=[];r!=null&&n!=null?o=[r.value.apply(n.value)]:r!=null?o=[r.value]:n!=null&&(o=[n.value]);let i=this._event,a=e._event,s=null;return i!=null&&a!=null?s=i.apply(a):i!=null?s=i:a!=null&&(s=a),new Hi(this._id,s,o,e._isDeleted,e._stateManagementVersion)}setHoverLastHandledFrameNum(e){this._hoverLastHandledFrameNum=e}getHoverLastHandledFrameNum(){return this._hoverLastHandledFrameNum}toString(){let e="";return e+="PrototypeInteraction(",this._id!=null&&(e+=`id: ${this._id},`),this._event!=null&&(e+=`event: ${this._event.debugString()},`),this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=`isDeleted: ${this._isDeleted},`,e+=")",e}getAllActionsWithSpecificConnectionType(e){let r=[];for(let n of this.actions())if(n.connectionType()==e)r.push(n);else if(n.connectionType()=="CONDITIONAL")for(let o of n.conditionalActions())for(let i of o.actions())n.connectionType()==e&&r.push(n);return r}getAllActionsWithSpecificTransitionType(e){let r=[];for(let n of this.actions())if(n.transitionType()==e)r.push(n);else if(n.connectionType()=="CONDITIONAL")for(let o of n.conditionalActions())for(let i of o.actions())i.transitionType()==e&&r.push(i);return r}getAllValidTransitionActionsInInteraction(){let e=[];for(let r of this.actions())if(Q.isValid(r.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(r.connectionType())!=-1)e.push(r);else if(r.connectionType()=="CONDITIONAL")for(let n of r.conditionalActions())for(let o of n.actions())Q.isValid(r.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(r.connectionType())!=-1&&e.push(r);return e}interactionContainsTransitionAction(){for(let e of this.actions()){if(Q.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0;if(e.connectionType()=="CONDITIONAL"){for(let r of e.conditionalActions())for(let n of r.actions())if(Q.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0}}return!1}interactionContainsSpecificConnectionTypeAction(e){for(let r of this.actions()){if(r.connectionType()==e)return!0;if(r.connectionType()=="CONDITIONAL"){for(let n of r.conditionalActions())for(let o of n.actions())if(r.connectionType()==e)return!0}}return!1}getFirstActionInInteractionWithSpecificNavigation(e){for(let r of this.actions())if(r.navigationType()==e)return r;return null}static createDefault(){return new Hi(Q.invalid(),po.createDefault(),[],!1,0)}static equals(e,r){return e==null!=(r==null)?!1:e==null?!0:Q.equals(e._id,r._id)&&po.equals(e._event,r._event)&&ie.List_equalsWithComparison(e._actions,r._actions,(n,o)=>dr.equals(n,o))&&e._isDeleted==r._isDeleted&&e._stateManagementVersion==r._stateManagementVersion}static applyInteractions(e,r){if(e==null&&r==null)return Hi.EMPTY_LIST;if(e==null)return r;if(r==null)return e;let n=e.slice();return r.forEach(o=>{let i=!1;for(let a=0,s=e.length;a<s;a=a+1){let l=e[a];if(Q.equals(l.id(),o.id())){n[a]=l.apply(o),i=!0;break}}i||n.push(o)}),n.filter(o=>!o._isDeleted)}static whichAncestorToSwapState(e,r,n){let o=e!=null?e.scene().findNode(r):null,i=o?o.findContainingStateGroupOrSelf():null;if(i==null)return null;let a=e;for(;a!=null;){let s=null;a.type()=="INSTANCE"?s=e.scene().findNode(a.symbolID()):n==Hi.StateSwapPolicy.INCLUDE_SYMBOLS&&a.type()=="SYMBOL"&&(s=a);let l=s?s.findContainingStateGroupOrSelf():null;if(i==l)return a;a=a.parent()}return null}static whichInstanceToSwap(e,r){return Hi.whichAncestorToSwapState(e,r,Hi.StateSwapPolicy.INSTANCES_ONLY)}};Hi.EMPTY_LIST=[];var $t=Hi;(e=>{let t;(o=>(o[o.INCLUDE_SYMBOLS=0]="INCLUDE_SYMBOLS",o[o.INSTANCES_ONLY=1]="INSTANCES_ONLY"))(t=e.StateSwapPolicy||(e.StateSwapPolicy={}))})($t||($t={}));var Ll=class Ll{interactionType(){let e=this._interactionType!=null?this._interactionType:"ON_CLICK";return e=="NONE"?"ON_CLICK":e}interactionMaintained(){return this._interactionMaintained!=null?this._interactionMaintained.value:!1}interactionDuration(){return this._interactionDuration!=null&&this._interactionDuration.value>=0?this._interactionDuration.value:.3}keyTrigger(){return this._keyTrigger!=null?this._keyTrigger:{}}transitionTimeout(){return this._transitionTimeout!=null&&this._transitionTimeout.value>=0?this._transitionTimeout.value:.8}mediaHitTime(){return this._mediaHitTime!=null?this._mediaHitTime.value:0}withInteractionType(e){return new Ll(e,this._interactionMaintained,this._interactionDuration,this._keyTrigger,this._transitionTimeout,this._mediaHitTime)}apply(e){let r=this._interactionType,n=this._interactionMaintained,o=this._interactionDuration,i=this._keyTrigger,a=this._transitionTimeout,s=this._mediaHitTime;return e._interactionType!=null&&(r=e._interactionType),e._interactionMaintained!=null&&(n=e._interactionMaintained),e._interactionDuration!=null&&(o=e._interactionDuration),e._keyTrigger!=null&&(i=e._keyTrigger),e._transitionTimeout!=null&&(a=e._transitionTimeout),e._mediaHitTime!=null&&(s=e._mediaHitTime),new Ll(r,n,o,i,a,s)}debugString(){let e="";return e+="PrototypeEvent(",this._interactionType!=null&&(e+=`interactionType: ${this._interactionType},`),this._interactionMaintained!=null&&(e+=`interactionMaintained: ${this._interactionMaintained.value},`),this._interactionDuration!=null&&(e+=`interactionDuration: ${this._interactionDuration.value},`),this._keyTrigger!=null&&(e+=`keyTrigger: ${JSON.stringify(this._keyTrigger)},`),this._transitionTimeout!=null&&(e+=`transitionTimeout: ${this._transitionTimeout.value},`),this._mediaHitTime!=null&&(e+=`mediaHitTime: ${this._mediaHitTime.value},`),e+=")",e}static createDefault(){let e={};return e.keyCodes=[],e.triggerDevice="KEYBOARD",new Ll("NONE",new pe(!1),new pe(0),e,new pe(0),new pe(0))}static equals(e,r){return e==null!=(r==null)?!1:e==null?!0:e._interactionType==r._interactionType&&pe.equals(e._interactionMaintained,r._interactionMaintained)&&pe.equals(e._interactionDuration,r._interactionDuration)&&GS.equals(e._keyTrigger,r._keyTrigger)&&pe.equals(e._transitionTimeout,r._transitionTimeout)}constructor(e,r,n,o,i,a){this._interactionType=e,this._interactionMaintained=r,this._interactionDuration=n,this._keyTrigger=o,this._transitionTimeout=i,this._mediaHitTime=a}};Ll.NULL_EVENT=new Ll(null,null,null,null,null,null);var po=Ll,Pu=class Pu{constructor(e,r=""){this._actions=e,this._condition=r}actions(){return this._actions}condition(){return this._condition}debugString(){let e="";return e+="ConditionalActions(",this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=")",e}static createDefault(){return new Pu([])}static equals(e,r){if(e==null!=(r==null))return!1;if(e==null)return!0;let n=ie.List_equalsWithComparison(e._actions,r._actions,(i,a)=>dr.equals(i,a)),o=e._condition==r._condition;return n&&o}};Pu.NULL_CONDITIONAL_ACTIONS=new Pu(null);var Fu=Pu,jt=class jt{constructor(e,r,n,o,i,a,s,l,c,d,u,p,_,h,A,m,g,S,R,E,P,T,f,y,v,w,I,C){this._transitionNodeID=e,this._transitionType=r,this._transitionDuration=n,this._easingType=o,this._easingFunctionValues=i,this._transitionShouldSmartAnimate=a,this._connectionType=s,this._connectionURL=l,this._overlayRelativePosition=c,this._navigationType=d,this._transitionPreserveScroll=u,this.easingFunction=this.easingFunctionFromAction(),this._extraScrollOffset=p,this._mediaAction=_,this._transitionResetVideoPosition=h,this._openUrlInNewTab=A,this._mediaSkipToTime=m,this._mediaSkipByAmount=g,this._transitionResetScrollPosition=S,this._conditionalActions=R,this._transitionResetInteractiveComponents=E,this._targetVariableID=P,this._targetVariableData=T,this._targetVariableModeID=f,this._targetVariableSetID=y,this._deprecatedTargetVariableSetKey=v,this._targetNodeFieldAlias=w,this._animationType=I,this._animationPhase=C}transitionNodeID(){return this._connectionType==null||this.connectionType()=="INTERNAL_NODE"||this.connectionType()=="UPDATE_MEDIA_RUNTIME"||this.connectionType()=="OBJECT_ANIMATION"?this._transitionNodeID!=null?this._transitionNodeID:Q.invalid():Q.invalid()}transitionType(){let e=this._transitionType!=null?this._transitionType:"INSTANT_TRANSITION";return this.navigationType()=="OVERLAY"&&(e=="FADE"||zn.isPush(e)||zn.isSlide(e))?"INSTANT_TRANSITION":e}animationType(){return this._animationType!=null?this._animationType:"NONE"}animationPhase(){return this._animationPhase!=null?this._animationPhase:"IN"}transitionDuration(){return this.transitionType()=="INSTANT_TRANSITION"&&this.connectionType()!="OBJECT_ANIMATION"?0:this._transitionDuration!=null&&this._transitionDuration.value>=0?this._transitionDuration.value:.3}easingType(){return this._easingType!=null?this._easingType:"OUT_CUBIC"}easingFunctionValues(){switch(this.easingType()){case"CUSTOM_CUBIC":case"GENTLE_SPRING":case"SPRING_PRESET_ONE":case"SPRING_PRESET_TWO":case"SPRING_PRESET_THREE":case"CUSTOM_SPRING":return this._easingFunctionValues!=null?this._easingFunctionValues:uo.easingValuesForPreset(this.easingType());default:break}return uo.easingValuesForPreset(this.easingType())}transitionShouldSmartAnimate(){return this._transitionShouldSmartAnimate!=null?this._transitionShouldSmartAnimate.value:!1}connectionType(){return this._connectionType!=null?this._connectionType:"NONE"}connectionURL(){return this.connectionType()=="URL"?this._connectionURL:null}overlayRelativePosition(){return this._overlayRelativePosition!=null?this._overlayRelativePosition:O.new()}navigationType(){return this._navigationType!=null?this._navigationType:"NAVIGATE"}mediaAction(){return this._mediaAction!=null?this._mediaAction:"PLAY"}transitionPreserveScroll(){return this.transitionType()=="SMART_ANIMATE"||zn.supportsSmartAnimate(this.transitionType())&&this.transitionShouldSmartAnimate()?!0:zn.isSlide(this.transitionType())||zn.isPush(this.transitionType())||zn.isMove(this.transitionType())?!1:this._transitionPreserveScroll!=null?this._transitionPreserveScroll.value:!1}transitionResetVideoPosition(){return this._transitionResetVideoPosition!=null?this._transitionResetVideoPosition.value:!1}transitionResetScrollPosition(){return this._transitionResetScrollPosition!=null?this._transitionResetScrollPosition.value:!1}transitionResetInteractiveComponents(){return this._transitionResetInteractiveComponents!=null?this._transitionResetInteractiveComponents.value:!1}openUrlInNewTab(){return this._openUrlInNewTab!=null?this._openUrlInNewTab.value:!0}extraScrollOffset(){return this._extraScrollOffset!=null?this._extraScrollOffset:O.new()}mediaSkipToTime(){return this._mediaSkipToTime!=null&&this._mediaSkipToTime.value>=0?this._mediaSkipToTime.value:0}mediaSkipByAmount(){return this._mediaSkipByAmount!=null&&this._mediaSkipByAmount.value>=0?this._mediaSkipByAmount.value:5}conditionalActions(){return this._conditionalActions!=null?this._conditionalActions:[]}targetVariableID(){return this._targetVariableID}targetVariableData(){return this._targetVariableData}targetVariableModeID(){return this._targetVariableModeID}targetVariableSetID(){return this._targetVariableSetID}deprecatedTargetVariableSetKey(){return this._deprecatedTargetVariableSetKey}targetNodeFieldAlias(){return this._targetNodeFieldAlias}withTransitionNodeID(e){let r=jt.from(this);return r._transitionNodeID=e,r}withTransitionType(e){let r=jt.from(this);return r._transitionType=e,r}withTransitionDuration(e){let r=jt.from(this);return r._transitionDuration=new pe(e),r}withEasingType(e){let r=jt.from(this);return r._easingType=e,r}withEasingFunctionValues(e){let r=jt.from(this);return r._easingFunctionValues=e,r}withTransitionShouldSmartAnimate(e){let r=jt.from(this);return r._transitionShouldSmartAnimate=new pe(e),r}withConnectionType(e){let r=jt.from(this);return r._connectionType=e,r}withConnectionURL(e){let r=jt.from(this);return r._connectionURL=e,r}withOverlayRelativePosition(e){let r=jt.from(this);return r._overlayRelativePosition=e,r}withNavigationType(e){let r=jt.from(this);return r._navigationType=e,r}withTransitionPreserveScroll(e){let r=jt.from(this);return r._transitionPreserveScroll=new pe(e),r}withExtraScrollOffset(e){let r=jt.from(this);return r._extraScrollOffset=e,r}withMediaAction(e){let r=jt.from(this);return r._mediaAction=e,r}withTransitionResetVideoPosition(e){let r=jt.from(this);return r._transitionResetVideoPosition=new pe(e),r}withOpenUrlInNewTab(e){let r=jt.from(this);return r._openUrlInNewTab=new pe(e),r}withMediaSkipToTime(e){let r=jt.from(this);return r._mediaSkipToTime=new pe(e),r}withMediaSkipByAmount(e){let r=jt.from(this);return r._mediaSkipByAmount=new pe(e),r}withTransitionResetScrollPosition(e){let r=jt.from(this);return r._transitionResetScrollPosition=new pe(e),r}withConditionalActions(e){let r=jt.from(this);return r._conditionalActions=e,r}withTransitionResetInteractiveComponents(e){let r=jt.from(this);return r._transitionResetInteractiveComponents=new pe(e),r}withTargetVariableID(e){let r=jt.from(this);return r._targetVariableID=e,r}withTargetVariableData(e){let r=jt.from(this);return r._targetVariableData=e,r}withTargetVariableModeID(e){let r=jt.from(this);return r._targetVariableModeID=e,r}withTargetVariableSetID(e){let r=jt.from(this);return r._targetVariableSetID=e,r}withDeprecatedTargetVariableSetKey(e){let r=jt.from(this);return r._deprecatedTargetVariableSetKey=e,r}withTargetNodeFieldAlias(e){let r=jt.from(this);return r._targetNodeFieldAlias=e,r}withAnimationType(e){let r=jt.from(this);return r._animationType=e,r}withAnimationPhase(e){let r=jt.from(this);return r._animationPhase=e,r}easingFunctionFromAction(){return uo.makeEasingFunctionWithEasingType(this.easingFunctionValues(),this.transitionDuration(),this._easingType)}apply(e){let r=this._transitionNodeID,n=this._transitionType,o=this._transitionDuration,i=this._easingType,a=this._easingFunctionValues,s=this._transitionShouldSmartAnimate,l=this._connectionType,c=this._connectionURL,d=this._overlayRelativePosition,u=this._navigationType,p=this._transitionPreserveScroll,_=this._extraScrollOffset,h=this._mediaAction,A=this._transitionResetVideoPosition,m=this._openUrlInNewTab,g=this._mediaSkipToTime,S=this._mediaSkipByAmount,R=this._transitionResetScrollPosition,E=this._conditionalActions,P=this._transitionResetInteractiveComponents,T=this._targetVariableID,f=this._targetVariableData,y=this._targetVariableModeID,v=this._targetVariableSetID,w=this._deprecatedTargetVariableSetKey,I=this._targetNodeFieldAlias,C=this._animationType,L=this._animationPhase;return e._transitionNodeID!=null&&(r=e._transitionNodeID),e._transitionType!=null&&(n=e._transitionType),e._transitionDuration!=null&&(o=e._transitionDuration),e._easingType!=null&&(i=e._easingType),e._easingFunctionValues!=null&&(a=e._easingFunctionValues),e._transitionShouldSmartAnimate!=null&&(s=e._transitionShouldSmartAnimate),e._connectionType!=null&&(l=e._connectionType),e._connectionURL!=null&&(c=e._connectionURL),e._overlayRelativePosition!=null&&(d=e._overlayRelativePosition),e._navigationType!=null&&(u=e._navigationType),e._transitionPreserveScroll!=null&&(p=e._transitionPreserveScroll),e._extraScrollOffset!=null&&(_=e._extraScrollOffset),e._mediaAction!=null&&(h=e._mediaAction),e._transitionResetVideoPosition!=null&&(A=e._transitionResetVideoPosition),e._openUrlInNewTab!=null&&(m=e._openUrlInNewTab),e._mediaSkipToTime!=null&&(g=e._mediaSkipToTime),e._mediaSkipByAmount!=null&&(S=e._mediaSkipByAmount),e._transitionResetScrollPosition!=null&&(R=e._transitionResetScrollPosition),e._conditionalActions!=null&&(E=e._conditionalActions),e._transitionResetInteractiveComponents!=null&&(P=e._transitionResetInteractiveComponents),e._targetVariableID!=null&&(T=e._targetVariableID),e._targetVariableData!=null&&(f=e._targetVariableData),e._targetVariableModeID!=null&&(y=e._targetVariableModeID),e._targetVariableSetID!=null&&(v=e._targetVariableSetID),e._deprecatedTargetVariableSetKey!=null&&(w=e._deprecatedTargetVariableSetKey),e._targetNodeFieldAlias!=null&&(I=e._targetNodeFieldAlias),e._animationType!=null&&(C=e._animationType),e._animationPhase!=null&&(L=e._animationPhase),new jt(r,n,o,i,a,s,l,c,d,u,p,_,h,A,m,g,S,R,E,P,T,f,y,v,w,I,C,L)}debugString(){let e="";return e+="PrototypeAction(",this._transitionNodeID!=null&&(e+=`transitionNodeID: ${this._transitionNodeID},`),this._transitionType!=null&&(e+=`transitionType: ${this._transitionType},`),this._transitionDuration!=null&&(e+=`transitionDuration: ${this._transitionDuration.value},`),this._easingType!=null&&(e+=`easingType: ${this._easingType},`),this._easingFunctionValues!=null&&(e+=`easingFunctionValues: ${this._easingFunctionValues.map(r=>r.toString()).join(",")},`),this._transitionShouldSmartAnimate!=null&&(e+=`transitionShouldSmartAnimate: ${this._transitionShouldSmartAnimate.value},`),this._connectionType!=null&&(e+=`connectionType: ${this._connectionType},`),this._connectionURL!=null&&(e+=`connectionURL: ${this._connectionURL},`),this._overlayRelativePosition!=null&&(e+=`overlayRelativePosition: ${this._overlayRelativePosition},`),this._navigationType!=null&&(e+=`navigationType: ${this._navigationType},`),this._transitionPreserveScroll!=null&&(e+=`transitionPreserveScroll: ${this._transitionPreserveScroll.value},`),this._extraScrollOffset!=null&&(e+=`extraScrollOffset: ${this._extraScrollOffset},`),this._mediaAction!=null&&(e+=`mediaAction: ${this._mediaAction},`),this._transitionResetVideoPosition!=null&&(e+=`transitionResetVideoPosition: ${this._transitionResetVideoPosition.value},`),this._openUrlInNewTab!=null&&(e+=`openUrlInNewTab: ${this._openUrlInNewTab.value},`),this._mediaSkipToTime!=null&&(e+=`mediaSkipToTime: ${this._mediaSkipToTime.value},`),this._mediaSkipByAmount!=null&&(e+=`mediaSkipByAmount: ${this._mediaSkipByAmount.value},`),this._transitionResetScrollPosition!=null&&(e+=`transitionResetScrollPosition: ${this._transitionResetScrollPosition.value},`),this._conditionalActions!=null&&this._conditionalActions.length>0&&(e+=`conditionalActions: ${this._conditionalActions[0].debugString()},`),this._transitionResetInteractiveComponents!=null&&(e+=`transitionResetInteractiveComponents: ${this._transitionResetInteractiveComponents.value},`),this._targetNodeFieldAlias!=null&&(e+=`targetNodeFieldAlias: ${this._targetNodeFieldAlias},`),this._animationType!=null&&(e+=`animationType: ${this._animationType},`),this._animationPhase!=null&&(e+=`animationPhase: ${this._animationPhase},`),e+=")",e}static from(e){return new jt(e._transitionNodeID,e._transitionType,e._transitionDuration,e._easingType,e._easingFunctionValues,e._transitionShouldSmartAnimate,e._connectionType,e._connectionURL,e._overlayRelativePosition,e._navigationType,e._transitionPreserveScroll,e._extraScrollOffset,e._mediaAction,e._transitionResetVideoPosition,e._openUrlInNewTab,e._mediaSkipToTime,e._mediaSkipByAmount,e._transitionResetScrollPosition,e._conditionalActions,e._transitionResetInteractiveComponents,e._targetVariableID,e._targetVariableData,e._targetVariableModeID,e._targetVariableSetID,e._deprecatedTargetVariableSetKey,e._targetNodeFieldAlias,e._animationType,e._animationPhase)}static createDefault(){return new jt(Q.invalid(),"INSTANT_TRANSITION",new pe(0),"IN_CUBIC",uo.easingValuesForPreset("IN_CUBIC"),new pe(!1),"NONE",null,new O(0,0),"NAVIGATE",new pe(!1),new O(0,0),"PLAY",new pe(!1),new pe(!0),new pe(0),new pe(5),new pe(!1),[],new pe(!1),null,null,null,null,null,null,"NONE","IN")}static equals(e,r){return e==null!=(r==null)?!1:e==null?!0:Q.equals(e._transitionNodeID,r._transitionNodeID)&&e._transitionType==r._transitionType&&pe.equals(e._transitionDuration,r._transitionDuration)&&e._easingType==r._easingType&&ie.List_equalsWithComparison(e._easingFunctionValues,r._easingFunctionValues,(n,o)=>Math.abs(n-o)<1e-6)&&pe.equals(e._transitionShouldSmartAnimate,r._transitionShouldSmartAnimate)&&e._connectionType==r._connectionType&&e._connectionURL==r._connectionURL&&O.equals_(e._overlayRelativePosition,r._overlayRelativePosition)&&e._navigationType==r._navigationType&&pe.equals(e._transitionPreserveScroll,r._transitionPreserveScroll)&&pe.equals(e._transitionResetVideoPosition,r._transitionResetVideoPosition)&&pe.equals(e._openUrlInNewTab,r._openUrlInNewTab)&&O.equals_(e._extraScrollOffset,r._extraScrollOffset)&&e._mediaAction==r._mediaAction&&pe.equals(e._mediaSkipToTime,r._mediaSkipToTime)&&pe.equals(e._mediaSkipByAmount,r._mediaSkipByAmount)&&pe.equals(e._transitionResetScrollPosition,r._transitionResetScrollPosition)&&ie.List_equalsWithComparison(e._conditionalActions,r._conditionalActions,(n,o)=>Fu.equals(n,o))&&pe.equals(e._transitionResetInteractiveComponents,r._transitionResetInteractiveComponents)&&e._targetVariableSetID==r._targetVariableSetID&&e._targetVariableID==r._targetVariableID&&e._targetVariableData==r._targetVariableData&&e._targetVariableModeID==r._targetVariableModeID&&e._deprecatedTargetVariableSetKey==r._deprecatedTargetVariableSetKey&&e._targetNodeFieldAlias==r._targetNodeFieldAlias&&e._animationType==r._animationType&&e._animationPhase==r._animationPhase}};jt.NULL_ACTION=new jt(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[],null,null,null,null,null,null,null,null,null);var dr=jt,GS;(e=>{function t(r,n){return r==null!=(n==null)?!1:r==null?!0:ie.List_equalsWithComparison(r.keyCodes,n.keyCodes,(o,i)=>o==i)&&r.triggerDevice==n.triggerDevice}e.equals=t})(GS||(GS={}));var Ca=class t{constructor(e,r,n,o,i){this._styleOverrideTable=e,this._fontSizes=r,this._characters=n,this._lines=o,this._characterStyleIds=i}characters(){return this._characters}characterStyleIds(){return this._characterStyleIds}lines(){return this._lines}styleOverrideTable(){return this._styleOverrideTable}fontSizes(){return this._fontSizes}static forTests1(){return new t(new Sn,null,"",[],[])}static forTests2(e){return new t(e,null,"",[],[])}},Sh=class{constructor(e){this.paintOverrides=null,this.styleOverrideTable=null,this.paintOverrides=new Yo(e),this.styleOverrideTable=e}};var Do=class t{recomposed(){let e=X.new2();e.setM00(this.m00),e.setM01(this.m01),e.setM10(this.m10),e.setM11(this.m11),e.setM02(this.translation.x()),e.setM12(this.translation.y());let r=Math.PI/180*this.angleDegrees,n=Math.cos(r),o=Math.sin(r),i=X.new2();return i.setM00(n),i.setM01(-o),i.setM10(o),i.setM11(n),e.multiply(i),e.setM00(e.m00()*this.scale.x()),e.setM01(e.m01()*this.scale.y()),e.setM10(e.m10()*this.scale.x()),e.setM11(e.m11()*this.scale.y()),e}static from(e){let r=new t,n=e.m00(),o=e.m10(),i=e.m01(),a=e.m11();r.translation=O.new(e.translation()),r.scale=O.new(e.scale1()),n*a-o*i<0&&(n<a?r.scale.setX(-r.scale.x()):r.scale.setY(-r.scale.y())),r.scale.x()!=0&&(n*=1/r.scale.x(),o*=1/r.scale.x()),r.scale.y()!=0&&(i*=1/r.scale.y(),a*=1/r.scale.y());let l=Math.atan2(o,n);if(l!=0){let c=-o,d=n,u=n,p=o,_=i,h=a;n=d*u+c*_,o=d*p+c*h,i=-c*u+d*_,a=-c*p+d*h}return r.angleDegrees=180/Math.PI*l,r.m00=n,r.m10=o,r.m01=i,r.m11=a,r}static lerp1(e,r,n){let o=t.from(e),i=t.from(r);return t.lerp2(o,i,n).recomposed()}static lerp2(e,r,n){(e.scale.x()<0&&r.scale.y()<0||e.scale.y()<0&&r.scale.x()<0)&&(e.scale.setX(-e.scale.x()),e.scale.setY(-e.scale.y()),e.angleDegrees+=e.angleDegrees<0?180:-180),e.angleDegrees==0&&(e.angleDegrees=360),r.angleDegrees==0&&(r.angleDegrees=360),Math.abs(e.angleDegrees-r.angleDegrees)>180&&(e.angleDegrees>r.angleDegrees?e.angleDegrees-=360:r.angleDegrees-=360);let o=new t;return o.translation=e.translation.multiplyScalar(1-n).add(r.translation.multiplyScalar(n)),o.scale=e.scale.multiplyScalar(1-n).add(r.scale.multiplyScalar(n)),o.angleDegrees=e.angleDegrees*(1-n)+r.angleDegrees*n,o.m00=e.m00*(1-n)+r.m00*n,o.m10=e.m10*(1-n)+r.m10*n,o.m01=e.m01*(1-n)+r.m01*n,o.m11=e.m11*(1-n)+r.m11*n,o}constructor(){this.translation=O.new(),this.scale=O.new(),this.angleDegrees=0,this.m00=0,this.m01=0,this.m10=0,this.m11=0}};var Ml;(r=>{function t(n){return n=="GRADIENT_LINEAR"||n=="GRADIENT_RADIAL"||n=="GRADIENT_ANGULAR"||n=="GRADIENT_DIAMOND"}r.isGradient=t;function e(n){return n=="GRADIENT_ANGULAR"}r.shouldWrap=e})(Ml||(Ml={}));var ct=class{constructor(e,r){this.color=e,this.position=r}};ct.COMPARE=(e,r)=>xt.double_compare(e.position,r.position),ct.EQUALS=(e,r)=>e.color==r.color&&e.position==r.position;var Du=class Du{id(){return this._id}asSinglePaint(){return null}asVolatilePaint(){return null}debugString(){return""}isGradient(){switch(this.type()){case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":return!0}return!1}constructor(){this._id=Du._previousID=Du._previousID+1}};Du._previousID=0;var Ah=Du,Qo=class Qo extends Ah{constructor(r){super();this._patternScale=1;this._patternSpacing=ge.FrozenVector_ZERO;this._type=null,this._color=N.TRANSPARENT,this._opacity=1,this._isEnabled=!0,this._colorStops=null,this._blendMode="NORMAL",this._image=null,this._imageThumbnail=null,this._video=null,this._videoPlaybackParams="",this._transform=yt.FrozenAffineTransform_IDENTITY,this._rotationDeg=0,this._scalingFactor=1,this._imageScaleMode="STRETCH",this._filterColorAdjust=null,this._originalImageWidth=0,this._originalImageHeight=0,this._decodedImageIsReady=!1,this._decodedImageThumbnailIsReady=!1,this._patternTileType="RECTANGULAR",this._patternHorizontalAlignment="START",this._patternVerticalAlignment="START",this._patternScale=1,this._patternSpacing=ge.FrozenVector_ZERO,this._patternSourceAbsoluteBounds=Gr.FrozenRect_EMPTY,this._type=r}type(){return this._type}color(){return this._color}opacity(){return this._opacity}isEnabled(){return this._isEnabled}isVolatile(){return!1}isVisible(){return this._isEnabled&&this._opacity>0}blendMode(){return this._blendMode}transform(){return this._transform}setIsEnabled(r){this._isEnabled=r}debugString(){return`SinglePaint color=${N.toString(this._color)}[${N.toCSS(this._color)}] type=${this._type} blend=${this._blendMode} opacity=${this._opacity}${this._isEnabled?"":" [hidden]"}`}image(){return this._image}imageThumbnail(){return this._imageThumbnail}video(){return this._video}imageScaleMode(){return this._imageScaleMode}rotationDeg(){return this._rotationDeg}scalingFactor(){return this._scalingFactor}filterColorAdjust(){return this._filterColorAdjust}decodedImageIsReady(){return this._decodedImageIsReady}decodedImageThumbnailIsReady(){return this._decodedImageThumbnailIsReady}colorStops(){return this._colorStops}lastStopIsTransparent(){return this._colorStops.length!=0&&N.alpha(ie.List_last(this._colorStops).color)==0}isImageAvailable(){return this._image!=null&&this._image.isDecoded()}isImageThumbnailAvailable(){return this._image!=null&&this._image.isDecoded()}setType(r){this._type=r}setColor(r){this._color=r}setBlendMode(r){this._blendMode=r}setImage(r){this._image=r}setImageThumbnail(r){this._imageThumbnail=r}setVideo(r){this._video!=null&&r==null&&console.log(new Error().stack),this._video=r}videoPlaybackParams(r){this._videoPlaybackParams=r}setTransform(r){this._transform=r}setTransform1(r){this._transform=r.clone()}setImageScaleMode(r){this._imageScaleMode=r}setRotationDeg(r){this._rotationDeg=r}setScalingFactor(r){this._scalingFactor=r}setFilterColorAdjust(r){this._filterColorAdjust=r}setDecodedImageIsReady(r){this._decodedImageIsReady=r}setDecodedImageThumbnailIsReady(r){this._decodedImageThumbnailIsReady=r}setColorStops(r){this._colorStops=r}setColorStops1(r){this._colorStops=r.slice()}setOpacity(r){this._opacity=r}originalImageWidth(){return this._originalImageWidth}setOriginalImageWidth(r){this._originalImageWidth=r}originalImageHeight(){return this._originalImageHeight}setOriginalImageHeight(r){this._originalImageHeight=r}allocateBoundsToImageRatio(r,n){let o=O.new(r);return this._rotationDeg!=0&&(X.new2().rotatedBy(this._rotationDeg*(Math.PI/180)).transformPoint(n),n.makeAbs()),o.divideUpdate1(n),o}allocateImageSize(){let r=this._video!=null&&this._video.didLoad(this),n=this._image!=null&&this._image.isDecoded(),o=this._imageThumbnail!=null&&this._imageThumbnail.isDecoded();return r?this._video.size(this):n?new O(this._image.width(),this._image.height()):o?this._originalImageWidth!=0&&this._originalImageHeight!=0?new O(this._originalImageWidth,this._originalImageHeight):new O(this._imageThumbnail.width(),this._imageThumbnail.height()):null}allocateImageTransformForGeometrySize(r){let n=this._rotationDeg*(Math.PI/180),o=X.new2(),i=this.allocateImageSize();i==null&&we("Trying to render image before it is loaded");let a=this.allocateBoundsToImageRatio(r,i);switch(this.imageScaleMode()){case"FILL":{o=o.translatedBy2(.5,.5).rotatedBy(-n).scaledBy3(a.x()/a.maxComponent(),a.y()/a.maxComponent()).translatedBy2(-.5,-.5);break}case"FIT":{o=o.translatedBy2(.5,.5).rotatedBy(-n).scaledBy3(a.x()/a.minComponent(),a.y()/a.minComponent()).translatedBy2(-.5,-.5);break}case"STRETCH":{o.copyFrom(this.transform());break}case"TILE":{o=o.translatedBy2(.5,.5).rotatedBy(-n).translatedBy2(-.5,-.5).scaledBy2(1/this.scalingFactor()).scaledBy1(a);break}}return o}decodedImage(){return this.image().isDecoded()?this.image():null}decodedImageThumbnail(){return this.imageThumbnail().isDecoded()?this.imageThumbnail():null}scalingFactorForImage(r){return this.image()==null||r==null||r.width()==0||this.image().width()==0?this.scalingFactor():this.scalingFactor()*(this.image().width()/r.width())}colorAdjustIsActive(){return this._filterColorAdjust!=null&&(this._filterColorAdjust.tint!=0||this._filterColorAdjust.vibrance!=0||this._filterColorAdjust.shadows!=0||this._filterColorAdjust.highlights!=0||this._filterColorAdjust.exposure!=0||this._filterColorAdjust.contrast!=0||this._filterColorAdjust.temperature!=0)}colorAdjustSetData(r){let n=Lr.instance();r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_TINT,this._filterColorAdjust.tint),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_COLOR,this._filterColorAdjust.vibrance),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_SHADOWS,this._filterColorAdjust.shadows),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_HIGHLIGHTS,this._filterColorAdjust.highlights),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_EXPOSURE,this._filterColorAdjust.exposure),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_CONTRAST,this._filterColorAdjust.contrast),r.setUniformFloat(n.SHADER_NAME_U_GLOBAL_TEMPERATURE,this._filterColorAdjust.temperature)}isEnabledAndVisible(){if(!this.isEnabled()||this.opacity()<=0)return!1;switch(this.type()){case"SOLID":return N.alpha(this.color())>0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let r=0,n=this.colorStops().length;r<n;r=r+1)if(N.alpha(this.colorStops()[r].color)>0)return!0;return!1}}return!0}hasAnyFullyTransparentAreas(){if(!this.isEnabled()||this.opacity()<=0)return!0;switch(this.type()){case"SOLID":return N.alpha(this.color())==0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let r=0,n=this.colorStops().length;r<n;r=r+1)if(N.alpha(this.colorStops()[r].color)==0)return!0;return!1}case"EMOJI":case"IMAGE":case"VIDEO":case"PATTERN":return!0}return!0}hasAnimatingMedia(){return this.image()!=null&&this.image().gif()!=null||this.video()!=null}optimized(){if(this.isGradient()&&this.colorStops().length!=0){let r=this.colorStops()[0].color;for(let n=1,o=this.colorStops().length;n<o;n=n+1)if(r!=this.colorStops()[n].color)return this;return Qo.create("SOLID",this.opacity(),this.blendMode(),this.isEnabled(),r)}return this}equals1(r){return r.isVolatile()?!1:this.equals2(r.asSinglePaint())}equals2(r){var n;if(this._colorStops==null||r.colorStops()==null){if(this._colorStops==null!=(r.colorStops()==null))return!1}else if(!Yt.FrozenList_equals(this._colorStops,r.colorStops(),ct.EQUALS))return!1;if(this._transform==null||r.transform()==null){if(this._transform==null!=(r.transform()==null))return!1}else if(!this.transform().equals1(r.transform()))return!1;if(this._video==null||r.video()==null){if(this._video==null!=(r.video()==null))return!1}else if(this._video.hash()!=r.video().hash())return!1;if(this._image==null||r.image()==null){if(this._image==null!=(r.image()==null))return!1}else if(this._image.objectHash()!=r.image().objectHash())return!1;if(this._imageThumbnail==null||r.imageThumbnail()==null){if(this._imageThumbnail==null!=(r.imageThumbnail()==null))return!1}else if(this._imageThumbnail.objectHash()!=r.imageThumbnail().objectHash())return!1;if(this._patternSource==null||r.patternSource()==null){if(this._patternSource==null!=(r.patternSource()==null))return!1}else if(this._patternSource.id()!=((n=r.patternSource())==null?void 0:n.id()))return!1;return this._type==r.type()&&this._blendMode==r.blendMode()&&this._color==r.color()&&this._isEnabled==r.isEnabled()&&this._opacity==r.opacity()&&this._rotationDeg==r.rotationDeg()&&this._scalingFactor==r.scalingFactor()&&this._imageScaleMode==r.imageScaleMode()&&this._filterColorAdjust==r.filterColorAdjust()&&this._decodedImageIsReady==r.decodedImageIsReady()&&this._decodedImageThumbnailIsReady==r.decodedImageThumbnailIsReady()}clone(){return this.cloneAsSinglePaint()}cloneAsSinglePaint(){let r=new Qo(this._type);return r._blendMode=this._blendMode,r._color=this.color(),r._colorStops=this._colorStops,r._image=this._image,r._imageThumbnail=this._imageThumbnail,r._video=this._video,r._isEnabled=this._isEnabled,r._opacity=this._opacity,r._transform=this._transform,r._rotationDeg=this._rotationDeg,r._scalingFactor=this._scalingFactor,r._imageScaleMode=this._imageScaleMode,r._filterColorAdjust=this._filterColorAdjust,r._decodedImageIsReady=this._decodedImageIsReady,r._decodedImageThumbnailIsReady=this._decodedImageThumbnailIsReady,r._originalImageWidth=this._originalImageWidth,r._originalImageHeight=this._originalImageHeight,r._patternSource=this._patternSource,r._patternTileType=this._patternTileType,r._patternHorizontalAlignment=this._patternHorizontalAlignment,r._patternVerticalAlignment=this._patternVerticalAlignment,r._patternScale=this._patternScale,r._patternSpacing=this._patternSpacing,r._patternSourceAbsoluteBounds=this._patternSourceAbsoluteBounds,r}isOpaque(){if(this.opacity()<1||this.blendMode()!="NORMAL")return!1;switch(this.type()){case"SOLID":return N.isOpaque(this._color);case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{for(let r=0,n=this._colorStops.length;r<n;r=r+1){let o=this._colorStops[r];if(!N.isOpaque(o.color))return!1}return!0}case"EMOJI":case"IMAGE":case"VIDEO":case"PATTERN":return!1}return!1}flattenedStops(){let r=this._colorStops.slice();if(r.sort((n,o)=>xt.double_compare(n.position,o.position)),Ml.shouldWrap(this.type())&&r.length>=2){let n=r[0],o=ie.List_last(r);if(n.position>0)if(o.position<1){let i=N.mix(n.color,o.color,n.position/(1-o.position+n.position));r.unshift(new ct(i,0)),r.push(new ct(i,1))}else r.unshift(new ct(o.color,0));else o.position<1&&r.push(new ct(n.color,1))}return r}asSinglePaint(){return this}getCanvasSpaceUnclippedImageSize(r){if(!this.isImageAvailable()&&!this.isImageThumbnailAvailable())return ge.FrozenVector_ZERO;let n=this.allocateImageSize(),o=null;switch(this.imageScaleMode()){case"STRETCH":{o=r.divide(this._transform.scale1());break}case"FILL":{let i=this.allocateBoundsToImageRatio(r,n);i.x()>i.y()?o=new O(r.x(),i.x()*this._image.height()):o=new O(i.y()*this._image.width(),r.y());break}case"FIT":{let i=this.allocateBoundsToImageRatio(r,n);i.x()>i.y()?o=new O(i.y()*this._image.width(),r.y()):o=new O(r.x(),i.x()*this._image.height());break}case"TILE":return ge.FrozenVector_ZERO;default:return console.warn(`Unimplemented imageScaleMode ${this.imageScaleMode()} in getCanvasSpaceUnclippedImageSize`),ge.FrozenVector_ZERO}return o}patternSource(){return this._patternSource}setPatternSource(r){this._patternSource=r}patternTileType(){return this._patternTileType}setPatternTileType(r){this._patternTileType=r}patternHorizontalAlignment(){return this._patternHorizontalAlignment}setPatternHorizontalAlignment(r){this._patternHorizontalAlignment=r}patternVerticalAlignment(){return this._patternVerticalAlignment}setPatternVerticalAlignment(r){this._patternVerticalAlignment=r}patternScale(){return this._patternScale}setPatternScale(r){this._patternScale=r}patternSpacing(){return this._patternSpacing}setPatternSpacing(r){this._patternSpacing=r}patternSourceAbsoluteBounds(){return this._patternSourceAbsoluteBounds}setPatternSourceAbsoluteBounds(r){this._patternSourceAbsoluteBounds=r}static create(r,n,o,i,a){let s=new Qo(r);return s.setOpacity(n),s.setBlendMode(o),s.setIsEnabled(i),s.setColor(a),s}static createSolid(r,n){return Qo.create("SOLID",n*N.alphaF(r),"NORMAL",!0,N.withAlpha(r,255))}static createLinearGradient(r){let n=Qo.create("GRADIENT_LINEAR",1,"NORMAL",!0,N.BLACK);return n.setColorStops1(r),n}static createRadialGradient(r){let n=Qo.create("GRADIENT_RADIAL",1,"NORMAL",!0,N.BLACK);return n.setColorStops1(r),n}static createAngularGradient(r){let n=Qo.create("GRADIENT_ANGULAR",1,"NORMAL",!0,N.BLACK);return n.setColorStops1(r),n}static createDiamondGradient(r){let n=Qo.create("GRADIENT_DIAMOND",1,"NORMAL",!0,N.BLACK);return n.setColorStops1(r),n}};Qo.TRANSPARENT=Qo.create("SOLID",0,"NORMAL",!0,N.BLACK),Qo.SOLID_BLACK=Qo.create("SOLID",1,"NORMAL",!0,N.BLACK);var ee=Qo,wu=class t extends Ah{constructor(e,r,n,o,i){super(),this._from=null,this._to=null,this._getEasedT=null,this._fromCanvasSpaceNodeSize=null,this._toCanvasSpaceNodeSize=null,this._cachedFromTransform=null,this._cachedToTransform=null,this._cachedFromOffsetFromCenter=null,this._cachedToOffsetFromCenter=null,this._cachedFromImageOnCanvasSize=null,this._cachedToImageOnCanvasSize=null,this._from=e,this._to=r,this._getEasedT=n,this._fromCanvasSpaceNodeSize=o,this._toCanvasSpaceNodeSize=i,this._needsImageDimensionsForInterpolation()&&this._computeCachedImageDimensions()}_needsImageDimensionsForInterpolation(){return this.type()!="IMAGE"&&this.type()!="VIDEO"||!this._from.isImageAvailable()&&!this._from.isImageThumbnailAvailable()||!this._to.isImageAvailable()&&!this._to.isImageThumbnailAvailable()?!1:this._from.imageScaleMode()!="TILE"&&this._to.imageScaleMode()!="TILE"&&(this._from.imageScaleMode()=="STRETCH"||this._to.imageScaleMode()=="STRETCH"||this._from.imageScaleMode()!=this._to.imageScaleMode())}_computeCachedImageDimensions(){this.from().imageScaleMode()!="STRETCH"?(this._cachedFromTransform=this._from.allocateImageTransformForGeometrySize(this._fromCanvasSpaceNodeSize),this._cachedFromOffsetFromCenter=new O(0,0)):(this._cachedFromTransform=this.from().transform(),this._cachedFromOffsetFromCenter=new O(.5,.5).subtract(this._cachedFromTransform.scale1().divideScalar(2).add(this._cachedFromTransform.translation()))),this.to().imageScaleMode()!="STRETCH"?(this._cachedToTransform=this._to.allocateImageTransformForGeometrySize(this._toCanvasSpaceNodeSize),this._cachedToOffsetFromCenter=new O(0,0)):(this._cachedToTransform=this.to().transform(),this._cachedToOffsetFromCenter=new O(.5,.5).subtract(this._cachedToTransform.scale1().divideScalar(2).add(this._cachedToTransform.translation()))),this._cachedFromImageOnCanvasSize=this.from().getCanvasSpaceUnclippedImageSize(this._fromCanvasSpaceNodeSize),this._cachedToImageOnCanvasSize=this.to().getCanvasSpaceUnclippedImageSize(this._toCanvasSpaceNodeSize)}isEnabled(){return this._from.isEnabled()||this._to.isEnabled()}isVisible(){return this.isEnabled()&&(this._from.opacity()>0||this._to.opacity()>0)}isVolatile(){return!0}type(){return this._from.type()}blendMode(){return this._from.blendMode()}setIsEnabled(e){this._from.setIsEnabled(e),this._to.setIsEnabled(e)}isEnabledAndVisible(){return this._from.isEnabledAndVisible()||this._to.isEnabledAndVisible()}debugString(){return`VolatilePaint from=[${this._from.debugString()}] to=[${this._to.debugString()}]`}t(){return this._getEasedT()}from(){return this._from}to(){return this._to}color(){return N.mix(this._from.color(),this._to.color(),this._getEasedT())}isOpaque(){return this._from.isOpaque()&&this._to.isOpaque()}transform(){let e=new O(.5,.5),r=this._from.transform().clone().translatedBy1(e),n=this._to.transform().clone().translatedBy1(e);return Do.lerp1(r,n,this.t()).translatedBy1(e.negative())}allocateImageTransformForGeometrySize(e){let r=X.new2(),n=O.lerp(this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize,this.t());if(this.from().imageScaleMode()=="STRETCH"||this.to().imageScaleMode()=="STRETCH"||this.from().imageScaleMode()!=this.to().imageScaleMode()){(this._cachedFromTransform==null||this._cachedToTransform==null||this._cachedFromOffsetFromCenter==null||this._cachedToOffsetFromCenter==null||this._cachedFromImageOnCanvasSize==null||this._cachedToImageOnCanvasSize==null)&&this._computeCachedImageDimensions();let o=O.lerp(this._cachedFromImageOnCanvasSize,this._cachedToImageOnCanvasSize,this.t()),i=n.divide(o),a=O.lerp(this._cachedFromOffsetFromCenter,this._cachedToOffsetFromCenter,this.t()),s=new O(.5,.5).subtract(a).subtract(i.divideScalar(2)),l=xt.double_lerp(this._cachedFromTransform.toAngle(),this._cachedToTransform.toAngle(),this.t());return r.translatedBy1(s).rotatedBy(l).scaledBy1(i)}else{let o=this._from.allocateImageTransformForGeometrySize(n),i=this._to.allocateImageTransformForGeometrySize(n);return r.copyFrom(Do.lerp1(o,i,this.t())),r}}opacity(){return xt.double_clamp(xt.double_lerp(this.from().opacity(),this.to().opacity(),this.t()),0,1)}colorAdjustIsActive(){return this._from.colorAdjustIsActive()||this._to.colorAdjustIsActive()}colorAdjustSetData(e){let r=Lr.instance();e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_TINT,xt.double_clamp(xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().tint:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().tint:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_COLOR,xt.double_clamp(xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().vibrance:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().vibrance:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_SHADOWS,xt.double_clamp(xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().shadows:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().shadows:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_HIGHLIGHTS,xt.double_clamp(xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().highlights:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().highlights:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_EXPOSURE,xt.double_clamp(xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().exposure:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().exposure:0,this.t()),-1,1)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_CONTRAST,xt.double_clamp(xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().contrast:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().contrast:0,this.t()),-.3,.3)),e.setUniformFloat(r.SHADER_NAME_U_GLOBAL_TEMPERATURE,xt.double_clamp(xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().temperature:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().temperature:0,this.t()),-1,1))}equals1(e){return e.isVolatile()?this.equals2(e.asVolatilePaint()):!1}equals2(e){if(!e.isVolatile())return!1;let r=e;return this._from.equals2(r._from.asSinglePaint())&&this._to.equals2(r._to.asSinglePaint())&&this._getEasedT==r._getEasedT&&this._fromCanvasSpaceNodeSize.equals(r._fromCanvasSpaceNodeSize)&&this._toCanvasSpaceNodeSize.equals(r._toCanvasSpaceNodeSize)}clone(){return this.cloneAsVolatilePaint()}cloneAsVolatilePaint(){return new t(this._from.cloneAsSinglePaint(),this._to.cloneAsSinglePaint(),this._getEasedT,this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize)}hasAnyFullyTransparentAreas(){return this._from.hasAnyFullyTransparentAreas()&&this._to.hasAnyFullyTransparentAreas()}asVolatilePaint(){return this}eitherPaint(e){return e(this._from)||e(this._to)}static create(e,r,n,o,i){return new t(e,r,i,n,o)}},mb;(e=>e.FrozenPaint_EMPTY_LIST=[])(mb||(mb={}));var Se;(V=>{function t(b,D){return[ee.createSolid(b,D)]}V.createFromSolidColor=t;function e(b){return b}V.create1=e;function r(b){return b}V.create2=r;function n(b){return[b]}V.fromPaint=n;function o(b){return b}V.asPaintList=o;function i(b){return b.length==0}V.isEmpty=i;function a(b){return b.length}V.count=a;function s(b,D){return b[D]}V.get=s;function l(b){return b[0]}V.first=l;function c(b){return ie.List_last(b)}V.last=c;function d(b){return b.slice()}V.clone=d;function u(b){let D=!1;for(let U=0,H=b.length;U<H;U=U+1)b[U].type()=="EMOJI"&&(D=!0);return D}V.hasEmoji=u;function p(b,D){return Yt.FrozenList_equals(b,D,(U,H)=>U==null||H==null?U==null==(H==null):U.equals1(H))}V.equals=p;function _(b){return b.length==1?b[0]:null}V.onlyPaintOrNull=_;function h(b){let D=_(b);return D!=null&&D.type()=="SOLID"&&!D.isVolatile()?D:null}V.onlySolidPaintOrNull=h;function A(b){for(let D=0,U=b.length;D<U;D=D+1){let H=b.length-1-D;if(!b[H].isEnabledAndVisible())continue;let k=b[H];return k!=null&&k.type()=="SOLID"&&!k.isVolatile()&&k.asSinglePaint().isOpaque()?k:null}return null}V.firstPaintIfSolidAndOpaqueOrNull=A;function m(b){return b.length==1&&b[0].type()=="EMOJI"}V.isEmojiPaint=m;function g(b){if(b.length>1&&V.containsPatternPaint(b))return!1;for(let D=0,U=b.length;D<U;D=D+1){let H=b[D].asSinglePaint();if(H!=null){if(H.blendMode()!="NORMAL"&&H.blendMode()!="PASS_THROUGH")return!1}else{let k=b[D].asVolatilePaint();if(k!=null&&k.eitherPaint(z=>z.blendMode()!="NORMAL"&&z.blendMode()!="PASS_THROUGH"))return!1}}return!0}V.isIsolated=g;function S(b){for(let D of b)if(D.type()==="PATTERN")return!0;return!1}V.containsPatternPaint=S;function R(b){for(let D=0,U=b.length;D<U;D=D+1)if(b[D].isEnabledAndVisible())return!0;return!1}V.containsAtLeastOneVisiblePaint=R;function E(b){for(let D=0,U=b.length;D<U;D=D+1){let H=b[D].asSinglePaint(),k=b[D].asVolatilePaint();if(H==null&&k!=null&&k.isVisible()||H!=null&&H.isVisible()&&!H.hasAnyFullyTransparentAreas())return!0}return!1}V.containsAtLeastOneVisibleNotFullyTransparentPaint=E;function P(b){for(let D=0,U=b.length;D<U;D=D+1){if(!b[D].isEnabledAndVisible())continue;let H=b[D].asSinglePaint();if(H!=null){if(H.isOpaque())return!0}else{let k=b[D].asVolatilePaint();if(k!=null&&k.isOpaque())return!0}}return!1}V.containsAtLeastOneVisibleOpaquePaint=P;function T(b){for(let D=0,U=b.length;D<U;D=D+1){let H=b[D].asSinglePaint();if(H!=null){if(!H.isOpaque())return!0}else{let k=b[D].asVolatilePaint();if(k!=null&&!k.isOpaque())return!0}}return!1}V.containsAtLeastOneNonOpaquePaint=T;function f(b){for(let D=0,U=b.length;D<U;D=D+1){let H=b[D].asSinglePaint();if(H==null&&b[D].asVolatilePaint()!=null||!H.hasAnyFullyTransparentAreas())return!1}return!0}V.hasAnyFullyTransparentAreas=f;function y(b){for(let D=0,U=b.length;D<U;D=D+1){let H=b[D].asSinglePaint();if(H!=null){if(H.hasAnimatingMedia())return!0}else{let k=b[D].asVolatilePaint();if(k!=null&&k.eitherPaint(z=>z.hasAnimatingMedia()))return!0}}return!1}V.hasAnimatingMediaPaints=y;function v(b){for(let D=0,U=b.length;D<U;D=D+1)if(b[D].isVolatile())return!0;return!1}V.hasVolatilePaints=v;function w(b,D){var U,H;for(let k=0,z=b.length;k<z;k=k+1){let q=b[k].asSinglePaint();(q==null?void 0:q.video())!=null&&D(q);let Y=b[k].asVolatilePaint();((U=Y==null?void 0:Y.to())==null?void 0:U.video())!=null&&D(Y.to()),((H=Y==null?void 0:Y.from())==null?void 0:H.video())!=null&&D(Y.from())}}V.forEachPaintWithVideo=w;function I(b){if(g(b))return[b];let D=[],U="NORMAL",H="SOLID",k=[];for(let z=0,q=b.length;z<q;z=z+1){let Y=b[z];(Y.blendMode()!=U||Y.blendMode()!="NORMAL"||Y.type()==="PATTERN"||H==="PATTERN")&&k.length!=0&&(D.push(k.slice()),k.length=0),U=Y.blendMode(),H=Y.type(),k.push(Y)}return k.length!=0&&D.push(k.slice()),D}V.isolatedPaints=I;function C(b){if(v(b))return b;if(b.length==2&&b[0].type()=="SOLID"&&ie.List_last(b).asSinglePaint().isGradient()){let U=b[0].asSinglePaint(),H=N.multiplyOpacity(U.color(),U.opacity()),k=ie.List_last(b).clone(),z=[],q=-1,Y=!0,j=k.colorStops();for(let ae=0,xe=j.length;ae<xe;ae=ae+1){let Je=j[ae];if(q>=0&&q!=N.alpha(Je.color)){Y=!1;break}q=N.alpha(Je.color);let We=N.multiplyOpacity(Je.color,k.opacity());z.push(new ct(N.blend(H,We),Je.position))}if(Y)return k.setOpacity(1),k.setColorStops1(z),C([k])}let D=b.length;for(let U=0;U<D;U=U+1){let H=b[U].asSinglePaint().optimized();if(H==b[U])continue;let k=b.slice(0,U);for(k.push(H);(U=U+1)<D;)k.push(b[U].asSinglePaint().optimized());return k}return b}V.optimize=C,V.SOLID_BLACK=[ee.createSolid(N.BLACK,1)],V.EMPTY=[]})(Se||(Se={}));var Th;(r=>{function t(n){return Q._new(n,r._nextLocalID=r._nextLocalID+1)}r.make=t,r._nextLocalID=0})(Th||(Th={}));var Bl=class t{constructor(){this.assertEquals=AssertLib.strictEqual,this.trackingCalls=[],this._uninstall=null,this._uninstall=be.mockTrackEvent((e,r,n)=>{this.trackingCalls.push(new t.TrackingPayload(e,r,n))})}uninstall(){this._uninstall()}expectTrackToHaveBeenCalledWith1(e,r){this.expectTrackToHaveBeenCalledWith2(e,r,{})}expectTrackToHaveBeenCalledWith2(e,r,n){this.trackingCalls.some(o=>o.equalsWithSubsetOfArgs(new t.TrackingPayload(e,r,n)))}};(e=>{class t{equalsWithSubsetOfArgs(n){if(this.name!=n.name)return!1;for(let o of Object.keys(n.args))if(n.args[o]!==this.args[o])return!1;for(let o of Object.keys(n.options))if(n.options[o]!==this.options[o])return!1;return!0}constructor(n,o,i){this.name=n,this.args=o,this.options=i}}e.TrackingPayload=t})(Bl||(Bl={}));function qo(t){if(!xr())throw new Error(t)}function fb(t){Bc=Bc+1;let e=Q._new(1,Bc);for(let r=0,n=t.totalNodeCount();r<n&&t.findNode(e)!=null;r=r+1)Bc=Bc+1,e=Q._new(1,Bc);return e}function Qr(t,e){let r=t.scene().createNode(fb(t.scene()),e);return r.setVisible(!0),r.setOpacity(1),e!="CANVAS"&&e!="DOCUMENT"&&(r.setRelativeTransform(X.new2()),r.setSize(new O(100,100))),t.appendChild(r),r}function at(t,e){return Rr(t,e,N.BLACK)}function Xo(t,e,r){let n=Qr(t,"FRAME");return n.setName(e),n.setBackgroundOpacity(1),n.setIsBackgroundEnabled(!0),n.setIsFrameMaskDisabled(!1),n.setIsResizeToFit(!1),n.setTestOnlyFillPaints([r]),n.setStrokeAlign("CENTER"),n}function Gl(t,e,r,n,o){let i=Qr(t,"FRAME");return i.setName(e),i.setBackgroundOpacity(1),i.setIsBackgroundEnabled(!0),i.setIsFrameMaskDisabled(!1),i.setIsResizeToFit(!1),i.setStrokeAlign("CENTER"),i.setTestOnlyFillPaints(r),i.setTestOnlyStrokeGeometry(new $r([new jr("NONZERO",0,Bt.forCenterStrokeAroundRect(o,10),o)],null,o,null)),i.setTestOnlyStrokePaints(n),i}function Rr(t,e,r){let n=new ee("SOLID");return n.setColor(r),n.setOpacity(1),n.setIsEnabled(!0),Xo(t,e,n)}function gb(t,e){let r=ee.createLinearGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);return Xo(t,e,r)}function ca(t){let e=Qr(t,"FRAME");return e.setName("Group"),e.setBackgroundOpacity(1),Gs(e,!1),e.setIsResizeToFit(!0),e}function Gc(t){let e=Qr(t,"BOOLEAN_OPERATION");return e.setName("Boolean Operation"),e.setBackgroundOpacity(1),e.setIsBackgroundEnabled(!1),e.setIsResizeToFit(!0),e}function os(t,e){let r=ca(t);return r.setName(e),r}function dt(t){return at(t,"Frame")}function Sb(t){return Qr(t,"VECTOR")}function Wn(t){return Qr(t,"RECTANGLE")}function nt(t,e){let r=Wn(t);return r.setName(e),r}function Ab(t,e){let r=Qr(t,"ROUNDED_RECTANGLE");return r.setCornerRadius(e),r}function Eh(t){return Qr(t,"TEXT")}function dL(t,e){let r=Eh(t);return r.setName(e),r}function da(t){return Qr(t,"SYMBOL")}function Bs(t,e){let r=Qr(t,"INSTANCE");return r.setTestOnlySymbolData(new ns(e.id(),Ti.new1([],[]))),r}function zi(t){let e=new x(0,0,t.width(),t.height()),r=new jr("NONZERO",0,vt.fromRect(e),e);return new $r([r],null,r.bounds(),new Yo(new Sn))}function Tb(t,e){let r=new jr("NONZERO",0,Bt.fromRoundedRect1(new na(2,x.new3(t),e,null,0)),t);return new $r([r],null,r.bounds(),new Yo(new Sn))}function Eb(t){let e=Bt.new2();e.moveTo1(t.topLeft().x(),t.topLeft().y()).lineTo(t.topRight().x(),t.topRight().y()).lineTo(t.bottomLeft().x(),t.bottomLeft().y()).close();let r=new jr("NONZERO",0,e,t);return new $r([r],null,r.bounds(),new Yo(new Sn))}function Ib(t){let e=[];Et.INSTANCE.reset();for(let r of t)e.push(new jr("NONZERO",0,Bt.fromRect(r),r)),Et.INSTANCE.include3(r);return new $r(e,null,Et.INSTANCE.build(),new Yo(new Sn))}function Ul(t,e){US(t,e.id())}function US(t,e){var o;let r=t.prototypeInteractions().length==0?$t.createDefault():t.prototypeInteractions()[0],n=r.action()!=null?(o=r.action())==null?void 0:o.value:dr.createDefault();t.setTestOnlyPrototypeInteractions([r.withActions([n.withTransitionNodeID(e).withConnectionType("INTERNAL_NODE")])])}function en(t,e,r,n,o){return Ih(t,e,r,n,o,!1)}function Ih(t,e,r,n,o,i){switch(o){case"NAVIGATE":{Ul(t,e);break}case"OVERLAY":{Uc(t,e);break}case"SWAP":{yh(t,e);break}case"SWAP_STATE":{uL(t,e);break}}let a=t.prototypeInteractions()[0];return t.setTestOnlyPrototypeInteractions([a.withEvent(a.event().withInteractionType(r)).withActions([a.action().value.withTransitionType(n).withTransitionShouldSmartAnimate(i)]).withStateManagementVersion(1)]),t.prototypeInteractions()[0]}function Rh(t){var n;let e=t.prototypeInteractions().length==0?$t.createDefault():t.prototypeInteractions()[0],r=e.action()!=null?(n=e.action())==null?void 0:n.value:dr.createDefault();t.setTestOnlyPrototypeInteractions([e.withActions([r.withConnectionType("BACK")])])}function Uc(t,e){VS(t,e,O.new())}function VS(t,e,r){var i;let n=t.prototypeInteractions().length==0?$t.createDefault():t.prototypeInteractions()[0],o=n.action()!=null?(i=n.action())==null?void 0:i.value:dr.createDefault();t.setTestOnlyPrototypeInteractions([n.withActions([o.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withOverlayRelativePosition(r).withNavigationType("OVERLAY")])])}function yh(t,e){var o;let r=t.prototypeInteractions().length==0?$t.createDefault():t.prototypeInteractions()[0],n=r.action()!=null?(o=r.action())==null?void 0:o.value:dr.createDefault();t.setTestOnlyPrototypeInteractions([r.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP")])])}function uL(t,e){var o;let r=t.prototypeInteractions().length==0?$t.createDefault():t.prototypeInteractions()[0],n=r.action()!=null?(o=r.action())==null?void 0:o.value:dr.createDefault();t.setTestOnlyPrototypeInteractions([r.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP_STATE")])])}function kS(t){var n;let e=t.prototypeInteractions().length==0?$t.createDefault():t.prototypeInteractions()[0],r=e.action()!=null?(n=e.action())==null?void 0:n.value:dr.createDefault();t.setTestOnlyPrototypeInteractions([e.withActions([r.withConnectionType("CLOSE")])])}function vh(t,e){let r=t.prototypeInteractions().length==0?$t.createDefault():t.prototypeInteractions()[0];t.setTestOnlyPrototypeInteractions([r.withEvent(r.event().withInteractionType(e))])}function je(t,e,r){let n=X.new2();n.translate1(e),t.setRelativeTransform(n),t.setSize(r)}function de(t,e){let r=nt(t,e);return r.setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),r.setTestOnlyFillGeometry(zi(x.new4(new O(0,0),r.size()))),r}function qt(t,e,r,n){let o=nt(t,e);return o.setTestOnlyFillPaints([ee.createSolid(r,n)]),o.setTestOnlyFillGeometry(zi(x.new4(new O(0,0),o.size()))),o}function Ch(t,e,r){let n=nt(t,e);return n.setTestOnlyFillPaints(r),n.setTestOnlyFillGeometry(zi(x.new4(new O(0,0),n.size()))),n}function xu(t,e,r){let n=nt(t,e);return n.setSize(r),n.setTestOnlyFillPaints(Se.fromPaint(new ee("IMAGE"))),n.setTestOnlyFillGeometry(zi(x.new4(new O(0,0),n.size()))),n}function HS(t,e,r){let n=Qr(t,"VECTOR");return n.setName(e),n.setSize(r),n.setTestOnlyFillPaints(Se.fromPaint(new ee("IMAGE"))),n.setTestOnlyFillGeometry(Eb(x.new4(new O(0,0),n.size()))),n}function io(t,e,r,n,o){let i=nt(t,e);return i.setSize(o),i.setTestOnlyFillPaints([ee.createSolid(r,n)]),i.setTestOnlyFillGeometry(zi(x.new4(new O(0,0),i.size()))),i}function zS(t,e,r,n,o){let i=Qr(t,"VECTOR");return i.setName(e),i.setSize(o),i.setTestOnlyFillPaints([ee.createSolid(r,n)]),i.setTestOnlyFillGeometry(Eb(x.new4(new O(0,0),i.size()))),i}function Rb(t,e){let r=dL(t,e);return r.setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),r.setTestOnlyTextData(Ca.forTests1()),r}function WS(t){Oh(t,[])}function Oh(t,e){if(qo("Should only be used in tests"),F()==null)throw new Error("Expected PrototypeLib to be initialized");let r=[t],n=[];for(let a=0,s=e.length;a<s;a=a+1){let l={};l.bytes=e[a],n.push(l)}let o={type:"NODE_CHANGES",sessionID:0,ackID:0,blobs:n,nodeChanges:r},i=Ve().encodeMessage(o);F().applyLocalNodeChangesForTests(i)}function Gs(t,e){if(qo("Writing to paints is only supported in tests because it's not fully implemented"),Qt.isFrameLike(t.type())){let r=[],n=t.fillPaints();if(n!=null)for(let o=0,i=n.length;o<i;o=o+1){let a=n[o].clone();a.setIsEnabled(e),r.push(a)}t.setTestOnlyFillPaints(r)}else t.setIsBackgroundEnabled(!1)}var Bc=0;var Lu=(b=>(b[b.BOOL=0]="BOOL",b[b.DOUBLE=1]="DOUBLE",b[b.INT=2]="INT",b[b.STRING=3]="STRING",b[b.STRING_ENUM=4]="STRING_ENUM",b[b.AFFINE_TRANSFORM=5]="AFFINE_TRANSFORM",b[b.ARC_DATA=6]="ARC_DATA",b[b.GUID=7]="GUID",b[b.STYLE_ID=8]="STYLE_ID",b[b.OVERLAY_BACKGROUND_APPEARANCE=9]="OVERLAY_BACKGROUND_APPEARANCE",b[b.VECTOR=10]="VECTOR",b[b.EFFECT_LIST=11]="EFFECT_LIST",b[b.TRANSFORM_MODIFIER_LIST=12]="TRANSFORM_MODIFIER_LIST",b[b.PAINT_LIST=13]="PAINT_LIST",b[b.PROTOTYPE_INTERACTION_LIST=14]="PROTOTYPE_INTERACTION_LIST",b[b.GEOMETRY=15]="GEOMETRY",b[b.PARENT_INDEX=16]="PARENT_INDEX",b[b.PROTOTYPE_DEVICE=17]="PROTOTYPE_DEVICE",b[b.PROTOTYPE_STARTING_POINT=18]="PROTOTYPE_STARTING_POINT",b[b.VIDEO_PLAYBACK=19]="VIDEO_PLAYBACK",b[b.KEY_TRIGGER=20]="KEY_TRIGGER",b[b.SYMBOL_DATA=21]="SYMBOL_DATA",b[b.TEXT_DATA=22]="TEXT_DATA",b[b.DERIVED_TEXT_DATA=23]="DERIVED_TEXT_DATA",b[b.VECTOR_DATA=24]="VECTOR_DATA",b[b.HYPERLINK=25]="HYPERLINK",b[b.MENTION=26]="MENTION",b[b.STRING_STRING_MULTIPLAYER_MAP=27]="STRING_STRING_MULTIPLAYER_MAP",b[b.NODE_BEHAVIORS=28]="NODE_BEHAVIORS",b[b.CODE_SNAPSHOT=29]="CODE_SNAPSHOT",b[b.OTHER__=30]="OTHER__",b[b.END__=31]="END__",b))(Lu||{});function Vc(t){switch(t){case 101:case 12:case 9:case 13:case 10:case 11:case 14:case 89:case 8:case 24:case 17:case 15:case 16:case 18:case 19:case 99:case 86:case 111:return 0;case 46:case 52:case 53:case 3:case 56:case 44:case 45:case 81:case 82:case 83:case 84:case 85:case 87:case 22:case 20:case 23:case 21:case 47:case 48:case 49:case 50:case 51:case 54:case 55:return 1;case 67:case 68:return 2;case 73:case 65:case 92:case 109:case 108:return 3;case 28:case 33:case 26:case 27:case 35:case 36:case 37:case 39:case 41:case 38:case 114:case 42:case 94:case 80:case 29:case 40:case 1:case 2:case 34:case 97:case 25:return 4;case 30:case 31:return 5;case 66:return 6;case 58:case 59:case 72:case 74:return 7;case 102:case 103:case 104:case 105:case 106:return 8;case 70:return 9;case 100:case 60:case 98:case 57:return 10;case 64:return 11;case 113:return 12;case 110:return 28;case 61:case 62:case 63:return 13;case 112:return 29;case 90:case 91:return 14;case 76:case 77:return 15;case 32:return 16;case 69:return 17;case 93:return 18;case 88:return 20;case 78:return 21;case 4:return 22;case 5:return 23;case 79:return 24;case 75:return 19;case 6:return 25;case 7:return 26;case 95:case 96:return 27;case 71:case 107:case 43:return 30;default:return 31}}var fm=hc(Hd());function KS(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(KS||(KS={}));function yb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(yb||(yb={}));function vb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(vb||(vb={}));function Cb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Cb||(Cb={}));function kc(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(kc||(kc={}));function Ob(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Ob||(Ob={}));function bb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(bb||(bb={}));function Nb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Nb||(Nb={}));function Pb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Pb||(Pb={}));function Fb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Fb||(Fb={}));function Db(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Db||(Db={}));function wb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(wb||(wb={}));function xb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(xb||(xb={}));function Lb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Lb||(Lb={}));function YS(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(YS||(YS={}));function Mb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Mb||(Mb={}));function Bb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Bb||(Bb={}));function Gb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Gb||(Gb={}));function Hc(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Hc||(Hc={}));function Ub(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Ub||(Ub={}));function Vb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Vb||(Vb={}));function kb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(kb||(kb={}));function Hb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Hb||(Hb={}));function zb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(zb||(zb={}));function Wb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Wb||(Wb={}));function Kb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Kb||(Kb={}));function Yb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Yb||(Yb={}));function Qb(t){return t}(function(t){t.INVALID=t("");function e(r){return r}t.toString=e})(Qb||(Qb={}));var qb;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(qb||(qb={}));var Xb;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Xb||(Xb={}));var bh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(bh||(bh={}));var Nh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Nh||(Nh={}));var Ph;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Ph||(Ph={}));var Fh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Fh||(Fh={}));var Dh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Dh||(Dh={}));var Mu;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Mu||(Mu={}));var wh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(wh||(wh={}));var xh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(xh||(xh={}));var Lh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Lh||(Lh={}));var Mh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Mh||(Mh={}));var Bh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Bh||(Bh={}));var Gh;(function(t){t.toString=Zo,t.fromString=Jo,t.fromKiwi=jo,t.isEqual=$o,t.isValid=ei})(Gh||(Gh={}));function Zo({key:t,version:e}){return`${KS.toString(t)}/${YS.toString(e)}`}function Jo(t){let e=t.split("/");if(e.length!==2)return null;let[r,n]=e;return r&&n?{key:r,version:n}:null}function jo({key:t,version:e}){return!t||!e?null:{key:t,version:e}}function $o(t,e){return!t||!e?t===e:t.key===e.key&&t.version===e.version}function ei({key:t,version:e}){return!!(t&&e)}var Zb={sessionID:-1,localID:-1},ti="-1:-1";function Jb(t){return t?(t.localID|0)>=0&&(t.sessionID|0)>=0:!1}function QS(t){return t?`${t.sessionID|0}:${t.localID|0}`:null}function Uh(t){if(!t)return null;let e=t.split(":");if(!e||e.length!==2)return null;let r=-1,n=-1;try{r=parseInt(e[0]),n=parseInt(e[1])}catch{return null}return!isFinite(r)||!isFinite(n)?null:{sessionID:r,localID:n}}function jb(t,e,...r){typeof FIGBUILD_PROD=="boolean"&&!FIGBUILD_PROD&&!t&&console.error(`Failed assertion: ${e}`,...r)}var $b;(function(t){let r=Ei("CodeLibraryId:",Lh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})($b||($b={}));var eN;(function(t){let r=Ei("CodeFileId:",Mh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(eN||(eN={}));var tN;(function(t){let r=Ei("CodeComponentId:",Bh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(tN||(tN={}));var rN;(function(t){let r=Ei("ManagedStringId:",Gh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(rN||(rN={}));var nN;(function(t){let r=Ei("ResponsiveSetId:",xh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(nN||(nN={}));var Vl;(function(t){let r=Ei("SymbolId:",bh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(Vl||(Vl={}));var kl;(function(t){let r=Ei("StateGroupId:",Nh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(kl||(kl={}));var oN;(function(t){let r=Ei("StyleId:",Ph);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid;function n(o){return o.guid&&o.guid!==ti?t.fromLocalNodeIdStr(o.guid):t.fromRef(o.ref)}t.fromBindingsObj=n})(oN||(oN={}));var iN;(function(t){let r=Ei("VariableID:",Fh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(iN||(iN={}));var aN;(function(t){let r=Ei("VariableOverrideId:",Dh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(aN||(aN={}));var is;(function(t){let e="VariableCollectionId:",r="VariableSetID:",n=Ei(e,Mu),o=Ei(r,Mu);t.INVALID=n.fromLocalNodeIdStr(ti),t.toString=n.toString,t.toKiwi=i({current:n.toKiwi,deprecated:o.toKiwi}),t.toGuidObjIfLocal=i({current:n.toGuidObjIfLocal,deprecated:o.toGuidObjIfLocal}),t.toGuidStrIfLocal=i({current:n.toGuidStrIfLocal,deprecated:o.toGuidStrIfLocal}),t.toRefIfSubscribed=i({current:n.toRefIfSubscribed,deprecated:o.toRefIfSubscribed}),t.fromString=i({current:n.fromString,deprecated:o.fromString}),t.fromLocalNodeIdObj=n.fromLocalNodeIdObj,t.fromLocalNodeIdStr=n.fromLocalNodeIdStr,t.fromRef=n.fromRef,t.fromKiwi=n.fromKiwi,t.isValid=i({current:n.isValid,deprecated:o.isValid});function i({current:a,deprecated:s}){return l=>l.startsWith(r)?s(l):a(l)}})(is||(is={}));var sN;(function(t){let r=Ei("ModuleId:",wh);t.INVALID=r.fromLocalNodeIdStr(ti),t.toString=r.toString,t.toKiwi=r.toKiwi,t.toGuidObjIfLocal=r.toGuidObjIfLocal,t.toGuidStrIfLocal=r.toGuidStrIfLocal,t.toRefIfSubscribed=r.toRefIfSubscribed,t.fromString=r.fromString,t.fromLocalNodeIdObj=r.fromLocalNodeIdObj,t.fromLocalNodeIdStr=r.fromLocalNodeIdStr,t.fromRef=r.fromRef,t.fromKiwi=r.fromKiwi,t.isValid=r.isValid})(sN||(sN={}));var lN;(function(t){t.fromKiwi=e=>{if(e.guid)return{type:"guid",guid:QS(e.guid)};if(e.stateGroupId){let r=kl.fromKiwi(e.stateGroupId);if(r)return{type:"stateGroup",stateGroupId:r}}if(e.symbolId){let r=Vl.fromKiwi(e.symbolId);if(r)return{type:"symbol",symbolId:r}}jb(!1,"Unhandled CanvasNodeId type")},t.toGuidStrIfLocal=e=>{switch(e.type){case"guid":return e.guid;case"symbol":return Vl.toGuidStrIfLocal(e.symbolId);case"stateGroup":return kl.toGuidStrIfLocal(e.stateGroupId)}},t.toRefIfSubscribed=e=>{switch(e.type){case"guid":return null;case"symbol":return Vl.toRefIfSubscribed(e.symbolId);case"stateGroup":return kl.toRefIfSubscribed(e.stateGroupId)}},t.toString=e=>{switch(e.type){case"guid":return e.guid;case"symbol":return Vl.toString(e.symbolId);case"stateGroup":return kl.toString(e.stateGroupId)}},t.fromString=e=>{let r=Vl.fromString(e);if(r)return{type:"symbol",symbolId:r};let n=kl.fromString(e);return n?{type:"stateGroup",stateGroupId:n}:Uh(e)?{type:"guid",guid:e}:null}})(lN||(lN={}));function Ei(t,e){function r(m){return m}function n(m,g){return m.startsWith(t)?g(m.slice(t.length)):null}function o(m){return Uh(m)}function i(m){return e.fromString(m)}function a(m){return n(m,S=>{let R=i(S);if(R)return{assetRef:R};let E=o(S);if(E)return{guid:E}})??{guid:Zb}}function s(m){return n(m,g=>i(g)?null:o(g))}function l(m){return n(m,g=>i(g)?null:g)}function c(m){return n(m,g=>i(g))}function d(m){return n(m,g=>o(g)||i(g)?m:null)}function u(m){return t+QS(m)}function p(m){return Uh(m)?t+m:null}function _(m){return t+e.toString(m)}function h(m){if(!m)return null;let{guid:g,assetRef:S}=m;if(g&&!S)return u(g);if(!g&&S){let R=e.fromKiwi(S);if(R)return _(R)}return null}function A(m){let g=s(m);if(g)return Jb(g);let S=c(m);return S?e.isValid(S):!1}return{toString:r,toKiwi:a,toGuidObjIfLocal:s,toGuidStrIfLocal:l,toRefIfSubscribed:c,fromString:d,fromLocalNodeIdObj:u,fromLocalNodeIdStr:p,fromRef:_,fromKiwi:h,isValid:A}}function Yh(t){return Qh(t.map(([e,r])=>new Array(e).fill(r,0,e)))}function Qh(t){return t.reduce((e,r)=>e.concat(Array.isArray(r)?Qh(r):r),[])}var cN=[0,1,2,3].concat(...Yh([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function Ur(){let t=this;function e(o){let i=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length,d,u,p,_,h,A,m=0;for(_=0;_<=15;_++)o.bl_count[_]=0;for(i[o.heap[o.heap_max]*2+1]=0,d=o.heap_max+1;d<573;d++)u=o.heap[d],_=i[i[u*2+1]*2+1]+1,_>c&&(_=c,m++),i[u*2+1]=_,!(u>t.max_code)&&(o.bl_count[_]++,h=0,u>=l&&(h=s[u-l]),A=i[u*2],o.opt_len+=A*(_+h),a&&(o.static_len+=A*(a[u*2+1]+h)));if(m!==0){do{for(_=c-1;o.bl_count[_]===0;)_--;o.bl_count[_]--,o.bl_count[_+1]+=2,o.bl_count[c]--,m-=2}while(m>0);for(_=c;_!==0;_--)for(u=o.bl_count[_];u!==0;)p=o.heap[--d],!(p>t.max_code)&&(i[p*2+1]!=_&&(o.opt_len+=(_-i[p*2+1])*i[p*2],i[p*2+1]=_),u--)}}function r(o,i){let a=0;do a|=o&1,o>>>=1,a<<=1;while(--i>0);return a>>>1}function n(o,i,a){let s=[],l=0,c,d,u;for(c=1;c<=15;c++)s[c]=l=l+a[c-1]<<1;for(d=0;d<=i;d++)u=o[d*2+1],u!==0&&(o[d*2]=r(s[u]++,u))}t.build_tree=function(o){let i=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.elems,l,c,d=-1,u;for(o.heap_len=0,o.heap_max=573,l=0;l<s;l++)i[l*2]!==0?(o.heap[++o.heap_len]=d=l,o.depth[l]=0):i[l*2+1]=0;for(;o.heap_len<2;)u=o.heap[++o.heap_len]=d<2?++d:0,i[u*2]=1,o.depth[u]=0,o.opt_len--,a&&(o.static_len-=a[u*2+1]);for(t.max_code=d,l=Math.floor(o.heap_len/2);l>=1;l--)o.pqdownheap(i,l);u=s;do l=o.heap[1],o.heap[1]=o.heap[o.heap_len--],o.pqdownheap(i,1),c=o.heap[1],o.heap[--o.heap_max]=l,o.heap[--o.heap_max]=c,i[u*2]=i[l*2]+i[c*2],o.depth[u]=Math.max(o.depth[l],o.depth[c])+1,i[l*2+1]=i[c*2+1]=u,o.heap[1]=u++,o.pqdownheap(i,1);while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],e(o),n(i,t.max_code,o.bl_count)}}Ur._length_code=[0,1,2,3,4,5,6,7].concat(...Yh([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));Ur.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];Ur.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];Ur.d_code=function(t){return t<256?cN[t]:cN[256+(t>>>7)]};Ur.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];Ur.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];Ur.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];Ur.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function ao(t,e,r,n,o){let i=this;i.static_tree=t,i.extra_bits=e,i.extra_base=r,i.elems=n,i.max_length=o}var _L=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],hL=Yh([[144,8],[112,9],[24,7],[8,8]]);ao.static_ltree=Qh(_L.map((t,e)=>[t,hL[e]]));var mL=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],fL=Yh([[30,5]]);ao.static_dtree=Qh(mL.map((t,e)=>[t,fL[e]]));ao.static_l_desc=new ao(ao.static_ltree,Ur.extra_lbits,257,286,15);ao.static_d_desc=new ao(ao.static_dtree,Ur.extra_dbits,0,30,15);ao.static_bl_desc=new ao(null,Ur.extra_blbits,0,19,7);var gL=9,SL=8;function Oa(t,e,r,n,o){let i=this;i.good_length=t,i.max_lazy=e,i.nice_length=r,i.max_chain=n,i.func=o}var uN=0,Wh=1,Hl=2,ua=[new Oa(0,0,0,0,uN),new Oa(4,4,8,4,Wh),new Oa(4,5,16,8,Wh),new Oa(4,6,32,32,Wh),new Oa(4,4,16,16,Hl),new Oa(8,16,32,32,Hl),new Oa(8,16,128,128,Hl),new Oa(8,32,128,256,Hl),new Oa(32,128,258,1024,Hl),new Oa(32,258,258,4096,Hl)],Vh=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],Wi=0,kh=1,Bu=2,Hh=3,AL=32,qS=42,zh=113,Gu=666,XS=8,TL=0,ZS=1,EL=2,qr=3,Kh=258,Ii=Kh+qr+1;function dN(t,e,r,n){let o=t[e*2],i=t[r*2];return o<i||o==i&&n[e]<=n[r]}function IL(){let t=this,e,r,n,o,i,a,s,l,c,d,u,p,_,h,A,m,g,S,R,E,P,T,f,y,v,w,I,C,L,B,V,b,D,U=new Ur,H=new Ur,k=new Ur;t.depth=[];let z,q,Y,j,ae,xe;t.bl_count=[],t.heap=[],V=[],b=[],D=[];function Je(){c=2*i,u[_-1]=0;for(let ue=0;ue<_-1;ue++)u[ue]=0;w=ua[I].max_lazy,L=ua[I].good_length,B=ua[I].nice_length,v=ua[I].max_chain,P=0,g=0,f=0,S=y=qr-1,E=0,p=0}function We(){let ue;for(ue=0;ue<286;ue++)V[ue*2]=0;for(ue=0;ue<30;ue++)b[ue*2]=0;for(ue=0;ue<19;ue++)D[ue*2]=0;V[256*2]=1,t.opt_len=t.static_len=0,q=Y=0}function pt(){U.dyn_tree=V,U.stat_desc=ao.static_l_desc,H.dyn_tree=b,H.stat_desc=ao.static_d_desc,k.dyn_tree=D,k.stat_desc=ao.static_bl_desc,ae=0,xe=0,j=8,We()}t.pqdownheap=function(ue,De){let ve=t.heap,Le=ve[De],ce=De<<1;for(;ce<=t.heap_len&&(ce<t.heap_len&&dN(ue,ve[ce+1],ve[ce],t.depth)&&ce++,!dN(ue,Le,ve[ce],t.depth));)ve[De]=ve[ce],De=ce,ce<<=1;ve[De]=Le};function Mt(ue,De){let ve=-1,Le,ce=ue[0*2+1],ze=0,Ot=7,bt=4;ce===0&&(Ot=138,bt=3),ue[(De+1)*2+1]=65535;for(let xn=0;xn<=De;xn++)Le=ce,ce=ue[(xn+1)*2+1],!(++ze<Ot&&Le==ce)&&(ze<bt?D[Le*2]+=ze:Le!==0?(Le!=ve&&D[Le*2]++,D[16*2]++):ze<=10?D[17*2]++:D[18*2]++,ze=0,ve=Le,ce===0?(Ot=138,bt=3):Le==ce?(Ot=6,bt=3):(Ot=7,bt=4))}function nr(){let ue;for(Mt(V,U.max_code),Mt(b,H.max_code),k.build_tree(t),ue=18;ue>=3&&D[Ur.bl_order[ue]*2+1]===0;ue--);return t.opt_len+=3*(ue+1)+5+5+4,ue}function ir(ue){t.pending_buf[t.pending++]=ue}function le(ue){ir(ue&255),ir(ue>>>8&255)}function Ut(ue){ir(ue>>8&255),ir(ue&255&255)}function mt(ue,De){let ve,Le=De;xe>16-Le?(ve=ue,ae|=ve<<xe&65535,le(ae),ae=ve>>>16-xe,xe+=Le-16):(ae|=ue<<xe&65535,xe+=Le)}function He(ue,De){let ve=ue*2;mt(De[ve]&65535,De[ve+1]&65535)}function et(ue,De){let ve,Le=-1,ce,ze=ue[0*2+1],Ot=0,bt=7,xn=4;for(ze===0&&(bt=138,xn=3),ve=0;ve<=De;ve++)if(ce=ze,ze=ue[(ve+1)*2+1],!(++Ot<bt&&ce==ze)){if(Ot<xn)do He(ce,D);while(--Ot!==0);else ce!==0?(ce!=Le&&(He(ce,D),Ot--),He(16,D),mt(Ot-3,2)):Ot<=10?(He(17,D),mt(Ot-3,3)):(He(18,D),mt(Ot-11,7));Ot=0,Le=ce,ze===0?(bt=138,xn=3):ce==ze?(bt=6,xn=3):(bt=7,xn=4)}}function tt(ue,De,ve){let Le;for(mt(ue-257,5),mt(De-1,5),mt(ve-4,4),Le=0;Le<ve;Le++)mt(D[Ur.bl_order[Le]*2+1],3);et(V,ue-1),et(b,De-1)}function wt(){xe==16?(le(ae),ae=0,xe=0):xe>=8&&(ir(ae&255),ae>>>=8,xe-=8)}function zt(){mt(ZS<<1,3),He(256,ao.static_ltree),wt(),1+j+10-xe<9&&(mt(ZS<<1,3),He(256,ao.static_ltree),wt()),j=7}function kt(ue,De){let ve,Le,ce;if(t.dist_buf[q]=ue,t.lc_buf[q]=De&255,q++,ue===0?V[De*2]++:(Y++,ue--,V[(Ur._length_code[De]+256+1)*2]++,b[Ur.d_code(ue)*2]++),(q&8191)===0&&I>2){for(ve=q*8,Le=P-g,ce=0;ce<30;ce++)ve+=b[ce*2]*(5+Ur.extra_dbits[ce]);if(ve>>>=3,Y<Math.floor(q/2)&&ve<Math.floor(Le/2))return!0}return q==z-1}function Xr(ue,De){let ve,Le,ce=0,ze,Ot;if(q!==0)do ve=t.dist_buf[ce],Le=t.lc_buf[ce],ce++,ve===0?He(Le,ue):(ze=Ur._length_code[Le],He(ze+256+1,ue),Ot=Ur.extra_lbits[ze],Ot!==0&&(Le-=Ur.base_length[ze],mt(Le,Ot)),ve--,ze=Ur.d_code(ve),He(ze,De),Ot=Ur.extra_dbits[ze],Ot!==0&&(ve-=Ur.base_dist[ze],mt(ve,Ot)));while(ce<q);He(256,ue),j=ue[256*2+1]}function ln(){xe>8?le(ae):xe>0&&ir(ae&255),ae=0,xe=0}function En(ue,De,ve){ln(),j=8,ve&&(le(De),le(~De)),t.pending_buf.set(l.subarray(ue,ue+De),t.pending),t.pending+=De}function Xn(ue,De,ve){mt((TL<<1)+(ve?1:0),3),En(ue,De,!0)}function Ji(ue,De,ve){let Le,ce,ze=0;I>0?(U.build_tree(t),H.build_tree(t),ze=nr(),Le=t.opt_len+3+7>>>3,ce=t.static_len+3+7>>>3,ce<=Le&&(Le=ce)):Le=ce=De+5,De+4<=Le&&ue!=-1?Xn(ue,De,ve):ce==Le?(mt((ZS<<1)+(ve?1:0),3),Xr(ao.static_ltree,ao.static_dtree)):(mt((EL<<1)+(ve?1:0),3),tt(U.max_code+1,H.max_code+1,ze+1),Xr(V,b)),We(),ve&&ln()}function Or(ue){Ji(g>=0?g:-1,P-g,ue),g=P,e.flush_pending()}function lo(){let ue,De,ve,Le;do{if(Le=c-f-P,Le===0&&P===0&&f===0)Le=i;else if(Le==-1)Le--;else if(P>=i+i-Ii){l.set(l.subarray(i,i+i),0),T-=i,P-=i,g-=i,ue=_,ve=ue;do De=u[--ve]&65535,u[ve]=De>=i?De-i:0;while(--ue!==0);ue=i,ve=ue;do De=d[--ve]&65535,d[ve]=De>=i?De-i:0;while(--ue!==0);Le+=i}if(e.avail_in===0)return;ue=e.read_buf(l,P+f,Le),f+=ue,f>=qr&&(p=l[P]&255,p=(p<<m^l[P+1]&255)&A)}while(f<Ii&&e.avail_in!==0)}function Pi(ue){let De=65535,ve;for(De>n-5&&(De=n-5);;){if(f<=1){if(lo(),f===0&&ue==0)return Wi;if(f===0)break}if(P+=f,f=0,ve=g+De,(P===0||P>=ve)&&(f=P-ve,P=ve,Or(!1),e.avail_out===0)||P-g>=i-Ii&&(Or(!1),e.avail_out===0))return Wi}return Or(ue==4),e.avail_out===0?ue==4?Bu:Wi:ue==4?Hh:kh}function Zn(ue){let De=v,ve=P,Le,ce,ze=y,Ot=P>i-Ii?P-(i-Ii):0,bt=B,xn=s,Go=P+Kh,_c=l[ve+ze-1],e_=l[ve+ze];y>=L&&(De>>=2),bt>f&&(bt=f);do if(Le=ue,!(l[Le+ze]!=e_||l[Le+ze-1]!=_c||l[Le]!=l[ve]||l[++Le]!=l[ve+1])){ve+=2,Le++;do;while(l[++ve]==l[++Le]&&l[++ve]==l[++Le]&&l[++ve]==l[++Le]&&l[++ve]==l[++Le]&&l[++ve]==l[++Le]&&l[++ve]==l[++Le]&&l[++ve]==l[++Le]&&l[++ve]==l[++Le]&&ve<Go);if(ce=Kh-(Go-ve),ve=Go-Kh,ce>ze){if(T=ue,ze=ce,ce>=bt)break;_c=l[ve+ze-1],e_=l[ve+ze]}}while((ue=d[ue&xn]&65535)>Ot&&--De!==0);return ze<=f?ze:f}function Fi(ue){let De=0,ve;for(;;){if(f<Ii){if(lo(),f<Ii&&ue==0)return Wi;if(f===0)break}if(f>=qr&&(p=(p<<m^l[P+(qr-1)]&255)&A,De=u[p]&65535,d[P&s]=u[p],u[p]=P),De!==0&&(P-De&65535)<=i-Ii&&C!=2&&(S=Zn(De)),S>=qr)if(ve=kt(P-T,S-qr),f-=S,S<=w&&f>=qr){S--;do P++,p=(p<<m^l[P+(qr-1)]&255)&A,De=u[p]&65535,d[P&s]=u[p],u[p]=P;while(--S!==0);P++}else P+=S,S=0,p=l[P]&255,p=(p<<m^l[P+1]&255)&A;else ve=kt(0,l[P]&255),f--,P++;if(ve&&(Or(!1),e.avail_out===0))return Wi}return Or(ue==4),e.avail_out===0?ue==4?Bu:Wi:ue==4?Hh:kh}function Di(ue){let De=0,ve,Le;for(;;){if(f<Ii){if(lo(),f<Ii&&ue==0)return Wi;if(f===0)break}if(f>=qr&&(p=(p<<m^l[P+(qr-1)]&255)&A,De=u[p]&65535,d[P&s]=u[p],u[p]=P),y=S,R=T,S=qr-1,De!==0&&y<w&&(P-De&65535)<=i-Ii&&(C!=2&&(S=Zn(De)),S<=5&&(C==1||S==qr&&P-T>4096)&&(S=qr-1)),y>=qr&&S<=y){Le=P+f-qr,ve=kt(P-1-R,y-qr),f-=y-1,y-=2;do++P<=Le&&(p=(p<<m^l[P+(qr-1)]&255)&A,De=u[p]&65535,d[P&s]=u[p],u[p]=P);while(--y!==0);if(E=0,S=qr-1,P++,ve&&(Or(!1),e.avail_out===0))return Wi}else if(E!==0){if(ve=kt(0,l[P-1]&255),ve&&Or(!1),P++,f--,e.avail_out===0)return Wi}else E=1,P++,f--}return E!==0&&(ve=kt(0,l[P-1]&255),E=0),Or(ue==4),e.avail_out===0?ue==4?Bu:Wi:ue==4?Hh:kh}function di(ue){return ue.total_in=ue.total_out=0,ue.msg=null,t.pending=0,t.pending_out=0,r=zh,o=0,pt(),Je(),0}t.deflateInit=function(ue,De,ve,Le,ce,ze){return Le||(Le=XS),ce||(ce=SL),ze||(ze=0),ue.msg=null,De==-1&&(De=6),ce<1||ce>gL||Le!=XS||ve<9||ve>15||De<0||De>9||ze<0||ze>2?-2:(ue.dstate=t,a=ve,i=1<<a,s=i-1,h=ce+7,_=1<<h,A=_-1,m=Math.floor((h+qr-1)/qr),l=new Uint8Array(i*2),d=[],u=[],z=1<<ce+6,t.pending_buf=new Uint8Array(z*4),n=z*4,t.dist_buf=new Uint16Array(z),t.lc_buf=new Uint8Array(z),I=De,C=ze,di(ue))},t.deflateEnd=function(){return r!=qS&&r!=zh&&r!=Gu?-2:(t.lc_buf=null,t.dist_buf=null,t.pending_buf=null,u=null,d=null,l=null,t.dstate=null,r==zh?-3:0)},t.deflateParams=function(ue,De,ve){let Le=0;return De==-1&&(De=6),De<0||De>9||ve<0||ve>2?-2:(ua[I].func!=ua[De].func&&ue.total_in!==0&&(Le=ue.deflate(1)),I!=De&&(I=De,w=ua[I].max_lazy,L=ua[I].good_length,B=ua[I].nice_length,v=ua[I].max_chain),C=ve,Le)},t.deflateSetDictionary=function(ue,De,ve){let Le=ve,ce,ze=0;if(!De||r!=qS)return-2;if(Le<qr)return 0;for(Le>i-Ii&&(Le=i-Ii,ze=ve-Le),l.set(De.subarray(ze,ze+Le),0),P=Le,g=Le,p=l[0]&255,p=(p<<m^l[1]&255)&A,ce=0;ce<=Le-qr;ce++)p=(p<<m^l[ce+(qr-1)]&255)&A,d[ce&s]=u[p],u[p]=ce;return 0},t.deflate=function(ue,De){let ve,Le,ce,ze,Ot;if(De>4||De<0)return-2;if(!ue.next_out||!ue.next_in&&ue.avail_in!==0||r==Gu&&De!=4)return ue.msg=Vh[4],-2;if(ue.avail_out===0)return ue.msg=Vh[7],-5;if(e=ue,ze=o,o=De,r==qS&&(Le=XS+(a-8<<4)<<8,ce=(I-1&255)>>1,ce>3&&(ce=3),Le|=ce<<6,P!==0&&(Le|=AL),Le+=31-Le%31,r=zh,Ut(Le)),t.pending!==0){if(e.flush_pending(),e.avail_out===0)return o=-1,0}else if(e.avail_in===0&&De<=ze&&De!=4)return e.msg=Vh[7],-5;if(r==Gu&&e.avail_in!==0)return ue.msg=Vh[7],-5;if(e.avail_in!==0||f!==0||De!=0&&r!=Gu){switch(Ot=-1,ua[I].func){case uN:Ot=Pi(De);break;case Wh:Ot=Fi(De);break;case Hl:Ot=Di(De);break;default:}if((Ot==Bu||Ot==Hh)&&(r=Gu),Ot==Wi||Ot==Bu)return e.avail_out===0&&(o=-1),0;if(Ot==kh){if(De==1)zt();else if(Xn(0,0,!1),De==3)for(ve=0;ve<_;ve++)u[ve]=0;if(e.flush_pending(),e.avail_out===0)return o=-1,0}}return De!=4?0:1}}function pN(){let t=this;t.next_in_index=0,t.next_out_index=0,t.avail_in=0,t.total_in=0,t.avail_out=0,t.total_out=0}pN.prototype={deflateInit:function(t,e){let r=this;return r.dstate=new IL,e||(e=15),r.dstate.deflateInit(r,t,e)},deflate:function(t){let e=this;return e.dstate?e.dstate.deflate(e,t):-2},deflateEnd:function(){let t=this;if(!t.dstate)return-2;let e=t.dstate.deflateEnd();return t.dstate=null,e},deflateParams:function(t,e){let r=this;return r.dstate?r.dstate.deflateParams(r,t,e):-2},deflateSetDictionary:function(t,e){let r=this;return r.dstate?r.dstate.deflateSetDictionary(r,t,e):-2},read_buf:function(t,e,r){let n=this,o=n.avail_in;return o>r&&(o=r),o===0?0:(n.avail_in-=o,t.set(n.next_in.subarray(n.next_in_index,n.next_in_index+o),e),n.next_in_index+=o,n.total_in+=o,o)},flush_pending:function(){let t=this,e=t.dstate.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.next_out.set(t.dstate.pending_buf.subarray(t.dstate.pending_out,t.dstate.pending_out+e),t.next_out_index),t.next_out_index+=e,t.dstate.pending_out+=e,t.total_out+=e,t.avail_out-=e,t.dstate.pending-=e,t.dstate.pending===0&&(t.dstate.pending_out=0))}};function RL(t){let e=this,r=new pN,n=yL(t&&t.chunkSize?t.chunkSize:64*1024),o=0,i=new Uint8Array(n),a=t?t.level:-1;typeof a>"u"&&(a=-1),r.deflateInit(a),r.next_out=i,e.append=function(s,l){let c,d,u=0,p=0,_=0,h=[];if(s.length){r.next_in_index=0,r.next_in=s,r.avail_in=s.length;do{if(r.next_out_index=0,r.avail_out=n,c=r.deflate(o),c!=0)throw new Error("deflating: "+r.msg);r.next_out_index&&(r.next_out_index==n?h.push(new Uint8Array(i)):h.push(i.slice(0,r.next_out_index))),_+=r.next_out_index,l&&r.next_in_index>0&&r.next_in_index!=u&&(l(r.next_in_index),u=r.next_in_index)}while(r.avail_in>0||r.avail_out===0);return h.length>1?(d=new Uint8Array(_),h.forEach(function(A){d.set(A,p),p+=A.length})):d=h[0]||new Uint8Array(0),d}},e.flush=function(){let s,l,c=0,d=0,u=[];do{if(r.next_out_index=0,r.avail_out=n,s=r.deflate(4),s!=1&&s!=0)throw new Error("deflating: "+r.msg);n-r.avail_out>0&&u.push(i.slice(0,r.next_out_index)),d+=r.next_out_index}while(r.avail_in>0||r.avail_out===0);return r.deflateEnd(),l=new Uint8Array(d),u.forEach(function(p){l.set(p,c),c+=p.length}),l}}function yL(t){return t+5*(Math.floor(t/16383)+1)}var _N=RL;var Ri=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],wN=1440,vL=0,CL=4,OL=9,bL=5,NL=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],PL=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],FL=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],DL=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],wL=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],xL=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Us=15;function eA(){let t=this,e,r,n,o,i,a;function s(c,d,u,p,_,h,A,m,g,S,R){let E,P,T,f,y,v,w,I,C,L,B,V,b,D,U;L=0,y=u;do n[c[d+L]]++,L++,y--;while(y!==0);if(n[0]==u)return A[0]=-1,m[0]=0,0;for(I=m[0],v=1;v<=Us&&n[v]===0;v++);for(w=v,I<v&&(I=v),y=Us;y!==0&&n[y]===0;y--);for(T=y,I>y&&(I=y),m[0]=I,D=1<<v;v<y;v++,D<<=1)if((D-=n[v])<0)return-3;if((D-=n[y])<0)return-3;for(n[y]+=D,a[1]=v=0,L=1,b=2;--y!==0;)a[b]=v+=n[L],b++,L++;y=0,L=0;do(v=c[d+L])!==0&&(R[a[v]++]=y),L++;while(++y<u);for(u=a[T],a[0]=y=0,L=0,f=-1,V=-I,i[0]=0,B=0,U=0;w<=T;w++)for(E=n[w];E--!==0;){for(;w>V+I;){if(f++,V+=I,U=T-V,U=U>I?I:U,(P=1<<(v=w-V))>E+1&&(P-=E+1,b=w,v<U))for(;++v<U&&!((P<<=1)<=n[++b]);)P-=n[b];if(U=1<<v,S[0]+U>wN)return-3;i[f]=B=S[0],S[0]+=U,f!==0?(a[f]=y,o[0]=v,o[1]=I,v=y>>>V-I,o[2]=B-i[f-1]-v,g.set(o,(i[f-1]+v)*3)):A[0]=B}for(o[1]=w-V,L>=u?o[0]=192:R[L]<p?(o[0]=R[L]<256?0:96,o[2]=R[L++]):(o[0]=h[R[L]-p]+16+64,o[2]=_[R[L++]-p]),P=1<<w-V,v=y>>>V;v<U;v+=P)g.set(o,(B+v)*3);for(v=1<<w-1;(y&v)!==0;v>>>=1)y^=v;for(y^=v,C=(1<<V)-1;(y&C)!=a[f];)f--,V-=I,C=(1<<V)-1}return D!==0&&T!=1?-5:0}function l(c){let d;for(e||(e=[],r=[],n=new Int32Array(Us+1),o=[],i=new Int32Array(Us),a=new Int32Array(Us+1)),r.length<c&&(r=[]),d=0;d<c;d++)r[d]=0;for(d=0;d<Us+1;d++)n[d]=0;for(d=0;d<3;d++)o[d]=0;i.set(n.subarray(0,Us),0),a.set(n.subarray(0,Us+1),0)}t.inflate_trees_bits=function(c,d,u,p,_){let h;return l(19),e[0]=0,h=s(c,0,19,19,null,null,u,d,p,e,r),h==-3?_.msg="oversubscribed dynamic bit lengths tree":(h==-5||d[0]===0)&&(_.msg="incomplete dynamic bit lengths tree",h=-3),h},t.inflate_trees_dynamic=function(c,d,u,p,_,h,A,m,g){let S;return l(288),e[0]=0,S=s(u,0,c,257,FL,DL,h,p,m,e,r),S!=0||p[0]===0?(S==-3?g.msg="oversubscribed literal/length tree":S!=-4&&(g.msg="incomplete literal/length tree",S=-3),S):(l(288),S=s(u,c,d,0,wL,xL,A,_,m,e,r),S!=0||_[0]===0&&c>257?(S==-3?g.msg="oversubscribed distance tree":S==-5?(g.msg="incomplete distance tree",S=-3):S!=-4&&(g.msg="empty distance tree with lengths",S=-3),S):0)}}eA.inflate_trees_fixed=function(t,e,r,n){return t[0]=OL,e[0]=bL,r[0]=NL,n[0]=PL,0};var qh=0,hN=1,mN=2,fN=3,gN=4,SN=5,AN=6,JS=7,TN=8,Xh=9;function LL(){let t=this,e,r=0,n,o=0,i=0,a=0,s=0,l=0,c=0,d=0,u,p=0,_,h=0;function A(m,g,S,R,E,P,T,f){let y,v,w,I,C,L,B,V,b,D,U,H,k,z,q,Y;B=f.next_in_index,V=f.avail_in,C=T.bitb,L=T.bitk,b=T.write,D=b<T.read?T.read-b-1:T.end-b,U=Ri[m],H=Ri[g];do{for(;L<20;)V--,C|=(f.read_byte(B++)&255)<<L,L+=8;if(y=C&U,v=S,w=R,Y=(w+y)*3,(I=v[Y])===0){C>>=v[Y+1],L-=v[Y+1],T.win[b++]=v[Y+2],D--;continue}do{if(C>>=v[Y+1],L-=v[Y+1],(I&16)!==0){for(I&=15,k=v[Y+2]+(C&Ri[I]),C>>=I,L-=I;L<15;)V--,C|=(f.read_byte(B++)&255)<<L,L+=8;y=C&H,v=E,w=P,Y=(w+y)*3,I=v[Y];do if(C>>=v[Y+1],L-=v[Y+1],(I&16)!==0){for(I&=15;L<I;)V--,C|=(f.read_byte(B++)&255)<<L,L+=8;if(z=v[Y+2]+(C&Ri[I]),C>>=I,L-=I,D-=k,b>=z)q=b-z,b-q>0&&2>b-q?(T.win[b++]=T.win[q++],T.win[b++]=T.win[q++],k-=2):(T.win.set(T.win.subarray(q,q+2),b),b+=2,q+=2,k-=2);else{q=b-z;do q+=T.end;while(q<0);if(I=T.end-q,k>I){if(k-=I,b-q>0&&I>b-q)do T.win[b++]=T.win[q++];while(--I!==0);else T.win.set(T.win.subarray(q,q+I),b),b+=I,q+=I,I=0;q=0}}if(b-q>0&&k>b-q)do T.win[b++]=T.win[q++];while(--k!==0);else T.win.set(T.win.subarray(q,q+k),b),b+=k,q+=k,k=0;break}else if((I&64)===0)y+=v[Y+2],y+=C&Ri[I],Y=(w+y)*3,I=v[Y];else return f.msg="invalid distance code",k=f.avail_in-V,k=L>>3<k?L>>3:k,V+=k,B-=k,L-=k<<3,T.bitb=C,T.bitk=L,f.avail_in=V,f.total_in+=B-f.next_in_index,f.next_in_index=B,T.write=b,-3;while(!0);break}if((I&64)===0){if(y+=v[Y+2],y+=C&Ri[I],Y=(w+y)*3,(I=v[Y])===0){C>>=v[Y+1],L-=v[Y+1],T.win[b++]=v[Y+2],D--;break}}else return(I&32)!==0?(k=f.avail_in-V,k=L>>3<k?L>>3:k,V+=k,B-=k,L-=k<<3,T.bitb=C,T.bitk=L,f.avail_in=V,f.total_in+=B-f.next_in_index,f.next_in_index=B,T.write=b,1):(f.msg="invalid literal/length code",k=f.avail_in-V,k=L>>3<k?L>>3:k,V+=k,B-=k,L-=k<<3,T.bitb=C,T.bitk=L,f.avail_in=V,f.total_in+=B-f.next_in_index,f.next_in_index=B,T.write=b,-3)}while(!0)}while(D>=258&&V>=10);return k=f.avail_in-V,k=L>>3<k?L>>3:k,V+=k,B-=k,L-=k<<3,T.bitb=C,T.bitk=L,f.avail_in=V,f.total_in+=B-f.next_in_index,f.next_in_index=B,T.write=b,0}t.init=function(m,g,S,R,E,P){e=qh,c=m,d=g,u=S,p=R,_=E,h=P,n=null},t.proc=function(m,g,S){let R,E,P,T=0,f=0,y=0,v,w,I,C;for(y=g.next_in_index,v=g.avail_in,T=m.bitb,f=m.bitk,w=m.write,I=w<m.read?m.read-w-1:m.end-w;;)switch(e){case qh:if(I>=258&&v>=10&&(m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,S=A(c,d,u,p,_,h,m,g),y=g.next_in_index,v=g.avail_in,T=m.bitb,f=m.bitk,w=m.write,I=w<m.read?m.read-w-1:m.end-w,S!=0)){e=S==1?JS:Xh;break}i=c,n=u,o=p,e=hN;case hN:for(R=i;f<R;){if(v!==0)S=0;else return m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);v--,T|=(g.read_byte(y++)&255)<<f,f+=8}if(E=(o+(T&Ri[R]))*3,T>>>=n[E+1],f-=n[E+1],P=n[E],P===0){a=n[E+2],e=AN;break}if((P&16)!==0){s=P&15,r=n[E+2],e=mN;break}if((P&64)===0){i=P,o=E/3+n[E+2];break}if((P&32)!==0){e=JS;break}return e=Xh,g.msg="invalid literal/length code",S=-3,m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);case mN:for(R=s;f<R;){if(v!==0)S=0;else return m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);v--,T|=(g.read_byte(y++)&255)<<f,f+=8}r+=T&Ri[R],T>>=R,f-=R,i=d,n=_,o=h,e=fN;case fN:for(R=i;f<R;){if(v!==0)S=0;else return m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);v--,T|=(g.read_byte(y++)&255)<<f,f+=8}if(E=(o+(T&Ri[R]))*3,T>>=n[E+1],f-=n[E+1],P=n[E],(P&16)!==0){s=P&15,l=n[E+2],e=gN;break}if((P&64)===0){i=P,o=E/3+n[E+2];break}return e=Xh,g.msg="invalid distance code",S=-3,m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);case gN:for(R=s;f<R;){if(v!==0)S=0;else return m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);v--,T|=(g.read_byte(y++)&255)<<f,f+=8}l+=T&Ri[R],T>>=R,f-=R,e=SN;case SN:for(C=w-l;C<0;)C+=m.end;for(;r!==0;){if(I===0&&(w==m.end&&m.read!==0&&(w=0,I=w<m.read?m.read-w-1:m.end-w),I===0&&(m.write=w,S=m.inflate_flush(g,S),w=m.write,I=w<m.read?m.read-w-1:m.end-w,w==m.end&&m.read!==0&&(w=0,I=w<m.read?m.read-w-1:m.end-w),I===0)))return m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);m.win[w++]=m.win[C++],I--,C==m.end&&(C=0),r--}e=qh;break;case AN:if(I===0&&(w==m.end&&m.read!==0&&(w=0,I=w<m.read?m.read-w-1:m.end-w),I===0&&(m.write=w,S=m.inflate_flush(g,S),w=m.write,I=w<m.read?m.read-w-1:m.end-w,w==m.end&&m.read!==0&&(w=0,I=w<m.read?m.read-w-1:m.end-w),I===0)))return m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);S=0,m.win[w++]=a,I--,e=qh;break;case JS:if(f>7&&(f-=8,v++,y--),m.write=w,S=m.inflate_flush(g,S),w=m.write,I=w<m.read?m.read-w-1:m.end-w,m.read!=m.write)return m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);e=TN;case TN:return S=1,m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);case Xh:return S=-3,m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S);default:return S=-2,m.bitb=T,m.bitk=f,g.avail_in=v,g.total_in+=y-g.next_in_index,g.next_in_index=y,m.write=w,m.inflate_flush(g,S)}},t.free=function(){}}var EN=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],zc=0,jS=1,IN=2,RN=3,yN=4,vN=5,Zh=6,Jh=7,CN=8,zl=9;function ML(t,e){let r=this,n=zc,o=0,i=0,a=0,s,l=[0],c=[0],d=new LL,u=0,p=new Int32Array(wN*3),_=0,h=new eA;r.bitk=0,r.bitb=0,r.win=new Uint8Array(e),r.end=e,r.read=0,r.write=0,r.reset=function(A,m){m&&(m[0]=_),n==Zh&&d.free(A),n=zc,r.bitk=0,r.bitb=0,r.read=r.write=0},r.reset(t,null),r.inflate_flush=function(A,m){let g,S,R;return S=A.next_out_index,R=r.read,g=(R<=r.write?r.write:r.end)-R,g>A.avail_out&&(g=A.avail_out),g!==0&&m==-5&&(m=0),A.avail_out-=g,A.total_out+=g,A.next_out.set(r.win.subarray(R,R+g),S),S+=g,R+=g,R==r.end&&(R=0,r.write==r.end&&(r.write=0),g=r.write-R,g>A.avail_out&&(g=A.avail_out),g!==0&&m==-5&&(m=0),A.avail_out-=g,A.total_out+=g,A.next_out.set(r.win.subarray(R,R+g),S),S+=g,R+=g),A.next_out_index=S,r.read=R,m},r.proc=function(A,m){let g,S,R,E,P,T,f,y;for(E=A.next_in_index,P=A.avail_in,S=r.bitb,R=r.bitk,T=r.write,f=T<r.read?r.read-T-1:r.end-T;;){let v,w,I,C,L,B,V,b;switch(n){case zc:for(;R<3;){if(P!==0)m=0;else return r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);P--,S|=(A.read_byte(E++)&255)<<R,R+=8}switch(g=S&7,u=g&1,g>>>1){case 0:S>>>=3,R-=3,g=R&7,S>>>=g,R-=g,n=jS;break;case 1:v=[],w=[],I=[[]],C=[[]],eA.inflate_trees_fixed(v,w,I,C),d.init(v[0],w[0],I[0],0,C[0],0),S>>>=3,R-=3,n=Zh;break;case 2:S>>>=3,R-=3,n=RN;break;case 3:return S>>>=3,R-=3,n=zl,A.msg="invalid block type",m=-3,r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m)}break;case jS:for(;R<32;){if(P!==0)m=0;else return r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);P--,S|=(A.read_byte(E++)&255)<<R,R+=8}if((~S>>>16&65535)!=(S&65535))return n=zl,A.msg="invalid stored block lengths",m=-3,r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);o=S&65535,S=R=0,n=o!==0?IN:u!==0?Jh:zc;break;case IN:if(P===0||f===0&&(T==r.end&&r.read!==0&&(T=0,f=T<r.read?r.read-T-1:r.end-T),f===0&&(r.write=T,m=r.inflate_flush(A,m),T=r.write,f=T<r.read?r.read-T-1:r.end-T,T==r.end&&r.read!==0&&(T=0,f=T<r.read?r.read-T-1:r.end-T),f===0)))return r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);if(m=0,g=o,g>P&&(g=P),g>f&&(g=f),r.win.set(A.read_buf(E,g),T),E+=g,P-=g,T+=g,f-=g,(o-=g)!==0)break;n=u!==0?Jh:zc;break;case RN:for(;R<14;){if(P!==0)m=0;else return r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);P--,S|=(A.read_byte(E++)&255)<<R,R+=8}if(i=g=S&16383,(g&31)>29||(g>>5&31)>29)return n=zl,A.msg="too many length or distance symbols",m=-3,r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);if(g=258+(g&31)+(g>>5&31),!s||s.length<g)s=[];else for(y=0;y<g;y++)s[y]=0;S>>>=14,R-=14,a=0,n=yN;case yN:for(;a<4+(i>>>10);){for(;R<3;){if(P!==0)m=0;else return r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);P--,S|=(A.read_byte(E++)&255)<<R,R+=8}s[EN[a++]]=S&7,S>>>=3,R-=3}for(;a<19;)s[EN[a++]]=0;if(l[0]=7,g=h.inflate_trees_bits(s,l,c,p,A),g!=0)return m=g,m==-3&&(s=null,n=zl),r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);a=0,n=vN;case vN:for(;g=i,!(a>=258+(g&31)+(g>>5&31));){let D,U;for(g=l[0];R<g;){if(P!==0)m=0;else return r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);P--,S|=(A.read_byte(E++)&255)<<R,R+=8}if(g=p[(c[0]+(S&Ri[g]))*3+1],U=p[(c[0]+(S&Ri[g]))*3+2],U<16)S>>>=g,R-=g,s[a++]=U;else{for(y=U==18?7:U-14,D=U==18?11:3;R<g+y;){if(P!==0)m=0;else return r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);P--,S|=(A.read_byte(E++)&255)<<R,R+=8}if(S>>>=g,R-=g,D+=S&Ri[y],S>>>=y,R-=y,y=a,g=i,y+D>258+(g&31)+(g>>5&31)||U==16&&y<1)return s=null,n=zl,A.msg="invalid bit length repeat",m=-3,r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);U=U==16?s[y-1]:0;do s[y++]=U;while(--D!==0);a=y}}if(c[0]=-1,L=[],B=[],V=[],b=[],L[0]=9,B[0]=6,g=i,g=h.inflate_trees_dynamic(257+(g&31),1+(g>>5&31),s,L,B,V,b,p,A),g!=0)return g==-3&&(s=null,n=zl),m=g,r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);d.init(L[0],B[0],p,V[0],p,b[0]),n=Zh;case Zh:if(r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,(m=d.proc(r,A,m))!=1)return r.inflate_flush(A,m);if(m=0,d.free(A),E=A.next_in_index,P=A.avail_in,S=r.bitb,R=r.bitk,T=r.write,f=T<r.read?r.read-T-1:r.end-T,u===0){n=zc;break}n=Jh;case Jh:if(r.write=T,m=r.inflate_flush(A,m),T=r.write,f=T<r.read?r.read-T-1:r.end-T,r.read!=r.write)return r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);n=CN;case CN:return m=1,r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);case zl:return m=-3,r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m);default:return m=-2,r.bitb=S,r.bitk=R,A.avail_in=P,A.total_in+=E-A.next_in_index,A.next_in_index=E,r.write=T,r.inflate_flush(A,m)}}},r.free=function(A){r.reset(A,null),r.win=null,p=null},r.set_dictionary=function(A,m,g){r.win.set(A.subarray(m,m+g),0),r.read=r.write=g},r.sync_point=function(){return n==jS?1:0}}var BL=32,GL=8,UL=0,ON=1,bN=2,NN=3,PN=4,FN=5,$S=6,Uu=7,DN=12,Vs=13,VL=[0,0,255,255];function kL(){let t=this;t.mode=0,t.method=0,t.was=[0],t.need=0,t.marker=0,t.wbits=0;function e(r){return!r||!r.istate?-2:(r.total_in=r.total_out=0,r.msg=null,r.istate.mode=Uu,r.istate.blocks.reset(r,null),0)}t.inflateEnd=function(r){return t.blocks&&t.blocks.free(r),t.blocks=null,0},t.inflateInit=function(r,n){return r.msg=null,t.blocks=null,n<8||n>15?(t.inflateEnd(r),-2):(t.wbits=n,r.istate.blocks=new ML(r,1<<n),e(r),0)},t.inflate=function(r,n){let o,i;if(!r||!r.istate||!r.next_in)return-2;let a=r.istate;for(n=n==CL?-5:0,o=-5;;)switch(a.mode){case UL:if(r.avail_in===0)return o;if(o=n,r.avail_in--,r.total_in++,((a.method=r.read_byte(r.next_in_index++))&15)!=GL){a.mode=Vs,r.msg="unknown compression method",a.marker=5;break}if((a.method>>4)+8>a.wbits){a.mode=Vs,r.msg="invalid win size",a.marker=5;break}a.mode=ON;case ON:if(r.avail_in===0)return o;if(o=n,r.avail_in--,r.total_in++,i=r.read_byte(r.next_in_index++)&255,((a.method<<8)+i)%31!==0){a.mode=Vs,r.msg="incorrect header check",a.marker=5;break}if((i&BL)===0){a.mode=Uu;break}a.mode=bN;case bN:if(r.avail_in===0)return o;o=n,r.avail_in--,r.total_in++,a.need=(r.read_byte(r.next_in_index++)&255)<<24&4278190080,a.mode=NN;case NN:if(r.avail_in===0)return o;o=n,r.avail_in--,r.total_in++,a.need+=(r.read_byte(r.next_in_index++)&255)<<16&16711680,a.mode=PN;case PN:if(r.avail_in===0)return o;o=n,r.avail_in--,r.total_in++,a.need+=(r.read_byte(r.next_in_index++)&255)<<8&65280,a.mode=FN;case FN:return r.avail_in===0?o:(o=n,r.avail_in--,r.total_in++,a.need+=r.read_byte(r.next_in_index++)&255,a.mode=$S,2);case $S:return a.mode=Vs,r.msg="need dictionary",a.marker=0,-2;case Uu:if(o=a.blocks.proc(r,o),o==-3){a.mode=Vs,a.marker=0;break}if(o==0&&(o=n),o!=1)return o;o=n,a.blocks.reset(r,a.was),a.mode=DN;case DN:return r.avail_in=0,1;case Vs:return-3;default:return-2}},t.inflateSetDictionary=function(r,n,o){let i=0,a=o;if(!r||!r.istate||r.istate.mode!=$S)return-2;let s=r.istate;return a>=1<<s.wbits&&(a=(1<<s.wbits)-1,i=o-a),s.blocks.set_dictionary(n,i,a),s.mode=Uu,0},t.inflateSync=function(r){let n,o,i,a,s;if(!r||!r.istate)return-2;let l=r.istate;if(l.mode!=Vs&&(l.mode=Vs,l.marker=0),(n=r.avail_in)===0)return-5;for(o=r.next_in_index,i=l.marker;n!==0&&i<4;)r.read_byte(o)==VL[i]?i++:r.read_byte(o)!==0?i=0:i=4-i,o++,n--;return r.total_in+=o-r.next_in_index,r.next_in_index=o,r.avail_in=n,l.marker=i,i!=4?-3:(a=r.total_in,s=r.total_out,e(r),r.total_in=a,r.total_out=s,l.mode=Uu,0)},t.inflateSyncPoint=function(r){return!r||!r.istate||!r.istate.blocks?-2:r.istate.blocks.sync_point()}}function xN(){}xN.prototype={inflateInit:function(t){let e=this;return e.istate=new kL,t||(t=15),e.istate.inflateInit(e,t)},inflate:function(t){let e=this;return e.istate?e.istate.inflate(e,t):-2},inflateEnd:function(){let t=this;if(!t.istate)return-2;let e=t.istate.inflateEnd(t);return t.istate=null,e},inflateSync:function(){let t=this;return t.istate?t.istate.inflateSync(t):-2},inflateSetDictionary:function(t,e){let r=this;return r.istate?r.istate.inflateSetDictionary(r,t,e):-2},read_byte:function(t){return this.next_in[t]},read_buf:function(t,e){return this.next_in.subarray(t,t+e)}};function HL(t){let e=this,r=new xN,n=t&&t.chunkSize?Math.floor(t.chunkSize*2):128*1024,o=vL,i=new Uint8Array(n),a=!1;r.inflateInit(),r.next_out=i,e.append=function(s,l){let c=[],d,u,p=0,_=0,h=0;if(s.length!==0){r.next_in_index=0,r.next_in=s,r.avail_in=s.length;do{if(r.next_out_index=0,r.avail_out=n,r.avail_in===0&&!a&&(r.next_in_index=0,a=!0),d=r.inflate(o),a&&d===-5){if(r.avail_in!==0)throw new Error("inflating: bad input")}else if(d!==0&&d!==1)throw new Error("inflating: "+r.msg);if((a||d===1)&&r.avail_in===s.length)throw new Error("inflating: bad input");r.next_out_index&&(r.next_out_index===n?c.push(new Uint8Array(i)):c.push(i.slice(0,r.next_out_index))),h+=r.next_out_index,l&&r.next_in_index>0&&r.next_in_index!=p&&(l(r.next_in_index),p=r.next_in_index)}while(r.avail_in>0||r.avail_out===0);return c.length>1?(u=new Uint8Array(h),c.forEach(function(A){u.set(A,_),_+=A.length})):u=c[0]||new Uint8Array(0),u}},e.flush=function(){r.inflateEnd()}}var LN=HL;var zL={chunkSize:524288,maxWorkers:typeof navigator<"u"&&navigator.hardwareConcurrency||2,terminateWorkerTimeout:5e3,useWebWorkers:!0,workerScripts:void 0},ri=Object.assign({},zL);function tA(){return ri}function Wc(t){if(t.baseURL!==void 0&&(ri.baseURL=t.baseURL),t.chunkSize!==void 0&&(ri.chunkSize=t.chunkSize),t.maxWorkers!==void 0&&(ri.maxWorkers=t.maxWorkers),t.terminateWorkerTimeout!==void 0&&(ri.terminateWorkerTimeout=t.terminateWorkerTimeout),t.useWebWorkers!==void 0&&(ri.useWebWorkers=t.useWebWorkers),t.Deflate!==void 0&&(ri.Deflate=t.Deflate),t.Inflate!==void 0&&(ri.Inflate=t.Inflate),t.workerScripts!==void 0){if(t.workerScripts.deflate){if(!Array.isArray(t.workerScripts.deflate))throw new Error("workerScripts.deflate must be an array");ri.workerScripts||(ri.workerScripts={}),ri.workerScripts.deflate=t.workerScripts.deflate}if(t.workerScripts.inflate){if(!Array.isArray(t.workerScripts.inflate))throw new Error("workerScripts.inflate must be an array");ri.workerScripts||(ri.workerScripts={}),ri.workerScripts.inflate=t.workerScripts.inflate}}}var Vu={application:{"andrew-inset":"ez",annodex:"anx","atom+xml":"atom","atomcat+xml":"atomcat","atomserv+xml":"atomsrv",bbolin:"lin",cap:["cap","pcap"],"cu-seeme":"cu","davmount+xml":"davmount",dsptype:"tsp",ecmascript:["es","ecma"],futuresplash:"spl",hta:"hta","java-archive":"jar","java-serialized-object":"ser","java-vm":"class",javascript:"js",m3g:"m3g","mac-binhex40":"hqx",mathematica:["nb","ma","mb"],msaccess:"mdb",msword:["doc","dot"],mxf:"mxf",oda:"oda",ogg:"ogx",pdf:"pdf","pgp-keys":"key","pgp-signature":["asc","sig"],"pics-rules":"prf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],rar:"rar","rdf+xml":"rdf","rss+xml":"rss",rtf:"rtf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd"],"xspf+xml":"xspf",zip:"zip","vnd.android.package-archive":"apk","vnd.cinderella":"cdy","vnd.google-earth.kml+xml":"kml","vnd.google-earth.kmz":"kmz","vnd.mozilla.xul+xml":"xul","vnd.ms-excel":["xls","xlb","xlt","xlm","xla","xlc","xlw"],"vnd.ms-pki.seccat":"cat","vnd.ms-pki.stl":"stl","vnd.ms-powerpoint":["ppt","pps","pot"],"vnd.oasis.opendocument.chart":"odc","vnd.oasis.opendocument.database":"odb","vnd.oasis.opendocument.formula":"odf","vnd.oasis.opendocument.graphics":"odg","vnd.oasis.opendocument.graphics-template":"otg","vnd.oasis.opendocument.image":"odi","vnd.oasis.opendocument.presentation":"odp","vnd.oasis.opendocument.presentation-template":"otp","vnd.oasis.opendocument.spreadsheet":"ods","vnd.oasis.opendocument.spreadsheet-template":"ots","vnd.oasis.opendocument.text":"odt","vnd.oasis.opendocument.text-master":"odm","vnd.oasis.opendocument.text-template":"ott","vnd.oasis.opendocument.text-web":"oth","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","vnd.openxmlformats-officedocument.presentationml.template":"potx","vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","vnd.smaf":"mmf","vnd.stardivision.calc":"sdc","vnd.stardivision.chart":"sds","vnd.stardivision.draw":"sda","vnd.stardivision.impress":"sdd","vnd.stardivision.math":["sdf","smf"],"vnd.stardivision.writer":["sdw","vor"],"vnd.stardivision.writer-global":"sgl","vnd.sun.xml.calc":"sxc","vnd.sun.xml.calc.template":"stc","vnd.sun.xml.draw":"sxd","vnd.sun.xml.draw.template":"std","vnd.sun.xml.impress":"sxi","vnd.sun.xml.impress.template":"sti","vnd.sun.xml.math":"sxm","vnd.sun.xml.writer":"sxw","vnd.sun.xml.writer.global":"sxg","vnd.sun.xml.writer.template":"stw","vnd.symbian.install":["sis","sisx"],"vnd.visio":["vsd","vst","vss","vsw"],"vnd.wap.wbxml":"wbxml","vnd.wap.wmlc":"wmlc","vnd.wap.wmlscriptc":"wmlsc","vnd.wordperfect":"wpd","vnd.wordperfect5.1":"wp5","x-123":"wk","x-7z-compressed":"7z","x-abiword":"abw","x-apple-diskimage":"dmg","x-bcpio":"bcpio","x-bittorrent":"torrent","x-cbr":["cbr","cba","cbt","cb7"],"x-cbz":"cbz","x-cdf":["cdf","cda"],"x-cdlink":"vcd","x-chess-pgn":"pgn","x-cpio":"cpio","x-csh":"csh","x-debian-package":["deb","udeb"],"x-director":["dcr","dir","dxr","cst","cct","cxt","w3d","fgd","swa"],"x-dms":"dms","x-doom":"wad","x-dvi":"dvi","x-httpd-eruby":"rhtml","x-font":"pcf.Z","x-freemind":"mm","x-gnumeric":"gnumeric","x-go-sgf":"sgf","x-graphing-calculator":"gcf","x-gtar":["gtar","taz"],"x-hdf":"hdf","x-httpd-php":["phtml","pht","php"],"x-httpd-php-source":"phps","x-httpd-php3":"php3","x-httpd-php3-preprocessed":"php3p","x-httpd-php4":"php4","x-httpd-php5":"php5","x-ica":"ica","x-info":"info","x-internet-signup":["ins","isp"],"x-iphone":"iii","x-iso9660-image":"iso","x-java-jnlp-file":"jnlp","x-jmol":"jmz","x-killustrator":"kil","x-koan":["skp","skd","skt","skm"],"x-kpresenter":["kpr","kpt"],"x-kword":["kwd","kwt"],"x-latex":"latex","x-lha":"lha","x-lyx":"lyx","x-lzh":"lzh","x-lzx":"lzx","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-ms-wmd":"wmd","x-ms-wmz":"wmz","x-msdos-program":["com","exe","bat","dll"],"x-msi":"msi","x-netcdf":["nc","cdf"],"x-ns-proxy-autoconfig":["pac","dat"],"x-nwc":"nwc","x-object":"o","x-oz-application":"oza","x-pkcs7-certreqresp":"p7r","x-python-code":["pyc","pyo"],"x-qgis":["qgs","shp","shx"],"x-quicktimeplayer":"qtl","x-redhat-package-manager":"rpm","x-ruby":"rb","x-sh":"sh","x-shar":"shar","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","x-stuffit":"sit","x-sv4cpio":"sv4cpio","x-sv4crc":"sv4crc","x-tar":"tar","x-tcl":"tcl","x-tex-gf":"gf","x-tex-pk":"pk","x-texinfo":["texinfo","texi"],"x-trash":["~","%","bak","old","sik"],"x-troff":["t","tr","roff"],"x-troff-man":"man","x-troff-me":"me","x-troff-ms":"ms","x-ustar":"ustar","x-wais-source":"src","x-wingz":"wz","x-x509-ca-cert":["crt","der","cer"],"x-xcf":"xcf","x-xfig":"fig","x-xpinstall":"xpi",applixware:"aw","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-capability":"cdmia","cdmi-container":"cdmic","cdmi-domain":"cdmid","cdmi-object":"cdmio","cdmi-queue":"cdmiq","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","emma+xml":"emma","epub+zip":"epub",exi:"exi","font-tdpfr":"pfr","gml+xml":"gml","gpx+xml":"gpx",gxf:"gxf",hyperstudio:"stk","inkml+xml":["ink","inkml"],ipfix:"ipfix",json:"json","jsonml+json":"jsonml","lost+xml":"lostxml","mads+xml":"mads",marc:"mrc","marcxml+xml":"mrcx","mathml+xml":"mathml",mbox:"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods",mp21:["m21","mp21"],mp4:"mp4s","oebps-package+xml":"opf","omdoc+xml":"omdoc",onenote:["onetoc","onetoc2","onetmp","onepkg"],oxps:"oxps","patch-ops-error+xml":"xer","pgp-encrypted":"pgp",pkcs10:"p10","pkcs7-mime":["p7m","p7c"],"pkcs7-signature":"p7s",pkcs8:"p8","pkix-attr-cert":"ac","pkix-crl":"crl","pkix-pkipath":"pkipath",pkixcmp:"pki","pls+xml":"pls","prs.cww":"cww","pskc+xml":"pskcxml","reginfo+xml":"rif","relax-ng-compact-syntax":"rnc","resource-lists+xml":"rl","resource-lists-diff+xml":"rld","rls-services+xml":"rs","rpki-ghostbusters":"gbr","rpki-manifest":"mft","rpki-roa":"roa","rsd+xml":"rsd","sbml+xml":"sbml","scvp-cv-request":"scq","scvp-cv-response":"scs","scvp-vp-request":"spq","scvp-vp-response":"spp",sdp:"sdp","set-payment-initiation":"setpay","set-registration-initiation":"setreg","shf+xml":"shf","sparql-query":"rq","sparql-results+xml":"srx",srgs:"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","timestamped-data":"tsd","vnd.3gpp.pic-bw-large":"plb","vnd.3gpp.pic-bw-small":"psb","vnd.3gpp.pic-bw-var":"pvb","vnd.3gpp2.tcap":"tcap","vnd.3m.post-it-notes":"pwn","vnd.accpac.simply.aso":"aso","vnd.accpac.simply.imp":"imp","vnd.acucobol":"acu","vnd.acucorp":["atc","acutc"],"vnd.adobe.air-application-installer-package+zip":"air","vnd.adobe.formscentral.fcdt":"fcdt","vnd.adobe.fxp":["fxp","fxpl"],"vnd.adobe.xdp+xml":"xdp","vnd.adobe.xfdf":"xfdf","vnd.ahead.space":"ahead","vnd.airzip.filesecure.azf":"azf","vnd.airzip.filesecure.azs":"azs","vnd.amazon.ebook":"azw","vnd.americandynamics.acc":"acc","vnd.amiga.ami":"ami","vnd.anser-web-certificate-issue-initiation":"cii","vnd.anser-web-funds-transfer-initiation":"fti","vnd.antix.game-component":"atx","vnd.apple.installer+xml":"mpkg","vnd.apple.mpegurl":"m3u8","vnd.aristanetworks.swi":"swi","vnd.astraea-software.iota":"iota","vnd.audiograph":"aep","vnd.blueice.multipass":"mpm","vnd.bmi":"bmi","vnd.businessobjects":"rep","vnd.chemdraw+xml":"cdxml","vnd.chipnuts.karaoke-mmd":"mmd","vnd.claymore":"cla","vnd.cloanto.rp9":"rp9","vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"vnd.cluetrust.cartomobile-config":"c11amc","vnd.cluetrust.cartomobile-config-pkg":"c11amz","vnd.commonspace":"csp","vnd.contact.cmsg":"cdbcmsg","vnd.cosmocaller":"cmc","vnd.crick.clicker":"clkx","vnd.crick.clicker.keyboard":"clkk","vnd.crick.clicker.palette":"clkp","vnd.crick.clicker.template":"clkt","vnd.crick.clicker.wordbank":"clkw","vnd.criticaltools.wbs+xml":"wbs","vnd.ctc-posml":"pml","vnd.cups-ppd":"ppd","vnd.curl.car":"car","vnd.curl.pcurl":"pcurl","vnd.dart":"dart","vnd.data-vision.rdz":"rdz","vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"vnd.dece.ttml+xml":["uvt","uvvt"],"vnd.dece.unspecified":["uvx","uvvx"],"vnd.dece.zip":["uvz","uvvz"],"vnd.denovo.fcselayout-link":"fe_launch","vnd.dna":"dna","vnd.dolby.mlp":"mlp","vnd.dpgraph":"dpg","vnd.dreamfactory":"dfac","vnd.ds-keypoint":"kpxx","vnd.dvb.ait":"ait","vnd.dvb.service":"svc","vnd.dynageo":"geo","vnd.ecowin.chart":"mag","vnd.enliven":"nml","vnd.epson.esf":"esf","vnd.epson.msf":"msf","vnd.epson.quickanime":"qam","vnd.epson.salt":"slt","vnd.epson.ssf":"ssf","vnd.eszigno3+xml":["es3","et3"],"vnd.ezpix-album":"ez2","vnd.ezpix-package":"ez3","vnd.fdf":"fdf","vnd.fdsn.mseed":"mseed","vnd.fdsn.seed":["seed","dataless"],"vnd.flographit":"gph","vnd.fluxtime.clip":"ftc","vnd.framemaker":["fm","frame","maker","book"],"vnd.frogans.fnc":"fnc","vnd.frogans.ltf":"ltf","vnd.fsc.weblaunch":"fsc","vnd.fujitsu.oasys":"oas","vnd.fujitsu.oasys2":"oa2","vnd.fujitsu.oasys3":"oa3","vnd.fujitsu.oasysgp":"fg5","vnd.fujitsu.oasysprs":"bh2","vnd.fujixerox.ddd":"ddd","vnd.fujixerox.docuworks":"xdw","vnd.fujixerox.docuworks.binder":"xbd","vnd.fuzzysheet":"fzs","vnd.genomatix.tuxedo":"txd","vnd.geogebra.file":"ggb","vnd.geogebra.tool":"ggt","vnd.geometry-explorer":["gex","gre"],"vnd.geonext":"gxt","vnd.geoplan":"g2w","vnd.geospace":"g3w","vnd.gmx":"gmx","vnd.grafeq":["gqf","gqs"],"vnd.groove-account":"gac","vnd.groove-help":"ghf","vnd.groove-identity-message":"gim","vnd.groove-injector":"grv","vnd.groove-tool-message":"gtm","vnd.groove-tool-template":"tpl","vnd.groove-vcard":"vcg","vnd.hal+xml":"hal","vnd.handheld-entertainment+xml":"zmm","vnd.hbci":"hbci","vnd.hhe.lesson-player":"les","vnd.hp-hpgl":"hpgl","vnd.hp-hpid":"hpid","vnd.hp-hps":"hps","vnd.hp-jlyt":"jlt","vnd.hp-pcl":"pcl","vnd.hp-pclxl":"pclxl","vnd.hydrostatix.sof-data":"sfd-hdstx","vnd.ibm.minipay":"mpy","vnd.ibm.modcap":["afp","listafp","list3820"],"vnd.ibm.rights-management":"irm","vnd.ibm.secure-container":"sc","vnd.iccprofile":["icc","icm"],"vnd.igloader":"igl","vnd.immervision-ivp":"ivp","vnd.immervision-ivu":"ivu","vnd.insors.igm":"igm","vnd.intercon.formnet":["xpw","xpx"],"vnd.intergeo":"i2g","vnd.intu.qbo":"qbo","vnd.intu.qfx":"qfx","vnd.ipunplugged.rcprofile":"rcprofile","vnd.irepository.package+xml":"irp","vnd.is-xpr":"xpr","vnd.isac.fcs":"fcs","vnd.jam":"jam","vnd.jcp.javame.midlet-rms":"rms","vnd.jisp":"jisp","vnd.joost.joda-archive":"joda","vnd.kahootz":["ktz","ktr"],"vnd.kde.karbon":"karbon","vnd.kde.kchart":"chrt","vnd.kde.kformula":"kfo","vnd.kde.kivio":"flw","vnd.kde.kontour":"kon","vnd.kde.kpresenter":["kpr","kpt"],"vnd.kde.kspread":"ksp","vnd.kde.kword":["kwd","kwt"],"vnd.kenameaapp":"htke","vnd.kidspiration":"kia","vnd.kinar":["kne","knp"],"vnd.koan":["skp","skd","skt","skm"],"vnd.kodak-descriptor":"sse","vnd.las.las+xml":"lasxml","vnd.llamagraphics.life-balance.desktop":"lbd","vnd.llamagraphics.life-balance.exchange+xml":"lbe","vnd.lotus-1-2-3":"123","vnd.lotus-approach":"apr","vnd.lotus-freelance":"pre","vnd.lotus-notes":"nsf","vnd.lotus-organizer":"org","vnd.lotus-screencam":"scm","vnd.lotus-wordpro":"lwp","vnd.macports.portpkg":"portpkg","vnd.mcd":"mcd","vnd.medcalcdata":"mc1","vnd.mediastation.cdkey":"cdkey","vnd.mfer":"mwf","vnd.mfmp":"mfm","vnd.micrografx.flo":"flo","vnd.micrografx.igx":"igx","vnd.mif":"mif","vnd.mobius.daf":"daf","vnd.mobius.dis":"dis","vnd.mobius.mbk":"mbk","vnd.mobius.mqy":"mqy","vnd.mobius.msl":"msl","vnd.mobius.plc":"plc","vnd.mobius.txf":"txf","vnd.mophun.application":"mpn","vnd.mophun.certificate":"mpc","vnd.ms-artgalry":"cil","vnd.ms-cab-compressed":"cab","vnd.ms-excel.addin.macroenabled.12":"xlam","vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","vnd.ms-excel.sheet.macroenabled.12":"xlsm","vnd.ms-excel.template.macroenabled.12":"xltm","vnd.ms-fontobject":"eot","vnd.ms-htmlhelp":"chm","vnd.ms-ims":"ims","vnd.ms-lrm":"lrm","vnd.ms-officetheme":"thmx","vnd.ms-powerpoint.addin.macroenabled.12":"ppam","vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","vnd.ms-powerpoint.slide.macroenabled.12":"sldm","vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","vnd.ms-powerpoint.template.macroenabled.12":"potm","vnd.ms-project":["mpp","mpt"],"vnd.ms-word.document.macroenabled.12":"docm","vnd.ms-word.template.macroenabled.12":"dotm","vnd.ms-works":["wps","wks","wcm","wdb"],"vnd.ms-wpl":"wpl","vnd.ms-xpsdocument":"xps","vnd.mseq":"mseq","vnd.musician":"mus","vnd.muvee.style":"msty","vnd.mynfc":"taglet","vnd.neurolanguage.nlu":"nlu","vnd.nitf":["ntf","nitf"],"vnd.noblenet-directory":"nnd","vnd.noblenet-sealer":"nns","vnd.noblenet-web":"nnw","vnd.nokia.n-gage.data":"ngdat","vnd.nokia.n-gage.symbian.install":"n-gage","vnd.nokia.radio-preset":"rpst","vnd.nokia.radio-presets":"rpss","vnd.novadigm.edm":"edm","vnd.novadigm.edx":"edx","vnd.novadigm.ext":"ext","vnd.oasis.opendocument.chart-template":"otc","vnd.oasis.opendocument.formula-template":"odft","vnd.oasis.opendocument.image-template":"oti","vnd.olpc-sugar":"xo","vnd.oma.dd2+xml":"dd2","vnd.openofficeorg.extension":"oxt","vnd.openxmlformats-officedocument.presentationml.slide":"sldx","vnd.osgeo.mapguide.package":"mgp","vnd.osgi.dp":"dp","vnd.osgi.subsystem":"esa","vnd.palm":["pdb","pqa","oprc"],"vnd.pawaafile":"paw","vnd.pg.format":"str","vnd.pg.osasli":"ei6","vnd.picsel":"efif","vnd.pmi.widget":"wg","vnd.pocketlearn":"plf","vnd.powerbuilder6":"pbd","vnd.previewsystems.box":"box","vnd.proteus.magazine":"mgz","vnd.publishare-delta-tree":"qps","vnd.pvi.ptid1":"ptid","vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"vnd.realvnc.bed":"bed","vnd.recordare.musicxml":"mxl","vnd.recordare.musicxml+xml":"musicxml","vnd.rig.cryptonote":"cryptonote","vnd.rn-realmedia":"rm","vnd.rn-realmedia-vbr":"rmvb","vnd.route66.link66+xml":"link66","vnd.sailingtracker.track":"st","vnd.seemail":"see","vnd.sema":"sema","vnd.semd":"semd","vnd.semf":"semf","vnd.shana.informed.formdata":"ifm","vnd.shana.informed.formtemplate":"itp","vnd.shana.informed.interchange":"iif","vnd.shana.informed.package":"ipk","vnd.simtech-mindmapper":["twd","twds"],"vnd.smart.teacher":"teacher","vnd.solent.sdkm+xml":["sdkm","sdkd"],"vnd.spotfire.dxp":"dxp","vnd.spotfire.sfs":"sfs","vnd.stepmania.package":"smzip","vnd.stepmania.stepchart":"sm","vnd.sus-calendar":["sus","susp"],"vnd.svd":"svd","vnd.syncml+xml":"xsm","vnd.syncml.dm+wbxml":"bdm","vnd.syncml.dm+xml":"xdm","vnd.tao.intent-module-archive":"tao","vnd.tcpdump.pcap":["pcap","cap","dmp"],"vnd.tmobile-livetv":"tmo","vnd.trid.tpt":"tpt","vnd.triscape.mxs":"mxs","vnd.trueapp":"tra","vnd.ufdl":["ufd","ufdl"],"vnd.uiq.theme":"utz","vnd.umajin":"umj","vnd.unity":"unityweb","vnd.uoml+xml":"uoml","vnd.vcx":"vcx","vnd.visionary":"vis","vnd.vsf":"vsf","vnd.webturbo":"wtb","vnd.wolfram.player":"nbp","vnd.wqd":"wqd","vnd.wt.stf":"stf","vnd.xara":"xar","vnd.xfdl":"xfdl","vnd.yamaha.hv-dic":"hvd","vnd.yamaha.hv-script":"hvs","vnd.yamaha.hv-voice":"hvp","vnd.yamaha.openscoreformat":"osf","vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","vnd.yamaha.smaf-audio":"saf","vnd.yamaha.smaf-phrase":"spf","vnd.yellowriver-custom-menu":"cmp","vnd.zul":["zir","zirz"],"vnd.zzazz.deck+xml":"zaz","voicexml+xml":"vxml",widget:"wgt",winhlp:"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-ace-compressed":"ace","x-authorware-bin":["aab","x32","u32","vox"],"x-authorware-map":"aam","x-authorware-seg":"aas","x-blorb":["blb","blorb"],"x-bzip":"bz","x-bzip2":["bz2","boz"],"x-cfs-compressed":"cfs","x-chat":"chat","x-conference":"nsc","x-dgc-compressed":"dgc","x-dtbncx+xml":"ncx","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-eva":"eva","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-freearc":"arc","x-gca-compressed":"gca","x-glulx":"ulx","x-gramps-xml":"gramps","x-install-instructions":"install","x-lzh-compressed":["lzh","lha"],"x-mie":"mie","x-mobipocket-ebook":["prc","mobi"],"x-ms-application":"application","x-ms-shortcut":"lnk","x-ms-xbap":"xbap","x-msbinder":"obd","x-mscardfile":"crd","x-msclip":"clp","x-msdownload":["exe","dll","com","bat","msi"],"x-msmediaview":["mvb","m13","m14"],"x-msmetafile":["wmf","wmz","emf","emz"],"x-msmoney":"mny","x-mspublisher":"pub","x-msschedule":"scd","x-msterminal":"trm","x-mswrite":"wri","x-nzb":"nzb","x-pkcs12":["p12","pfx"],"x-pkcs7-certificates":["p7b","spc"],"x-research-info-systems":"ris","x-silverlight-app":"xap","x-sql":"sql","x-stuffitx":"sitx","x-subrip":"srt","x-t3vm-image":"t3","x-tads":"gam","x-tex":"tex","x-tex-tfm":"tfm","x-tgif":"obj","x-xliff+xml":"xlf","x-xz":"xz","x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"xaml+xml":"xaml","xcap-diff+xml":"xdf","xenc+xml":"xenc","xml-dtd":"dtd","xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xv+xml":["mxml","xhvml","xvml","xvm"],yang:"yang","yin+xml":"yin",envoy:"evy",fractals:"fif","internet-property-stream":"acx",olescript:"axs","vnd.ms-outlook":"msg","vnd.ms-pkicertstore":"sst","x-compress":"z","x-compressed":"tgz","x-gzip":"gz","x-perfmon":["pma","pmc","pml","pmr","pmw"],"x-pkcs7-mime":["p7c","p7m"],"ynd.ms-pkipko":"pko"},audio:{amr:"amr","amr-wb":"awb",annodex:"axa",basic:["au","snd"],flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"prs.sid":"sid","x-aiff":["aif","aiff","aifc"],"x-gsm":"gsm","x-ms-wma":"wma","x-ms-wax":"wax","x-pn-realaudio":"ram","x-realaudio":"ra","x-sd2":"sd2","x-wav":"wav",adpcm:"adp",mp4:"mp4a",s3m:"s3m",silk:"sil","vnd.dece.audio":["uva","uvva"],"vnd.digital-winds":"eol","vnd.dra":"dra","vnd.dts":"dts","vnd.dts.hd":"dtshd","vnd.lucent.voice":"lvp","vnd.ms-playready.media.pya":"pya","vnd.nuera.ecelp4800":"ecelp4800","vnd.nuera.ecelp7470":"ecelp7470","vnd.nuera.ecelp9600":"ecelp9600","vnd.rip":"rip",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},chemical:{"x-alchemy":"alc","x-cache":["cac","cache"],"x-cache-csf":"csf","x-cactvs-binary":["cbin","cascii","ctab"],"x-cdx":"cdx","x-chem3d":"c3d","x-cif":"cif","x-cmdf":"cmdf","x-cml":"cml","x-compass":"cpa","x-crossfire":"bsd","x-csml":["csml","csm"],"x-ctx":"ctx","x-cxf":["cxf","cef"],"x-embl-dl-nucleotide":["emb","embl"],"x-gamess-input":["inp","gam","gamin"],"x-gaussian-checkpoint":["fch","fchk"],"x-gaussian-cube":"cub","x-gaussian-input":["gau","gjc","gjf"],"x-gaussian-log":"gal","x-gcg8-sequence":"gcg","x-genbank":"gen","x-hin":"hin","x-isostar":["istr","ist"],"x-jcamp-dx":["jdx","dx"],"x-kinemage":"kin","x-macmolecule":"mcm","x-macromodel-input":["mmd","mmod"],"x-mdl-molfile":"mol","x-mdl-rdfile":"rd","x-mdl-rxnfile":"rxn","x-mdl-sdfile":["sd","sdf"],"x-mdl-tgf":"tgf","x-mmcif":"mcif","x-mol2":"mol2","x-molconn-Z":"b","x-mopac-graph":"gpt","x-mopac-input":["mop","mopcrt","mpc","zmt"],"x-mopac-out":"moo","x-ncbi-asn1":"asn","x-ncbi-asn1-ascii":["prt","ent"],"x-ncbi-asn1-binary":["val","aso"],"x-pdb":["pdb","ent"],"x-rosdal":"ros","x-swissprot":"sw","x-vamas-iso14976":"vms","x-vmd":"vmd","x-xtel":"xtel","x-xyz":"xyz"},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"vnd.djvu":["djvu","djv"],"vnd.wap.wbmp":"wbmp","x-canon-cr2":"cr2","x-canon-crw":"crw","x-cmu-raster":"ras","x-coreldraw":"cdr","x-coreldrawpattern":"pat","x-coreldrawtemplate":"cdt","x-corelphotopaint":"cpt","x-epson-erf":"erf","x-icon":"ico","x-jg":"art","x-jng":"jng","x-nikon-nef":"nef","x-olympus-orf":"orf","x-photoshop":"psd","x-portable-anymap":"pnm","x-portable-bitmap":"pbm","x-portable-graymap":"pgm","x-portable-pixmap":"ppm","x-rgb":"rgb","x-xbitmap":"xbm","x-xpixmap":"xpm","x-xwindowdump":"xwd",bmp:"bmp",cgm:"cgm",g3fax:"g3",ktx:"ktx","prs.btif":"btif",sgi:"sgi","vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"vnd.dwg":"dwg","vnd.dxf":"dxf","vnd.fastbidsheet":"fbs","vnd.fpx":"fpx","vnd.fst":"fst","vnd.fujixerox.edmics-mmr":"mmr","vnd.fujixerox.edmics-rlc":"rlc","vnd.ms-modi":"mdi","vnd.ms-photo":"wdp","vnd.net-fpx":"npx","vnd.xiff":"xif",webp:"webp","x-3ds":"3ds","x-cmx":"cmx","x-freehand":["fh","fhc","fh4","fh5","fh7"],"x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod",pipeg:"jfif"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},model:{iges:["igs","iges"],mesh:["msh","mesh","silo"],vrml:["wrl","vrml"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"],"x3d+binary":["x3db","x3dbz"],"vnd.collada+xml":"dae","vnd.dwf":"dwf","vnd.gdl":"gdl","vnd.gtw":"gtw","vnd.mts":"mts","vnd.vtu":"vtu"},text:{"cache-manifest":["manifest","appcache"],calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx",scriptlet:["sct","wsc"],texmacs:["tm","ts"],"tab-separated-values":"tsv","vnd.sun.j2me.app-descriptor":"jad","vnd.wap.wml":"wml","vnd.wap.wmlscript":"wmls","x-bibtex":"bib","x-boo":"boo","x-c++hdr":["h++","hpp","hxx","hh"],"x-c++src":["c++","cpp","cxx","cc"],"x-component":"htc","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcalendar":"vcs","x-vcard":"vcf",n3:"n3","prs.lines.tag":"dsc",sgml:["sgml","sgm"],troff:["t","tr","roff","man","me","ms"],turtle:"ttl","uri-list":["uri","uris","urls"],vcard:"vcard","vnd.curl":"curl","vnd.curl.dcurl":"dcurl","vnd.curl.scurl":"scurl","vnd.curl.mcurl":"mcurl","vnd.dvb.subtitle":"sub","vnd.fly":"fly","vnd.fmi.flexstor":"flx","vnd.graphviz":"gv","vnd.in3d.3dml":"3dml","vnd.in3d.spot":"spot","x-asm":["s","asm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{avif:".avif","3gpp":"3gp",annodex:"axv",dl:"dl",dv:["dif","dv"],fli:"fli",gl:"gl",mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.dece.hd":["uvh","uvvh"],"vnd.dece.mobile":["uvm","uvvm"],"vnd.dece.pd":["uvp","uvvp"],"vnd.dece.sd":["uvs","uvvs"],"vnd.dece.video":["uvv","uvvv"],"vnd.dvb.file":"dvb","vnd.fvt":"fvt","vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"},"x-conference":{"x-cooltalk":"ice"},"x-world":{"x-vrml":["vrm","vrml","wrl","flr","wrz","xaf","xof"]}},R5=(()=>{let t={};for(let e in Vu)if(Vu.hasOwnProperty(e)){for(let r in Vu[e])if(Vu[e].hasOwnProperty(r)){let n=Vu[e][r];if(typeof n=="string")t[n]=e+"/"+r;else for(let o=0;o<n.length;o++)t[n[o]]=e+"/"+r}}return t})();var MN=[];for(let t=0;t<256;t++){let e=t;for(let r=0;r<8;r++)e&1?e=e>>>1^3988292384:e=e>>>1;MN[t]=e}var rA=class{constructor(e){this.crc=e||-1}append(e){let r=this.crc|0;for(let n=0,o=e.length|0;n<o;n++)r=r>>>8^MN[(r^e[n])&255];this.crc=r}get(){return~this.crc}},ks=rA;var nA=KL;function KL(t){if(typeof TextEncoder>"u"){t=unescape(encodeURIComponent(t));let e=new Uint8Array(t.length);for(let r=0;r<e.length;r++)e[r]=t.charCodeAt(r);return e}else return new TextEncoder().encode(t)}var wo={concat(t,e){if(t.length===0||e.length===0)return t.concat(e);let r=t[t.length-1],n=wo.getPartial(r);return n===32?t.concat(e):wo._shiftRight(e,n,r|0,t.slice(0,t.length-1))},bitLength(t){let e=t.length;if(e===0)return 0;let r=t[e-1];return(e-1)*32+wo.getPartial(r)},clamp(t,e){if(t.length*32<e)return t;t=t.slice(0,Math.ceil(e/32));let r=t.length;return e=e&31,r>0&&e&&(t[r-1]=wo.partial(e,t[r-1]&2147483648>>e-1,1)),t},partial(t,e,r){return t===32?e:(r?e|0:e<<32-t)+t*1099511627776},getPartial(t){return Math.round(t/1099511627776)||32},_shiftRight(t,e,r,n){for(n===void 0&&(n=[]);e>=32;e-=32)n.push(r),r=0;if(e===0)return n.concat(t);for(let a=0;a<t.length;a++)n.push(r|t[a]>>>e),r=t[a]<<32-e;let o=t.length?t[t.length-1]:0,i=wo.getPartial(o);return n.push(wo.partial(e+i&31,e+i>32?r:n.pop(),1)),n}},ku={bytes:{fromBits(t){let r=wo.bitLength(t)/8,n=new Uint8Array(r),o;for(let i=0;i<r;i++)(i&3)===0&&(o=t[i/4]),n[i]=o>>>24,o<<=8;return n},toBits(t){let e=[],r,n=0;for(r=0;r<t.length;r++)n=n<<8|t[r],(r&3)===3&&(e.push(n),n=0);return r&3&&e.push(wo.partial(8*(r&3),n)),e}}},oA={};oA.sha1=function(t){t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()};oA.sha1.prototype={blockSize:512,reset:function(){let t=this;return t._h=this._init.slice(0),t._buffer=[],t._length=0,t},update:function(t){let e=this;typeof t=="string"&&(t=ku.utf8String.toBits(t));let r=e._buffer=wo.concat(e._buffer,t),n=e._length,o=e._length=n+wo.bitLength(t);if(o>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");let i=new Uint32Array(r),a=0;for(let s=e.blockSize+n-(e.blockSize+n&e.blockSize-1);s<=o;s+=e.blockSize)e._block(i.subarray(16*a,16*(a+1))),a+=1;return r.splice(0,16*a),e},finalize:function(){let t=this,e=t._buffer,r=t._h;e=wo.concat(e,[wo.partial(1,1)]);for(let n=e.length+2;n&15;n++)e.push(0);for(e.push(Math.floor(t._length/4294967296)),e.push(t._length|0);e.length;)t._block(e.splice(0,16));return t.reset(),r},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(t,e,r,n){if(t<=19)return e&r|~e&n;if(t<=39)return e^r^n;if(t<=59)return e&r|e&n|r&n;if(t<=79)return e^r^n},_S:function(t,e){return e<<t|e>>>32-t},_block:function(t){let e=this,r=e._h,n=Array(80);for(let c=0;c<16;c++)n[c]=t[c];let o=r[0],i=r[1],a=r[2],s=r[3],l=r[4];for(let c=0;c<=79;c++){c>=16&&(n[c]=e._S(1,n[c-3]^n[c-8]^n[c-14]^n[c-16]));let d=e._S(5,o)+e._f(c,i,a,s)+l+n[c]+e._key[Math.floor(c/20)]|0;l=s,s=a,a=e._S(30,i),i=o,o=d}r[0]=r[0]+o|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+l|0}};var iA={};iA.aes=class{constructor(t){let e=this;e._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],e._tables[0][0][0]||e._precompute();let r=e._tables[0][4],n=e._tables[1],o=t.length,i,a,s,l=1;if(o!==4&&o!==6&&o!==8)throw new Error("invalid aes key size");for(e._key=[a=t.slice(0),s=[]],i=o;i<4*o+28;i++){let c=a[i-1];(i%o===0||o===8&&i%o===4)&&(c=r[c>>>24]<<24^r[c>>16&255]<<16^r[c>>8&255]<<8^r[c&255],i%o===0&&(c=c<<8^c>>>24^l<<24,l=l<<1^(l>>7)*283)),a[i]=a[i-o]^c}for(let c=0;i;c++,i--){let d=a[c&3?i:i-4];i<=4||c<4?s[c]=d:s[c]=n[0][r[d>>>24]]^n[1][r[d>>16&255]]^n[2][r[d>>8&255]]^n[3][r[d&255]]}}encrypt(t){return this._crypt(t,0)}decrypt(t){return this._crypt(t,1)}_precompute(){let t=this._tables[0],e=this._tables[1],r=t[4],n=e[4],o=[],i=[],a,s,l,c;for(let d=0;d<256;d++)i[(o[d]=d<<1^(d>>7)*283)^d]=d;for(let d=a=0;!r[d];d^=s||1,a=i[a]||1){let u=a^a<<1^a<<2^a<<3^a<<4;u=u>>8^u&255^99,r[d]=u,n[u]=d,c=o[l=o[s=o[d]]];let p=c*16843009^l*65537^s*257^d*16843008,_=o[u]*257^u*16843008;for(let h=0;h<4;h++)t[h][d]=_=_<<24^_>>>8,e[h][u]=p=p<<24^p>>>8}for(let d=0;d<5;d++)t[d]=t[d].slice(0),e[d]=e[d].slice(0)}_crypt(t,e){if(t.length!==4)throw new Error("invalid aes block size");let r=this._key[e],n=r.length/4-2,o=[0,0,0,0],i=this._tables[e],a=i[0],s=i[1],l=i[2],c=i[3],d=i[4],u=t[0]^r[0],p=t[e?3:1]^r[1],_=t[2]^r[2],h=t[e?1:3]^r[3],A=4,m,g,S;for(let R=0;R<n;R++)m=a[u>>>24]^s[p>>16&255]^l[_>>8&255]^c[h&255]^r[A],g=a[p>>>24]^s[_>>16&255]^l[h>>8&255]^c[u&255]^r[A+1],S=a[_>>>24]^s[h>>16&255]^l[u>>8&255]^c[p&255]^r[A+2],h=a[h>>>24]^s[u>>16&255]^l[p>>8&255]^c[_&255]^r[A+3],A+=4,u=m,p=g,_=S;for(let R=0;R<4;R++)o[e?3&-R:R]=d[u>>>24]<<24^d[p>>16&255]<<16^d[_>>8&255]<<8^d[h&255]^r[A++],m=u,u=p,p=_,_=h,h=m;return o}};var BN={getRandomValues(t){let e=new Uint32Array(t.buffer),r=n=>{let o=987654321,i=4294967295;return function(){return o=36969*(o&65535)+(o>>16)&i,n=18e3*(n&65535)+(n>>16)&i,(((o<<16)+n&i)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let n=0,o;n<t.length;n+=4){let i=r((o||Math.random())*4294967296);o=i()*987654071,e[n/4]=i()*4294967296|0}return t}},aA={};aA.ctrGladman=class{constructor(t,e){this._prf=t,this._initIv=e,this._iv=e}reset(){this._iv=this._initIv}update(t){return this.calculate(this._prf,t,this._iv)}incWord(t){if((t>>24&255)===255){let e=t>>16&255,r=t>>8&255,n=t&255;e===255?(e=0,r===255?(r=0,n===255?n=0:++n):++r):++e,t=0,t+=e<<16,t+=r<<8,t+=n}else t+=1<<24;return t}incCounter(t){(t[0]=this.incWord(t[0]))===0&&(t[1]=this.incWord(t[1]))}calculate(t,e,r){let n;if(!(n=e.length))return[];let o=wo.bitLength(e);for(let i=0;i<n;i+=4){this.incCounter(r);let a=t.encrypt(r);e[i]^=a[0],e[i+1]^=a[1],e[i+2]^=a[2],e[i+3]^=a[3]}return wo.clamp(e,o)}};var Kc={importKey(t){return new Kc.hmacSha1(ku.bytes.toBits(t))},pbkdf2(t,e,r,n){if(r=r||1e4,n<0||r<0)throw new Error("invalid params to pbkdf2");let o=(n>>5)+1<<2,i,a,s,l,c,d=new ArrayBuffer(o),u=new DataView(d),p=0,_=wo;for(e=ku.bytes.toBits(e),c=1;p<(o||1);c++){for(i=a=t.encrypt(_.concat(e,[c])),s=1;s<r;s++)for(a=t.encrypt(a),l=0;l<a.length;l++)i[l]^=a[l];for(s=0;p<(o||1)&&s<i.length;s++)u.setInt32(p,i[s]),p+=4}return d.slice(0,n/8)}};Kc.hmacSha1=class{constructor(t){let e=this,r=e._hash=oA.sha1,n=[[],[]],o=r.prototype.blockSize/32;e._baseHash=[new r,new r],t.length>o&&(t=r.hash(t));for(let i=0;i<o;i++)n[0][i]=t[i]^909522486,n[1][i]=t[i]^1549556828;e._baseHash[0].update(n[0]),e._baseHash[1].update(n[1]),e._resultHash=new r(e._baseHash[0])}reset(){let t=this;t._resultHash=new t._hash(t._baseHash[0]),t._updated=!1}update(t){let e=this;e._updated=!0,e._resultHash.update(t)}digest(){let t=this,e=t._resultHash.finalize(),r=new t._hash(t._baseHash[1]).update(e).finalize();return t.reset(),r}encrypt(t){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(t),this.digest(t)}};var Wl="Invalid pasword",Yc=16,YL="raw",GN={name:"PBKDF2"},QL={name:"HMAC"},qL="SHA-1",XL=Object.assign({hash:QL},GN),UN=Object.assign({iterations:1e3,hash:{name:qL}},GN),ZL=["deriveBits"],zu=[8,12,16],Hu=[16,24,32],Hs=10,VN=[0,0,0,0],em=typeof crypto<"u",kN=em&&typeof crypto.subtle<"u",ba=ku.bytes,HN=iA.aes,zN=aA.ctrGladman,WN=Kc.hmacSha1,jh=class{constructor(e,r,n){Object.assign(this,{password:e,signed:r,strength:n-1,pendingInput:new Uint8Array(0)})}async append(e){let r=this;if(r.password){let o=yi(e,0,zu[r.strength]+2);await JL(r,o,r.password),r.password=null,r.aesCtrGladman=new zN(new HN(r.keys.key),Array.from(VN)),r.hmac=new WN(r.keys.authentication),e=yi(e,zu[r.strength]+2)}let n=new Uint8Array(e.length-Hs-(e.length-Hs)%Yc);return KN(r,e,n,0,Hs,!0)}flush(){let e=this,r=e.pendingInput,n=yi(r,0,r.length-Hs),o=yi(r,r.length-Hs),i=new Uint8Array(0);if(n.length){let s=ba.toBits(n);e.hmac.update(s);let l=e.aesCtrGladman.update(s);i=ba.fromBits(l)}let a=!0;if(e.signed){let s=yi(ba.fromBits(e.hmac.digest()),0,Hs);for(let l=0;l<Hs;l++)s[l]!=o[l]&&(a=!1)}return{valid:a,data:i}}},$h=class{constructor(e,r){Object.assign(this,{password:e,strength:r-1,pendingInput:new Uint8Array(0)})}async append(e){let r=this,n=new Uint8Array(0);r.password&&(n=await jL(r,r.password),r.password=null,r.aesCtrGladman=new zN(new HN(r.keys.key),Array.from(VN)),r.hmac=new WN(r.keys.authentication));let o=new Uint8Array(n.length+e.length-e.length%Yc);return o.set(n,0),KN(r,e,o,n.length,0)}flush(){let e=this,r=new Uint8Array(0);if(e.pendingInput.length){let o=e.aesCtrGladman.update(ba.toBits(e.pendingInput));e.hmac.update(o),r=ba.fromBits(o)}let n=yi(ba.fromBits(e.hmac.digest()),0,Hs);return{data:sA(r,n),signature:n}}};function KN(t,e,r,n,o,i){let a=e.length-o;t.pendingInput.length&&(e=sA(t.pendingInput,e),r=rM(r,a-a%Yc));let s;for(s=0;s<=a-Yc;s+=Yc){let l=ba.toBits(yi(e,s,s+Yc));i&&t.hmac.update(l);let c=t.aesCtrGladman.update(l);i||t.hmac.update(c),r.set(ba.fromBits(c),s+n)}return t.pendingInput=yi(e,s),r}async function JL(t,e,r){await YN(t,r,yi(e,0,zu[t.strength]));let n=yi(e,zu[t.strength]),o=t.keys.passwordVerification;if(o[0]!=n[0]||o[1]!=n[1])throw new Error(Wl)}async function jL(t,e){let r=$L(new Uint8Array(zu[t.strength]));return await YN(t,e,r),sA(r,t.keys.passwordVerification)}async function YN(t,e,r){let n=nA(e),o=await eM(YL,n,XL,!1,ZL),i=await tM(Object.assign({salt:r},UN),o,8*(Hu[t.strength]*2+2)),a=new Uint8Array(i);t.keys={key:ba.toBits(yi(a,0,Hu[t.strength])),authentication:ba.toBits(yi(a,Hu[t.strength],Hu[t.strength]*2)),passwordVerification:yi(a,Hu[t.strength]*2)}}function $L(t){return em&&typeof crypto.getRandomValues=="function"?crypto.getRandomValues(t):BN.getRandomValues(t)}function eM(t,e,r,n,o){return em&&kN&&typeof crypto.subtle.importKey=="function"?crypto.subtle.importKey(t,e,r,n,o):Kc.importKey(e)}async function tM(t,e,r){return em&&kN&&typeof crypto.subtle.deriveBits=="function"?await crypto.subtle.deriveBits(t,e,r):Kc.pbkdf2(e,t.salt,UN.iterations,r)}function sA(t,e){let r=t;return t.length+e.length&&(r=new Uint8Array(t.length+e.length),r.set(t,0),r.set(e,t.length)),r}function rM(t,e){if(e&&e>t.length){let r=t;t=new Uint8Array(e),t.set(r,0)}return t}function yi(t,e,r){return t.subarray(e,r)}var Qc=12,tm=class{constructor(e,r){let n=this;Object.assign(n,{password:e,passwordVerification:r}),ZN(n,e)}append(e){let r=this;if(r.password){let n=QN(r,e.subarray(0,Qc));if(r.password=null,n[Qc-1]!=r.passwordVerification)throw new Error(Wl);e=e.subarray(Qc)}return QN(r,e)}flush(){return{valid:!0,data:new Uint8Array(0)}}},rm=class{constructor(e,r){let n=this;Object.assign(n,{password:e,passwordVerification:r}),ZN(n,e)}append(e){let r=this,n,o;if(r.password){r.password=null;let i=crypto.getRandomValues(new Uint8Array(Qc));i[Qc-1]=r.passwordVerification,n=new Uint8Array(e.length+i.length),n.set(qN(r,i),0),o=Qc}else n=new Uint8Array(e.length),o=0;return n.set(qN(r,e),o),n}flush(){return{data:new Uint8Array(0)}}};function QN(t,e){let r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=JN(t)^e[n],lA(t,r[n]);return r}function qN(t,e){let r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=JN(t)^e[n],lA(t,e[n]);return r}function ZN(t,e){t.keys=[305419896,591751049,878082192],t.crcKey0=new ks(t.keys[0]),t.crcKey2=new ks(t.keys[2]);for(let r=0;r<e.length;r++)lA(t,e.charCodeAt(r))}function lA(t,e){t.crcKey0.append([e]),t.keys[0]=~t.crcKey0.get(),t.keys[1]=XN(t.keys[1]+jN(t.keys[0])),t.keys[1]=XN(Math.imul(t.keys[1],134775813)+1),t.crcKey2.append([t.keys[1]>>>24]),t.keys[2]=~t.crcKey2.get()}function JN(t){let e=t.keys[2]|2;return jN(Math.imul(e,e^1)>>>8)}function jN(t){return t&255}function XN(t){return t&4294967295}var uA="deflate",nm="inflate",Wu="Invalid signature",cA=class{constructor(e,{signature:r,password:n,signed:o,compressed:i,zipCrypto:a,passwordVerification:s,encryptionStrength:l},{chunkSize:c}){let d=!!n;Object.assign(this,{signature:r,encrypted:d,signed:o,compressed:i,inflate:i&&new e({chunkSize:c}),crc32:o&&new ks,zipCrypto:a,decrypt:d&&a?new tm(n,s):new jh(n,o,l)})}async append(e){let r=this;return r.encrypted&&e.length&&(e=await r.decrypt.append(e)),r.compressed&&e.length&&(e=await r.inflate.append(e)),(!r.encrypted||r.zipCrypto)&&r.signed&&e.length&&r.crc32.append(e),e}async flush(){let e=this,r,n=new Uint8Array(0);if(e.encrypted){let o=e.decrypt.flush();if(!o.valid)throw new Error(Wu);n=o.data}if((!e.encrypted||e.zipCrypto)&&e.signed){let o=new DataView(new Uint8Array(4).buffer);if(r=e.crc32.get(),o.setUint32(0,r),e.signature!=o.getUint32(0,!1))throw new Error(Wu)}return e.compressed&&(n=await e.inflate.append(n)||new Uint8Array(0),await e.inflate.flush()),{data:n,signature:r}}},dA=class{constructor(e,{encrypted:r,signed:n,compressed:o,level:i,zipCrypto:a,password:s,passwordVerification:l,encryptionStrength:c},{chunkSize:d}){Object.assign(this,{encrypted:r,signed:n,compressed:o,deflate:o&&new e({level:i||5,chunkSize:d}),crc32:n&&new ks,zipCrypto:a,encrypt:r&&a?new rm(s,l):new $h(s,c)})}async append(e){let r=this,n=e;return r.compressed&&e.length&&(n=await r.deflate.append(e)),r.encrypted&&n.length&&(n=await r.encrypt.append(n)),(!r.encrypted||r.zipCrypto)&&r.signed&&e.length&&r.crc32.append(e),n}async flush(){let e=this,r,n=new Uint8Array(0);if(e.compressed&&(n=await e.deflate.flush()||new Uint8Array(0)),e.encrypted){n=await e.encrypt.append(n);let o=e.encrypt.flush();r=o.signature;let i=new Uint8Array(n.length+o.data.length);i.set(n,0),i.set(o.data,n.length),n=i}return(!e.encrypted||e.zipCrypto)&&e.signed&&(r=e.crc32.get()),{data:n,signature:r}}};function $N(t,e,r){if(e.codecType.startsWith(uA))return new dA(t,e,r);if(e.codecType.startsWith(nm))return new cA(t,e,r)}var e1="init",t1="append",pA="flush",nM="message",r1=!0,om=(t,e,r,n,o,i,a)=>(Object.assign(t,{busy:!0,codecConstructor:e,options:Object.assign({},r),scripts:a,terminate(){t.worker&&!t.busy&&(t.worker.terminate(),t.interface=null)},onTaskFinished(){t.busy=!1,o(t)}}),i?iM(t,n):oM(t,n));function oM(t,e){let r=$N(t.codecConstructor,t.options,e);return{async append(n){try{return await r.append(n)}catch(o){throw t.onTaskFinished(),o}},async flush(){try{return await r.flush()}finally{t.onTaskFinished()}},abort(){t.onTaskFinished()}}}function iM(t,e){let r,n={type:"module"};if(!t.interface){if(!r1)t.worker=o(n,e.baseURL);else try{t.worker=o({},e.baseURL)}catch{r1=!1,t.worker=o(n,e.baseURL)}t.worker.addEventListener(nM,s,!1),t.interface={append(l){return i({type:t1,data:l})},flush(){return i({type:pA})},abort(){t.onTaskFinished()}}}return t.interface;function o(l,c){let d,u;d=t.scripts[0],typeof d=="function"&&(d=d());try{u=new URL(d,c)}catch{u=d}return new Worker(u,l)}async function i(l){if(!r){let c=t.options,d=t.scripts.slice(1);await a({scripts:d,type:e1,options:c,config:{chunkSize:e.chunkSize}})}return a(l)}function a(l){let c=t.worker,d=new Promise((u,p)=>r={resolve:u,reject:p});try{if(l.data)try{l.data=l.data.buffer,c.postMessage(l,[l.data])}catch{c.postMessage(l)}else c.postMessage(l)}catch(u){r.reject(u),r=null,t.onTaskFinished()}return d}function s(l){let c=l.data;if(r){let d=c.error,u=c.type;if(d){let p=new Error(d.message);p.stack=d.stack,r.reject(p),r=null,t.onTaskFinished()}else if(u==e1||u==pA||u==t1){let p=c.data;u==pA?(r.resolve({data:new Uint8Array(p),signature:c.signature}),r=null,t.onTaskFinished()):r.resolve(p&&new Uint8Array(p))}}}}var Kl=[],_A=[];function hA(t,e,r){let o=!(!e.compressed&&!e.signed&&!e.encrypted)&&(e.useWebWorkers||e.useWebWorkers===void 0&&r.useWebWorkers),i=o&&r.workerScripts?r.workerScripts[e.codecType]:[];if(Kl.length<r.maxWorkers){let s={};return Kl.push(s),om(s,t,e,r,a,o,i)}else{let s=Kl.find(l=>!l.busy);return s?(n1(s),om(s,t,e,r,a,o,i)):new Promise(l=>_A.push({resolve:l,codecConstructor:t,options:e,webWorker:o,scripts:i}))}function a(s){if(_A.length){let[{resolve:l,codecConstructor:c,options:d,webWorker:u,scripts:p}]=_A.splice(0,1);l(om(s,c,d,r,a,u,p))}else s.worker?(n1(s),Number.isFinite(r.terminateWorkerTimeout)&&r.terminateWorkerTimeout>=0&&(s.terminateTimeout=setTimeout(()=>{Kl=Kl.filter(l=>l!=s),s.terminate()},r.terminateWorkerTimeout))):Kl=Kl.filter(l=>l!=s)}}function n1(t){t.terminateTimeout&&(clearTimeout(t.terminateTimeout),t.terminateTimeout=null)}var o1=t=>{if(typeof URL.createObjectURL=="function"){let e=()=>URL.createObjectURL(new Blob([`const{Array:t,Object:e,Math:n,Error:r,Uint8Array:i,Uint16Array:o,Uint32Array:s,Int32Array:f,DataView:c,TextEncoder:l,crypto:u,postMessage:a}=globalThis,w=[];for(let t=0;256>t;t++){let e=t;for(let t=0;8>t;t++)1&e?e=e>>>1^3988292384:e>>>=1;w[t]=e}class h{constructor(t){this.t=t||-1}append(t){let e=0|this.t;for(let n=0,r=0|t.length;r>n;n++)e=e>>>8^w[255&(e^t[n])];this.t=e}get(){return~this.t}}const d={concat(t,e){if(0===t.length||0===e.length)return t.concat(e);const n=t[t.length-1],r=d.i(n);return 32===r?t.concat(e):d.o(e,r,0|n,t.slice(0,t.length-1))},l(t){const e=t.length;if(0===e)return 0;const n=t[e-1];return 32*(e-1)+d.i(n)},u(t,e){if(32*t.length<e)return t;const r=(t=t.slice(0,n.ceil(e/32))).length;return e&=31,r>0&&e&&(t[r-1]=d.h(e,t[r-1]&2147483648>>e-1,1)),t},h:(t,e,n)=>32===t?e:(n?0|e:e<<32-t)+1099511627776*t,i:t=>n.round(t/1099511627776)||32,o(t,e,n,r){for(void 0===r&&(r=[]);e>=32;e-=32)r.push(n),n=0;if(0===e)return r.concat(t);for(let i=0;i<t.length;i++)r.push(n|t[i]>>>e),n=t[i]<<32-e;const i=t.length?t[t.length-1]:0,o=d.i(i);return r.push(d.h(e+o&31,e+o>32?n:r.pop(),1)),r}},p={p:{k(t){const e=d.l(t)/8,n=new i(e);let r;for(let i=0;e>i;i++)0==(3&i)&&(r=t[i/4]),n[i]=r>>>24,r<<=8;return n},g(t){const e=[];let n,r=0;for(n=0;n<t.length;n++)r=r<<8|t[n],3==(3&n)&&(e.push(r),r=0);return 3&n&&e.push(d.h(8*(3&n),r)),e}}},y={v:function(t){t?(this.m=t.m.slice(0),this.S=t.S.slice(0),this._=t._):this.reset()}};y.v.prototype={blockSize:512,reset:function(){const t=this;return t.m=this.I.slice(0),t.S=[],t._=0,t},update:function(t){const e=this;"string"==typeof t&&(t=p.A.g(t));const n=e.S=d.concat(e.S,t),i=e._,o=e._=i+d.l(t);if(o>9007199254740991)throw new r("Cannot hash more than 2^53 - 1 bits");const f=new s(n);let c=0;for(let t=e.blockSize+i-(e.blockSize+i&e.blockSize-1);o>=t;t+=e.blockSize)e.C(f.subarray(16*c,16*(c+1))),c+=1;return n.splice(0,16*c),e},V:function(){const t=this;let e=t.S;const r=t.m;e=d.concat(e,[d.h(1,1)]);for(let t=e.length+2;15&t;t++)e.push(0);for(e.push(n.floor(t._/4294967296)),e.push(0|t._);e.length;)t.C(e.splice(0,16));return t.reset(),r},I:[1732584193,4023233417,2562383102,271733878,3285377520],B:[1518500249,1859775393,2400959708,3395469782],D:(t,e,n,r)=>t>19?t>39?t>59?t>79?void 0:e^n^r:e&n|e&r|n&r:e^n^r:e&n|~e&r,U:(t,e)=>e<<t|e>>>32-t,C:function(e){const r=this,i=r.m,o=t(80);for(let t=0;16>t;t++)o[t]=e[t];let s=i[0],f=i[1],c=i[2],l=i[3],u=i[4];for(let t=0;79>=t;t++){16>t||(o[t]=r.U(1,o[t-3]^o[t-8]^o[t-14]^o[t-16]));const e=r.U(5,s)+r.D(t,f,c,l)+u+o[t]+r.B[n.floor(t/20)]|0;u=l,l=c,c=r.U(30,f),f=s,s=e}i[0]=i[0]+s|0,i[1]=i[1]+f|0,i[2]=i[2]+c|0,i[3]=i[3]+l|0,i[4]=i[4]+u|0}};const b={getRandomValues(t){const e=new s(t.buffer),r=t=>{let e=987654321;const r=4294967295;return()=>(e=36969*(65535&e)+(e>>16)&r,(((e<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r)/4294967296+.5)*(n.random()>.5?1:-1))};for(let i,o=0;o<t.length;o+=4){const t=r(4294967296*(i||n.random()));i=987654071*t(),e[o/4]=4294967296*t()|0}return t}},k={importKey:t=>new k.M(p.p.g(t)),P(t,e,n,i){if(n=n||1e4,0>i||0>n)throw new r("invalid params to pbkdf2");const o=1+(i>>5)<<2;let s,f,l,u,a;const w=new ArrayBuffer(o),h=new c(w);let y=0;const b=d;for(e=p.p.g(e),a=1;(o||1)>y;a++){for(s=f=t.encrypt(b.concat(e,[a])),l=1;n>l;l++)for(f=t.encrypt(f),u=0;u<f.length;u++)s[u]^=f[u];for(l=0;(o||1)>y&&l<s.length;l++)h.setInt32(y,s[l]),y+=4}return w.slice(0,i/8)},M:class{constructor(t){const e=this,n=e.R=y.v,r=[[],[]],i=n.prototype.blockSize/32;e.H=[new n,new n],t.length>i&&(t=n.hash(t));for(let e=0;i>e;e++)r[0][e]=909522486^t[e],r[1][e]=1549556828^t[e];e.H[0].update(r[0]),e.H[1].update(r[1]),e.K=new n(e.H[0])}reset(){const t=this;t.K=new t.R(t.H[0]),t.L=!1}update(t){this.L=!0,this.K.update(t)}digest(){const t=this,e=t.K.V(),n=new t.R(t.H[1]).update(e).V();return t.reset(),n}encrypt(t){if(this.L)throw new r("encrypt on already updated hmac called!");return this.update(t),this.digest(t)}}},g={name:"PBKDF2"},v=e.assign({hash:{name:"HMAC"}},g),m=e.assign({iterations:1e3,hash:{name:"SHA-1"}},g),S=["deriveBits"],z=[8,12,16],_=[16,24,32],I=[0,0,0,0],A=void 0!==u,C=A&&void 0!==u.subtle,V=p.p,B=class{constructor(t){const e=this;e.T=[[[],[],[],[],[]],[[],[],[],[],[]]],e.T[0][0][0]||e.j();const n=e.T[0][4],i=e.T[1],o=t.length;let s,f,c,l=1;if(4!==o&&6!==o&&8!==o)throw new r("invalid aes key size");for(e.B=[f=t.slice(0),c=[]],s=o;4*o+28>s;s++){let t=f[s-1];(s%o==0||8===o&&s%o==4)&&(t=n[t>>>24]<<24^n[t>>16&255]<<16^n[t>>8&255]<<8^n[255&t],s%o==0&&(t=t<<8^t>>>24^l<<24,l=l<<1^283*(l>>7))),f[s]=f[s-o]^t}for(let t=0;s;t++,s--){const e=f[3&t?s:s-4];c[t]=4>=s||4>t?e:i[0][n[e>>>24]]^i[1][n[e>>16&255]]^i[2][n[e>>8&255]]^i[3][n[255&e]]}}encrypt(t){return this.F(t,0)}decrypt(t){return this.F(t,1)}j(){const t=this.T[0],e=this.T[1],n=t[4],r=e[4],i=[],o=[];let s,f,c,l;for(let t=0;256>t;t++)o[(i[t]=t<<1^283*(t>>7))^t]=t;for(let u=s=0;!n[u];u^=f||1,s=o[s]||1){let o=s^s<<1^s<<2^s<<3^s<<4;o=o>>8^255&o^99,n[u]=o,r[o]=u,l=i[c=i[f=i[u]]];let a=16843009*l^65537*c^257*f^16843008*u,w=257*i[o]^16843008*o;for(let n=0;4>n;n++)t[n][u]=w=w<<24^w>>>8,e[n][o]=a=a<<24^a>>>8}for(let n=0;5>n;n++)t[n]=t[n].slice(0),e[n]=e[n].slice(0)}F(t,e){if(4!==t.length)throw new r("invalid aes block size");const n=this.B[e],i=n.length/4-2,o=[0,0,0,0],s=this.T[e],f=s[0],c=s[1],l=s[2],u=s[3],a=s[4];let w,h,d,p=t[0]^n[0],y=t[e?3:1]^n[1],b=t[2]^n[2],k=t[e?1:3]^n[3],g=4;for(let t=0;i>t;t++)w=f[p>>>24]^c[y>>16&255]^l[b>>8&255]^u[255&k]^n[g],h=f[y>>>24]^c[b>>16&255]^l[k>>8&255]^u[255&p]^n[g+1],d=f[b>>>24]^c[k>>16&255]^l[p>>8&255]^u[255&y]^n[g+2],k=f[k>>>24]^c[p>>16&255]^l[y>>8&255]^u[255&b]^n[g+3],g+=4,p=w,y=h,b=d;for(let t=0;4>t;t++)o[e?3&-t:t]=a[p>>>24]<<24^a[y>>16&255]<<16^a[b>>8&255]<<8^a[255&k]^n[g++],w=p,p=y,y=b,b=k,k=w;return o}},E=class{constructor(t,e){this.O=t,this.W=e,this.q=e}reset(){this.q=this.W}update(t){return this.G(this.O,t,this.q)}J(t){if(255==(t>>24&255)){let e=t>>16&255,n=t>>8&255,r=255&t;255===e?(e=0,255===n?(n=0,255===r?r=0:++r):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=r}else t+=1<<24;return t}N(t){0===(t[0]=this.J(t[0]))&&(t[1]=this.J(t[1]))}G(t,e,n){let r;if(!(r=e.length))return[];const i=d.l(e);for(let i=0;r>i;i+=4){this.N(n);const r=t.encrypt(n);e[i]^=r[0],e[i+1]^=r[1],e[i+2]^=r[2],e[i+3]^=r[3]}return d.u(e,i)}},D=k.M;class U{constructor(t,n,r){e.assign(this,{password:t,signed:n,X:r-1,Y:new i(0)})}async append(e){const n=this;if(n.password){const i=K(e,0,z[n.X]+2);await(async(t,e,n)=>{await R(t,n,K(e,0,z[t.X]));const i=K(e,z[t.X]),o=t.keys.passwordVerification;if(o[0]!=i[0]||o[1]!=i[1])throw new r("Invalid pasword")})(n,i,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt),e=K(e,z[n.X]+2)}return P(n,e,new i(e.length-10-(e.length-10)%16),0,10,!0)}flush(){const t=this,e=t.Y,n=K(e,0,e.length-10),r=K(e,e.length-10);let o=new i(0);if(n.length){const e=V.g(n);t.$.update(e);const r=t.Z.update(e);o=V.k(r)}let s=!0;if(t.signed){const e=K(V.k(t.$.digest()),0,10);for(let t=0;10>t;t++)e[t]!=r[t]&&(s=!1)}return{valid:s,data:o}}}class M{constructor(t,n){e.assign(this,{password:t,X:n-1,Y:new i(0)})}async append(e){const n=this;let r=new i(0);n.password&&(r=await(async(t,e)=>{const n=(r=new i(z[t.X]),A&&"function"==typeof u.getRandomValues?u.getRandomValues(r):b.getRandomValues(r));var r;return await R(t,e,n),H(n,t.keys.passwordVerification)})(n,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt));const o=new i(r.length+e.length-e.length%16);return o.set(r,0),P(n,e,o,r.length,0)}flush(){const t=this;let e=new i(0);if(t.Y.length){const n=t.Z.update(V.g(t.Y));t.$.update(n),e=V.k(n)}const n=K(V.k(t.$.digest()),0,10);return{data:H(e,n),signature:n}}}function P(t,e,n,r,o,s){const f=e.length-o;let c;for(t.Y.length&&(e=H(t.Y,e),n=((t,e)=>{if(e&&e>t.length){const n=t;(t=new i(e)).set(n,0)}return t})(n,f-f%16)),c=0;f-16>=c;c+=16){const i=V.g(K(e,c,c+16));s&&t.$.update(i);const o=t.Z.update(i);s||t.$.update(o),n.set(V.k(o),c+r)}return t.Y=K(e,c),n}async function R(t,n,r){const o=(t=>{if(void 0===l){const e=new i((t=unescape(encodeURIComponent(t))).length);for(let n=0;n<e.length;n++)e[n]=t.charCodeAt(n);return e}return(new l).encode(t)})(n),s=await((t,e,n,r,i)=>A&&C&&"function"==typeof u.subtle.importKey?u.subtle.importKey("raw",e,n,!1,i):k.importKey(e))(0,o,v,0,S),f=await(async(t,e,n)=>A&&C&&"function"==typeof u.subtle.deriveBits?await u.subtle.deriveBits(t,e,n):k.P(e,t.salt,m.iterations,n))(e.assign({salt:r},m),s,8*(2*_[t.X]+2)),c=new i(f);t.keys={key:V.g(K(c,0,_[t.X])),tt:V.g(K(c,_[t.X],2*_[t.X])),passwordVerification:K(c,2*_[t.X])}}function H(t,e){let n=t;return t.length+e.length&&(n=new i(t.length+e.length),n.set(t,0),n.set(e,t.length)),n}function K(t,e,n){return t.subarray(e,n)}class L{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;if(e.password){const n=j(e,t.subarray(0,12));if(e.password=null,n[11]!=e.passwordVerification)throw new r("Invalid pasword");t=t.subarray(12)}return j(e,t)}flush(){return{valid:!0,data:new i(0)}}}class T{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;let n,r;if(e.password){e.password=null;const o=u.getRandomValues(new i(12));o[11]=e.passwordVerification,n=new i(t.length+o.length),n.set(x(e,o),0),r=12}else n=new i(t.length),r=0;return n.set(x(e,t),r),n}flush(){return{data:new i(0)}}}function j(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,n[r]);return n}function x(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,e[r]);return n}function F(t,e){t.keys=[305419896,591751049,878082192],t.et=new h(t.keys[0]),t.nt=new h(t.keys[2]);for(let n=0;n<e.length;n++)O(t,e.charCodeAt(n))}function O(t,e){t.et.append([e]),t.keys[0]=~t.et.get(),t.keys[1]=G(t.keys[1]+q(t.keys[0])),t.keys[1]=G(n.imul(t.keys[1],134775813)+1),t.nt.append([t.keys[1]>>>24]),t.keys[2]=~t.nt.get()}function W(t){const e=2|t.keys[2];return q(n.imul(e,1^e)>>>8)}function q(t){return 255&t}function G(t){return 4294967295&t}class J{constructor(t,{signature:n,password:r,signed:i,compressed:o,zipCrypto:s,passwordVerification:f,encryptionStrength:c},{rt:l}){const u=!!r;e.assign(this,{signature:n,encrypted:u,signed:i,compressed:o,it:o&&new t({rt:l}),ot:i&&new h,zipCrypto:s,decrypt:u&&s?new L(r,f):new U(r,i,c)})}async append(t){const e=this;return e.encrypted&&t.length&&(t=await e.decrypt.append(t)),e.compressed&&t.length&&(t=await e.it.append(t)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),t}async flush(){const t=this;let e,n=new i(0);if(t.encrypted){const e=t.decrypt.flush();if(!e.valid)throw new r("Invalid signature");n=e.data}if((!t.encrypted||t.zipCrypto)&&t.signed){const n=new c(new i(4).buffer);if(e=t.ot.get(),n.setUint32(0,e),t.signature!=n.getUint32(0,!1))throw new r("Invalid signature")}return t.compressed&&(n=await t.it.append(n)||new i(0),await t.it.flush()),{data:n,signature:e}}}class N{constructor(t,{encrypted:n,signed:r,compressed:i,level:o,zipCrypto:s,password:f,passwordVerification:c,encryptionStrength:l},{rt:u}){e.assign(this,{encrypted:n,signed:r,compressed:i,st:i&&new t({level:o||5,rt:u}),ot:r&&new h,zipCrypto:s,encrypt:n&&s?new T(f,c):new M(f,l)})}async append(t){const e=this;let n=t;return e.compressed&&t.length&&(n=await e.st.append(t)),e.encrypted&&n.length&&(n=await e.encrypt.append(n)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),n}async flush(){const t=this;let e,n=new i(0);if(t.compressed&&(n=await t.st.flush()||new i(0)),t.encrypted){n=await t.encrypt.append(n);const r=t.encrypt.flush();e=r.signature;const o=new i(n.length+r.data.length);o.set(n,0),o.set(r.data,n.length),n=o}return t.encrypted&&!t.zipCrypto||!t.signed||(e=t.ot.get()),{data:n,signature:e}}}const Q={init(t){t.scripts&&t.scripts.length&&importScripts.apply(void 0,t.scripts);const e=t.options;let n;self.initCodec&&self.initCodec(),e.codecType.startsWith("deflate")?n=self.Deflate:e.codecType.startsWith("inflate")&&(n=self.Inflate),X=((t,e,n)=>e.codecType.startsWith("deflate")?new N(t,e,n):e.codecType.startsWith("inflate")?new J(t,e,n):void 0)(n,e,t.config)},append:async t=>({data:await X.append(t.data)}),flush:()=>X.flush()};let X;function Y(e){return Z(e.map((([e,n])=>new t(e).fill(n,0,e))))}function Z(e){return e.reduce(((e,n)=>e.concat(t.isArray(n)?Z(n):n)),[])}addEventListener("message",(async t=>{const e=t.data,n=e.type,r=Q[n];if(r)try{e.data&&(e.data=new i(e.data));const t=await r(e)||{};if(t.type=n,t.data)try{t.data=t.data.buffer,a(t,[t.data])}catch(e){a(t)}else a(t)}catch(t){a({type:n,error:{message:t.message,stack:t.stack}})}}));const $=[0,1,2,3].concat(...Y([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function tt(){const t=this;function e(t,e){let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}t.ft=r=>{const i=t.ct,o=t.ut.lt,s=t.ut.wt;let f,c,l,u=-1;for(r.ht=0,r.dt=573,f=0;s>f;f++)0!==i[2*f]?(r.yt[++r.ht]=u=f,r.bt[f]=0):i[2*f+1]=0;for(;2>r.ht;)l=r.yt[++r.ht]=2>u?++u:0,i[2*l]=1,r.bt[l]=0,r.kt--,o&&(r.gt-=o[2*l+1]);for(t.vt=u,f=n.floor(r.ht/2);f>=1;f--)r.St(i,f);l=s;do{f=r.yt[1],r.yt[1]=r.yt[r.ht--],r.St(i,1),c=r.yt[1],r.yt[--r.dt]=f,r.yt[--r.dt]=c,i[2*l]=i[2*f]+i[2*c],r.bt[l]=n.max(r.bt[f],r.bt[c])+1,i[2*f+1]=i[2*c+1]=l,r.yt[1]=l++,r.St(i,1)}while(r.ht>=2);r.yt[--r.dt]=r.yt[1],(e=>{const n=t.ct,r=t.ut.lt,i=t.ut.zt,o=t.ut._t,s=t.ut.It;let f,c,l,u,a,w,h=0;for(u=0;15>=u;u++)e.At[u]=0;for(n[2*e.yt[e.dt]+1]=0,f=e.dt+1;573>f;f++)c=e.yt[f],u=n[2*n[2*c+1]+1]+1,u>s&&(u=s,h++),n[2*c+1]=u,c>t.vt||(e.At[u]++,a=0,o>c||(a=i[c-o]),w=n[2*c],e.kt+=w*(u+a),r&&(e.gt+=w*(r[2*c+1]+a)));if(0!==h){do{for(u=s-1;0===e.At[u];)u--;e.At[u]--,e.At[u+1]+=2,e.At[s]--,h-=2}while(h>0);for(u=s;0!==u;u--)for(c=e.At[u];0!==c;)l=e.yt[--f],l>t.vt||(n[2*l+1]!=u&&(e.kt+=(u-n[2*l+1])*n[2*l],n[2*l+1]=u),c--)}})(r),((t,n,r)=>{const i=[];let o,s,f,c=0;for(o=1;15>=o;o++)i[o]=c=c+r[o-1]<<1;for(s=0;n>=s;s++)f=t[2*s+1],0!==f&&(t[2*s]=e(i[f]++,f))})(i,t.vt,r.At)}}function et(t,e,n,r,i){const o=this;o.lt=t,o.zt=e,o._t=n,o.wt=r,o.It=i}tt.Ct=[0,1,2,3,4,5,6,7].concat(...Y([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]])),tt.Vt=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],tt.Bt=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],tt.Et=t=>256>t?$[t]:$[256+(t>>>7)],tt.Dt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tt.Ut=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],tt.Mt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],tt.Pt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];const nt=Y([[144,8],[112,9],[24,7],[8,8]]);et.Rt=Z([12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227].map(((t,e)=>[t,nt[e]])));const rt=Y([[30,5]]);function it(t,e,n,r,i){const o=this;o.Ht=t,o.Kt=e,o.Lt=n,o.Tt=r,o.jt=i}et.xt=Z([0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23].map(((t,e)=>[t,rt[e]]))),et.Ft=new et(et.Rt,tt.Dt,257,286,15),et.Ot=new et(et.xt,tt.Ut,0,30,15),et.Wt=new et(null,tt.Mt,0,19,7);const ot=[new it(0,0,0,0,0),new it(4,4,8,4,1),new it(4,5,16,8,1),new it(4,6,32,32,1),new it(4,4,16,16,2),new it(8,16,32,32,2),new it(8,16,128,128,2),new it(8,32,128,256,2),new it(32,128,258,1024,2),new it(32,258,258,4096,2)],st=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function ft(t,e,n,r){const i=t[2*e],o=t[2*n];return o>i||i==o&&r[e]<=r[n]}function ct(){const t=this;let e,r,s,f,c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z,_,I,A,C,V,B,E,D,U,M,P,R,H;const K=new tt,L=new tt,T=new tt;let j,x,F,O,W,q;function G(){let e;for(e=0;286>e;e++)P[2*e]=0;for(e=0;30>e;e++)R[2*e]=0;for(e=0;19>e;e++)H[2*e]=0;P[512]=1,t.kt=t.gt=0,x=F=0}function J(t,e){let n,r=-1,i=t[1],o=0,s=7,f=4;0===i&&(s=138,f=3),t[2*(e+1)+1]=65535;for(let c=0;e>=c;c++)n=i,i=t[2*(c+1)+1],++o<s&&n==i||(f>o?H[2*n]+=o:0!==n?(n!=r&&H[2*n]++,H[32]++):o>10?H[36]++:H[34]++,o=0,r=n,0===i?(s=138,f=3):n==i?(s=6,f=3):(s=7,f=4))}function N(e){t.qt[t.pending++]=e}function Q(t){N(255&t),N(t>>>8&255)}function X(t,e){let n;const r=e;q>16-r?(n=t,W|=n<<q&65535,Q(W),W=n>>>16-q,q+=r-16):(W|=t<<q&65535,q+=r)}function Y(t,e){const n=2*t;X(65535&e[n],65535&e[n+1])}function Z(t,e){let n,r,i=-1,o=t[1],s=0,f=7,c=4;for(0===o&&(f=138,c=3),n=0;e>=n;n++)if(r=o,o=t[2*(n+1)+1],++s>=f||r!=o){if(c>s)do{Y(r,H)}while(0!=--s);else 0!==r?(r!=i&&(Y(r,H),s--),Y(16,H),X(s-3,2)):s>10?(Y(18,H),X(s-11,7)):(Y(17,H),X(s-3,3));s=0,i=r,0===o?(f=138,c=3):r==o?(f=6,c=3):(f=7,c=4)}}function $(){16==q?(Q(W),W=0,q=0):8>q||(N(255&W),W>>>=8,q-=8)}function nt(e,r){let i,o,s;if(t.Gt[x]=e,t.Jt[x]=255&r,x++,0===e?P[2*r]++:(F++,e--,P[2*(tt.Ct[r]+256+1)]++,R[2*tt.Et(e)]++),0==(8191&x)&&E>2){for(i=8*x,o=_-v,s=0;30>s;s++)i+=R[2*s]*(5+tt.Ut[s]);if(i>>>=3,F<n.floor(x/2)&&i<n.floor(o/2))return!0}return x==j-1}function rt(e,n){let r,i,o,s,f=0;if(0!==x)do{r=t.Gt[f],i=t.Jt[f],f++,0===r?Y(i,e):(o=tt.Ct[i],Y(o+256+1,e),s=tt.Dt[o],0!==s&&(i-=tt.Vt[o],X(i,s)),r--,o=tt.Et(r),Y(o,n),s=tt.Ut[o],0!==s&&(r-=tt.Bt[o],X(r,s)))}while(x>f);Y(256,e),O=e[513]}function it(){q>8?Q(W):q>0&&N(255&W),W=0,q=0}function ct(e,n,r){X(0+(r?1:0),3),((e,n)=>{it(),O=8,Q(n),Q(~n),t.qt.set(a.subarray(e,e+n),t.pending),t.pending+=n})(e,n)}function lt(n){((e,n,r)=>{let i,o,s=0;E>0?(K.ft(t),L.ft(t),s=(()=>{let e;for(J(P,K.vt),J(R,L.vt),T.ft(t),e=18;e>=3&&0===H[2*tt.Pt[e]+1];e--);return t.kt+=14+3*(e+1),e})(),i=t.kt+3+7>>>3,o=t.gt+3+7>>>3,o>i||(i=o)):i=o=n+5,n+4>i||-1==e?o==i?(X(2+(r?1:0),3),rt(et.Rt,et.xt)):(X(4+(r?1:0),3),((t,e,n)=>{let r;for(X(t-257,5),X(e-1,5),X(n-4,4),r=0;n>r;r++)X(H[2*tt.Pt[r]+1],3);Z(P,t-1),Z(R,e-1)})(K.vt+1,L.vt+1,s+1),rt(P,R)):ct(e,n,r),G(),r&&it()})(0>v?-1:v,_-v,n),v=_,e.Nt()}function ut(){let t,n,r,i;do{if(i=w-A-_,0===i&&0===_&&0===A)i=c;else if(-1==i)i--;else if(_>=c+c-262){a.set(a.subarray(c,c+c),0),I-=c,_-=c,v-=c,t=y,r=t;do{n=65535&d[--r],d[r]=c>n?0:n-c}while(0!=--t);t=c,r=t;do{n=65535&h[--r],h[r]=c>n?0:n-c}while(0!=--t);i+=c}if(0===e.Qt)return;t=e.Xt(a,_+A,i),A+=t,3>A||(p=255&a[_],p=(p<<g^255&a[_+1])&k)}while(262>A&&0!==e.Qt)}function at(t){let e,n,r=V,i=_,o=C;const s=_>c-262?_-(c-262):0;let f=M;const l=u,w=_+258;let d=a[i+o-1],p=a[i+o];U>C||(r>>=2),f>A&&(f=A);do{if(e=t,a[e+o]==p&&a[e+o-1]==d&&a[e]==a[i]&&a[++e]==a[i+1]){i+=2,e++;do{}while(a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&w>i);if(n=258-(w-i),i=w-258,n>o){if(I=t,o=n,n>=f)break;d=a[i+o-1],p=a[i+o]}}}while((t=65535&h[t&l])>s&&0!=--r);return o>A?A:o}t.bt=[],t.At=[],t.yt=[],P=[],R=[],H=[],t.St=(e,n)=>{const r=t.yt,i=r[n];let o=n<<1;for(;o<=t.ht&&(o<t.ht&&ft(e,r[o+1],r[o],t.bt)&&o++,!ft(e,i,r[o],t.bt));)r[n]=r[o],n=o,o<<=1;r[n]=i},t.Yt=(e,S,I,x,F,J)=>(x||(x=8),F||(F=8),J||(J=0),e.Zt=null,-1==S&&(S=6),1>F||F>9||8!=x||9>I||I>15||0>S||S>9||0>J||J>2?-2:(e.$t=t,l=I,c=1<<l,u=c-1,b=F+7,y=1<<b,k=y-1,g=n.floor((b+3-1)/3),a=new i(2*c),h=[],d=[],j=1<<F+6,t.qt=new i(4*j),s=4*j,t.Gt=new o(j),t.Jt=new i(j),E=S,D=J,(e=>(e.te=e.ee=0,e.Zt=null,t.pending=0,t.ne=0,r=113,f=0,K.ct=P,K.ut=et.Ft,L.ct=R,L.ut=et.Ot,T.ct=H,T.ut=et.Wt,W=0,q=0,O=8,G(),(()=>{w=2*c,d[y-1]=0;for(let t=0;y-1>t;t++)d[t]=0;B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt,_=0,v=0,A=0,m=C=2,z=0,p=0})(),0))(e))),t.re=()=>42!=r&&113!=r&&666!=r?-2:(t.Jt=null,t.Gt=null,t.qt=null,d=null,h=null,a=null,t.$t=null,113==r?-3:0),t.ie=(t,e,n)=>{let r=0;return-1==e&&(e=6),0>e||e>9||0>n||n>2?-2:(ot[E].jt!=ot[e].jt&&0!==t.te&&(r=t.st(1)),E!=e&&(E=e,B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt),D=n,r)},t.oe=(t,e,n)=>{let i,o=n,s=0;if(!e||42!=r)return-2;if(3>o)return 0;for(o>c-262&&(o=c-262,s=n-o),a.set(e.subarray(s,s+o),0),_=o,v=o,p=255&a[0],p=(p<<g^255&a[1])&k,i=0;o-3>=i;i++)p=(p<<g^255&a[i+2])&k,h[i&u]=d[p],d[p]=i;return 0},t.st=(n,i)=>{let o,w,b,V,U;if(i>4||0>i)return-2;if(!n.se||!n.fe&&0!==n.Qt||666==r&&4!=i)return n.Zt=st[4],-2;if(0===n.ce)return n.Zt=st[7],-5;var M;if(e=n,V=f,f=i,42==r&&(w=8+(l-8<<4)<<8,b=(E-1&255)>>1,b>3&&(b=3),w|=b<<6,0!==_&&(w|=32),w+=31-w%31,r=113,N((M=w)>>8&255),N(255&M)),0!==t.pending){if(e.Nt(),0===e.ce)return f=-1,0}else if(0===e.Qt&&V>=i&&4!=i)return e.Zt=st[7],-5;if(666==r&&0!==e.Qt)return n.Zt=st[7],-5;if(0!==e.Qt||0!==A||0!=i&&666!=r){switch(U=-1,ot[E].jt){case 0:U=(t=>{let n,r=65535;for(r>s-5&&(r=s-5);;){if(1>=A){if(ut(),0===A&&0==t)return 0;if(0===A)break}if(_+=A,A=0,n=v+r,(0===_||_>=n)&&(A=_-n,_=n,lt(!1),0===e.ce))return 0;if(_-v>=c-262&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 1:U=(t=>{let n,r=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_),0===r||(_-r&65535)>c-262||2!=D&&(m=at(r)),3>m)n=nt(0,255&a[_]),A--,_++;else if(n=nt(_-I,m-3),A-=m,m>B||3>A)_+=m,m=0,p=255&a[_],p=(p<<g^255&a[_+1])&k;else{m--;do{_++,p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_}while(0!=--m);_++}if(n&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 2:U=(t=>{let n,r,i=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_),C=m,S=I,m=2,0!==i&&B>C&&c-262>=(_-i&65535)&&(2!=D&&(m=at(i)),5>=m&&(1==D||3==m&&_-I>4096)&&(m=2)),3>C||m>C)if(0!==z){if(n=nt(0,255&a[_-1]),n&&lt(!1),_++,A--,0===e.ce)return 0}else z=1,_++,A--;else{r=_+A-3,n=nt(_-1-S,C-3),A-=C-1,C-=2;do{++_>r||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_)}while(0!=--C);if(z=0,m=2,_++,n&&(lt(!1),0===e.ce))return 0}}return 0!==z&&(n=nt(0,255&a[_-1]),z=0),lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i)}if(2!=U&&3!=U||(r=666),0==U||2==U)return 0===e.ce&&(f=-1),0;if(1==U){if(1==i)X(2,3),Y(256,et.Rt),$(),9>1+O+10-q&&(X(2,3),Y(256,et.Rt),$()),O=7;else if(ct(0,0,!1),3==i)for(o=0;y>o;o++)d[o]=0;if(e.Nt(),0===e.ce)return f=-1,0}}return 4!=i?0:1}}function lt(){const t=this;t.le=0,t.ue=0,t.Qt=0,t.te=0,t.ce=0,t.ee=0}function ut(t){const e=new lt,o=(s=t&&t.rt?t.rt:65536)+5*(n.floor(s/16383)+1);var s;const f=new i(o);let c=t?t.level:-1;void 0===c&&(c=-1),e.Yt(c),e.se=f,this.append=(t,n)=>{let s,c,l=0,u=0,a=0;const w=[];if(t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,s=e.st(0),0!=s)throw new r("deflating: "+e.Zt);e.ue&&(e.ue==o?w.push(new i(f)):w.push(f.slice(0,e.ue))),a+=e.ue,n&&e.le>0&&e.le!=l&&(n(e.le),l=e.le)}while(e.Qt>0||0===e.ce);return w.length>1?(c=new i(a),w.forEach((t=>{c.set(t,u),u+=t.length}))):c=w[0]||new i(0),c}},this.flush=()=>{let t,n,s=0,c=0;const l=[];do{if(e.ue=0,e.ce=o,t=e.st(4),1!=t&&0!=t)throw new r("deflating: "+e.Zt);o-e.ce>0&&l.push(f.slice(0,e.ue)),c+=e.ue}while(e.Qt>0||0===e.ce);return e.re(),n=new i(c),l.forEach((t=>{n.set(t,s),s+=t.length})),n}}lt.prototype={Yt:function(t,e){const n=this;return n.$t=new ct,e||(e=15),n.$t.Yt(n,t,e)},st:function(t){const e=this;return e.$t?e.$t.st(e,t):-2},re:function(){const t=this;if(!t.$t)return-2;const e=t.$t.re();return t.$t=null,e},ie:function(t,e){const n=this;return n.$t?n.$t.ie(n,t,e):-2},oe:function(t,e){const n=this;return n.$t?n.$t.oe(n,t,e):-2},Xt:function(t,e,n){const r=this;let i=r.Qt;return i>n&&(i=n),0===i?0:(r.Qt-=i,t.set(r.fe.subarray(r.le,r.le+i),e),r.le+=i,r.te+=i,i)},Nt:function(){const t=this;let e=t.$t.pending;e>t.ce&&(e=t.ce),0!==e&&(t.se.set(t.$t.qt.subarray(t.$t.ne,t.$t.ne+e),t.ue),t.ue+=e,t.$t.ne+=e,t.ee+=e,t.ce-=e,t.$t.pending-=e,0===t.$t.pending&&(t.$t.ne=0))}};const at=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],wt=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],ht=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],dt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],pt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],yt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],bt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function kt(){let t,e,n,r,i,o;function s(t,e,s,f,c,l,u,a,w,h,d){let p,y,b,k,g,v,m,S,z,_,I,A,C,V,B;_=0,g=s;do{n[t[e+_]]++,_++,g--}while(0!==g);if(n[0]==s)return u[0]=-1,a[0]=0,0;for(S=a[0],v=1;15>=v&&0===n[v];v++);for(m=v,v>S&&(S=v),g=15;0!==g&&0===n[g];g--);for(b=g,S>g&&(S=g),a[0]=S,V=1<<v;g>v;v++,V<<=1)if(0>(V-=n[v]))return-3;if(0>(V-=n[g]))return-3;for(n[g]+=V,o[1]=v=0,_=1,C=2;0!=--g;)o[C]=v+=n[_],C++,_++;g=0,_=0;do{0!==(v=t[e+_])&&(d[o[v]++]=g),_++}while(++g<s);for(s=o[b],o[0]=g=0,_=0,k=-1,A=-S,i[0]=0,I=0,B=0;b>=m;m++)for(p=n[m];0!=p--;){for(;m>A+S;){if(k++,A+=S,B=b-A,B=B>S?S:B,(y=1<<(v=m-A))>p+1&&(y-=p+1,C=m,B>v))for(;++v<B&&(y<<=1)>n[++C];)y-=n[C];if(B=1<<v,h[0]+B>1440)return-3;i[k]=I=h[0],h[0]+=B,0!==k?(o[k]=g,r[0]=v,r[1]=S,v=g>>>A-S,r[2]=I-i[k-1]-v,w.set(r,3*(i[k-1]+v))):u[0]=I}for(r[1]=m-A,s>_?d[_]<f?(r[0]=256>d[_]?0:96,r[2]=d[_++]):(r[0]=l[d[_]-f]+16+64,r[2]=c[d[_++]-f]):r[0]=192,y=1<<m-A,v=g>>>A;B>v;v+=y)w.set(r,3*(I+v));for(v=1<<m-1;0!=(g&v);v>>>=1)g^=v;for(g^=v,z=(1<<A)-1;(g&z)!=o[k];)k--,A-=S,z=(1<<A)-1}return 0!==V&&1!=b?-5:0}function c(s){let c;for(t||(t=[],e=[],n=new f(16),r=[],i=new f(15),o=new f(16)),e.length<s&&(e=[]),c=0;s>c;c++)e[c]=0;for(c=0;16>c;c++)n[c]=0;for(c=0;3>c;c++)r[c]=0;i.set(n.subarray(0,15),0),o.set(n.subarray(0,16),0)}this.ae=(n,r,i,o,f)=>{let l;return c(19),t[0]=0,l=s(n,0,19,19,null,null,i,r,o,t,e),-3==l?f.Zt="oversubscribed dynamic bit lengths tree":-5!=l&&0!==r[0]||(f.Zt="incomplete dynamic bit lengths tree",l=-3),l},this.we=(n,r,i,o,f,l,u,a,w)=>{let h;return c(288),t[0]=0,h=s(i,0,n,257,dt,pt,l,o,a,t,e),0!=h||0===o[0]?(-3==h?w.Zt="oversubscribed literal/length tree":-4!=h&&(w.Zt="incomplete literal/length tree",h=-3),h):(c(288),h=s(i,n,r,0,yt,bt,u,f,a,t,e),0!=h||0===f[0]&&n>257?(-3==h?w.Zt="oversubscribed distance tree":-5==h?(w.Zt="incomplete distance tree",h=-3):-4!=h&&(w.Zt="empty distance tree with lengths",h=-3),h):0)}}function gt(){const t=this;let e,n,r,i,o=0,s=0,f=0,c=0,l=0,u=0,a=0,w=0,h=0,d=0;function p(t,e,n,r,i,o,s,f){let c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z;d=f.le,p=f.Qt,w=s.he,h=s.de,y=s.write,b=y<s.read?s.read-y-1:s.end-y,k=at[t],g=at[e];do{for(;20>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(c=w&k,l=n,u=r,z=3*(u+c),0!==(a=l[z]))for(;;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15,v=l[z+2]+(w&at[a]),w>>=a,h-=a;15>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;for(c=w&g,l=i,u=o,z=3*(u+c),a=l[z];;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15;a>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(m=l[z+2]+(w&at[a]),w>>=a,h-=a,b-=v,m>y){S=y-m;do{S+=s.end}while(0>S);if(a=s.end-S,v>a){if(v-=a,y-S>0&&a>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--a);else s.ye.set(s.ye.subarray(S,S+a),y),y+=a,S+=a,a=0;S=0}}else S=y-m,y-S>0&&2>y-S?(s.ye[y++]=s.ye[S++],s.ye[y++]=s.ye[S++],v-=2):(s.ye.set(s.ye.subarray(S,S+2),y),y+=2,S+=2,v-=2);if(y-S>0&&v>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--v);else s.ye.set(s.ye.subarray(S,S+v),y),y+=v,S+=v,v=0;break}if(0!=(64&a))return f.Zt="invalid distance code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3;c+=l[z+2],c+=w&at[a],z=3*(u+c),a=l[z]}break}if(0!=(64&a))return 0!=(32&a)?(v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,1):(f.Zt="invalid literal/length code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3);if(c+=l[z+2],c+=w&at[a],z=3*(u+c),0===(a=l[z])){w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--;break}}else w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--}while(b>=258&&p>=10);return v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,0}t.init=(t,o,s,f,c,l)=>{e=0,a=t,w=o,r=s,h=f,i=c,d=l,n=null},t.be=(t,y,b)=>{let k,g,v,m,S,z,_,I=0,A=0,C=0;for(C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S;;)switch(e){case 0:if(z>=258&&m>=10&&(t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,b=p(a,w,r,h,i,d,t,y),C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S,0!=b)){e=1==b?7:9;break}f=a,n=r,s=h,e=1;case 1:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>>=n[g+1],A-=n[g+1],v=n[g],0===v){c=n[g+2],e=6;break}if(0!=(16&v)){l=15&v,o=n[g+2],e=2;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}if(0!=(32&v)){e=7;break}return e=9,y.Zt="invalid literal/length code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 2:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}o+=I&at[k],I>>=k,A-=k,f=w,n=i,s=d,e=3;case 3:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>=n[g+1],A-=n[g+1],v=n[g],0!=(16&v)){l=15&v,u=n[g+2],e=4;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}return e=9,y.Zt="invalid distance code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 4:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}u+=I&at[k],I>>=k,A-=k,e=5;case 5:for(_=S-u;0>_;)_+=t.end;for(;0!==o;){if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);t.ye[S++]=t.ye[_++],z--,_==t.end&&(_=0),o--}e=0;break;case 6:if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,t.ye[S++]=c,z--,e=0;break;case 7:if(A>7&&(A-=8,m++,C--),t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,t.read!=t.write)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);e=8;case 8:return b=1,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 9:return b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);default:return b=-2,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b)}},t.ge=()=>{}}kt.ve=(t,e,n,r)=>(t[0]=9,e[0]=5,n[0]=wt,r[0]=ht,0);const vt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function mt(t,e){const n=this;let r,o=0,s=0,c=0,l=0;const u=[0],a=[0],w=new gt;let h=0,d=new f(4320);const p=new kt;n.de=0,n.he=0,n.ye=new i(e),n.end=e,n.read=0,n.write=0,n.reset=(t,e)=>{e&&(e[0]=0),6==o&&w.ge(t),o=0,n.de=0,n.he=0,n.read=n.write=0},n.reset(t,null),n.ke=(t,e)=>{let r,i,o;return i=t.ue,o=n.read,r=(o>n.write?n.end:n.write)-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r,o==n.end&&(o=0,n.write==n.end&&(n.write=0),r=n.write-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r),t.ue=i,n.read=o,e},n.be=(t,e)=>{let i,f,y,b,k,g,v,m;for(b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g;;){let S,z,_,I,A,C,V,B;switch(o){case 0:for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}switch(i=7&f,h=1&i,i>>>1){case 0:f>>>=3,y-=3,i=7&y,f>>>=i,y-=i,o=1;break;case 1:S=[],z=[],_=[[]],I=[[]],kt.ve(S,z,_,I),w.init(S[0],z[0],_[0],0,I[0],0),f>>>=3,y-=3,o=6;break;case 2:f>>>=3,y-=3,o=3;break;case 3:return f>>>=3,y-=3,o=9,t.Zt="invalid block type",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}break;case 1:for(;32>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if((~f>>>16&65535)!=(65535&f))return o=9,t.Zt="invalid stored block lengths",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);s=65535&f,f=y=0,o=0!==s?2:0!==h?7:0;break;case 2:if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(0===v&&(g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v&&(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v)))return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(e=0,i=s,i>k&&(i=k),i>v&&(i=v),n.ye.set(t.Xt(b,i),g),b+=i,k-=i,g+=i,v-=i,0!=(s-=i))break;o=0!==h?7:0;break;case 3:for(;14>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(c=i=16383&f,(31&i)>29||(i>>5&31)>29)return o=9,t.Zt="too many length or distance symbols",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(i=258+(31&i)+(i>>5&31),!r||r.length<i)r=[];else for(m=0;i>m;m++)r[m]=0;f>>>=14,y-=14,l=0,o=4;case 4:for(;4+(c>>>10)>l;){for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}r[vt[l++]]=7&f,f>>>=3,y-=3}for(;19>l;)r[vt[l++]]=0;if(u[0]=7,i=p.ae(r,u,a,d,t),0!=i)return-3==(e=i)&&(r=null,o=9),n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);l=0,o=5;case 5:for(;i=c,258+(31&i)+(i>>5&31)>l;){let s,w;for(i=u[0];i>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(i=d[3*(a[0]+(f&at[i]))+1],w=d[3*(a[0]+(f&at[i]))+2],16>w)f>>>=i,y-=i,r[l++]=w;else{for(m=18==w?7:w-14,s=18==w?11:3;i+m>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(f>>>=i,y-=i,s+=f&at[m],f>>>=m,y-=m,m=l,i=c,m+s>258+(31&i)+(i>>5&31)||16==w&&1>m)return r=null,o=9,t.Zt="invalid bit length repeat",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w=16==w?r[m-1]:0;do{r[m++]=w}while(0!=--s);l=m}}if(a[0]=-1,A=[],C=[],V=[],B=[],A[0]=9,C[0]=6,i=c,i=p.we(257+(31&i),1+(i>>5&31),r,A,C,V,B,d,t),0!=i)return-3==i&&(r=null,o=9),e=i,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w.init(A[0],C[0],d,V[0],d,B[0]),o=6;case 6:if(n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,1!=(e=w.be(n,t,e)))return n.ke(t,e);if(e=0,w.ge(t),b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g,0===h){o=0;break}o=7;case 7:if(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,n.read!=n.write)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);o=8;case 8:return e=1,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);case 9:return e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);default:return e=-2,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}}},n.ge=t=>{n.reset(t,null),n.ye=null,d=null},n.me=(t,e,r)=>{n.ye.set(t.subarray(e,e+r),0),n.read=n.write=r},n.Se=()=>1==o?1:0}const St=[0,0,255,255];function zt(){const t=this;function e(t){return t&&t.ze?(t.te=t.ee=0,t.Zt=null,t.ze.mode=7,t.ze._e.reset(t,null),0):-2}t.mode=0,t.method=0,t.Ie=[0],t.Ae=0,t.marker=0,t.Ce=0,t.Ve=e=>(t._e&&t._e.ge(e),t._e=null,0),t.Be=(n,r)=>(n.Zt=null,t._e=null,8>r||r>15?(t.Ve(n),-2):(t.Ce=r,n.ze._e=new mt(n,1<<r),e(n),0)),t.it=(t,e)=>{let n,r;if(!t||!t.ze||!t.fe)return-2;const i=t.ze;for(e=4==e?-5:0,n=-5;;)switch(i.mode){case 0:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,8!=(15&(i.method=t.pe(t.le++)))){i.mode=13,t.Zt="unknown compression method",i.marker=5;break}if(8+(i.method>>4)>i.Ce){i.mode=13,t.Zt="invalid win size",i.marker=5;break}i.mode=1;case 1:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,r=255&t.pe(t.le++),((i.method<<8)+r)%31!=0){i.mode=13,t.Zt="incorrect header check",i.marker=5;break}if(0==(32&r)){i.mode=7;break}i.mode=2;case 2:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae=(255&t.pe(t.le++))<<24&4278190080,i.mode=3;case 3:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<16&16711680,i.mode=4;case 4:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<8&65280,i.mode=5;case 5:return 0===t.Qt?n:(n=e,t.Qt--,t.te++,i.Ae+=255&t.pe(t.le++),i.mode=6,2);case 6:return i.mode=13,t.Zt="need dictionary",i.marker=0,-2;case 7:if(n=i._e.be(t,n),-3==n){i.mode=13,i.marker=0;break}if(0==n&&(n=e),1!=n)return n;n=e,i._e.reset(t,i.Ie),i.mode=12;case 12:return t.Qt=0,1;case 13:return-3;default:return-2}},t.Ee=(t,e,n)=>{let r=0,i=n;if(!t||!t.ze||6!=t.ze.mode)return-2;const o=t.ze;return i<1<<o.Ce||(i=(1<<o.Ce)-1,r=n-i),o._e.me(e,r,i),o.mode=7,0},t.De=t=>{let n,r,i,o,s;if(!t||!t.ze)return-2;const f=t.ze;if(13!=f.mode&&(f.mode=13,f.marker=0),0===(n=t.Qt))return-5;for(r=t.le,i=f.marker;0!==n&&4>i;)t.pe(r)==St[i]?i++:i=0!==t.pe(r)?0:4-i,r++,n--;return t.te+=r-t.le,t.le=r,t.Qt=n,f.marker=i,4!=i?-3:(o=t.te,s=t.ee,e(t),t.te=o,t.ee=s,f.mode=7,0)},t.Ue=t=>t&&t.ze&&t.ze._e?t.ze._e.Se():-2}function _t(){}function It(t){const e=new _t,o=t&&t.rt?n.floor(2*t.rt):131072,s=new i(o);let f=!1;e.Be(),e.se=s,this.append=(t,n)=>{const c=[];let l,u,a=0,w=0,h=0;if(0!==t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,0!==e.Qt||f||(e.le=0,f=!0),l=e.it(0),f&&-5===l){if(0!==e.Qt)throw new r("inflating: bad input")}else if(0!==l&&1!==l)throw new r("inflating: "+e.Zt);if((f||1===l)&&e.Qt===t.length)throw new r("inflating: bad input");e.ue&&(e.ue===o?c.push(new i(s)):c.push(s.slice(0,e.ue))),h+=e.ue,n&&e.le>0&&e.le!=a&&(n(e.le),a=e.le)}while(e.Qt>0||0===e.ce);return c.length>1?(u=new i(h),c.forEach((t=>{u.set(t,w),w+=t.length}))):u=c[0]||new i(0),u}},this.flush=()=>{e.Ve()}}_t.prototype={Be:function(t){const e=this;return e.ze=new zt,t||(t=15),e.ze.Be(e,t)},it:function(t){const e=this;return e.ze?e.ze.it(e,t):-2},Ve:function(){const t=this;if(!t.ze)return-2;const e=t.ze.Ve(t);return t.ze=null,e},De:function(){const t=this;return t.ze?t.ze.De(t):-2},Ee:function(t,e){const n=this;return n.ze?n.ze.Ee(n,t,e):-2},pe:function(t){return this.fe[t]},Xt:function(t,e){return this.fe.subarray(t,t+e)}},self.initCodec=()=>{self.Deflate=ut,self.Inflate=It};
`],{type:"text/javascript"}));t({workerScripts:{inflate:[e],deflate:[e]}})}};var im=class{constructor(){this.size=0}init(){this.initialized=!0}},Ku=class extends im{},am=class extends im{writeUint8Array(e){this.size+=e.length}};var Yl=class extends Ku{constructor(e){super(),this.array=e,this.size=e.length}readUint8Array(e,r){return this.array.slice(e,e+r)}},zs=class extends am{constructor(){super(),this.array=new Uint8Array(0)}writeUint8Array(e){super.writeUint8Array(e);let r=this.array;this.array=new Uint8Array(r.length+e.length),this.array.set(r),this.array.set(e,r.length)}getData(){return this.array}};var mA="/",aM=new Date(2107,11,31),sM=new Date(1980,0,1);var lM="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0 ".split(""),i1=t=>{let e="";for(let r=0;r<t.length;r++)e+=lM[t[r]];return e};var sm=cM;function cM(t,e){if(e&&e.trim().toLowerCase()=="cp437")return i1(t);if(typeof TextDecoder>"u"){let r=new FileReader;return new Promise((n,o)=>{r.onload=i=>n(i.target.result),r.onerror=()=>o(r.error),r.readAsText(new Blob([t]))})}else return new TextDecoder(e).decode(t)}var gA="Abort error";async function SA(t,e,r,n,o,i,a){let s=Math.max(i.chunkSize,64);return l();async function l(c=0,d=0){let u=a.signal,p=o();if(c<p){fA(u,t);let _=await e.readUint8Array(c+n,Math.min(s,p-c)),h=_.length;fA(u,t);let A=await t.append(_);if(fA(u,t),d+=await a1(r,A),a.onprogress)try{a.onprogress(c+h,p)}catch{}return l(c+s,d)}else{let _=await t.flush();return d+=await a1(r,_.data),{signature:_.signature,length:d}}}}function fA(t,e){if(t&&t.aborted)throw e.abort(),new Error(gA)}async function a1(t,e){return e.length&&await t.writeUint8Array(e),e.length}var dM=["filename","rawFilename","directory","encrypted","compressedSize","uncompressedSize","lastModDate","rawLastModDate","comment","rawComment","signature","extraField","rawExtraField","bitFlag","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","filenameUTF8","commentUTF8","offset","zip64","compressionMethod","extraFieldNTFS","lastAccessDate","creationDate","extraFieldExtendedTimestamp","version","versionMadeBy","msDosCompatible","internalFileAttribute","externalFileAttribute"],Ql=class{constructor(e){dM.forEach(r=>this[r]=e[r])}};var lm="File format is not recognized",I1="End of central directory not found",R1="End of Zip64 central directory not found",y1="End of Zip64 central directory locator not found",v1="Central directory header not found",C1="Local file header not found",O1="Zip64 extra field not found",b1="File contains encrypted entry",N1="Encryption method not supported",PA="Compression method not supported",s1="utf-8",l1="cp437",c1=["uncompressedSize","compressedSize","offset"],ql=class{constructor(e,r={}){Object.assign(this,{reader:e,options:r,config:tA()})}async*getEntriesGenerator(e={}){let r=this,n=r.reader;if(n.initialized||await n.init(),n.size<22)throw new Error(lm);let o=await SM(n,101010256,n.size,22,65535*16);if(!o)throw new Error(I1);let i=_o(o),a=Kn(i,12),s=Kn(i,16),l=vi(i,8),c=0;if(s==4294967295||a==4294967295||l==65535){let _=await Ws(n,o.offset-20,20),h=_o(_);if(Kn(h,0)!=117853008)throw new Error(R1);s=cm(h,8);let A=await Ws(n,s,56),m=_o(A),g=o.offset-20-56;if(Kn(m,0)!=101075792&&s!=g){let S=s;s=g,c=s-S,A=await Ws(n,s,56),m=_o(A)}if(Kn(m,0)!=101075792)throw new Error(y1);l=cm(m,32),a=cm(m,40),s-=a}if(s<0||s>=n.size)throw new Error(lm);let d=0,u=await Ws(n,s,a),p=_o(u);if(a){let _=o.offset-a;if(Kn(p,d)!=33639248&&s!=_){let h=s;s=_,c=s-h,u=await Ws(n,s,a),p=_o(u)}}if(s<0||s>=n.size)throw new Error(lm);for(let _=0;_<l;_++){let h=new FA(n,r.config,r.options);if(Kn(p,d)!=33639248)throw new Error(v1);P1(h,p,d+6);let A=!!h.bitFlag.languageEncodingFlag,m=d+46,g=m+h.filenameLength,S=g+h.extraFieldLength,R=vi(p,d+4),E=(R&0)==0;Object.assign(h,{versionMadeBy:R,msDosCompatible:E,compressedSize:0,uncompressedSize:0,commentLength:vi(p,d+32),directory:E&&(Xc(p,d+38)&16)==16,offset:Kn(p,d+42)+c,internalFileAttribute:Kn(p,d+34),externalFileAttribute:Kn(p,d+38),rawFilename:u.subarray(m,g),filenameUTF8:A,commentUTF8:A,rawExtraField:u.subarray(g,S)});let P=S+h.commentLength;h.rawComment=u.subarray(S,P);let T=qc(r,e,"filenameEncoding"),f=qc(r,e,"commentEncoding"),[y,v]=await Promise.all([sm(h.rawFilename,h.filenameUTF8?s1:T||l1),sm(h.rawComment,h.commentUTF8?s1:f||l1)]);h.filename=y,h.comment=v,!h.directory&&h.filename.endsWith(mA)&&(h.directory=!0),await F1(h,h,p,d+6);let w=new Ql(h);if(w.getData=(I,C)=>h.getData(I,w,C),d=P,e.onprogress)try{e.onprogress(_+1,l,new Ql(h))}catch{}yield w}return!0}async getEntries(e={}){let r=[],n=this.getEntriesGenerator(e),o=n.next();for(;!(await o).done;)r.push((await o).value),o=n.next();return r}async close(){}};var FA=class{constructor(e,r,n){Object.assign(this,{reader:e,config:r,options:n})}async getData(e,r,n={}){let o=this,{reader:i,offset:a,extraFieldAES:s,compressionMethod:l,config:c,bitFlag:d,signature:u,rawLastModDate:p,compressedSize:_}=o,h=o.localDirectory={};i.initialized||await i.init();let A=await Ws(i,a,30),m=_o(A),g=qc(o,n,"password");if(g=g&&g.length&&g,s&&s.originalCompressionMethod!=99)throw new Error(PA);if(l!=0&&l!=8)throw new Error(PA);if(Kn(m,0)!=67324752)throw new Error(C1);P1(h,m,4),A=await Ws(i,a,30+h.filenameLength+h.extraFieldLength),h.rawExtraField=A.subarray(30+h.filenameLength),await F1(o,h,m,4),r.lastAccessDate=h.lastAccessDate,r.creationDate=h.creationDate;let S=o.encrypted&&h.encrypted,R=S&&!s;if(S){if(!R&&s.strength===void 0)throw new Error(N1);if(!g)throw new Error(b1)}let E=await hA(c.Inflate,{codecType:nm,password:g,zipCrypto:R,encryptionStrength:s&&s.strength,signed:qc(o,n,"checkSignature"),passwordVerification:R&&(d.dataDescriptor?p>>>8&255:u>>>24&255),signature:u,compressed:l!=0,encrypted:S,useWebWorkers:qc(o,n,"useWebWorkers")},c);e.initialized||await e.init();let P=qc(o,n,"signal"),T=a+30+h.filenameLength+h.extraFieldLength;return await SA(E,i,e,T,()=>_,c,{onprogress:n.onprogress,signal:P}),e.getData()}};function P1(t,e,r){let n=t.rawBitFlag=vi(e,r+2),o=(n&1)==1,i=Kn(e,r+6);Object.assign(t,{encrypted:o,version:vi(e,r),bitFlag:{level:(n&6)>>1,dataDescriptor:(n&8)==8,languageEncodingFlag:(n&2048)==2048},rawLastModDate:i,lastModDate:AM(i),filenameLength:vi(e,r+22),extraFieldLength:vi(e,r+24)})}async function F1(t,e,r,n){let o=e.rawExtraField,i=e.extraField=new Map,a=_o(new Uint8Array(o)),s=0;try{for(;s<o.length;){let A=vi(a,s),m=vi(a,s+2);i.set(A,{type:A,data:o.slice(s+4,s+4+m)}),s+=4+m}}catch{}let l=vi(r,n+4);e.signature=Kn(r,n+10),e.uncompressedSize=Kn(r,n+18),e.compressedSize=Kn(r,n+14);let c=i.get(1);c&&(hM(c,e),e.extraFieldZip64=c);let d=i.get(28789);d&&(await d1(d,"filename","rawFilename",e,t),e.extraFieldUnicodePath=d);let u=i.get(25461);u&&(await d1(u,"comment","rawComment",e,t),e.extraFieldUnicodeComment=u);let p=i.get(39169);p?(mM(p,e,l),e.extraFieldAES=p):e.compressionMethod=l;let _=i.get(10);_&&(fM(_,e),e.extraFieldNTFS=_);let h=i.get(21589);h&&(gM(h,e),e.extraFieldExtendedTimestamp=h)}function hM(t,e){e.zip64=!0;let r=_o(t.data);t.values=[];for(let o=0;o<Math.floor(t.data.length/8);o++)t.values.push(cm(r,0+o*8));let n=c1.filter(o=>e[o]==4294967295);for(let o=0;o<n.length;o++)t[n[o]]=t.values[o];c1.forEach(o=>{if(e[o]==4294967295)if(t[o]!==void 0)e[o]=t[o];else throw new Error(O1)})}async function d1(t,e,r,n,o){let i=_o(t.data);t.version=Xc(i,0),t.signature=Kn(i,1);let a=new ks;a.append(o[r]);let s=_o(new Uint8Array(4));s.setUint32(0,a.get(),!0),t[e]=await sm(t.data.subarray(5)),t.valid=!o.bitFlag.languageEncodingFlag&&t.signature==Kn(s,0),t.valid&&(n[e]=t[e],n[e+"UTF8"]=!0)}function mM(t,e,r){let n=_o(t.data);t.vendorVersion=Xc(n,0),t.vendorId=Xc(n,2);let o=Xc(n,4);t.strength=o,t.originalCompressionMethod=r,e.compressionMethod=t.compressionMethod=vi(n,5)}function fM(t,e){let r=_o(t.data),n=4,o;try{for(;n<t.data.length&&!o;){let i=vi(r,n),a=vi(r,n+2);i==1&&(o=t.data.slice(n+4,n+4+a)),n+=4+a}}catch{}try{if(o&&o.length==24){let i=_o(o),a=i.getBigUint64(0,!0),s=i.getBigUint64(8,!0),l=i.getBigUint64(16,!0);Object.assign(t,{rawLastModDate:a,rawLastAccessDate:s,rawCreationDate:l});let c=EA(a),d=EA(s),u=EA(l),p={lastModDate:c,lastAccessDate:d,creationDate:u};Object.assign(t,p),Object.assign(e,p)}}catch{}}function gM(t,e){let r=_o(t.data),n=Xc(r,0),o=[],i=[];(n&1)==1&&(o.push("lastModDate"),i.push("rawLastModDate")),(n&2)==2&&(o.push("lastAccessDate"),i.push("rawLastAccessDate")),(n&4)==4&&(o.push("creationDate"),i.push("rawCreationDate"));let a=1;o.forEach((s,l)=>{if(t.data.length>=a+4){let c=Kn(r,a);e[s]=t[s]=new Date(c*1e3);let d=i[l];t[d]=c}a+=4})}async function SM(t,e,r,n,o){let i=new Uint8Array(4),a=_o(i);TM(a,0,e);let s=n+o;return await l(n)||await l(Math.min(s,r));async function l(c){let d=r-c,u=await Ws(t,d,c);for(let p=u.length-n;p>=0;p--)if(u[p]==i[0]&&u[p+1]==i[1]&&u[p+2]==i[2]&&u[p+3]==i[3])return{offset:d+p,buffer:u.slice(p,p+n).buffer}}}function qc(t,e,r){return e[r]===void 0?t.options[r]:e[r]}function AM(t){let e=(t&4294901760)>>16,r=t&65535;try{return new Date(1980+((e&65024)>>9),((e&480)>>5)-1,e&31,(r&63488)>>11,(r&2016)>>5,(r&31)*2,0)}catch{}}function EA(t){return new Date(Number(t/BigInt(1e4)-BigInt(116444736e5)))}function Xc(t,e){return t.getUint8(e)}function vi(t,e){return t.getUint16(e,!0)}function Kn(t,e){return t.getUint32(e,!0)}function cm(t,e){return Number(t.getBigUint64(e,!0))}function TM(t,e,r){t.setUint32(e,r,!0)}function _o(t){return new DataView(t.buffer)}function Ws(t,e,r){return t.readUint8Array(e,r)}var I8=new Uint8Array([7,0,2,0,65,69,3,0,0]);var O8=512*1024;var PM={},w1;try{w1=PM.url}catch{}Wc({baseURL:w1});o1(Wc);Wc({Deflate:_N,Inflate:LN});var Qu,as,wA,DA={env:{emscripten_notify_memory_growth:function(t){wA=new Uint8Array(as.exports.memory.buffer)}}},dm=class{init(){return Qu||(typeof fetch<"u"?Qu=fetch("data:application/wasm;base64,"+x1).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,DA)).then(this._init):Qu=WebAssembly.instantiate(Buffer.from(x1,"base64"),DA).then(this._init),Qu)}_init(e){as=e.instance,DA.env.emscripten_notify_memory_growth(0)}decode(e,r=0){if(!as)throw new Error("ZSTDDecoder: Await .init() before decoding.");let n=e.byteLength,o=as.exports.malloc(n);wA.set(e,o),r=r||Number(as.exports.ZSTD_findDecompressedSize(o,n));let i=as.exports.malloc(r),a=as.exports.ZSTD_decompress(i,r,o,n),s=wA.slice(i,i+a);return as.exports.free(o),as.exports.free(i),s}},x1="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";var Pe=class t{asVolatileEffect(){return null}isVolatile(){return!1}blendMode(){return this._blendMode}color(){return this._color}secondaryColor(){return this._secondaryColor}blurOffset(){return this._blurOffset}blurStartOffset(){return this._blurStartOffset}blurEndOffset(){return this._blurEndOffset}blurStartRadius(){return this._blurStartRadius}blurRadius(){return this._blurRadius}noiseSize(){return this._noiseSize}clipToShape(){return this._clipToShape}blurOpType(){return this._blurOpType}spread(){return this._spread}density(){return this._density}noiseType(){return this._noiseType}isEnabled(){return this._isEnabled}showShadowBehindNode(){return this._showShadowBehindNode}type(){return this._type}effectOpacity(){return this._effectOpacity}seed(){return this._seed}refractionIntensity(){return this._refractionIntensity}refractionDistance(){return this._refractionDistance}specularAngle(){return this._specularAngle}specularIntensity(){return this._specularIntensity}chromaticAberration(){return this._chromaticAberration}reflectionDistance(){return this._reflectionDistance}bevelSize(){return this._bevelSize}setBlendMode(e){this._blendMode=e}setBlurOpType(e){this._blurOpType=e}setColor(e){this._color=e}setSecondaryColor(e){this._secondaryColor=e}setBlurOffset(e){this._blurOffset=e}setBlurOffset1(e){this._blurOffset=e.clone()}setBlurStartOffset(e){this._blurStartOffset=e}setBlurStartOffset1(e){this._blurStartOffset=e.clone()}setBlurEndOffset(e){this._blurEndOffset=e}setBlurEndOffset1(e){this._blurEndOffset=e.clone()}setBlurStartRadius(e){this._blurStartRadius=e}setBlurRadius(e){this._blurRadius=e}setSpread(e){this._spread=e}setIsEnabled(e){this._isEnabled=e}setShowShadowBehindNode(e){this._showShadowBehindNode=e}setNoiseSize(e){this._noiseSize=e}setDensity(e){this._density=e}setNoiseType(e){this._noiseType=e}setClipToShape(e){this._clipToShape=e}setEffectOpacity(e){this._effectOpacity=e}setSeed(e){this._seed=e}setType(e){this._type=e}setRefractionIntensity(e){this._refractionIntensity=e}setRefractionDistance(e){this._refractionDistance=e}setSpecularAngle(e){this._specularAngle=e}setSpecularIntensity(e){this._specularIntensity=e}setChromaticAberration(e){this._chromaticAberration=e}setReflectionDistance(e){this._reflectionDistance=e}setBevelSize(e){this._bevelSize=e}dependsOnBackgroundContent(){return this.type()==="BACKGROUND_BLUR"||this.type()==="GLASS"}clone(){let e=new t;return e.setBlendMode(this.blendMode()),e.setColor(this.color()),e.setSecondaryColor(this.secondaryColor()),e.setBlurOffset1(this.blurOffset().clone()),e.setBlurStartOffset1(this.blurStartOffset().clone()),e.setBlurEndOffset1(this.blurEndOffset().clone()),e.setBlurStartRadius(this.blurStartRadius()),e.setBlurRadius(this.blurRadius()),e.setBlurOpType(this.blurOpType()),e.setSpread(this.spread()),e.setIsEnabled(this.isEnabled()),e.setShowShadowBehindNode(this.showShadowBehindNode()),e.setNoiseSize(this.noiseSize().clone()),e.setDensity(this.density()),e.setNoiseType(this.noiseType()),e.setType(this.type()),e.setNoiseSize(this.noiseSize()),e.setClipToShape(this.clipToShape()),e.setEffectOpacity(this.effectOpacity()),e.setSeed(this.seed()),e.setRefractionIntensity(this.refractionIntensity()),e.setRefractionDistance(this.refractionDistance()),e.setSpecularAngle(this.specularAngle()),e.setSpecularIntensity(this.specularIntensity()),e.setChromaticAberration(this.chromaticAberration()),e.setReflectionDistance(this.reflectionDistance()),e.setBevelSize(this.bevelSize()),e}isVisibleForRendering(){switch(this.type()){case"DROP_SHADOW":return this.isEnabled()&&N.alpha(this.color())>0;case"INNER_SHADOW":return this.isEnabled()&&N.alpha(this.color())>0&&(this.blurRadius()>0||this.blurOffset().x()!=0||this.blurOffset().y()!=0||this.spread()>0);case"BACKGROUND_BLUR":case"FOREGROUND_BLUR":return this.isEnabled()&&(this.blurRadius()>0||this.blurStartRadius()>0);case"GRAIN":return this.isEnabled()&&this.blurRadius()>0;case"NOISE":return this.isEnabled();case"GLASS":return this.isEnabled()}return!1}isEnabledAndVisible(){return this.isEnabled()&&N.alpha(this.color())>0}equalsWithinEffectType(e){if(this.isEnabled()!=e.isEnabled()||this.type()!=e.type())return!1;switch(this.type()){case"INNER_SHADOW":return this.blendMode()==e.blendMode()&&this.blurOffset().equals(e.blurOffset())&&this.blurRadius()==e.blurRadius()&&this.color()==e.color()&&this.spread()==e.spread();case"DROP_SHADOW":return this.blendMode()==e.blendMode()&&this.blurOffset().equals(e.blurOffset())&&this.blurRadius()==e.blurRadius()&&this.color()==e.color()&&this.spread()==e.spread()&&this.showShadowBehindNode()==e.showShadowBehindNode();case"FOREGROUND_BLUR":case"BACKGROUND_BLUR":if(this.blurOpType()!=e.blurOpType())return!1;if(this.blurOpType()==="NORMAL")return this.blurRadius()==e.blurRadius()&&e.blurOpType()==="NORMAL";if(this.blurOpType()=="PROGRESSIVE")return e.blurOpType()==="PROGRESSIVE"&&this.blurStartRadius()==e.blurStartRadius()&&this.blurRadius()==e.blurRadius()&&this.blurStartOffset().equals(e.blurStartOffset())&&this.blurEndOffset().equals(e.blurEndOffset());case"GRAIN":return this.noiseSize().equals(e.noiseSize())&&this.clipToShape()==e.clipToShape()&&this.blurRadius()==e.blurRadius()&&this.seed()==e.seed();case"NOISE":return this.noiseSize().equals(e.noiseSize())&&this.noiseType()==e.noiseType()&&this.blendMode()==e.blendMode()&&this.density()==e.density()&&this.color()==e.color()&&this.secondaryColor()==e.secondaryColor()&&this.seed()==e.seed();case"REPEAT":case"SYMMETRY":return!1;case"GLASS":return this.reflectionDistance()==e.reflectionDistance()&&this.refractionIntensity()==e.refractionIntensity()&&this.refractionDistance()==e.refractionDistance()&&this.specularIntensity()==e.specularIntensity()&&this.specularAngle()==e.specularAngle()&&this.bevelSize()==e.bevelSize()&&this.chromaticAberration()==e.chromaticAberration()&&this.blurRadius()==e.blurRadius()&&this.secondaryColor()==e.secondaryColor()}return!1}static createForegroundBlur(e,r,n,o){let i=new t;return i.setType("FOREGROUND_BLUR"),i.setBlurRadius(e),r!==void 0&&i.setBlurStartRadius(r),n!==void 0&&i.setBlurEndOffset1(n),o!==void 0&&i.setBlurStartOffset1(o),i}static createBackgroundBlur(e,r,n,o){let i=new t;return i.setType("BACKGROUND_BLUR"),i.setBlurRadius(e),r!==void 0&&i.setBlurStartRadius(r),n!==void 0&&i.setBlurEndOffset1(n),o!==void 0&&i.setBlurStartOffset1(o),i}static createInnerShadow(e,r,n,o){let i=new t;return i.setType("INNER_SHADOW"),i.setBlurRadius(e),i.setBlurOffset(r),i.setColor(N.withAlpha(n,Math.ceil(o*255))),i}static createDropShadow(e,r,n,o,i=0,a=!0){let s=new t;return s.setType("DROP_SHADOW"),s.setBlurRadius(e),s.setBlurOffset(r),s.setColor(N.multiplyOpacity(n,o)),s.setSpread(i),s.setShowShadowBehindNode(a),s}static createGrain(e,r,n,o){let i=new t;return i.setType("GRAIN"),i.setNoiseSize(e),i.setClipToShape(r),i.setBlurRadius(n),i.setSeed(o),i}static createNoise(e,r,n,o,i,a,s,l){let c=new t;return c.setType("NOISE"),c.setNoiseType(e),c.setBlendMode(r),c.setNoiseSize(n),c.setDensity(o),c.setColor(N.multiplyOpacity(i,s)),c.setSecondaryColor(N.multiplyOpacity(a,s)),c.setSeed(l),c}constructor(){this._blendMode="NORMAL",this._color=N.TRANSPARENT,this._blurOffset=ge.FrozenVector_ZERO,this._blurRadius=0,this._blurStartRadius=0,this._blurStartOffset=ge.FrozenVector_ZERO,this._blurEndOffset=ge.FrozenVector_ZERO,this._spread=0,this._isEnabled=!0,this._showShadowBehindNode=!1,this._noiseType="MONOTONE",this._noiseSize=ge.FrozenVector_ZERO,this._clipToShape=!1,this._type="DROP_SHADOW",this._blurOpType="NORMAL",this._seed=0,this._refractionIntensity=0,this._refractionDistance=0,this._specularAngle=0,this._specularIntensity=0,this._chromaticAberration=0,this._reflectionDistance=0,this._bevelSize=0}},um=class t extends Pe{constructor(e,r,n,o,i,a,s){super(),this._from=null,this._to=null,this._getEasedT=null,this._from=e,this._to=r,this._fromSize=n,this._toSize=o,this._fromCornerRadii=i,this._toCornerRadii=a,this._getEasedT=s}t(){return this._getEasedT()}from(){return this._from}to(){return this._to}fromNodeSize(){return this._fromSize}toNodeSize(){return this._toSize}cornerRadius(){return this._fromCornerRadii.topLeft==this._toCornerRadii.topLeft?-1:xt.double_lerp(this._fromCornerRadii.topLeft,this._toCornerRadii.topLeft,this.t())}textureRadius(){return 0}centerPoint(){return O.lerp(this.fromNodeSize().divideScalar(2),this.toNodeSize().divideScalar(2),this.t())}blurRadius(){return xt.double_lerp(this.from().blurRadius(),this.to().blurRadius(),this.t())}blurStartRadius(){return xt.double_lerp(this.from().blurStartRadius(),this.to().blurStartRadius(),this.t())}blurEndOffsetInCanvasSpace(e,r){return O.lerp(e,r,this.t())}blurStartOffsetInCanvasSpace(e,r){return O.lerp(e,r,this.t())}blurEndOffset(){return O.lerp(this.from().blurEndOffset(),this.to().blurEndOffset(),this.t())}blurStartOffset(){return O.lerp(this.from().blurStartOffset(),this.to().blurStartOffset(),this.t())}blurOpType(){return this.from().blurOpType()}noiseSize(){return O.lerp(this.from().noiseSize(),this.to().noiseSize(),this.t())}seed(){return this.from().seed()}refractionIntensity(){return xt.double_lerp(this.from().refractionIntensity(),this.to().refractionIntensity(),this.t())}refractionDistance(){return xt.double_lerp(this.from().refractionDistance(),this.to().refractionDistance(),this.t())}specularIntensity(){return xt.double_lerp(this.from().specularIntensity(),this.to().specularIntensity(),this.t())}specularAngle(){return xt.double_lerp(this.from().specularAngle(),this.to().specularAngle(),this.t())}bevelSize(){return xt.double_lerp(this.from().bevelSize(),this.to().bevelSize(),this.t())}chromaticAberration(){return xt.double_lerp(this.from().chromaticAberration(),this.to().chromaticAberration(),this.t())}reflectionDistance(){return xt.double_lerp(this.from().reflectionDistance(),this.to().reflectionDistance(),this.t())}noiseType(){return this.from().noiseType()}density(){return xt.double_lerp(this.from().density(),this.to().density(),this.t())}clipToShape(){return this.from().clipToShape()}isVolatile(){return!0}asVolatileEffect(){return this}cloneAsVolatileEffect(){return new t(this._from.clone(),this._to.clone(),this._fromSize,this._toSize,this._fromCornerRadii,this._toCornerRadii,this._getEasedT)}isEnabled(){return this._from.isEnabled()||this._to.isEnabled()}isVisible(){return this.isEnabled()&&(N.alpha(this._from.color())>0||N.alpha(this._to.color())>0)}type(){return this._from.type()}blendMode(){return this._from.blendMode()}color(){let e=this._from.color(),r=this._to.color();return this.noiseType()==="MULTITONE"&&(e=N.new3(N.redF(e),N.greenF(e),N.blueF(e),this._from.effectOpacity()),r=N.new3(N.redF(r),N.greenF(r),N.blueF(r),this._to.effectOpacity())),N.mix(e,r,this.t())}secondaryColor(){return N.mix(this._from.secondaryColor(),this._to.secondaryColor(),this.t())}static create(e,r,n,o,i,a,s){return new t(e,r,n,o,i,a,s)}};var ho=class{constructor(e,r){this.a=e,this.b=r}};var pm=class t{constructor(){this._type="REPEAT",this._offset=ge.FrozenVector_ZERO,this._visible=!0}type(){return this._type}offset(){return this._offset}count(){return this._count}repeatType(){return this._repeatType}axis(){return this._axis}unitType(){return this._unitType}order(){return this._order}skewX(){return this._skewX}skewY(){return this._skewY}visible(){return this._visible}setType(e){this._type=e}setOffset(e){this._offset=e}setCount(e){this._count=e}setRepeatType(e){this._repeatType=e}setAxis(e){this._axis=e}setUnitType(e){this._unitType=e}setOrder(e){this._order=e}setSkewX(e){this._skewX=e}setSkewY(e){this._skewY=e}setVisible(e){this._visible=e}shouldRender(){if(!this._visible)return!1;switch(this._type){case"REPEAT":return this._count!==void 0&&this._count>1&&this._repeatType!==void 0;case"SYMMETRY":return this._axis!==void 0;case"SKEW":return this._skewX!==void 0||this._skewY!==void 0}}isRepeat(){return this._type==="REPEAT"}isVisibleForRendering(){return this.type()==="REPEAT"?this.visible():(this.type()==="SYMMETRY"||this.type()==="SKEW",!1)}clone(){let e=new t;return e.setType(this.type()),e.setOffset(this.offset().clone()),e.setCount(this.count()),e.setRepeatType(this.repeatType()),e.setAxis(this.axis()),e.setUnitType(this.unitType()),e.setOrder(this.order()),e.setSkewX(this.skewX()),e.setSkewY(this.skewY()),e.setVisible(this.visible()),e}equals(e){return this.type()===e.type()&&this.offset().equals(e.offset())&&this.count()===e.count()&&this.repeatType()===e.repeatType()&&this.axis()===e.axis()&&this.unitType()===e.unitType()&&this.order()===e.order()&&this.skewX()===e.skewX()&&this.skewY()===e.skewY()&&this.visible()===e.visible()}absoluteTransformForRepeatIteration(e,r,n){if(!(!this.isRepeat()||!this._repeatType))switch(this._repeatType){case"LINEAR":return this.calculateLinearTransform(e,r,n,!0);case"RADIAL":return this.calculateRadialTransform(e,r,n,!0)}}relativeTransformForRepeatIteration(e,r,n){if(!(!this.isRepeat()||!this._repeatType))switch(this._repeatType){case"LINEAR":return this.calculateLinearTransform(e,r,n,!1);case"RADIAL":return this.calculateRadialTransform(e,r,n,!1)}}calculateLinearTransform(e,r,n,o){let a=this.calculateSpacing(r).multiplyScalar(e),s=X.new2();return s.translate2(a.x(),a.y()),o?(n.multiply(s),n):s}calculateRadialTransform(e,r,n,o){if(!this._count)return X.new2();let i=r.center(),a=Math.PI*2/this._count,s=e*a,l=X.new2();return l.translate2(i.x(),i.y()),l.rotate(s),l.translate2(-i.x(),-i.y()),o?(n.multiply(l),n):l}calculateSpacing(e){if(!this._unitType||!this._axis)return new O(this._offset.x(),this._offset.y());let r=this._offset.x(),n=this._offset.y();switch(this._unitType==="RELATIVE"&&(r=e.width()*r,n=e.height()*r),this._axis){case"X":n=0;break;case"Y":r=0;break;case"X_AND_Y":break}return new O(r,n)}};var Zc=class{imageType(){return this._imageType}setImageType(e){this._imageType=e}constructor(e,r){this._ctx=null,this._decodeCallback=null,this._failureCallback=null,this._texture=null,this._imageHash=null,this._isImageMockLoading=!1,this._mockDecodedData=null,this._mockCompressedTexture=!1,this._imageType=1,this._ctx=e,this._imageHash=r}failureIsRetryable(){return null}width(){return 0}height(){return 0}url(){return"https://dummy-url"}hash(){return this._imageHash}state(){return this._mockDecodedData!=null?2:this._isImageMockLoading?1:0}gif(){return null}decodedData(){return this._mockDecodedData}texture(){return this._texture}setTexture(e){this._texture=e}loadDidFail(){return!1}isCompressedTexture(){return this._mockCompressedTexture}setIsCompressedTexture(e){this._mockCompressedTexture=e}primeWithCompressedData(e){}objectHash(){return`Image(${this._imageHash})`}fetchAndDecode(e,r,n){this._isImageMockLoading||(this._decodeCallback=r,this._failureCallback=n,this._isImageMockLoading=!0,this._ctx.markImageFetched(this))}imageLoads(){this._isImageMockLoading&&(this._mockDecodedData=cr.createFromPixels(1,1,new Uint8Array(1)),this._decodeCallback(this._mockDecodedData),this._isImageMockLoading=!1)}imageFailsToLoad(){this._isImageMockLoading=!1,this._failureCallback(0)}freeMemoryForDecodedDataAndTexture(){return this.freeMemoryForDecodedData(),this._texture=null,!0}freeMemoryForDecodedData(){return this._mockDecodedData=null,this._isImageMockLoading=!1,!0}isDecoded(){return this._mockDecodedData!=null}isGIF(){return!1}};var Ks=class t{constructor(e,r,n){this._hyperlinkBoxes=e,this._usedEmojiCodepoints=r,this._usedEmojiImages=n}hyperlinkBoxes(){return this._hyperlinkBoxes}usedEmojiCodepoints(){return this._usedEmojiCodepoints}usedEmojiImages(){return this._usedEmojiImages}static forTests(e){return new t([],e,[])}};function _m(t,e){return t.fitMode!="contain"&&t.fitMode!="scale-down"&&t.fitMode!="scale-down-width"&&t.fitMode!="fit-width"&&!(t.fitMode=="min-zoom"&&e)}function M1(t){return t.fitMode!="contain"&&t.fitMode!="contain-with-zoom"&&t.fitMode!="scale-down"&&t.fitMode!="none"&&t.fitMode!="free"}var rt=(f=>(f[f.UNKNOWN=0]="UNKNOWN",f[f.TIMER=1]="TIMER",f[f.ON_HOVER=2]="ON_HOVER",f[f.ON_PRESS=3]="ON_PRESS",f[f.ON_CLICK=4]="ON_CLICK",f[f.DRAG=5]="DRAG",f[f.REVERSE_HOVER=6]="REVERSE_HOVER",f[f.REVERSE_PRESS=7]="REVERSE_PRESS",f[f.MOUSE_DOWN=8]="MOUSE_DOWN",f[f.MOUSE_UP=9]="MOUSE_UP",f[f.MOUSE_IN=10]="MOUSE_IN",f[f.MOUSE_OUT=11]="MOUSE_OUT",f[f.MOUSE_ENTER=12]="MOUSE_ENTER",f[f.MOUSE_LEAVE=13]="MOUSE_LEAVE",f[f.ON_KEY_DOWN=14]="ON_KEY_DOWN",f[f.ON_GAMEPAD_DOWN=15]="ON_GAMEPAD_DOWN",f[f.ON_VOICE=16]="ON_VOICE",f[f.MOBILE_NAV=17]="MOBILE_NAV",f[f.LEFT_ARROW=18]="LEFT_ARROW",f[f.RIGHT_ARROW=19]="RIGHT_ARROW",f[f.ON_MEDIA_HIT=20]="ON_MEDIA_HIT",f[f.ON_MEDIA_END=21]="ON_MEDIA_END",f[f.MIRROR_SELECTION=22]="MIRROR_SELECTION",f))(rt||{});(s=>{function t(l){switch(l){case 1:case 20:case 21:case 4:case 5:case 9:case 17:case 22:case 18:case 19:return!1;case 2:case 3:case 6:case 7:case 8:case 10:case 11:case 12:case 13:return!0;default:return!1}}s.isTransientAction=t;function e(l){switch(l){case 2:case 3:case 8:case 10:case 12:return!0;default:return!1}}s.isForwardTransientAction=e;function r(l){switch(l){case 2:return 6;case 3:return 7;case 6:return 2;case 7:return 3;case 10:return 11;case 11:return 10;case 12:return 13;case 13:return 12;case 8:return 9;default:return 0}}s.getOppositeTransientAction=r;function n(l){switch(l){case"TIMER":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"REVERSE_HOVER":return 6;case"REVERSE_PRESS":return 7;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_GAMEPAD_DOWN":return 15;case"ON_VOICE":return 16;case"MOBILE_NAV":return 17;case"LEFT_ARROW":return 18;case"RIGHT_ARROW":return 19;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21;case"MIRROR_SELECTION":return 22}return 0}s.fromString=n;function o(l){return[1,18,19,20,21].indexOf(l)!=-1?0:1}s.getControlSource=o;function i(l){switch(l){case"AFTER_TIMEOUT":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"DRAG":return 5;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_VOICE":return 16;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return we("fromInteractionType InteractionType not handled"),0}s.fromInteractionType=i;function a(l){switch(l){case 1:return"AFTER_TIMEOUT";case 2:return"ON_HOVER";case 3:return"ON_PRESS";case 4:return"ON_CLICK";case 5:return"DRAG";case 8:return"MOUSE_DOWN";case 9:return"MOUSE_UP";case 10:return"MOUSE_IN";case 11:return"MOUSE_OUT";case 12:return"MOUSE_ENTER";case 13:return"MOUSE_LEAVE";case 14:return"ON_KEY_DOWN";case 15:return"ON_KEY_DOWN";case 16:return"ON_VOICE";case 20:return"ON_MEDIA_HIT";case 21:return"ON_MEDIA_END"}return we("mapToInteractionType TransitionAction not handled"),null}s.mapToInteractionType=a})(rt||(rt={}));var On=(r=>(r[r.FORWARD=0]="FORWARD",r[r.REVERSE=1]="REVERSE",r))(On||{});var hm=class{constructor(e,r,n,o){this.node=e,this.property=r,this.oldVal=n,this.newVal=o}},pa=class pa{constructor(e){this._listeners=new Set;this._handle=0,this._observers=new dn,this._nodes=new Map,this._cachedRoot=null,this._isBetweenJoinStartAndJoinEnd=!1,this._loadedTlfs=[],this._deferUnregisteringNodes=!1,this._deferredUnregisters=null,this._handle=e}handle(){return this._handle}firstUserCanvasOrNull(){for(let e=0,r=this.root().childCount();e<r;e=e+1){let n=this.root().childAt1(e);if(n.type()=="CANVAS"&&!n.isInternalOnly())return n}return null}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}broadcastPropertyChange(e){var r,n;pa.VERBOSE&&console.log(`broadcasting change for property '${Lt[e.property]}' on node '${e.node.id()}'`),this._observers.forEach(o=>{o.handleSceneGraphEvent(e)}),(r=F())!=null&&r.modules().revisionNumberAccessor&&((n=F())==null||n.modules().revisionNumberAccessor.incrementRevisionNumber());for(let o of this._listeners)o()}onChange(e){return this._listeners.add(e),()=>{var r;return(r=this._listeners)==null?void 0:r.delete(e)}}getRevisionNumber(){var e,r;return(e=F())!=null&&e.modules().revisionNumberAccessor?(r=F())==null?void 0:r.modules().revisionNumberAccessor.getRevisionNumber():0}setAllTlfsLoaded(){this.setTlfsLoaded(e=>!0)}setTlfsLoaded(e){this._loadedTlfs=[],kn(this.root(),r=>r.type()=="DOCUMENT"||r.type()=="CANVAS"||r.type()=="SECTION"||r.type()=="SLIDE_GRID"||r.type()=="SLIDE_ROW"||r.isSlideModule()?0:r.isTopLevel()?(r.setHasBeenLoaded(e(r)),r.hasBeenLoaded()&&this._loadedTlfs.push(r),0):2)}hierarchyDebugString(){let e="",r=(n,o)=>{let i=n.symbolID(),a=i!=null?` -> ${i}`:"";e+=`${o}${n.id()} ${n.name()}${a}
`,o+="  ";for(let s=0,l=n.childCount();s<l;s=s+1)r(n.childAt1(s),o)};return r(this.root(),""),e}dangerouslyRegisterNode(e){if(e.scene()!=this)throw new Error("Scene mismatch when registering node");let r=this.findNode(e.id());if(r!=null&&r!=e)throw new Error("Unexpected existing node when registering node");this._nodes.set(e.id(),e)}dangerouslyUnregisterNode(e){if(this._deferUnregisteringNodes){this._deferredUnregisters.push(e);return}this._nodes.delete(e),Q.isRoot(e)&&(this._cachedRoot=null)}dangerouslyDeferNodeRemovalScope(e){this._deferredUnregisters=[],this._deferUnregisteringNodes=!0,e(),this._deferUnregisteringNodes=!1;for(let r of this._deferredUnregisters)this.dangerouslyUnregisterNode(r);this._deferredUnregisters=null}markLoaded(){var e;(e=F())==null||e.markSceneLoaded(this)}destroy(){var e;(e=F())==null||e.destroyScene(this)}setFileKey(e){var r;(r=F())==null||r.modules().prototype.setSceneMetadata(e)}applyMessageToScene(e){var o;let r=Xe.milliseconds();(o=F())==null||o.applyNodeChanges(e);let n=Xe.milliseconds()-r;n>100&&console.warn(`applyMessageToScene took ${n/1e3} seconds`)}totalNodeCount(){return this._nodes.size}each(e){Qe.StringMap_each(this._nodes,(r,n)=>{e(n)})}findNode(e){return e==null?null:Qe.StringMap_get(this._nodes,e,null)}findNodeByStablePath(e){if(e==null||e.guids==null)return null;let r=F().findNode(this,e);return this.findNode(r)}findStyle(e){let r=F().sceneGraphTsApi().styleByIdOrNull(e);return this.findNode(r)}createNode(e,r){if(!xr())throw new Error("Should not be creating nodes in TS Viewer while running fullview");let n={};return n.guid=Q.toFigGUID(e),n.phase="CREATED",n.type=r,WS(n),this.findNode(e)}removeNode(e){if(!xr())throw new Error("Should not be removing nodes in TS Viewer while running fullview");let r={};r.guid=Q.toFigGUID(e),r.phase="REMOVED",WS(r);let n=this.findNode(e)}root(){var e;return this._cachedRoot==null&&(this._cachedRoot=this.findNode(Q._new(0,0)),(e=this._cachedRoot)==null||e.updateIsRooted()),this._cachedRoot}regenerateDirtySymbolInstances(e){F().updateSymbolInstancesForTests()}updateDirtyStyleConsumers(){F().updateStylesForTests()}findNodeFromDeveloperFriendlyId(e){if(e.charCodeAt(0)==84){let r=e.slice(1).split(";");if(r.length!=3)return console.error("Table cell developer friendly id does not have 3 guids"),null;let n=Q.fromString(r[0]),o=this.findNode(n);if(o==null)return console.error("Cannot find table from table cell developer friendly id"),null;let i=Q.fromString(r[1]),a=Q.fromString(r[2]);return o.getTableCellAt(i,a)}else if(e.charCodeAt(0)==73){let r=e.slice(1).split(";"),n=Q.fromString(r[0]),o=this.findNode(n),i=null;i=(s,l)=>{if(s==null)return null;if(l(s))return s;for(let c=0,d=s.childCount();c<d;c=c+1){let u=i(s.childAt1(c),l);if(u!=null)return u}return null};let a=new ht(r.map(s=>Q.fromString(s)));return i(o,s=>ht.equals(s.stablePath(),a))}else return this.findNode(e)}static createCanvasInScene(e,r){let n=e.createNode(r,"CANVAS");return n.setVisible(!0),n.setOpacity(1),n.setName("canvas"),n.setCurrentViewportSize(new O(1e6,1e6)),e.root().appendChild(n),n}static createLoadedFrameWithCanvasContent(e,r){let n=new Et,o=[];kn(r,l=>l.isTopLevel()?(n.include3(l.fullSizeCanvasSpaceBoundingBox()),o.push(l),2):0);let i=n.build();i.expand1(150);let a=r.fillPaintsToRender()[0].asSinglePaint();a.opacity()==0&&(a=ee.createSolid(N.WHITE,1));let s=Xo(r,"frame",a);je(s,i.topLeft(),i.size()),s.setTestOnlyFillGeometry(zi(s.fullSizeCanvasSpaceBoundingBox()));for(let l of o){let c=l.relativeTransform().clone();c.translate1(s.relativeTransform().translation().negative()),l.setParentIndex(new un(Q.invalid(),gr.fromString(""))),s.appendChild(l),l.setRelativeTransform(c)}return e.setTlfsLoaded(l=>l==s?!0:l.hasBeenLoaded()),s}static createScene(e,r){return F().createSceneAndSetActive(e,r)}static createSceneWithCanvasForTests1(){return pa.createSceneWithCanvasForTests2(K.ViewerMode.PROTOTYPE)}static createSceneWithCanvasForTests2(e){var n;K.setViewerMode(e);let r=pa.createScene(pa.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,null);return(n=F())==null||n.modules().prototype.setSceneMetadata("1"),pa.createCanvasInScene(r,Q._new(0,1)),r.markLoaded(),r}};pa.MAX_GUID_VALUE=2147483647,pa.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER=pa.MAX_GUID_VALUE-1,pa.VERBOSE=!1;var ft=pa;function LA(t){return t.x()==375&&t.y()==812?"APPLE_IPHONE_X_SILVER":t.x()==414&&t.y()==736?"APPLE_IPHONE_8_PLUS_SILVER":t.x()==375&&t.y()==667?"APPLE_IPHONE_8_SILVER":t.x()==320&&t.y()==568?"APPLE_IPHONE_SE_SILVER":t.x()==411&&t.y()==731?"GOOGLE_PIXEL_2_CLEARLY_WHITE":t.x()==768&&t.y()==1024?"APPLE_IPAD_MINI_4_SILVER":t.x()==1024&&t.y()==1366?"APPLE_IPAD_PRO_SILVER":t.x()==1440&&t.y()==990?"MICROSOFT_SURFACE_PRO_3":t.x()==1368&&t.y()==912?"MICROSOFT_SURFACE_PRO_4":t.x()==312&&t.y()==390?"APPLE_WATCH_42MM_STEEL_PLUS_WHITE_CLOSED":t.x()==272&&t.y()==340?"APPLE_WATCH_38MM_STEEL_PLUS_WHITE_CLOSED":null}var _e=class _e{constructor(e,r,n=null){this._paths=new Map;this._appState=e,this._imageManager=r,this._videoManager=n}static hash(e,r){return r instanceof Array&&r.length===0?e:r}static hasFileHeader(e){for(let r=0,n=_e.FILE_HEADER.length;r<n;r=r+1)if(r>=e.length||e[r]!=_e.FILE_HEADER[r])return!1;return!0}static parseChunkType(e){return e.length!=_e.CHUNK_TAG_LEN?_e.ChunkType.UNKNOWN:(n=>{for(let o=0,i=e.length;o<i;o=o+1)if(e[o]!=n[o])return!1;return!0})(_e.THUMBNAIL_CHUNK_TAG)?_e.ChunkType.THUMBNAIL:_e.ChunkType.UNKNOWN}static readInt32(e,r){return e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24}static _logVerbose(e){console.log(e)}static _logVerbosePropertyChange(e,r){console.log(`decoded property change '${r}' for node '${e}'`)}static encodeGUID(e){return Q.toFigGUID(e)}static encodeGUIDPath(e){let r={};return e.guids!=null&&(r.guids=e.guids.map(n=>_e.encodeGUID(n))),r}static encodeInstanceStateChange(e,r){let n={};return n.stateID=_e.encodeGUID(e.newStateId()),n.interactionID=_e.encodeGUID(e.interactionAddress.interactionId),e.interactionAddress.hotspotStablePath!=null&&(n.hotspotStablePath=_e.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),e.stablePath!=null&&(n.instanceStablePath=_e.encodeGUIDPath(e.stablePath)),n.phase=r,n}static encodePrototypeStateChange(e){let r={};if(e.oldStateAndOverlays!=null){let n={};e.oldStateAndOverlays.stateId!=null&&(n.baseScreenID=_e.encodeGUID(e.oldStateAndOverlays.stateId),n.overlays=e.oldStateAndOverlays.overlays.map(o=>_e.encodeOverlayData(o,null))),r.oldState=n}if(e.newStateAndOverlays!=null){let n={};e.newStateAndOverlays.stateId!=null&&(n.baseScreenID=_e.encodeGUID(e.newStateAndOverlays.stateId),n.overlays=e.newStateAndOverlays.overlays.map(o=>_e.encodeOverlayData(o,null))),r.newState=n}return e.interactionAddress.hotspotStablePath!=null&&(r.hotspotBlueprintID=_e.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),r.isHotspotInNewPresentedState=[6,7].indexOf(e.cause)==-1,r.interactionID=_e.encodeGUID(e.interactionAddress.interactionId),r.direction=e.direction==0?"FORWARD":"REVERSE",r}static encodeOverlayData(e,r){let n={};return n.hotspotBlueprintId=_e.encodeGUIDPath(e.openingHotspotStablePath),r!=null&&(n.hotspotGuid=_e.encodeGUID(r)),n.overlayGuid=_e.encodeGUID(e.id),n.prototypeInteractionGuid=_e.encodeGUID(e.openingInteractionId),n.swapGuid=_e.encodeGUID(e.overlayDataModelId),n}static encodeMatrix(e){let r={};return r.m00=e.m00(),r.m01=e.m01(),r.m02=e.m02(),r.m10=e.m10(),r.m11=e.m11(),r.m12=e.m12(),r}static encodeVector1(e){let r={};return r.x=e.x(),r.y=e.y(),r}static encodeVector2(e){let r={};return r.x=e.x(),r.y=e.y(),r}static decodeGUID(e){let r=null,n=e.sessionID|0;if(n<0){let o=e.localID|0;n==-1&&(o==-1||o==-2)?r=Q._new(n,o):(we("Negative session ID encountered in GUID deserialization"),r=Q._new(e.sessionID,e.localID))}else r=Q._new(e.sessionID,e.localID);return ot.asGUID(r)}static decodeGUID_instanceHACK(e){return Q._new(e.sessionID|0,e.localID)}static decodeGUIDPath(e){if(e.guids===void 0)return null;let r=[];for(let n of e.guids){let o=_e.decodeGUID(n);if(o==null)return null;r.push(o)}return new ht(r)}static decodeStyleId(e){let r=e.guid!=null?_e.decodeGUID(e.guid):null,n=e.assetRef!=null?{key:kc(e.assetRef.key),version:Hc(e.assetRef.version)}:null,o={guid:r,ref:n};return ot.asStyleId(o)}static decodeVariableSetId(e){return is.fromKiwi(e)}static decodeParentIndex(e){return new un(_e.decodeGUID(e.guid),gr.fromString(e.position))}static decodeVector(e){return new O(e.x,e.y)}static decodeMatrix(e){return new X(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}static decodeColor(e){return N.new3(e.r,e.g,e.b,e.a)}static decodeFontName(e){let r=e.postscript!==void 0?e.postscript:"";return new ph(e.family,e.style,r)}static decodeNumber(e){return new uh(e.value,e.units)}static decodeStops(e){let r=[];for(let n of e)r.push(new ct(_e.decodeColor(n.color),n.position));return r}static decodePrototypeDevice(e){let r=_e.decodeVector(e.size),n=e.presetIdentifier!==void 0?e.presetIdentifier:null;e.type=="PRESET"&&(n==null||n.length==0)&&(n=LA(r));let o=e.rotation!==void 0?e.rotation:"NONE";return new Cn(e.type,r,n,o)}static decodePrototypeStartingPoint(e){return new sa(e.name,e.description,gr.fromString(e.position))}static encodePrototypeStartingPoint(e){let r={};return r.name=e.name,r.description=e.description,r.position=gr.toString(e.position),r}static decodeOverlayBackgroundAppearance(e){return new la(e.backgroundType!==void 0?e.backgroundType:"NONE",e.backgroundColor!==void 0?_e.decodeColor(e.backgroundColor):N.TRANSPARENT)}static decodeVideoPlayback(e){return{autoplay:e.autoplay!==void 0?e.autoplay:!1,mediaLoop:e.mediaLoop!==void 0?e.mediaLoop:!1,muted:e.muted!==void 0?e.muted:!1,showControls:e.showControls!==void 0?e.showControls:!1}}static decodeEffects(e){let r=[];for(let o of e){let i=new Pe;i.setType(o.type),o.color!==void 0&&i.setColor(_e.decodeColor(o.color)),o.secondaryColor!==void 0&&i.setSecondaryColor(_e.decodeColor(o.secondaryColor)),o.blendMode!==void 0&&i.setBlendMode(o.blendMode),o.offset!==void 0&&i.setBlurOffset1(_e.decodeVector(o.offset)),o.radius!==void 0&&i.setBlurRadius(o.radius),o.visible!==void 0&&i.setIsEnabled(o.visible),o.spread!==void 0&&i.setSpread(o.spread),o.showShadowBehindNode!==void 0?i.setShowShadowBehindNode(o.showShadowBehindNode):i.setShowShadowBehindNode(!0),o.blurOpType!==void 0&&i.setBlurOpType(o.blurOpType),o.startOffset!==void 0&&i.setBlurStartOffset1(_e.decodeVector(o.startOffset)),o.endOffset!==void 0&&i.setBlurEndOffset1(_e.decodeVector(o.endOffset)),o.startRadius!==void 0&&i.setBlurStartRadius(o.startRadius),o.noiseSize!==void 0&&i.setNoiseSize(_e.decodeVector(o.noiseSize)),o.density!==void 0&&i.setDensity(o.density),o.noiseType!==void 0&&i.setNoiseType(o.noiseType),o.clipToShape!==void 0&&i.setClipToShape(o.clipToShape),o.opacity!==void 0&&i.setEffectOpacity(o.opacity),o.seed!==void 0&&i.setSeed(o.seed),o.refractionIntensity!==void 0&&i.setRefractionIntensity(o.refractionIntensity),o.refractionRadius!==void 0&&i.setRefractionDistance(o.refractionRadius),o.specularAngle!==void 0&&i.setSpecularAngle(o.specularAngle),o.specularIntensity!==void 0&&i.setSpecularIntensity(o.specularIntensity),o.chromaticAberration!==void 0&&i.setChromaticAberration(o.chromaticAberration),o.reflectionDistance!==void 0&&i.setReflectionDistance(o.reflectionDistance),o.bevelSize!==void 0&&i.setBevelSize(o.bevelSize),r.push(i)}let n=r;return ot.asEffectList(n)}static decodeExportConstraint(e){return e.type!==void 0&&e.value!==void 0?new Lc(e.type,e.value):new Lc("CONTENT_SCALE",1)}static decodeExportSettings(e,r){let n=[];for(let o of e){let i=null;o.suffix!==void 0?i=o.suffix:i="";let a=null;o.imageType!==void 0?a=o.imageType:a="PNG";let s=null;o.constraint!==void 0?s=_e.decodeExportConstraint(o.constraint):s=new Lc("CONTENT_SCALE",1);let l=r;o.contentsOnly!==void 0&&(l=o.contentsOnly),n.push(new _h(i,a,s,l))}return n}static decodePrototypeInteractions(e){return e.map(r=>_e.decodePrototypeInteraction(r))}static decodePrototypeInteraction(e){let r=e.id!==void 0?_e.decodeGUID(e.id):null,n=e.event!==void 0?_e.decodePrototypeEvent(e.event):null,o=e.actions!==void 0?e.actions.map(s=>_e.decodePrototypeAction(s)):null,i=e.isDeleted!==void 0?e.isDeleted:!1,a=e.stateManagementVersion!==void 0?e.stateManagementVersion:0;return new $t(r,n,o,i,a)}static encodePrototypeInteractionForTests(e){let r={};r.id=_e.encodeGUID(e.id()),r.isDeleted=e.isDeleted(),r.stateManagementVersion=e.stateManagementVersion(),r.event=_e.encodePrototypeEventForTests(e.event());let n=[],o=e.actions();for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];n.push(_e.encodePrototypeActionForTests(s))}return r.actions=n,r}static decodePrototypeEvent(e){let r=e.interactionType!==void 0?e.interactionType:null,n=e.interactionMaintained!==void 0?new pe(e.interactionMaintained):null,o=e.interactionDuration!==void 0?new pe(e.interactionDuration):null,i=e.keyTrigger!==void 0?e.keyTrigger:null,a=e.transitionTimeout!==void 0?new pe(e.transitionTimeout):null,s=e.mediaHitTime!==void 0?new pe(e.mediaHitTime):null;return new po(r,n,o,i,a,s)}static encodePrototypeEventForTests(e){let r={};return r.interactionType=e.interactionType(),r.interactionMaintained=e.interactionMaintained(),r.interactionDuration=e.interactionDuration(),r.keyTrigger=e.keyTrigger(),r.keyTrigger.keyCodes=e.keyTrigger().keyCodes,r.keyTrigger.triggerDevice=e.keyTrigger().triggerDevice,r.transitionTimeout=e.transitionTimeout(),r.mediaHitTime=e.mediaHitTime(),r}static decodeConditionalActions(e){let r=[],n=e.actions!==void 0?e.actions.map(i=>_e.decodePrototypeAction(i)):r,o=e.condition!==void 0?_e.variableDataToJson(e.condition):"";return new Fu(n,o)}static encodeConditionalActionsForTests(e){let r={},n=[],o=e.actions();for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];n.push(_e.encodePrototypeActionForTests(s))}return r.actions=n,r}static decodePrototypeAction(e){let r=e.transitionNodeID!==void 0?_e.decodeGUID(e.transitionNodeID):null,n=e.transitionType!==void 0?e.transitionType:null,o=e.transitionDuration!==void 0?new pe(e.transitionDuration):null,i=e.easingType!==void 0?e.easingType:null,a=e.easingFunction!==void 0?e.easingFunction:null,s=e.transitionShouldSmartAnimate!==void 0?new pe(e.transitionShouldSmartAnimate):null,l=e.connectionType!==void 0?e.connectionType:null,c=e.connectionURL!==void 0?e.connectionURL:null,d=e.overlayRelativePosition!==void 0?_e.decodeVector(e.overlayRelativePosition):null,u=e.navigationType!==void 0?e.navigationType:null,p=e.transitionPreserveScroll!==void 0?new pe(e.transitionPreserveScroll):null,_=e.extraScrollOffset!==void 0?_e.decodeVector(e.extraScrollOffset):null,h=e.mediaAction!==void 0?e.mediaAction:null,A=e.transitionResetVideoPosition!==void 0?new pe(e.transitionResetVideoPosition):null,m=e.openUrlInNewTab!==void 0?new pe(e.openUrlInNewTab):null,g=e.mediaSkipToTime!==void 0?new pe(e.mediaSkipToTime):null,S=e.mediaSkipByAmount!==void 0?new pe(e.mediaSkipByAmount):null,R=e.transitionResetScrollPosition!==void 0?new pe(e.transitionResetScrollPosition):null,E=e.conditionalActions!==void 0?e.conditionalActions.map(B=>_e.decodeConditionalActions(B)):null,P=e.transitionResetInteractiveComponents!==void 0?new pe(e.transitionResetInteractiveComponents):null,T=e.targetVariable!==void 0&&e.targetVariable.id?Iu.toString(e.targetVariable.id):null,f=e.targetVariable!==void 0&&e.targetVariable.nodeFieldAlias?_e.nodeFieldAliasToJson(e.targetVariable.nodeFieldAlias):null,y=e.targetVariableData!==void 0?_e.variableDataToJson(e.targetVariableData):null,v=e.targetVariableModeID!==void 0?_e.decodeGUID(e.targetVariableModeID):null,w=e.targetVariableSetID!==void 0?_e.decodeVariableSetId(e.targetVariableSetID):null,I=e.targetVariableSetKey!==void 0?e.targetVariableSetKey:null,C=e.animationType!==void 0?e.animationType:null,L=e.animationPhase!==void 0?e.animationPhase:null;return new dr(r,n,o,i,a,s,l,c,d,u,p,_,h,A,m,g,S,R,E,P,T,y,v,w,I,f,C,L)}static variableDataToJson(e){var o,i,a,s;let r={},n=e.dataType;switch(r.type=_e.variableDataTypeToEnumValue(n),r.resolvedType=_e.variableResolvedDataTypeToEnumValue(e.resolvedDataType),n){case"BOOLEAN":{r.value=e.value.boolValue;break}case"STRING":{r.value=e.value.textValue;break}case"FLOAT":{r.value=e.value.floatValue;break}case"COLOR":{let l={};l.r=e.value.colorValue.r,l.g=e.value.colorValue.g,l.b=e.value.colorValue.b,l.a=e.value.colorValue.a,r.value=l;break}case"ALIAS":{r.value=Iu.toString(e.value.alias);break}case"NODE_FIELD_ALIAS":{r.value=_e.nodeFieldAliasToJson(e.value.nodeFieldAliasValue);break}case"CMS_ALIAS":{let l=(o=e.value)==null?void 0:o.cmsAliasValue;r.value=l?_e.cmsAliasToJson(l):{};break}case"JS_RUNTIME_ALIAS":{let l=(i=e.value)==null?void 0:i.jsRuntimeAliasValue;r.value=l?_e.jsRuntimeAliasToJson(l):{};break}case"MANAGED_STRING_ALIAS":{let l=(a=e.value)==null?void 0:a.managedStringAliasValue;r.value=l?_e.managedStringAliasToJson(l):{};break}case"PROP_REF":{let l=(s=e.value)==null?void 0:s.propRefValue;r.value=l?_e.componentPropRefToJson(l):{};break}case"EXPRESSION":{r.value=_e.expressionToJson(e.value.expressionValue);break}case"MAP":throw new Error("Did not implement variableDataToJson for MAP data type")}return r}static variableDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"ALIAS":return 3;case"COLOR":return 4;case"EXPRESSION":return 5;case"MAP":return 6;case"SYMBOL_ID":return 7;case"FONT_STYLE":return 8;case"TEXT_DATA":return 9;case"INVALID":return 10;case"NODE_FIELD_ALIAS":return 11;case"CMS_ALIAS":return 12;case"PROP_REF":return 13;case"IMAGE":return 14;case"MANAGED_STRING_ALIAS":return 15;case"LINK":return 16;case"JS_RUNTIME_ALIAS":return 17}throw new Error(`Invalid variable data type: ${e}`)}static variableResolvedDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"COLOR":return 3;case"MAP":return 4;case"SYMBOL_ID":return 5;case"FONT_STYLE":return 6;case"TEXT_DATA":return 7;case"IMAGE":return 8;case"LINK":return 9;case"JS_RUNTIME_ALIAS":return 10}throw new Error(`Invalid resolved variable data type: ${e}`)}static expressionToJson(e){let r={};r.expressionFunction=_e.expressionFunctionToEnumValue(e.expressionFunction);let n=[];for(let o=0;o<e.expressionArguments.length;o=o+1)n.push(_e.variableDataToJson(e.expressionArguments[o]));return r.expressionArguments=n,r}static nodeFieldAliasToJson(e){let r={};return r.stablePathToNode=_e.decodeGUIDPath(e.stablePathToNode),r.nodeField=e.nodeField,r.indexOrKey=e.indexOrKey,r}static cmsAliasToJson(e){let r={};return e&&(r.collectionId=e.collectionId,r.fieldId=e.fieldId),r}static jsRuntimeAliasToJson(e){let r={};return e&&(r.lookupKey=e.lookupKey),r}static managedStringAliasToJson(e){let r={};return e&&(r.managedStringId=e.managedStringId?oh.toString(e.managedStringId):""),r}static componentPropRefToJson(e){let r={};return e&&(r.defId=e.defId),r}static expressionFunctionToEnumValue(e){switch(e){case"ADDITION":return 0;case"SUBTRACTION":return 1;case"RESOLVE_VARIANT":return 2;case"MULTIPLY":return 3;case"DIVIDE":return 4;case"EQUALS":return 5;case"NOT_EQUAL":return 6;case"LESS_THAN":return 7;case"LESS_THAN_OR_EQUAL":return 8;case"GREATER_THAN":return 9;case"GREATER_THAN_OR_EQUAL":return 10;case"AND":return 11;case"OR":return 12;case"NOT":return 13;case"STRINGIFY":return 14;case"TERNARY":return 15;case"VAR_MODE_LOOKUP":return 16;case"NEGATE":return 17;case"IS_TRUTHY":return 18}}static encodePrototypeActionForTests(e){let r={};r.transitionNodeID=_e.encodeGUID(e.transitionNodeID()),r.transitionType=e.transitionType(),r.transitionDuration=e.transitionDuration(),r.easingType=e.easingType(),r.easingFunction=e.easingFunctionValues(),r.transitionShouldSmartAnimate=e.transitionShouldSmartAnimate(),r.connectionType=e.connectionType(),r.connectionURL=e.connectionURL(),r.overlayRelativePosition=_e.encodeVector1(e.overlayRelativePosition()),r.navigationType=e.navigationType(),r.transitionPreserveScroll=e.transitionPreserveScroll(),r.extraScrollOffset=_e.encodeVector1(e.extraScrollOffset()),r.mediaAction=e.mediaAction(),r.transitionResetVideoPosition=e.transitionResetVideoPosition(),r.openUrlInNewTab=e.openUrlInNewTab(),r.mediaSkipToTime=e.mediaSkipToTime(),r.mediaSkipByAmount=e.mediaSkipByAmount(),r.transitionResetScrollPosition=e.transitionResetScrollPosition();let n=[],o=e.conditionalActions();for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];n.push(_e.encodeConditionalActionsForTests(s))}return r.conditionalActions=n,r.transitionResetInteractiveComponents=e.transitionResetInteractiveComponents(),r.animationType=e.animationType(),r.animationPhase=e.animationPhase(),r}static serializeValueToKiwiForTests1(e,r){let n={},o=[];return _e.serializeValueToKiwiForTests2(e,r,n,o),new ho(n,o)}static serializeValueToKiwiForTests2(e,r,n,o){if(!xr())throw new Error("Should only serialize values to kiwi when running tests");if(e==61||e==62){let i=ot.asPaintList(r);if(i==null)throw new Error("attempt to set null paint list");let a=[];for(let s=0,l=i.length;s<l;s=s+1){let c=i[s].asSinglePaint(),d={};if(d.type=c.type(),d.opacity=c.opacity(),d.visible=c.isEnabled(),d.blendMode=c.blendMode(),d.transform=_e.encodeMatrix(c.transform()),c.colorStops()!=null){let p=[];for(let _=0,h=c.colorStops().length;_<h;_=_+1){let A=c.colorStops()[_],m={},g={};g.r=N.redF(A.color),g.g=N.greenF(A.color),g.b=N.blueF(A.color),g.a=N.alphaF(A.color),m.color=g,m.position=A.position,p.push(m)}d.stops=p}let u={};if(u.r=N.redF(c.color()),u.g=N.greenF(c.color()),u.b=N.blueF(c.color()),u.a=N.alphaF(c.color()),d.color=u,c.image()!=null){let p={};p.hash=nn.hexToBytes(c.image().hash()),d.image=p,d.imageScaleMode=c.imageScaleMode()}a.push(d)}e==61?n.fillPaints=a:e==62&&(n.strokePaints=a)}else if(e==78){let i=r;if(i==null)throw new Error("attempt to set null symbol data");let a={};a.symbolID=_e.encodeGUID(i.masterID);let s=[];Ti.map(i.instanceOverrides).each((l,c)=>{let d={};d.guidPath=_e.encodeGUIDPath(l),Sr.each(c,(u,p)=>{_e.serializeValueToKiwiForTests2(u,p,d,[])}),s.push(d)}),a.symbolOverrides=s,n.symbolData=a}else if(e==76||e==77){let i=r;if(i==null)throw new Error("attempt to set null geometry");let a=[];for(let s=0,l=i.regions.length;s<l;s=s+1){let c=i.regions[s],d={};d.windingRule=c.windingRule,d.styleID=c.styleID,d.commandsBlob=o.length,o.push(Bt.mutableData(c.path().toBezierPath().getMutableClone()).bytes()),a.push(d)}e==76?n.fillGeometry=a:n.strokeGeometry=a}else if(e==4){let i=r;if(i==null)throw new Error("attempt to set null textData");let a={};a.characters=i.characters();let s=[];i.styleOverrideTable().forEachStyle((l,c)=>{ya.each(c,(d,u)=>{let _=_e.serializeValueToKiwiForTests1(d,u).a;_.styleID=l,s.push(_)})}),a.styleOverrideTable=s,n.textData=a}else if(e==5){let i=r;if(i==null)throw new Error("attempt to set null textData");let a={},s=[];i.usedEmojiCodepoints().forEach(l=>{let c={};c.emojiCodePoints=l,s.push(c)}),a.glyphs=s,a.hyperlinkBoxes=i.hyperlinkBoxes().map(l=>({guid:l.guid,bounds:l.bounds,hyperlinkID:l.hyperlinkID,url:l.url})),n.derivedTextData=a}else if(e==64){let i=ot.asEffectList(r);if(i==null)throw new Error("attempt to set null effects");let a=[];for(let s=0,l=i.length;s<l;s=s+1){let c=i[s],d={};d.blendMode=c.blendMode(),d.radius=c.blurRadius(),d.spread=c.spread(),d.visible=c.isEnabled(),d.showShadowBehindNode=c.showShadowBehindNode(),d.type=c.type();let u={};u.r=N.redF(c.color()),u.g=N.greenF(c.color()),u.b=N.blueF(c.color()),u.a=N.alphaF(c.color()),d.color=u;let p=_e.encodeVector2(c.blurOffset());d.offset=p,d.density=c.density(),d.noiseSize=_e.encodeVector2(c.noiseSize()),d.noiseType=c.noiseType();let _={};_.r=N.redF(c.secondaryColor()),_.g=N.greenF(c.secondaryColor()),_.b=N.blueF(c.secondaryColor()),_.a=N.alphaF(c.secondaryColor()),d.secondaryColor=_,d.seed=c.seed(),d.opacity=c.effectOpacity(),d.clipToShape=c.clipToShape(),a.push(d)}n.effects=a}else if(e==59){let i=ot.asGUID(r);if(i==null)throw new Error("attempt to set null overridenSymbolID");n.overriddenSymbolID=_e.encodeGUID(i)}else if(e==90||e==91){let i=r;if(i==null)throw new Error("attempt to set null prototypeInteractions");let a=[];for(let s=0,l=i.length;s<l;s=s+1){let d=i[s];a.push(_e.encodePrototypeInteractionForTests(d))}e==90?n.prototypeInteractions=a:e==91&&(n.objectAnimations=a)}else if(e==114){let i=ot.asStringEnum(r,null);if(i==null)throw new Error("Bad node phase");n.phase=i}else{let i=Vc(e);throw new Error(`unsupported setter for node field ${Lt[e]} and type ${Lu[i]}`)}}_imageDecoded(e,r,n){this._imageManager!=null&&this._imageManager.onNewImage(e,r,n)}_imageByHexHashOrNull(e,r){var n;return(n=this._imageManager)==null?void 0:n.findImageByHexHash(e,r)}decodeImage(e,r,n){let o=nn.bytesToHex(e.hash),i=this._imageByHexHashOrNull(o,1);if(i==null){let a=null;if(e.dataBlob!==void 0){let s=e.dataBlob;s<0||s>=r.length?console.warn(`ignoring invalid compressed data index ${s} for blob count ${r.length}`):a=r[s].bytes}yo?i=new Zc(null,o):i=nn.createImage(e.hash,a,n),this._imageDecoded(o,1,i)}return i}decodeVideo(e){let r=new Uint8Array(e.hash);return this._videoManager.buildVideoResource(r)}decodeEmojiImage(e,r){let n=e.map(i=>i.toString(16)).join("-"),o=this._imageByHexHashOrNull([n,r].join("-"),0);return o==null&&(o=nn.createEmojiImage2(n,r),this._imageDecoded([n,r].join("-"),0,o)),o}decodePaints(e,r){let n=[];for(let i of e){let a=new ee(i.type);if(i.blendMode!==void 0&&a.setBlendMode(i.blendMode),i.color!==void 0){let s=_e.decodeColor(i.color);a.setOpacity(N.alphaF(s)),a.setColor(N.withAlpha(s,255))}if(i.opacity!==void 0&&a.setOpacity(a.opacity()*i.opacity),i.stops!==void 0&&a.setColorStops1(_e.decodeStops(i.stops)),i.transform!==void 0&&a.setTransform1(_e.decodeMatrix(i.transform)),i.visible!==void 0&&a.setIsEnabled(i.visible),i.imageScaleMode!==void 0&&a.setImageScaleMode(i.imageScaleMode),i.rotation!==void 0&&a.setRotationDeg(i.rotation),i.scale!==void 0&&a.setScalingFactor(i.scale),i.paintFilter!==void 0&&a.setFilterColorAdjust(i.paintFilter),i.originalImageWidth!==void 0&&a.setOriginalImageWidth(i.originalImageWidth),i.originalImageHeight!==void 0&&a.setOriginalImageHeight(i.originalImageHeight),i.emojiCodePoints!==void 0)a.setImage(this.decodeEmojiImage(i.emojiCodePoints,"apple"));else{let s=!1;i.animatedImage!==void 0&&i.animatedImage.hash!==void 0?(a.setImage(this.decodeImage(i.animatedImage,r,0)),i.animationFrame!==void 0&&i.animationFrame!=0&&(s=!0)):i.video!==void 0&&i.video.hash!==void 0?(a.setVideo(this.decodeVideo(i.video)),i.image!==void 0&&i.image.hash!==void 0&&a.setImage(this.decodeImage(i.image,r,1))):i.image!==void 0&&i.image.hash!==void 0&&a.setImage(this.decodeImage(i.image,r,1)),!s&&i.imageThumbnail!==void 0&&i.imageThumbnail.hash!==void 0&&a.setImageThumbnail(this.decodeImage(i.imageThumbnail,r,1))}if(i.sourceNodeId!==void 0){let s=this._appState.scene().findNode(Q.fromFigGUID(i.sourceNodeId));s!=null?(a.setPatternSource(s),a.setPatternSourceAbsoluteBounds(s.fullSizeCanvasSpaceBoundingBox()),i.patternTileType!==void 0&&a.setPatternTileType(i.patternTileType),i.horizontalAlignment!==void 0&&a.setPatternHorizontalAlignment(i.horizontalAlignment),i.verticalAlignment!==void 0&&a.setPatternVerticalAlignment(i.verticalAlignment),i.scale!==void 0&&a.setPatternScale(i.scale),i.patternSpacing!==void 0&&a.setPatternSpacing(ge.FrozenVector_new3(_e.decodeVector(i.patternSpacing)))):(a.setPatternSourceAbsoluteBounds(Gr.FrozenRect_new4(0,0,4,4)),a.setPatternTileType("RECTANGULAR"),a.setPatternHorizontalAlignment("CENTER"),a.setPatternVerticalAlignment("CENTER"),a.setPatternScale(1),a.setPatternSpacing(ge.FrozenVector_new4(5,5)))}a.opacity()!=0&&a.opacity()<1/250&&a.setOpacity(1/250),n.push(a)}let o=n;return ot.asPaintList(o)}decodePath(e,r){let n=Xt.IntMap_get(this._paths,e,null);return n==null&&(e<0||e>=r.length?(console.warn(`ignoring invalid path index ${e} for blob count ${r.length}`),n=new Bt(new Bn)):n=new Bt(new Bn(new Uint8Array(r[e].bytes))),this._paths.set(e,n)),n}decodeCodeSnapshot(e,r){let n=e.paints!==void 0?this.decodePaints(e.paints,r):[],o=_e.decodeVector(e.offset),i=_e.decodeVector(e.layoutSize),a=_e.decodeVector(e.canvasSize);return new Mc(n,o,i,a,e.devicePixelRatio)}decodeGeometry(e,r){let n=[],o=null;for(let i of e){let a="ODD";if(i.commandsBlob===void 0){console.warn("ignoring path with missing required field: 'commandsBlob'");continue}i.windingRule!==void 0&&(a=i.windingRule);let s=this.decodePath(i.commandsBlob,r);n.push(new jr(a,0,s,s.bounds())),i.styleID!==void 0&&(o==null&&(o=[]),o.push(i.styleID))}Et.INSTANCE.reset();for(let i of n)Et.INSTANCE.include3(i.bounds());return new $r(n,o,Et.INSTANCE.build(),null)}decodeTextData(e,r){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,r):new Sn,o=null,i=n.styleByID2();for(let a of Array.from(i.keys())){let s=i.get(a),l=Sr.get(s,3,null);if(l!=null){if(o==null)o=l;else if(l!==o){o="mixed";break}}}return new Ca(n,o,e.characters!==void 0?e.characters:"",e.lines!==void 0?e.lines:[],e.characterStyleIDs!==void 0?e.characterStyleIDs:[])}decodeDerivedTextData(e,r){let n=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[];return new Ks(n,[],[])}decodeVectorData(e,r){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,r):new Sn;return new Sh(n)}decodeSymbolData(e,r){return e.symbolID===void 0?(console.warn("ignoring symbol data with missing required field: 'symbolID'"),null):new ns(_e.decodeGUID(e.symbolID),e.symbolOverrides!==void 0?this.decodeOverrides(e.symbolOverrides,r):Ti._new())}decodeOverrides(e,r){let n=Ti._new();for(let o of e)if(o.guidPath!==void 0){let i=_e.decodeGUIDPath(o.guidPath),a=Sr._new();this.decodeNodeChange(o,r,(s,l)=>{Sr.set(a,s,l)}),Ti.map(n).set(i,a)}return n}decodeStyleOverrideTable(e,r){let n=new Map;for(let o of e)o.styleID!==void 0&&this.decodeNodeChange(o,r,(i,a)=>{n.has(o.styleID)||n.set(o.styleID,Sr._new()),Sr.set(n.get(o.styleID),i,a)});return new Sn(n)}decodeNodeChange(e,r,n){e.type!==void 0&&n(25,e.type),e.backgroundColor!==void 0&&n(67,_e.decodeColor(e.backgroundColor)),e.backgroundEnabled!==void 0&&n(9,e.backgroundEnabled),e.backgroundOpacity!==void 0&&n(46,e.backgroundOpacity),e.blendMode!==void 0&&n(28,e.blendMode),e.codeSnapshot!==void 0&&n(112,this.decodeCodeSnapshot(e.codeSnapshot,r)),e.connectionType!==void 0&&n(33,e.connectionType),e.connectionURL!==void 0&&n(73,e.connectionURL),e.cornerRadius!==void 0&&n(52,e.cornerRadius),e.rectangleTopLeftCornerRadius!==void 0&&n(47,e.rectangleTopLeftCornerRadius),e.rectangleTopRightCornerRadius!==void 0&&n(48,e.rectangleTopRightCornerRadius),e.rectangleBottomLeftCornerRadius!==void 0&&n(49,e.rectangleBottomLeftCornerRadius),e.rectangleBottomRightCornerRadius!==void 0&&n(50,e.rectangleBottomRightCornerRadius),e.rectangleCornerRadiiIndependent!==void 0&&n(15,e.rectangleCornerRadiiIndependent),e.cornerSmoothing!==void 0&&n(53,e.cornerSmoothing),e.easingType!==void 0&&n(35,e.easingType),e.effects!==void 0&&n(64,_e.decodeEffects(e.effects)),e.arcData!==void 0&&n(66,e.arcData),e.shapeWithTextType!==void 0&&n(94,e.shapeWithTextType),e.fillGeometry!==void 0&&n(76,this.decodeGeometry(e.fillGeometry,r)),e.fillPaints!==void 0&&n(61,this.decodePaints(e.fillPaints,r)),e.textDecorationFillPaints!==void 0&&n(63,this.decodePaints(e.textDecorationFillPaints,r)),e.transformModifiers!==void 0&&n(113,_e.decodeTransformModifiers(e.transformModifiers)),e.frameMaskDisabled!==void 0&&n(13,e.frameMaskDisabled),e.interactionType!==void 0&&n(36,e.interactionType),e.internalOnly!==void 0&&n(12,e.internalOnly),e.isStateGroup!==void 0&&n(89,e.isStateGroup),e.mask!==void 0&&n(10,e.mask),e.maskIsOutline!==void 0&&n(11,e.maskIsOutline),e.name!==void 0&&n(65,e.name),e.navigationType!==void 0&&n(37,e.navigationType),e.opacity!==void 0&&n(44,Ir.Math_clamp(e.opacity,0,1)),e.overlayBackgroundInteraction!==void 0&&n(39,e.overlayBackgroundInteraction),e.overlayBackgroundAppearance!==void 0&&n(70,_e.decodeOverlayBackgroundAppearance(e.overlayBackgroundAppearance)),e.overlayPositionType!==void 0&&n(38,e.overlayPositionType),e.overlayRelativePosition!==void 0&&n(60,_e.decodeVector(e.overlayRelativePosition)),e.overriddenSymbolID!==void 0&&n(59,_e.decodeGUID(e.overriddenSymbolID)),e.overrideKey!==void 0&&n(58,_e.decodeGUID(e.overrideKey)),e.parentIndex!==void 0&&n(32,_e.decodeParentIndex(e.parentIndex)),e.prototypeBackgroundColor!==void 0&&n(68,_e.decodeColor(e.prototypeBackgroundColor)),e.prototypeDevice!==void 0&&n(69,_e.decodePrototypeDevice(e.prototypeDevice)),e.prototypeStartNodeID!==void 0&&n(72,_e.decodeGUID(e.prototypeStartNodeID)),e.prototypeStartingPoint!==void 0&&n(93,_e.decodePrototypeStartingPoint(e.prototypeStartingPoint)),e.resizeToFit!==void 0&&n(14,e.resizeToFit),e.scrollDirection!==void 0&&n(41,e.scrollDirection),e.size!==void 0&&n(57,_e.decodeVector(e.size)),e.strokeAlign!==void 0&&n(29,e.strokeAlign),e.strokeGeometry!==void 0&&n(77,this.decodeGeometry(e.strokeGeometry,r)),e.strokePaints!==void 0&&n(62,this.decodePaints(e.strokePaints,r)),e.symbolData!==void 0&&n(78,this.decodeSymbolData(e.symbolData,r)),e.videoPlayback!==void 0&&n(75,_e.decodeVideoPlayback(e.videoPlayback)),e.stackReverseZIndex!==void 0&&n(86,e.stackReverseZIndex),e.textData!==void 0&&n(4,this.decodeTextData(e.textData,r)),e.derivedTextData!==void 0&&n(5,this.decodeDerivedTextData(e.derivedTextData,r)),e.vectorData!==void 0&&n(79,this.decodeVectorData(e.vectorData,r)),e.transform!==void 0&&n(30,_e.decodeMatrix(e.transform)),e.transitionNodeID!==void 0&&n(74,_e.decodeGUID(e.transitionNodeID)),e.transitionType!==void 0&&n(34,e.transitionType),e.transitionShouldSmartAnimate!==void 0&&n(19,e.transitionShouldSmartAnimate),e.transitionDuration!==void 0&&n(54,e.transitionDuration),e.transitionTimeout!==void 0&&n(55,e.transitionTimeout),e.interactionMaintained!==void 0&&n(17,e.interactionMaintained),e.interactionDuration!==void 0&&n(56,e.interactionDuration),e.transitionPreserveScroll!==void 0&&n(18,e.transitionPreserveScroll),e.visible!==void 0&&n(8,e.visible),e.styleType!==void 0&&n(40,e.styleType),e.styleIdForFill!==void 0&&n(102,_e.decodeStyleId(e.styleIdForFill)),e.styleIdForStrokeFill!==void 0&&n(103,_e.decodeStyleId(e.styleIdForStrokeFill)),e.styleIdForEffect!==void 0&&n(105,_e.decodeStyleId(e.styleIdForEffect)),e.styleIdForText!==void 0&&n(104,_e.decodeStyleId(e.styleIdForText)),e.horizontalConstraint!==void 0&&n(26,e.horizontalConstraint),e.verticalConstraint!==void 0&&n(27,e.verticalConstraint),e.scrollBehavior!==void 0&&n(42,e.scrollBehavior),e.keyTrigger!==void 0&&n(88,e.keyTrigger),e.prototypeInteractions!==void 0&&n(90,_e.decodePrototypeInteractions(e.prototypeInteractions)),e.objectAnimations!==void 0&&n(91,_e.decodePrototypeInteractions(e.objectAnimations)),e.fontSize!==void 0&&n(3,e.fontSize),e.textAlignHorizontal!==void 0&&n(1,e.textAlignHorizontal),e.textAlignVertical!==void 0&&n(2,e.textAlignVertical),e.strokeWeight!==void 0&&n(51,e.strokeWeight),e.hyperlink!==void 0&&n(6,e.hyperlink),e.mention!==void 0&&n(7,e.mention),e.interactiveSlideConfigData!==void 0&&n(95,e.interactiveSlideConfigData),e.interactiveSlideParticipantData!==void 0&&n(96,e.interactiveSlideParticipantData),e.slideSpeakerNotes!==void 0&&n(109,e.slideSpeakerNotes),e.isSkippedSlide!==void 0&&n(111,e.isSkippedSlide),e.slideSpeakerNotes!==void 0&&n(108,e.slideThumbnailHash),e.transitionType!==void 0&&e.transitionType=="MAGIC_MOVE"&&n(34,"SMART_ANIMATE")}decompressZlibOrZstd(e){let r=new Un;try{let n=gi.inflateRaw(e);r.resolve(n)}catch{let n=new dm;n.init().then(i=>{r.resolve(n.decode(e))},i=>{r.resolve(null)})}return r}async decodeSceneForViewerAndPrototypeLib1(e){return this.decodeSceneForViewerAndPrototypeLib2(e,null)}_isProbablyZipFile(e){return e[0]==80&&e[1]==75}async decodeSceneFromCanvas(e,r){let n=e.length,o=_e.FILE_HEADER.length;if(_e.hasFileHeader(e)&&o+4<=n){let i=_e.readInt32(e,o);if(o=o+4,i>=1&&o+4<=n){let a=_e.readInt32(e,o);if(o=o+4,o+a+4<=n){let s=await this.decompressZlibOrZstd(e.subarray(o,o+a)).realPromise(),l=fm.createKiwiCodec(!!K.getFeatureFlags().use_new_kiwi_codec_in_viewer,fm.decodeBinarySchema(s));o=o+a;let c=_e.readInt32(e,o);if(o=o+4,o+c<=n){let d=e.subarray(o,o+c);o=o+c;let u=!1;for(;o<n;){o+4>e.length&&console.error(`ran out of bytes, ${o} (offset) + 4 > ${e.length} (bytes) but ${o} < ${n} (length)`);let h=_e.readInt32(e,o);if(o=o+4,h==0||h<_e.CHUNK_TAG_LEN)continue;o+_e.CHUNK_TAG_LEN>n&&console.error(`not enough bytes to read chunk tag, ${o} (offset) + ${_e.CHUNK_TAG_LEN} (tag length) > ${n} (length) but chunkLength = ${h}`);let A=e.subarray(o,o+_e.CHUNK_TAG_LEN);o=o+_e.CHUNK_TAG_LEN;let m=h-_e.CHUNK_TAG_LEN;switch(o+m>n&&console.error(`not enough bytes to read data, ${o} (offset) + ${m} (dataLength) > ${n} (length)`),o=o+m,_e.parseChunkType(A)){case _e.ChunkType.THUMBNAIL:{u&&console.error(`hasThumbnail = ${u} and chunk type of ${A} is THUMBNAIL`),u=!0;break}case _e.ChunkType.UNKNOWN:break}}let p=await this.decompressZlibOrZstd(new Uint8Array(d)).realPromise(),_=l.decodeMessage(p);if(_.type!==void 0&&_.type=="NODE_CHANGES"){let h=ft.createScene(ft.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,i);return r!=null&&h.setFileKey(r),h.applyMessageToScene(p),h}}}}}return console.error("Scene decoding from canvas did not successfully create a scene."),null}async decodeSceneForViewerAndPrototypeLib2(e,r){if(this._isProbablyZipFile(e)){let i=(await new ql(new Yl(e)).getEntries()).find(a=>a.filename==="canvas.fig");if(!(i!=null&&i.getData))throw new Error("Cannot find canvas.fig in zip file");e=await i.getData(new zs)}return this.decodeSceneFromCanvas(e,r)}async decodeSceneWithImages(e,r){if(!this._isProbablyZipFile(e))return this.decodeSceneFromCanvas(e,r);let o=await new ql(new Yl(e)).getEntries(),i=null;for(let a of o)if(a.filename==="canvas.fig"){if(!(a!=null&&a.getData))throw new Error("Entry find ${entry.filename} in zip file does not have data");i=await this.decodeSceneFromCanvas(await(a==null?void 0:a.getData(new zs)),r)}else if(/images\/[0-9a-f]+/.test(a.filename)&&(a!=null&&a.getData)){let s=await(a==null?void 0:a.getData(new zs)),l=a.filename.split("/")[1],c=this._imageByHexHashOrNull(l,1);c?c.primeWithCompressedData(s):(c=nn.createImage(nn.hexToBytes(l),s,1),this._imageDecoded(l,1,c));let d=s.slice(0,12).toString()===gS;d&&c.setIsCompressedTexture(d)}return i}static decodeTransformModifiers(e){let r=[];for(let o of e){let i=new pm;i.setType(o.type),o.offset!==void 0&&i.setOffset(_e.decodeVector(o.offset)),o.visible!==void 0&&i.setVisible(o.visible),o.count!==void 0&&i.setCount(o.count),o.repeatType!==void 0&&i.setRepeatType(o.repeatType),o.axis!==void 0&&i.setAxis(o.axis),o.unitType!==void 0&&i.setUnitType(o.unitType),o.order!==void 0&&i.setOrder(o.order),o.skewX!==void 0&&i.setSkewX(o.skewX),o.skewY!==void 0&&i.setSkewY(o.skewY),r.push(i)}let n=r;return ot.asTransformModifierList(n)}};_e.VERBOSE=!1,_e.FILE_HEADER=[102,105,103,45,107,105,119,105],_e.CHUNK_TAG_LEN=8,_e.THUMBNAIL_CHUNK_TAG=[137,80,78,71,13,10,26,10];var ut=_e;(r=>{let t;(i=>(i[i.THUMBNAIL=0]="THUMBNAIL",i[i.UNKNOWN=1]="UNKNOWN"))(t=r.ChunkType||(r.ChunkType={}));class e{constructor(o){this.timeSpentApplyingMessageToSceneMs=o}}r.TimingInfo=e})(ut||(ut={}));var mo;(o=>{function t(i,a){return i==a?!0:i==33?a==74||a==73:!1}o.affects=t;function e(i){return i==61||i==62||i==102||i==103||i==4||i==5}o.affectsImagesUsedByNode=e;function r(i){switch(i){case 114:case 32:case 8:case 111:case 33:case 73:case 56:case 17:case 36:case 41:case 68:case 69:case 90:case 91:case 72:case 93:case 42:case 54:case 74:case 18:case 55:case 34:case 37:case 38:case 60:case 39:case 70:return!0}return!1}o.isPrototypeStructuralChange=r;function n(i){switch(i){case 36:case 17:case 56:case 88:case 92:case 74:case 34:case 54:case 35:case 55:case 19:case 33:case 73:case 60:case 37:case 18:case 4:case 5:return!0}return!1}o.isInteractionProperty=n})(mo||(mo={}));function G1(t,e){switch(e){case 28:return Ve().BlendMode[t];case 33:return Ve().ConnectionType[t];case 26:return Ve().ConstraintType[t];case 27:return Ve().ConstraintType[t];case 35:return Ve().EasingType[t];case 36:return Ve().InteractionType[t];case 37:return Ve().NavigationType[t];case 39:return Ve().OverlayBackgroundInteraction[t];case 41:return Ve().ScrollDirection[t];case 38:return Ve().OverlayPositionType[t];case 114:return Ve().NodePhase[t];case 42:return Ve().ScrollBehavior[t];case 94:return Ve().ShapeWithTextType[t];case 80:return Ve().StackMode[t];case 29:return Ve().StrokeAlign[t];case 40:return Ve().StyleType[t];case 1:return Ve().TextAlignHorizontal[t];case 2:return Ve().TextAlignVertical[t];case 34:return Ve().TransitionType[t];case 25:return Ve().NodeType[t];case 97:return Ve().FlappType[t];default:throw new Error(`Given field ${Lt[e]} is not a string enum field`)}}function gm(t,e,r){switch(Vc(r)){case 0:return t.getBool(e,r);case 1:return t.getDouble(e,r);case 2:return t.getInt(e,r);case 3:return t.getString(e,r);case 4:return G1(t.getInt(e,r),r);case 5:return t.getAffineTransform(e,r);case 6:return t.getArcData(e,r);case 29:return t.getCodeSnapshot(e,r);case 7:return t.getGUID(e,r);case 8:return t.getStyleId(e,r);case 10:return t.getVector(e,r);case 11:return t.getEffectList(e);case 12:return t.getTransformModifierList(e);case 13:return t.getPaintList(e,r);case 16:return t.getParentIndex(e);case 14:case 9:case 20:case 18:case 17:case 19:case 25:case 26:case 27:case 28:return t.getField(e,r);case 21:case 24:return null;case 15:case 22:case 23:case 30:return null;default:return we(`Unhandled node field ${Lt[r]} in getCppNodeValue`),null}}function U1(t,e,r,n,o){switch(Vc(n)){case 0:return t.getBool_SGEO(o);case 1:return t.getDouble_SGEO(o);case 2:return t.getInt_SGEO(o,n);case 3:return t.getString_SGEO(o);case 4:return G1(t.getInt_SGEO(o,n),n);case 5:return t.getAffineTransform_SGEO(o);case 6:return t.getArcData_SGEO(o);case 29:return t.getCodeSnapshot_SGEO(o);case 7:return t.getGUID_SGEO(o);case 8:return t.getStyleId_SGEO(o);case 10:return t.getVector_SGEO(o);case 11:return t.getEffectList_SGEO(o);case 12:return t.getTransformModifierList_SGEO(o);case 13:return t.getPaintList_SGEO(o);case 16:return t.getParentIndex_SGEO(o);case 14:return t.getPrototypeInteractions_SGEO(o);case 9:case 20:case 18:case 17:case 19:case 25:case 26:case 27:case 28:return t.getField_SGEO(o);case 21:case 24:return null;case 15:case 22:case 23:case 30:return null;default:return we(`Unhandled node field ${Lt[n]} in getCppSGEOValue`),null}}function Ki(t,e,r,n){let o=ut.serializeValueToKiwiForTests1(r,n),i=o.a,a=o.b;i.guid=ut.encodeGUID(e.id()),Oh(i,a)}var qu=class{constructor(e){this._imagesByNodeId=null,this._nodeIdsByImage=null,e.addAppObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage=new No(r=>r.objectHash())}imagesUsedByNode(e){return Qe.StringMap_get(this._imagesByNodeId,e,new Map)}nodesUsedByImage(e){return Array.from(this._nodeIdsByImage.get(e,new Map).values())}nodesThatUseAnImage(){return Array.from(this._imagesByNodeId.keys())}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage.clear(),r!=null&&this._addImageNodeReferencesInSubtree(r.root())}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}_trackImageUse(e,r){this._imagesByNodeId.has(e.id())||this._imagesByNodeId.set(e.id(),new Map),this._imagesByNodeId.get(e.id()).set(r.objectHash(),r),this._nodeIdsByImage._in(r)||this._nodeIdsByImage.set(r,new Map),this._nodeIdsByImage.get(r).set(e.id(),e.id())}_removeImageUse(e,r){Array.from(this._imagesByNodeId.keys()).indexOf(e.id())!=-1&&(this._imagesByNodeId.get(e.id()).delete(r.objectHash()),this._imagesByNodeId.get(e.id()).size==0&&this._imagesByNodeId.delete(e.id())),this._nodeIdsByImage._in(r)&&(this._nodeIdsByImage.get(r).delete(e.id()),this._nodeIdsByImage.get(r).size==0&&this._nodeIdsByImage.remove(r))}handleSceneGraphEvent(e){if(e.property===114)return;let r=mo.affectsImagesUsedByNode(e.property);if(!(!(r||e.property==8||e.property==32)||!(e.node.isVisibleInCanvas()||e.property==8&&ot.asBool(e.oldVal)&&!ot.asBool(e.newVal)&&(e.node.parent()!=null&&e.node.parent().isVisibleInCanvas())))){if(r){let o=e.node.collectUniqueUsedImages(),i=Qe.StringMap_get(this._imagesByNodeId,e.node.id(),new Map);for(let a of Array.from(i.keys()))o.has(a)||this._removeImageUse(e.node,i.get(a));for(let a of Array.from(o.keys()))i.has(a)||this._trackImageUse(e.node,o.get(a))}else if(e.property==8){let o=ot.asBool(e.oldVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1),i=ot.asBool(e.newVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1);!o&&i?this._addImageNodeReferencesInSubtree(e.node):o&&!i&&this._removeImageNodeReferencesInSubtree(e.node)}else if(e.property==32){let o=e.oldVal!=null&&ot.isParentIndex(e.oldVal)?ot.asParentIndex(e.oldVal):null,i=e.newVal!=null&&ot.isParentIndex(e.newVal)?ot.asParentIndex(e.newVal):null,a=o!=null?e.node.scene().findNode(o.id):null,s=i!=null?e.node.scene().findNode(i.id):null,l=a!=null&&a.isRooted(),c=s!=null&&s.isRooted();l&&!c?this._removeImageNodeReferencesInSubtree(e.node):!l&&c&&this._addImageNodeReferencesInSubtree(e.node)}}}_removeImageNodeReferencesInSubtree(e){for(let r=0,n=e.childCount();r<n;r=r+1)this._removeImageNodeReferencesInSubtree(e.childAt1(r));e.forEachSinglePaint(r=>{(r.type()=="IMAGE"||r.type()=="EMOJI"||r.type()=="VIDEO")&&(r.image()!=null&&this._removeImageUse(e,r.image()),r.imageThumbnail()!=null&&this._removeImageUse(e,r.imageThumbnail()))}),e.forEachEmojiInTextData(r=>{this._removeImageUse(e,r)})}_addImageNodeReferencesInSubtree(e){if(e.visible()){for(let r=0,n=e.childCount();r<n;r=r+1)this._addImageNodeReferencesInSubtree(e.childAt1(r));e.forEachSinglePaint(r=>{if((r.type()=="IMAGE"||r.type()=="EMOJI"||r.type()=="VIDEO")&&(r.image()!=null&&this._trackImageUse(e,r.image()),r.imageThumbnail()!=null&&this._trackImageUse(e,r.imageThumbnail())),r.type()=="PATTERN"){let n=r.patternSource();n&&n.collectUniqueUsedImages().forEach(i=>{this._trackImageUse(e,i)})}}),e.forEachEmojiInTextData(r=>{this._trackImageUse(e,r)})}}};var Sm=class{clear(){this._images=[],this._imageByHash=new Map}allImages(){return this._images}appendIfMissing(e){this._imageByHash.has(e.objectHash())||(this._imageByHash.set(e.objectHash(),e),this._images.push(e))}count(){return this._images.length}isEmpty(){return this.count()==0}takeFirst(){let e=this._images.shift();return e&&this._imageByHash.delete(e.objectHash()),e}constructor(){this._images=[],this._imageByHash=new Map}};var Am=class{constructor(e,r,n,o){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0,this._numGIFs=0,this._loadType=e,this._delaySeconds=r,this._startCondition=n,this._endCondition=o}reset(){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0}_hasMetStartCondition(){return this._startConditionSeconds>=0}_hasMetEndCondition(){return this._endConditionSeconds>=0}onFrame(){!this._hasMetStartCondition()&&this._startCondition()&&(this._startConditionSeconds=Xe.seconds()),this._hasMetStartCondition()&&!this._hasMetEndCondition()&&this._endCondition()&&(this._endConditionSeconds=Xe.seconds()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&Xe.seconds()-this._endConditionSeconds>=this._delaySeconds&&(this.trackEvent(),this.reset()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&!this._endCondition()&&(this._endConditionSeconds=-1)}trackSuccess(e){this._hasMetStartCondition()&&(this._numSuccesses=this._numSuccesses+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackFailure(e){this._hasMetStartCondition()&&(this._numFailures=this._numFailures+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackEvent(){be.trackEvent("images_loaded",{viewer_mode:K.getViewerMode(),load_type:this._loadType,num_successes:this._numSuccesses,num_failures:this._numFailures,num_gifs:this._numGIFs,duration_s:this._endConditionSeconds-this._startConditionSeconds,fast_image_decode:nn.browserSupportsFastImageDecoding()},{forwardToDatadog:!0})}};var ss=class t{delayBetweenInvalidations(){return yo||ta?0:K.useReducedImageLoadingInvalidateDelay()?1:2}constructor(e,r){this._scene=null,this._appState=e,this._previousFileKey="",this._imageResources=new Map,this._emojiResources=new Map,this.MAX_SIMULTANEOUS_PRELOADING=4,this._imageQueue=new nh,this._outboundRequestPriorities=new Map,this._requestsInFlight=0,this._needsUpdate=!1,this._needAllThumbnails=!0,this._newlyLoadedImages=new Sm,this._topLevelGuidsNeeded=new no,this.onImageLoaded=null,this.lastImageLoadedCallbackTime=0,this._pendingRequestSuccessForImage=new Map,this._pendingRequestFailureForImage=new Map,this._shouldInvestigateNextImageFailure=!0,Mn()!==null&&!Mn().getImageMemoryStats&&(Mn().getImageMemoryStats=()=>{let o=Kr.getMax("WEBGL_TEXTURE (Image)"),i=Kr.getMax("Decoded image data in RAM (MB)");return{vramMaxForImages:o,ramMaxForImages:i}},Mn().getNumRequestsInFlight=()=>this._requestsInFlight),this._imageUseTracker=new qu(e),this._prototypeStructure=e.prototypeStructure(),this._showImageFetchFailureUI=r,e.addAppObserver(this),e.addFrameObserver(this),e.prototypeState().addObserver(this);let n=2.5;this._thumbLoadTracker=new Am("thumbs_loaded",n,()=>this._computeTopImagePriority().type==4,()=>this._computeTopImagePriority().type<4),this._fullsizeImageLoadTracker=new Am("fullsize_images_loaded",n,()=>this._computeTopImagePriority().type>=3,()=>this._computeTopImagePriority().type<3)}handleStateChangeAborted(e){}handleStateChangeCommitted(e,r){}handleStateChangeInitiated(e){var r,n;if(vn.advanceGeneration(),e.oldStateId()==null&&this._onTransitionGraphChange(),this._restartGIFsOnEnteringScreens(e),this.clearUnneededTextures(e),this._needAllThumbnails){let o=(n=(r=this._scene)==null?void 0:r.findNode(e.newStateId()))==null?void 0:n.canvas();this.preloadAllThumbnails(o)}}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){}clearQueuesAndDecodedDataForAllImages(e){this._imageQueue.clear(),this._clearDecodedDataForAllImagesRecursive(e)}_clearDecodedDataForAllImagesRecursive(e){if(e!=null){this.clearDecodedDataForAllImages(e);for(let r=0,n=e.childCount();r<n;r=r+1){let o=e.childAt1(r);this._clearDecodedDataForAllImagesRecursive(o)}}}clearDecodedDataForAllImages(e){this._appState.isPreloaded||(e.forEachSinglePaint(r=>{if(r.image()==null)return;let n=this._imageUseTracker.nodesUsedByImage(r.image());r.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var i,a;(a=(i=this._scene)==null?void 0:i.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}),e.forEachSinglePaint(r=>{if(r.imageThumbnail()==null)return;let n=this._imageUseTracker.nodesUsedByImage(r.imageThumbnail());r.imageThumbnail().freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var i,a;(a=(i=this._scene)==null?void 0:i.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(r=>{let n=this._imageUseTracker.nodesUsedByImage(r);r.freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var i,a;(a=(i=this._scene)==null?void 0:i.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}))}clearQueuesAndDecodedDataForFullResolutionImages(e){this._imageQueue.clear();let r=this._appState.currentFileKey();e!=null&&this._previousFileKey!=null&&this._previousFileKey.length>1&&r!=this._previousFileKey&&this._clearDecodedDataForFullResolutionImagesRecursive(e),this._previousFileKey=r}_clearDecodedDataForFullResolutionImagesRecursive(e){if(e!=null){this.clearDecodedDataForFullResolutionImages(e);for(let r=0,n=e.childCount();r<n;r=r+1){let o=e.childAt1(r);this._clearDecodedDataForFullResolutionImagesRecursive(o)}}}clearDecodedDataForFullResolutionImages(e){this._appState.isPreloaded||(e.forEachSinglePaint(r=>{var o,i;if(r.image()==null||r.imageThumbnail()!=null&&r.image().objectHash()==r.imageThumbnail().objectHash()||!r.image().isDecoded())return;let n=this._imageUseTracker.nodesUsedByImage(r.image());for(let a of n){let s=(i=(o=this._scene)==null?void 0:o.findNode(a))==null?void 0:i.topLevelAncestor();if(s!=null&&this._topLevelGuidsNeeded._in(s.id()))return}r.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(a=>{var s,l;(l=(s=this._scene)==null?void 0:s.findNode(a))==null||l.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(r=>{var o,i;let n=this._imageUseTracker.nodesUsedByImage(r);for(let a of n){let s=(i=(o=this._scene)==null?void 0:o.findNode(a))==null?void 0:i.topLevelAncestor();if(s!=null&&this._topLevelGuidsNeeded._in(s.id()))return}r.freeMemoryForDecodedDataAndTexture()&&n.forEach(a=>{var s,l;(l=(s=this._scene)==null?void 0:s.findNode(a))==null||l.invalidateRenderTreeForSelfAndParents()})}))}_restartGIFsOnEnteringScreens(e){var o,i;if(e.newStateId()!=null&&e.newStateId()!=e.oldStateId()){let a=(o=this._scene)==null?void 0:o.findNode(e.newStateId());a!=null&&this._restartGIFsInSubtree(a)}let r=e.newOverlayData(),n=e.oldOverlayData();for(let a=0,s=r.length;a<s;a=a+1)if(a>=n.length||n[a].id!=r[a].id){let l=(i=this._scene)==null?void 0:i.findNode(r[a].id);l!=null&&this._restartGIFsInSubtree(l)}}_restartGIFsInSubtree(e){e.restartGifs(),e.forEachChild(r=>{this._restartGIFsInSubtree(r)})}clearUnneededTextures(e){if(!(this._scene==null||this._appState.isPreloaded)&&this._appState.baseScreenId()!=null){this._topLevelGuidsNeeded=new no,this._prototypeStructure.getPrerenderingJobs().forEach(r=>{let n=r.asScreen();n!=null&&this._topLevelGuidsNeeded.add(n.nodeId)}),e.oldStateId()!=null&&this._topLevelGuidsNeeded.add(e.oldStateId()),e.newStateId()!=null&&this._topLevelGuidsNeeded.add(e.newStateId());for(let r of this._imageUseTracker.nodesThatUseAnImage()){let n=this._scene.findNode(Q.fromString(r));if(n==null)continue;let o=n.topLevelAncestor();o!=null&&this._topLevelGuidsNeeded._in(o.id())||this.clearDecodedDataForFullResolutionImages(n)}}}handleSceneChange(e,r){e!=null&&this.clearQueuesAndDecodedDataForFullResolutionImages(e.root()),this._scene=r,this._needAllThumbnails=!0,e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._onTransitionGraphChange()}preloadAllThumbnails(e){this._scene==null||e==null||(Qe.StringMap_each(t.getThumbnailsInSubtree(e),(r,n)=>{this._imageQueue.insertOrUpdate(n,vn.OTHER)}),this._needAllThumbnails=!1)}handleActiveCanvasChange(e,r){this.clearQueuesAndDecodedDataForFullResolutionImages(e),this.preloadAllThumbnails(r)}handleActivePrototypeStartingPointChange(e,r){}handleSceneGraphEvent(e){(e.property==74||e.property==72||e.property==32)&&this._onTransitionGraphChange()}resetForRenderingTests(){this._imageQueue.clear(),this._newlyLoadedImages.clear(),this.lastImageLoadedCallbackTime=0}onFrame(){this._needsUpdate&&this._traverseSceneForImages(),!this._newlyLoadedImages.isEmpty()&&Xe.seconds()-this.lastImageLoadedCallbackTime>=this.delayBetweenInvalidations()&&(this.lastImageLoadedCallbackTime=Xe.seconds(),this._onImagesLoaded()),this._thumbLoadTracker.onFrame(),this._fullsizeImageLoadTracker.onFrame(),this._needsUpdate=!1}_computeTopImagePriority(){let e=vn.OTHER;this._imageQueue.count()>0&&(e=vn.max(e,this._imageQueue.maxPriority().value));for(let r of Array.from(this._outboundRequestPriorities.values()))e=vn.max(e,r);return e}findImageByHexHash(e,r){return r==0?Qe.StringMap_get(this._emojiResources,e,null):Qe.StringMap_get(this._imageResources,e,null)}getImageLoadingProgress(){let e=this._imageResources.size+this._emojiResources.size,r=0;return this._imageResources.forEach(n=>{(n.isDecoded()||n.loadDidFail()&&!n.failureIsRetryable())&&r++}),this._emojiResources.forEach(n=>{(n.isDecoded()||n.loadDidFail()&&!n.failureIsRetryable())&&r++}),{loaded:r,total:e}}static getImagesInSubtree(e){let r=new Map,n=new Map;t._getImagesInSubtree(e,r,n);let o=[];return r.forEach(i=>{o.push(i)}),n.forEach(i=>{o.push(i)}),o}preloadAllImages(){var n;let e=(n=this._appState.scene())==null?void 0:n.root();if(!e)return;let r=t.getImagesInSubtree(e);for(let o of r)this._imageQueue.insertOrUpdate(o,vn.OTHER)}onNewImage(e,r,n){let o=r==0?this._emojiResources:this._imageResources;o.has(e)||(o.set(e,n),this._appState.baseScreenId()==null)||(this._imageQueue.insertOrUpdate(n,vn.OTHER),this._processNextItemFromRenderQueues())}requestImageForRendering(e,r){this._imageQueue.insertOrUpdate(e,r),this._processNextItemFromRenderQueues()}_onImagesLoaded(){var e;if(this.onImageLoaded!=null){if(this._scene!=null)for(let r=0,n=this._newlyLoadedImages.allImages().length;r<n;r=r+1){let o=this._newlyLoadedImages.allImages()[r];this._appState.editorType()==="COOPER"&&((e=o.gif())==null||e.setAutoplay(!1));for(let i of this._imageUseTracker.nodesUsedByImage(o)){let a=this._scene.findNode(i);a!=null&&this.onImageLoaded(a)}}this._newlyLoadedImages.clear()}}_onTransitionGraphChange(){this._needsUpdate=!0}_traverseSceneForImages(){let e=this._appState.baseScreenId();this._scene!=null&&e!=null&&this._processNextItemFromRenderQueues()}postMessageToPerfTests(e){Mn().figmaPerfTesting&&Mn().postMessage({name:e,value:0},"*")}incrementRequestsInFlight(e){this._requestsInFlight=this._requestsInFlight+e,Kr.trackNumber("Image requests in flight",this._requestsInFlight),this._requestsInFlight==0&&this.postMessageToPerfTests("IMAGES_FINISHED_LOADING")}_requestImage(e,r,n,o){this._pendingRequestSuccessForImage.has(e.objectHash())||this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestSuccessForImage.get(e.objectHash()).push(n),this._pendingRequestFailureForImage.has(e.objectHash())||this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.get(e.objectHash()).push(o),e!=null&&e.state()==1&&this._processNextItemFromRenderQueues(),this._outboundRequestPriorities.set(e.objectHash(),vn.max(r,Qe.StringMap_get(this._outboundRequestPriorities,e.objectHash(),vn.OTHER))),this.incrementRequestsInFlight(1),e.fetchAndDecode(1,i=>{this._thumbLoadTracker.trackSuccess(e.imageType()),this._fullsizeImageLoadTracker.trackSuccess(e.imageType()),this.incrementRequestsInFlight(-1),this._newlyLoadedImages.appendIfMissing(e);let a=this._pendingRequestSuccessForImage.get(e.objectHash())??[];for(let s of a)s(i);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash()),this._processNextItemFromRenderQueues()},i=>{if((Ds.ImagePriorityType_isOnScreen(r.type)||Ds.ImagePriorityType_isPrerender(r.type))&&i==0&&this._shouldInvestigateNextImageFailure){this._shouldInvestigateNextImageFailure=!1;let l=c=>{c==0?(this._showImageFetchFailureUI(),be.trackEvent("show_image_failure_ui",{imagePriority:Eu[r.type]})):this._shouldInvestigateNextImageFailure=!0};new Vo(e.url()).get().then(c=>{l(c.status)},c=>{l(c.status)})}this._thumbLoadTracker.trackFailure(e.imageType()),this._fullsizeImageLoadTracker.trackFailure(e.imageType()),this.incrementRequestsInFlight(-1),this._processNextItemFromRenderQueues();let s=this._pendingRequestFailureForImage.get(e.objectHash())??[];for(let l of s)l(r);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash())})}_processNextItemFromRenderQueues(){if(this._requestsInFlight>=this.MAX_SIMULTANEOUS_PRELOADING||this._imageQueue.count()==0)return;let e=this._imageQueue.peek(),r=this._imageQueue.getPriority(e);this._imageQueue.remove(e),this._requestImage(e,r.value,n=>{},n=>{var i;if(n.type==2||n.type==4)for(let a of this._imageUseTracker.nodesUsedByImage(e)){let s=(i=this._scene)==null?void 0:i.findNode(a);s!=null&&s.forEachSinglePaint(l=>{let c=l.imageThumbnail()!=null&&l.imageThumbnail().objectHash()==e.objectHash(),d=l.imageThumbnail()!=null&&l.image()!=null&&l.image().objectHash()==l.imageThumbnail().objectHash();if(c&&!d&&l.image()!=null){let u=e!=null?e.objectHash():null,p=l.image()!=null?l.image().objectHash():null;console.warn(`Failed to fetch thumbnail ${u}; fetching full size image ${p}`);let _=n.type==2?vn.forType(1):n.type==4?vn.forType(3):vn.OTHER;this.requestImageForRendering(l.image(),_)}})}})}hasPendingImages(){return this._needsUpdate||this._requestsInFlight>0||Ds.ImagePriorityType_isOnScreen(this._computeTopImagePriority().type)||!this._newlyLoadedImages.isEmpty()}static getThumbnailsInSubtree(e){let r=new Map,n=new Map;return t._getImagesInSubtree(e,r,n),n}static _getImagesInSubtree(e,r,n){e.forEachSinglePaint(o=>{o.image()!=null&&r.set(o.image().objectHash(),o.image()),o.imageThumbnail()!=null&&n.set(o.imageThumbnail().objectHash(),o.imageThumbnail())}),e.forEachEmojiInTextData(o=>{n.set(o.objectHash(),o)});for(let o=0,i=e.childCount();o<i;o=o+1){let a=e.childAt1(o);t._getImagesInSubtree(a,r,n)}}};var Tm=class{baseNodeTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.baseNodeTsApiGenerated}codeFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.codeFacetTsApiGenerated}codeBehaviorFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.codeBehaviorFacetTsApiGenerated}geometryFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.geometryFacetTsApiGenerated}instanceFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.instanceFacetTsApiGenerated}interactiveSlideElementFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.interactiveSlideElementFacetTsApiGenerated}renderableRectangleFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.renderableRectangleFacetTsApiGenerated}slideFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.slideFacetTsApiGenerated}textFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.textFacetTsApiGenerated}viewerStateFacetTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.viewerStateFacetTsApiGenerated}};var ls;(r=>{function t(n){return n!=-1}r.WeakHandle_isValid=t;function e(n){return n}r.WeakHandle_toInt=e})(ls||(ls={}));var Em=class{textAlignHorizontal(){F().prepareCppNodeForAccess(this);let e=F().textFacetTsApiGenerated().getTextAlignHorizontal(te.PROTOTYPE_LIB);return Ve().TextAlignHorizontal[e]}setTextAlignHorizontal(e){F().prepareCppNodeForAccess(this);let r=Ve().TextAlignHorizontal[e];F().textFacetTsApiGenerated().setTextAlignHorizontal(r,te.PROTOTYPE_LIB)}textAlignVertical(){F().prepareCppNodeForAccess(this);let e=F().textFacetTsApiGenerated().getTextAlignVertical(te.PROTOTYPE_LIB);return Ve().TextAlignVertical[e]}setTextAlignVertical(e){F().prepareCppNodeForAccess(this);let r=Ve().TextAlignVertical[e];F().textFacetTsApiGenerated().setTextAlignVertical(r,te.PROTOTYPE_LIB)}fontSize(){return F().prepareCppNodeForAccess(this),F().textFacetTsApiGenerated().getFontSize(te.PROTOTYPE_LIB)}setFontSize(e){F().prepareCppNodeForAccess(this);let r=e;F().textFacetTsApiGenerated().setFontSize(r,te.PROTOTYPE_LIB)}visible(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getVisible(te.PROTOTYPE_LIB)}setVisible(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setVisible(r,te.PROTOTYPE_LIB)}isBackgroundEnabled(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getBackgroundEnabled(te.PROTOTYPE_LIB)}setIsBackgroundEnabled(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setBackgroundEnabled(r,te.PROTOTYPE_LIB)}isMask(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getIsMask(te.PROTOTYPE_LIB)}setIsMask(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setIsMask(r,te.PROTOTYPE_LIB)}isMaskOutline_DEPRECATED(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getIsMaskOutline_DEPRECATED(te.PROTOTYPE_LIB)}setIsMaskOutline_DEPRECATED(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setIsMaskOutline_DEPRECATED(r,te.PROTOTYPE_LIB)}isInternalOnly(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getIsInternalOnly(te.PROTOTYPE_LIB)}setIsInternalOnly(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setIsInternalOnly(r,te.PROTOTYPE_LIB)}isFrameMaskDisabled(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getIsFrameClippingDisabled(te.PROTOTYPE_LIB)}setIsFrameMaskDisabled(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setIsFrameClippingDisabled(r,te.PROTOTYPE_LIB)}isResizeToFit(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getResizeToFit(te.PROTOTYPE_LIB)}setIsResizeToFit(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setResizeToFit(r,te.PROTOTYPE_LIB)}rectangleCornerRadiiIndependent(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getRectangleCornerRadiiIndependent(te.PROTOTYPE_LIB)}setRectangleCornerRadiiIndependent(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setRectangleCornerRadiiIndependent(r,te.PROTOTYPE_LIB)}rectangleCornerToolIndependent(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getRectangleCornerToolIndependent(te.PROTOTYPE_LIB)}setRectangleCornerToolIndependent(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setRectangleCornerToolIndependent(r,te.PROTOTYPE_LIB)}borderTopWeight(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getBorderTopWeight(te.PROTOTYPE_LIB)}setBorderTopWeight(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setBorderTopWeight(r,te.PROTOTYPE_LIB)}borderBottomWeight(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getBorderBottomWeight(te.PROTOTYPE_LIB)}setBorderBottomWeight(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setBorderBottomWeight(r,te.PROTOTYPE_LIB)}borderLeftWeight(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getBorderLeftWeight(te.PROTOTYPE_LIB)}setBorderLeftWeight(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setBorderLeftWeight(r,te.PROTOTYPE_LIB)}borderRightWeight(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getBorderRightWeight(te.PROTOTYPE_LIB)}setBorderRightWeight(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setBorderRightWeight(r,te.PROTOTYPE_LIB)}borderStrokeWeightsIndependent(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getBorderStrokeWeightsIndependent(te.PROTOTYPE_LIB)}setBorderStrokeWeightsIndependent(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setBorderStrokeWeightsIndependent(r,te.PROTOTYPE_LIB)}horizontalConstraint(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getHorizontalConstraint(te.PROTOTYPE_LIB);return Ve().ConstraintType[e]}setHorizontalConstraint(e){F().prepareCppNodeForAccess(this);let r=Ve().ConstraintType[e];F().nodeTsApiGenerated().setHorizontalConstraint(r,te.PROTOTYPE_LIB)}verticalConstraint(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getVerticalConstraint(te.PROTOTYPE_LIB);return Ve().ConstraintType[e]}setVerticalConstraint(e){F().prepareCppNodeForAccess(this);let r=Ve().ConstraintType[e];F().nodeTsApiGenerated().setVerticalConstraint(r,te.PROTOTYPE_LIB)}blendMode(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getBlendMode(te.PROTOTYPE_LIB);return Ve().BlendMode[e]}setBlendMode(e){F().prepareCppNodeForAccess(this);let r=Ve().BlendMode[e];F().nodeTsApiGenerated().setBlendMode(r,te.PROTOTYPE_LIB)}strokeAlign(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getStrokeAlign(te.PROTOTYPE_LIB);return Ve().StrokeAlign[e]}setStrokeAlign(e){F().prepareCppNodeForAccess(this);let r=Ve().StrokeAlign[e];F().nodeTsApiGenerated().setStrokeAlign(r,te.PROTOTYPE_LIB)}overlayPositionType(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getOverlayPositionType(te.PROTOTYPE_LIB);return Ve().OverlayPositionType[e]}setOverlayPositionType(e){F().prepareCppNodeForAccess(this);let r=Ve().OverlayPositionType[e];F().nodeTsApiGenerated().setOverlayPositionType(r,te.PROTOTYPE_LIB)}overlayBackgroundInteraction(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getOverlayBackgroundInteraction(te.PROTOTYPE_LIB);return Ve().OverlayBackgroundInteraction[e]}setOverlayBackgroundInteraction(e){F().prepareCppNodeForAccess(this);let r=Ve().OverlayBackgroundInteraction[e];F().nodeTsApiGenerated().setOverlayBackgroundInteraction(r,te.PROTOTYPE_LIB)}styleType(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getStyleType(te.PROTOTYPE_LIB);return Ve().StyleType[e]}setStyleType(e){F().prepareCppNodeForAccess(this);let r=Ve().StyleType[e];F().nodeTsApiGenerated().setStyleType(r,te.PROTOTYPE_LIB)}overflowDirection(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getOverflowDirection(te.PROTOTYPE_LIB);return Ve().ScrollDirection[e]}setOverflowDirection(e){F().prepareCppNodeForAccess(this);let r=Ve().ScrollDirection[e];F().nodeTsApiGenerated().setOverflowDirection(r,te.PROTOTYPE_LIB)}scrollBehavior(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getScrollBehavior(te.PROTOTYPE_LIB);return Ve().ScrollBehavior[e]}setScrollBehavior(e){F().prepareCppNodeForAccess(this);let r=Ve().ScrollBehavior[e];F().nodeTsApiGenerated().setScrollBehavior(r,te.PROTOTYPE_LIB)}maskType(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getMaskType(te.PROTOTYPE_LIB);return Ve().MaskType[e]}setMaskType(e){F().prepareCppNodeForAccess(this);let r=Ve().MaskType[e];F().nodeTsApiGenerated().setMaskType(r,te.PROTOTYPE_LIB)}opacity(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getOpacity(te.PROTOTYPE_LIB)}setOpacity(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setOpacity(r,te.PROTOTYPE_LIB)}localOpacity(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getLocalOpacity(te.PROTOTYPE_LIB)}setLocalOpacity(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setLocalOpacity(r,te.PROTOTYPE_LIB)}backgroundOpacity(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getBackgroundOpacity(te.PROTOTYPE_LIB)}setBackgroundOpacity(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setBackgroundOpacity(r,te.PROTOTYPE_LIB)}rectangleTopLeftCornerRadius(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getRectangleTopLeftCornerRadius(te.PROTOTYPE_LIB)}setRectangleTopLeftCornerRadius(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setRectangleTopLeftCornerRadius(r,te.PROTOTYPE_LIB)}rectangleTopRightCornerRadius(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getRectangleTopRightCornerRadius(te.PROTOTYPE_LIB)}setRectangleTopRightCornerRadius(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setRectangleTopRightCornerRadius(r,te.PROTOTYPE_LIB)}rectangleBottomLeftCornerRadius(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getRectangleBottomLeftCornerRadius(te.PROTOTYPE_LIB)}setRectangleBottomLeftCornerRadius(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setRectangleBottomLeftCornerRadius(r,te.PROTOTYPE_LIB)}rectangleBottomRightCornerRadius(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getRectangleBottomRightCornerRadius(te.PROTOTYPE_LIB)}setRectangleBottomRightCornerRadius(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setRectangleBottomRightCornerRadius(r,te.PROTOTYPE_LIB)}strokeWeight(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getStrokeWeight(te.PROTOTYPE_LIB)}setStrokeWeight(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setStrokeWeight(r,te.PROTOTYPE_LIB)}cornerRadius(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getCornerRadius(te.PROTOTYPE_LIB)}setCornerRadius(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setCornerRadius(r,te.PROTOTYPE_LIB)}cornerSmoothing(){return F().prepareCppNodeForAccess(this),F().renderableRectangleFacetTsApiGenerated().getCornerSmoothing(te.PROTOTYPE_LIB)}setCornerSmoothing(e){F().prepareCppNodeForAccess(this);let r=e;F().renderableRectangleFacetTsApiGenerated().setCornerSmoothing(r,te.PROTOTYPE_LIB)}sizeVectorF(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getSize(te.PROTOTYPE_LIB)}setSizeVectorF(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setSize(r,te.PROTOTYPE_LIB)}overrideKey(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getOverrideKey(te.PROTOTYPE_LIB)}setOverrideKey(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setOverrideKey(r,te.PROTOTYPE_LIB)}overriddenSymbolID(){return F().prepareCppNodeForAccess(this),F().instanceFacetTsApiGenerated().getOverriddenSymbolID(te.PROTOTYPE_LIB)}arcData(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getArcData(te.PROTOTYPE_LIB)}setArcData(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setArcData(r,te.PROTOTYPE_LIB)}stackPaddingLeft(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getStackPaddingLeft(te.PROTOTYPE_LIB)}setStackPaddingLeft(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setStackPaddingLeft(r,te.PROTOTYPE_LIB)}stackPaddingTop(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getStackPaddingTop(te.PROTOTYPE_LIB)}setStackPaddingTop(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setStackPaddingTop(r,te.PROTOTYPE_LIB)}stackPaddingRight(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getStackPaddingRight(te.PROTOTYPE_LIB)}setStackPaddingRight(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setStackPaddingRight(r,te.PROTOTYPE_LIB)}stackPaddingBottom(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getStackPaddingBottom(te.PROTOTYPE_LIB)}setStackPaddingBottom(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setStackPaddingBottom(r,te.PROTOTYPE_LIB)}stackSpacing(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getStackSpacing(te.PROTOTYPE_LIB)}setStackSpacing(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setStackSpacing(r,te.PROTOTYPE_LIB)}stackReverseZIndex(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getStackReverseZIndex(te.PROTOTYPE_LIB)}setStackReverseZIndex(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setStackReverseZIndex(r,te.PROTOTYPE_LIB)}stackCounterSpacing(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getStackCounterSpacing(te.PROTOTYPE_LIB)}setStackCounterSpacing(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setStackCounterSpacing(r,te.PROTOTYPE_LIB)}isStateGroup(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getIsStateGroup(te.PROTOTYPE_LIB)}setIsStateGroup(e){F().prepareCppNodeForAccess(this);let r=e;F().nodeTsApiGenerated().setIsStateGroup(r,te.PROTOTYPE_LIB)}shapeWithTextType(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getShapeWithTextType(te.PROTOTYPE_LIB);return Ve().ShapeWithTextType[e]}setShapeWithTextType(e){F().prepareCppNodeForAccess(this);let r=Ve().ShapeWithTextType[e];F().nodeTsApiGenerated().setShapeWithTextType(r,te.PROTOTYPE_LIB)}interactiveSlideElementType(){F().prepareCppNodeForAccess(this);let e=F().interactiveSlideElementFacetTsApiGenerated().getInteractiveSlideElementType(te.PROTOTYPE_LIB);return Ve().FlappType[e]}setInteractiveSlideElementType(e){F().prepareCppNodeForAccess(this);let r=Ve().FlappType[e];F().interactiveSlideElementFacetTsApiGenerated().setInteractiveSlideElementType(r,te.PROTOTYPE_LIB)}usedAsBaseScreen(){return F().prepareCppNodeForAccess(this),F().viewerStateFacetTsApiGenerated().getUsedAsBaseScreen(te.PROTOTYPE_LIB)}setUsedAsBaseScreen(e){F().prepareCppNodeForAccess(this);let r=e;F().viewerStateFacetTsApiGenerated().setUsedAsBaseScreen(r,te.PROTOTYPE_LIB)}hasBeenLoaded(){return F().prepareCppNodeForAccess(this),F().viewerStateFacetTsApiGenerated().getHasBeenLoaded(te.PROTOTYPE_LIB)}setHasBeenLoaded(e){F().prepareCppNodeForAccess(this);let r=e;F().viewerStateFacetTsApiGenerated().setHasBeenLoaded(r,te.PROTOTYPE_LIB)}isSkippedSlide(){return F().prepareCppNodeForAccess(this),F().slideFacetTsApiGenerated().getIsSkippedSlide(te.PROTOTYPE_LIB)}setIsSkippedSlide(e){F().prepareCppNodeForAccess(this);let r=e;F().slideFacetTsApiGenerated().setIsSkippedSlide(r,te.PROTOTYPE_LIB)}};var _a;(a=>{function t(s){return s.hasNodeProperty?K.getFeatureFlags().prototype_fix_scrolling_hotspots?s.hasNodeProperty(98)&&s.hasOverflowingContentInScrollDirection():s.hasNodeProperty(98):s.scrollDirection()!="NONE"&&s.hasOverflowingContentInScrollDirection()}function e(s,l,c,d,u){let p=s.stickyNodeInitialTopPosition,_=s.overflowingAncestorInitialTopPosition,h=p-_;if(d)return c.y()>h?ge.FrozenVector_new4(c.x(),h):c;{if(u)return ge.FrozenVector_new4(0,0);let A=l(),m=s.stickyNodeHeight,g=s.parentNodeHeight,S=s.parentNodeInitialTopPosition,E=p-S+m,P=g-E,T=A.y()>h&&A.y()<=h+P,f=A.y()>h+P;return T?ge.FrozenVector_new4(0,h-A.y()):f?ge.FrozenVector_new4(0,-P):ge.FrozenVector_new4(0,0)}}a.getRelativeScrollTranslationOfStickyScrollingNodeFromBounds=e;function r(s){let l=s.parent();if(l==null)return ge.FrozenVector_new4(0,0);let c=l.parent(),d=l.isFixed()&&c!=null&&t(c),u=t(l);if(s.isStandardScrolling()){let p=K.getFeatureFlags().prototype_parallax_scroll&&!o(s)?s.scrollSpeedMultiplier():1;if(u){let _=l.scrollOffset();return ge.FrozenVector_new4(_.x(),_.y()*p)}else return p!=1?n(l).multiplyScalar(p-1):ge.FrozenVector_ZERO}else if(s.isStickyScrolling()){let p=l;for(;p!=null&&!t(p);)p=p.parent();if(p==null)return ge.FrozenVector_ZERO;let _=s.absoluteTransform().m12(),h=s.size().y(),A=l.absoluteTransform().m12(),m=l.size().y(),g=p.absoluteTransform().m12(),S=new i(_,h,A,m,g);return e(S,()=>n(l),l.scrollOffset(),u,d)}return ge.FrozenVector_ZERO}a.getScrollTranslationOfNodeRelativeToParent=r;function n(s){let l=ge.FrozenVector_ZERO,c=s;for(;c!=null&&(!t(c)||c==s);){let d=r(c);l=l.add(d),c=c.parent()}return l}a.getScrollTranslationOfNodeRelativeToOverflowingAncestor=n;function o(s){let l=s;for(;l!=null;){if(l.isStickyScrolling())return!0;l=l.parent()}return!1}a.hasStickyScrollingAncestor=o;class i{constructor(l,c,d,u,p){this.stickyNodeInitialTopPosition=l,this.stickyNodeHeight=c,this.parentNodeInitialTopPosition=d,this.parentNodeHeight=u,this.overflowingAncestorInitialTopPosition=p}}a.StickyScrollBounds=i})(_a||(_a={}));var bn;(o=>{function t(i){return i!="NONE"}o.hasExplicitOverflow=t;function e(i){return i=="HORIZONTAL"||i=="BOTH"}o.scrollsHorizontally=e;function r(i){return i=="VERTICAL"||i=="BOTH"}o.scrollsVertically=r;function n(i,a){switch(i){case"VERTICAL":return Math.abs(a.y());case"HORIZONTAL":return Math.abs(a.x());case"BOTH":return Math.abs(a.length());default:break}return 0}o.getDirectionSimilarity=n})(bn||(bn={}));var MA;(e=>{function t(r){let n=r,o=r.parent(),i=new O(0,0);for(;o!=null&&o.type()!="CANVAS";){let a=o.scrollDirection()!="NONE"&&o.hasNodeProperty(98),s=n.isFixed();a&&!s&&i.addUpdate1(o.scrollOffset()),n=o,o=o.parent()}return i}e.cumulativeScrollOffsetOfAncestors=t})(MA||(MA={}));function V1(t){switch(t){case"VERTICAL":return new O(0,1);case"HORIZONTAL":return new O(1,0);case"BOTH":{let e=new O(1,1);return e.divideScalar(e.length())}default:break}return O.new()}var Rm=(n=>(n[n.BASE_SCREEN=0]="BASE_SCREEN",n[n.OVERLAY_OR_SUBLAYER=1]="OVERLAY_OR_SUBLAYER",n[n.DETERMINE_USING_NODE_FIELDS=2]="DETERMINE_USING_NODE_FIELDS",n))(Rm||{}),Im=class{constructor(e){this._node=null,this._overrideRole=null,this._node=e}overrideRole(e){this._overrideRole=new pe(e)}clearRoleOverride(){this._overrideRole=null}_role(){return this._overrideRole!=null?this._overrideRole.value:2}canvasSpaceContentBounds(){return this.scrollDirection()=="NONE"?this._node.canvasSpaceRenderedBounds():this._scrollableContentBounds()}defaultScrollOffset(){return this._node.canvasSpaceBoundingBox().topLeft().subtract(this.canvasSpaceContentBounds().topLeft())}minScrollOffsetX(){return-this.defaultScrollOffset().x()}minScrollOffsetY(){return-this.defaultScrollOffset().y()}maxScrollOffsetX(){return Math.max(this.minScrollOffsetX(),this.canvasSpaceContentBounds().right()-this._node.canvasSpaceBoundingBox().right())}maxScrollOffsetY(){return Math.max(this.minScrollOffsetY(),this.canvasSpaceContentBounds().bottom()-this._node.canvasSpaceBoundingBox().bottom())}hasOverflowingContentInXDirection(){return bn.scrollsHorizontally(this.scrollDirection())&&this.canvasSpaceContentBounds().width()>this._node.canvasSpaceBoundingBox().width()}hasOverflowingContentInYDirection(){return bn.scrollsVertically(this.scrollDirection())&&this.canvasSpaceContentBounds().height()>this._node.canvasSpaceBoundingBox().height()}shouldResizeToFitViewport(){return Qt.isFrameLike(this._node.type())?(this._role()==2?this._node.isTopLevel():this._role()==0)&&!this._node.isTooRotatedToScroll():!1}nodeSize(){if(this.shouldResizeToFitViewport()){let e=this._node.findContainingCanvasOrParent(),r=e.prototypeDevice(),n=e.currentViewportSize(),o=r.type=="NONE"||r.type=="PRESENTATION"?n:r.size();return new O(Math.min(this._node.fullSize().x(),o.x()),Math.min(this._node.fullSize().y(),o.y()))}else return this._node.fullSize()}nodeSpaceScrollableContentBounds(){let e=this._role()==2?this._node.isTopLevel():this._role()==0,r=!bn.hasExplicitOverflow(this._node.overflowDirection()),n=e?r:!this._node.isFrameMaskDisabled()&&this.scrollDirection()=="NONE",o=e&&r?this._node.originalSize():this._node.fullSize(),i=x.new2();if(n)i.setTo1(0,0,o.x(),o.y());else{let a=this._node.canvasSpaceBoundingBox().topLeft();i.setTo1(a.x(),a.y(),o.x(),o.y());for(let s=0,l=this._node.childCount();s<l;s=s+1){let c=this._node.childAt1(s);c.isFixed()||(yo?i.expandToInclude(c.canvasSpaceBoundingBox()):i.expandToInclude(c.canvasSpaceScrollingBounds()))}i.setX(i.x()-a.x()),i.setY(i.y()-a.y()),this._node.overflowDirection()=="VERTICAL"?(i.setX(0),i.setWidth(o.x())):this._node.overflowDirection()=="HORIZONTAL"?(i.setY(0),i.setHeight(o.y())):this._node.overflowDirection()=="BOTH"}return i}_scrollableContentBounds(){let e=this.nodeSpaceScrollableContentBounds();return e.transformInto1(e,this._node.absoluteTransform()),e}scrollDirection(){let e=this._role()==2?ot.asBool(this._node.get(99,!1)):this._role()==0;return this._node.constrainsAnchoredChildren()?this._node.type()==="SLIDE"?"NONE":this._node.isTopLevel()&&e?"BOTH":this._node.overflowDirection():"NONE"}scrollDirectionWithScrollableContent(){let e=this.scrollDirection(),r=this.canvasSpaceContentBounds(),n=this._node.canvasSpaceBoundingBox(),o=bn.scrollsVertically(e)&&r.height()>n.height(),i=bn.scrollsHorizontally(e)&&r.width()>n.width();return o&&i?"BOTH":o?"VERTICAL":i?"HORIZONTAL":"NONE"}hasScrollableParent(){let e=this._node.parent();return!(e==null||e.overflowDirection()=="NONE"&&!(e.isTopLevel()&&e.type()=="FRAME"))}isFixed(){return this.hasScrollableParent()?this._node.scrollBehavior()=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME":!1}isStickyScrolling(){return this._node.scrollBehavior()=="STICKY_SCROLLS"}isStandardScrolling(){return!this.isFixed()&&!this.isStickyScrolling()}scrollAndClipBoundsBySelfAndAncestors(e,r){let n=e.clone(),o=this._node;for(;o.parent()!=null;){let i=_a.getScrollTranslationOfNodeRelativeToParent(o);n.translate2(i.negative());let a=o.parent();a.clipsToBoundingRectangle()&&r==0&&n.intersectWith(a.canvasSpaceBoundingBox()),o=a}return n}canvasSpaceScrolledBounds(e){return this.scrollAndClipBoundsBySelfAndAncestors(this._node.canvasSpaceBoundingBox(),e)}canvasSpaceScrolledInteractiveBounds(e){let r=this._node.canvasSpaceInteractiveBounds();return this.scrollAndClipBoundsBySelfAndAncestors(r,e)}scrollsInPreferredDirection(e){switch(e){case"HORIZONTAL":return bn.scrollsHorizontally(this.scrollDirection());case"VERTICAL":return bn.scrollsVertically(this.scrollDirection());case"BOTH":return this.scrollDirection()!="NONE"}return!1}hasOverflowingContentInScrollDirection(){let e=this.canvasSpaceContentBounds(),r=this._node.canvasSpaceBoundingBox();return bn.scrollsHorizontally(this.scrollDirection())&&e.width()>r.width()||bn.scrollsVertically(this.scrollDirection())&&e.height()>r.height()}};var eP=hc(k1());var Na=class t{constructor(e,r){e?Array.isArray(e)?this.pt=e:e instanceof x?this.pt=[new O(e.x(),e.y()),new O(e.x()+e.width(),e.y()),new O(e.x()+e.width(),e.y()+e.height()),new O(e.x(),e.y()+e.height())]:e instanceof X&&(r instanceof O?this.pt=[e.transformPoint(new O(0,0)),e.transformPoint(new O(r.x(),0)),e.transformPoint(new O(r.x(),r.y())),e.transformPoint(new O(0,r.y()))]:r instanceof x&&(this.pt=[e.transformPoint(new O(r.x(),r.y())),e.transformPoint(new O(r.x()+r.width(),r.y())),e.transformPoint(new O(r.x()+r.width(),r.y()+r.height())),e.transformPoint(new O(r.x(),r.y()+r.height()))])):this.pt=Array(4).fill(new O(0,0))}topLeft(){return this.pt[0]}topRight(){return this.pt[1]}bottomRight(){return this.pt[2]}bottomLeft(){return this.pt[3]}get(e){return this.pt[e]}points(){return this.pt}scale(e){let r=this.center();return this.pt=this.pt.map(n=>{let o=n.subtract(r);return r.add(o.multiplyScalar(e))}),this}transform(e){return this.pt=this.pt.map(r=>e.transformPoint(r)),this}expand(e){let r=this.center();return this.pt=this.pt.map(n=>{let o=n.subtract(r),i=o.length(),a=o.multiplyScalar(1/i);return n.add(a.multiplyScalar(e))}),this}lengthX(){return this.topLeft().distanceTo(this.topRight())}lengthY(){return this.topLeft().distanceTo(this.bottomLeft())}hasAxisX(){return this.lengthX()>.001}hasAxisY(){return this.lengthY()>.001}center(){return this.pt.reduce((r,n)=>r.add(n),new O(0,0)).multiplyScalar(1/4)}bounds(){let e=this.pt.map(s=>s.x()),r=this.pt.map(s=>s.y()),n=Math.min(...e),o=Math.min(...r),i=Math.max(...e),a=Math.max(...r);return new x(n,o,i-n,a-o)}toAngle(){let e=this.topRight().subtract(this.topLeft());return Math.atan2(e.y(),e.x())}static fromCenterSize(e,r){let n=r.multiplyScalar(.5),o=e.subtract(n),i=o.x()+r.x(),a=o.y()+r.y();return new t([new O(o.x(),o.y()),new O(i,o.y()),new O(i,a),new O(o.x(),a)])}equals(e){return this.pt.every((r,n)=>r.equals(e.pt[n]))}};var Yi=class Yi{constructor(e,r,n){this.center=null,this.xRadius=0,this.yRadius=0,this._hash=0,this._cachedBezier=null,this.center=e,this.xRadius=r,this.yRadius=n,Yi.hasher.reset(),Yi.hasher.hash1(this.center.x()),Yi.hasher.hash1(this.center.y()),Yi.hasher.hash1(this.xRadius),Yi.hasher.hash1(this.yRadius),this._hash=Yi.hasher.value()}bounds(){return new x(this.center.x()-this.xRadius,this.center.y()-this.yRadius,this.xRadius*2,this.yRadius*2)}equals2(e){return e instanceof Yi?this.equals1(e):!1}equals1(e){return this.center.equals(e.center)&&this.xRadius==e.xRadius&&this.yRadius==e.yRadius}clone(){return new Yi(this.center.clone(),this.xRadius,this.yRadius)}hash(){return this._hash}isRect(){return!1}canBeAnalyticallyAntialiased(){return xc()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Bt.forEllipse(this.bounds())),this._cachedBezier}asRoundedRectPath(){return null}static fromBounds(e){return new Yi(e.center(),e.width()/2,e.height()/2)}};Yi.hasher=new Wo;var cs=Yi;var yr;(e=>{let t;(l=>(l[l.NON_RENDERABLE=0]="NON_RENDERABLE",l[l.RENDERABLE_GEOMETRY=1]="RENDERABLE_GEOMETRY",l[l.RENDERABLE_TEXT=2]="RENDERABLE_TEXT",l[l.RENDERABLE_GROUP=3]="RENDERABLE_GROUP",l[l.CUSTOM_RENDER_TREE=4]="CUSTOM_RENDER_TREE",l[l.TRANSFORM=5]="TRANSFORM"))(t=e.RenderableContentType||(e.RenderableContentType={}))})(yr||(yr={}));var Xu;(r=>{function t(){return new Map}r._new=t;function e(n,o){return new Map([...n.entries()].filter(([i,a])=>o(i,a)))}r._filter=e})(Xu||(Xu={}));var Ys=class{toString(){return this.name+" "+this.relativeChildIndex.toString()}toStringWithPrefix(e){let r=e?this.name.split("/")[0]:this.name;return r=r.trim(),r+" "+this.relativeChildIndex.toString()}constructor(e,r){this.name=e,this.relativeChildIndex=r}},ym=class t{getData(e,r){let n=this.getAllDataForNode(e);return n!=null&&n.has(r)?n.get(r):null}getAllDataForNode(e){let r=this.getSubTrie(e);return r!=null?r.cache:null}insert(e,r,n){if(e.length==0){this.cache.set(r,n);return}let o=e[0].toString(),i=e.slice(1,e.length);this.children.has(o)||this.children.set(o,new t),this.children.get(o).insert(i,r,n)}remove(e,r){if(e.length==0){this.cache.delete(r);return}let n=e[0].toString(),o=e.slice(1,e.length);this.children.has(n)||this.children.set(n,new t),this.children.get(n).remove(o,r)}forEach(e){for(let r of Array.from(this.cache.keys()))e(this.cache.get(r));for(let r of Array.from(this.children.keys()))this.children.get(r).forEach(e)}getSubTrie(e){if(e.length==0)return this;let r=e[0].toString();return this.children.has(r)?this.children.get(r).getSubTrie(e.slice(1,e.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let r of Array.from(this.cache.keys()))e!=null&&e(this.cache.get(r));for(let r of Array.from(this.children.keys()))this.children.get(r).uninitialize2(e),this.children.delete(r)}toString1(){return this.toString2(null)}toString2(e){let r=this.toStringHelper(e),n="";for(let o of r)n=n+`${o}
`;return n}toStringHelper(e){let r=[];for(let n of Array.from(this.cache.keys()))r.push(e==null?n:`${n}: ${e(this.cache.get(n))}`);for(let n of Array.from(this.children.keys())){let o=this.children.get(n).toStringHelper(e);for(let i of o)r.push(`${n}/${i}`)}return r}constructor(){this.cache=Xu._new(),this.children=new Map}},Qs=class{getData(e,r){if(e.length==0)return null;let n=this._getSSTDataCacheFromLowerNodeStorage(e);return n!=null&&n.has(r)?n.get(r):null}getAllDataForNode(e){return e.length==0?null:this._getSSTDataCacheFromLowerNodeStorage(e)}_getSSTDataCacheFromTLFStorage(e){let r=e[0].toString();return this.tlfNodeStorage.has(r)?this.tlfNodeStorage.get(r).getAllDataForNode([]):null}_getSSTDataCacheFromLowerNodeStorage(e){let r=this._getFirstNodeName(e);return this.lowerNodeStorage.has(r)?this.lowerNodeStorage.get(r).getAllDataForNode(e.slice(1,e.length)):null}insert(e,r,n){e.length!=0&&this._insertIntoLowerNodeStorage(e,r,n)}remove(e,r){e.length!=0&&this._deleteFromLowerNodeStorage(e,r)}_deleteFromTLFStorage(e,r){let n=e[0].toString();this.tlfNodeStorage.has(n)&&this.tlfNodeStorage.get(n).remove(e.slice(1,e.length),r)}_deleteFromLowerNodeStorage(e,r){let n=this._getFirstNodeName(e);this.lowerNodeStorage.has(n)&&this.lowerNodeStorage.get(n).remove(e.slice(1,e.length),r)}_insertIntoTLFStorage(e,r,n){let o=e[0].toString();this.tlfNodeStorage.has(o)||this.tlfNodeStorage.set(o,new ym),this.tlfNodeStorage.get(o).insert(e.slice(1,e.length),r,n)}_insertIntoLowerNodeStorage(e,r,n){let o=this._getFirstNodeName(e);this.lowerNodeStorage.has(o)||this.lowerNodeStorage.set(o,new ym),this.lowerNodeStorage.get(o).insert(e.slice(1,e.length),r,n)}forEach(e){for(let r of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(r).forEach(e);for(let r of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(r).forEach(e)}getSubTrie(e){if(e.length==0)return this;let r=e,n=this._getFirstNodeName(r);return this.lowerNodeStorage.has(n)?this.lowerNodeStorage.get(n).getSubTrie(r.slice(1,r.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let r of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(r).uninitialize2(e),this.tlfNodeStorage.delete(r);for(let r of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(r).uninitialize2(e),this.lowerNodeStorage.delete(r)}toString1(){return this.toString2(null)}toString2(e){let r=this._toStringHelper(e),n="";for(let o of r)n=n+`${o}
`;return n}_toStringHelper(e){let r=[];for(let n of Array.from(this.lowerNodeStorage.keys())){let o=this.lowerNodeStorage.get(n).toStringHelper(e);for(let i of o)r.push(`*/${n}/${i}`)}for(let n of Array.from(this.tlfNodeStorage.keys())){let o=this.tlfNodeStorage.get(n).toStringHelper(e);for(let i of o)r.push(`[TLF]/${n}/${i}`)}return r}_getFirstNodeName(e){return e.length==1?e[0].toStringWithPrefix(!0):UA.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING}constructor(){this.lowerNodeStorage=new Map,this.tlfNodeStorage=new Map}},Nr;(l=>{function t(){l._cachedNodePaths.clear()}l.clearCachedNodePaths=t;function e(c){if(c==null)return[];if(l._cachedNodePaths.has(c.uniqueIdentifier()))return l._cachedNodePaths.get(c.uniqueIdentifier());let d=c.getSemanticNodePath();return l._cachedNodePaths.set(c.uniqueIdentifier(),d),d}l.getSemanticNodePath=e;function r(c){return c=="FRAME"||c=="INSTANCE"||c=="SYMBOL"||c=="SLIDE"}l._isValidTLFType=r;function n(c){return c.isTopLevel()&&r(c.type())}l._isValidSemanticTLF=n;function o(c){if(c.isTopLevel()&&!r(c.type()))return[];let d=[],u=!0;for(let p=c.clone();u&&p!=null;p=p.parent())d.splice(0,0,new Ys(p.name(),i(p))),n(p)&&(u=!1);return d}l.getSemanticNodePathHelper=o;function i(c){var _;if(n(c)||c.parent()==null)return 0;let d=(_=c.parent())==null?void 0:_.clone();if(d==null)return 0;let u=[],p=d.childCount();for(let h=0;h<p;h=h+1){let A=d.clone();A.moveToChildAt(h),A.name()==c.name()&&u.push(A.uniqueIdentifier())}return u.indexOf(c.uniqueIdentifier())}l.getRelativeChildIndex=i,l.DEFAULT_STORAGE_KEY="storage_key",l._cachedNodePaths=new Map})(Nr||(Nr={}));var H1;(l=>{function t(c){return c}l.SSTDataCache_asMap=t;function e(c){return Array.from(c.keys())}l.SSTDataCache_keys=e;function r(c,d){return c.has(d)}l.SSTDataCache_has=r;function n(c){return c.size}l.SSTDataCache_size=n;function o(c,d){c.delete(d)}l.remove=o;function i(c,d){return c.get(d)}l.SSTDataCache_get=i;function a(c,d,u){c.set(d,u)}l.SSTDataCache_set=a;function s(c,d){c.forEach(d)}l.SSTDataCache_forEach=s})(H1||(H1={}));var UA;(e=>e.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING="TLF Placeholder")(UA||(UA={}));var Kt=class t{constructor(e,r=null){this.node=e,this._overlayRenderData=r}clone(){return new t(this.node,this.overlayRenderData())}setNode(e){this.node=e}moveToChildAt(e){this.node=this.node.childAt2(e,!0)}moveToParent(){this.node=this.node.parent()}isRoot(){return this.node.parent()==null}indexInParent(){return this.node.indexInParent()}renderableContentType(){switch(this.node.type()){case"NONE":case"DOCUMENT":case"SLICE":return yr.RenderableContentType.NON_RENDERABLE;case"CANVAS":case"GROUP":case"FRAME":case"SYMBOL":case"INSTANCE":case"STICKY":case"CODE_BLOCK":case"CODE_INSTANCE":case"MEDIA":case"SECTION_OVERLAY":case"WIDGET":case"SHAPE_WITH_TEXT":case"CONNECTOR":case"SECTION":case"TABLE":case"TABLE_CELL":case"SLIDE":case"MODULE":case"SLIDE_GRID":case"SLIDE_ROW":case"JSX":return yr.RenderableContentType.RENDERABLE_GROUP;case"BOOLEAN_OPERATION":case"ELLIPSE":case"LINE":case"RECTANGLE":case"REGULAR_POLYGON":case"ROUNDED_RECTANGLE":case"STAR":case"VECTOR":case"HIGHLIGHT":case"STAMP":case"WASHI_TAPE":case"INTERACTIVE_SLIDE_ELEMENT":return yr.RenderableContentType.RENDERABLE_GEOMETRY;case"TEXT":case"TEXT_PATH":return yr.RenderableContentType.RENDERABLE_TEXT;case"TRANSFORM":return yr.RenderableContentType.TRANSFORM}return we("Unhandled scene node type while getting cursor renderable content type"),yr.RenderableContentType.NON_RENDERABLE}isFrameLike(){return Qt.isFrameLike(this.type())}isTopLevel(){return this.node.isTopLevel()}willChange(){return 0}shouldOptimizeShadowForAnimation(e){return!1}paintsDebugString(){return`SceneCursor ${this.node.paintsDebugString()}`}customRenderTree(e){return null}isBrushInstanceType(e){return this.node.isBrushInstanceType(e)}getStrokeBrush(){return this.node.strokeBrush()}getStrokeBrushCursor(){var e=this.node.strokeBrush();return e==null?null:new t(e,null)}getScatterBrushInstanceTransforms(){return this.node.getScatterBrushInstanceTransforms()}hasScatterBrushInstanceTransforms(){return this.node.hasScatterBrushInstanceTransforms()}name(){return this.node.name()}scene(){return this.node.scene()}parent(){return this.node.parent()!=null?new t(this.node.parent()):null}blendMode(){return this.node.blendMode()}codeSnapshot(){return this.node.codeSnapshot()}opacity(){return this.node.opacity()}visible(){return this.node.visible()}isVisibleMask(){return this.node.visible()&&this.node.isMask()}maskType(){return this.node.maskType()}isSpreadEligibleNode(){return this.node.isSpreadEligibleNode()}type(){return this.node.type()}childCount(){return this.node.childCount()}absoluteTransform(){return this.node!=null?this.node.absoluteTransform():yt.FrozenAffineTransform_IDENTITY}relativeTransform(){return this.node!=null?this.node.relativeTransform():yt.FrozenAffineTransform_IDENTITY}maxTransformScale(){return 1}clipsChildren(){return this.node.clipsToBoundingRectangle()}stopsMaskPropagation(){return this.node.isMask()||this.node.clipsToBoundingRectangle()}arcData(){return this.node.arcData()}isRoundedRect(){return this.node.isRoundedRect()}roundedRectInfo(){return this.node.roundedRectInfo()}fillGeometry(){return this.node.fillGeometry()}strokeGeometry(){return this.node.strokeGeometry()}fillGeometryForSpread(e,r,n){return this.node.fillGeometryForSpread(e,r,n)}strokeGeometryForSpread(e,r,n,o){return this.node.strokeGeometryForSpread(e,r,n,o)}size(){return this.node.size()}strokeAlign(){return this.node.strokeAlign()}strokeWeight(){return this.node.strokeWeight()}hasDefaultStrokeParameters(){return this.node.hasDefaultStrokeParameters()}strokeJoin(){return this.node.strokeJoin()}setStrokeJoin(e){this.node.setStrokeJoin(e)}strokeMiterLimit(){return this.node.strokeMiterLimit()}setStrokeMiterLimit(e){this.node.setStrokeMiterLimit(e)}id(){return this.node.id()}uniqueIdentifier(){return this.node.id()}isInsideOutlineMask(){return this.node.isInsideOutlineMask()}textData(){return this.node.textData()}derivedTextData(){return this.node.derivedTextData()}textGeometry(){return this.node.textGeometry()}getCachedRenderTree(){return this.node.getCachedRenderTree()}renderTree(){return this.node.renderTree2(this.clone())}renderTreeWithoutBackgroundBlursAndGlassEffects(){return this.node.renderTreeWithoutBackgroundBlursAndGlassEffects()}renderTreeWithoutGlassEffects(){return this.node.renderTreeWithoutGlassEffects()}renderTreeForShadowRoot(){return this.node.renderTreeForShadowRoot1()}renderTreeForShadowDescendant(){return this.node.renderTreeForShadowDescendant1()}renderTreeForKnockoutShadowRoot(){return this.node.renderTreeForKnockoutShadowRoot1()}renderTreeForKnockoutShadowDescendant(){return this.node.renderTreeForKnockoutShadowDescendant1()}renderTreeForSlideThumbnail(){return this.node.renderTreeForSlideThumbnail1()}renderTreeWithoutEffects(){return this.node.renderTreeWithoutEffects()}isFixed(){return this.node.isFixed()}isStandardScrolling(){return this.node.isStandardScrolling()}isStickyScrolling(){return this.node.isStickyScrolling()}scrollOffset(){return this.node.scrollOffset()}scrollSpeedMultiplier(){var e,r;return((r=(e=this.node.behaviors())==null?void 0:e.scrollParallax)==null?void 0:r.speed)??1}scrollDirection(){return this.node.scrollDirection()}hasOverflowingContentInScrollDirection(){return this.node.hasOverflowingContentInScrollDirection()}effects(){return this.node.effects()}transformModifiers(){return this.node.transformModifiers()}fillPaints(){return this.node.fillPaints()}textDecorationFillPaints(){return this.node.textDecorationFillPaints()}strokePaints(){return this.node.strokePaints()}fillPaintsToRender(){return this.node.fillPaintsToRender()}videoPlayback(){return this.node.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this.node.containerSupportsFillStrokeAndCorners()}isGroup(){return this.node.isGroup()}hasNonZeroStrokeWeight(){return this.node.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this.node.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this.node.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this.node.overrideKey()}getSemanticNodePath(){return Nr.getSemanticNodePathHelper(this)}dependsOnBackgroundContent(){return this.node.dependsOnBackgroundContent()}overlayRenderData(){return this._overlayRenderData}containsIndependentBordersStrokeMask(){return this.node.containsIndependentBordersStrokeMask()}generateStrokeAndStrokeMaskGeometries(e,r,n){return this.node.generateStrokeAndStrokeMaskGeometries(e,r,n)}canvasSpaceContentBounds(){return this.node.canvasSpaceContentBounds()}};var Xl=class t extends Kt{constructor(e,r=null,n=null,o=null,i=null){super(e,r),this._icRoot=e,this._enteringICNode=o,this._exitingICNode=i,this._icFramePairTransition=n}clone(){let e=new t(this.node,this.overlayRenderData(),this._icFramePairTransition,this._enteringICNode,this._exitingICNode);return e._icRoot=this._icRoot,e}moveToChildAt(e){let r=this.node.childAt2(e,!0);r!=null&&this._enteringICNode!=null&&r.id()==this._enteringICNode.id()?this.node=this._exitingICNode:this.node=r}moveToParent(){this._enteringICNode!=null&&this._exitingICNode!=null&&this._enteringICNode.parent()!=null&&this.node.id()==this._exitingICNode.id()?this.node=this._enteringICNode.parent():this.node=this.node.parent()}isRoot(){return this._enteringICNode!=null&&this._exitingICNode!=null&&this.node.id()==this._exitingICNode.id()?this._enteringICNode.parent()==null:this.node.parent()==null}indexInParent(){return this._enteringICNode!=null&&this._exitingICNode!=null&&this.node.id()==this._exitingICNode.id()?this._enteringICNode.indexInParent():this.node.indexInParent()}parent(){let e=this.clone();return e.moveToParent(),e.node==null?null:e}icFramePairTransition(){return this._icFramePairTransition}icRoot(){return this._icRoot}};var Zl=.001,vm=class{path(){throw new Error("Not implemented")}optimized(){throw new Error("Not implemented")}equals(e){throw new Error("Not implemented")}withNewPaints(e){throw new Error("Not implemented")}canBeAnalyticallyAntialiased(){return this.path().path().canBeAnalyticallyAntialiased()}constructor(e,r,n,o,i){this.type=e,this.paints=r,this.maxBounds=n,this.rotation=o,this.unrotatedGlyphSize=i}};var Gt=class t extends vm{constructor(e,r,n,o){super(0,r,e.bounds(),n,o),this._isOptimized=!1,this._path=e}path(){return this._path}withNewPaints(e){return new t(this._path,e)}equals(e){if(this.type!=e.type)return!1;if(this.path()==null||e.path()==null){if(this.path()==null!=(e.path()==null))return!1}else if(!this.path().equals(e.path()))return!1;if(this.paints==null||e.paints==null){if(this.paints==null!=(e.paints==null))return!1}else if(!Se.equals(this.paints,e.paints))return!1;return this.rotation!=e.rotation||this.unrotatedGlyphSize==null!=(e.unrotatedGlyphSize==null)?!1:!(this.unrotatedGlyphSize!=null&&e.unrotatedGlyphSize!=null&&!this.unrotatedGlyphSize.equals(e.unrotatedGlyphSize))}optimized(){if(this._isOptimized)return this;let e=Se.optimize(this.paints);return this.paints!=e?new t(this.path(),e,this.rotation,this.unrotatedGlyphSize):(this._isOptimized=!0,this)}},Jc=class t extends vm{constructor(e,r,n,o,i,a){super(1,r,n,i,a),this._isOptimized=!1,this._computePath=e,this.id=o}path(){return this._computePath()}withNewPaints(e){return new t(this._computePath,e,this.maxBounds,this.id)}equals(e){return this.type==e.type&&this.id==e.id}optimized(){if(this._isOptimized)return this;let e=Se.optimize(this.paints);return this.paints!=e?new t(this._computePath,e,this.maxBounds,this.id,this.rotation,this.unrotatedGlyphSize):(this._isOptimized=!0,this)}},Yn=(S=>(S[S.METADATA=0]="METADATA",S[S.GROUP=1]="GROUP",S[S.SUPERSAMPLE_GROUP=2]="SUPERSAMPLE_GROUP",S[S.FILL=3]="FILL",S[S.FILL_STROKE=4]="FILL_STROKE",S[S.MASK=5]="MASK",S[S.BLUR=6]="BLUR",S[S.BLEND=7]="BLEND",S[S.COMPOSITE_TILE_GRID=8]="COMPOSITE_TILE_GRID",S[S.HARD_MASK_WITH_COLOR=9]="HARD_MASK_WITH_COLOR",S[S.VOLATILE_PROPERTY_BINDING=10]="VOLATILE_PROPERTY_BINDING",S[S.STATIC_TRANSFORM_BINDING=11]="STATIC_TRANSFORM_BINDING",S[S.DISSOLVE=12]="DISSOLVE",S[S.VOLATILE_RENDER_EFFECT=13]="VOLATILE_RENDER_EFFECT",S[S.GRAIN=14]="GRAIN",S[S.NOISE=15]="NOISE",S[S.SCATTER_BRUSH_FILL=16]="SCATTER_BRUSH_FILL",S[S.GLASS=17]="GLASS",S))(Yn||{});var Pa;(i=>{function t(a,s){return a.has(s)}i.has=t;function e(a,s){return a.get(s)??null}i.get=e;function r(a,s,l){a.set(s,l)}i.set=r;function n(a){a.clear()}i.clear=n;function o(){return new Map}i._new=o})(Pa||(Pa={}));var Ar=class t{currentBounds(e){if(e==null)return this.maxBounds;if(Pa.has(e,this)){let n=Pa.get(e,this);if(n!=null)return n}let r=this.computeBounds(e);return Pa.set(e,this,r),r}equals(e){return this.equalsWithinBounds(e,null)}equalsWithinBounds(e,r){if(e==this)return!0;if(r!=null){let n=e.maxBounds.overlaps(r),o=this.maxBounds.overlaps(r);if(!n&&!o)return!0;if(n!=o)return!1;if(!e.maxBounds.equals(this.maxBounds)){if(r.contains1(e.maxBounds)&&r.contains1(this.maxBounds))return!1;let i=x.fromRect(this.maxBounds).intersectedWith(r),a=x.fromRect(this.maxBounds).intersectedWith(r);if(!i.equals(a))return!1}}return e.op()!=this.op()?!1:this.equalsWithinBoundsImpl(e,r)}constructor(e,r){this._isOptimized=!1,this.flags=0,this.maxBounds=e,this.flags=r}hasNonIsolatedBlends(){return(1&this.flags)!=0}dependsOnBackgroundContent(){return this.hasBackgroundBlurs()||this.hasGlassEffects()}hasBackgroundBlurs(){return(2&this.flags)!=0}hasGlassEffects(){return(64&this.flags)!=0}canBeUsedInBackgroundBlurs(){return(132&this.flags)==0}canBeUsedInGlassEffects(){return(128&this.flags)==0}hasVolatileContent(){return(8&this.flags)!=0}hasAnimatingMedia(){return(16&this.flags)!=0}maskNeedsSSAA(){return(32&this.flags)!=0}canCacheRasterized(){return!(this.hasNonIsolatedBlends()||this.dependsOnBackgroundContent()||this.hasAnimatingMedia()||this.hasVolatileContent())}isRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.hasPerpendicularAxes(Zl))return!0}return!1}isAxisAlignedRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path().asRoundedRectPath()!=null&&e.transform.isAxisAligned(Zl))return!0}return!1}isAxisAlignedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.isAxisAligned(Zl))return!0}return!1}isRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path()instanceof vt&&e.transform.hasPerpendicularAxes(Zl))return!0}return!1}desiredAntialiasing(){return this.op()!=3&&this.op()!=4&&this.op()!=16?0:this.hasAnimatingMedia()||this.hasVolatileContent()?0:this.op()==3&&this.geometry.canBeAnalyticallyAntialiased()?1:2}opProfileString(){let e="RenderNodeOp: ";switch(this.op()){case 0:{e+="METADATA";break}case 2:{e+="SUPERSAMPLE_GROUP";break}case 1:{e+="GROUP";break}case 3:{e+="FILL";break}case 4:{let r=this;switch(e+="FILL_STROKE",r.mode){case 0:{e+=" mode=INSIDE";break}case 1:{e+=" mode=OUTSIDE";break}}break}case 16:{e+="SCATTER_BRUSH_FILL";break}case 5:{let r=this;switch(e+="MASK",r.type){case 0:{e+=" type=NORMAL";break}case 3:{e+=" type=BACKGROUND_BLUR";break}case 2:{e+=" type=INNER_SHADOW";break}case 4:{e+=" type=KNOCKOUT_SHADOW";break}case 1:{e+=" type=LUMINANCE";break}case 5:e+=" type=PATTERN"}break}case 6:{e+="BLUR";break}case 7:{e+="BLEND mode="+this.blendMode;break}case 14:{e+="GRAIN";break}case 15:{e+="NOISE";break}case 17:{e+="GLASS";break}case 9:{e+="HARD_MASK_WITH_COLOR";break}case 8:{e+="COMPOSITE_TILE_GRID";break}case 10:{let r=this;e+=`VOLATILE_PROPERTY_BINDING property=${Xs.VolatileProperty_toString(r.property)}`;break}case 11:{e+=`STATIC_TRANSFORM_BINDING transform=${this.transform}`;break}case 13:{let r=this;e+=`VOLATILE_RENDER_EFFECT id=${r.id} property=${bm[r.property]}`;break}case 12:{e+="DISSOLVE";break}default:throw new Error(`Unhandled node op ${Yn[this.op()]}`)}return e}debugString1(){return this.debugString2(t.DebugStringType.BASIC)}debugString2(e){let r=new t.GenerateStringState;return this._debugStringRecursive(this,r,!0,!1,e),r.result}_debugStringRecursive(e,r,n,o,i){let a=i!=t.DebugStringType.BASIC;r.result+=r.indent,n||(r.result+=o?"\u2514\u2500":"\u251C\u2500");let s=r.indent.length;switch(n||(r.indent+=o?"  ":"\u2502 "),e.op()){case 0:{let l=e;r.result+="METADATA",this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 2:{let l=e;r.result+="SUPERSAMPLE_GROUP",this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 1:{let l=e;r.result+="GROUP",this._appendFlagsToString(r,e),r.result+=`
`;for(let c=0,d=l.children.length;c<d;c=c+1){let u=l.children[c];this._debugStringRecursive(u,r,!1,c+1==l.children.length,i)}break}case 3:{let l=e,c=l.geometry.path().path(),d=c instanceof cs?"CirclePath":c instanceof vt?"RoundedRectPath":c instanceof Bt?"BezierPath":c instanceof $e?"FrozenBezierPath":c instanceof Fo?"UniquePath":"UnknownPath";r.result+=`FILL path=${d} paints=`,this._appendPaintDataToString(r,l.geometry.paints,i),a&&(r.result+=` transform=${l.transform}`,r.result+=` paintSize=${l.paintSize}`),e.isRectFill()?r.result+=" isRect":e.isRoundedRectFill()&&(r.result+=" isRoundedRect"),this._appendFlagsToString(r,e),r.result+=`
`;break}case 4:{let l=e;switch(r.result+="FILL_STROKE",l.mode){case 0:{r.result+=" mode=INSIDE";break}case 1:{r.result+=" mode=OUTSIDE";break}}r.result+=" fills=",this._appendGeometriesToString(r,l.fillGeometries,i),r.result+=" strokes=",this._appendGeometriesToString(r,l.strokeGeometries,i),a&&(r.result+=` transform=${l.transform}`),this._appendFlagsToString(r,l),r.result+=`
`;break}case 16:{let l=e;r.result+="SCATTER_BRUSH_FILL",r.result+=" fills=",this._appendGeometriesToString(r,l.fillGeometries,i),a&&(r.result+=` transform=${l.transform}`),this._appendFlagsToString(r,l),r.result+=`
`;break}case 5:{let l=e;switch(r.result+="MASK",l.type){case 0:{r.result+=" type=NORMAL";break}case 3:{r.result+=" type=BACKGROUND_BLUR";break}case 2:{r.result+=" type=INNER_SHADOW color=",this._appendColorToString(r,l.innerShadowFill);break}case 4:{r.result+=" type=KNOCKOUT_SHADOW";break}case 5:r.result+=" type=PATTERN"}this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.alpha,r,!1,!1,i),this._debugStringRecursive(l.color,r,!1,!0,i);break}case 6:{let l=e;r.result+="BLUR",l.startRadius!=l.endRadius?(r.result+=` start radius=${l.startRadius}`,r.result+=` end radius=${l.endRadius}`,r.result+=` start offset=${l.startPoint}`,r.result+=` end offset=${l.endPoint}`):r.result+=` radius=${l.endRadius}`,a&&(r.result+=` clamp=${l.clamp}`),this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 7:{let l=e;r.result+="BLEND mode=",r.result+=l.blendMode,r.result+=` opacity=${l.opacity}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 14:{let l=e;r.result+="GRAIN",r.result+=` radius=${l.radius}`,r.result+=` noiseSize=${l.noiseSize}`,r.result+=` clipToShape=${l.clipToShape}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 17:{let l=e;r.result+="GLASS",r.result+=` radius=${l.blurRadius}`,r.result+=` reflectionRadius=${l.reflectionRadius}`,r.result+=` refractionIntensity=${l.refractionIntensity}`,r.result+=` refractionDistance=${l.refractionDistance}`,r.result+=` lightIntensity=${l.lightIntensity}`,r.result+=` lightAngle=${l.lightAngle}`,r.result+=` chromaticAberration=${l.chromaticAberration}`,r.result+=` bevelSize=${l.bevelSize}`,r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 15:{let l=e;r.result+="NOISE",r.result+=` noiseSize=${l.noiseSize}`,r.result+=` noiseSize=${l.density}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 9:{let l=e;r.result+="HARD_MASK_WITH_COLOR color=",this._appendColorToString(r,l.color),this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.alpha,r,!1,!0,i);break}case 8:{let l=e;r.result+="COMPOSITE_TILE_GRID",this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.tree,r,!1,!0,i);break}case 10:{let l=e;switch(r.result+=`VOLATILE_PROPERTY_BINDING property=${Xs.VolatileProperty_toString(l.property)}`,a&&(r.result+=` id=${l.id}`),l.property){case 3:{r.result+=` value=${l.maxTransformScale()}`;break}case 2:{r.result+=` value=${l.transform()}`,l.id.startsWith("SHADOW_TRANSFORMATION")&&(r.result+=" SHADOW_TRANSFORMATION");break}case 4:{r.result+=` value=${l.opacity()}`;break}}this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 11:{let l=e;r.result+=`STATIC_TRANSFORM_BINDING transform=${l.transform}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 13:{let l=e;r.result+=`VOLATILE_RENDER_EFFECT id=${l.id} property=${bm[l.property]}`,this._appendFlagsToString(r,e),r.result+=`
`,this._debugStringRecursive(l.child,r,!1,!0,i);break}case 12:{let l=e;r.result+="DISSOLVE",this._appendFlagsToString(r,e),r.result+=`
`,l.startChild!=null&&this._debugStringRecursive(l.startChild,r,!1,!1,i),l.endChild!=null&&this._debugStringRecursive(l.endChild,r,!1,!0,i);break}default:throw new Error(`Unhandled node op ${Yn[e.op()]}`)}r.indent=r.indent.slice(0,s)}_appendGeometriesToString(e,r,n){e.result+="[";for(let o=0,i=r.length;o<i;o=o+1){let a=r[o];o!=0&&(e.result+=", ");let s=a.path().path();s instanceof Bt?e.result+=`(${s.countCommands()} commands, `:s instanceof cs?e.result+="EllipsePath, ":s instanceof vt&&(e.result+="RoundedRectPath, "),this._appendPaintDataToString(e,a.paints,n),e.result+=")"}e.result+="]"}_appendFlagsToString(e,r){r.hasNonIsolatedBlends()&&(e.result+=" hasBlends"),r.hasBackgroundBlurs()&&(e.result+=" hasBgBlurs"),r.canBeUsedInBackgroundBlurs()&&(e.result+=" bgBlurSafe"),r.maskNeedsSSAA()&&(e.result+=" maskNeedsSSAA"),r.hasVolatileContent()&&(e.result+=" volatile"),r.canCacheRasterized()||(e.result+=" nocache")}_appendSinglePaintToString(e,r,n){let o=n!=t.DebugStringType.BASIC,i=r.asVolatilePaint();if(i!=null){e.result+="VOLATILE [",this._appendSinglePaintToString(e,i.from(),n),e.result+=" -> ",this._appendSinglePaintToString(e,i.to(),n),e.result+="]";return}let a=r.asSinglePaint();switch(a.type()){case"SOLID":{e.result+="color=",this._appendColorToString(e,a.color());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{e.result+="stops=[";let s=a.colorStops();for(let l=0,c=s.length;l<c;l=l+1){l>0&&(e.result+=", ");let d=s[l];e.result+=`${d.position}`,e.result+=" ",this._appendColorToString(e,d.color)}e.result+="]";break}case"IMAGE":case"VIDEO":{o&&(e.result+=` hash=${a.image()!=null?a.image().hash():"NULL"}`,e.result+=` thumbnail=${a.imageThumbnail()!=null?a.imageThumbnail().hash():"NULL"}`,e.result+=` imageScaleMode=${a.imageScaleMode()}`,e.result+=` imageRotationDeg=${a.rotationDeg()}`,e.result+=` imageScalingFactor=${a.scalingFactor()}`);break}default:break}o&&a.transform()!=null&&(e.result+=` transform=${a.transform()}`),e.result+=` opacity=${a.opacity()}`}_appendPaintDataToString(e,r,n){e.result+="[";for(let o=0,i=r.length;o<i;o=o+1){o>0&&(e.result+=",");let a=r[o];e.result+=a.type()+" ",this._appendSinglePaintToString(e,a,n)}e.result+="]"}_appendColorToString(e,r){N.isOpaque(r)?e.result+=N.toCSS(r):e.result+=`rgba(${N.red(r)}, ${N.green(r)}, ${N.blue(r)}, ${N.alpha(r)})`}static visitEachNodeInTree(e,r,n){if(e!=null){switch(r!=null&&r(e),e.op()){case 0:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 2:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 1:{let o=e;for(let i of o.children)t.visitEachNodeInTree(i,r,n);break}case 3:case 4:case 16:case 8:break;case 5:{let o=e;t.visitEachNodeInTree(o.alpha,r,n),t.visitEachNodeInTree(o.color,r,n);break}case 6:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 7:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 14:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 15:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 17:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 9:{let o=e;t.visitEachNodeInTree(o.alpha,r,n);break}case 10:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 11:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 13:{let o=e;t.visitEachNodeInTree(o.child,r,n);break}case 12:{let o=e;t.visitEachNodeInTree(o.startChild,r,n),t.visitEachNodeInTree(o.endChild,r,n);break}default:throw new Error(`Unhandled node op ${Yn[e.op()]}`)}n!=null&&n(e)}}static geometryNodePaintSize(e){return e==null?null:e.op()==3||e.op()==4||e.op()==16?e.paintSize:null}};(r=>{let t;(i=>(i[i.BASIC=0]="BASIC",i[i.EXTENDED=1]="EXTENDED"))(t=r.DebugStringType||(r.DebugStringType={}));class e{constructor(){this.result="",this.indent=""}}r.GenerateStringState=e})(Ar||(Ar={}));var Ue=class t extends Ar{constructor(e,r=!1){super(W1(e,null),kM(e)),this.children=e,this._isFirstChildSolidBackground=r,this._isFirstChildSolidBackground}op(){return 1}isFirstChildSolidBackground(){return this._isFirstChildSolidBackground}canCacheRasterized(){return this.hasAnimatingMedia()||this.hasVolatileContent()||this.dependsOnBackgroundContent()?!1:this._isFirstChildSolidBackground?!0:!this.hasNonIsolatedBlends()}computeBounds(e){return W1(this.children,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.children.length;for(let r=0;r<e;r=r+1){if(r==0&&this._isFirstChildSolidBackground)continue;let n=this.children[r],o=n.optimized();if(o==n&&n.op()!=1)continue;let i=this.children.slice(0,r),a=(s,l)=>{if(l.op()==1){let c=l;for(let d of c.children)s.push(d)}else s.push(l)};for(o!=null&&a(i,o);(r=r+1)<e;){let s=this.children[r].optimized();s!=null&&a(i,s)}return i.length==0?null:this._isFirstChildSolidBackground?i.length==1?null:new t(i,this._isFirstChildSolidBackground):t.wrap(i)}return this.children.length==1?this.children[0]:(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,r){let o=e.children;if(this.children.length!=o.length)return!1;for(let i=0,a=this.children.length;i<a;i=i+1)if(!this.children[i].equalsWithinBounds(o[i],r))return!1;return!0}static wrap(e){let r=e.filter(n=>n!=null);return r.length==1?r[0]:new t(r)}static wrapWithSolidBackground(e,r){let n=Tr.solidColorRect(e.maxBounds,r,1);return new t([n,e],!0)}},ni=class t extends Ar{constructor(e,r){super(e.maxBounds,r?e.flags|r:e.flags),this.child=e}op(){return 2}computeBounds(e){return this.child.computeBounds(e)}optimized(){if(this._isOptimized)return this;let e=o=>o.op()==5&&o.type==4,r=e(Nm(this.child)),n=this.child.optimized();return n==null?null:r&&!e(Nm(n))||!n.maskNeedsSSAA()&&!this.maskNeedsSSAA()?n:n!=this.child?new t(n,this.flags):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,r){let n=e;return this.child.equalsWithinBounds(n.child,r)}static thatShouldNotBeUnwrappedInOptimization(e){return new t(e,32)}},ds=class t extends Ar{op(){return 0}constructor(e,r,n){super(n??e.maxBounds,r|e.flags),this.child=e}computeBounds(e){return this.child.computeBounds(e)}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new t(e,this.flags)}equalsWithinBoundsImpl(e,r){let n=e;return this.flags==e.flags&&this.child.equalsWithinBounds(n.child,r)}static createForBackgroundBlur(e){return new t(e,6)}static createForRadialRepetition(e,r){return new t(e,e.flags,r)}};function DM(t,e){let r=new Et,n=x.fromRect(Ju(yt.FrozenAffineTransform_IDENTITY,e));for(let o of t){let i=n.clone();r.include3(o.transformRect(i))}return r.build()}function wM(t,e,r){let n=DM(e,r);return t.transformRect(n)}function xM(t,e){let r=new Et;for(let n of t){let o=x.fromRect(e.path().bounds());r.include3(n.transformRect(o))}return r.build()}function LM(t){let e=new Float32Array(t.length*6);for(let r=0,n=t.length;r<n;r++){let o=t[r],i=r*6;e[i+0]=o.m00(),e[i+1]=o.m01(),e[i+2]=o.m02(),e[i+3]=o.m10(),e[i+4]=o.m11(),e[i+5]=o.m12()}return new Uint8Array(e.buffer)}var $u=class t extends Ar{constructor(r,n,o,i){super(wM(r,i,n),Z1([n]));this.instanceBuffer=null;this._accumFillGeometryPathBounds=[];this.transform=r,this.fillGeometries=n,this.paintSize=o,this.instanceTransforms=i}getAccumulatedFillGeometryPathBounds(){if(this._accumFillGeometryPathBounds.length)return this._accumFillGeometryPathBounds;for(let r of this.fillGeometries)this._accumFillGeometryPathBounds.push(xM(this.instanceTransforms,r));return this._accumFillGeometryPathBounds}getInstanceBuffer(r){return this.instanceBuffer!=null||this.instanceTransforms.length==0?this.instanceBuffer:(this.instanceBuffer=r.allocate(It.getInstanceTransform_F3_F3(),LM(this.instanceTransforms)),this.instanceBuffer)}op(){return 16}geometryBounds(){return this.maxBounds}computeBounds(r){return this.maxBounds}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let r=[];for(let o of this.fillGeometries)if(Se.containsAtLeastOneVisiblePaint(o.paints)){let i=o.optimized();r.push(i)}if(r.length==0)return null;if(Yt.FrozenList_equals(r,this.fillGeometries,(o,i)=>o.equals(i)))return this._isOptimized=!0,this;let n=new t(this.transform,r,this.paintSize,this.instanceTransforms);return n._isOptimized=!0,n}equalsWithinBoundsImpl(r,n){let o=r;return this.paintSize.equals(o.paintSize)&&this.transform.equals1(o.transform)&&Yt.FrozenList_equals(this.fillGeometries,o.fillGeometries,(i,a)=>i.equals(a))&&Yt.FrozenList_equals(this.instanceTransforms,o.instanceTransforms,(i,a)=>i.equals1(a))}};var Tr=class t extends Ar{op(){return 3}constructor(e,r,n){super(BM(e,r),zM(r)),this.transform=e,this.geometry=r,this.paintSize=n}geometryBounds(){return this.geometry.canBeAnalyticallyAntialiased()?this.transform.clone().transformRect(this.geometry.path().bounds().clone()):this.maxBounds}computeBounds(e){return this.maxBounds}withPaints(e){return new t(this.transform,this.geometry.withNewPaints(e),this.paintSize)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty()||!Se.containsAtLeastOneVisiblePaint(this.geometry.paints))return null;let e=this.geometry.optimized(),r=e.type==0,n=e.canBeAnalyticallyAntialiased();if(r&&!n&&!e.path().isRect()&&(Se.hasAnimatingMediaPaints(e.paints)||Se.hasVolatilePaints(e.paints))){let o=new t(this.transform,new Gt(e.path(),[ee.createSolid(N.BLACK,1)]),this.paintSize),i=new t(this.transform,new Gt(Nt.getOrCreate(vt.fromRect(e.path().bounds()),"ODD"),e.paints),this.paintSize);return new tn(o,i).optimized()}return e==this.geometry?(this._isOptimized=!0,this):new t(this.transform,e,this.paintSize)}equalsWithinBoundsImpl(e,r){let n=e;return this.transform.equals1(n.transform)&&this.geometry.equals(n.geometry)&&this.paintSize.equals(n.paintSize)}static solidColorRect(e,r,n){let o=[ee.createSolid(r,n)],i=X.new2().translatedBy1(e.topLeft()).scaledBy1(e.size()),a=new Gt(Nt.UNIT_RECT(),o),s=ge.FrozenVector_ZERO;return new t(i,a,s)}},VA=new Tr(X.new2(),new Gt(new Nt(vt.fromRoundedRect(new na(0,new O(0,0),new O(4,4),2,0)),"NONZERO"),Se.createFromSolidColor(N.new1(235,235,235),1)),new O(20,20)),jc=class t extends Ar{op(){return 4}constructor(e,r,n,o,i){super(MM(e,r,n,i),Z1([r,n])),this.mode=0,this.transform=e,this.fillGeometries=r,this.strokeGeometries=n,this.paintSize=o,this.mode=i}computeBounds(e){return this.maxBounds}optimized(){if(this._isOptimized)return this;let e=[];for(let o=0,i=this.strokeGeometries.length;o<i;o=o+1){let a=this.strokeGeometries[o];Se.containsAtLeastOneVisiblePaint(a.paints)&&e.push(a)}if(this.maxBounds.isEmpty()||this.fillGeometries.length==0&&e.length==0)return null;let r=o=>{let i=[];for(let a=0,s=o.length;a<s;a=a+1){let l=o[a];i.push(new Tr(this.transform,l,this.paintSize))}return Ue.wrap(i).optimized()};return e.length==0?r(this.fillGeometries):this.fillGeometries.length==0?this.mode==0?null:r(e):Yt.FrozenList_equals(e,this.strokeGeometries,(o,i)=>o.equals(i))?(this._isOptimized=!0,this):new t(this.transform,this.fillGeometries,e,this.paintSize,this.mode).optimized()}equalsWithinBoundsImpl(e,r){let n=e;return this.transform.equals1(n.transform)&&Yt.FrozenList_equals(this.fillGeometries,n.fillGeometries,(o,i)=>o.equals(i))&&Yt.FrozenList_equals(this.strokeGeometries,n.strokeGeometries,(o,i)=>o.equals(i))&&this.paintSize.equals(n.paintSize)&&this.mode==n.mode}};var tn=class t extends Ar{constructor(){let e=arguments[0],r=arguments[1];if(arguments.length==5){let n=arguments[2];super(kA(e,r,n,null),q1(e,r,n)),this.alpha=e,this.color=r,this.type=n,this.innerShadowFill=arguments[3],this.innerShadowAlphaRequiresHardMask=arguments[4]}else arguments.length==2&&(super(kA(e,r,0,null),q1(e,r,0)),this.alpha=e,this.color=r,this.type=0,this.innerShadowFill=N.TRANSPARENT,this.innerShadowAlphaRequiresHardMask=!1)}op(){return 5}computeBounds(e){return kA(this.alpha,this.color,this.type,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.alpha.optimized();if(e==null)return null;let r=this.color.optimized(),n=this.type!=4,o=this.type!=4&&this.type!=2;if(r!=null&&n&&(r=t.cullGroupChildren(r,e.maxBounds)),r!=null&&o&&(e=t.cullGroupChildren(e,r.maxBounds),e==null))return null;switch(this.type){case 0:case 1:{if(r==null)return null;let i=!1,a=e;if(e.isAxisAlignedRectFill()){let s=x.new2();s.copyFrom(a.geometryBounds()),s.expand1(Zl),i=s.contains1(r.maxBounds)}else if(e.isAxisAlignedRoundedRectFill()){let l=a.geometry.path().path().asRoundedRectPath().radii(),c=x.new2();c.copyFrom(a.geometryBounds()),c.expand1(Zl);let d=Math.max(Math.max(l.topLeft,l.topRight),Math.max(l.bottomLeft,l.bottomRight)),u=Math.min(c.width()/2,c.height()/2);if(d<=u){let p=x.new2();if(p.copyFrom(a.geometryBounds()),p.expand1(Zl),p.contains1(r.maxBounds)){let h=r.maxBounds,A=h.left(),m=h.right(),g=h.top(),S=h.bottom(),R=new O(p.left()+l.topLeft,p.top()+l.topLeft),E=new O(p.right()-l.topRight,p.top()+l.topRight),P=new O(p.left()+l.bottomLeft,p.bottom()-l.bottomLeft),T=new O(p.right()-l.bottomRight,p.bottom()-l.bottomRight);(A>=R.x()||g>=R.y()||Math.sqrt(Math.pow(A-R.x(),2)+Math.pow(g-R.y(),2))<=l.topLeft)&&(m<=E.x()||g>=E.y()||Math.sqrt(Math.pow(m-E.x(),2)+Math.pow(g-E.y(),2))<=l.topRight)&&(A>=P.x()||S<=P.y()||Math.sqrt(Math.pow(A-P.x(),2)+Math.pow(S-P.y(),2))<=l.bottomLeft)&&(m<=T.x()||S<=T.y()||Math.sqrt(Math.pow(m-T.x(),2)+Math.pow(S-T.y(),2))<=l.bottomRight)&&(i=!0)}}}if(i){let s=a.geometry.paints;if((this.type===0||!K.getFeatureFlags().render_tree_luminance_mask_fix)&&Se.containsAtLeastOneVisibleOpaquePaint(s))return r;let l=Se.onlySolidPaintOrNull(s);if(l!=null)return new go("PASS_THROUGH",N.alphaF(l.color())*l.opacity(),r).optimized()}break}case 4:{if(r==null)return null;let i=e.maxBounds,a=r.maxBounds;if(!i.overlaps(a))return r;if(!e.hasVolatileContent()&&i.contains1(a))return null;break}case 2:{if(N.alpha(this.innerShadowFill)==0)return null;if(r==null&&e.op()==3&&!this.innerShadowAlphaRequiresHardMask){let i=e,a=i.geometry.paints,s=Se.onlySolidPaintOrNull(a);if(s!=null)return i.withPaints([ee.createSolid(N.multiplyOpacity(this.innerShadowFill,N.alphaF(s.color())),1)])}if(e.op()==9&&r!=null){let i=e;return new t(i.alpha,r,this.type,this.innerShadowFill,!0)}break}case 3:case 5:break}return e==this.alpha&&r==this.color?(this._isOptimized=!0,this):(r==null&&(r=new Ue([])),new t(e,r,this.type,this.innerShadowFill,this.innerShadowAlphaRequiresHardMask))}equalsWithinBoundsImpl(e,r){let n=e;return this.type==n.type&&this.innerShadowFill==n.innerShadowFill&&this.alpha.equalsWithinBounds(n.alpha,r)&&this.color.equalsWithinBounds(n.color,r)}static createForInnerShadow(e,r,n){return new t(e,r,2,n,!1)}static createForBackgroundBlur(e,r){return new t(e,r,3,N.TRANSPARENT,!1)}static createForKnockoutShadow(e,r){return new t(e,r,4,N.TRANSPARENT,!1)}static createForLuminanceMask(e,r){return new t(e,r,1,N.TRANSPARENT,!1)}static createForPatternFill(e,r){var n;return new Zu(new Tr(e.transform,new Gt(e.geometry.path(),Se.createFromSolidColor(N.BLACK,r.opacity())),e.paintSize),e,((n=r.patternSource())==null?void 0:n.renderTreeWithoutEffects())??VA)}static createForPatternStroke(e,r,n){var o;return new Zu(new jc(r.transform,r.fillGeometries,r.strokeGeometries.map(i=>new Gt(i.path(),Se.createFromSolidColor(N.BLACK,n.opacity()))),r.paintSize,r.mode),e,((o=n.patternSource())==null?void 0:o.renderTreeWithoutEffects())??VA)}static createForPatternScatterFill(e){var r;return new Zu(new $u(e.transform,e.fillGeometries.map(n=>new Gt(n.path(),Se.createFromSolidColor(N.BLACK,n.paints[0].opacity()))),e.paintSize,e.instanceTransforms),e,((r=e.fillGeometries[0].paints[0].asSinglePaint().patternSource())==null?void 0:r.renderTreeWithoutEffects())??VA)}static cullGroupChildren(e,r){if(e!=null&&!e.maxBounds.overlaps(r))return null;if(e!=null&&e.op()==1){let n=e,o=n.children.length;for(let i=0;i<o;i=i+1)if(!n.children[i].maxBounds.overlaps(r)){let s=n.children.slice(0,i);for(;(i=i+1)<o;)n.children[i].maxBounds.overlaps(r)&&s.push(n.children[i]);return Ue.wrap(s).optimized()}}return e}},Zu=class extends tn{constructor(e,r,n){super(e,r,5,N.BLACK,!1),this.sourceRenderTree=n}equalsWithinBoundsImpl(e,r){if(!super.equalsWithinBoundsImpl(e,r))return!1;let n=e;return this.sourceRenderTree.equals(n.sourceRenderTree)}},oi=class t extends Ar{op(){return 9}constructor(e,r){super(N.alpha(r)>0?e.maxBounds:x.INVALID,HM(e)),this.alpha=e,this.color=r}computeBounds(e){return N.alpha(this.color)>0?this.alpha.currentBounds(e):x.INVALID}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.alpha.optimized();if(e==null)return null;if(e.op()==10){let n=e;return new gt(new t(n.child,this.color),n.id,n.property,n.getter).optimized()}e=z1(e,n=>(n.op()==7&&(n=n.child),n));let r=z1(e,n=>{if(n.op()==3){let o=n;if(!Se.hasVolatilePaints(o.geometry.paints)&&!Se.hasAnyFullyTransparentAreas(o.geometry.paints))return o.withPaints([ee.createSolid(this.color,1)])}return n});return r!=e?r:e==this.alpha?(this._isOptimized=!0,this):e==null?null:new t(e,this.color)}equalsWithinBoundsImpl(e,r){let n=e;return this.color==n.color&&this.alpha.equalsWithinBounds(n.alpha,r)}},fo=class t extends Ar{op(){return 6}constructor(e,r,n,o,i,a,s){super(td(Math.max(r,n),a,null),HA(a)),this.blurOpType=e,this.startRadius=r,this.endRadius=n,this.startPoint=o,this.endPoint=i,this.child=a,this.clamp=s}static createForStandardBlur(e,r,n){return new t("NORMAL",e,e,new O(0,0),new O(0,0),r,n)}static createForProgressiveBlur(e,r,n,o,i,a){return o.equals(n)?t.createForStandardBlur(r,i,a):new t("PROGRESSIVE",e,r,O.new(n),O.new(o),i,a)}hasInvertedStartAndEndPoints(){return this.blurOpType=="PROGRESSIVE"?this.startRadius>this.endRadius:!1}computeBounds(e){return td(Math.max(this.startRadius,this.endRadius),this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();if(e==null)return null;if(this.startRadius==0&&this.endRadius==0)return e;if(e.op()==10&&this.clamp.isInvalid()){let r=e;return new gt(new t(this.blurOpType,this.startRadius,this.endRadius,this.startPoint,this.endPoint,r.child,this.clamp),r.id,r.property,r.getter).optimized()}return e==this.child?(this._isOptimized=!0,this):new t(this.blurOpType,this.startRadius,this.endRadius,this.startPoint,this.endPoint,e,this.clamp)}equalsWithinBoundsImpl(e,r){let n=e;return this.blurOpType==n.blurOpType&&this.startRadius==n.startRadius&&this.endRadius==n.endRadius&&this.startPoint.equals(n.startPoint)&&this.endPoint.equals(n.endPoint)&&this.clamp.equals(n.clamp)&&this.child.equalsWithinBounds(n.child,r)}},$c=class t extends Ar{op(){return 14}constructor(e,r,n,o,i,a,s){super(K.clipToShapeBoundsReducton()&&n?o.maxBounds:td(e,o,null),HA(o)),this.radius=e,this.noiseSize=r,this.clipToShape=n,this.child=o,this.nodeToCanvasSpaceTransform=i,this.centerPoint=a,this.seed=s}static createForGrain(e,r,n,o,i,a,s){return new t(e,O.new(r),n,o,i,O.new(a),s)}computeBounds(e){return td(K.clipToShapeBoundsReducton()&&this.clipToShape?0:this.radius,this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new t(this.radius,this.noiseSize,this.clipToShape,e,this.nodeToCanvasSpaceTransform,this.centerPoint,this.seed)}equalsWithinBoundsImpl(e,r){let n=e;return this.radius==n.radius&&this.noiseSize.equals(n.noiseSize)&&this.clipToShape==n.clipToShape&&this.nodeToCanvasSpaceTransform.equals1(n.nodeToCanvasSpaceTransform)&&this.centerPoint.equals(n.centerPoint)&&this.seed==n.seed&&this.child.equalsWithinBounds(n.child,r)}},ed=class t extends Ar{op(){return 15}constructor(e,r,n,o,i,a,s,l,c,d){super(K1(s,null),j1(r,s)),this.noiseType=e,this.blendMode=r,this.noiseSize=n,this.density=o,this.color=i,this.secondaryColor=a,this.child=s,this.nodeToCanvasSpaceTransform=l,this.nodeSpaceCenterPoint=c,this.seed=d}static createForNoise(e,r,n,o,i,a,s,l,c,d){return new t(e,r,n,o,i,a,s,l,c,d)}computeBounds(e){return K1(this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new t(this.noiseType,this.blendMode,this.noiseSize,this.density,this.color,this.secondaryColor,e,this.nodeToCanvasSpaceTransform,this.nodeSpaceCenterPoint,this.seed)}equalsWithinBoundsImpl(e,r){let n=e;return this.noiseType==n.noiseType&&this.blendMode==n.blendMode&&this.noiseSize.equals(n.noiseSize)&&this.density==n.density&&this.color==n.color&&this.secondaryColor==n.secondaryColor&&this.nodeToCanvasSpaceTransform.equals1(n.nodeToCanvasSpaceTransform)&&this.nodeSpaceCenterPoint.equals(n.nodeSpaceCenterPoint)&&this.seed==n.seed&&this.child.equalsWithinBounds(n.child,r)}},ju=class ju extends Ar{op(){return 17}constructor(e,r,n,o,i,a,s,l,c,d,u,p,_,h,A){super(td(0,A,null),HA(A)),this.blurRadius=e,this.textureRadius=r,this.refractionIntensity=n,this.refractionDistance=o,this.lightIntensity=i,this.lightAngle=a,this.bevelSize=s,this.chromaticAberration=l,this.reflectionRadius=c,this.tintColor=d,this.cornerRadii=u,this.cornerSmoothing=p,this.nodeToCanvasSpaceTransform=_,this.centerPoint=h,this.child=A}static createForGlassEffect(e,r,n,o,i,a,s,l,c,d,u,p,_,h,A){return new ju(e,r,n,o,i,a,s,l,c,d,u,p,_,h,A)}computeBounds(e){return td(Math.max(this.blurRadius,this.textureRadius,this.reflectionRadius),this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new ju(this.blurRadius,this.textureRadius,this.refractionIntensity,this.refractionDistance,this.lightIntensity,this.lightAngle,this.bevelSize,this.chromaticAberration,this.reflectionRadius,this.tintColor,this.cornerRadii,this.cornerSmoothing,this.nodeToCanvasSpaceTransform,this.centerPoint,e)}equalsWithinBoundsImpl(e,r){let n=e;return this.blurRadius==n.blurRadius&&this.textureRadius==n.textureRadius&&this.refractionIntensity==n.refractionIntensity&&this.refractionDistance==n.refractionDistance&&this.lightIntensity==n.lightIntensity&&this.lightAngle==n.lightAngle&&this.bevelSize==n.bevelSize&&this.chromaticAberration==n.chromaticAberration&&this.reflectionRadius==n.reflectionRadius&&this.tintColor==n.tintColor&&this.cornerRadii==n.cornerRadii&&this.nodeToCanvasSpaceTransform.equals1(n.nodeToCanvasSpaceTransform)&&this.centerPoint.equals(n.centerPoint)&&this.child.equalsWithinBounds(n.child,r)}};ju.CHROMATIC_EXPANSION_FACTOR=.2;var qs=ju,go=class t extends Ar{op(){return 7}constructor(e,r,n){super(r>0?n.maxBounds:x.INVALID,j1(e,n)),this.blendMode=e,this.opacity=r,this.child=n}computeBounds(e){return this.opacity>0?this.child.currentBounds(e):x.INVALID}optimized(){var n;if(this._isOptimized)return this;if(this.opacity==0||this.maxBounds.isEmpty())return null;let e=this.child.optimized();if(e==null)return null;if(this.opacity==1&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL"&&!e.hasNonIsolatedBlends()))return e;if((this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&e.op()==3){let o=e,i=(n=Se.onlyPaintOrNull(o.geometry.paints))==null?void 0:n.asSinglePaint();if(i!=null){let a=i.cloneAsSinglePaint();return a.setOpacity(a.opacity()*this.opacity),o.withPaints([a])}}let r=this.opacity;if(e.op()==7){let o=e;this.blendMode==o.blendMode&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&(r=o.opacity*r,e=o.child)}return r==this.opacity&&e==this.child?(this._isOptimized=!0,this):new t(this.blendMode,r,e)}equalsWithinBoundsImpl(e,r){let n=e;return this.blendMode==n.blendMode&&this.opacity==n.opacity&&this.child.equalsWithinBounds(n.child,r)}},Cm=class{constructor(e,r){this.skippedPrerasterization=!1;this.tileHandleOrNull=null,this.neededImagesOrNull=null,this.key=e,this._cache=r}canvasSpaceBounds(){return this.key.bounds}textureRegionOrNull(){return this._cache.textureRegionOrNull(this)}bounds(){return this.key.bounds}};var Om=class extends Ar{op(){return 8}constructor(e,r){super(Q1(e,null),e.flags),this._tiles=new Map,this._devicePixelsPerCanvasPixel=-1,this.tree=e,this._tileCache=r}optimized(){return this._isOptimized=!0,this}computeBounds(e){return Q1(this.tree,e)}equalsWithinBoundsImpl(e,r){let n=e;return this._tileCache==n._tileCache&&this.maxBounds.equals(n.maxBounds)&&this.tree.equalsWithinBounds(n.tree,r)}setDevicePixelPerCanvasPixel(e){this._devicePixelsPerCanvasPixel!=e&&(this._tiles=new Map,this._devicePixelsPerCanvasPixel=e)}numTilesNeededForBounds(e){let r=x.new3(e);r.intersectWith(this.maxBounds);let n=new O(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),o=this._tileCache.tileSize()/this._devicePixelsPerCanvasPixel,i=Math.floor((r.left()-n.x())/o)|0,a=Math.ceil((r.right()-n.x())/o)|0,s=Math.floor((r.top()-n.y())/o)|0,l=Math.ceil((r.bottom()-n.y())/o)|0;return(a-i)*(l-s)}forEachTileWithinBounds(e,r,n){if(!r.overlaps(this.maxBounds))return;let o=x.new3(r);o.intersectWith(this.maxBounds);let i=new O(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),a=this._tileCache.tileSize()/this._devicePixelsPerCanvasPixel,s=Math.floor((o.left()-i.x())/a)|0,l=Math.ceil((o.right()-i.x())/a)|0,c=Math.floor((o.top()-i.y())/a)|0,d=Math.ceil((o.bottom()-i.y())/a)|0,u=i.y()+c*a;for(let p=c;p<d;p=p+1,u+=a){let _=Xt.IntMap_get(this._tiles,p,null);_==null&&(_=new Map,this._tiles.set(p,_));let h=i.x()+s*a;for(let A=s;A<l;A=A+1,h+=a){let m=Xt.IntMap_get(_,A,null);if(m!=null){let R=m.value;R!=null&&n(R);continue}if(e==1)continue;let g=new x(h,u,a,a),S=this._tileCache.getOrInsertOrNull(this.tree,g);_.set(A,S!=null?new pe(S):null),S!=null&&n(S)}}}};var bm=(o=>(o[o.BLUR=0]="BLUR",o[o.GRAIN=1]="GRAIN",o[o.NOISE=2]="NOISE",o[o.GLASS=3]="GLASS",o))(bm||{}),Fa=class t extends Ar{constructor(e,r,n,o,i,a,s,l,c,d,u,p,_,h,A){super(GM(e,o,l??0),e.flags|8),this.child=e,this.id=n,this.property=o,this.blurOpType=r,this.getter=i,this.getter1=a,this.canvasSpaceClamp=s,this.nodeToCanvasSpace=u??yt.FrozenAffineTransform_IDENTITY,this.clipToShape=d??!1,this.maxEffectRadius=l??0,this.noiseType=p??"MONOTONE",this.blendMode=_??"NORMAL",this.seed=h??0,this.cornerSmoothing=c??0,this.getter2=A??(()=>[])}static forGlass(e,r,n,o,i,a,s){return new t(e,"NORMAL",r,3,n,o,x.INVALID,i,a,void 0,s)}static forProgressiveBlur(e,r,n,o,i,a){return new t(e,"PROGRESSIVE",r,0,n,o,i,a)}static forBlur(e,r,n,o,i){return new t(e,"NORMAL",r,0,n,()=>[],o,i)}static forGrain(e,r,n,o,i,a,s,l,c){return new t(e,"NORMAL",r,1,n,o,x.INVALID,a,0,c,s,void 0,void 0,l,i)}static forNoise(e,r,n,o,i,a,s,l,c){return new t(e,"NORMAL",r,2,o,i,x.INVALID,0,0,void 0,l,n,a,s,c)}computeBounds(e){if(this.type()==2||K.clipToShapeBoundsReducton()&&this.type()==1&&this.clipToShape)return x.new3(this.child.currentBounds(e));{let r=this.getter()[0];return this.type()==0&&this.blurOpType=="PROGRESSIVE"&&(r=Math.max(r,this.getter()[1])),x.new3(this.child.currentBounds(e)).expandedBy1(r)}}grainRadius(){return this.getter()[0]}grainNoiseSize(){return this.getter1()[0]}getNodeToCanvasSpaceTransform(){return this.nodeToCanvasSpace}getNodeSpaceCenterPoint(){return this.getter2()[0]}startRadius(){return this.getter()[0]}endRadius(){return this.getter()[1]}hasInvertedStartAndEndPoints(){return this.startRadius()>this.endRadius()}getStartOffsetInCanvasSpace(){return this.getter1()[0]}getOffsetInCanvasSpace(){return this.getter1()[1]}getNoiseColor(){return this.getter()[0]}getSecondaryNoiseColor(){return this.getter()[1]}getNoiseDensity(){return this.getter1()[0]}getNoiseSize(){return this.getter1()[1]}glassCenterPoint(){return this.getter1()[0]}glassBlurRadius(){return this.getter()[0]}glassRefractionIntensity(){return this.getter()[1]}glassRefractionDistance(){return this.getter()[2]}glassSpecularIntensity(){return this.getter()[3]}glassSpecularAngle(){return this.getter()[4]}glassBevelSize(){return this.getter()[5]}glassChromaticAberration(){return this.getter()[6]}glassReflectionDistance(){return this.getter()[7]}glassTextureRadius(){return this.getter()[8]}glassCornerRadius(){return this.getter()[9]}glassTintColor(){return this.getter()[10]}type(){return this.property}op(){return 13}optimized(){return this}equalsWithinBoundsImpl(e,r){let n=e;return this.id==n.id&&this.property==n.property&&this.child.equalsWithinBounds(n.child,r)&&this.blurOpType==n.blurOpType&&this.getter()==n.getter()&&this.getter1()==n.getter1()&&this.canvasSpaceClamp.equals(n.canvasSpaceClamp)&&this.nodeToCanvasSpace.equals1(n.nodeToCanvasSpace)&&this.maxEffectRadius==n.maxEffectRadius&&this.seed==n.seed&&this.getter2()==n.getter2()}},gt=class t extends Ar{op(){return 10}constructor(e,r,n,o){super(UM(e,n),e.flags|8),this.child=e,this.id=r,this.property=n,this.getter=o}computeBounds(e){switch(this.property){case 2:{let r=this.child.currentBounds(e).clone();return this.transform().transformRect(r),r}case 1:case 3:case 4:case 5:return this.child.currentBounds(e);case 0:return this.maxBounds;default:throw new Error(`Unhandled VolatileProperty value: ${Xs.VolatileProperty_toString(this.property)}`)}}transform(){return this.getter()}opacity(){return+this.getter()}maxTransformScale(){return+this.getter()}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null||e.maxBounds.isEmpty()?null:e!=this.child?new t(e,this.id,this.property,this.getter):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,r){let n=e;return this.id==n.id&&this.property==n.property&&this.child.equals(n.child)}static forTranslation(e,r,n){let o=X.new2();return t.forTransform(e,r,()=>(o.copyFrom(yt.FrozenAffineTransform_IDENTITY),o.translatedBy1(n())))}static forTransform(e,r,n){return new t(e,r,2,n)}static forOpacity(e,r,n){return new t(e,r,4,n)}static forTransformIsolation(e){let r="ID_FOR_TRANSFORM_ISOLATION";return new t(e,r,1,null)}static forMaxTransformScale(e,r){let n=`ID_FOR_MAX_TRANSFORM_SCALE_${e}`;return new t(r,n,3,()=>e)}static forInverseTransform(e){let r="ID_FOR_INVERSE_TRANSFORM";return new t(e,r,0,null)}static forStateSwap(e){let r="ID_FOR_STATE_SWAP";return new t(e,r,5,null)}},So=class t extends Ar{op(){return 11}constructor(e,r){super(VM(e,r),e.flags),this.child=e,this.transform=r}computeBounds(e){return this.maxBounds}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null||e.maxBounds.isEmpty()?null:this.transform.equals1(yt.FrozenAffineTransform_IDENTITY)?e:e!=this.child?new t(e,this.transform):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(e,r){let n=e;return this.transform.equals1(n.transform)&&this.child.equalsWithinBounds(n.child,r!=null?this.transform.inverse().transformRect(x.new3(r)):null)}},Nn=class extends Ar{op(){return 12}constructor(e,r,n,o){super(Y1(e,r,null),(e!=null?e.flags:0)|(r!=null?r.flags:0)|8),this.startChild=e,this.endChild=r,this.id=n,this.progressFn=o}computeBounds(e){return Y1(this.startChild,this.endChild,e)}progress(){return this.progressFn()}optimized(){var i;if(this._isOptimized)return this;let e=this.startChild!=null?this.startChild.optimized():null,r=this.endChild!=null?this.endChild.optimized():null,n=e!=null&&!e.maxBounds.isEmpty(),o=r!=null&&!r.maxBounds.isEmpty();if(!n&&!o)return null;if(n)if(o){if(this.endChild!=null&&((i=this.startChild)!=null&&i.equals(this.endChild)))return this.startChild}else return e!=null?new gt(e,this.id,4,()=>1-this.progressFn()):null;else return r!=null?new gt(r,this.id,4,()=>this.progressFn()):null;return this._isOptimized=!0,this}equalsWithinBoundsImpl(e,r){var a,s;let n=e;return!(this.id!=n.id||!(this.startChild==null&&n.startChild==null||n.startChild!=null&&((a=this.startChild)==null?void 0:a.equalsWithinBounds(n.startChild,r)))||!(this.endChild==null&&n.endChild==null||n.endChild!=null&&((s=this.endChild)==null?void 0:s.equalsWithinBounds(n.endChild,r))))}},Xs;(e=>{function t(r){switch(r){case 0:return"INVERSE_TRANSFORM";case 1:return"TRANSFORM_ISOLATION";case 2:return"TRANSFORM";case 3:return"MAX_TRANSFORM_SCALE";case 4:return"OPACITY";case 5:return"STATE_SWAP";default:throw new Error("Unhandled VolatileProperty value")}}e.VolatileProperty_toString=t})(Xs||(Xs={}));function Z1(t){let e=0;for(let r of t)for(let n=0,o=r.length;n<o;n=n+1)Se.hasAnimatingMediaPaints(r[n].paints)&&(e|=16),Se.hasVolatilePaints(r[n].paints)&&(e|=8);return e}function z1(t,e){if(t.op()==11){let r=t,n=e(r.child);return n==r.child?r:n!=null?new So(n,r.transform):null}else return e(t)}function Nm(t){return t.op()==11?t.child:t}function J1(t){if(t.op()==11){let e=t;return new ho(e.child,e.transform)}else if(t.op()==10){let e=t;if(e.property==2)return new ho(e.child,e.transform())}return new ho(t,null)}function W1(t,e){let r=new Et;for(let n of t)r.include3(n.currentBounds(e));return r.isValid()?r.build():x.INVALID}function kA(t,e,r,n){if(r==2)return t.currentBounds(n);if(r==4)return e.currentBounds(n);if(gc&&r==3)return t.currentBounds(n);let o=t.currentBounds(n).clone();return o.intersectWith(e.currentBounds(n)),o}function td(t,e,r){if(e.currentBounds(r).isEmpty())return e.currentBounds(r);let n=e.currentBounds(r).clone();return n.expand1(t),n}function K1(t,e){return t.currentBounds(e)}function Ju(t,e){let r=new Et,n=!1;for(let i=0,a=e.length;i<a;i=i+1){let s=e[i];r.include3(s.maxBounds),s.canBeAnalyticallyAntialiased()&&(n=!0)}if(!r.isValid())return x.INVALID;let o=r.build();return t.transformRect(o),n&&o.expand1(4),o}function MM(t,e,r,n){if(n==0)return Ju(t,e);let o=new Et;return o.include3(Ju(t,e)),o.include3(Ju(t,r)),o.isValid()?o.build():x.INVALID}function BM(t,e){return Ju(t,[e])}function GM(t,e,r){if(r==0)return x.new3(t.maxBounds);switch(e){case 0:case 1:case 3:return x.new3(t.maxBounds).expandedBy1(r);default:throw new Error("Unhandled property")}}function UM(t,e){switch(e){case 2:case 0:{let r=x.new2();return r.copyFrom(t.maxBounds),r.expandedBy1(1e6),r}case 4:case 3:case 1:case 5:return t.maxBounds;default:throw new Error(`Unhandled property ${Xs.VolatileProperty_toString(e)}`)}}function VM(t,e){return e.transformRect(x.new3(t.maxBounds))}function Y1(t,e,r){let n=new Et;return t!=null&&n.include3(t.currentBounds(r)),e!=null&&n.include3(e.currentBounds(r)),n.build()}function Q1(t,e){let r=t.currentBounds(e).clone();return r.expand1(1),r}function kM(t){let e=0;for(let r of t)e|=r.flags;return e}function q1(t,e,r){let n=t.flags&-2|e.flags;return r!=0&&r!=4&&r!=1&&(n&=-2),r==2&&(n|=32),n}function HM(t){return t.flags&-2|32}function HA(t){return t.flags&-2}function j1(t,e){let r=e.flags;return t!="PASS_THROUGH"&&(r&=-2,r|=t!="NORMAL"?1:0),r}function zM(t){let e=0;return Se.hasAnimatingMediaPaints(t.paints)&&(e|=16),(Se.hasVolatilePaints(t.paints)||t.type==1)&&(e|=8),e}var Re;(zr=>{let t;(W=>(W[W.FOR_BACKGROUND_BLUR=0]="FOR_BACKGROUND_BLUR",W[W.FOR_GLASS=1]="FOR_GLASS"))(t=zr.BackgroundContentType||(zr.BackgroundContentType={}));function e(M,G,W){if(M>zr.GEN_DURATION_LOG_THRESHOLD_S){let J=`${Rm[G]}${W}`;zr._trackingKeys.has(J)||(be.trackEvent("Slow Render Tree Generation",{duration:M,frameRole:G,callSite:W}),zr._trackingKeys.add(J))}}zr._logIfNecessary=e;function r(M,G){let W=new Al,J=be.perfTimerScope("generateRenderTree",be.ProfileLevel.LEGACY,()=>M.renderTree());return e(W.elapsedSeconds(),1,G),J}zr.renderTreeWithPerfLogging1=r;function n(M,G,W){let J=new Al,$=be.perfTimerScope("generateRenderTree",be.ProfileLevel.LEGACY,()=>M.renderTree2(G));return e(J.elapsedSeconds(),1,W),$}zr.renderTreeWithPerfLogging2=n;function o(M,G,W){let J=new Al,$=be.perfTimerScope("generateRenderTree",be.ProfileLevel.LEGACY,()=>M.renderTreeForBaseScreen2(G));return e(J.elapsedSeconds(),0,W),$}zr.renderTreeForBaseScreenWithPerfLogging=o;function i(M,G,W){let J=new Al,$=be.perfTimerScope("generateRenderTree",be.ProfileLevel.LEGACY,()=>M.renderTreeForOverlay(G));return e(J.elapsedSeconds(),1,W),$}zr.renderTreeForOverlayWithPerfLogging=i;function a(M,G,W){if(W!=null){let $=M.getCachedRenderTree();if($!=null&&($.value==null||!W.overlaps($.value.maxBounds)))return null}let J=null;switch(G.mode){case 0:{J=M.renderTree();break}case 2:{J=M.renderTreeWithoutBackgroundBlursAndGlassEffects();break}case 3:{J=M.renderTreeWithoutGlassEffects();break}case 1:{J=G.shadowOwnerID==M.uniqueIdentifier()?M.renderTreeForShadowRoot():M.renderTreeForShadowDescendant();break}case 4:{J=G.shadowOwnerID==M.uniqueIdentifier()?M.renderTreeForKnockoutShadowRoot():M.renderTreeForKnockoutShadowDescendant();break}case 5:{J=M.renderTreeForSlideThumbnail();break}case 6:{J=M.renderTreeWithoutEffects();break}default:throw new Error(`Unhandled render tree GenerateArgs mode: ${lo[G.mode]}`)}return W!=null&&(J==null||!W.overlaps(J.maxBounds))?null:J}zr._generateRenderTreeForChild=a;function s(M){return M.scrollDirection()!="NONE"&&M.hasOverflowingContentInScrollDirection()}zr._nodeCanScroll=s;function l(M,G,W){return K.useBackgroundBlurOpts()?W==null?!0:W.hasVolatileContent()?!1:!B(M,G):!1}zr._canSkipWrappingInVolatileTransforms=l;function c(M,G){if(M.isRoot())return G;if(G=b(G,M),M instanceof Xl){let $=M;$.icRoot().id()==$.uniqueIdentifier()&&$.icFramePairTransition()!=null&&(G=G!=null?$.icFramePairTransition()(G):null)}let W=M.clone(),J=M.indexInParent();if(M.moveToParent(),(s(M)||W.isStickyScrolling())&&J<p(M)){let $=M.clone(),oe=St.forScrollOffset(M.uniqueIdentifier());G=G!=null?gt.forTranslation(G,oe,()=>_a.getScrollTranslationOfNodeRelativeToParent(W).negative()):null}return G=c(M,G),M.moveToChildAt(J),G}zr._wrapInVolatileTransformsForAncestors=c;function d(M,G,W,J,$,oe){return u(M,G,W,J,$,oe)}zr._generateChildrenWithMasking=d;function u(M,G,W,J,$,oe){let re=s(M),ne=G.clone(),Te=M.clone(),se=re?Te:null,Ce=[],ye=[],Ie=W,Be=J;for(;Ie<Be;){M.moveToChildAt(Ie++);let Ye=Ce.length==0||!ie.List_last(Ce).isStandardScrolling(),Ge=Ce.length==0?null:ie.List_last(Ce).scrollSpeedMultiplier,Fe=M.parent()!=null&&M.isStickyScrolling(),Pt=se!=null&&M.isFixed(),Zr=!Fe&&!Pt,ar=K.getFeatureFlags().prototype_parallax_scroll?M.scrollSpeedMultiplier():1;Fe?(Ce.push(new di("STICKY_SCROLLS",ar)),ie.List_last(Ce).scrollingSceneNode=M.clone()):Zr&&(Ye||Ge!=ar)&&(Ce.push(new di("SCROLLS",ar)),ie.List_last(Ce).scrollingSceneNode=M.clone());let pr=Pt?ye:ie.List_last(Ce).nodes,ji=se==null||M.isFixed()?$:null;if(!M.isVisibleMask()){let Z=a(M,ne,ji);Z!=null&&pr.push(Z),M.moveToParent();continue}let $i=M.maskType(),cl=ne.clone(),ea=a(M,cl,ji),pn=[];M.moveToParent();let ug=p(M);for(;Ie<Be;){if(M.moveToChildAt(Ie),M.stopsMaskPropagation()||Ie==ug){M.moveToParent();break}if(ea!=null){let Z=a(M,ne,ji);Z!=null&&pn.push(Z)}Ie=Ie+1,M.moveToParent()}ea!=null&&pn.length!=0&&(oe==0&&Ie==Be?pr.push(Ue.wrap(pn)):$i=="LUMINANCE"?pr.push(tn.createForLuminanceMask(ea,Ue.wrap(pn))):pr.push(new tn(ea,Ue.wrap(pn))))}let Ne=Ce.filter(Ye=>Ye.nodes.length!=0),Ke=St.forScrollOffset(M.uniqueIdentifier()),Ze=[];for(let Ye=0;Ye<Ne.length;Ye=Ye+1){let Ge=Ne[Ye],Fe=Ge.scrollSpeedMultiplier;if(Ge.isStandardScrolling()){let Pt=Ge.scrollingSceneNode;if(se!=null||Fe!=1){let ar=Ye>0&&Ne[Ye-1].isStickyScrolling(),pr=Ue.wrap(Ge.nodes).optimized();!ar&&pr!=null&&(pr=_(Te,pr)),pr!=null&&Ze.push(gt.forTranslation(pr,Ke,()=>_a.getScrollTranslationOfNodeRelativeToParent(Pt).negative()))}else Wr(Ze,Ge.nodes)}else if(Ge.isStickyScrolling()){Ge.nodes.length==1,Ge.scrollingSceneNode;let Pt=Ge.scrollingSceneNode,Zr=Ge.nodes[0],ar=gt.forTranslation(Zr,Ke,()=>_a.getScrollTranslationOfNodeRelativeToParent(Pt).negative());Ze.push(ar)}}if(ye.length!=0){let Ye=Ue.wrap(ye).optimized();Ye!=null&&Ze.push(Ye)}return new Ue(Ze).optimized()}zr._generateChildrenWithMaskingNew=u;function p(M){for(let G=M.childCount()-1;G>=0;G=G-1){if(M.moveToChildAt(G),!M.isFixed())return M.moveToParent(),G+1;M.moveToParent()}return 0}zr._indexOfFirstValidFixedChild=p;function _(M,G){if(G.hasAnimatingMedia()||G.hasVolatileContent()||G.dependsOnBackgroundContent()||!G.hasNonIsolatedBlends())return G;let W=Se.firstPaintIfSolidAndOpaqueOrNull(M.fillPaintsToRender());return W==null?G:Ue.wrapWithSolidBackground(G,W.color())}zr._wrapScrollingContentWithSolidBackground=_;function h(M,G,W,J,$,oe,re){if(M.parent()==null)return null;let ne=M.indexInParent();M.moveToParent();let Te=A(M,G,W,J,$,ne,oe,re);return M.moveToChildAt(ne),Te}zr._generateBackground=h;function A(M,G,W,J,$,oe,re,ne){let Te;switch(ne){case 1:Te=new Zn(3);break;case 0:Te=new Zn(2);break}let se=d(M,Te,0,oe,G,0);if(W!=null){let Ie=M.clone();if(Ie.moveToChildAt(oe),(s(M)||Ie.isStickyScrolling())&&oe<p(M)){let Be=M.clone(),Ne=St.forScrollOffset(Be.uniqueIdentifier());W=gt.forTranslation(W,Ne,()=>_a.getScrollTranslationOfNodeRelativeToParent(Ie).negative())}se==null?se=W:se=Ue.wrap([se,W]).optimized()}se=xe(se,M.clone(),Te,1,J);let Ce=!1;M.isFrameLike()&&M.clipsChildren()&&(Ce=Se.containsAtLeastOneVisibleOpaquePaint(M.fillPaintsToRender()));let ye=K.getViewerMode()==K.ViewerMode.PROTOTYPE&&M.isTopLevel();if(!M.isRoot()&&!Ce&&!ye)se=h(M,G,se,J,$,re,ne);else{let Ie=!re&&!l($,M,se);Ie&&(se=c(M,se)),se!=null&&(se=new Ue([se,f($,new Zn(2))]),V($)&&Ie&&(se=gt.forInverseTransform(se)))}return se}zr._generateBackgroundFromParent=A;function m(M,G,W){let J=null;switch(G){case 1:{J=M.renderTreeForShadowRoot();break}case 4:{J=M.renderTreeForKnockoutShadowRoot();break}default:throw new Error(`Unhandled shadow mode: ${lo[G]}`)}if(J!=null&&W!=null){if(M.shouldOptimizeShadowForAnimation(W)){let $=M.clone(),oe=$.absoluteTransform(),re=oe.inverse();J=gt.forTransform(J,St.forShadowTransformation($.uniqueIdentifier()),()=>{let ne=$.absoluteTransform(),Te=ne.inverse();Te.multiply(X.new2().translatedBy1(W)),Te.multiply(ne);let se=X.new2();return se.multiply(oe),se.multiply(Te),se.multiply(re),se})}else{let $=X.translated(W.x(),W.y());J=new So(J,$)}J=J.optimized()}return J}zr._generateRenderTreeForShadow=m;function g(M,G){if(G.effects()!=null)for(let W=0,J=G.effects().length;W<J;W=W+1){let $=G.effects()[W];if($.type()!="INNER_SHADOW"||!$.isVisibleForRendering())continue;let oe=m(G,1,null);if(oe!=null){let re=m(G,1,$.blurOffset());if(re==null)re=new Ue([]);else{if($.spread()!=0&&(re=T(re,-$.spread(),G,$.type()),re==null))continue;re=new oi(re,N.BLACK)}oe=new oi(oe,N.BLACK);let ne=tn.createForInnerShadow(oe,fo.createForStandardBlur($.blurRadius(),re,x.INVALID),$.color());ne=new go($.blendMode(),1,ne),M!=null?M=new ni(new Ue([M,ne])):M=ne}}return M}zr._wrapWithInnerShadows=g;function S(M){let G=M.renderableContentType();if(G!=yr.RenderableContentType.RENDERABLE_GEOMETRY&&G!=yr.RenderableContentType.RENDERABLE_TEXT&&G!=yr.RenderableContentType.RENDERABLE_GROUP||G==yr.RenderableContentType.RENDERABLE_GROUP&&M.childCount()>0&&!M.clipsChildren())return!1;let W=M.fillPaints(),J=M.strokePaints(),$=M.fillGeometry(),oe=$!=null&&$.regions.length!=0,re=M.strokeGeometry(),ne=re!=null&&re.regions.length!=0,Te=oe&&W!=null&&Se.containsAtLeastOneVisibleOpaquePaint(W),se=!ne||J==null||Se.containsAtLeastOneVisibleOpaquePaint(J);if(G==yr.RenderableContentType.RENDERABLE_TEXT){let ye=M.textData().styleOverrideTable().styleByID2();for(let Ie of Array.from(ye.keys())){let Be=ye.get(Ie),Ne=Sr.get(Be,61,null);if(Ne!=null&&!Se.containsAtLeastOneVisibleOpaquePaint(ot.asPaintData(Ne))){Te=!1;break}}}return Te&&(se||M.strokeAlign()=="INSIDE")}zr._hasOpaqueGeometry=S;function R(M,G,W,J,$,oe){if(!G.isForShadows()||M.strokeAlign()!="OUTSIDE"&&M.strokeAlign()!="CENTER"||!Se.containsAtLeastOneVisibleNotFullyTransparentPaint(J)||!Se.containsAtLeastOneVisibleNotFullyTransparentPaint(W)||!M.hasDefaultStrokeParameters())return null;let re=M.effects();if(!re)return null;for(let Pt=0;Pt<re.length;Pt++)if(re[Pt].type()!="DROP_SHADOW"&&re[Pt].isVisibleForRendering())return null;let ne=$.length==1&&$[0].path().isRect(),Te=!1,se=null;if(!ne&&(M.isRoundedRect()&&(se=M.roundedRectInfo(),Te=(se&&se.isSimpleRoundedRect())??!1),!Te))return null;let Ce=M.strokeAlign()=="OUTSIDE"?2:1,ye=M.strokeAlign()=="OUTSIDE"?1:.5,Ie=M.strokeWeight()*Ce,Be=M.strokeWeight()*ye,Ne=M.size().withOnesForZeros().addScalar(Ie),Ke=new x(-Ie/2,-Ie/2,Ne.x(),Ne.y()),Ze=se&&se.nodeRadius()>0?se.nodeRadius()+Be:se&&se.vertexRadii().length>0?se.vertexRadii()[0]+Be:0,Ye=null;if(ne)Ye=new Nt(vt.fromRect(Ke),"NONZERO");else{let Pt=new na(1,Ke.topLeft(),Ke.size(),[Ze,Ze,Ze,Ze],0);Ye=new Nt(vt.fromRoundedRect(Pt),"NONZERO")}let Ge=[];Ge.push(new Gt(Ye,W));let Fe=[];return et(oe,Ge,M.size(),Fe),Ue.wrap(Fe)}zr.attemptToReplaceStrokeWithExpandedFillForDropShadow=R;function E(M,G){let W=M.isInsideOutlineMask(),J=[],$=[],oe=null,re=ae(G,M,0),ne=ae(G,M,1),Te=ae(G,M,2);if(M.renderableContentType()==yr.RenderableContentType.RENDERABLE_TEXT)mt(J,M,re,Te,M.scene(),W,G);else{let ar=G.mode==4?0:1;Ut(J,M,0,re,M.uniqueIdentifier(),G,ar)}let se=M.type()==="VECTOR"&&M.isBrushInstanceType(c_.SCATTER),Ce=[],ye=null,Ie=se&&M.hasScatterBrushInstanceTransforms()&&K.scatterBrushInstancedRendering(),Be=[],Ne=[];M.containsIndependentBordersStrokeMask()?M.generateStrokeAndStrokeMaskGeometries($,Ce,ne):Ut($,M,1,ne,M.uniqueIdentifier(),G,1);let Ke=M.size().withOnesForZeros(),Ze=M.strokeAlign();if(Ie){let ar=M.getStrokeBrushCursor();Ne=M.getScatterBrushInstanceTransforms();let pr=G.mode==4?0:1;Ut(Be,ar,0,ne,M.uniqueIdentifier(),G,pr)}G.isForShadows()&&Ze=="INSIDE"&&Xn(J)&&Xn($)&&($.length=0);let Ye=M.effects(),Ge=M.absoluteTransform();if(K.useFastStrokeShadow()&&!Ie){let ar=R(M,G,re,ne,J,Ge);if(ar)return new ue(ar,oe)}if(Ce.length&&(ye=new Tr(Ge,Ce[0],Ke)),Xr(J)&&Xr($)&&!G.isForShadows()&&En(Ye)&&!(gc&&ln(Ye,"FOREGROUND_BLUR")&&ln(Ye,"INNER_SHADOW"))){let ar=[],pr=[];et(Ge,J,Ke,ar);let ji=g(Ue.wrap(ar),M);oe=new pe(2),pr.push(ji);let $i=[];return Ie?He(Ge,Be,Ne,Ke,$i):Ze=="CENTER"?et(Ge,$,Ke,$i):zt(Ze,Ge,J,$,Ke,$i),new ue(pt(pr,$i,ye),oe)}if(Ze=="CENTER"||J.length==0||Ie){let ar=[],pr=[];return et(Ge,J,Ke,ar),Ie?He(Ge,Be,Ne,Ke,pr):et(Ge,$,Ke,pr),new ue(pt(ar,pr,ye),oe)}if(re!=null&&ne!=null&&(Se.isIsolated(re)&&Se.isIsolated(ne)||G.isForShadows())&&$.length!=0&&!ye){let ar=[],pr=[],ji=[];for(let pn of J)Se.isEmojiPaint(pn.paints)?ar.push(pn):(Se.containsPatternPaint(pn.paints)&&pr.push(pn),ji.push(pn));let $i=[],cl=[];for(let pn of $)Se.containsPatternPaint(pn.paints)?cl.push(pn):$i.push(pn);let ea=[];return et(Ge,ar,Ke,ea),et(Ge,pr,Ke,ea),ea.push(new jc(Ge,ji,$i,Ke,Ze=="INSIDE"?0:1)),cl.length>0&&zt(Ze,Ge,J,cl,Ke,ea),new ue(Ue.wrap(ea),oe)}let Pt=[],Zr=[];return et(Ge,J,Ke,Pt),zt(Ze,Ge,J,$,Ke,Zr),new ue(pt(Pt,Zr,ye),oe)}zr._generateRenderTreeForGeometry=E;function P(M,G){if(!M.visible()||M.opacity()<=0&&!(2&M.willChange()))return null;let W=null,J=0;switch(M.renderableContentType()){case yr.RenderableContentType.NON_RENDERABLE:return null;case yr.RenderableContentType.RENDERABLE_GEOMETRY:case yr.RenderableContentType.RENDERABLE_TEXT:{if(M.type()=="INTERACTIVE_SLIDE_ELEMENT"&&G.mode!=5)return null;let $=E(M,G);W=$.node,$.layerWrap!=null&&(J=$.layerWrap.value);break}case yr.RenderableContentType.TRANSFORM:case yr.RenderableContentType.RENDERABLE_GROUP:{!(G.isForShadows()&&M.clipsChildren()&&Se.containsAtLeastOneVisibleNotFullyTransparentPaint(M.fillPaintsToRender()))&&(W=d(M,G,0,M.childCount(),null,1)),M.renderableContentType()==yr.RenderableContentType.TRANSFORM&&(W=Go(W,M));break}case yr.RenderableContentType.CUSTOM_RENDER_TREE:{J=2,W=M.customRenderTree(G);break}}return xe(W,M,G,J,0)}zr.generateRenderTree=P;function T(M,G,W,J){var Ye,Ge;if(!W.isSpreadEligibleNode())return M;if(M.op()==10){let Fe=M,Pt=T(Fe.child,G,W,J);return Pt==null?null:new gt(Pt,Fe.id,Fe.property,Fe.getter)}else if(M.op()==11){let Fe=M,Pt=T(Fe.child,G,W,J);return Pt==null?null:new So(Pt,Fe.transform)}else if(M.op()==2){let Pt=T(M.child,G,W,J);return Pt==null?null:new ni(Pt)}else if(M.op()==12){let Fe=M,Pt=Fe.startChild!=null?T(Fe.startChild,G,W,J):null,Zr=Fe.endChild!=null?T(Fe.endChild,G,W,J):null;return Pt!=null||Zr!=null?new Nn(Pt,Zr,Fe.id,Fe.progressFn):null}let $=W.fillGeometry()!=null&&((Ye=W.fillGeometry())==null?void 0:Ye.regions.length)!=0&&Se.containsAtLeastOneVisiblePaint(W.fillPaints()),oe=W.strokeGeometry()!=null&&((Ge=W.strokeGeometry())==null?void 0:Ge.regions.length)!=0&&Se.containsAtLeastOneVisiblePaint(W.strokePaints()),re=$&&!oe,ne=!$&&oe,Te=null,se=M,Ce=()=>{be.trackEvent("unexpected_spread_shadow_node",{sceneNode:W.paintsDebugString(),renderNode:M.debugString1()})};for(;Te==null&&se!=null;)switch(se.op()){case 3:case 4:case 16:{Te=se;break}case 5:{se=se.alpha;break}case 7:{se=se.child;break}case 1:{let Fe=null;Ar.visitEachNodeInTree(se,Pt=>{var Zr,ar;(Pt.op()==3||Pt.op()==4||Pt.op()===16)&&(Fe==null||(((Zr=Ar.geometryNodePaintSize(Pt))==null?void 0:Zr.area())??0)>(((ar=Ar.geometryNodePaintSize(Fe))==null?void 0:ar.area())??0))&&(Fe=Pt)},null),se=Fe;break}case 0:{se=se.child,Ce();break}case 9:{se=se.alpha,Ce();break}case 6:{se=se.child,Ce();break}case 14:{se=se.child,Ce();break}default:return Ce(),we("Unexpected wrapped node for spread shadow"),M}if(Te==null||Te.op()!=3&&Te.op()!=4&&Te.op()!=16)return we(`Failed to find geometryNode after search; got ${Yn[(Te==null?void 0:Te.op())??0]}`),M;let ye=null,Ie=null,Be=null;switch(Te.op()){case 3:{let Fe=Te;ye=Ie=Fe.paintSize,Be=Fe.transform;break}case 4:{let Fe=Te;ye=Ie=Fe.paintSize,Be=Fe.transform;break}case 16:{let Fe=Te;ye=Ie=Fe.paintSize,Be=Fe.transform;break}default:return we(`Unexpected node type ${Yn[Te.op()]}`),M}if(oe&&W.strokeAlign()!="INSIDE"){let Fe=W.strokeAlign()=="OUTSIDE"?2:1;ye=ye.addScalar(W.strokeWeight()*Fe)}if(J=="DROP_SHADOW"){if(ye.x()<=-(2*G)||ye.y()<=-(2*G))return null}else J=="INNER_SHADOW"&&(G=Math.max(G,-Math.min(ye.x(),ye.y())/2));let Ne=Ie.addScalar(2*G),Ke=Ne.divide(Ie),Ze=X.new2().translatedBy2(-G,-G).scaledBy1(Ke);if(re){let Fe=W.fillGeometryForSpread(Ze,G,Se.SOLID_BLACK);return Fe==null?null:new Tr(Be,Fe,Ne)}else if(ne){let Fe=W.strokeGeometryForSpread(Ze,G,Ie,Se.SOLID_BLACK);if(Fe==null){if(J=="DROP_SHADOW")return null;Fe=new Gt(new Nt(vt.fromRect(Gr.FrozenRect_EMPTY),"NONZERO"),Se.SOLID_BLACK)}return new Tr(Be,Fe,Ne)}else{let Fe=W.strokeGeometryForSpread(Ze,G,Ie,Se.SOLID_BLACK);return Fe==null?null:new Tr(Be,Fe,Ne)}}zr._blurChildWithSpread=T;function f(M,G,W){let J=[],$=M.effects(),oe=$.filter(re=>re.dependsOnBackgroundContent()&&re.isVisibleForRendering()).length>0;for(let re=0;re<$.length;re=re+1){let ne=$[re];if(ne.type()=="DROP_SHADOW"&&ne.isVisibleForRendering()){if(G.mode==2&&!ne.showShadowBehindNode()&&oe)continue;let Te=m(M,1,ne.blurOffset());if(Te!=null){if(ne.spread()!=0&&(Te=T(Te,ne.spread(),M,ne.type()),Te==null))continue;let se=new oi(Te,ne.color()),Ce=null,ye=se.optimized();if(ye!=null&&(Ce=fo.createForStandardBlur(ne.blurRadius(),new ni(ye),x.INVALID)),Ce!=null){if(W&&(Ce=D(M,W,Ce,!1)),!ne.showShadowBehindNode()&&!S(M)){let Ie=m(M,4,null);Ce=Ie!=null&&Ce!=null?new ni(tn.createForKnockoutShadow(Ie,Ce)):null}Ce=Ce!=null?new go(ne.blendMode(),1,Ce):null,Ce!=null&&J.push(Ce)}}}}return new Ue(J)}zr._dropShadowsForNode=f;function y(M){let G=M.parent();if(G==null)return M.absoluteTransform();let W=G.absoluteTransform().clone();return W.invert()?(W.multiply(M.absoluteTransform()),W):X.new2()}zr._transformRelativeToParent=y;function v(M,G,W,J,$,oe){var Be;let re=G.size(),ne=J>0&&G.clipsChildren()&&W!=0,Te=null,se=null,Ce=ae(oe,G,0);oe.isForShadows()&&Se.containsAtLeastOneVisibleNotFullyTransparentPaint(Ce)&&(Ce=kt(1)),Se.forEachPaintWithVideo(Ce,Ne=>{let Ke=Ne.video().getVideoManager();Ke!=null&&Ke.associatePaintWithNode(Ne,G)});let ye=G.absoluteTransform(),Ie=[];if(ne){Te=Nt.getOrCreate(vt.fromRect(x.new4(ge.FrozenVector_ZERO,re).expandedBy1(J)),"ODD");let Ne=Se.isolatedPaints(Ce);for(let Ke=0,Ze=Ne.length;Ke<Ze;Ke=Ke+1)$.push(new Gt(Te,Ne[Ke]))}else if(G.fillGeometry()!=null&&((Be=G.fillGeometry())==null?void 0:Be.regions.length)!=0)Ut($,G,0,Ce,G.uniqueIdentifier(),oe,1);else if(le(0,G)){se=Nt.getOrCreate(vt.fromRect(x.new4(ge.FrozenVector_ZERO,re)),"ODD");let Ne=Se.isolatedPaints(Ce);for(let Ke=0,Ze=Ne.length;Ke<Ze;Ke=Ke+1)$.push(new Gt(se,Ne[Ke]))}if(et(ye,$,re,Ie),!G.clipsChildren()){let Ne=[],Ke=[],Ze=null,Ye=ae(oe,G,1);G.containsIndependentBordersStrokeMask()?G.generateStrokeAndStrokeMaskGeometries(Ne,Ke,Ye):Ut(Ne,G,1,Ye,G.uniqueIdentifier(),oe,1),Ke.length&&(Ze=new Tr(ye,Ke[0],re));let Ge=[];G.strokeAlign()=="CENTER"||$.length==0?et(ye,Ne,re,Ge):zt(G.strokeAlign(),ye,$,Ne,re,Ge),Ie.push(pt([],Ge,Ze))}return M!=null&&Ie.push(M),M=Ue.wrap(Ie),M}zr._wrapTreeWithFrameFillPaints=v;function w(M,G,W,J){let $=G.codeSnapshot();if(!$)return M;let{paints:oe,offset:re,layoutSize:ne,canvasSize:Te}=$;if(!oe||oe.length===0||!re||!ne)return M;let se=[],Ce=ae(J,G,3),ye=Ce[0].asSinglePaint(),Ie=Te;(!Ie||Ie.isZero())&&(Ie=ge.FrozenVector_new4(ye.originalImageWidth()/devicePixelRatio,ye.originalImageHeight()/devicePixelRatio));let Be=x.new4(re,Ie),Ne=Nt.getOrCreate(vt.fromRect(Be),"ODD"),Ke=Se.isolatedPaints(Ce);for(let Ge=0,Fe=Ke.length;Ge<Fe;Ge=Ge+1)W.push(new Gt(Ne,Ke[Ge]));let Ze=X.new3(G.absoluteTransform());Ze.translatedBy1(Be.topLeft()).translatedBy1(G.size().divideScalar(2).subtract(ne.divideScalar(2)));let Ye=yt.FrozenAffineTransform_new3(Ze);if(et(Ye,W,Ie,se),M!=null&&se.push(M),M=Ue.wrap(se),G.clipsChildren()){let Ge=new Gt(Nt.getOrCreate(vt.fromRect(x.new4(ge.FrozenVector_ZERO,G.size())),"ODD"),Se.SOLID_BLACK),Fe=new Tr(G.absoluteTransform(),Ge,G.size());M=new tn(Fe,M)}return M}zr._wrapTreeWithCodeSnapshot=w;function I(M,G,W,J,$){var Ce;let oe=G.size(),re=J>0&&G.clipsChildren()&&W!=0,ne=null,Te=null,se=G.absoluteTransform();if(re?ne=Nt.getOrCreate(vt.fromRect(x.new4(ge.FrozenVector_ZERO,oe).expandedBy1(J)),"ODD"):Te=Nt.getOrCreate(vt.fromRect(x.new4(ge.FrozenVector_ZERO,oe)),"ODD"),G.clipsChildren()){let ye=[],Ie=[];re?ne!=null&&ye.push(new Gt(ne,kt(1))):G.fillGeometry()!=null&&((Ce=G.fillGeometry())==null?void 0:Ce.regions.length)!=0?Ut(ye,G,0,kt(1),G.uniqueIdentifier(),$,1):Te!=null&&ye.push(new Gt(Te,kt(1))),et(se,ye,oe,Ie),M=new tn(Ue.wrap(Ie),M)}return M}zr._wrapTreeWithFrameMasks=I;function C(M){return M.containerSupportsFillStrokeAndCorners()?M.fillPaints():M.fillPaintsToRender()}zr._fillPaintsToRender=C;function L(M,G,W,J){let $=G.size();if(!$.isZero()){let oe=null,re=G.clipsChildren(),ne=C(G);if(Se.containsAtLeastOneVisiblePaint(ne)){let Te=[],se=[],Ce=null;W.isForShadows()&&Se.containsAtLeastOneVisibleNotFullyTransparentPaint(ne)?Ce=kt(1):Ce=Mt(W,ne,0),oe=Nt.getOrCreate(vt.fromRect(x.new4(ge.FrozenVector_ZERO,$).expandedBy1(re?J:0)),"ODD");let ye=Se.isolatedPaints(Ce);for(let Ie=0,Be=ye.length;Ie<Be;Ie=Ie+1){let Ne=ye[Ie];Te.push(new Gt(oe,Ne))}et(G.absoluteTransform(),Te,$,se),M!=null&&se.push(M),M=Ue.wrap(se)}if(M!=null&&re){oe==null&&(oe=Nt.getOrCreate(vt.fromRect(x.new4(ge.FrozenVector_ZERO,$).expandedBy1(J)),"ODD"));let Te=new Gt(oe,kt(1));M=new tn(new Tr(G.absoluteTransform(),Te,$),M)}}return M}zr._wrapTreeWithFrameBackgroundOrFillIgnoringGeometry=L;function B(M,G){let W=M.clone(),J=W.parent(),$=!0;for(;W!=null;){if(G!=null&&W.uniqueIdentifier()==G.uniqueIdentifier())return!1;if(1&W.willChange()||W.overlayRenderData()!=null)return!0;if(J==null||G!=null&&J.uniqueIdentifier()==G.uniqueIdentifier())return!1;if(!$){let oe=W.indexInParent();if(s(J)&&oe<p(J))return!0}$=!1,W=J,J=J.parent()}return!1}zr._hasVolatileTransformOnAncestor=B;function V(M){return K.useBackgroundBlurOpts()?B(M,null):!0}zr._needInverseTransform=V;function b(M,G){if(1&G.willChange()){let W=yt.FrozenAffineTransform_IDENTITY,J=G.parent();J!=null&&(W=J.absoluteTransform());let $=G.absoluteTransform().clone(),oe=$.invert(),re=G.clone();M=M!=null?gt.forTransform(M,St.forAnimateableTranslation(G.uniqueIdentifier()),()=>{let Te=X.new2();return Te.multiply(W),Te.multiply(y(re)),Te.multiply($),Te}):null;let ne=G.maxTransformScale();ne!=1&&(M=M!=null?gt.forMaxTransformScale(ne,M):null)}return M}zr._wrapTreeInVolatileTransform=b;function D(M,G,W,J){if(W==null)return null;let $=null;if(G.isVolatile()){let oe=G,re=oe.from(),ne=oe.to();$=Fa.forGrain(W,St.forAnimateableEffect(M.uniqueIdentifier()),()=>[oe.blurRadius()],()=>[oe.noiseSize().x()],()=>[oe.centerPoint()],Math.max(re.blurRadius(),ne.blurRadius()),M.absoluteTransform().clone(),oe.seed(),J??oe.clipToShape())}else $=$c.createForGrain(G.blurRadius(),G.noiseSize(),J??G.clipToShape(),W,M.absoluteTransform(),M.size().divideScalar(2),G.seed());return G.noiseSize().x()<=1&&K.getFeatureFlags().viewer_ssaa_sub_pixel_grain&&($=new ni($,32)),$}zr._generateGrain=D;function U(M,G,W){if(W==null)return null;let J=null;if(G.isVolatile()){let $=G,oe=$.from(),re=$.to();J=Fa.forNoise(W,St.forAnimateableEffect(M.uniqueIdentifier()),$.noiseType(),()=>[$.color(),$.secondaryColor()],()=>[$.density(),$.noiseSize().x()],$.blendMode(),$.seed(),M.absoluteTransform().clone(),()=>[$.centerPoint()])}else{let $=1;G.noiseType()=="MULTITONE"?$=G.effectOpacity():$=N.alphaF(G.color()),J=ed.createForNoise(G.noiseType(),G.blendMode(),G.noiseSize(),G.density(),N.new3(N.redF(G.color()),N.greenF(G.color()),N.blueF(G.color()),$),G.secondaryColor(),W,M.absoluteTransform(),M.size().divideScalar(2),G.seed()),G.noiseSize().x()<=1&&K.getFeatureFlags().viewer_ssaa_sub_pixel_noise&&(J=new ni(J,32))}return J}zr._generateNoise=U;function H(M,G,W,J){if(W==null)return null;let $=null;if(G.isVolatile()){let oe=G,re=oe.from(),ne=oe.to();if(oe.blurOpType()==="PROGRESSIVE"){let Te=re.blurStartOffset().multiply(oe.fromNodeSize()),se=re.blurEndOffset().multiply(oe.fromNodeSize()),Ce=ne.blurStartOffset().multiply(oe.toNodeSize()),ye=ne.blurEndOffset().multiply(oe.toNodeSize()),Ie=M.absoluteTransform().transformPoint(Te),Be=M.absoluteTransform().transformPoint(se),Ne=M.absoluteTransform().transformPoint(Ce),Ke=M.absoluteTransform().transformPoint(ye);$=Fa.forProgressiveBlur(W,St.forAnimateableEffect(M.uniqueIdentifier()),()=>[oe.blurStartRadius(),oe.blurRadius()],()=>[oe.blurStartOffsetInCanvasSpace(Ie,Ne),oe.blurEndOffsetInCanvasSpace(Be,Ke)],J,Math.max(re.blurRadius(),ne.blurRadius()))}else oe.blurOpType()==="NORMAL"&&($=Fa.forBlur(W,St.forAnimateableEffect(M.uniqueIdentifier()),()=>[oe.blurRadius(),oe.blurRadius()],J,Math.max(re.blurRadius(),ne.blurRadius())))}else if(G.blurOpType()=="PROGRESSIVE"){let oe=G.blurStartOffset().multiply(M.size()),re=G.blurEndOffset().multiply(M.size()),ne=M.absoluteTransform().transformPoint(oe),Te=M.absoluteTransform().transformPoint(re);$=fo.createForProgressiveBlur(G.blurStartRadius(),G.blurRadius(),ne,Te,W,J)}else $=fo.createForStandardBlur(G.blurRadius(),W,J);return $}zr._generateBlur=H;function k(M,G){var J;if(M.backgroundAppearance.backgroundType=="NONE")return null;let W=ir(M.backgroundAppearance,((J=G.scene().findNode(G.overrideKey()))==null?void 0:J.canvasSpaceBoundingBox())??null);return W!=null?(M.backgroundTransitionProgress!=null&&(W=gt.forOpacity(W,St.OVERLAY_BACKGROUND,M.backgroundTransitionProgress)),gt.forInverseTransform(W)):null}zr._generateRenderTreeForOverlayBackground=k;function z(M,G,W,J){let $=[];for(let oe=0,re=M.count();oe<re;oe=oe+1){let ne=M.keys()[oe];if(ne==G)break;let Te=M.get(ne),se=Te.overlayNode,Ce=k(Te,W.clone()),ye=null;switch(J){case 0:ye=se.renderTreeWithoutBackgroundBlursAndGlassEffects();break;case 1:ye=se.renderTreeWithoutGlassEffects();break}if(Ce!=null&&$.push(Ce),ye!=null){let Ie=Te.bounds.center(),Be=se.canvasSpaceBoundingBox().center(),Ne=Ie.subtract(Be),Ke=Ye=>()=>Ye,Ze=gt.forInverseTransform(gt.forTranslation(ye,St.forOverlayPosition(oe),Ke(Ne)));$.push(Ze)}}return new Ue($)}zr._generateIntermediateOverlays=z;function q(M,G,W,J,$,oe){let re=x.new2();re.copyFrom(M.bounds);let ne=M.baseTlfCursor.clone(),Te=G.overlayRenderData(),se=[],Ce=A(ne.clone(),re,null,J,G.clone(),ne.childCount(),!1,$);Ce!=null&&se.push(Ce);let ye=z(Te,M.overlayId,ne.clone(),$);ye!=null&&se.push(ye);let Ie=k(M,ne);Ie!=null&&se.push(Ie);let Be=null;return M.overlayId!=G.uniqueIdentifier()&&(Be=h(G,W,null,J,G.clone(),!0,$),Be!=null&&(Be=gt.forInverseTransform(gt.forTranslation(Be,St.ENTERING_OVERLAY,()=>(M.transform!=null?M.transform():ge.FrozenVector_new4(0,0)).add(M.animationTransform!=null?M.animationTransform():ge.FrozenVector_new4(0,0)))))),Be!=null&&se.push(Be),new Ue(se)}zr._generateBackgroundForOverlays=q;function Y(M,G,W,J,$){let oe=J.type()=="BACKGROUND_BLUR"?J.blurRadius():Math.max(J.blurRadius(),J.reflectionDistance()),re=m(M,1,null);if(re!=null){let ne=null,Te=null;ne=x.new2();let se=!M.isFixed(),Ce=null;if(se){for(Ce=M.parent()!=null?M.parent().clone():null;Ce!=null&&!s(Ce);)Ce=Ce.parent();se=Ce!=null}if(ne.copyFrom(se&&Ce!=null?Ce.canvasSpaceContentBounds():re.maxBounds),M.overlayRenderData()!=null){let ye=M.clone(),Ie=null,Be=M.overlayRenderData();for(;ye!=null&&Be!=null&&(Ie=Be.get(ye.uniqueIdentifier()),Ie==null);)ye=ye.parent();if(ye==null||Ie==null)return we("Blurred node with overlay data cannot be found in an overlay"),G;ne=x.new2(),ne.copyFrom(Ie.bounds),Te=q(Ie,M.clone(),re.maxBounds,oe,J.type()=="BACKGROUND_BLUR"?0:1,W)}else Te=h(M,ne,null,oe,M.clone(),!1,$);if(Te!=null){let ye=null,Ie=Nm(re),Be=Ie.op()==3?Ie:null;Be!=null&&Be.geometry.type==0?ye=Be.geometryBounds():ye=re.maxBounds;let Ne=null;if(J.type()=="BACKGROUND_BLUR"?Ne=H(M,J,Te,ye):Ne=j(M,J,Te),Ne!=null){let Ke=tn.createForBackgroundBlur(re,Ne);G=new Ue([Ke,G])}}G=ds.createForBackgroundBlur(G)}return G}zr._generateBackgroundEffect=Y;function j(M,G,W){if(W==null)return null;let J=null,$=M.roundedRectInfo(),oe=vt.fromRoundedRect($);if(G.isVolatile()){let re=G.asVolatileEffect(),ne=re.from(),Te=re.to(),se=re.cornerRadius()!=-1;J=Fa.forGlass(W,St.forAnimateableEffect(M.uniqueIdentifier()),()=>[re.blurRadius(),re.refractionIntensity(),re.refractionDistance(),re.specularIntensity(),re.specularAngle(),re.bevelSize(),re.chromaticAberration()*qs.CHROMATIC_EXPANSION_FACTOR,re.reflectionDistance(),re.textureRadius(),se?re.cornerRadius():oe.radii().topLeft,re.secondaryColor()],()=>[re.centerPoint()],0,$.cornerSmoothing(),M.absoluteTransform())}else J=qs.createForGlassEffect(G.blurRadius(),0,G.refractionIntensity(),G.refractionDistance(),G.specularIntensity(),G.specularAngle(),G.bevelSize(),G.chromaticAberration()*qs.CHROMATIC_EXPANSION_FACTOR,G.reflectionDistance(),G.secondaryColor(),oe.radii(),$.cornerSmoothing(),M.absoluteTransform(),M.size().divideScalar(2),W);return J}zr._generateGlass=j;function ae(M,G,W){let J=G.isInsideOutlineMask(),$;switch(W){case 1:$=G.strokePaints();break;case 0:$=G.fillPaints();break;case 3:$=G.codeSnapshot().paints;break;case 2:$=G.textDecorationFillPaints()??G.fillPaints();break;default:throw new Error(`Unknown paint type: ${W}`)}let oe=$!=null&&Se.containsAtLeastOneVisiblePaint($);return J?kt(oe?1:0):Mt(M,$,W)}zr._getFinalizedPaintData=ae;function xe(M,G,W,J,$){let oe=[],re=J==0&&G.isFrameLike()&&G.containerSupportsFillStrokeAndCorners()&&!G.isGroup()&&G.clipsChildren(),ne=G.isFrameLike()&&!G.size().isZero(),Te=G.overlayRenderData()==null&&G.isTopLevel()&&G.isFrameLike()&&Se.containsAtLeastOneVisibleOpaquePaint(G.fillPaintsToRender())||G.type()==="SLIDE",se=!G.containerSupportsFillStrokeAndCorners()||G.isGroup(),Ce=ne&&!se;ne&&(se?M=L(M,G,W,$):M=v(M,G,J,$,oe,W)),Qt.supportsCodeSnapshot(G.type())&&(M=w(M,G,oe,W)),M!=null&&(M=M.optimized());let ye=W.mode!==6&&!W.isForShadows()&&G.effects()!=null,Ie=!1,Be=!1,Ne=[];if(ye)if(M!=null){if(W.mode==0||W.mode==3)for(let Ye=0,Ge=G.effects().length;Ye<Ge;Ye=Ye+1){let Fe=G.effects()[Ye];if((Fe.type()=="BACKGROUND_BLUR"||Fe.type()=="GLASS"&&G.isRoundedRect()&&W.mode==0)&&Fe.isVisibleForRendering()){S(G)||(M=Y(G,M,W,Fe,Fe.type()=="BACKGROUND_BLUR"?0:1));break}}if((J==1||J==0)&&(M=g(M,G)),!Te){let Ye=null;for(let Ge=0;Ge<G.effects().length;Ge++){let Fe=G.effects()[Ge];Fe.type()==="GRAIN"&&Fe.isVisibleForRendering()&&Fe.clipToShape()?(Ie=!0,Ye=Fe):Fe.type()==="NOISE"&&Fe.isVisibleForRendering()&&(Be=!0)}Ie||Be?Ne.push(f(G,W,Ye??void 0)):Ne.push(f(G,W))}}else Te||Ne.push(f(G,W));if(M==null&&Ne.length==0&&!re)return M;let Ke=re&&G.strokeAlign()=="INSIDE";if(Ce&&!Ke&&M!=null&&(M=I(M,G,J,$,W)),re&&!tt(G,W,oe)){let Ye=G.absoluteTransform(),Ge=[],Fe=[],Pt=ae(W,G,1),Zr=[],ar=null;M!=null&&Zr.push(M),G.containsIndependentBordersStrokeMask()?G.generateStrokeAndStrokeMaskGeometries(Ge,Fe,Pt):Ut(Ge,G,1,Pt,G.uniqueIdentifier(),W,1),Fe.length&&(ar=new Tr(Ye,Fe[0],G.size()));let pr=[];G.strokeAlign()=="CENTER"||oe.length==0||Ke?et(Ye,Ge,G.size(),pr):zt(G.strokeAlign(),Ye,oe,Ge,G.size(),pr),M=pt(Zr,pr,ar)}else Ke=!1;if(re&&G.strokeAlign()=="OUTSIDE"&&G.clipsChildren()&&M!=null&&(M=ni.thatShouldNotBeUnwrappedInOptimization(M)),Ce&&Ke&&M!=null&&(M=I(M,G,J,$,W)),M==null?(M=new Ue(Ne),Ne=[]):!Ie&&!Be&&(M=new Ue([new Ue(Ne),M]),Ne=[]),M!=null&&ye)for(let Ye=0,Ge=G.effects().length;Ye<Ge;Ye=Ye+1){let Fe=G.effects()[Ye];Fe.type()=="FOREGROUND_BLUR"&&Fe.isVisibleForRendering()&&(Ne.length!=0&&(M=M!=null?new Ue([new Ue(Ne),M]):new Ue([new Ue(Ne)]),Ne=[]),M=H(G,Fe,M,x.INVALID)),Fe.type()==="GRAIN"&&Fe.isVisibleForRendering()&&(Fe.clipToShape()||Ne.length!=0&&(M=M!=null?new Ue([new Ue(Ne),M]):new Ue([new Ue(Ne)]),Ne=[]),M=D(G,Fe,M)),Fe.type()==="NOISE"&&Fe.isVisibleForRendering()&&(M=U(G,Fe,M))}if(Ne.length!=0&&(M=M!=null?new Ue([new Ue(Ne),M]):new Ue([new Ue(Ne)])),W.isForShadows()&&W.shadowOwnerID==G.uniqueIdentifier())return(M==null?void 0:M.optimized())??null;let Ze=2&G.willChange()?1:G.opacity();if(M=M!=null?new go(G.blendMode(),Ze,M):null,M=(M==null?void 0:M.optimized())??null,M!=null&&2&G.willChange()){let Ye=G.clone();M=new gt(M,St.forAnimateableOpacity(Ye.uniqueIdentifier()),4,()=>Ye.opacity())}return M!=null&&(M=b(M,G)),M}zr._wrapTreeWithLayerProperties=xe;function Je(M){if(M==null)return[];let G=!1;for(let J=0,$=M.length;J<$;J=J+1){let oe=M[J].asVolatilePaint();if(oe!=null){if(oe.from().image()!=null&&oe.from().image().isDecoded()||oe.from().imageThumbnail()!=null&&oe.from().imageThumbnail().isDecoded()||oe.to().image()!=null&&oe.to().image().isDecoded()||oe.to().imageThumbnail()!=null&&oe.to().imageThumbnail().isDecoded()){G=!0;break}}else if(M[J].asSinglePaint()!=null){let re=M[J].asSinglePaint();if(re.image()!=null&&re.image().isDecoded()||re.imageThumbnail()!=null&&re.imageThumbnail().isDecoded()){G=!0;break}}if(!M[J].isEnabledAndVisible()){G=!0;break}}if(!G)return M;let W=[];for(let J=0,$=M.length;J<$;J=J+1){if(!M[J].isEnabledAndVisible())continue;let oe=M[J].asVolatilePaint();if(oe!=null){let re=oe.cloneAsVolatilePaint();re.from().setDecodedImageIsReady(re.from().image()!=null&&re.from().image().isDecoded()),re.to().setDecodedImageIsReady(re.to().image()!=null&&re.to().image().isDecoded()),re.from().setDecodedImageThumbnailIsReady(re.from().imageThumbnail()!=null&&re.from().imageThumbnail().isDecoded()),re.to().setDecodedImageThumbnailIsReady(re.to().imageThumbnail()!=null&&re.to().imageThumbnail().isDecoded()),W.push(re)}else if(M[J].asSinglePaint()!=null){let re=M[J].asSinglePaint().cloneAsSinglePaint();re.setDecodedImageIsReady(re.image()!=null&&re.image().isDecoded()),re.setDecodedImageThumbnailIsReady(re.imageThumbnail()!=null&&re.imageThumbnail().isDecoded()),W.push(re)}}return W}zr._filteredPaintsWithImageAvailability=Je;function We(M,G,W){if(M!=4||W==1&&G.length==0)return G;let J=[];for(let $=0,oe=G.length;$<oe;$=$+1){let re=G[$];if(re.type()=="IMAGE"||re.type()=="EMOJI"||re.type()=="VIDEO")J.push(re);else return[ee.createSolid(N.BLACK,1)]}return J.length==0&&J.push(ee.SOLID_BLACK),J}zr._filteredPaintsForKnockoutShadow=We;function pt(M,G,W){return W?(M.push(new tn(W,new Ue(G))),new Ue(M)):new Ue(M.concat(G))}zr.wrapFillsStrokesAndStrokeMasks=pt;function Mt(M,G,W){return We(M.mode,Je(G),W)}zr._substitutePaintsAsNeeded=Mt;function nr(M,G,W,J,$,oe){var Te;if(Q.equals(G.overrideKey(),Q._new(4e7,2)))return!1;let ne=G.strokeGeometry()!=null&&((Te=G.strokeGeometry())==null?void 0:Te.regions.length)!=0&&Se.containsAtLeastOneVisiblePaint(G.strokePaints());if(J!=0||ne&&!wt(G,oe,$))return!1;for(let se of W.regions)if(se.type==1)return!1;switch(G.type()){case"ELLIPSE":{if(G.arcData()==null||Se.hasEmoji($))return!1;let se=G.arcData(),Ce=se.innerRadius<=0,ye=se.endingAngle-se.startingAngle,Ie=Math.abs(ye)>2*Math.PI-.001,Be=G.size().withOnesForZeros();if(Ce&&Ie&&W.regions.length==1&&W.regions[0].type==0){let Ke=Be.divideScalar(2),Ze=new cs(Ke,Ke.x(),Ke.y()),Ye=new Nt(Ze,"NONZERO"),Ge=Se.isolatedPaints($);for(let Fe=0,Pt=Ge.length;Fe<Pt;Fe=Fe+1){let Zr=Ge[Fe];M.push(new Gt(Ye,Zr))}return!0}break}case"RECTANGLE":case"ROUNDED_RECTANGLE":case"FRAME":case"STAMP":case"SYMBOL":case"INSTANCE":case"INTERACTIVE_SLIDE_ELEMENT":{let se=G.roundedRectInfo();if(!vt.isRoundedRectSupported(se)||se==null)return!1;let Ce=vt.fromRoundedRect(se),ye=new Nt(Ce,"NONZERO"),Ie=Se.isolatedPaints($);for(let Be=0,Ne=Ie.length;Be<Ne;Be=Be+1){let Ke=Ie[Be];M.push(new Gt(ye,Ke))}return!0}}return!1}zr._attemptToGenerateAAAGeometry=nr;function ir(M,G){switch(M.backgroundType){case"NONE":return null;case"SOLID_COLOR":{if(G==null)return null;let W=M.backgroundColor;return Tr.solidColorRect(G,W,1)}}throw new Error(`Unhandled backgroundType ${M.backgroundType}`)}zr.renderTreeForOverlayBackground=ir;function le(M,G){if(M==0){let W=G.fillPaints(),J=G!=null&&G.clipsChildren();return G!=null&&(J||Se.containsAtLeastOneVisiblePaint(W)||G.strokeAlign()!="CENTER"&&le(1,G))}else if(M==1){let W=G.strokePaints();return Se.containsAtLeastOneVisiblePaint(W)&&G.hasNonZeroStrokeWeight()}return!1}zr._isGeometryNecessary=le;function Ut(M,G,W,J,$,oe,re){let ne=W==0?G.fillGeometry():G.strokeGeometry();if(W==0&&re==1&&!le(W,G)&&(ne=null),ne==null||J==null)return;if(Se.forEachPaintWithVideo(J,se=>{let Ce=se.video().getVideoManager();Ce!=null&&Ce.associatePaintWithNode(se,G)}),G.hasPerRegionFillPaints()&&W==0){G.forEachRegionWithFillPaintBatch((se,Ce)=>{let ye=Se.isolatedPaints(Ce);for(let Ie=0,Be=ye.length;Ie<Be;Ie=Ie+1){let Ne=Je(ye[Ie]);Se.forEachPaintWithVideo(Ne,Ze=>{let Ye=Ze.video().getVideoManager();Ye!=null&&Ye.associatePaintWithNode(Ze,G)});let Ke=Nt.getOrCreate(se.path(),se.windingRule);M.push(new Gt(Ke,Ne))}});return}if(nr(M,G,ne,W,J,oe))return;let Te=Se.isolatedPaints(J);for(let se=0,Ce=Te.length;se<Ce;se=se+1){let ye=Te[se],Ie=null,Be=()=>{if(Ie!=null){let Ne=Ie.compilePaths(),Ke=Nt.getOrCreate(Ne,Ie.windingRule);M.push(new Gt(Ke,ye)),Ie=null}};for(let Ne of ne.regions)Ne.bounds().isEmpty()||(Ne.type==0?Ie!=null&&Ie.canAddRegion(Ne)?Ie.add(Ne):(Be(),Ie=new ce(Ne)):(Be(),M.push(new Jc(()=>new Nt(Ne.path(),Ne.windingRule),ye,Ne.bounds(),St.forDynamicGeometry($)))));Be()}}zr._generateGeometries=Ut;function mt(M,G,W,J,$,oe,re){be.perfTimerScope("text-geometry-viewer",be.ProfileLevel.LOW,()=>{let ne=G.textGeometry();if(ne==null||W==null)return;let Te=(ye,Ie)=>{var Ke;let Be=nn.getEmojiImageUrl(ye,Ie),Ne=((Ke=G.derivedTextData())==null?void 0:Ke.usedEmojiImages())??[];for(let Ze of Ne)if(Ze.url()==Be){let Ye=new ee("EMOJI");return Ye.setOpacity(1),Ye.setBlendMode("NORMAL"),Ye.setImage(Ze),Mt(re,[Ye],0)}return null},se=ye=>{var Be;let Ie=((Be=ne==null?void 0:ne.paintOverrides)==null?void 0:Be.get(ye,$))??null;return Ie!=null?Mt(re,Ie,0):Mt(re,W,0)},Ce=(ye,Ie)=>{let Be=Ie.textData();if(!Be)return null;let Ne=Be.styleOverrideTable().styleByID2(),Ke=Ne.get(ye);if(!Ke)return null;let Ze=Sr.get(Ke,63,null);if(Ze!=null)return ot.asPaintData(Ze);let Ye=Ne!=null?Sr.get(Ke,104,null):null,Ge=Ye!=null?$.findStyle(ot.asStyleId(Ye)):null;return Ge!=null&&Ge.styleType()=="TEXT"?Ge.textDecorationFillPaints():null};for(let ye=0,Ie=ne.regions.length;ye<Ie;ye=ye+1){let Be=ne.regions[ye];if(ne.emojiCodepoints[ye]&&ne.emojiCodepoints[ye].length>0){let Ze=Nt.getOrCreate(Be.path(),Be.windingRule),Ye=Te(ne.emojiCodepoints[ye],ne.emojiImageSet);if(Ye==null)continue;let Ge=ne.emojiRotationWidthHeights.get(ye),Fe=Ge?Ge[0]:0,Pt=Ge?Ge[1]:0,Zr=Ge?Ge[2]:0;Fe!=0?M.push(new Gt(Ze,Ye,Fe,new O(Pt,Zr))):M.push(new Gt(Ze,Ye));continue}if(ne.decorationRegions[ye]){let Ze=ne.decorationRegions[ye],Ye=Nt.getOrCreate(Ze.path(),Ze.windingRule),Ge=Ce(Ze.styleID,G),Fe=Ge&&Ge.length>0?Ge:J.length>0?J:se(Ze.styleID);Fe!=null&&M.push(new Gt(Ye,Fe))}let Ne=se(Be.styleID);if(Ne==null)continue;for(let Ze=0,Ye=Ne.length;Ze<Ye;Ze=Ze+1){let Ge=Ne[Ze].asSinglePaint();(Ge==null?void 0:Ge.video())!=null&&Ge.video().getVideoManager().associatePaintWithNode(Ge,G)}let Ke=Se.isolatedPaints(Ne);for(let Ze=0,Ye=Ke.length;Ze<Ye;Ze=Ze+1){let Ge=Ke[Ze];if(!Be.bounds().isEmpty()){let Fe=Nt.getOrCreate(Be.path(),Be.windingRule);M.push(new Gt(Fe,Ge))}}}})}zr._generateGeometriesForText=mt;function He(M,G,W,J,$){if(G.length==0)return;let oe=!1,re=!1;for(let se=0,Ce=G.length;se<Ce;se=se+1){let ye=G[se];Se.containsAtLeastOneVisiblePaint(ye.paints)&&(oe=!0),Se.containsPatternPaint(ye.paints)&&(re=!0)}if(!oe)return;let ne=new $u(M,G,J,W),Te=G[0].paints;if(re){let se=tn.createForPatternScatterFill(ne);$.push(se)}else Te.length!=0&&Te[0].blendMode()!="NORMAL"?$.push(new go(Te[0].blendMode(),1,ne)):$.push(ne)}zr._generateScatterBrushFills=He;function et(M,G,W,J){for(let $=0,oe=G.length;$<oe;$=$+1){let re=G[$];if(Se.containsAtLeastOneVisiblePaint(re.paints)){let ne=new Tr(M,re,W),Te=re.paints;if(Se.containsPatternPaint(re.paints)){let se=tn.createForPatternFill(ne,re.paints[0].asSinglePaint());J.push(se);continue}Te.length!=0&&Te[0].blendMode()!="NORMAL"?J.push(new go(Te[0].blendMode(),1,ne)):J.push(ne)}}}zr._generateFills=et;function tt(M,G,W){if(G.mode!=1||M.strokeAlign()!="INSIDE")return!1;for(let J=0,$=W.length;J<$;J=J+1){let oe=W[J];if(Se.containsAtLeastOneVisibleOpaquePaint(oe.paints))return!0}return!1}zr._canSkipInsideStrokesForShadows1=tt;function wt(M,G,W){return G.mode!=1||M.strokeAlign()!="INSIDE"?!1:Se.containsAtLeastOneVisibleOpaquePaint(W)}zr._canSkipInsideStrokesForShadows2=wt;function zt(M,G,W,J,$,oe){let re=[];for(let ne=0,Te=W.length;ne<Te;ne=ne+1){let se=W[ne];re.push(new Gt(se.path(),Se.EMPTY))}for(let ne=0,Te=J.length;ne<Te;ne=ne+1){let se=J[ne],Ce=se.paints,ye=[se],Ie=new jc(G,re,ye,$,M=="INSIDE"?0:1);if(Ce.length!=0){if(Se.containsPatternPaint(Ce)){let Be=new Tr(G,new Gt(se.path(),Ce),ge.FrozenVector_ZERO),Ne=tn.createForPatternStroke(Be,Ie,Ce[0].asSinglePaint());oe.push(Ne);continue}oe.push(new go(Ce[0].blendMode(),1,Ie))}}}zr._generateFillStrokes=zt;function kt(M){return M==1?Se.SOLID_BLACK:Se.EMPTY}zr._outlineMaskPaintData=kt;function Xr(M){for(let G=0,W=M.length;G<W;G=G+1){let J=M[G];if(Se.containsAtLeastOneVisiblePaint(J.paints))return!0}return!1}zr._isAnyGeometryVisible=Xr;function ln(M,G){for(let W=0,J=M.length;W<J;W=W+1){let $=M[W];if($.type()==G&&$.isEnabledAndVisible())return!0}return!1}zr._hasVisibleEffectsOfType=ln;function En(M){for(let G=0,W=M.length;G<W;G=G+1)if(M[G].isEnabledAndVisible())return!0;return!1}zr._hasVisibleEffects=En;function Xn(M){if(M.length!=1)return!1;let G=M[0].paints;return G.length==1&&G[0].type()=="SOLID"}zr._isSingleSolidGeometry=Xn;function Ji(){return zr._flushBeforeMasks}zr.flushBeforeMasks=Ji;function Or(M){zr._flushBeforeMasks=M}zr.setFlushBeforeMasks=Or;let lo;(ne=>(ne[ne.NORMAL=0]="NORMAL",ne[ne.SHADOW=1]="SHADOW",ne[ne.WITHOUT_BACKGROUND_BLURS_AND_GLASS_EFFECTS=2]="WITHOUT_BACKGROUND_BLURS_AND_GLASS_EFFECTS",ne[ne.WITHOUT_GLASS_EFFECTS=3]="WITHOUT_GLASS_EFFECTS",ne[ne.KNOCKOUT_SHADOW=4]="KNOCKOUT_SHADOW",ne[ne.SLIDE_THUMBNAIL=5]="SLIDE_THUMBNAIL",ne[ne.WITHOUT_EFFECTS=6]="WITHOUT_EFFECTS"))(lo=zr.RenderMode||(zr.RenderMode={}));let Pi;(W=>(W[W.INCLUDE=0]="INCLUDE",W[W.IGNORE=1]="IGNORE"))(Pi=zr.IncludeUnnecessaryGeometry||(zr.IncludeUnnecessaryGeometry={}));class Zn{constructor(G,W=null){this.mode=G,this.shadowOwnerID=W}clone(){return new Zn(this.mode,this.shadowOwnerID)}isForShadows(){return this.mode==1||this.mode==4}}zr.GenerateArgs=Zn;let Fi;(W=>(W[W.FILL=0]="FILL",W[W.STROKE=1]="STROKE"))(Fi=zr.GeometryType||(zr.GeometryType={}));let Di;(W=>(W[W.IGNORE=0]="IGNORE",W[W.INCLUDE=1]="INCLUDE"))(Di=zr.LastMask||(zr.LastMask={}));class di{constructor(G,W){this.nodes=[],this.scrollBehavior=G,this.scrollSpeedMultiplier=W,this.scrollingSceneNode=null}isFixed(){return this.scrollBehavior=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"}isStickyScrolling(){return this.scrollBehavior=="STICKY_SCROLLS"}isStandardScrolling(){return this.scrollBehavior=="SCROLLS"}}zr.ContiguousRenderNodes=di;class ue{constructor(G,W){this.node=G,this.layerWrap=W}}zr.GeometryRenderTreeResult=ue;let De;(J=>(J[J.WITH_INNER_SHADOWS_AND_TOP_STROKE=0]="WITH_INNER_SHADOWS_AND_TOP_STROKE",J[J.WITH_INNER_SHADOWS_ONLY=1]="WITH_INNER_SHADOWS_ONLY",J[J.WITHOUT_LAYER_WRAPS=2]="WITHOUT_LAYER_WRAPS"))(De=zr.LayerWrap||(zr.LayerWrap={}));let ve;($=>($[$.FILL_PAINT_DATA=0]="FILL_PAINT_DATA",$[$.STROKE_PAINT_DATA=1]="STROKE_PAINT_DATA",$[$.TEXT_DECORATION_FILL_PAINT_DATA=2]="TEXT_DECORATION_FILL_PAINT_DATA",$[$.CODE_SNAPSHOT_PAINT_DATA=3]="CODE_SNAPSHOT_PAINT_DATA"))(ve=zr.PaintType||(zr.PaintType={}));class Le{constructor(G){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.minX=G.left(),this.maxX=G.right(),this.minY=G.top(),this.maxY=G.bottom()}}zr.RBushRect=Le;class ce{constructor(G){this._uniquePathsOnly=!1,this._collisionTracker=new eP.default,this._paths=[],this.windingRule=G.windingRule,this._uniquePathsOnly=G.path()instanceof Fo,this.add(G)}compilePaths(){var W,J;if(this._paths.length==1)return this._paths[0];if(this._uniquePathsOnly){let $=[];for(let ne of this._paths)$.push(ne.handle);let oe=((J=(W=F().modules())==null?void 0:W.uniquePathHelpers)==null?void 0:J.getVolatileConcatenatedPaths($))??[],re=new Uint8Array(oe);return new $e(new Bn(re))}let G=this._paths[0].toBezierPath().getMutableClone();for(let $=1,oe=this._paths.length;$<oe;$=$+1)G.append(this._paths[$].toBezierPath());return G}canAddRegion(G){return G.windingRule==this.windingRule&&this._uniquePathsOnly==G.path()instanceof Fo&&!this._collisionTracker.collides(new Le(G.path().bounds()))}add(G){this._paths.push(G.path()),this._collisionTracker.insert(new Le(G.path().bounds()))}}zr.PathBatch=ce;let ze;(W=>(W[W.ALL_PAINTS_INVISIBLE=0]="ALL_PAINTS_INVISIBLE",W[W.HAS_VISIBLE_PAINTS=1]="HAS_VISIBLE_PAINTS"))(ze=zr.PaintVisibility||(zr.PaintVisibility={})),zr.GEN_DURATION_LOG_THRESHOLD_S=.15,zr._trackingKeys=new Set,zr._flushBeforeMasks=!1;function Go(M,G){if(!M)return we("transform tree is null"),new Ue([]);let J=G.transformModifiers()??[],$={x:1/0,y:1/0},oe={x:-1/0,y:-1/0};for(let ne=0;ne<G.childCount();ne++){G.moveToChildAt(ne);let Te=new Na(G.relativeTransform().clone(),G.size().clone());for(let se=0;se<4;se++)$.x=Math.min($.x,Te.get(se).x()),$.y=Math.min($.y,Te.get(se).y()),oe.x=Math.max(oe.x,Te.get(se).x()),oe.y=Math.max(oe.y,Te.get(se).y());G.moveToParent()}let re=new Na([new O($.x,$.y),new O($.x,oe.y),new O(oe.x,oe.y),new O(oe.x,$.y)]);for(let ne of J)if(ne.visible())switch(ne.type()){case"REPEAT":{let[Te,se]=_c(M,G,ne,re);M=Te,re=se;break}case"SYMMETRY":case"SKEW":break}return M??new Ue([])}function _c(M,G,W,J){if(!W.visible()||!W.repeatType())return[M,J];switch(W.repeatType()){case"LINEAR":{let $=J.bounds();return e_(M,G,W,J,$)}case"RADIAL":return uF(M,G,W,J)}return[M,J]}function e_(M,G,W,J,$){if(!M)return[null,J];if(!W.unitType()||!W.axis()||!W.repeatType())return[M,J];let oe=W.offset(),re=W.count()??1,ne=G.absoluteTransform(),Te=ne.determinant()<0&&W.axis()=="Y"?-Math.PI:0,se=ne.toAngle()+Te,Ce=$.center(),ye;W.axis()==="X"?ye=J.bounds().size().x():ye=J.bounds().size().y();let Ie=W.unitType()==="PIXELS"?W.offset().x():ye*W.offset().x(),Be=W.order()==="LAST"?-1:1,Ne=[];for(let Ye=0;Ye<re;Ye++){let Ge=new O(0,0);W.axis()==="X"?Ge.setX(Ie*Ye*Be):Ge.setY(Ie*Ye*Be);let Fe=pF(Ge,Ce,se),Pt=new So(M,Fe);Ne.push(Pt)}let Ke=$T(J,oe,re,W.unitType(),W.repeatType(),W.axis());return[new Ue(Ne),Ke]}function uF(M,G,W,J){if(M===null)return[null,J];if(!W.unitType()||!W.axis()||!W.repeatType())return[M,J];let $=J.bounds(),oe=G.absoluteTransform(),re=oe.transformRect(x.new3($)),ne=oe.toAngle(),Te=re.center(),se=X.forRotationAboutPoint(ne,Te),Ce=W.offset().x(),ye=W.unitType(),Ie=ye==="PIXELS"?new O(0,Ce/2):new O(0,$.height()/2*Ce),Be=re.size(),Ne=new O(re.x(),re.y()),Ke=Be.divideScalar(2).add(Ne).add(Ie),Ze=W.count()??1,Ye=Math.PI*2/Ze,Ge=W.order()==="LAST"?-1:1,Fe=[];for(let pn=0;pn<Ze;pn++){let ug=pn*Ye*Ge,Z=X.forRotationAboutPoint(ug,Ke),_F=x.new3(re),eE=Z.transformRect(_F).center(),tE=se.transformPoint(O.new(eE));if(Z.preTranslate(tE.subtract(eE)),oe.determinant()<0){let mF=Te.subtract(tE).multiplyScalar(2);Z.preTranslate(mF)}let hF=new So(M,Z);Fe.push(hF)}let Pt=$T(J,W.offset(),Ze,ye,"RADIAL"),Zr=new Ue(Fe),ar=re.topLeft().subtract(Ke).length(),pr=Zr.maxBounds,ji=Math.max(0,ar*2-pr.width()),$i=Math.max(0,ar*2-pr.height()),cl=x.fromRect(pr).expandedBy2(ji/2,$i/2);return[ds.createForRadialRepetition(Zr,cl),Pt]}function pF(M,G,W){let J=X.forRotationAboutPoint(W,G),$=M.add(G),oe=J.transformPoint($),re=new O(oe.x()-G.x(),oe.y()-G.y());return new X(1,0,re.x(),0,1,re.y())}function $T(M,G,W,J,$,oe){let re=M.bounds();if($==="RADIAL"){let ne=re.height(),Te=J==="PIXELS"?G.x()/2:ne/2*G.x(),se=new O(re.centerX(),re.centerY()+Te),Ce=-1/0;for(let Be=0;Be<4;Be++){let Ne=M.get(Be).distanceTo(se);Ce=Math.max(Ce,Ne)}let ye=se,Ie=new O(Ce*2,Ce*2);return Na.fromCenterSize(ye,Ie)}else{let ne=oe==="X"?"x":"y",Te=ne==="x"?re.width():re.height(),se=J==="PIXELS"?G.x()-Te:(G.x()-1)*Te,Ce=(W-1)*se+Te*W,ye=new x(re.x(),re.y(),ne==="x"?Ce:re.width(),ne==="y"?Ce:re.height()),Ie=Math.min(re.x(),ye.x()),Be=Math.min(re.y(),ye.y()),Ne=Math.max(re.right(),ye.right()),Ke=Math.max(re.bottom(),ye.bottom()),Ze=new x(Ie,Be,Ne-Ie,Ke-Be);return new Na(Ze)}}})(Re||(Re={}));var Tt=class Tt extends Em{constructor(e,r,n){super(),this._scene=null,this._id=null,this._scrollingLogic=null,this._handle=0,this._cachedType=null,this._absoluteTransform=yt.FrozenAffineTransform_IDENTITY,this._flags=5,this._cachedChildren=[],this._cachedParent=null,this._isPartOfLoop=!1,this.transitioningFrom=null,this.animatingFrom=null,this.sourceNodeForTransition=null,this._lastParent=null,this._lazyInteractionsMigrationValue=null,this._cachedCanvasSpaceGeometryBounds=Gr.FrozenRect_EMPTY,this._cachedCanvasSpaceRenderedBounds=Gr.FrozenRect_EMPTY,this._cachedCanvasSpaceScrollingBounds=Gr.FrozenRect_EMPTY,this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlursAndGlassEffects=null,this._renderTreeWithoutGlassEffects=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null,this._renderTreeWithoutEffects=null,this._overlayCacheKey=null,this._scene=r,this._id=n,this._scrollingLogic=new Im(this),this._handle=e}handle(){return this._handle}updateAfterPropertyChange(e){e==32?(this.updateDirtyFlagsForPropertyChange(e,this._lastParent),this._lastParent=this.parent()):this.updateDirtyFlagsForPropertyChange(e,null),e==25&&(this._cachedType=null)}linkToParent(e,r){e!=null&&(this._cachedParent=e,this._addFlagsToSelfAndChildren(1),e._cachedChildren.splice(r,0,this),this.updateIsRooted())}unlinkFromParent(){this._cachedParent!=null&&(ie.List_removeOne(this._cachedParent._cachedChildren,this),this._cachedParent=null,this.updateIsRooted())}hasOverflowingContentInScrollDirection(){return this._scrollingLogic.hasOverflowingContentInScrollDirection()}scrollsInPreferredDirection(e){return this._scrollingLogic.scrollsInPreferredDirection(e)}scrollAndClipBoundsBySelfAndAncestors(e,r){return this._scrollingLogic.scrollAndClipBoundsBySelfAndAncestors(e,r)}canvasSpaceScrolledBounds(e){return this._scrollingLogic.canvasSpaceScrolledBounds(e)}canvasSpaceScrolledInteractiveBounds(e){return this._scrollingLogic.canvasSpaceScrolledInteractiveBounds(e)}scrollDirection(){return this._scrollingLogic.scrollDirection()}scrollDirectionWithScrollableContent(){return this._scrollingLogic.scrollDirectionWithScrollableContent()}isFixed(){return this._scrollingLogic.isFixed()}isStandardScrolling(){return this._scrollingLogic.isStandardScrolling()}isStickyScrolling(){return this._scrollingLogic.isStickyScrolling()}defaultScrollOffset(){return this._scrollingLogic.defaultScrollOffset()}canvasSpaceContentBounds(){return this._scrollingLogic.canvasSpaceContentBounds()}nodeSpaceScrollableContentBounds(){return this._scrollingLogic.nodeSpaceScrollableContentBounds()}minScrollOffsetX(){return this._scrollingLogic.minScrollOffsetX()}minScrollOffsetY(){return this._scrollingLogic.minScrollOffsetY()}maxScrollOffsetX(){return this._scrollingLogic.maxScrollOffsetX()}maxScrollOffsetY(){return this._scrollingLogic.maxScrollOffsetY()}hasOverflowingContentInXDirection(){return this._scrollingLogic.hasOverflowingContentInXDirection()}hasOverflowingContentInYDirection(){return this._scrollingLogic.hasOverflowingContentInYDirection()}isSpreadEligibleNode(){return Qt.isFrameLike(this.type())?this.isFrameBackgroundVisible()&&this.clipsToBoundingRectangle():Qt.isRectOrEllipseLike(this.type())}id(){return this._id}isRooted(){return(2&this._flags)!=0}parent(){return K.getFeatureFlags().prototype_animate_parent&&this.sourceNodeForTransition&&this.sourceNodeForTransition.parent()&&!this._cachedParent?this.sourceNodeForTransition.parent():this._cachedParent}scene(){return this._scene}isInvisibleOrTransparent(){return!this.visible()||this.opacity()<=0}containerSupportsFillStrokeAndCorners(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().containerSupportsFillStrokeAndCorners(te.PROTOTYPE_LIB)}fillPaintsToRender(){return this.containerSupportsFillStrokeAndCorners()?this.fillPaints():this.hasNodeProperty(46)&&this.hasNodeProperty(67)?[ee.createSolid(this.computedBackgroundColor(),1)]:Se.EMPTY}computedBackgroundColor(){return this.isBackgroundEnabled()?N.multiplyOpacity(this.backgroundColor(),this.backgroundOpacity()):N.TRANSPARENT}isInsideOutlineMask(){return this.isMask()&&(this.isMaskOutline_DEPRECATED()||this.maskType()=="OUTLINE")||(this.parent()!=null?this.parent().isInsideOutlineMask():!1)}isOrInSymbol(){return this.type()=="SYMBOL"?!0:this.parent()!=null?this.parent().isOrInSymbol():!1}isStack(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getIsStack(te.PROTOTYPE_LIB)}isInstanceSublayer(){return this.stablePath().guids.length>1}isPrimaryInstance(){return this.stablePath().guids.length==1&&this.isInstance()}isState(){return this.type()=="SYMBOL"&&this.parent()!=null&&this.parent().isStateGroup()}isInstance(){return this.type()=="INSTANCE"}isOrInInstance(){return this.isInstanceSublayer()||this.isPrimaryInstance()}isSymbol(){return this.type()=="SYMBOL"}isEmbeddedPrototype(){return this.type()=="INTERACTIVE_SLIDE_ELEMENT"&&this.interactiveSlideElementType()=="EMBED"}isValidTLFType(){return Nr._isValidTLFType(this.type())&&this.type()!="SYMBOL"}findContainingPrimaryInstance(){return this.isOrInInstance()?this.scene().findNode(this.stablePath().guids[0]):null}getBackingSymbolParent(){var e;return this.isInstance()?(e=this.scene().findNode(this.symbolID()))==null?void 0:e.parent():null}findNearestAncestorOrSelf(e){let r=this;for(;r!=null&&r.type()!="CANVAS"&&r.type()!="DOCUMENT";){if(r.type()==e)return r;r=r.parent()}return null}findContainingCanvasOrSelf(){let e=this;for(;e!=null;){if(e.type()=="CANVAS")return e;if(e.parent()==null)break;e=e.parent()}return null}constrainsAnchoredChildren(){return Qt.isFrameLike(this.type())&&!this.isResizeToFit()}size(){return this._scrollingLogic.nodeSize()}minSize(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getMinSize(te.PROTOTYPE_LIB)}maxSize(){return F().prepareCppNodeForAccess(this),F().nodeTsApiGenerated().getMaxSize(te.PROTOTYPE_LIB)}prototypeDevice(){return K.deviceFramesSupported()?this.storedPrototypeDevice():Cn.DEFAULT}findContainingCanvasOrParent(){let e=this.parent();for(;e!=null&&e.type()!="CANVAS"&&e.parent()!=null;)e=e.parent();return e}guidPath(){return F().getOverridePath(this)}stablePath(){return F().getStablePath(this)}removeSelfAndSubtree(){F().prepareCppNodeForAccess(this),F().nodeTsApi().removeSelfAndChildrenWithoutSafetyChecks(te.PROTOTYPE_LIB)}type(){if(this._cachedType==null||this._cachedType=="NONE"){F().prepareCppNodeForAccess(this);let e=F().baseNodeTsApiGenerated().getType(te.PROTOTYPE_LIB);this._cachedType=Ve().NodeType[e]}return this._cachedType}name(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getName(te.PROTOTYPE_LIB)}setName(e){F().prepareCppNodeForAccess(this);let r=F().nodeTsApi().setName(e,te.PROTOTYPE_LIB);r!=""&&we(r)}scrollOffset(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getScrollOffset(te.PROTOTYPE_LIB);return new O(e.x,e.y)}setScrollOffset(e){F().prepareCppNodeForAccess(this);let r=F().nodeTsApi().setScrollOffset({x:e.x(),y:e.y()},te.PROTOTYPE_LIB);r!=""&&we(r)}scrollSpeedMultiplier(){var r;let e=this.behaviors();return((r=e==null?void 0:e.scrollParallax)==null?void 0:r.speed)??1}currentViewportSize(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getCurrentViewportSize(te.PROTOTYPE_LIB);return new O(e.x,e.y)}setCurrentViewportSize(e){F().prepareCppNodeForAccess(this);let r=F().nodeTsApi().setCurrentViewportSize({x:e.x(),y:e.y()},te.PROTOTYPE_LIB);r!=""&&we(r)}fullSize(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getSize(te.PROTOTYPE_LIB);return new O(e.x,e.y)}originalSize(){F().prepareCppNodeForAccess(this);let{x:e,y:r}=F().modules().prototype.getOriginalNodeSize(this.id());return e>0&&r>0?new O(e,r):this.fullSize()}setSize(e){F().prepareCppNodeForAccess(this),this.setSizeVectorF({x:e.x(),y:e.y()})}relativeTransform(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getRelativeTransform(te.PROTOTYPE_LIB);return new X(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}setRelativeTransform(e){F().prepareCppNodeForAccess(this);let r=F().nodeTsApi().setRelativeTransform(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12(),te.PROTOTYPE_LIB);r!=""&&we(r)}overlayTransform(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getOverlayTransform(te.PROTOTYPE_LIB);return new X(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}setOverlayTransform(e){F().prepareCppNodeForAccess(this);let r=F().nodeTsApi().setOverlayTransform(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12(),te.PROTOTYPE_LIB);r!=""&&we(r)}behaviors(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getBehaviors(te.PROTOTYPE_LIB)}setBehavior(e,r){F().prepareCppNodeForAccess(this);let o={...F().nodeTsApi().getBehaviors(te.PROTOTYPE_LIB)??{},[e]:r};F().nodeTsApi().setBehaviors(o,te.PROTOTYPE_LIB)}interactiveSlideConfigData(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getInteractiveSlideConfigData(te.PROTOTYPE_LIB)}setInteractiveSlideConfigData(e,r){return F().prepareCppNodeForAccess(this),F().nodeTsApi().setInteractiveSlideConfigData(e,r,te.PROTOTYPE_LIB)}interactiveSlideParticipantData(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getInteractiveSlideParticipantData(te.PROTOTYPE_LIB)}setInteractiveSlideParticipantData(e,r){return F().prepareCppNodeForAccess(this),F().nodeTsApi().setInteractiveSlideParticipantData(e,r,te.PROTOTYPE_LIB)}slideSpeakerNotes(){return F().prepareCppNodeForAccess(this),F().slideFacetTsApiGenerated().getSlideSpeakerNotes(te.PROTOTYPE_LIB)}slideThumbnailHash(){return F().prepareCppNodeForAccess(this),F().slideFacetTsApiGenerated().getSlideThumbnailHash(te.PROTOTYPE_LIB)}stackMode(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getStackMode(te.PROTOTYPE_LIB);return Ve().StackMode[e]}setStackMode(e){F().prepareCppNodeForAccess(this);let r=Ve().StackMode[e];F().nodeTsApi().setStackMode(r,te.PROTOTYPE_LIB)}backgroundColor(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getBackgroundColor(te.PROTOTYPE_LIB);return N.new3(e.red,e.green,e.blue,e.alpha)}setBackgroundColor(e){F().prepareCppNodeForAccess(this);let r=F().nodeTsApi().setBackgroundColor(N.toColorF(e),te.PROTOTYPE_LIB);r!=""&&we(r)}prototypeBackgroundColor(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getPrototypeBackgroundColor(te.PROTOTYPE_LIB);return N.fromColorF(e)}setPrototypeBackgroundColor(e){F().prepareCppNodeForAccess(this);let r={red:N.redF(e),green:N.greenF(e),blue:N.blueF(e),alpha:N.alphaF(e)},n=F().nodeTsApi().setPrototypeBackgroundColor(r,te.PROTOTYPE_LIB);n!=""&&we(n)}parentIndex(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getParentIndex(te.PROTOTYPE_LIB),r=e.parent;return new un(r,e.position)}setParentIndex(e){F().prepareCppNodeForAccess(this);let r={parent:e.id,position:e.position},n=F().nodeTsApi().setParentIndex(r,te.PROTOTYPE_LIB);n!=""&&we(n)}fillPaints(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getSkewFillPaints(te.PROTOTYPE_LIB)}textDecorationFillPaints(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getSkewTextDecorationFillPaints(te.PROTOTYPE_LIB)}getBoundVariables(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getBoundVariables(te.PROTOTYPE_LIB)}getResolvedVariableModes(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getResolvedVariableModes(te.PROTOTYPE_LIB)}getResolvedVariableModesForPrototype(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getResolvedVariableModesForPrototype(te.PROTOTYPE_LIB)}getResolvedVariableModesWithSetKeys(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getResolvedVariableModesWithSetKeys(te.PROTOTYPE_LIB)}getExplicitVariableModes(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getExplicitVariableModes(te.PROTOTYPE_LIB)}getExplicitVariableModesWithSetKeys(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getExplicitVariableModesWithSetKeys(te.PROTOTYPE_LIB)}setExplicitVariableModeForCollection(e,r){return F().prepareCppNodeForAccess(this),F().nodeTsApi().setExplicitVariableModeForCollection(e,r,te.PROTOTYPE_LIB)}setExplicitVariableModeForCollectionWithSetKey(e,r,n){return F().prepareCppNodeForAccess(this),F().nodeTsApi().setExplicitVariableModeForCollectionWithSetKey(e,r,n,te.PROTOTYPE_LIB)}clearExplicitVariableConsumerModeForCollection(e){return F().prepareCppNodeForAccess(this),F().nodeTsApi().clearExplicitVariableConsumerModeForCollection(e,te.PROTOTYPE_LIB)}clearExplicitVariableConsumerModeForCollectionWithSetKey(e){return F().prepareCppNodeForAccess(this),F().nodeTsApi().clearExplicitVariableConsumerModeForCollectionWithSetKey(e,te.PROTOTYPE_LIB)}setTestOnlyFillPaints(e){qo("Paint serialization only partially implemented in TS Viewer"),Ki(F(),this,61,e)}strokePaints(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getSkewStrokePaints(te.PROTOTYPE_LIB)}codeSnapshot(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getViewerCodeSnapshot(te.PROTOTYPE_LIB)}setTestOnlyStrokePaints(e){qo("Paint serialization only partially implemented in TS Viewer"),Ki(F(),this,62,e)}effects(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getSkewEffects(te.PROTOTYPE_LIB)}setTestOnlyEffects(e){qo("Effect serialization only partially implemented in TS Viewer"),Ki(F(),this,64,e)}transformModifiers(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getSkewTransformModifiers(te.PROTOTYPE_LIB)}setTestOnlyTransformModifiers(e){qo("TransformModifier serialization only partially implemented in TS Viewer"),Ki(F(),this,113,e)}symbolID(){return this.isInstance()?(F().prepareCppNodeForAccess(this),F().nodeTsApi().getSymbolId(te.PROTOTYPE_LIB)):Q.invalid()}setTestOnlySymbolData(e){qo("SymbolData serialization only partially implemented in TS Viewer"),Ki(F(),this,78,e)}fillGeometry(){var r;if(!1)return zi(this.canvasSpaceBoundingBox());F().prepareCppNodeForAccess(this);let e=(r=F().nodeTsApi())==null?void 0:r.getFillGeometryRegions(te.PROTOTYPE_LIB);return F().idlRegionsToGeometry(e??null,null)}setTestOnlyFillGeometry(e){qo("Geometry serialization only partially implemented in TS Viewer"),Ki(F(),this,76,e)}strokeGeometry(){var r;F().prepareCppNodeForAccess(this);let e=(r=F().nodeTsApi())==null?void 0:r.getStrokeGeometryRegions(te.PROTOTYPE_LIB);return F().idlRegionsToGeometry(e??null,null)}setTestOnlyStrokeGeometry(e){qo("Geometry serialization only partially implemented in TS Viewer"),Ki(F(),this,77,e)}strokeBrush(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getStrokeBrushGuid(te.PROTOTYPE_LIB);return e.length===0?null:this.scene().findNode(e)}hasStrokeBrush(){return this.strokeBrush()!==null}getBrushType(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getBrushType(te.PROTOTYPE_LIB)}isBrushInstanceType(e){var r;return F().prepareCppNodeForAccess(this),((r=F().nodeTsApi())==null?void 0:r.isBrushInstanceType(e,te.PROTOTYPE_LIB))??!1}getScatterBrushInstanceTransforms(){var n;F().prepareCppNodeForAccess(this);let e=((n=F().nodeTsApi())==null?void 0:n.getScatterBrushInstanceTransforms(te.PROTOTYPE_LIB))??[],r=[];for(let o of e)r.push(new X(o.m00,o.m01,o.m02,o.m10,o.m11,o.m12));return r}hasScatterBrushInstanceTransforms(){var e;return F().prepareCppNodeForAccess(this),((e=F().nodeTsApi())==null?void 0:e.hasScatterBrushInstanceTransforms(te.PROTOTYPE_LIB))??!1}textGeometry(){var o;let e=this.textData();if(e==null)return null;F().prepareCppNodeForAccess(this);let r=(o=F().nodeTsApi())==null?void 0:o.getTextGeometryRegions(te.PROTOTYPE_LIB),n=new Yo(e.styleOverrideTable());return F().idlRegionsToTextGeometry(r??null,n)}prototypeInteractions(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getPrototypeInteractions(te.PROTOTYPE_LIB);return ls.WeakHandle_isValid(e)?F().modules().prototypeInteractions_Internal.getOrCreateSkewCopy(e):[]}setTestOnlyPrototypeInteractions(e){qo("PrototypeInteraction[] serialization only partially implemented in TS Viewer"),Ki(F(),this,90,e)}objectAnimations(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getObjectAnimationsSkew(te.PROTOTYPE_LIB)}setTestOnlyObjectAnimations(e){qo("PrototypeInteraction[] serialization only partially implemented in TS Viewer"),Ki(F(),this,91,e)}getObjectAnimationInteractionIndex(e){return this.objectAnimations().findIndex(n=>n.id()===e.interactionId)}getObjectAnimationInteraction(e){return this.objectAnimations().find(n=>n.id()===e.interactionId)??null}getObjectAnimationAction(e){let r=this.getObjectAnimationInteraction(e);if(r==null)return null;let n=r.getAllActions();return 0<=e.actionIndex&&e.actionIndex<n.length?n[e.actionIndex]:null}prototypeStartingPoint(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getPrototypeStartingPoint(te.PROTOTYPE_LIB);if(e==null)return null;let r=e;return new sa(r.name,r.description,gr.fromString(r.position))}setPrototypeStartingPoint(e){F().prepareCppNodeForAccess(this);let r={name:e.name,description:e.description,position:gr.toString(e.position)},n=F().nodeTsApi().setPrototypeStartingPoint(r,te.PROTOTYPE_LIB);n!=""&&we(n)}storedPrototypeDevice(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApiGenerated().getPrototypeDevice(te.PROTOTYPE_LIB);if(e==null)return null;let r=e;return new Cn(Ve().PrototypeDeviceType[r.type],new O(r.size.x,r.size.y),r.presetIdentifier,Ve().DeviceRotation[r.rotation])}setPrototypeDevice(e){F().prepareCppNodeForAccess(this);let r={type:Ve().PrototypeDeviceType[e.type],size:{x:e.nonRotatedSize.x(),y:e.nonRotatedSize.y()},presetIdentifier:e.presetIdentifier,rotation:Ve().DeviceRotation[e.rotation]};F().updatePrototypeDevice(r)}overlayBackgroundAppearance(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getOverlayBackgroundAppearance(te.PROTOTYPE_LIB);if(e==null)return null;let r=e;return new la(Ve().OverlayBackgroundType[r.backgroundType],N.fromColorF(r.backgroundColor))}setOverlayBackgroundAppearance(e){F().prepareCppNodeForAccess(this);let r={backgroundType:Ve().OverlayBackgroundType[e.backgroundType],backgroundColor:N.toColorF(e.backgroundColor)},n=F().nodeTsApi().setOverlayBackgroundAppearance(r,te.PROTOTYPE_LIB);n!=""&&we(n)}textData(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getTextData(te.PROTOTYPE_LIB);return ls.WeakHandle_isValid(e)?F().modules().textData_Internal.getOrCreateSkewCopy(e):null}setTestOnlyTextData(e){qo("TextData serialization only partially implemented in TS Viewer"),Ki(F(),this,4,e)}derivedTextData(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getDerivedTextData(te.PROTOTYPE_LIB);return ls.WeakHandle_isValid(e)?F().modules().derivedTextData_Internal.getOrCreateSkewCopy(e):null}setTestOnlyDerivedTextData(e){qo("DerivedTextData serialization only partially implemented in TS Viewer"),Ki(F(),this,5,e)}vectorData(){F().prepareCppNodeForAccess(this);let e=F().nodeTsApi().getVectorData(te.PROTOTYPE_LIB);return ls.WeakHandle_isValid(e)?F().modules().compiledVectorData_Internal.getOrCreateSkewCopy(e):null}hasDefaultStrokeParameters(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getHasDefaultStrokeParameters(te.PROTOTYPE_LIB)}strokeJoin(){switch(F().prepareCppNodeForAccess(this),F().nodeTsApi().getStrokeJoin(te.PROTOTYPE_LIB)){default:case 0:return"MITER";case 1:return"BEVEL";case 2:return"ROUND"}}setStrokeJoin(e){F().prepareCppNodeForAccess(this);let r=0;switch(e){case"MITER":r=0;break;case"BEVEL":r=1;break;case"ROUND":r=2;break}F().nodeTsApi().setStrokeJoin(r,te.PROTOTYPE_LIB)}setStrokeMiterLimit(e){F().prepareCppNodeForAccess(this),F().nodeTsApi().setStrokeMiterLimit(e,te.PROTOTYPE_LIB)}strokeMiterLimit(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getStrokeMiterLimit(te.PROTOTYPE_LIB)}videoPlayback(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getVideoPlayback(te.PROTOTYPE_LIB)}setVideoPlayback(e){F().prepareCppNodeForAccess(this),F().nodeTsApi().setVideoPlayback(e,te.PROTOTYPE_LIB)}accessibleLabel(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getAccessibleLabel(te.PROTOTYPE_LIB)}hasNodeProperty(e){return F().hasNodeProperty(this,e)}get(e,r=null){let n=gm(F(),this,e);return n??r}getSerializedPropertyForTests(e){let r;switch(e){case"effects":{r=64;break}case"fillPaints":{r=61;break}case"strokePaints":{r=62;break}case"prototypeInteractions":case"objectAnimations":{r=90;break}default:throw"unknown property name in getSerializedPropertyForTests"+e}return ut.serializeValueToKiwiForTests1(r,this.get(r)).a[e]}each(e){F().forEachField(this,r=>{e(r,this.get(r))})}isVisibleInCanvas(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().isVisibleInCanvas(te.PROTOTYPE_LIB)}supportsBackgroundPaints(){return Qt.isFrameLike(this.type())&&!this.containerSupportsFillStrokeAndCorners()}supportsGeometry(){return Qt.isGeometryLeaf(this.type())||Qt.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners()}findPrototypeInteraction(e){if(e==null)return null;let r=this.prototypeInteractions().filter(n=>Q.equals(n.id(),e));return r.length==0?null:(r.length>1&&we("Found multiple prototype interactions with the same GUID"),r[0])}updateDirtyFlagsForPropertyChange(e,r){this._handlePropertyChangeForTransform(e),this._handlePropertyChangeForBounds(e,r),this._handlePropertyChangeForRenderTree(e,r),this._handlePropertyChangeForInteractions(e)}_handlePropertyChangeForTransform(e){if((e==99||e==30||e==69||e==42||e==100)&&this._addFlagsToSelfAndChildren(1),e==26||e==27){let r=this;for(;r!=null&&!(r.isFixed()||r.hasOwnConstraintValues());)r=r.parent();r!=null&&r.isFixed()&&r.dirtyTransform()}}_handlePropertyChangeForInteractions(e){mo.isInteractionProperty(e)&&(this._lazyInteractionsMigrationValue=null)}map(e){return this._cachedChildren.map(e)}forEachChild(e,r=!1){for(let n=0;n<this._cachedChildren.length;n++)e(this.childAt2(n,r))}forEachDescendantPreorder(e){this._cachedChildren.forEach(r=>{e(r),r.forEachDescendantPreorder(e)})}children(){return this._cachedChildren}childCount(){return this._cachedChildren.length}childAt1(e){return this.childAt2(e,!1)}childAt2(e,r){return r&&this.stackReverseZIndex()&&this.isStack()?this._cachedChildren[this.childCount()-e-1]:this._cachedChildren[e]}indexInParent(){if(this._cachedParent==null)return-1;let e=this._cachedParent._cachedChildren.indexOf(this);return this._cachedParent.stackReverseZIndex()&&this._cachedParent.isStack()&&(e=this._cachedParent.childCount()-e-1),e}updateIsRooted(){let e=this._cachedParent!=null?this._cachedParent.isRooted():this==this._scene.root();if(e!=this.isRooted()){this._flags=e?this._flags|2:this._flags&-3,e&&this._addFlagsToSelfAndChildren(1);for(let r of this._cachedChildren)r.updateIsRooted()}}appendChild(e){let r=this._cachedChildren.length==0?gr.FIRST_POSITION:gr.after(ie.List_last(this._cachedChildren).parentIndex().position);e.setParentIndex(new un(this.id(),r))}collectUniqueUsedImages(){let e=new Map;return this.forEachSinglePaint(r=>{if((r.type()=="IMAGE"||r.type()=="EMOJI"||r.type()=="VIDEO")&&(r.image()!=null&&e.set(r.image().objectHash(),r.image()),r.imageThumbnail()!=null&&e.set(r.imageThumbnail().objectHash(),r.imageThumbnail())),r.type()=="PATTERN"){let n=r.patternSource();n&&n.collectUniqueUsedImages().forEach((i,a)=>{e.set(a,i)})}}),this.forEachEmojiInTextData(r=>{e.set(r.objectHash(),r)}),e}forEachSinglePaint(e){var n,o;let r=i=>{let a=i.asVolatilePaint();a!=null&&(e(a.from()),e(a.to()));let s=i.asSinglePaint();s!=null&&e(s)};this.fillPaints().forEach(r),this.strokePaints().forEach(r),Qt.supportsCodeSnapshot(this.type())&&this.codeSnapshot()&&this.codeSnapshot().paints&&this.codeSnapshot().paints.forEach(r),(o=(n=this.textData())==null?void 0:n.styleOverrideTable())==null||o.forEachFillPaint(this.scene(),i=>{i.forEach(r)}),this.hasPerRegionFillPaints()&&this.forEachRegionWithFillPaintBatch((i,a)=>{a.forEach(r)})}forEachEmojiInTextData(e){var r,n;this._cachedType!="TEXT"&&this._cachedType!="TEXT_PATH"||(n=(r=this.derivedTextData())==null?void 0:r.usedEmojiImages())==null||n.forEach(o=>{e(o)})}textHyperlinkBoxes(){var e;return this._cachedType!="TEXT"&&this._cachedType!="TEXT_PATH"?[]:((e=this.derivedTextData())==null?void 0:e.hyperlinkBoxes())??[]}textHasMixedFontSizes(){return this._cachedType!="TEXT"&&this._cachedType!="TEXT_PATH"||this.textData()==null||this.textData().fontSizes()===null?!1:this.textData().fontSizes()==="mixed"?!0:(F().prepareCppNodeForAccess(this),this.textData().fontSizes()!=F().textFacetTsApiGenerated().getFontSize(te.PROTOTYPE_LIB))}restartGifs(){this.forEachSinglePaint(e=>{let r=e.image();if(r==null||!r.isGIF())return;let n=r.gif();n!=null&&n.restart()})}clipsToBoundingRectangle(){return Qt.isFrameLike(this.type())&&!this.isFrameMaskDisabled()&&!this.isResizeToFit()}isAxisAligned(){let r=this.absoluteTransform();return Math.abs(r.m00())<1e-4&&Math.abs(r.m11())<1e-4||Math.abs(r.m01())<1e-4&&Math.abs(r.m10())<1e-4}isAxisAlignedRectFill(){var e;return this.fillGeometry()!=null&&this.fillPaints().length!=0&&this.strokePaints().length==0&&!!((e=this.fillGeometry())!=null&&e.isRect())&&this.isAxisAligned()}isInSymbol(){let e=!1;for(let r=this;r!=null;r=r.parent())if(r.type()=="SYMBOL"){e=!0;break}return e}_addScrollableChildFramesToListRecursive(e){for(let r of this._cachedChildren)r.scrollDirection()!="NONE"&&e.push(r),r._addScrollableChildFramesToListRecursive(e)}scrollableFrameDescendants(){let e=[];return this._addScrollableChildFramesToListRecursive(e),e}isGroup(){return Qt.isFrameLike(this.type())&&this.isResizeToFit()}hasOwnConstraintValues(){return this.type()!="BOOLEAN_OPERATION"&&this.type()!="CANVAS"&&this.type()!="DOCUMENT"&&!this.isGroup()}_collectConstraintValuesInSubtree(e){let r=null;return kn(this,n=>{if(!n.hasOwnConstraintValues())return 0;let o=e(n);if(r==null)r=new pe(o);else if(r.value!=o)return r=null,1;return 2}),r}horizontalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(e=>e.horizontalConstraint())}verticalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(e=>e.verticalConstraint())}_withOverriddenFrameRole(e,r){this._scrollingLogic.overrideRole(e),this._addFlagsToSelfAndChildren(1),this._invalidateRenderTreeForSelf();for(let n=0,o=this.childCount();n<o;n=n+1){let i=this.childAt1(n);i.isFixed()&&kn(i,a=>{a._invalidateRenderTreeForSelf()})}r(),this._scrollingLogic.clearRoleOverride()}actingAsOverlayOrSublayerForRendertreeGeneration(e){this._withOverriddenFrameRole(1,e)}actingAsBaseScreenForRendertreeGeneration(e){this._withOverriddenFrameRole(0,e)}_translateFixedElementIfNecessary(e){if(!this.isFixed()||this.parent()==null||this.parent().scrollDirection()=="NONE")return;let r=this.parent();if(bn.scrollsHorizontally(r.scrollDirection())){let n=this.horizontalConstraintOfSubtree();n!=null&&(n.value=="MAX"?e.translate2(r.size().x()-r.fullSize().x(),0):n.value=="CENTER"&&e.translate2((r.size().x()-r.fullSize().x())/2,0))}if(bn.scrollsVertically(r.scrollDirection())){let n=this.verticalConstraintOfSubtree();n!=null&&(n.value=="MAX"?e.translate2(0,r.size().y()-r.fullSize().y()):n.value=="CENTER"&&e.translate2(0,(r.size().y()-r.fullSize().y())/2))}}hasPerRegionFillPaints(){var r;if(this.type()!="VECTOR"||this.fillGeometry()==null)return!1;let e=(r=this.fillGeometry())==null?void 0:r.styleIDs;return e==null?!1:e.some(n=>n!=0)}forEachRegionWithFillPaintBatch(e){var i,a;let r=this.fillGeometry(),n=(i=this.vectorData())==null?void 0:i.paintOverrides,o=this.fillPaints();if(!(n==null||r==null))for(let s=0;s<r.regions.length;s=s+1){let l=o;if(s<(((a=r.styleIDs)==null?void 0:a.length)??0)){let d=r.styleIDs[s],u=n.get(d,this.scene());u!=null&&(l=u)}let c=r.regions[s];e(c,l)}}relativeTransformAccountingForFixedOffset(){let e=this.relativeTransform().clone();return this._translateFixedElementIfNecessary(e),e}absoluteTransform(){if(this.isRooted()&&1&this._flags){let e=this.relativeTransformAccountingForFixedOffset();if(this._cachedParent!=null){let r=this._cachedParent.absoluteTransform().clone();r.multiply(e),e=r}this._absoluteTransform=e,this._flags&=-2}return this._absoluteTransform}dirtyTransform(){this._addFlagsToSelfAndChildren(1),this._addFlagsToSelfAndChildren(4)}copyNodeCachedTransformAndBounds(e){this._absoluteTransform=e._absoluteTransform,this._cachedCanvasSpaceGeometryBounds=e._cachedCanvasSpaceGeometryBounds,this._cachedCanvasSpaceRenderedBounds=e._cachedCanvasSpaceRenderedBounds,this._cachedCanvasSpaceScrollingBounds=e._cachedCanvasSpaceScrollingBounds,K.getFeatureFlags().prototype_animate_parent&&(this.sourceNodeForTransition=e)}_addFlagsToParents(e){this.parent()!=null&&this.parent()._addFlagsToSelfAndParents(e)}_addFlagsToSelfAndParents(e){for(let r=this;r!=null;r=r.parent())r._flags|=e}_addFlagsToSelfAndChildren(e){this._flags|=e;for(let r of this._cachedChildren)r._addFlagsToSelfAndChildren(e)}isFrameBackgroundVisible(){if(!Qt.isFrameLike(this.type()))return!1;let e=this.containerSupportsFillStrokeAndCorners()?this.fillPaints():null;if(e==null)return N.alpha(this.computedBackgroundColor())>0;for(let r=0,n=e.length;r<n;r=r+1)if(e[r].isEnabledAndVisible())return!0;return!1}dependsOnBackgroundContent(){if(this.effects().filter(r=>r.isVisibleForRendering()&&r.dependsOnBackgroundContent()).length>0)return!0;let e=!1;return this.forEachChild(r=>{r.dependsOnBackgroundContent()&&(e=!0)}),e}hasNonZeroStrokeWeight(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getHasNonZeroStrokeWeight(te.PROTOTYPE_LIB)}styleId(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().styleId(te.PROTOTYPE_LIB)}inheritedStyleId(e){return F().prepareCppNodeForAccess(this),F().nodeTsApi().inheritedStyleId(e,te.PROTOTYPE_LIB)}setInheritStyleId(e,r){return F().prepareCppNodeForAccess(this),F().nodeTsApi().setInheritStyleId(e,r,te.PROTOTYPE_LIB)}setStyleSortPosition(e){return F().prepareCppNodeForAccess(this),F().nodeTsApi().setStyleSortPosition(e,te.PROTOTYPE_LIB)}tableCellRowId(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().tableCellColumnId(te.PROTOTYPE_LIB)}tableCellColumnId(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().tableCellColumnId(te.PROTOTYPE_LIB)}getTableCellAt(e,r){F().prepareCppNodeForAccess(this);let n=F().nodeTsApi().getTableCellGuid(te.PROTOTYPE_LIB,e,r);return this._scene.findNode(n)}canvasSpaceGeometryBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceGeometryBounds}canvasSpaceRenderedBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceRenderedBounds}canvasSpaceScrollingBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceScrollingBounds}canvasSpaceInteractiveBounds(){let e=this.fillOrTextGeometry(),r=this.strokeGeometry(),n=x.new2(),o=this.size();n.setTo1(0,0,o.x(),o.y());let i=new Et;i.include3(n),e!=null&&i.include3(e.bounds),r!=null&&this.strokeAlign()!="INSIDE"&&i.include3(r.bounds);let a=i.build();return a.transformInto1(a,this.absoluteTransform()),a}canvasSpacePreviewBounds(){let e=this.strokeGeometry(),r=this.fullSize();K.getFeatureFlags().viewer_ensure_nonzero_preview_bounds&&(r=r.max(new O(Number.EPSILON,Number.EPSILON)));let n=new Et;n.include3(new x(0,0,r.x(),r.y())),e!=null&&this.strokeAlign()!="INSIDE"&&n.include3(e.bounds);let o=n.build();if(o.transformInto1(o,this.absoluteTransform()),this._scrollingLogic.shouldResizeToFitViewport()){let i=this.parent().prototypeDevice(),a=i.type=="NONE"||i.type=="PRESENTATION"?this.parent().currentViewportSize():i.size(),s=this.findContainingCanvasOrParent();if(i=s.prototypeDevice(),a=i.type=="NONE"||i.type=="PRESENTATION"?s.currentViewportSize():i.size(),!o.size().min(a).equals(o.size())){let l=x.new4(this.canvasSpaceBoundingBox().topLeft(),a);o.intersectWith(l)}}return o}canvasSpaceBoundingBox(){let e=x.new2(),r=this.size();return e.setTo1(0,0,r.x(),r.y()),e.transformInto1(e,this.absoluteTransform()),e}fullSizeCanvasSpaceBoundingBox(){let e=x.new2(),r=this.originalSize();return e.setTo1(0,0,r.x(),r.y()),e.transformInto1(e,this.absoluteTransform()),e}_updateBoundsIfNeeded(){if(!this.isRooted()||!(4&this._flags))return;for(let n of this._cachedChildren)n._updateBoundsIfNeeded();Tt._geometryBuilder.reset(),Tt._renderedBuilder.reset(),Tt._scrollingBuilder.reset(),Tt._effectBuilder.reset();let e=0,r=this.effects();for(let n=0,o=r.length;n<o;n=n+1){let i=r[n];i.isEnabledAndVisible()&&i.type()=="FOREGROUND_BLUR"&&(e+=i.blurRadius())}e>0&&(Tt._effectBuilder.include1(-e,-e),Tt._effectBuilder.include1(e,e));for(let n=0,o=r.length;n<o;n=n+1){let i=r[n];if(i.isEnabledAndVisible()&&i.type()=="DROP_SHADOW"){let a=e+i.blurRadius()+i.spread();Tt._effectBuilder.include1(i.blurOffset().x()-a,i.blurOffset().y()-a),Tt._effectBuilder.include1(i.blurOffset().x()+a,i.blurOffset().y()+a)}}if(Qt.isGeometryLeaf(this.type())){let n=this.fillOrTextGeometry(),o=this.strokeGeometry(),i=this.absoluteTransform();n!=null&&Tt._geometryBuilder.include4(n.bounds,i),o!=null&&(this.strokeAlign()!="INSIDE"||n==null||n.regions.length==0||n.bounds.isInvalid())&&Tt._geometryBuilder.include4(o.bounds,i)}else for(let n of this._cachedChildren)n.isInvisibleOrTransparent()||(Tt._geometryBuilder.include3(n._cachedCanvasSpaceGeometryBounds),Tt._renderedBuilder.include3(n._cachedCanvasSpaceRenderedBounds)),n.visible()&&Tt._scrollingBuilder.include3(n._cachedCanvasSpaceScrollingBounds);if(Qt.isFrameLike(this.type())){let n=this.canvasSpaceBoundingBox();if(this.clipsToBoundingRectangle()){let o=Tt._geometryBuilder.build(),i=Tt._renderedBuilder.build(),a=Tt._scrollingBuilder.build();o.intersectWith(n),i.intersectWith(n),a.intersectWith(n),Tt._geometryBuilder.reset(),Tt._renderedBuilder.reset(),Tt._scrollingBuilder.reset(),Tt._geometryBuilder.include3(o),Tt._renderedBuilder.include3(i),Tt._scrollingBuilder.include3(a)}if(this.containerSupportsFillStrokeAndCorners()){let o=this.fillOrTextGeometry(),i=this.strokeGeometry(),a=this.absoluteTransform();o!=null&&Tt._geometryBuilder.include4(o.bounds,a),i!=null&&(this.strokeAlign()!="INSIDE"||o==null||o.regions.length==0||o.bounds.isInvalid())&&Tt._geometryBuilder.include4(i.bounds,a)}(this.isFrameBackgroundVisible()||this.parent()!=null&&this.parent().type()=="CANVAS"&&this.clipsToBoundingRectangle())&&(Tt._geometryBuilder.include3(n),Tt._renderedBuilder.include3(n)),Tt._scrollingBuilder.include3(n)}this._cachedCanvasSpaceGeometryBounds=Tt._geometryBuilder.build(),Tt._renderedBuilder.include3(this._cachedCanvasSpaceGeometryBounds),Tt._scrollingBuilder.include3(this._cachedCanvasSpaceGeometryBounds),Tt._effectBuilder.isValidOrZeroArea()&&(Tt._effectBuilder.buildTo(Tt._effectBounds),Tt._renderedBuilder.include3(Tt._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,Tt._effectBounds)),Tt._scrollingBuilder.include3(Tt._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,Tt._effectBounds))),this._cachedCanvasSpaceRenderedBounds=Tt._renderedBuilder.build(),this._cachedCanvasSpaceScrollingBounds=Tt._scrollingBuilder.build(),this._flags&=-5}_handlePropertyChangeForBounds(e,r){switch(e){case 28:case 26:case 27:case 12:case 59:case 78:case 65:case 33:case 73:case 35:case 56:case 17:case 36:case 68:case 69:case 72:case 54:case 74:case 18:case 55:case 34:case 37:case 98:break;case 67:case 8:{this._addFlagsToParents(4);break}default:{this._addFlagsToParents(4),this._addFlagsToSelfAndChildren(4),e==32&&r!=null&&r._addFlagsToSelfAndParents(4);break}}}developerFriendlyId(){if(this.type()=="TABLE_CELL"){let n=this.parent();return n==null?(console.error("Orphaned table cell"),null):"T"+[n.id(),this.tableCellRowId(),this.tableCellColumnId()].map(i=>i).join(";")}if(!this.isInstanceSublayer())return this.id();let e=this;for(;e!=null&&!e.isPrimaryInstance();)e=e.parent();return e==null?(console.error("Unable to find primary instance backing node"),null):"I"+this.stablePath().guids.map(n=>n).join(";")}fillOrTextGeometry(){return this.type()=="TEXT"?this.textGeometry():this.fillGeometry()}fillRegionPaints(){return Tt._computeRegionPaintsFromStyles(this.fillOrTextGeometry(),this.fillPaints(),this.scene())}strokeRegionPaints(){return Tt._computeRegionPaintsFromStyles(this.strokeGeometry(),this.strokePaints(),this.scene())}hasMoreThanOneCornerRadius(){let e=this.rectangleTopLeftCornerRadius();return this.rectangleTopRightCornerRadius()!=e||this.rectangleBottomLeftCornerRadius()!=e||this.rectangleBottomRightCornerRadius()!=e}isRoundedRect(){return this.type()=="RECTANGLE"||this.type()=="ROUNDED_RECTANGLE"||this.type()=="STAMP"||Qt.isFrameLike(this.type())}roundedRectInfo(){return this._instantiateRoundedRect()}_instantiateRoundedRect(){if(this.rectangleCornerRadiiIndependent()){let e=[this.rectangleTopLeftCornerRadius(),this.rectangleTopRightCornerRadius(),this.rectangleBottomRightCornerRadius(),this.rectangleBottomLeftCornerRadius()];return new na(1,ge.FrozenVector_ZERO,this.size(),e,this.cornerSmoothing())}else return new na(0,ge.FrozenVector_ZERO,this.size(),this.cornerRadius(),this.cornerSmoothing())}fillGeometryForSpread(e,r,n){let o;if(this.type()=="ELLIPSE"){let i={m00:e.m00(),m01:e.m01(),m02:e.m02(),m10:e.m10(),m11:e.m11(),m12:e.m12()},a=F().getFillGeometryForSpread(i,r,this);o=new Fo(a)}else{let i=this._instantiateRoundedRect();i.transform(e),i.adjustCornerRadiiForSpread(r),o=vt.fromRoundedRect(i)}return new Gt(new Nt(o,"NONZERO"),n)}strokeGeometryForSpread(e,r,n,o){let i,a=this.strokeAlign()=="INSIDE"?2:this.strokeAlign()=="CENTER"?1:0,s=!n.subtractScalar(2*r+a*this.strokeWeight()).isPositive(),l=2-a;if(Se.containsAtLeastOneVisiblePaint(this.fillPaints())||s){let c=X.new2(),u=n.addScalar(this.strokeWeight()*l).addScalar(2*r).divide(n),p=-r-this.strokeWeight()*l/2;if(c.translate2(p,p),c.scale3(u),this.type()=="ELLIPSE"){let _=new x(0,0,this.size().x(),this.size().y());c.transformRect(_),i=Bt.forEllipse(_)}else{let _=this._instantiateRoundedRect();_.transform(c),i=Bt.fromRoundedRectWithSpread(_,r+l*this.strokeWeight()/2)}}else{if(this.strokeWeight()+2*r<=0)return null;if(this.type()=="ELLIPSE"){let c=x.new4(ge.FrozenVector_ZERO,this.size());e.transformRect(c),c.expand1(l*this.strokeWeight()/2),i=Bt.forEllipse(c),c.contract(2*r+this.strokeWeight()),i.append(Bt.forEllipse(c))}else{let c=this._instantiateRoundedRect();c.transform(e),c.expand(l*this.strokeWeight()/2),i=Bt.fromRoundedRectWithSpread(c,r+l*this.strokeWeight()/2),c.contract(2*r+this.strokeWeight()),i.append(Bt.fromRoundedRectWithSpread(c,-(2*r+this.strokeWeight())))}}return new Gt(new Nt(i,"ODD"),o)}isTopLevel(){return this.parent()!=null&&this.parent().isTopLevelParent()}isTopLevelParent(){return Tt.isTopLevelParentNodeType(this.type())}static isTopLevelParentNodeType(e){return e=="CANVAS"||e=="SECTION"||e=="SLIDE_ROW"||e=="SLIDE_GRID"||e=="MODULE"}topLevelAncestor(){let e=this;for(;e!=null;){if(e.isTopLevel())return e;e=e.parent()}return null}isSlideModule(){return this.type()=="MODULE"&&this.childCount()==1&&this.childAt1(0).type()=="SLIDE"}canvas(){if(this.type()=="CANVAS")return this;let e=this.findContainingCanvasOrParent();return(e==null?void 0:e.type())=="CANVAS"?e:null}isAncestorOf(e){for(let r=e;r!=null;r=r.parent())if(r==this)return!0;return!1}forSelfAndAncestors(e){for(let r=this;r!=null;r=r.parent())e(r)}findContainingStateGroupOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.isStateGroup())return e;return null}findContainingScrollingFrameOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.scrollDirection()!="NONE"&&!e.isTooRotatedToScroll())return e;return null}findContainingInstanceOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.type()=="INSTANCE")return e;return null}findAllSectionsInNode(){let e=this,r=[];r.push(e);let n=[];for(;r.length>0;){let o=r.shift();for(let i=0,a=o.childCount();i<a;i=i+1){let s=o.childAt1(i);s!=null&&s.type()=="SECTION"&&(r.push(s),n.push(s))}}return n}findAllTopLevelNodesInNode(e){let r=[];if(e.type()!="CANVAS"&&e.type()!="SECTION")return r;let n=[];for(n.push(e);n.length>0;){let o=n.shift();for(let i=0,a=o.childCount();i<a;i=i+1){let s=o.childAt1(i);s.type()=="SECTION"&&n.push(s),r.push(s)}}return r}buildAncestors(){let e=[];return this.forSelfAndAncestors(r=>{e.push(r)}),e.reverse(),e}isAboveInLayerOrder(e){let r=this.buildAncestors(),n=e.buildAncestors();for(let o=0,i=Math.min(r.length,n.length);o<i;o=o+1)if(r[o]!=n[o]){let a=r[o],s=n[o];return a.indexInParent()>s.indexInParent()}return r.length==n.length?!1:r.length>n.length}isTooRotatedToScroll(){return Math.abs(this.absoluteTransform().toAngle())>=Math.PI/180}debugString(){let e="";if(e+=this.hierarchyString()+`

`,this.type()=="INSTANCE"){let r=`stablePath: ${this.stablePath()}`;e+=r+`

`}return e+=`{
`,this.each((r,n)=>{e+=`  ${Lt[r]}: ${ot.toString(n)}
`}),e+="}",e+=`

`,e}paintsDebugString(){let e=this.strokePaints().some(r=>r.isEnabledAndVisible())?` strokeAlign=${this.strokeAlign()} weight=${this.strokeWeight()}`:"";return`Node type=${this.type()} size=${this.size()}
 -- fills=[${this.fillPaints().map(r=>r.debugString()).join(", ")}]
 -- strokes=[${this.strokePaints().map(r=>r.debugString()).join(", ")}]`+e}_makeIndent(e,r){let o="";if(r){for(let i=0,a=2*(e-1);i<a;i=i+1)o+="-";return o+="> ",o}else{for(let i=0,a=2*e;i<a;i=i+1)o+=" ";return o}}hierarchyString(){let e=[],r=this._hierarchyStringForAncestors(e);return r==0&&(e.push("(null parent)"),r=r+1),this._hierarchyStringWithChildren(r,!0,e),e.join(`
`)}_hierarchyStringLocal(e,r){let n=this._makeIndent(e,r);return n+=`${this.type()}: '${this.name()??"null"}' (${this.id()})`,(this.isInstanceSublayer()||this.isPrimaryInstance())&&(n+=` stablePath: ${this.stablePath()}`),this.isInSymbol()&&(n+=` (overrideKey: ${this.overrideKey()})`),this.type()=="INSTANCE"&&(n+=` (symbol: ${this.symbolID()??"null"})`),n+=` hasBeenLoaded: ${this.hasBeenLoaded()?"\u2714":"\u25FB\uFE0F"}`,n}_hierarchyStringForAncestors(e){let r=0,n=[];for(this.forSelfAndAncestors(o=>{o!=this&&n.push(o)});n.length>0;)e.push(n.pop()._hierarchyStringLocal(r,!1)),r=r+1;return r}_hierarchyStringWithChildren(e,r,n){n.push(this._hierarchyStringLocal(e,r));for(let o=0,i=this.childCount();o<i;o=o+1)this.childAt1(o)._hierarchyStringWithChildren(e+1,!1,n)}_invalidateRenderTreeForSelf(){this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlursAndGlassEffects=null,this._renderTreeWithoutGlassEffects=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null,this._renderTreeWithoutEffects=null}invalidateRenderTreeForSelfAndParents(){for(let e=this;e!=null;e=e.parent())e._invalidateRenderTreeForSelf()}invalidateRenderTreeForChildren(){for(let e=0,r=this.childCount();e<r;e=e+1){let n=this.childAt1(e);n._invalidateRenderTreeForSelf(),n.invalidateRenderTreeForChildren()}}invalidateNestedBackgroundRenderTrees(e,r){var a;let n=this.topLevelAncestor();if(!this.isTopLevelParent()&&(n==null||!e.has(n.id())))return!1;let o=((a=this._renderTree)==null?void 0:a.value)??null;if(o!=null&&!o.dependsOnBackgroundContent())return!1;if(this.transitioningFrom!=null){if(o==null||o.dependsOnBackgroundContent()){let s=this.topLevelAncestor();if(s!=null&&e.has(s.id()))return this._invalidateRenderTreeForSelf(),!0}return!1}let i=!1;for(let s=0,l=this.childCount();s<l;s=s+1)i=this.childAt2(s,!0).invalidateNestedBackgroundRenderTrees(e,r)||i;if(i)return this._invalidateRenderTreeForSelf(),!0;if(!Qt.isGeometryLeaf(this.type())&&!Qt.isFrameLike(this.type()))return!1;if(this.effects().length!=0){let s=this.supportsGeometry()?this.canvasSpaceGeometryBounds():this.canvasSpaceBoundingBox();for(let l=0,c=this.effects().length;l<c;l=l+1){let d=this.effects()[l];if(d.isVisibleForRendering()&&d.dependsOnBackgroundContent()){let u=x.new3(s).expandedBy1(d.blurRadius()),p=!1,_=this.topLevelAncestor();if(_!=null&&e.has(_.id())&&(p=!0),p)return this._invalidateRenderTreeForSelf(),r.push(u),!0}else if(d.isVisibleForRendering()&&d.type()=="GLASS"){let u=x.new3(s).expandedBy1(Math.max(d.reflectionDistance(),d.blurRadius())),p=!1,_=this.topLevelAncestor();if(_!=null&&e.has(_.id())&&(p=!0),p)return this._invalidateRenderTreeForSelf(),r.push(u),!0}}}return!1}getCachedRenderTree(){return this._renderTree}getCachedRenderTreeForBaseScreen(){return this._renderTreeAsBaseScreen}renderTree1(){return this.renderTree2(new Kt(this))}renderTree2(e){var n,o,i;let r=e.overlayRenderData();if(r!=null&&r.hasTransition()&&e.dependsOnBackgroundContent()){let a=new Re.GenerateArgs(Re.RenderMode.NORMAL);return Re.generateRenderTree(e,a)}if(this._renderTree==null){let a=new Re.GenerateArgs(Re.RenderMode.NORMAL),s=null;this.actingAsOverlayOrSublayerForRendertreeGeneration(()=>{s=Re.generateRenderTree(e,a)}),this._renderTree=s!=null?new pe(s):null,(((n=this._renderTree)==null?void 0:n.value)==null||!this._renderTree.value.hasBackgroundBlurs()&&!this._renderTree.value.hasGlassEffects())&&(this._renderTreeWithoutBackgroundBlursAndGlassEffects=this._renderTree),(((o=this._renderTree)==null?void 0:o.value)==null||!this._renderTree.value.hasGlassEffects())&&(this._renderTreeWithoutGlassEffects=this._renderTree)}return((i=this._renderTree)==null?void 0:i.value)??null}renderTreeForBaseScreen1(){return this.renderTreeForBaseScreen2(new Kt(this))}renderTreeForBaseScreen2(e){var r;if(this._renderTreeAsBaseScreen==null){let n=new Re.GenerateArgs(Re.RenderMode.NORMAL);this.actingAsBaseScreenForRendertreeGeneration(()=>{let o=Re.generateRenderTree(e,n);this._renderTreeAsBaseScreen=o!=null?new pe(o):null})}return((r=this._renderTreeAsBaseScreen)==null?void 0:r.value)??null}renderTreeWithoutBackgroundBlursAndGlassEffects(){var e;if(this._renderTreeWithoutBackgroundBlursAndGlassEffects==null){let r=new Kt(this),n=new Re.GenerateArgs(Re.RenderMode.WITHOUT_BACKGROUND_BLURS_AND_GLASS_EFFECTS),o=Re.generateRenderTree(r,n);this._renderTreeWithoutBackgroundBlursAndGlassEffects=o!=null?new pe(o):null}return((e=this._renderTreeWithoutBackgroundBlursAndGlassEffects)==null?void 0:e.value)??null}renderTreeWithoutGlassEffects(){var e;if(this._renderTreeWithoutGlassEffects==null){let r=new Kt(this),n=new Re.GenerateArgs(Re.RenderMode.WITHOUT_GLASS_EFFECTS),o=Re.generateRenderTree(r,n);this._renderTreeWithoutGlassEffects=o!=null?new pe(o):null}return((e=this._renderTreeWithoutGlassEffects)==null?void 0:e.value)??null}renderTreeForShadowRoot1(){return this.renderTreeForShadowRoot2(new Kt(this))}renderTreeForShadowRoot2(e){var r;if(this._renderTreeForShadowRoot==null){let n=new Re.GenerateArgs(Re.RenderMode.SHADOW,e.uniqueIdentifier()),o=Re.generateRenderTree(e,n);this._renderTreeForShadowRoot=o!=null?new pe(o):null}return((r=this._renderTreeForShadowRoot)==null?void 0:r.value)??null}renderTreeForShadowDescendant1(){return this.renderTreeForShadowDescendant2(new Kt(this))}renderTreeForShadowDescendant2(e){var r;if(this._renderTreeForShadowDescendant==null){let n=new Re.GenerateArgs(Re.RenderMode.SHADOW),o=Re.generateRenderTree(e,n);this._renderTreeForShadowDescendant=o!=null?new pe(o):null}return((r=this._renderTreeForShadowDescendant)==null?void 0:r.value)??null}renderTreeForKnockoutShadowRoot1(){return this.renderTreeForKnockoutShadowRoot2(new Kt(this))}renderTreeForKnockoutShadowRoot2(e){var r;if(this._renderTreeForKnockoutShadowRoot==null){let n=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW,e.uniqueIdentifier()),o=Re.generateRenderTree(e,n);this._renderTreeForKnockoutShadowRoot=o!=null?new pe(o):null}return((r=this._renderTreeForKnockoutShadowRoot)==null?void 0:r.value)??null}renderTreeForKnockoutShadowDescendant1(){return this.renderTreeForKnockoutShadowDescendant2(new Kt(this))}renderTreeForKnockoutShadowDescendant2(e){var r;if(this._renderTreeForKnockoutShadowDescendant==null){let n=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW),o=Re.generateRenderTree(e,n);this._renderTreeForKnockoutShadowDescendant=o!=null?new pe(o):null}return((r=this._renderTreeForKnockoutShadowDescendant)==null?void 0:r.value)??null}renderTreeForOverlay(e){let r=!1,n=e.overlayRenderData();n!=null&&this._overlayCacheKey!=n.overlayCacheKey()&&(this._invalidateRenderTreeForSelf(),r=!0);let o=this.renderTree2(e);return r&&n!=null&&(this._overlayCacheKey=n.overlayCacheKey()),o}renderTreeForSlideThumbnail1(){return this.renderTreeForSlideThumbnail2(new Kt(this))}renderTreeForSlideThumbnail2(e){let r=new Re.GenerateArgs(Re.RenderMode.SLIDE_THUMBNAIL),n=Re.generateRenderTree(e,r),o=n!=null?new pe(n):null;return(o==null?void 0:o.value)??null}renderTreeWithoutEffects(){var e;if(this._renderTreeWithoutEffects==null){let r=new Kt(this),n=new Re.GenerateArgs(Re.RenderMode.WITHOUT_EFFECTS),o=Re.generateRenderTree(r,n);this._renderTreeWithoutEffects=o!=null?new pe(o):null}return((e=this._renderTreeWithoutEffects)==null?void 0:e.value)??null}containsIndependentBordersStrokeMask(){return F().prepareCppNodeForAccess(this),F().nodeTsApi().getContainsIndependentBordersStrokeMask(te.PROTOTYPE_LIB)}generateStrokeAndStrokeMaskGeometries(e,r,n){var s;let o=this.strokeGeometry(),i=(s=this.strokeGeometry())==null?void 0:s.styleIDs,a=new Set(i);if((!a.has(0)||!a.has(1))&&we("Expected IDs 0 and 1 in stroke mask geometry"),o!=null)for(let l=0;l<o.regions.length;l++){let c=i!=null&&l<i.length?i[l]:0,d=o.regions[l];if(d.bounds().isEmpty())continue;let u=Nt.getOrCreate(d.path(),d.windingRule);if(c==1)r.push(new Gt(u,Se.SOLID_BLACK));else{let p=Se.isolatedPaints(n);for(let _=0;_<p.length;_++)e.push(new Gt(u,p[_]))}}}_handlePropertyChangeForRenderTree(e,r){switch(e){case 30:case 86:{this.invalidateRenderTreeForSelfAndParents(),this.invalidateRenderTreeForChildren();break}case 32:{this.invalidateRenderTreeForSelfAndParents(),r!=null&&r.invalidateRenderTreeForSelfAndParents();break}case 100:case 69:{let n=this.findAllTopLevelNodesInNode(this);for(let o=0,i=n.length;o<i;o=o+1){let a=n[o];a!=null&&a.invalidateRenderTreeForSelfAndParents()}break}case 67:case 112:case 9:case 46:case 28:case 61:case 3:case 13:case 10:case 11:case 44:case 45:case 14:case 89:case 42:case 41:case 57:case 29:case 77:case 62:case 1:case 2:case 4:case 5:case 79:case 25:case 8:case 64:case 102:case 103:case 104:case 105:case 66:case 76:case 78:case 52:case 47:case 48:case 49:case 50:case 15:case 53:case 65:{this.invalidateRenderTreeForSelfAndParents();break}}}static _applyEffectSpread(e,r){if(r!=null){let n=e.clone();return n.translate1(r.centerX(),r.centerY()),n.expand2(r.width()/2,r.height()/2),n}return e}static _computeRegionPaintsFromStyles(e,r,n){if(e!=null){let o=r!=null?r.filter(s=>s.isEnabledAndVisible()):[],i=new Map,a=e.paintOverrides;return o.length==0&&o.push(ee.TRANSPARENT),e.regions.map(s=>{let l=o,c=s.styleID;if(c!=0&&a!=null){let d=Xt.IntMap_get(i,c,null);if(d==null){let u=a.get(c,n);u!=null&&(d=u.filter(p=>p.isEnabledAndVisible()),i.set(c,d))}d!=null&&(l=d)}return l})}return Tt.EMPTY_REGION_PAINTS}};Tt._geometryBuilder=new Et,Tt._renderedBuilder=new Et,Tt._scrollingBuilder=new Et,Tt._effectBuilder=new Et,Tt._effectBounds=x.new2(),Tt.EMPTY_REGION_PAINTS=[];var Pm=Tt;var zA=class{constructor(e,r){this.clone=e,this.source=r}},WA=class{constructor(e,r){this.transitionRootStablePath=e,this.cloneOps=r}},rd=class extends Tm{constructor(e,r){super(),this._appState=null,this._modules=null,this._cachedViewNode=null,this._modules=e,this._appState=r,r.addFrameObserver(this._prototype())}modules(){return this._modules}appState(){return this._appState}nodeTsApi(){var e;return(e=this._modules)==null?void 0:e.nodeTsApi}nodeTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.nodeTsApiGenerated}sceneGraphTsApi(){var e;return(e=this._modules)==null?void 0:e.sceneGraphTsApi}_prototype(){var e;return(e=this._modules)==null?void 0:e.prototype}fonts(){var e;return(e=this._modules)==null?void 0:e.fonts}dumpFileForTests(){return this._prototype().dumpFile()}getNodeChangesForSwap(e,r,n,o){let i=this._prototype().getNodeChangesForSwap(e.guids,r,n),a=this._appState.scene(),s=i.clones.map(l=>{let c=a.findNode(l.clone),d=a.findNode(l.source);return o&&d===null&&be.trackDefinedEvent("prototype.null_source_for_swap_v2",{sourceNodeId:l.source}),new zA(c,d)});return new WA(new ht(i.transitionRootStablePath),s)}runSetVariable(e,r,n,o){return this._prototype().runSetVariable(e,r,n,o)}runSetVariableMode(e,r,n){return this._prototype().runSetVariableMode(e,r,n)}getFirstTruthyConditionalIndex(e,r){return this._prototype().getFirstTruthyConditionalIndex(e,r)}getICActionsForSetVariableAction(e,r,n,o,i){return this._prototype().getICActionsForSetVariableAction(e,r,n,o,i)}shouldDisallowSwap(e,r){return this._prototype().shouldDisallowSwap(e.guids,r)}applyExistingVariableChangesToIFLLoadedNodes(){this._prototype().applyExistingVariableChangesToIFLLoadedNodes()}getChangedVariables(){return this._prototype().getChangedVariables()}updateImmutableFramesAndLayoutDirtyGroupsAndStacks(){this._prototype().updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}prepareCppNodeForAccess(e){e!=this._cachedViewNode&&(this.nodeTsApi().setGlobalUnstableNodeByHandle(e.handle()),this._cachedViewNode=e)}createSceneAndSetActive(e,r){let n=this._prototype().initializeActiveSceneWithDangerousLoadingFlag(e,r),o=Qn.instance.findScene(n);if(o==null)throw new Error("Failed to create scene in C++");return this._setSceneAsActiveIfNeeded(o),o}destroyScene(e){this._prototype().destroyScene(e.handle())}markSceneLoaded(e){this._prototype().markSceneLoaded(e.handle())}resetLocalChanges(){this._prototype().resetLocalChanges()}updateCurrentBaseScreenIDs(e){this._prototype().updateCurrentBaseScreenIDs(e)}cloneNode(e){return this._prototype().cloneNode(e)}setNodeToInitialObjectAnimationState(e,r){this._prototype().setNodeToInitialObjectAnimationState(e,r)}setNodeToFinalObjectAnimationState(e,r){this._prototype().setNodeToFinalObjectAnimationState(e,r)}previewSceneAt(e,r,n){this._prototype().previewSceneAt(e,r,n)}updatePrototypeDevice(e){this._prototype().setOverridePrototypeDevice(e,te.PROTOTYPE_LIB)}updateResponsiveSize(e,r,n){this._prototype().updateResponsiveSize(e,r,n)}isOrContainsBaseScreen(e){return this._prototype().isOrContainsBaseScreen(e)}resetLocalVariableChanges(){this._prototype().resetLocalVariableChanges()}resetLocalVariableModeChanges(){this._prototype().resetLocalVariableModeChanges()}resetLocalNodeSizeChanges(e){this._prototype().resetLocalNodeSizeChanges(e)}resetLocalInstanceChanges(e){this._prototype().resetLocalInstanceChanges(e)}resetLocalNestedInstanceChanges(e){this._prototype().resetLocalNestedInstanceChanges(e)}nodeHasLocalSymbolChanges(e){return this._prototype().nodeHasLocalSymbolChanges(e)}getNumStateTransitions(e){return this._prototype().getNumStateTransitions(e)}_setSceneAsActiveIfNeeded(e){this._prototype().getActiveScene()!=e.handle()&&this._prototype().setActiveScene(e.handle())}applyNodeChanges(e){this._prototype().applyNodeChanges(e,_n)}reset(){this._prototype()!=null&&this._prototype().reset()}findNode(e,r){return this._setSceneAsActiveIfNeeded(e),this._prototype().findNodeByStablePath(r.guids)}idlRegionsToGeometry(e,r){if(e===null||e==null)return null;let n=[],o=[];Et.INSTANCE.reset();for(let a of e){let s=new Fo(a.path),l=new jr(a.windingRule==1?"ODD":"NONZERO",a.styleID,s,s.bounds());n.push(l),o.push(a.styleID),Et.INSTANCE.include3(l.bounds())}let i=r??new Yo(new Sn(new Map));return new $r(n,o,Et.INSTANCE.build(),i)}idlRegionsToTextGeometry(e,r){if(e==null)return null;let n=[],o=[],i=[],a=[],s=new Map,l="apple";Et.INSTANCE.reset();for(let d=0;d<e.length;d++){let u=e[d],p=new Fo(u.path),_=u.decorationPath!=null?new Fo(u.decorationPath):void 0,h=new jr(u.windingRule==1?"ODD":"NONZERO",u.styleID,p,p.bounds());if(n.push(h),i.push(u.styleID),_){let A=new jr(u.windingRule==1?"ODD":"NONZERO",u.styleID,_,_.bounds());o.push(A),i.push(u.styleID)}if(a.push(u.emojiCodePoints),u.emojiCodePoints.length&&u.emojiRotation!=0){let A=[u.emojiRotation,u.emojiUnrotatedSize.x,u.emojiUnrotatedSize.y];s.set(d,A)}l=u.emojiImageSet,Et.INSTANCE.include3(h.bounds())}let c=r??new Yo(new Sn(new Map));return new dh(n,i,Et.INSTANCE.build(),c,a,s,l,o)}getFillGeometryForSpread(e,r,n){return this.prepareCppNodeForAccess(n),this._prototype().getFillGeometryForSpread(e,r,te.PROTOTYPE_LIB)}getAffineTransform(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getAffineTransform(r),new X(Rt.retAffineTransform_m00,Rt.retAffineTransform_m01,Rt.retAffineTransform_m02,Rt.retAffineTransform_m10,Rt.retAffineTransform_m11,Rt.retAffineTransform_m12)}getAffineTransform_SGEO(e){return this._prototype().getAffineTransform_SGEO(e),new X(Rt.retAffineTransform_m00,Rt.retAffineTransform_m01,Rt.retAffineTransform_m02,Rt.retAffineTransform_m10,Rt.retAffineTransform_m11,Rt.retAffineTransform_m12)}getArcData(e,r){this.prepareCppNodeForAccess(e),this._prototype().getArcData(r);let n={};return n.startingAngle=Rt.retArcData_startAngle,n.endingAngle=Rt.retArcData_endAngle,n.innerRadius=Rt.retArcData_innerRadius,n}getArcData_SGEO(e){this._prototype().getArcData_SGEO(e);let r={};return r.startingAngle=Rt.retArcData_startAngle,r.endingAngle=Rt.retArcData_endAngle,r.innerRadius=Rt.retArcData_innerRadius,r}getBool(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getBool(r)}getBool_SGEO(e){return this._prototype().getBool_SGEO(e)}getCodeSnapshot(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getCodeSnapshot(r)}getCodeSnapshot_SGEO(e){return this._prototype().getCodeSnapshot_SGEO(e)}getDouble(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getDouble(r)}getDouble_SGEO(e){return this._prototype().getDouble_SGEO(e)}getEffectList(e){return this.prepareCppNodeForAccess(e),this._prototype().getEffectList()}getEffectList_SGEO(e){return this._prototype().getEffectList_SGEO(e)}getTransformModifierList(e){return this.prepareCppNodeForAccess(e),this._prototype().getTransformModifierList()}getTransformModifierList_SGEO(e){return this._prototype().getTransformModifierList_SGEO(e)}getGUID(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getGUID(r),Q._new(Rt.retGUID_sessionId,Rt.retGUID_localId)}getGUID_SGEO(e){return this._prototype().getGUID_SGEO(e),Q._new(Rt.retGUID_sessionId,Rt.retGUID_localId)}getStyleId(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getStyleId(r),{guid:Rt.retStyleId.guid,ref:Rt.retStyleId.ref}}getStyleId_SGEO(e){return this._prototype().getStyleId_SGEO(e),{guid:Rt.retStyleId.guid,ref:Rt.retStyleId.ref}}getInt(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getInt(r)}getInt_SGEO(e,r){return this._prototype().getInt_SGEO(e,r)}getPaintList(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getPaintList(r)}getPaintList_SGEO(e){return this._prototype().getPaintList_SGEO(e)}getField(e,r){this.prepareCppNodeForAccess(e);let n=this._prototype().getField(r);if(n.length==0)return null;let o=Ve().decodeMessage(n);if(o.nodeChanges===void 0||o.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField");let i=o.nodeChanges[0],a=[],s=null;return this._appState.serialization().decodeNodeChange(i,a,(l,c)=>{s=c}),s}getField_SGEO(e){let r=this._prototype().getField_SGEO(e);if(r.length==0)return null;let n=Ve().decodeMessage(r);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField_SGEO");let o=n.nodeChanges[0],i=[],a=null;return this._appState.serialization().decodeNodeChange(o,i,(s,l)=>{a=l}),a}getParentIndex(e){this.prepareCppNodeForAccess(e);let r=this._prototype().getParentIndex();return un.fromString(r)}getParentIndex_SGEO(e){return un.fromString(this._prototype().getParentIndex_SGEO(e))}getPrototypeInteractions_SGEO(e){let r=this._prototype().getPrototypeInteractions_SGEO(e);return ls.WeakHandle_isValid(r)?this._modules.prototypeInteractions_Internal.getOrCreateSkewCopy(r):[]}getString(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getString(r)}getString_SGEO(e){return this._prototype().getString_SGEO(e)}getVector(e,r){return this.prepareCppNodeForAccess(e),this._prototype().getVector(r),new O(Rt.retVector_x,Rt.retVector_y)}getVector_SGEO(e){return this._prototype().getVector_SGEO(e),new O(Rt.retVector_x,Rt.retVector_y)}getOverridePath(e){return this.prepareCppNodeForAccess(e),new ht(this._prototype().overridePath())}getStablePath(e){return this.prepareCppNodeForAccess(e),new ht(this._prototype().stablePath())}hasNodeProperty(e,r){return this.prepareCppNodeForAccess(e),this._prototype().hasNodeProperty(r)}forEachField(e,r){this.prepareCppNodeForAccess(e),Rt.forEachFieldCallback=r,this._prototype().forEachField(),Rt.forEachFieldCallback=null}applyLocalNodeChangesForTests(e){if(!xr())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().applyLocalNodeChangesForTests(e)}clearDirtyTextLayoutForTests(e){if(!xr())throw new Error("Should not be calling flushLayoutForTests outside of tests");this._prototype().clearDirtyTextLayoutForTests(e.handle())}updateSymbolInstancesForTests(){if(!xr())throw new Error("Should not be calling updateSymbolInstancesForTests outside of tests");this._prototype().updateSymbolInstancesForTests()}updateStylesForTests(){if(!xr())throw new Error("Should not be calling updateStylesForTests outside of tests");this._prototype().updateStylesForTests()}updateFontForTests(e,r){if(!xr())throw new Error("Should not be calling updateFontForTests outside of tests");this._prototype().updateFontForTests(e,r)}clearWaitingForFontListForTesting(){if(!xr())throw new Error("Should not be calling clearWaitingForFontListForTesting outside of tests");this._prototype().clearWaitingForFontListForTesting()}initializeRenderer(){this._prototype().initializeRenderer()}topLevelPrototypeStartingPointsSorted(e){return this._prototype().topLevelPrototypeStartingPointsSorted(e)??[]}},Fm=class Fm{isReady(){return this._isReady}createScene(e){return new ft(e)}setViewer(e){this._viewer=e}getViewer(){return this._viewer}handleUncompressedMessage(e,r,n){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.handleUncompressedMessage(e,n)}getSceneLoadingPhase(){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.getSceneLoadingPhase()}handleUncompressedSchema(e){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.handleUncompressedSchema(e)}willReceiveNodeChanges(){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.willReceiveNodeChanges()}didReceiveNodeChanges(e,r){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.didReceiveNodeChanges(e,r)}setMultiplayer(e){this._multiplayer=e}findScene(e){return F().modules().prototype.getScene(e)}findNode(e){return Xt.IntMap_get(this._nodes,e,null)}setReverseVariantBindingsForICsDisabled(e){let r=this._reverseVariantBindingsForICsDisabled;return this._reverseVariantBindingsForICsDisabled=e,r}reverseVariantBindingsForICsDisabled(){return this._reverseVariantBindingsForICsDisabled}ready(){this._isReady=!0}track(e,r){be.trackEvent(e,r)}triggerViewerEvent(e,r){this._viewer!==null&&this._viewer.trigger(e,r)}getBaseScreenId(){var e,r;return((r=(e=this._viewer)==null?void 0:e.getBaseScreenId)==null?void 0:r.call(e))??""}isScalingModeResponsive(){var e,r;return((r=(e=this._viewer)==null?void 0:e.isScalingModeResponsive)==null?void 0:r.call(e))??!1}Node_created(e,r,n,o){if(r!=null){let i=new Pm(e,r,Q._new(n,o));this._nodes.set(e,i),r.dangerouslyRegisterNode(i)}else throw new Error("Cannot create node with null scene")}Node_destroyed(e){let r=this.findNode(e);if(r!=null){let n=r.scene();n!=null&&n.dangerouslyUnregisterNode(r.id()),this._nodes.delete(e)}}triggerSceneGraphEvent(e,r,n){let o=this.findNode(e);if(o==null)return;let i=o.scene();if(i!=null){let a=r,s=o.id(),l=U1(F(),i,s,a,n),c=null,d=!1;a==114?ot.asStringEnum(l,"CREATED")=="CREATED"?(c="REMOVED",d=!0):c="CREATED":c=gm(F(),o,a),i.broadcastPropertyChange(new hm(o,a,l,c)),d&&i.dangerouslyUnregisterNode(s)}}updateNodeAfterPropertyChange(e,r){let n=this.findNode(e);n!=null&&n.updateAfterPropertyChange(r)}linkNodeToParent(e,r,n){let o=this.findNode(e);o!=null&&o.linkToParent(this.findNode(r),n)}unlinkNodeFromParent(e){let r=this.findNode(e);r!=null&&r.unlinkFromParent()}debugPrototypeActionFromPreview(e){top.postMessage({debugPrototypeActionFromPreview:e},window.origin)}retAffineTransform(e,r,n,o,i,a){Rt.retAffineTransform_m00=e,Rt.retAffineTransform_m01=r,Rt.retAffineTransform_m02=n,Rt.retAffineTransform_m10=o,Rt.retAffineTransform_m11=i,Rt.retAffineTransform_m12=a}retArcData(e,r,n){Rt.retArcData_startAngle=e,Rt.retArcData_endAngle=r,Rt.retArcData_innerRadius=n}retGUID(e,r){Rt.retGUID_sessionId=e,Rt.retGUID_localId=r}retStyleId(e){Rt.retStyleId=e}retVector(e,r){Rt.retVector_x=e,Rt.retVector_y=r}forEachFieldCallback(e){Rt.forEachFieldCallback!=null&&Rt.forEachFieldCallback(e)}constructor(){this._viewer=null,this._isReady=!1,this._multiplayer=null,this._nodes=new Map,this._reverseVariantBindingsForICsDisabled=!1}};Fm.instance=new Fm;var Qn=Fm,Rt;(A=>(A.retAffineTransform_m00=0,A.retAffineTransform_m01=0,A.retAffineTransform_m02=0,A.retAffineTransform_m10=0,A.retAffineTransform_m11=0,A.retAffineTransform_m12=0,A.retArcData_startAngle=0,A.retArcData_endAngle=0,A.retArcData_innerRadius=0,A.retGUID_sessionId=0,A.retGUID_localId=0,A.retStyleId=null,A.retVector_x=0,A.retVector_y=0,A.forEachFieldCallback=null))(Rt||(Rt={}));var Dm=16,wm=class{constructor(e){this._history=[];this._sessionActions=[];this._isRecording=!1;this._startingLoc="-1:-1";this._startRecordingTime=-1;this._endRecordingTime=-1;this._appState=e}isRecording(){return this._isRecording}startRecording(){this._isRecording||(this._sessionActions=[],this._startingLoc=this._appState.baseScreenNode().id(),this._startRecordingTime=Date.now(),this._isRecording=!0)}stopRecording(){this._isRecording&&(this._endRecordingTime=Date.now(),this._isRecording=!1)}addHistoricalEvent(e){if(!this._isRecording)return;e.action==Dm&&this._sessionActions.length>0&&this._sessionActions[this._sessionActions.length-1].action==Dm&&e.targetPath==this._sessionActions[this._sessionActions.length-1].targetPath&&this._sessionActions.pop(),this._sessionActions.push(e)}getHistory(){return{actions:this._sessionActions,startingNodeGUID:this._startingLoc,startTime:this._startRecordingTime,endTime:this._endRecordingTime}}setHistory(e){this._sessionActions=e.actions,this._startingLoc=e.startingNodeGUID,this._startRecordingTime=e.startTime,this._endRecordingTime=e.endTime}};var ep;(a=>{function t(s,l,c){s.set(l,c)}a.Map_set1=t;function e(s,l){return s.get(l)}a.Map_get1=e;function r(s,l,c){let d=s.get(l);return d!==void 0?d:c}a.Map_getOrDefault=r;function n(s){return Array.from(s.keys())}a.Map_keys=n;function o(s){return Array.from(s.values())}a.Map_values=o;function i(s,l){let c=new Map;for(let d=0,u=s.length;d<u;d=d+1)c.set(s[d],l[d]);return c}a.Map_new1=i})(ep||(ep={}));var tP;(n=>{function t(o,i){return o.get(i)}n.WeakMap_get1=t;function e(o,i,a){o.set(i,a)}n.WeakMap_set1=e;function r(o,i){let a=new WeakMap;for(let s=0,l=o.length;s<l;s=s+1)a.set(o[s],i[s]);return a}n.WeakMap_new1=r})(tP||(tP={}));var us=class t{startAnimation(e,r){this._animationCurve=e,this._animationStartTime=Xe.seconds(),this._animationEndTime=this._animationStartTime+r}animationProgress(){let e=(Xe.seconds()-this._animationStartTime)/(this._animationEndTime-this._animationStartTime);return this._animationCurve==t.Curve.EASE_IN_OUT?e*=e*e*(e*(e*6-15)+10):(e=1-e,e=1-e*e*e*e*e),Math.min(e,1)}constructor(){this._animationCurve=t.Curve.EASE_IN_OUT,this._animationStartTime=0,this._animationEndTime=0}};(e=>{let t;(o=>(o[o.EASE_IN_OUT=0]="EASE_IN_OUT",o[o.DECAY=1]="DECAY"))(t=e.Curve||(e.Curve={}))})(us||(us={}));var ii=class ii{zoomScale(){return this._boundsMapping.viewPixelsPerCanvasPixel()}viewSpaceBounds(){return this._boundsMapping.viewSpaceBounds()}resetStateForTests(){this._boundsMapping=new xm,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._dummyOffset=O.new(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._boundsOfDevicePreview=x.new2(),this._minZoom=0,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=O.new(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=x.new2()}pixelSpaceBounds(e){let r=this.viewSpaceBounds();return new x(r.left()*e,r.top()*e,r.width()*e,r.height()*e)}_clampingBoundsForCanvasSpaceOffset(){return this._boundsMapping.clampingBoundsForCanvasSpaceOffset()}copyFrom(e){this._boundsMapping=e._boundsMapping.clone(),this._boundsOfDevicePreview.copyFrom(e._boundsOfDevicePreview),this._isInvalid=e._isInvalid,this._minZoom=e._minZoom,this._scrollPadding=e._scrollPadding}offsetX(){return this.offset().x()}offsetY(){return this.offset().y()}offset(){return this._boundsMapping.canvasSpaceOrigin().negative()}_setCanvasSpaceOffsetTo(e){this._boundsMapping.setCanvasSpaceOriginTo(e.negative())}canvasSpaceToViewSpace1(){return K.isInlinePreview()?this.canvasSpaceToViewSpace2(1):this.canvasSpaceToViewSpace2(0)}canvasSpaceToViewSpace2(e){return this._boundsMapping.canvasSpaceToViewSpace(e)}viewSpaceToCanvasSpace1(){return K.isInlinePreview()?this._boundsMapping.viewSpaceToCanvasSpace(1):this._boundsMapping.viewSpaceToCanvasSpace(0)}viewSpaceToCanvasSpace2(e){return this._boundsMapping.viewSpaceToCanvasSpace(e)}viewSpaceToClipSpace(){let e=X.new2().copyFrom(yt.FrozenAffineTransform_IDENTITY);return e.copyFrom(yt.FrozenAffineTransform_IDENTITY),e.scale4(1,-1),e.translate2(-1,-1),e.scale4(2/this.viewSpaceBounds().width(),2/this.viewSpaceBounds().height()),e}canvasSpaceToClipSpace1(){return K.isInlinePreview()?this.canvasSpaceToClipSpace2(1):this.canvasSpaceToClipSpace2(0)}canvasSpaceToClipSpace2(e){let r=this.viewSpaceToClipSpace();return r.multipliedBy2(this.canvasSpaceToViewSpace2(e)),r}computeCanvasSpaceBounds1(e){K.isInlinePreview()?this.computeCanvasSpaceBounds2(e,1):this.computeCanvasSpaceBounds2(e,0)}computeCanvasSpaceBounds2(e,r){this._boundsMapping.computeCanvasSpaceBounds(e,r)}isInvalid(){return this._isInvalid}invalidate(){this._isInvalid=!0}setBounds(e){this.viewSpaceBounds().equals(e)||(this._boundsMapping.setViewSpaceBounds(e),this._isInvalid=!0)}_setCamera1(e,r,n,o){e==1?this._setCameraWithAnimation(r,n,us.Curve.EASE_IN_OUT,o):(this._isAnimating=!1,(!this.offset().equals(r)||this.zoomScale()!=n)&&(this._setCanvasSpaceOffsetTo(r),this._boundsMapping.setViewPixelsPerCanvasPixel(n),this._isInvalid=!0))}_setCamera2(e,r,n){this._setCamera1(e,r,n,ii.ANIMATION_DURATION)}_setCameraWithAnimation(e,r,n,o){this._animationManager.startAnimation(n,o),this._animationOffsetStart=this.offset().clone(),this._animationOffsetEnd=e.clone(),this._animationZoomScaleStart=this.zoomScale(),this._animationZoomScaleEnd=this._clampedZoomScale(r),this._calculateBoundsForClamping(this._animationZoomScaleEnd,this._animationEndBounds),this._clampedAnimationOffsetEnd.setTo(Ir.Math_clamp(e.x(),this._animationEndBounds.left(),this._animationEndBounds.right()),Ir.Math_clamp(e.y(),this._animationEndBounds.top(),this._animationEndBounds.bottom())),this._isAnimating=!0,this._isInvalid=!0}_clampCameraOffset(){if(!this._useClamping)return;this._dummyOffset.copyFrom(this.offset()),this._updateBoundsForClamping(),this._setCanvasSpaceOffsetTo(this._dummyOffset);let e=Ir.Math_clamp(this.offsetX(),this._clampingBoundsForCanvasSpaceOffset().left(),this._clampingBoundsForCanvasSpaceOffset().right()),r=Ir.Math_clamp(this.offsetY(),this._clampingBoundsForCanvasSpaceOffset().top(),this._clampingBoundsForCanvasSpaceOffset().bottom()),n=1e-6;if(Math.abs(this.offsetX()-e)>n||Math.abs(this.offsetY()-r)>n)if(this._isAnimating&&this._animationZoomScaleStart==this._animationZoomScaleEnd)this.offsetX()!=e&&(this._animationOffsetStart=new O(e,this._animationOffsetStart.y()),this._animationOffsetEnd=new O(e,this._animationOffsetEnd.y()),this._setCanvasSpaceOffsetTo(new O(e,this.offset().y()))),this.offsetY()!=r&&(this._animationOffsetStart=new O(this._animationOffsetStart.x(),r),this._animationOffsetEnd=new O(this._animationOffsetEnd.x(),r),this._setCanvasSpaceOffsetTo(new O(this.offset().x(),r))),this._animationOffsetStart.equals(this._animationOffsetEnd)&&(this._isAnimating=!1);else if(this._isAnimating){if(this._alreadySetAnimationClamp)return;this._animationOffsetStart=this.offset(),this._animationOffsetEnd=this._clampedAnimationOffsetEnd,this._alreadySetAnimationClamp=!0}else this._setCamera2(0,new O(e,r),this.zoomScale());this.zoomScale()<this._minZoom&&this._boundsMapping.setViewPixelsPerCanvasPixel(this._minZoom)}setCameraZoom(e,r){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),r)}adjustCameraZoom1(e,r){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),(n?this._animationZoomScaleEnd:this.zoomScale())*r)}adjustCameraZoom2(e,r,n){let o=e==1&&this._isAnimating;this._setCamera1(e,o?this._animationOffsetEnd:this.offset(),(o?this._animationZoomScaleEnd:this.zoomScale())*r,n)}adjustCameraZoomRounded(e,r){let n=e==1&&this._isAnimating;this.setCameraZoom(1,Math.pow(2,Math.round(Math.log((n?this._animationZoomScaleEnd:this.zoomScale())*r)/Math.log(2))))}setCameraOffset1(e,r){this.setCameraOffset2(e,r,ii.ANIMATION_DURATION)}setCameraOffset2(e,r,n){let o=e==1&&this._isAnimating;this._setCamera1(e,r,o?this._animationZoomScaleEnd:this.zoomScale(),n),this._clampCameraOffset()}panCamera(e){this._setCamera2(0,this.offset().add(e.divideScalar(this.zoomScale())),this.zoomScale()),this._clampCameraOffset()}flingCameraOffset(e,r){this._setCameraWithAnimation((this._isAnimating?this._animationOffsetEnd:this.offset()).add(e.divideScalar(this.zoomScale())),this._isAnimating?this._animationZoomScaleEnd:this.zoomScale(),us.Curve.DECAY,r),this._clampCameraOffset()}adjustCameraZoomWithPin(e,r){let n=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add(r.subtract(this.viewSpaceBounds().size().divideScalar(2)).multiplyScalar(1/n-1/this.zoomScale())),n),this._clampCameraOffset()}adjustCameraZoomAndOffset(e,r,n){let o=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add(n.subtract(this.viewSpaceBounds().size().divideScalar(2)).divideScalar(o)).subtract(r.subtract(this.viewSpaceBounds().size().divideScalar(2)).divideScalar(this.zoomScale())),o),this._clampCameraOffset()}zoomToFit1(e,r,n){this._zoomToFit(e,r,ii.ZOOM_TO_FIT_PADDING,n)}zoomToFit2(e,r){this._zoomToFit(e,r,ii.ZOOM_TO_FIT_PADDING,ii.ANIMATION_DURATION)}zoomToFitExactly(e,r){this._zoomToFit(e,r,0,ii.ANIMATION_DURATION)}_zoomToFit(e,r,n,o){r.isEmpty()||(this._setCamera1(e,r.center().negative(),this.viewSpaceBounds().size().subtractScalar(2*n).divide(r.size()).minComponent(),o),this._clampCameraOffset())}prepareForRendering(){if(this._isAnimating){let e=this._animationManager.animationProgress();e>=1?(this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.clone()),this._boundsMapping.setViewPixelsPerCanvasPixel(this._animationZoomScaleEnd),this._isAnimating=!1,this._alreadySetAnimationClamp=!1):(this._boundsMapping.setViewPixelsPerCanvasPixel(1/(1/this._animationZoomScaleStart+(1/this._animationZoomScaleEnd-1/this._animationZoomScaleStart)*e)),this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.subtract(this._animationOffsetStart).multiplyScalar(e).add(this._animationOffsetStart)))}this._isInvalid=this._isAnimating}getScaleFactorForCurrentTlf(e,r,n){let o=ro.canvasSpaceContentSize(e,n);if(o.x()===0||o.y()===0)return 1;switch(r.fitMode){case"scale-down-width":return o.x()>this.viewSpaceBounds().width()?this.viewSpaceBounds().width()/o.x():1;case"fit-width":return this.viewSpaceBounds().width()/o.x();case"scale-down":case"contain-with-zoom":case"contain":{let i=1/Math.max(o.x()/this.viewSpaceBounds().width(),o.y()/this.viewSpaceBounds().height());return r.fitMode=="scale-down"&&(i=Math.min(i,1)),i=Math.ceil(i*e.y())/e.y(),i}case"min-zoom":return 1;case"none":return 1;case"free":return 0;default:return 1}}_clampedZoomScale(e){let r=Math.max(this._minZoom,ii.ZOOM_MIN);return Math.max(r,Math.min(e,ii.ZOOM_MAX))}setScrollPadding(e){this._scrollPadding=e}previewBoundsIncludingDeviceFrame(e,r,n){return n!=null&&ws.hasDevice(n.type)?ro.adjustNodeBoundsForDevice(e,n):K.isInlinePreview()?e:r}_snapOffsetToPixelGrid(e,r){let n=e.add(r).multiplyScalar(this.zoomScale()*2);n.setX(Math.floor(n.x())),n.setY(Math.floor(n.y()));let o=n.divideScalar(this.zoomScale()*2).subtract(r);return r.add(o.subtract(e))}_calculateBoundsForClamping(e,r){let n=this._boundsOfDevicePreview.isInvalid()?x.new2():this._boundsOfDevicePreview,o=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[2])/e,n.width()/2),i=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[3])/e,n.height()/2),a=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[0])/e,n.width()/2),s=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[1])/e,n.height()/2),l=-n.right()+o,c=-n.bottom()+i,d=-n.left()-a,u=-n.top()-s,p=d-l,_=u-c;r.setTo1(l,c,p,_)}_updateBoundsForClamping(){let e=x.new2();this._calculateBoundsForClamping(this.zoomScale(),e),this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(e)}updateForBaseScreen(e,r,n){this.updateForCurrentPreview(e==null?void 0:e.canvasSpaceBoundingBox(),e==null?void 0:e.canvasSpacePreviewBounds(),r,n)}updateForCurrentPreview(e,r,n,o){if(r==null||e==null){this._useClamping=!1;return}switch(this._boundsOfDevicePreview.copyFrom(this.previewBoundsIncludingDeviceFrame(e,r,o)),this._minZoom=this.getScaleFactorForCurrentTlf(r.size(),n,o),n.fitMode){case"free":{this._useClamping=!1;break}case"contain-with-zoom":case"min-zoom":case"scale-down-width":case"none":case"fit-width":{this._useClamping=!0,this._updateBoundsForClamping(),this._clampCameraOffset();let i=o!=null&&o.type!="NONE";_m(n,i)||this.setCameraZoom(0,this._minZoom);break}case"contain":case"scale-down":{this._useClamping=!0;let i=this._snapOffsetToPixelGrid(r.topLeft(),this._boundsOfDevicePreview.center().negative());this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(new x(i.x(),i.y(),0,0)),this._setCamera2(0,i,this._minZoom);break}}}constructor(){this._boundsMapping=new xm,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._boundsOfDevicePreview=x.new2(),this._dummyOffset=O.new(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._minZoom=0,this._animationManager=new us,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=O.new(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=x.new2()}};ii.ZOOM_MIN=Math.pow(2,-6),ii.ZOOM_MAX=Math.pow(2,8),ii.ZOOM_TO_FIT_PADDING=50,ii.ANIMATION_DURATION=.2;var xo=ii,xm=class t{canvasSpaceOrigin(){return this._defaultCanvasSpaceOrigin().add(this._canvasSpaceOriginDelta)}setCanvasSpaceOriginTo(e){this._canvasSpaceOriginDelta=e.subtract(this._defaultCanvasSpaceOrigin())}viewSpaceBounds(){return this._viewSpaceBounds}setViewSpaceBounds(e){this._viewSpaceBounds=e}viewPixelsPerCanvasPixel(){return this._viewPixelsPerCanvasPixel}setViewPixelsPerCanvasPixel(e){isNaN(e)||e<=0?this._viewPixelsPerCanvasPixel=1:this._viewPixelsPerCanvasPixel=e}clampingBoundsForCanvasSpaceOffset(){return this._clampingBoundsForCanvasSpaceOffset}setClampingBoundsForCanvasSpaceOffset(e){this._clampingBoundsForCanvasSpaceOffset.copyFrom(e)}canvasSpaceToViewSpace(e){let r=mn.new2().translatedBy2(this._viewSpaceBounds.width()/2,this._viewSpaceBounds.height()/2).scaledBy(this._viewPixelsPerCanvasPixel).translatedBy1(this.canvasSpaceOrigin().negative()),n=mn.new2();if(e==0){let o=O.new(this.canvasSpaceOrigin()).rounded(),i=r.transformPoint(o),a=-(i.x()-Math.floor(i.x())),s=-(i.y()-Math.floor(i.y()));n.translate1(a,s)}return n.multiply(r),n}viewSpaceToCanvasSpace(e){let r=this.canvasSpaceToViewSpace(e).clone();return r.invert(),r}computeCanvasSpaceBounds(e,r){this._viewSpaceBounds.transformInto2(e,this.viewSpaceToCanvasSpace(r))}_defaultCanvasSpaceOrigin(){return this._clampingBoundsForCanvasSpaceOffset!=null?this._clampingBoundsForCanvasSpaceOffset.bottomRight().negative():ge.FrozenVector_ZERO}clone(){let e=new t;return e._canvasSpaceOriginDelta=this._canvasSpaceOriginDelta.clone(),e._viewPixelsPerCanvasPixel=this._viewPixelsPerCanvasPixel,e._viewSpaceBounds=this._viewSpaceBounds.clone(),e._clampingBoundsForCanvasSpaceOffset=this._clampingBoundsForCanvasSpaceOffset.clone(),e}constructor(){this._canvasSpaceOriginDelta=O.new(),this._viewPixelsPerCanvasPixel=1,this._viewSpaceBounds=x.new2(),this._clampingBoundsForCanvasSpaceOffset=x.new2()}};var tp=class t{constructor(e,r,n){this._numStatesTransferred=0;this._numStatesReset=0;this._appState=null,this._prototypeState=null,this._semanticChangeHistoryStorage=new Qs,this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set,this._swapStateCallback=null,this._appState=e,this._prototypeState=r,this._swapStateCallback=n,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this)}static getStateGroupID(e){var o;let r=e!=null?e.scene().findNode(e==null?void 0:e.symbolID()):null,n=(o=r==null?void 0:r.findContainingStateGroupOrSelf())==null?void 0:o.id();return n??Q.invalid()}getComponentHistory(e,r){if(e.length==0)return[];let n=this._semanticChangeHistoryStorage.getData(e,r);return n??[]}setComponentHistory(e,r,n){this._semanticChangeHistoryStorage.insert(e,r,n)}handleStateChangeCommitted(e,r){}_transferChildComponentStates(e){e!=null&&e.forEachChild(r=>{this._setInstanceChangeHistory(r),this._transferChildComponentStates(r)})}_hasStateToTranfer(e,r){return r.length>0&&e.symbolID()!=ie.List_last(r).newStateId()}_setInstanceChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let r=Nr.getSemanticNodePath(new Kt(e)),n=this.getComponentHistory(r,t.getStateGroupID(e)),o=this._prototypeState.getStateMachineOrNull(e.stablePath());o!=null&&this._hasStateToTranfer(e,n)&&!this._stateAlreadyManagedByVariables(e)&&(o.setChangeHistory(n),this._swapStateCallback(e.stablePath(),ie.List_last(n).newStateId(),hl.MATERIALIZE_SWAPPED_OUT_TREE),this._numStatesTransferred++)}}_resetChildComponentStates(e,r){e!=null&&e.forEachChild(n=>{this._clearInstanceChangeHistory(n,r),this._resetChildComponentStates(n,r)})}_nodeIsInstance(e){return e!=null&&e.type()=="INSTANCE"}_nodeHasStoredState(e,r){let n=F();return!r&&n!=null&&this._nodeIsInstance(e)?n.nodeHasLocalSymbolChanges(e.id()):!1}_clearInstanceChangeHistory(e,r){var n,o;if(e!=null&&(this._isInteractiveComponent(e)||this._nodeHasStoredState(e,r))&&!this._stateAlreadyManagedByVariables(e)){this._numStatesReset++,r?(n=F())==null||n.resetLocalNestedInstanceChanges([e.id()]):(o=F())==null||o.resetLocalInstanceChanges([e.id()]);let i=Nr.getSemanticNodePath(new Kt(e));this._semanticChangeHistoryStorage.remove(i,t.getStateGroupID(e))}}_hasStateToStore(e,r,n){if(r==null||r.length==0)return!1;if(n==null||n.length==0)return!0;let o=ie.List_last(n);return e.symbolID()!=o.newStateId()}_storeChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let r=this._prototypeState.getStateMachineOrNull(e.stablePath());if(r!=null){let n=Nr.getSemanticNodePath(new Kt(e)),o=t.getStateGroupID(e),i=this.getComponentHistory(n,o),a=r.changeHistory();this._hasStateToStore(e,a,i)&&!this._stateAlreadyManagedByVariables(e)&&this.setComponentHistory(n,o,a)}}}_storeChangeHistoryForChildren(e){e!=null&&e.forEachChild(r=>{this._storeChangeHistory(r),this._storeChangeHistoryForChildren(r)})}_semanticPathToString(e){let r=Nr.getSemanticNodePath(new Kt(e)),n=":/:",o=t.getStateGroupID(e);return r.length==1?r[0].toStringWithPrefix(!0):r.reduce((i,a,s)=>s==0?i:i+a.toString()+n,"")+n+o}_recordInteraction(e,r){if(r.transitionParameters.navigationType=="SWAP_STATE"&&!rt.isTransientAction(r.cause)){let n=this._appState.scene().findNodeByStablePath(e);if(n==null)return;let o=this._semanticPathToString(n);this._semanticPathInteracted.add(o)}}_semanticPathHasBeenInteractedWith(e){return this._semanticPathInteracted.has(this._semanticPathToString(e))}_nodeHasBeenInteractedWith(e){return t.getStateGroupID(e)!=Q.invalid()?this._semanticPathHasBeenInteractedWith(e):!1}_isInteractiveComponent(e){return this._nodeIsInstance(e)?t.getStateGroupID(e)!=Q.invalid():!1}_stateAlreadyManagedByVariables(e){return e!=null&&e.getBoundVariables().componentProperties}handleStateChangeAborted(e){}handleStateChangeInitiated(e){if(e.stateManagementVersion()==1){let r=e.oldStateAndOverlays.topId(),n=e.newStateAndOverlays.topId(),o=this._appState.scene().findNode(r),i=this._appState.scene().findNode(n);this._storeChangeHistory(o),this._storeChangeHistoryForChildren(o),e.resetInteractiveComponents()==0?(this._numStatesReset=0,this._clearInstanceChangeHistory(i,!1),this._resetChildComponentStates(i,!1),this._sendStateResetLog()):(this._numStatesTransferred=0,this._setInstanceChangeHistory(i),this._transferChildComponentStates(i),this._sendStateTransferLog())}}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){this._semanticChangeHistoryStorage.uninitialize1(),this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set}handleHsmAborted(e,r){}handleHsmCommitted(e,r,n){r.stateManagementVersion()==1&&this._recordInteraction(e,r)}handleHsmRequested(e,r){if(r.stateManagementVersion()==1){let n=this._appState.scene().findNodeByStablePath(e);this._storeChangeHistoryForChildren(n)}}handleHsmInitiated(e,r){if(r.stateManagementVersion()==1){let n=this._appState.scene().findNodeByStablePath(e);r.resetInteractiveComponents()!=0?(this._numStatesTransferred=0,this._transferChildComponentStates(n),this._sendStateTransferLog()):(this._numStatesReset=0,this._resetChildComponentStates(n,!0),this._sendStateResetLog())}}_sendStateTransferLog(){this._numStatesTransferred>0&&be.trackDefinedEvent("prototype.viewer_interaction_state_transferred",{count:this._numStatesTransferred})}_sendStateResetLog(){this._numStatesReset>0&&be.trackDefinedEvent("prototype.viewer_interaction_state_reset",{count:this._numStatesReset})}debugString(){return this._semanticChangeHistoryStorage.toString2(e=>{let r="",n=Math.max(e.length-4,0);n!=0&&(r="..., ");for(let o=n,i=e.length;o<i;o=o+1){let a=e[o];r+=`${(a==null?void 0:a.oldStateId())??"null"}->${a==null?void 0:a.newStateId()}`,o!=e.length-1&&(r+=", ")}return r})}};var Lm=class t{opacity1(){return this._opacity}effects(){return this._effects}translation1(){return this._translation}transform1(){return this._transform}scaling1(){return this._scaling}transformOrigin1(){return this._transformOrigin}fillPaints1(){return this._fillPaints}textDecorationPaints(){return this._textDecorationPaints}fillPaintsToString(){return this._fillPaints.map(e=>e.debugString()).join(", ")}strokePaints1(){return this._strokePaints}cornerRadii1(){return this._cornerRadii}rectangleSize1(){return this._rectangleSize}clone(){var r,n;let e=new t;return e._opacity=this._opacity,e._translation=this._translation.clone(),e._transform=this._transform.clone(),e._scaling=this._scaling,e._transformOrigin=((r=this._transformOrigin)==null?void 0:r.clone())??null,e._effects=this._effects,e._fillPaints=this._fillPaints,e._textDecorationPaints=this._textDecorationPaints,e._strokePaints=this._strokePaints,e._cornerRadii=this._cornerRadii,e._rectangleSize=((n=this._rectangleSize)==null?void 0:n.clone())??null,e}_areVectorsEqual(e,r){return e==null&&r==null?!0:e==null||r==null?!1:e.equals(r)}equals(e){return this._opacity==e.opacity1()&&Yt.FrozenList_equals(this._effects,e.effects(),(r,n)=>r.equalsWithinEffectType(n))&&this._transform.equals1(e.transform1())&&this._scaling.equals(e.scaling1())&&this._areVectorsEqual(this._transformOrigin,e.transformOrigin1())&&this.translation1().equals(e.translation1())&&Yt.FrozenList_equals(this._fillPaints,e.fillPaints1(),(r,n)=>r.equals1(n))&&Yt.FrozenList_equals(this._strokePaints,e.strokePaints1(),(r,n)=>r.equals1(n))&&Yt.FrozenList_equals(this._textDecorationPaints,e.textDecorationPaints(),(r,n)=>r.equals1(n))&&this._cornerRadii.equals(e.cornerRadii1())&&this._areVectorsEqual(this._rectangleSize,e.rectangleSize1())}equalTransformsUpToTranslation(e,r){return this.equalTransformsUpToTranslationAndScaling(e,r)&&this._scaling.equals(e.scaling1())}equalTransformsUpToTranslationAndScaling(e,r){let n=Do.from(this.transform1()),o=Do.from(e.transform1()),i=Math.abs(n.angleDegrees-o.angleDegrees)<=r,a=Math.abs(n.m00-o.m00)<=r&&Math.abs(n.m01-o.m01)<=r&&Math.abs(n.m10-o.m10)<=r&&Math.abs(n.m11-o.m11)<=r;return i&&a}opacity2(e){return this._opacity=e,this}setEffects(e){return this._effects=e,this}translation2(e){return this._translation=e,this}transform2(e){return e!=null,this._transform=e,this}scaling2(e){return this._scaling=e,this}transformOrigin2(e){return this._transformOrigin=e,this}fillPaints2(e){return this._fillPaints=e,this}strokePaints2(e){return this._strokePaints=e,this}setTextDecorationPaints(e){return this._textDecorationPaints=e,this}cornerRadii2(e){return this._cornerRadii=e,this}rectangleSize2(e){return this._rectangleSize=e,this}withScaledTranslation(e){return this.clone().translation2(this._translation.multiply(e))}constructor(){this._opacity=1,this._translation=O.new(),this._transform=yt.FrozenAffineTransform_new1(),this._scaling=O.new().withOnesForZeros(),this._effects=[],this._transformOrigin=null,this._fillPaints=[],this._textDecorationPaints=[],this._strokePaints=[],this._cornerRadii=Ko.ZEROS,this._rectangleSize=null}},Pn=class t{constructor(e){e?(this._isTransformEqual=!1,this._from=e._from.clone(),this._to=e._to.clone(),this._shouldDoLegacyImageRectSizeTransition=e._shouldDoLegacyImageRectSizeTransition,this._shouldTransitionGeometryForRoundedRectangles=e._shouldTransitionGeometryForRoundedRectangles,this._isTransformEqual=e._isTransformEqual):(this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._from=new Lm,this._to=new Lm,this._isTransformEqual=!0)}from(){return this._from}to(){return this._to}opacity(e,r){return this._from.opacity2(e),this._to.opacity2(r),this}translation(e,r){return this._from.translation2(e),this._to.translation2(r),this}transform(e,r){return this._isTransformEqual=e.equals2(r,1e-6),this._from.transform2(e),this._to.transform2(r),this}scaling(e,r){return this._from.scaling2(e),this._to.scaling2(r),this}shouldDoLegacyImageRectSizeTransition(e){return this._shouldDoLegacyImageRectSizeTransition=e,this}transitionGeometryForRoundedRectangles(e,r,n,o){return this._from.rectangleSize2(e),this._from.cornerRadii2(r),this._to.rectangleSize2(n),this._to.cornerRadii2(o),this._shouldTransitionGeometryForRoundedRectangles=!0,this}transformOrigin(e,r){return this._from.transformOrigin2(e),this._to.transformOrigin2(r),this}setEffectsForTransition(e,r){return this._from.setEffects(e),this._to.setEffects(r),this}fillPaints1(e,r){return this._from.fillPaints2(e),this._to.fillPaints2(r),this}strokePaints1(e,r){return this._from.strokePaints2(e),this._to.strokePaints2(r),this}_getEffects(e,r,n){let o=[];for(let i=0,a=r.length;i<a;i=i+1){let s=r[i],l=n[i];s.equalsWithinEffectType(l)&&!this.hasTransitioningTransformOrigin()||s.type()=="DROP_SHADOW"||s.type()=="INNER_SHADOW"?o.push(s):o.push(um.create(s,l,this._from.transformOrigin1().multiplyScalar(2),this._to.transformOrigin1().multiplyScalar(2),this._from.cornerRadii1(),this._to.cornerRadii1(),e))}return o}_getPaints(e,r,n){let o=[];for(let i=0,a=r.length;i<a;i=i+1){let s=r[i],l=n[i];if(s.equals2(l))o.push(s);else{let c=s,d=l;c.opacity()==0&&(c=l.cloneAsSinglePaint(),c.setOpacity(0)),d.opacity()==0&&(d=s.cloneAsSinglePaint(),d.setOpacity(0)),o.push(wu.create(c,d,this._from.transformOrigin1().multiplyScalar(2),this._to.transformOrigin1().multiplyScalar(2),e))}}return o}fillGeometryForRoundedRectangles(e,r){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let n=Math.max(1-r.top(),r.bottom(),1),o=x.new4(ge.FrozenVector_ZERO,this._from.rectangleSize1().multiplyScalar(n).max(this._to.rectangleSize1().multiplyScalar(n))),i=new bu("NONZERO",0,()=>{let a=O.lerp(this._from.rectangleSize1(),this._to.rectangleSize1(),e()),s=this._from.cornerRadii1().toList(),l=this._to.cornerRadii1().toList(),c=[];for(let d=0;d<4;d=d+1)c.push(Math.max(xt.double_lerp(s[d],l[d],e()),0));return new vt(new x(0,0,Math.abs(a.x()),Math.abs(a.y())),Ko.fromList(c))},o);return new $r([i],[],o,null)}fillGeometryForSpreadDynamic(e,r,n,o,i,a){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let s=this._from.rectangleSize1().addScalar(2*r),l=this._to.rectangleSize1().addScalar(2*r),c=Math.max(1-a.top(),a.bottom(),1),d=x.new4(ge.FrozenVector_ZERO,this._from.rectangleSize1().multiplyScalar(c).max(this._to.rectangleSize1().multiplyScalar(c))).expandedBy1(r),u=this._from.cornerRadii1().toList(),p=this._to.cornerRadii1().toList();for(let h=0;h<4;h=h+1)u[h]=u[h]==0?0:u[h]+r,p[h]=p[h]==0?0:p[h]+r;let _=new bu("NONZERO",0,()=>{let h=O.lerp(s,l,n()),A=[];for(let m=0;m<4;m=m+1)A.push(Math.max(xt.double_lerp(u[m],p[m],n()),0));return new vt(new x(-r,-r,Math.abs(h.x()),Math.abs(h.y())),Ko.fromList(A))},d);return new Jc(()=>new Nt(_.path(),_.windingRule),o,_.bounds(),St.forDynamicGeometry(i))}effects2(e){return this._getEffects(e,this._from.effects(),this._to.effects())}fillPaints2(e){return this._getPaints(e,this._from.fillPaints1(),this._to.fillPaints1())}strokePaints2(e){return this._getPaints(e,this._from.strokePaints1(),this._to.strokePaints1())}setTextDecorationPaints(e){return this._getPaints(e,this._from.textDecorationPaints(),this._to.textDecorationPaints())}hasTransitioningPaints(){return this._to.fillPaints1().length!=0&&this._from.fillPaints1().length!=0||this._to.strokePaints1().length!=0&&this._from.strokePaints1().length!=0||this._to.textDecorationPaints().length!=0&&this._from.textDecorationPaints().length!=0}hasLegacyTransitioningSizesForImageRect(){return this._shouldDoLegacyImageRectSizeTransition}hasTransitioningGeometryForRoundedRectangles(){return this._shouldTransitionGeometryForRoundedRectangles}hasTransitioningTranslation(){return this._from.translation1()==null&&this._to.translation1()==null?!1:this._from.translation1()==null||this.to().translation1()==null?!0:!this._from.translation1().equals(this.to().translation1())}hasTransitioningTransform(){return this._from.transform1()==null&&this._to.transform1()==null?!1:this._from.transform1()==null||this.to().transform1()==null?!0:!this._from.transform1().equals1(this.to().transform1())}hasTransitioningScaling(){return this._from.scaling1()==null&&this._to.scaling1()==null?!1:this._from.scaling1()==null||this.to().scaling1()==null?!0:!this._from.scaling1().equals(this.to().scaling1())}hasTransitioningTransformOrigin(){return this._from.transformOrigin1()==null&&this._to.transformOrigin1()==null?!1:this._from.transformOrigin1()==null||this.to().transformOrigin1()==null?!0:!this._from.transformOrigin1().equals(this.to().transformOrigin1())}hasTransitioningEffects(){return this._from.effects().length!=0&&this._to.effects().length!=0}interpolateOpacity(e){return xt.double_clamp(xt.double_lerp(this.from().opacity1(),this.to().opacity1(),e),0,1)}interpolateTranslation(e){return O.lerp(this.from().translation1(),this.to().translation1(),e)}interpolateTransform(e){let r=this.from().transform1(),n=this.to().transform1();if(r.toAngle()!=n.toAngle()&&this.from().transformOrigin1()!=null&&this.to().transformOrigin1()!=null){let o=r.clone().translatedBy1(this.from().transformOrigin1()),i=n.clone().translatedBy1(this.to().transformOrigin1()),a=Do.lerp1(o,i,e),s=O.lerp(this.from().transformOrigin1(),this.to().transformOrigin1(),e),l=X.new2().translatedBy1(s.negative());return a.multiply(l),a}else return this._isTransformEqual?r:Do.lerp1(r,n,e)}interpolateScaling(e){return O.lerp(this.from().scaling1(),this.to().scaling1(),e)}clone(){return new t(this)}withScaledTranslation(e){let r=this.clone();return r._from=r._from.withScaledTranslation(e),r._to=r._to.withScaledTranslation(e),r}},Ae=class Ae{constructor(){this._reversed=null;arguments.length==0?(this._enteringFrameTransition=new Pn,this._exitingFrameTransition=new Pn,this._drawsEnteringFrameOnTopOfExitingFrame=!0,this._isDissolve=!1):arguments.length==4&&(this._enteringFrameTransition=arguments[0],this._exitingFrameTransition=arguments[1],this._drawsEnteringFrameOnTopOfExitingFrame=arguments[2],this._isDissolve=arguments[3])}enteringFrameTransition(){return this._enteringFrameTransition}exitingFrameTransition(){return this._exitingFrameTransition}drawsEnteringFrameOnTopOfExitingFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame}isDissolve(){return this._isDissolve}enteringFrameTranslation(e,r){return this._enteringFrameTransition.translation(e,r),this._reversed=null,this}enteringFrameOpacity(e,r){return this._enteringFrameTransition.opacity(e,r),this._reversed=null,this}exitingFrameTranslation(e,r){return this._exitingFrameTransition.translation(e,r),this._reversed=null,this}exitingFrameOpacity(e,r){return this._exitingFrameTransition.opacity(e,r),this._reversed=null,this}drawExitingFrameOnTopOfEnteringFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._reversed=null,this}dissolve(){return this._isDissolve=!0,this._reversed=null,this}freeze(){return this}clone(){return new Ae(this._enteringFrameTransition.clone(),this._exitingFrameTransition.clone(),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}reversed(){if(this._reversed==null){let e=new Ae().enteringFrameTranslation(this.exitingFrameTransition().to().translation1(),this.exitingFrameTransition().from().translation1()).enteringFrameOpacity(this.exitingFrameTransition().to().opacity1(),this.exitingFrameTransition().from().opacity1()).exitingFrameTranslation(this.enteringFrameTransition().to().translation1(),this.enteringFrameTransition().from().translation1()).exitingFrameOpacity(this.enteringFrameTransition().to().opacity1(),this.enteringFrameTransition().from().opacity1());this.isDissolve()&&e.dissolve(),this.drawsEnteringFrameOnTopOfExitingFrame()&&e.drawExitingFrameOnTopOfEnteringFrame(),this._reversed=e}return this._reversed}withScaledTranslation(e){return new Ae(this._enteringFrameTransition.withScaledTranslation(e),this._exitingFrameTransition.withScaledTranslation(e),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}static get(e){switch(e){case"INSTANT_TRANSITION":return Ae.INSTANT_TRANSITION;case"DISSOLVE":return Ae.DISSOLVE;case"SMART_ANIMATE":return Ae.DISSOLVE;case"SLIDE_FROM_LEFT":return Ae.SLIDE_FROM_LEFT;case"SLIDE_FROM_RIGHT":return Ae.SLIDE_FROM_RIGHT;case"SLIDE_FROM_TOP":return Ae.SLIDE_FROM_TOP;case"SLIDE_FROM_BOTTOM":return Ae.SLIDE_FROM_BOTTOM;case"PUSH_FROM_LEFT":return Ae.PUSH_FROM_LEFT;case"PUSH_FROM_RIGHT":return Ae.PUSH_FROM_RIGHT;case"PUSH_FROM_TOP":return Ae.PUSH_FROM_TOP;case"PUSH_FROM_BOTTOM":return Ae.PUSH_FROM_BOTTOM;case"MOVE_FROM_LEFT":return Ae.MOVE_FROM_LEFT;case"MOVE_FROM_RIGHT":return Ae.MOVE_FROM_RIGHT;case"MOVE_FROM_TOP":return Ae.MOVE_FROM_TOP;case"MOVE_FROM_BOTTOM":return Ae.MOVE_FROM_BOTTOM;case"SLIDE_OUT_TO_LEFT":return Ae.SLIDE_OUT_TO_LEFT;case"SLIDE_OUT_TO_RIGHT":return Ae.SLIDE_OUT_TO_RIGHT;case"SLIDE_OUT_TO_TOP":return Ae.SLIDE_OUT_TO_TOP;case"SLIDE_OUT_TO_BOTTOM":return Ae.SLIDE_OUT_TO_BOTTOM;case"MOVE_OUT_TO_LEFT":return Ae.MOVE_OUT_TO_LEFT;case"MOVE_OUT_TO_RIGHT":return Ae.MOVE_OUT_TO_RIGHT;case"MOVE_OUT_TO_TOP":return Ae.MOVE_OUT_TO_TOP;case"MOVE_OUT_TO_BOTTOM":return Ae.MOVE_OUT_TO_BOTTOM;case"FADE":return Ae.DISSOLVE;case"MAGIC_MOVE":return Ae.DISSOLVE}throw new Error(`Unhandled transition type ${e}`)}};Ae.SLIDE_BACK_FRAME_OPACITY_START=1,Ae.SLIDE_BACK_FRAME_OPACITY_END=.5,Ae.OFFSCREEN_LEFT=new O(-1,0),Ae.OFFSCREEN_RIGHT=new O(1,0),Ae.OFFSCREEN_TOP=new O(0,-1),Ae.OFFSCREEN_BOTTOM=new O(0,1),Ae.CENTER=O.new(),Ae.INSTANT_TRANSITION=new Ae().freeze(),Ae.DISSOLVE=new Ae().dissolve().freeze(),Ae.SLIDE_FROM_LEFT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_LEFT,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_RIGHT.divideScalar(4)).exitingFrameOpacity(Ae.SLIDE_BACK_FRAME_OPACITY_START,Ae.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ae.SLIDE_FROM_RIGHT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_RIGHT,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_LEFT.divideScalar(4)).exitingFrameOpacity(Ae.SLIDE_BACK_FRAME_OPACITY_START,Ae.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ae.SLIDE_FROM_TOP=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_TOP,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_BOTTOM.divideScalar(4)).exitingFrameOpacity(Ae.SLIDE_BACK_FRAME_OPACITY_START,Ae.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ae.SLIDE_FROM_BOTTOM=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_BOTTOM,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_TOP.divideScalar(4)).exitingFrameOpacity(Ae.SLIDE_BACK_FRAME_OPACITY_START,Ae.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ae.SLIDE_OUT_TO_LEFT=Ae.SLIDE_FROM_RIGHT.reversed(),Ae.SLIDE_OUT_TO_RIGHT=Ae.SLIDE_FROM_LEFT.reversed(),Ae.SLIDE_OUT_TO_TOP=Ae.SLIDE_FROM_BOTTOM.reversed(),Ae.SLIDE_OUT_TO_BOTTOM=Ae.SLIDE_FROM_TOP.reversed(),Ae.PUSH_FROM_LEFT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_LEFT,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_RIGHT).freeze(),Ae.PUSH_FROM_RIGHT=Ae.PUSH_FROM_LEFT.reversed(),Ae.PUSH_FROM_TOP=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_TOP,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_BOTTOM).freeze(),Ae.PUSH_FROM_BOTTOM=Ae.PUSH_FROM_TOP.reversed(),Ae.MOVE_FROM_LEFT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_LEFT,Ae.CENTER).freeze(),Ae.MOVE_FROM_RIGHT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_RIGHT,Ae.CENTER).freeze(),Ae.MOVE_FROM_TOP=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_TOP,Ae.CENTER).freeze(),Ae.MOVE_FROM_BOTTOM=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_BOTTOM,Ae.CENTER).freeze(),Ae.MOVE_OUT_TO_LEFT=Ae.MOVE_FROM_RIGHT.reversed(),Ae.MOVE_OUT_TO_RIGHT=Ae.MOVE_FROM_LEFT.reversed(),Ae.MOVE_OUT_TO_TOP=Ae.MOVE_FROM_BOTTOM.reversed(),Ae.MOVE_OUT_TO_BOTTOM=Ae.MOVE_FROM_TOP.reversed();var Vr=Ae;var nd=class nd{constructor(e,r){this.hotspotStablePath=e,this.interactionId=r}};nd.EXTERNAL_INTERACTION_ID=Q._new(-1,-2),nd.EXTERNAL=new nd(null,nd.EXTERNAL_INTERACTION_ID);var Lo=nd,rn=class t{static getDefault(){return new t("INSTANT_TRANSITION",0,null,!1,ge.FrozenVector_new1(),"NAVIGATE",!1,ge.FrozenVector_new1(),!1,!0,!1,!1,1,"NONE")}static fromPrototypeAction(e,r){return e==null?t.getDefault():new t(e.transitionType(),e.transitionDuration(),e.easingFunction,e.transitionShouldSmartAnimate(),e.overlayRelativePosition(),e.navigationType(),e.transitionPreserveScroll(),e.extraScrollOffset(),e.transitionResetVideoPosition(),e.openUrlInNewTab(),e.transitionResetScrollPosition(),e.transitionResetInteractiveComponents(),r,e.animationType())}withTransitionPreserveScroll(e){return new t(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,e,this.extraScrollOffset,this.transitionResetVideoPosition,this.openUrlInNewTab,this.transitionResetScrollPosition,this.transitionResetInteractiveComponents,this.stateManagementVersion,this.animationType)}withDefaultStateManagementSettings(){return new t(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,!1,this.openUrlInNewTab,!1,!1,this.stateManagementVersion,this.animationType)}withStateManagementSettings(e){return e==null?this:new t(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,e.transitionResetVideoPosition,this.openUrlInNewTab,e.transitionResetScrollPosition,e.transitionResetInteractiveComponents,e.stateManagementVersion,e.animationType)}constructor(e,r,n,o,i,a,s,l,c,d,u,p,_,h){this.transitionType=e,this.transitionDuration=r,this.easingFunction=n,this.transitionShouldSmartAnimate=o,this.overlayRelativePosition=i,this.navigationType=a,this.transitionPreserveScroll=s,this.extraScrollOffset=l,this.transitionResetVideoPosition=c,this.openUrlInNewTab=d,this.transitionResetScrollPosition=u,this.transitionResetInteractiveComponents=p,this.stateManagementVersion=_,this.animationType=h}};function KA(t,e){return t==null&&e==null?!0:t==null||e==null?!1:t.interactionId===e.interactionId&&t.actionIndex===e.actionIndex}var Mo=class{constructor(e,r){this.interactionId=e,this.actionIndex=r}debugString(){return`[animationState] interactionId: ${this.interactionId}, actionIndex: ${this.actionIndex}`}compareTo(e,r){let n=-1,o=-1;if(r.forEach((i,a)=>{let s=i.id();s===this.interactionId&&(n=a),s===e.interactionId&&(o=a)}),!(n<0||o<0))return this.interactionId===e.interactionId?this.actionIndex-e.actionIndex:n-o}},vr=class{topId(){return this.overlays.length>0?ie.List_last(this.overlays).id:this.stateId}debugString(e){let r=a=>{let s=e.findNode(a);return`[nodeId.toString]: ${(s==null?void 0:s.name())??"null"}`},n="  ",o="[";for(let a=0,s=this.overlays.length;a<s;a=a+1){let l=this.overlays[a];o+=n+r(l.id),a!=this.overlays.length-1&&(o+=`,
`)}o+="]";let i=this.animationState?this.animationState.debugString():"";return`PresentedState(
`+n+r(this.stateId)+`,
`+n+o+i+`
)`}statesAndOverlaysIncluded(){let e=new Set;this.stateId!=null&&Q.isValid(this.stateId)&&e.add(this.stateId);for(let r of this.overlays)Q.isValid(r.id)&&e.add(r.id);return e}constructor(e,r,n=null){this.stateId=e,this.overlays=r,this.animationState=n}},on=class t{constructor(){if(arguments[0]==0){let[,e]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=rn.getDefault(),this.interactionAddress=Lo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new vr(null,[]),this.newStateAndOverlays=new vr(null,[])}else if(arguments[0]==1){let[,e,r,n]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=rn.getDefault(),this.interactionAddress=Lo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=r,this.newStateAndOverlays=n}else if(arguments[0]==2){let[,e,r,n,o,i,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=rn.getDefault(),this.interactionAddress=Lo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new vr(r,[]),this.newStateAndOverlays=new vr(n,[]),this.direction=0,this.cause=s,this.interactionAddress=o,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=i}else if(arguments[0]==3){let[,e,r,n,o,i,a,s,l]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=rn.getDefault(),this.interactionAddress=Lo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=r,this.newStateAndOverlays=n,this.direction=s,this.cause=l,this.interactionAddress=o,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=i}else if(arguments[0]==4){let[,e,r,n,o,i,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=rn.getDefault(),this.interactionAddress=Lo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=r,this.newStateAndOverlays=n,this.interactionAddress=i,this.direction=a,this.transitionParameters=s,this.cause=o}}static forClosingTopNOverlays(e,r,n,o,i,a){let l=n[n.length-e].openingTransition.withTransitionPreserveScroll(!0).withDefaultStateManagementSettings();return new t(3,ht.ROOT_STABLE_PATH(),new vr(r,n),new vr(r,n.slice(0,n.length-e)),o,i,l,1,a)}oldStateId(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.stateId}newStateId(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.stateId}oldObjectAnimationState(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.animationState}newObjectAnimationState(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.animationState}isObjectAnimation(){return this.newObjectAnimationState()!=null}isBaseScreenTransition(){return this.oldStateId()!==this.newStateId()}objectAnimationTargetNode(e){let r=this.newObjectAnimationState();if(!r)return null;let n=this.newStateId(),o=e.findNode(n);if(!o)throw new Error("Expected slide node");let i=o.objectAnimations().find(l=>l.id()===r.interactionId);if(!i)throw new Error("Could not find interaction matching the prototype state change's interaction id");if(i.actions().length===0)throw new Error("Expected interaction with at least one action");let a=r.actionIndex;if(a<0||a>=i.actions().length)throw new Error("Action index out of bounds");let s=i.actions()[a].transitionNodeID();return e.findNode(s)}canInstantlyCommit(){return this.direction==0?!1:this.transitionParameters.transitionType=="INSTANT_TRANSITION"||this.transitionParameters.animationType!="NONE"}oldOverlayData(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.overlays}newOverlayData(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.overlays}oldOverlays(e){var r;return e.bindOverlays((r=this.oldStateAndOverlays)==null?void 0:r.overlays)}newOverlays(e){var r;return e.bindOverlays((r=this.newStateAndOverlays)==null?void 0:r.overlays)}isTransientChange(e){let r=Q.equals(this.oldStateAndOverlays.stateId,this.newStateAndOverlays.stateId);switch(this.transitionParameters.navigationType){case"OVERLAY":case"SWAP":case"SCROLL_TO":return!0;default:break}return(e?rt.isForwardTransientAction(this.cause):rt.isTransientAction(this.cause))||r}debugString(e){var r,n;return`${(r=this.oldStateAndOverlays)==null?void 0:r.debugString(e)}
=>
${(n=this.newStateAndOverlays)==null?void 0:n.debugString(e)}`}easingFunction(){return this.transitionParameters.easingFunction}preserveScroll(){return this.transitionParameters.transitionPreserveScroll?1:0}resetScroll(){return this.transitionParameters.transitionResetScrollPosition?0:1}resetInteractiveComponents(){return this.transitionParameters.transitionResetInteractiveComponents?0:1}stateManagementVersion(){return this.transitionParameters.stateManagementVersion}getFramePairTransition(){let e=Vr.get(this.transitionParameters.transitionType);return this.direction==1?e.reversed():e}getNewOrChangedFrames(e){let r=[];if(!Q.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null){let n=e.findNode(this.newStateId());n!=null&&r.push(n)}for(let n=0,o=this.newOverlayData().length;n<o;n=n+1)if(n>=this.oldOverlayData().length||!Q.equals(this.oldOverlayData()[n].id,this.newOverlayData()[n].id)){let i=e.findNode(this.newOverlayData()[n].id);i!=null&&r.push(i)}return r}getInsertedFrameIds(){let e=[];!Q.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());let r=new no;this.oldOverlayData().forEach(n=>{r.add(n.id)});for(let n=0,o=this.newOverlayData().length;n<o;n=n+1){let i=this.newOverlayData()[n].id;r._in(i)||e.push(i)}return e}getRemovedFrameIds(){let e=[];!Q.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.oldStateId());let r=new no;this.newOverlayData().forEach(n=>{r.add(n.id)});for(let n=0,o=this.oldOverlayData().length;n<o;n=n+1){let i=this.oldOverlayData()[n].id;r._in(i)||e.push(i)}return e}},Ao=class t{static getDefaultExternalExecution(){return new t(Lo.EXTERNAL,rn.getDefault(),null)}static forNoodle(e,r,n){let o=new Lo(t.stablePathForHotspot(e),r.id()),i=r.action().value;if(n!=null)i=n;else for(let l of r.getAllValidTransitionActionsInInteraction()){i=l;break}let a=rn.fromPrototypeAction(i,r.stateManagementVersion()),s=r.event().interactionType()=="ON_HOVER"?e.canvasSpaceInteractiveBounds():null;return new t(o,a,s)}static forExternalOpenOverlay(e){let r=new Lo(t.stablePathForHotspot(e),Q._new(-1,-2));return new t(r,rn.getDefault(),null)}static stablePathForHotspot(e){let r=null;return r=e.stablePath(),r}constructor(e,r,n){this.interactionAddress=e,this.transitionParameters=r,this.canvasSpaceTriggerBoundsOrNull=n}};function rp(t){let e=t.slice();return e.sort((r,n)=>{let o=r.fullSizeCanvasSpaceBoundingBox(),i=n.fullSizeCanvasSpaceBoundingBox();return i.top()<=o.bottom()&&i.bottom()>=o.top()?o.x()==i.x()?pi.string_compare(r.id(),n.id()):o.x()-i.x()|0:o.y()-i.y()|0}),e}function nP(t,e){let r=[];for(let o of e){let i=t.findNode(o);i!=null&&r.push(i)}return rp(r).map(o=>o.id())}var op=(n=>(n[n.FRAME_LIST=0]="FRAME_LIST",n[n.NONLINEAR=1]="NONLINEAR",n[n.SLIDESHOW=2]="SLIDESHOW",n))(op||{}),Mm=class{constructor(e){this._appState=e}getNextBaseScreenNode(){let e=this.getNextBaseScreenId();return e?this._appState.scene().findNode(e):null}getNextObjectAnimation(){return null}getPreviousObjectAnimation(){return null}getCurrentObjectAnimation(){return this._appState.prototypeState().getCurrentAnimationState()}getNavigateForwardEnabled(){return this.getNextBaseScreenId()!=null||this.getNextObjectAnimation()!=null||this.shouldCommitInitiatedChangeOnNavigate()&&this._appState.prototypeState().getInitiatedChange()!==null}getNavigateBackwardEnabled(){return this._appState.prototypeState().getPreviousBaseScreenId()!=null||this.getCurrentObjectAnimation()!=null}shouldCommitInitiatedChangeOnNavigate(){return!1}transitionDirectionBetweenFrames(e,r){return this.navigationOrderType()!=2?0:this.compare(e,r)<=0?0:1}compare(e,r){if(e===r)return 0;let n=this.topLevelPrototypeNodesInOrder().indexOf(e),o=this.topLevelPrototypeNodesInOrder().indexOf(r);return n===-1&&o===-1?0:n-o}shouldSyncObjectAnimations(){return!1}navigationOrderTypeString(){return op[this.navigationOrderType()]}},Bm=class extends Mm{navigationOrderType(){return 1}isLinear(){return!1}getNextBaseScreenId(){let e=this._appState.prototypeState().getCurrentBaseScreenIndex(),r=this.topLevelPrototypeNodesInOrder();return e<0?null:e>=r.length-1?this._appState.prototypeState().getUpcomingTlf():Q.fromString(r[e+1])}topLevelPrototypeNodesInOrder(){return this._appState.prototypeState().getTlfHistory()}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let r=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();if(r!=null)return r;let n=Zs.visuallySortedTopLevelFrames(e);return n.length>0?n[0]:null}},Gm=class extends Mm{isLinear(){return!0}getNextBaseScreenId(){let e=this._appState.prototypeState().getCurrentBaseScreenIndex(),r=this.topLevelPrototypeNodesInOrder();return e<0||e>=r.length-1?null:Q.fromString(r[e+1])}static visuallySortedTopLevelFrames(e){if(e==null)return[];let r=[];for(let i of e.children())F().isOrContainsBaseScreen(i.id())&&r.push(i);let n=rp(r),o=[];for(let i of n)i.type()!="SECTION"?o.push(i):Wr(o,Zs.visuallySortedTopLevelFrames(i));return o}},Zs=class t extends Gm{navigationOrderType(){return 0}topLevelPrototypeNodesInOrder(){let e=this._appState.getActiveCanvas();return e==null?[]:t.visuallySortedTopLevelFrames(e).map(r=>r.id())}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let r=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();if(r!=null)return r;let n=t.visuallySortedTopLevelFrames(e);return n.length>0?n[0]:null}static visuallySortedTopLevelFrames(e){if(e==null)return[];let r=[];for(let i of e.children())F().isOrContainsBaseScreen(i.id())&&r.push(i);let n=rp(r),o=[];for(let i of n)i.type()!="SECTION"?o.push(i):Wr(o,t.visuallySortedTopLevelFrames(i));return o}},np=class extends Gm{navigationOrderType(){return 2}getNextObjectAnimation(){let e=this._appState.prototypeState().getCurrentBaseScreenNode();if(!e)return null;let r=e.objectAnimations();if(r.length==0)return null;let n=this._appState.prototypeState().getCurrentAnimationState();if(n==null)return new Mo(r[0].id(),0);{let o=r.findIndex(a=>a.id()===n.interactionId);if(o===-1)return null;let i=r[o];return n.actionIndex+1<i.getAllActions().length?new Mo(i.id(),n.actionIndex+1):o+1<r.length?new Mo(r[o+1].id(),0):null}}getPreviousObjectAnimation(){let e=this._appState.prototypeState().getCurrentBaseScreenNode();if(!e||e.objectAnimations().length==0)return null;let r=this._appState.prototypeState().getCurrentAnimationState();if(r==null)return null;{let n=e.objectAnimations().findIndex(i=>i.id()===r.interactionId);if(n===-1||n===0)return null;let o=e.objectAnimations()[n-1];return new Mo(o.id(),o.getAllActions().length-1)}}shouldCommitInitiatedChangeOnNavigate(){return!0}shouldSyncObjectAnimations(){return!0}topLevelPrototypeNodesInOrder(){let e=this._appState.getActiveCanvas();if(e==null)return[];let r=e.children().find(o=>(o==null?void 0:o.type())==="SLIDE_GRID");if(r==null)return[];let n=[];return r.forEachDescendantPreorder(o=>{o.type()=="SLIDE"&&o.isVisibleInCanvas()&&!o.isSkippedSlide()&&n.push(o)}),n.map(o=>o.id())}nodeToRestartPrototypeOn(e){let r=this.topLevelPrototypeNodesInOrder();return r.length>0?this._appState.scene().findNode(Q.fromString(r[0])):null}};var od=class t{constructor(e,r,n,o,i,a,s){this.id=null,this.overlayDataModelId=null,this.openingHotspotStablePath=null,this.openingInteractionId=null,this.openingTransition=null,this.oldOverlayDerivedModes=null,this.newOverlayExplicitModes=null,this.id=e,this.overlayDataModelId=r,this.openingHotspotStablePath=n,this.openingInteractionId=o,this.openingTransition=i,this.oldOverlayDerivedModes=a,this.newOverlayExplicitModes=s}cloneWithId(e,r){return new t(e,this.overlayDataModelId,this.openingHotspotStablePath,this.openingInteractionId,this.openingTransition,r)}openingTransitionType(){return this.openingTransition.transitionType}},id=class{constructor(e,r,n,o,i,a,s,l){this.overlayId=e,this.overlayNode=r,this.bounds=n,this.baseTlfCursor=o,this.backgroundAppearance=i,this.backgroundTransitionProgress=a,this.transform=s,this.animationTransform=l}},ps=class{constructor(e=new Map){this._hasTransitionComputed=!1;this._hasTransition=!1;this._multiOverlayMap=e}hasTransition(){if(this._hasTransitionComputed)return this._hasTransition;for(let e of Array.from(this._multiOverlayMap.keys()))if(this._multiOverlayMap.get(e).backgroundTransitionProgress!=null||this._multiOverlayMap.get(e).transform!=null||this._multiOverlayMap.get(e).animationTransform!=null){this._hasTransition=!0,this._hasTransitionComputed=!0;break}return this._hasTransition}count(){return this._multiOverlayMap.size}addEntry(e,r){this._multiOverlayMap.set(e,r),this._hasTransitionComputed=!1}removeEntry(e){this._multiOverlayMap.delete(e),this._hasTransitionComputed=!1}get(e){return Qe.StringMap_get(this._multiOverlayMap,e,null)}keys(){return Array.from(this._multiOverlayMap.keys())}overlayCacheKey(){let e=[];for(let r of this.keys())e.push(r);return new ht(e)}},ip=class{id(){return this._data.id}overlayDataModelId(){return this._data.overlayDataModelId}openingHotspotStablePath(){return this._data.openingHotspotStablePath}previousOverlay(){return this._previousOverlay}openingTransitionType(){return this._data.openingTransitionType()}node(){return this.scene.findNode(this.id())}backgroundInteraction(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?"NONE":e.overlayBackgroundInteraction()}backgroundAppearance(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?new la:e.overlayBackgroundAppearance()}positionType(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?"CENTER":e.overlayPositionType()}relativePosition(){return this._data.openingTransition.overlayRelativePosition}renderedOrigin(e){let r=this.node();if(r==null)return ge.FrozenVector_new1();let n=null;if(this.positionType()=="MANUAL"){if(this._stackPosition>0){let i=this.scene.findNode(this._previousOverlay.id()).canvasSpaceBoundingBox(),a=this._previousOverlay.renderedOrigin(e),s=this.scene.findNodeByStablePath(this.openingHotspotStablePath());s!=null&&(n=s.canvasSpaceScrolledBounds(1).topLeft().add(a.subtract(i.topLeft())))}if(n==null){let o=this.scene.findNodeByStablePath(this.openingHotspotStablePath());o!=null&&(n=o.canvasSpaceScrolledBounds(1).topLeft())}if(n==null)return ge.FrozenVector_new1()}return ap.BoundOverlay_computeOrigin(r,e,this._data.openingTransition,n,this.positionType())}renderedBounds(e){let r=this.scene.findNode(this._data.id);if(r==null)return Gr.FrozenRect_new1();let n=r.canvasSpaceBoundingBox().size(),o=this.renderedOrigin(e);return Gr.FrozenRect_new4(o.x(),o.y(),n.x(),n.y())}deltaFromRenderedPositionToCanvasSpacePosition(e){let r=this.scene.findNode(this._data.id);return r==null?new O(0,0):this.renderedOrigin(e).subtract(r.canvasSpaceBoundingBox().topLeft())}baseTlfSpaceToOverlaySpace1(e,r){let n=this.scene.findNode(this._data.id);if(n==null||r==null||e==null)return ge.FrozenVector_ZERO;let o=this.renderedOrigin(e),i=n.canvasSpaceBoundingBox().topLeft();return r.add(i).subtract(o)}baseTlfSpaceToOverlaySpace2(e,r){return x.new4(this.baseTlfSpaceToOverlaySpace1(e,r.topLeft()),r.size())}overlaySpaceToBaseTlfSpace1(e,r){let n=this.baseTlfSpaceToOverlaySpace1(e,r);return r.add(r.subtract(n))}overlaySpaceToBaseTlfSpace2(e,r){return x.new4(this.overlaySpaceToBaseTlfSpace1(e,r.topLeft()),r.size())}constructor(e,r,n,o){this.scene=e,this._data=r,this._previousOverlay=n,this._stackPosition=o}},ap;(r=>{function t(n,o,i,a,s){if(n==null)return O.new();let l=n.canvasSpaceBoundingBox().size();if(s=="MANUAL")return new O(a.x()+i.overlayRelativePosition.x(),a.y()+i.overlayRelativePosition.y());{let c=o.canvasSpaceBoundingBox(),d=c.topLeft(),u=c.size(),p=d.x();switch(s){case"TOP_LEFT":case"BOTTOM_LEFT":break;case"TOP_CENTER":case"CENTER":case"BOTTOM_CENTER":{p+=u.x()/2-l.x()/2;break}case"TOP_RIGHT":case"BOTTOM_RIGHT":{p+=u.x()-l.x();break}}let _=d.y();switch(s){case"TOP_LEFT":case"TOP_CENTER":case"TOP_RIGHT":break;case"CENTER":{_+=u.y()/2-l.y()/2;break}case"BOTTOM_LEFT":case"BOTTOM_CENTER":case"BOTTOM_RIGHT":{_+=u.y()-l.y();break}}return new O(p,_)}}r.BoundOverlay_computeOrigin=t;function e(n,o,i,a,s){let l=n.canvasSpaceBoundingBox().size(),c=t(n,o,i,a,s);return Gr.FrozenRect_new4(c.x(),c.y(),l.x(),l.y())}r.BoundOverlay_computeNewBounds=e})(ap||(ap={}));function oP(t){return t==="ON_HOVER"||t==="ON_PRESS"}var Fn=class t{static isNodeInteractableBecauseOfHyperlinks(e){return e.type()=="TEXT"&&e.textHyperlinkBoxes().length>0}static isPrototypeActionInteractableBecauseOfConnection(e){return e.connectionURL()!=null||e.connectionType()=="BACK"||e.connectionType()=="CLOSE"||e.connectionType()=="SET_VARIABLE"||e.connectionType()=="SET_VARIABLE_MODE"||e.connectionType()=="UPDATE_MEDIA_RUNTIME"||e.connectionType()=="CONDITIONAL"}static cleanedInteractionsForNode(e,r){if(r==null)return[];let n=r.prototypeInteractions();return this.cleanedInteractionsForNodeFromDirtyInteractions(e,r,n)}static cleanedUpTransitionDestinationId(e,r,n,o,i){return F().modules().prototype.cleanedUpTransitionDestination(e!=null?e.handle():-1,r,n,Ve().NavigationType[o],Ve().ConnectionType[i])}static cleanedInteractionsForNodeFromDirtyInteractions(e,r,n){let o=[];if(r==null||n==null)return o;for(let i=0,a=n.length;i<a;i=i+1){let s=n[i];if(s.actions()==null||s.actions().length==0)continue;let l=[];for(let c=0,d=s.actions().length;c<d;c=c+1){let u=s.actions()[c],p=null;if(Q.isValid(u.transitionNodeID())){let _=e.getActiveCanvas(),h=t.cleanedUpTransitionDestinationId(_,r==null?void 0:r.id(),u.transitionNodeID(),u.navigationType(),u.connectionType());h!==null&&h!=null&&(p=u.withTransitionNodeID(h))}else r.isVisibleInCanvas()&&t.isPrototypeActionInteractableBecauseOfConnection(u)&&(p=u);p!=null&&l.push(p)}l.length!=0&&o.push(s.withActions(l))}return o.length==0&&t.isNodeInteractableBecauseOfHyperlinks(r)&&o.push(t.createFakeHyperlinkInteraction()),o}static createFakeHyperlinkInteraction(){let e=new po("ON_CLICK",null,null,{},null,null),r=dr.NULL_ACTION.withConnectionType("URL").withConnectionURL("HYPERLINK");return new $t(Q.invalid(),e,[r],!1,0)}};var sp=class{constructor(e){this._noodleMap=new Da,this._cachedCleanedUpTransitionMapByTlf=null,this._scene=null,this._appState=null,this.triggerPotentialTimedTransition=null,this.triggerPotentialTimedTransitionForSpecificRootNode=null,this.createVideoTriggerEventsForNodesInFrame=null,this.createVideoTriggerEventsForAllNodesOnscreen=null,this._topmostScreenChangeCounter=0,this._appState=e,this._appState.addAppObserver(this)}_setPrototypeInteractionsInNoodleMap(e,r){r.some(o=>o.isValid())?this._noodleMap.update(e,r):this._noodleMap.update(e,[])}getStateGroupStateSwapInteractionCounts(){return this._noodleMap.stateGroupStateSwapInteractionCounts}_setHyperlinkInteractionInNoodleMap(e){if(Fn.isNodeInteractableBecauseOfHyperlinks(e)){let r=Fn.createFakeHyperlinkInteraction();this._setPrototypeInteractionsInNoodleMap(e,[r])}}cleanedUpMediaEndInteractionMap(){return this.cleanedUpInteractionMapForPrefilteredType(2)}cleanedUpMediaHitInteractionMap(){return this.cleanedUpInteractionMapForPrefilteredType(3)}cleanedUpInteractionMapForPrefilteredType(e){return new Da.CleanedMap(this._noodleMap,e,r=>{var i,a;let n=(i=this._scene)==null?void 0:i.findNode(r),o=(a=this._noodleMap.noodleNodes.get(r,null))==null?void 0:a.prefilteredInteractionsByType.get(e);return Fn.cleanedInteractionsForNodeFromDirtyInteractions(this._appState,n,o==null?void 0:o.asList())})}cleanedUpInteractionMap(){return new Da.CleanedMap(this._noodleMap,0,e=>{var n;let r=(n=this._scene)==null?void 0:n.findNode(e);return Fn.cleanedInteractionsForNode(this._appState,r)})}cleanedUpTransitionMap(){return new Da.CleanedMap(this._noodleMap,1,e=>{let r=[];return this.cleanedUpInteractionMap().getHotspotInteractions(e).forEach(n=>{n.interactionContainsTransitionAction()&&r.push(n)}),r})}cleanedUpTransitionMapByTLF(){if(this._cachedCleanedUpTransitionMapByTlf==null){let e=new No(r=>r);for(let r of this.cleanedUpTransitionMap().hotspots()){let n=this._scene.findNode(r);if(n!=null){let o=null,i=n.topLevelAncestor();i!=null&&i.visible()&&(o=i.id()),o!=null&&(e._in(o)||e.set(o,[]),Wr(e.get(o),this.cleanedUpTransitionMap().getHotspotInteractions(r).slice()))}}this._cachedCleanedUpTransitionMapByTlf=e}return this._cachedCleanedUpTransitionMapByTlf}rawInteractionMapForTests(){return new Da.RawMapForTests(this._noodleMap)}handleSceneChange(e,r){this._scene=r,e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this)}handleActiveCanvasChange(e,r){this._noodleMap.noodleNodes.clear(),this._noodleMap.stateGroupStateSwapInteractionCounts.clear(),this._noodleMap.guidsForPrefilterType.forEach(n=>n.clear()),this._noodleMap.queuedInteractionChanges=[],r!=null&&this._addConnectionsFromSubtree(r),this._cachedCleanedUpTransitionMapByTlf=null}handleActivePrototypeStartingPointChange(e,r){}_addConnectionsFromSubtree(e){this._setPrototypeInteractionsInNoodleMap(e,e.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e);for(let r=0,n=e.childCount();r<n;r=r+1){let o=e.childAt1(r);this._addConnectionsFromSubtree(o)}}_removeConnectionsFromSubtree(e){this._noodleMap.update(e,[]);for(let r=0,n=e.childCount();r<n;r=r+1)this._removeConnectionsFromSubtree(e.childAt1(r))}topmostScreenChangeCounter(){return this._topmostScreenChangeCounter}handleSceneGraphEvent(e){let r=!1;if((mo.isInteractionProperty(e.property)||mo.affects(e.property,90)||mo.affects(e.property,91))&&(e.node.isRooted()&&(this._setPrototypeInteractionsInNoodleMap(e.node,e.node.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e.node),r=!0),Q.equals(this._appState.baseScreenId(),e.node.id())&&e.node.prototypeInteractions().forEach(n=>{this._topmostScreenChangeCounter=this._topmostScreenChangeCounter+1,n.event().interactionType()=="AFTER_TIMEOUT"?this.triggerPotentialTimedTransition!=null&&this.triggerPotentialTimedTransition():(n.event().interactionType()=="ON_MEDIA_HIT"||n.event().interactionType()=="ON_MEDIA_END")&&this.createVideoTriggerEventsForAllNodesOnscreen!=null&&this.createVideoTriggerEventsForAllNodesOnscreen()})),e.property==8||e.property==9||e.property==14||e.property==89)r=!0,this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node),this._noodleMap.invalidateHotspotAndChildren(e.node);else if(e.property==32){let n=e.oldVal!=null&&ot.isParentIndex(e.oldVal)?ot.asParentIndex(e.oldVal):null,o=e.newVal!=null&&ot.isParentIndex(e.newVal)?ot.asParentIndex(e.newVal):null,i=n!=null?e.node.scene().findNode(n.id):null,a=o!=null?e.node.scene().findNode(o.id):null,s=i!=null&&i.isRooted(),l=a!=null&&a.isRooted();s&&!l?(this._removeConnectionsFromSubtree(e.node),r=!0):!s&&l&&(this._addConnectionsFromSubtree(e.node),r=!0,this.createVideoTriggerEventsForNodesInFrame!=null&&this.createVideoTriggerEventsForNodesInFrame(e.node)),s&&l&&i.id()!=a.id()&&(r=!0),this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node)}e.property==8&&this.triggerPotentialTimedTransitionForSpecificRootNode!=null&&this.triggerPotentialTimedTransitionForSpecificRootNode(e.node),r&&(this._cachedCleanedUpTransitionMapByTlf=null)}};var Um=class{invalidateCaches(){this.caches.set(0,null),this.caches.set(1,null),this.caches.set(2,null),this.caches.set(3,null)}constructor(){this.interactions=new Ui(e=>e.id()),this.backReferences=new No(e=>e),this.caches=new Map([[0,null],[1,null],[2,null],[3,null]]),this.prefilteredInteractionsByType=new Map}},YA=new Map([[3,t=>t.event().interactionType()=="ON_MEDIA_HIT"],[2,t=>t.event().interactionType()=="ON_MEDIA_END"]]);var Da=class{constructor(){this.queuedInteractionChanges=[];this.noodleNodes=new No(e=>e),this.stateGroupStateSwapInteractionCounts=new No(e=>e),this.guidsForPrefilterType=new Map([[2,new Ui(e=>e)],[3,new Ui(e=>e)]])}update(e,r){var i,a,s;let n=((a=(i=this.noodleNodes.get(e.id(),null))==null?void 0:i.interactions)==null?void 0:a.asList())??[];for(let l=0,c=n.length;l<c;l=l+1){let d=n[l];this._eraseInteraction(e,d)}for(let l=0,c=r.length;l<c;l=l+1){let d=r[l];this._addInteraction(e,d)}let o=this.noodleNodes.get(e.id(),null);if(o!=null&&o.interactions.count()==0&&o.backReferences.count()==0){for(let l of YA.keys())(s=this.guidsForPrefilterType.get(l))!=null&&s._in(e.id())&&we("Removing noodleNode which is still referenced in guidsForPrefilterType");this.noodleNodes.remove(e.id())}}_updateStateGroupSwapInteractionCounts(e,r,n){if(K.shouldPreventVolatileCaching())return;let o=e.getBackingSymbolParent();if(!(!o||!o.isStateGroup())){for(let i of r.allActions())if(i.navigationType()=="SWAP_STATE"){let a=this.stateGroupStateSwapInteractionCounts.get(o.id(),0),s=n?1:-1;this.stateGroupStateSwapInteractionCounts.set(o.id(),a+s)}}}_processQueuedInteractionChanges(){for(;this.queuedInteractionChanges.length>0;){let e=this.queuedInteractionChanges[0];switch(e.change){case 0:this._updatePrefilteredInteractionsForAddedInteraction(e.interaction,e.guid);case 1:this._updatePrefilteredInteractionsForRemovedInteraction(e.interaction,e.guid)}this.queuedInteractionChanges.shift()}}_addInteraction(e,r){let n=e.id(),o=this.noodleNodes.get(n,null)??new Um;this.noodleNodes.set(n,o),o.interactions.add(r);for(let i of r.allActions()){let a=i.transitionNodeID();if(iP(a,i.connectionType())){let s=this.noodleNodes.get(a,null);s==null&&(s=new Um,this.noodleNodes.set(a,s)),s.backReferences.set(n,s.backReferences.get(n,0)+1)}}o.invalidateCaches(),this._updateStateGroupSwapInteractionCounts(e,r,!0),K?K.viewerCreateVideoTriggersOpt()?(this._processQueuedInteractionChanges(),this._updatePrefilteredInteractionsForAddedInteraction(r,n)):this.queuedInteractionChanges=[]:this.queuedInteractionChanges.push({interaction:r,guid:n,change:0})}_updatePrefilteredInteractionsForAddedInteraction(e,r){let n=this.noodleNodes.get(r,null);e!=null&&n!=null&&YA.forEach((o,i)=>{if(o(e)){let a=n.prefilteredInteractionsByType.get(i)??new Ui(s=>s.id());n.prefilteredInteractionsByType.set(i,a),a.add(e),this.guidsForPrefilterType.get(i).add(r)}})}_eraseInteraction(e,r){let n=e.id(),o=this.noodleNodes.get(n,null);o!=null&&o.interactions.remove(r);for(let i of r.allActions()){let a=i.transitionNodeID();if(iP(a,i.connectionType())){let s=this.noodleNodes.get(a,null);s!=null&&(s.backReferences.set(n,s.backReferences.get(n)-1),s.backReferences.get(n)<=0&&s.backReferences.remove(n))}}o.invalidateCaches(),this._updateStateGroupSwapInteractionCounts(e,r,!1),K?K.viewerCreateVideoTriggersOpt()?(this._processQueuedInteractionChanges(),this._updatePrefilteredInteractionsForRemovedInteraction(r,n)):this.queuedInteractionChanges=[]:this.queuedInteractionChanges.push({interaction:r,guid:n,change:1})}_updatePrefilteredInteractionsForRemovedInteraction(e,r){let n=this.noodleNodes.get(r,null);if(e!=null&&n!=null)for(let o of YA.keys()){let i=n.prefilteredInteractionsByType.get(o);i==null||i.remove(e),(!i||(i==null?void 0:i.count())<1)&&this.guidsForPrefilterType.get(o).remove(r)}}invalidateHotspotAndChildren(e){kn(e,r=>(this.noodleNodes._in(r.id())&&this.noodleNodes.get(r.id()).invalidateCaches(),0))}invalidateBackRefsForDestinationAndChildren(e){kn(e,r=>(this.noodleNodes._in(r.id())&&this.noodleNodes.get(r.id()).backReferences.each((o,i)=>{this.noodleNodes.get(o).invalidateCaches()}),0))}};(r=>{class t{_in(o){return this.noodleMap.noodleNodes._in(o)&&this.getHotspotInteractions(o).length!=0}hotspots(){return this.noodleMap.noodleNodes.keys().filter(o=>this.getHotspotInteractions(o).length!=0)}getHotspotInteractions(o){return this.noodleMap.noodleNodes.get(o).interactions.asList()}constructor(o){this.noodleMap=o}}r.RawMapForTests=t;class e{_in(o){return this.noodleMap.noodleNodes._in(o)?this.getHotspotInteractions(o).length!=0:!1}hotspots(){return this.cacheType===2||this.cacheType===3?this.noodleMap.guidsForPrefilterType.get(this.cacheType).asList().filter(o=>this.noodleMap.noodleNodes.get(o)==null?(we("GUID in guidsForPrefilterType not in noodleNodes"),!1):this.getHotspotInteractions(o).length!=0):this.noodleMap.noodleNodes.keys().filter(o=>this.getHotspotInteractions(o).length!=0)}getHotspotInteractions(o){let i=this.noodleMap.noodleNodes.get(o);return i.caches.get(this.cacheType)==null&&i.caches.set(this.cacheType,this.computeCacheForHotspot(o)),i.caches.get(this.cacheType)}constructor(o,i,a){this.noodleMap=o,this.cacheType=i,this.computeCacheForHotspot=a}}r.CleanedMap=e})(Da||(Da={}));function iP(t,e){return t!=null&&Q.isValid(t)&&(e=="INTERNAL_NODE"||e=="UPDATE_MEDIA_RUNTIME")}var Ci=class{constructor(e,r=null){this.node=e,this.hyperlink=r}canvasSpaceScrolledInteractiveBounds(e){let r=this.node.canvasSpaceScrolledInteractiveBounds(e);return this.hyperlink!=null?Gr.FrozenRect_new4(this.hyperlink.bounds.x+r.x(),this.hyperlink.bounds.y+r.y(),this.hyperlink.bounds.w,this.hyperlink.bounds.h):r}},Vm=class{asScreen(){return null}asSmartAnimate(){return null}constructor(){}},an=class t extends Vm{asScreen(){return this}hash(){let e=`${this.nodeId}-${t.FrameRole[this.role]}`;return this.role==t.FrameRole.OVERLAY?e+`-${this.overlayStackPosition}`:e}static forBaseScreen(e){return new t(e,t.FrameRole.BASE_SCREEN,0,null,null)}static forOverlay(e,r,n,o){return new t(e,t.FrameRole.OVERLAY,r,n,o)}constructor(e,r,n,o,i){super(),this.nodeId=e,this.role=r,this.overlayStackPosition=n,this.prototypeAction=o,this.precedingOverlays=i}};(e=>{let t;(o=>(o[o.BASE_SCREEN=0]="BASE_SCREEN",o[o.OVERLAY=1]="OVERLAY"))(t=e.FrameRole||(e.FrameRole={}))})(an||(an={}));var QA=class extends Vm{asSmartAnimate(){return this}hash(){return`Smart animate ${this.srcNodeId} -> ${this.dstNodeId} w/ ${this.transitionType}`}constructor(e,r,n,o,i){super(),this.srcNodeId=e,this.dstNodeId=r,this.role=n,this.transitionType=o,this.easingFunction=i}},lp;(e=>{function t(r,n){if(n=="URL"){if(r!="ON_CLICK"&&r!="MOUSE_UP")return!1}else if(n=="BACK"&&oP(r))return!1;return!0}e.isValidForConnection=t})(lp||(lp={}));var km=class km{constructor(e){this._nodeTransitionTracker=null,this._appState=null,this._emitter=null,this._cachedPrerenderJobList=[],this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1,this._appState=e,this._emitter=Ht.getEventEmitter(),this._appState.addAppObserver(this),this._appState.prototypeState().addObserver(this),this._nodeTransitionTracker=new sp(e),this._appState.addFrameObserver(this)}nodeTransitionTracker(){return this._nodeTransitionTracker}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActiveCanvasChange(e,r){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActivePrototypeStartingPointChange(e,r){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleSceneGraphEvent(e){if(mo.isPrototypeStructuralChange(e.property)||e.property==14||e.property==89||e.property==9||e.property==30){this._cachedPrerenderJobList=null;let r=this._appState.prototypeState();r.isApplyingStateChangeMutation()||r.isResettingStateChangeMutations()||(this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0)}}onFrame(){this._shouldNotifyTopLevelPrototypeNodesInvalidated&&(this._emitter.trigger("topLevelFramesListInvalidated"),this._emitter.trigger("navigationInfoInvalidated"),this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1)}handleStateChangeAborted(e){this._cachedPrerenderJobList=null}handleStateChangeCommitted(e,r){}handleStateChangeInitiated(e){this._cachedPrerenderJobList=null}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){}_scene(){return this._appState.scene()}_baseScreenId(){return this._appState.prototypeState().getCurrentBaseScreenId()}getPrerenderingJobs(e){return this._cachedPrerenderJobList==null&&(this._cachedPrerenderJobList=this.computePrerenderJobsForStartNode(this._baseScreenId(),km.MAX_PRERENDER_JOB_COUNT)),this._cachedPrerenderJobList}navigationOrder(){switch(this._appState.editorType()){case"SLIDES":return new np(this._appState);default:return this.topLevelPrototypeStartingPointNodeIdsSorted().length>0||K.getViewerMode()==K.ViewerMode.MIRROR?new Bm(this._appState):new Zs(this._appState)}}navigationOrderType(){return this.navigationOrder().navigationOrderType()}isLinear(){return this.navigationOrder().isLinear()}activePrototypeStartNodeOrDefault(){if(this._scene()==null)return null;let e=this._appState.activePrototypeStartingPointNodeId();if(e!=null){let n=this._scene().findNode(e);if(n!=null&&n.visible())return n}let[r]=this.topLevelPrototypeStartingPointNodeIdsSorted();return r?this._scene().findNode(Q.fromString(r)):null}nodeToRestartPrototypeOn(e){return this.navigationOrder().nodeToRestartPrototypeOn(e)}getDestinationFrame(e){var o,i,a;let r=(o=this._scene())==null?void 0:o.findNode(e);if(r==null)return null;let n=s=>{let l="",c=s.children().find(d=>d.isValidTLFType())||null;if(c==null){if(c=this._appState.prototypeState().getOrSetRestartPrototypeNode(),c==null)return{lastFrame:c,lastFrameOrSectionID:l};l=c.id()}else l=c.id();return{lastFrame:c,lastFrameOrSectionID:l}};if(r.type()=="SECTION"){let s=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(r.id()),l=(i=this._scene())==null?void 0:i.findNode(s);if(l==null){let c=n(r);l=c.lastFrame,s=c.lastFrameOrSectionID}if((l==null?void 0:l.type())=="SECTION"){let c;for(;!(l!=null&&l.isValidTLFType());)if(s=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(s),c=l,l=(a=this._scene())==null?void 0:a.findNode(s),l==null){let d=n(c);l=d.lastFrame,s=d.lastFrameOrSectionID}}return l}return r}validDestinationForPrototypeFromId(e){let r=this.getDestinationFrame(e);return r==null||!r.isTopLevel()||!r.isVisibleInCanvas()||r.isStateGroup()||r.isGroup()||r.isSkippedSlide()||Qt.isImmutableFrame(r.type())?null:r}topLevelPrototypeNodesInOrder(){return this.navigationOrder().topLevelPrototypeNodesInOrder()}topLevelPrototypeStartingPointNodeIdsSorted(){let e=this._appState.getActiveCanvas();return e==null?[]:F().topLevelPrototypeStartingPointsSorted(e.id())}prototypeStartingPointsData(){let e=this._appState.getActiveCanvas();return e==null||e.type()!="CANVAS"?null:F().topLevelPrototypeStartingPointsSorted(e.id()).map(n=>{let o=this._scene().findNode(n);if(o)return{id:o.id(),name:o.prototypeStartingPoint().name,description:o.prototypeStartingPoint().description}}).filter(Boolean)}prerenderJobsForBaseScreen(){return this.prerenderJobsAfter(an.forBaseScreen(this._baseScreenId()))}prerenderJobsAfter(e){var a;let r=(a=this._scene())==null?void 0:a.findNode(e.nodeId);if(r==null)return[];let n=new Map,o=[],i=s=>{n.has(s.hash())||(n.set(s.hash(),!0),o.push(s))};if(e.role==0){let s=this.topLevelPrototypeNodesInOrder(),l=s.indexOf(e.nodeId);if(l!=-1){let c=l+1,d=null;c<s.length?d=Q.fromString(s[c]):d=this._appState.prototypeStructure().navigationOrder().getNextBaseScreenId(),d!=null&&i(an.forBaseScreen(d))}}return this.forTransitionInFrame(r,s=>{for(let l of s.allActions()){if(l==null||!Q.isValid(l.transitionNodeID()))return!0;let c=l.transitionType(),d=!1;if(l.navigationType()=="SWAP_STATE")return!0;if(e.role==0&&(c=="SMART_ANIMATE"||zn.supportsSmartAnimate(c)&&l.transitionShouldSmartAnimate())&&(d=!0),e.role==1&&c=="SMART_ANIMATE"&&l.navigationType()=="SWAP"&&(d=!0),d&&i(new QA(r.id(),l.transitionNodeID(),e.role,c,l.easingFunction)),l.navigationType()=="NAVIGATE"){i(an.forBaseScreen(l.transitionNodeID()));let u=this._scene().findNode(l.transitionNodeID());u!=null&&u.setUsedAsBaseScreen(!0)}else if(l.navigationType()=="OVERLAY"){let u=e.precedingOverlays!=null?e.precedingOverlays.slice():[];u.push(l.transitionNodeID()),i(an.forOverlay(l.transitionNodeID(),e.overlayStackPosition+1,l,u));let p=this._scene().findNode(l.transitionNodeID());p!=null&&p.setUsedAsBaseScreen(!1)}else if(l.navigationType()=="SWAP"){if(e.role==1){let u=e.precedingOverlays!=null?e.precedingOverlays.slice():null;u!=null&&(u[u.length-1]=l.transitionNodeID()),i(an.forOverlay(l.transitionNodeID(),e.overlayStackPosition,l,u))}else i(an.forBaseScreen(l.transitionNodeID()));this._scene().findNode(l.transitionNodeID()).setUsedAsBaseScreen(e.role==0)}}return!0}),o}prerenderJobForPreviousNode(){return this.prerenderJobForNodeBefore(this._baseScreenId())}prerenderJobForNodeBefore(e){var i;if(((i=this._scene())==null?void 0:i.findNode(e))==null)return null;let n=this.topLevelPrototypeNodesInOrder(),o=n.indexOf(e);if(o!=-1){let a=o-1;if(a>=0)return an.forBaseScreen(Q.fromString(n[a]))}return null}computePrerenderJobsForStartNode(e,r){if(e==null)return[];let n=[an.forBaseScreen(e)],o=[an.forBaseScreen(e)],i=new Map,a=0;for(i.set(n[0].hash(),!0);a<n.length;){let s=n[a],l=[],c=this.prerenderJobForNodeBefore(s.nodeId);if(c!=null&&l.push(c),Wr(l,this.prerenderJobsAfter(s)),l.forEach(d=>{if(o.length<r&&!i.has(d.hash())){let u=d.asScreen();u!=null&&n.push(u),o.push(d),i.set(d.hash(),!0)}}),n.length==r)break;a=a+1}return o}forTransitionInFrame(e,r){let n=this._nodeTransitionTracker.cleanedUpTransitionMapByTLF();if(n._in(e.id())){let o=n.get(e.id());for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];if(!r(s))return}}}forInteractionInFrame(e,r){this.forInteractionInFrames([e],r)}getInteractionsGroupedByType(e){let r=this._nodeTransitionTracker.cleanedUpInteractionMap(),n={};for(let o of r.hotspots()){let i=this._scene().findNode(o);if(i!=null)for(let a of e)a!=null&&a.isAncestorOf(i)&&r.getHotspotInteractions(o).forEach(s=>{let l=s.event().interactionType().toString();n[l]||(n[l]=[]),n[l].push({node:i,interaction:s})})}return n}static getNodeInteractionPairs(e,r){if(r!==null)return r[e]||[]}forInteractionInFrames(e,r){let n=this._nodeTransitionTracker.cleanedUpInteractionMap();for(let o of n.hotspots()){let i=this._scene().findNode(o);if(i!=null)for(let a of e)a!=null&&a.isAncestorOf(i)&&n.getHotspotInteractions(o).forEach(s=>{r(i,s)})}}forHotspotInMap(e,r){for(let n of Array.from(e.keys())){let o=this._scene().findNode(n);if(o!=null){let i=!1;if(Fn.isNodeInteractableBecauseOfHyperlinks(o)){for(let a of e.get(n))for(let s of a.allActions())if(s.connectionURL()=="HYPERLINK"){for(let l of o.textHyperlinkBoxes())r(new Ci(o,l)),i=!0;break}}i||r(new Ci(o))}}}findPrototypeInteractionWithId(e,r){if(!this._scene())return null;let n=this._scene().findNode(e),o=Fn.cleanedInteractionsForNode(this._appState,n);for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];if(s.id()==r)return s}return null}findPrototypeInteractionsWithTransition(e,r){let n=this._scene().findNode(e),o=Fn.cleanedInteractionsForNode(this._appState,n),i=[];return o.forEach(a=>{for(let s of a.getAllValidTransitionActionsInInteraction())if(s!=null&&s.transitionNodeID()==r){i.push(a);break}}),i}findPrototypeInteractionsWithInteractionType(e,r){let n=Fn.cleanedInteractionsForNode(this._appState,e);if(n.length==0)return n;let o=[],i=[];return n.forEach(a=>{a.event().interactionType()==r&&(a.action()!=null&&a.action().value.navigationType()=="SWAP_STATE"&&a.action().value.connectionType()=="INTERNAL_NODE"?i.push(a):o.push(a))}),e.isInstanceSublayer()&&i.sort((a,s)=>{var d,u;let l=$t.whichInstanceToSwap(e,(d=a.action())==null?void 0:d.value.transitionNodeID()).stablePath(),c=$t.whichInstanceToSwap(e,(u=s.action())==null?void 0:u.value.transitionNodeID()).stablePath();return l.guids.length<c.guids.length?-1:1}),Wr(o,i),o}findHotspotsWithInteractionFilter(e,r,n,o){return this.findHotspotsWithNoodleFilter(e,r,(i,a)=>n(a),o)}findHotspotsWithInteractionFilterWithinMultipleNodes(e,r,n){return this.findHotspotsWithNoodleFilterWithinMultipleNodes(e,r,(o,i)=>n(i))}findHotspotsWithNoodleFilter(e,r,n,o){let i=[];return e==null?i:this.findHotspotsWithNoodleFilterWithinMultipleNodes(new Set([e]),r,n,o)}findHotspotsWithNoodleFilterWithinMultipleNodes(e,r,n,o){let i=[];if(e==null||e.size==0)return i;let a=new Map,s=(l,c)=>{!n(l,c)||!c.allActions().some(u=>lp.isValidForConnection(c.event().interactionType(),u.connectionType()))||(a.has(l.id())||a.set(l.id(),[]),a.get(l.id()).push(c))};if(o)for(let l of o)s(l.node,l.interaction);else this.forInteractionInFrames(Array.from(e.values()),s);return this.forHotspotInMap(a,l=>{(r==0||!e.has(l.node))&&i.push(l)}),i.sort((l,c)=>l.node.isAboveInLayerOrder(c.node)?-1:1),i}findHotspotsWithInteractionType(e,r,n,o){return this.findHotspotsWithInteractionFilter(e,r,i=>i.event().interactionType()==n,o)}findAllHotspots(e,r){return this.findHotspotsWithInteractionFilter(e,r,n=>!0)}hotspotOnPresentedNode(e,r,n,o){let i=n!="MOUSE_OUT"&&n!="MOUSE_LEAVE",a=this._appState.prototypeStructure().findHotspotsWithInteractionType(e,0,n,o),s=null;for(let l of a)l.canvasSpaceScrolledInteractiveBounds(0).contains2(r)==i&&(s==null||l.node.isAboveInLayerOrder(s.node))&&(s=l);return s}static adjacentBaseScreens(e,r){let n=r.scene(),o=new Ui(s=>s),i=null,a=new no;return i=s=>{if(s==null||a._in(s.id())||!e._in(s.id()))return;a.add(s.id());let l=e.get(s.id());for(let c=0,d=l.length;c<d;c=c+1){let u=l[c];for(let p of u.allActions()){if(p==null||!Q.isValid(p.transitionNodeID()))continue;let _=n.findNode(p.transitionNodeID());if(_==null){we("null destination when finding reachable TLFs?");continue}let h=p.connectionType()!="UPDATE_MEDIA_RUNTIME"&&p.connectionType()!="SET_VARIABLE"&&p.connectionType()!="SET_VARIABLE_MODE";p.navigationType()=="NAVIGATE"&&h||p.navigationType()=="SWAP"&&Q.equals(s.id(),r.id())?o.add(_.id()):(p.navigationType()=="OVERLAY"||p.navigationType()=="SWAP")&&i(_)}}},i(r),o}};km.MAX_PRERENDER_JOB_COUNT=10;var sn=km;var hs=class t{constructor(e){this.VERBOSE_LOGS=!1,this._observers=new dn,this._isNotifyingStateChangeObservers=!1,this._interactionsEnabled=!0,this._disengageObservationOnClick=!0,this._disableNewStateChanges=!1,this._currentFitMode="none",this._currentContentScalingMode="fixed",this._isDragging=!1,this._actionCounter=0,this._transitionOnClick=!0,this._changeHistory=[],this._changeHistoryBeforeNodeChanges=[],this._initiatedChange=null,this._initiatedChangeBeforeNodeChanges=null,this._initiatedHistory=null,this._lastInitiatedTopLevelStateChange=null,this._baseScreenWasValidDestinationBeforeNodeChanges=!1,this._ongoingNavigateRepairsInvalidState=!1,this._shouldNotifyNavigationInfoInvalidated=!1,this._tlfHistory=[],this._upcomingTlfs=new Set,this._guidToVideoStateChangeMap=new Map,this._screensNeedValidating=!1,this._removedPrimaryInstances=[],this._enqueueUpcomingTlfsDeadline=0,this._forceInitiateStateChangeForTests=!1,this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._visitedScreenIds=new no,this._isApplyingStateChangeMutation=!1,this._isResettingStateChangeMutations=!1,this._initiatedInstanceChanges=new Map,this._lastInitiatedInstanceStateChange=null,this._setVariableActionHistory=[],this._variableIdToSetVariableActionHistoryIndex=new Map,this._hsmObservers=new dn,this._activeSlidesPrototypeEmbed=Q.invalid(),this._appState=e,this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this.componentStateSyncer=new tp(this._appState,this,(r,n,o)=>this._getFullscreenNodeChangesForStateSwap(r,n,o)),this._emitter=Ht.getEventEmitter(),this._hsmRoot=new ad(this),this._onStateSwapFailedDueToCycle=()=>{this._emitter.trigger("stateSwapFailedDueToCycle")},this.resetState()}hasRequestedStateChange(){return this._requestedStateChange!==null}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._hsmRoot=new ad(this),this._initiatedInstanceChanges=new Map,r!=null&&this.createOrRepairStateMachinesForInsertedSubtree(r.root()),this._visitedScreenIds=new no,this._enforceValidPrototypeState()}resetState(){this.resetPrototype(),this._currentFitMode="none",this._currentContentScalingMode="fixed",this._transitionOnClick=!0}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){this._enforceValidPrototypeState()}handleSceneGraphEvent(e){if(mo.isPrototypeStructuralChange(e.property)&&(this._screensNeedValidating=!0,this._deferEnqueueUpcomingTlfs()),e.property==114)ot.asString(e.newVal)=="REMOVED"&&!this.isApplyingStateChangeMutation()&&e.node.isPrimaryInstance()&&this._removedPrimaryInstances.push(e.node.id());else if(e.property==78&&e.node.isInstance()){let r=e.node.symbolID()??Q.invalid();Q.isValid(r)||console.warn("Unexpected invalid symbolID for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(e.node,r)}else if(e.property==32){let r=e.oldVal!=null&&ot.isParentIndex(e.oldVal)?ot.asParentIndex(e.oldVal):null,n=e.newVal!=null&&ot.isParentIndex(e.newVal)?ot.asParentIndex(e.newVal):null,o=r!=null?e.node.scene().findNode(r.id):null,i=n!=null?e.node.scene().findNode(n.id):null,a=o!=null&&o.isRooted(),s=i!=null&&i.isRooted();!a&&s?this.createOrRepairStateMachinesForInsertedSubtree(e.node):a&&!s&&(this.isApplyingStateChangeMutation()||kn(e.node,l=>{if(l.isInstance()){let c=this._getStateMachineOrNull(l.stablePath());if(c!=null)return this.commitInstanceStateChange(c),2}return 0}))}else e.property==65&&Nr.clearCachedNodePaths()}didApplyNodeChanges(){if(this._screensNeedValidating&&(this._enforceValidPrototypeState(),this._screensNeedValidating=!1),this._removedPrimaryInstances.length>0){for(let e of this._removedPrimaryInstances)this.commitChangesBelowInstanceTransitionRoot(new ht([e])),this._hsmRoot.removeChild(e);this._removedPrimaryInstances=[]}}onFrame(){this._shouldNotifyNavigationInfoInvalidated&&(this._emitter.trigger("navigationInfoInvalidated"),this._shouldNotifyNavigationInfoInvalidated=!1),this._enqueueUpcomingTlfsDeadline!=0&&Xe.milliseconds()>this._enqueueUpcomingTlfsDeadline&&this._enqueueUpcomingTlfs()}_filterOverlays(e){let r=e.length;for(let n=0;n<e.length;n=n+1){let o=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e[n].id);if(o==null){r=n;break}o.setUsedAsBaseScreen(!1)}return r==e.length?e:e.slice(0,r)}_filterPresentedState(e){if(e==null)return null;if(e.stateId==null&&e.overlays.length==0)return e;let r=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e.stateId);if(r==null)return new vr(null,[]);r.setUsedAsBaseScreen(!0);let n=this._filterOverlays(e.overlays);return n==e.overlays?e:new vr(e.stateId,n)}_filterChange(e){if(e==null)return null;let r=this._filterPresentedState(e.oldStateAndOverlays),n=this._filterPresentedState(e.newStateAndOverlays);return r==e.oldStateAndOverlays&&n==e.newStateAndOverlays?e:new on(1,ht.ROOT_STABLE_PATH(),r,n)}_getBaseScreenIdFromChangeOrHistory(e,r){return e!=null?e.newStateAndOverlays.stateId:r&&r.length>0?ie.List_last(r).newStateAndOverlays.stateId:null}_getAnimationStateFromChangeOrHistory(e,r){return e!=null?e.newStateAndOverlays.animationState:r&&r.length>0?ie.List_last(r).newStateAndOverlays.animationState:null}enforceValidPrototypeStateForTesting(){this._enforceValidPrototypeState()}_enforceValidPrototypeState(){let e=!1;if(this._initiatedChange!=null){let o=!K.getFeatureFlags().viewer_only_check_new_state_id&&this._initiatedChange.oldStateId()!=null&&this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.oldStateId())==null,i=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.newStateId())==null;e=o||i,o&&(this.mostRecentFixInvalidStateInitiator+=" oldIsInvalid"),i&&(this.mostRecentFixInvalidStateInitiator+=" newIsInvalid")}else if(this._changeHistory&&this._changeHistory.length>0){let o=ie.List_last(this._changeHistory).newStateId(),i=this._appState.prototypeStructure().validDestinationForPrototypeFromId(o)==null;e=i,i&&(this.mostRecentFixInvalidStateInitiator+=" currentIsInvalid")}else return;if(e){this.restartPrototype(0);return}let r=null,n=null;if(this._initiatedChange!=null){let o=this._filterChange(this._initiatedChange);this._initiatedChange!=o&&(n=this._initiatedHistory.slice(),r=o)}else if(this._changeHistory&&this._changeHistory.length>0){let o=ie.List_last(this._changeHistory),i=this._filterChange(o);i!=o&&(n=this._changeHistory.slice(),r=i)}r!=null&&n!=null&&(ie.List_removeLast(n),n.push(r),this._requestStateChange(r,n),this.mostRecentFixInvalidStateInitiator+=" PrototypeState._enforceValidPrototypeState",this.commitStateChange())}getTlfHistory(){return this._tlfHistory}getLastChangeInHistory(){return this._changeHistory&&this._changeHistory.length<1?null:ie.List_last(this._changeHistory)}getHistoryCount(){return this._changeHistory.length}getInitiatedChange(){return this._initiatedChange}getCurrentBaseScreenId(){return this._getBaseScreenIdFromChangeOrHistory(this._initiatedChange,this._changeHistory)}getCurrentAnimationState(){return this._getAnimationStateFromChangeOrHistory(this._initiatedChange,this._changeHistory)}getCurrentBaseScreenNode(){var r;let e=this.getCurrentBaseScreenId();return e==null?null:(r=this._appState.scene())==null?void 0:r.findNode(e)}getCurrentBaseScreenIndex(){let e=this.getCurrentBaseScreenId();return e==null?-1:this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)}getPreviousBaseScreenId(){let e=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),r=this.getCurrentBaseScreenIndex();return r<1?null:Q.fromString(e[r-1])}getPreviousBaseScreenNode(){return this._appState.scene().findNode(this.getPreviousBaseScreenId())}getCurrentOverlays(){return this.bindOverlays(this.getCurrentOverlayData())}getCurrentOverlayData(){return this._initiatedChange!=null?this._initiatedChange.newOverlayData():this._changeHistory&&this._changeHistory.length>0?ie.List_last(this._changeHistory).newOverlayData():[]}getCurrentOverlayIds(){return this.getCurrentOverlays().map(e=>e.id())}getOpenOverlayData(e){let r=this.getCurrentOverlays();for(let n=0,o=r.length;n<o;n=n+1){let i=r[n];if(Q.equals(i.id(),e))return i}return null}getTopmostScreenAndPoint(e){let r=this.getCurrentBaseScreenNode(),n=this.getTopmostOverlayNode();return n?[n,this.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(r,e)]:[r,e]}getTopmostScreen(){return this.getTopmostOverlayNode()??this.getCurrentBaseScreenNode()}getTopmostScreenId(){return this.getTopmostOverlayId()??this.getCurrentBaseScreenId()}getTopmostOverlay(){let e=this.getCurrentOverlays();return e.length>0?ie.List_last(e):null}getTopmostOverlayId(){let e=this.getCurrentOverlays();return e.length>0?ie.List_last(e).id():null}getTopmostOverlayNode(){var r;let e=this.getCurrentOverlays();return e.length==0?null:(r=this._appState.scene())==null?void 0:r.findNode(ie.List_last(e).id())}getSecondTopmostOverlayNodeOrBaseScreen(){var r;let e=this.getCurrentOverlays();return e.length==0?null:e.length==1?this.getCurrentBaseScreenNode():(r=this._appState.scene())==null?void 0:r.findNode(e[e.length-2].id())}getLayersIds(){let e=this.getCurrentBaseScreenId();if(e==null)return[];let r=this.getCurrentOverlayIds().slice();return r.unshift(e),r}getPreviousNonTransientChange(){let e=this._changeHistory.slice();for(;this._changeHistory&&e.length>0&&ie.List_last(e).isTransientChange();)e.pop();if(e.length==0)return null;for(;this._changeHistory&&e.length>0;){let r=e.pop();if(!(e.length>0&&ie.List_last(e).isTransientChange()||this._appState.prototypeStructure().validDestinationForPrototypeFromId(r.oldStateId())==null))return r}return null}bindOverlays(e){let r=[];for(let n=0,o=e.length;n<o;n=n+1)r.push(new ip(this._appState.scene(),e[n],n>0?r[n-1]:null,n));return r}getOngoingNavigateRepairsInvalidState(){return this._ongoingNavigateRepairsInvalidState}lastNodeForBaseScreen(){var r;let e=null;return this._initiatedChange!=null?e=this._initiatedChange.oldStateId():this._changeHistory&&this._changeHistory.length>0&&(e=ie.List_last(this._changeHistory).newStateId()),e==null?null:(r=this._appState.scene())==null?void 0:r.findNode(e)}nextNodeForBaseScreen(){var e,r;return((e=this._initiatedChange)==null?void 0:e.newStateId())==null?null:(r=this._appState.scene())==null?void 0:r.findNode(this._initiatedChange.newStateId())}lastNodeForOverlayAt(e){var n;let r=null;if(this._initiatedChange!=null)r=this._initiatedChange.oldOverlayData();else if(this._changeHistory&&this._changeHistory.length>0)r=ie.List_last(this._changeHistory).newOverlayData();else return null;return r.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode(r[e].id)}nextNodeForOverlayAt(e){var n;if(this._initiatedChange==null)return null;let r=this._initiatedChange.newOverlayData();return r.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode(r[e].id)}displayedOverlayCount(){return this._initiatedChange!=null?Math.max(this._initiatedChange.oldOverlayData().length,this._initiatedChange.newOverlayData().length):this._changeHistory&&this._changeHistory.length>0?ie.List_last(this._changeHistory).newOverlayData().length:0}nodeForOverlayAt(e){var n;let r=this.getCurrentOverlayData();return r.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode(r[e].id)}getCurrentFitMode(){return this._currentFitMode}getCurrentContentScalingMode(){return this._currentContentScalingMode}getCurrentScalingInfo(){return{fitMode:this._currentFitMode,contentScalingMode:this._currentContentScalingMode}}setScalingInfoFromParameter(e,r){let n={};switch(e){case"contain":{n.fitMode="contain",n.contentScalingMode="fixed";break}case"contain-with-zoom":{n.fitMode="contain-with-zoom",n.contentScalingMode="fixed";break}case"scale-down":{n.fitMode="scale-down",n.contentScalingMode="fixed";break}case"min-zoom":{n.fitMode="min-zoom",n.contentScalingMode="fixed";break}case"scale-down-width":{n.fitMode="scale-down-width",n.contentScalingMode="fixed";break}case"fit-width":{n.fitMode="fit-width",n.contentScalingMode="fixed";break}case"free":{n.fitMode="free",n.contentScalingMode="fixed";break}case"responsive":{n.fitMode="contain",n.contentScalingMode="responsive";break}default:{n.fitMode="scale-down",n.contentScalingMode="fixed";break}}if(r)switch(r){case"responsive":{n.contentScalingMode="responsive";break}case"fixed":{n.contentScalingMode="fixed";break}default:break}let o={fitMode:this._currentFitMode,contentScalingMode:this._currentContentScalingMode},i=!1;n.fitMode!=this._currentFitMode&&(this._currentFitMode=n.fitMode,i=!0),n.contentScalingMode!==this._currentContentScalingMode&&(this._currentContentScalingMode=n.contentScalingMode,i=!0),i&&this._notifyFitModeChange(o,{fitMode:this._currentFitMode,contentScalingMode:this._currentContentScalingMode})}_notifyFitModeChange(e,r){this._observers.forEach(n=>{n.handleFitModeChange(e,r)})}actionCounter(){return this._actionCounter}setTransitionOnClick(e){this._transitionOnClick=e}getTransitionOnClick(){return this._transitionOnClick}setInteractionsEnabled(e){this._interactionsEnabled=e}interactionsEnabled(){return this._interactionsEnabled}disengageObservationOnClick(){return this._disengageObservationOnClick}setDisengageObservationOnClick(e){this._disengageObservationOnClick=e}isDragging(){return this._isDragging}setIsDragging(e){this._isDragging=e}showDeviceFrame(){return this._showDeviceFrame}setShowDeviceFrame(e){this._showDeviceFrame=e}showTransparentBackground(){return this._showTransparentBackground}setShowTransparentBackground(e){this._showTransparentBackground=e}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}closeOverlayAtAndAbove(e,r){let n=Ao.getDefaultExternalExecution();this._closeOverlayAtAndAbove(e,n.interactionAddress,n.canvasSpaceTriggerBoundsOrNull,0,null,r)}closeOverlayForHotspot(e,r,n,o){var c;let i=null,a=null,s=0;e!=null&&r!=null?(i=(c=e.topLevelAncestor())==null?void 0:c.id(),a=Ao.forNoodle(e,r,o),s=rt.fromInteractionType(r.event().interactionType())):(we("closeOverlayForHotspot called with null hotspot"),i=this.getTopmostOverlayId(),a=Ao.getDefaultExternalExecution(),s=0);let l=this.getCurrentOverlayData();for(let d=l.length-1;d>=0;d=d-1)if(Q.equals(l[d].id,i)){this._closeOverlayAtAndAbove(d,a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,s,null,n);return}}_closeOverlayAtAndAbove(e,r,n,o,i,a){if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let s=this.getCurrentOverlayData();if(s.length>e){let l=on.forClosingTopNOverlays(s.length-e,this.getCurrentBaseScreenId(),s,r,n,o);if(i==null)switch(a){case 0:{i=this._changeHistory.slice();break}case 1:{i=Yt.FrozenList_cloneAndAppendOne(this._changeHistory,l);break}case 2:{i=[l];break}}this._requestStateChange(l,i)}}navigateToFrameAndCloseOverlaysOrRestart(e,r){var o;this.mostRecentFixInvalidStateInitiator=r;let n=null;if(e!=null){let i=this._appState.scene().findNode(e),a=i==null?void 0:i.findContainingCanvasOrSelf();if(a!=null&&this._appState.setActiveCanvas(a),n=(o=this._appState.prototypeStructure())==null?void 0:o.validDestinationForPrototypeFromId(e),this._appState.prototypeStructure().navigationOrder().navigationOrderType()===2&&(n==null?void 0:n.type())!=="SLIDE"){let[s]=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();s&&(n=this._appState.scene().findNode(s))}n||(this.mostRecentFixInvalidStateInitiator=`${r} invalid`)}else this.mostRecentFixInvalidStateInitiator=`${r} null`;n!=null?this.navigateToFrameAndCloseOverlays(n.id()):this.restartPrototype(0)}navigateToFrameAndCloseOverlays(e,r=null,n=2,o=0,i=0,a=null,s=null){var E,P;if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let l=this.getCurrentBaseScreenNode(),c=(E=this._appState.prototypeStructure())==null?void 0:E.getDestinationFrame(e);if((l==null?void 0:l.type())==="SLIDE"&&!c||c!=null&&c.isSkippedSlide()){let T=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),f=T[T.indexOf(l.id())+1];c=(P=this._appState.prototypeStructure())==null?void 0:P.getDestinationFrame(f)}if(c!=null){this._appState.prototypeStructure().validDestinationForPrototypeFromId(c.id())||be.trackDefinedEvent("prototype.viewer_navigation_invalid_destination",{cause:i,nodeType:c.type(),interactionId:(a==null?void 0:a.id())??"",enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced});let T=this._appState.scene().findNode(e);T!=null&&T.type()=="SECTION"&&be.trackDefinedEvent("prototype.navigate_to_section",{}),c.setUsedAsBaseScreen(!0),e=c.id()}else{be.trackDefinedEvent("prototype.navigate_to_null_frame",{isInlinePreview:K.isInlinePreview(),enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced});return}let d=this.getCurrentOverlayData(),u=this.getCurrentAnimationState();if(Q.equals(e,l==null?void 0:l.id())&&(l==null?void 0:l.scene())==(c==null?void 0:c.scene())&&d.length==0)return;let p=l!=null?l.id():null,_=[],h;r!=null&&a!=null?h=Ao.forNoodle(r,a,s):(h=Ao.getDefaultExternalExecution(),this._appState.prototypeStructure().navigationOrder().navigationOrderType()===2&&(h.transitionParameters.transitionResetVideoPosition=!0));let A=null;if(o===1){let T=this._appState.scene().findNode(e),f=T==null?void 0:T.objectAnimations();if(f&&f.length>0){let y=f[f.length-1];A=new Mo(y.id(),y.getAllActions().length-1)}}let m=new on(3,ht.ROOT_STABLE_PATH(),new vr(p,d,u),new vr(e,_,A),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,o,i),g=[];switch(n){case 0:{g=this._changeHistory;break}case 1:{g=Yt.FrozenList_cloneAndAppendOne(this._changeHistory,m);break}case 2:{g=[m];break}}let S=c!==null?c.findNearestAncestorOrSelf("SECTION"):null;if(S!==null){let T=this._getStateMachineOrNull(new ht([S.id()]));if(T===null||this._shouldDisableNewChangesInStateMachine(T))return;T.clearInitiatedChangesInSelfAndSubstates();let f=[];switch(n){case 0:{f=T.changeHistory();break}case 1:{f=Yt.FrozenList_cloneAndAppendOne(T.changeHistory(),m);break}case 2:{f=[m];break}}this._requestAndSaveSectionStateChange(T,m,f,g);let y=S,v=S.parent();for(;v!==null&&v.type()==="SECTION";){let w=new on(3,ht.ROOT_STABLE_PATH(),new vr(p,d),new vr(y.id(),_),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,o,i),I=this._getStateMachineOrNull(new ht([v.id()]));if(I===null||this._shouldDisableNewChangesInStateMachine(I))return;switch(I.clearInitiatedChangesInSelfAndSubstates(),n){case 0:{f=I.changeHistory();break}case 1:{f=Yt.FrozenList_cloneAndAppendOne(I.changeHistory(),w);break}case 2:{f=[w];break}}this._saveSectionStateChange(I,w,f),y=v,v=y.parent()}}else this._requestStateChange(m,g)}playObjectAnimation(e,r,n){if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let o=rn.getDefault();if(r!=null){let l=e.getObjectAnimationInteraction(r),c=e.getObjectAnimationAction(r);if(l==null||c==null)return;o=rn.fromPrototypeAction(c,l.stateManagementVersion())}let i=this.getCurrentAnimationState(),a=new on(3,ht.ROOT_STABLE_PATH(),new vr(e.id(),[],i),new vr(e.id(),[],r),Lo.EXTERNAL,null,o,n,0);this.logVerbose(()=>`[PrototypeState] playObjectAnimation: ${a.debugString(this._appState.scene())}`);let s=Yt.FrozenList_cloneAndAppendOne(this._changeHistory,a);this._requestStateChange(a,s)}overlayFrame(e,r,n,o,i,a){var h,A;if(!this._allowNewStateChanges()||this.getCurrentBaseScreenId()==null||r==null)return;this._clearInitiatedChangesBeforeNewChange();let s=i!=null?Ao.forNoodle(r,i,a):Ao.forExternalOpenOverlay(r),l=this.getCurrentOverlayData(),c=(h=this._appState.prototypeStructure())==null?void 0:h.getDestinationFrame(e);if(c==null){we("tried to open to null overlay");return}(A=F())==null||A.resetLocalNodeSizeChanges(c.id());let d=new od(c.id(),e,s.interactionAddress.hotspotStablePath,s.interactionAddress.interactionId,s.transitionParameters,this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen()??this.getCurrentBaseScreenNode(),c)),u=this.getCurrentBaseScreenId(),p=new on(3,ht.ROOT_STABLE_PATH(),new vr(u,l),new vr(u,Yt.FrozenList_cloneAndAppendOne(l,d)),s.interactionAddress,s.canvasSpaceTriggerBoundsOrNull,s.transitionParameters,n,o);c.setUsedAsBaseScreen(!1);let _=Yt.FrozenList_cloneAndAppendOne(this._changeHistory,p);this._requestStateChange(p,_)}getSetVariableActionHistoryLength(){return this._setVariableActionHistory.length}getSetVariableModeActionHistoryLength(){return this._setVariableModeActionHistory.length}createMultiplayerSetVariableAction(e,r,n,o){let i={nodeForFindingTopmostScreenId:Q.toFigGUID(e),targetVariableId:r,targetVariableData:JSON.stringify(n),resolvedVariableModes:JSON.stringify(o)};this._addVariableToHistory(i)}createMultiplayerSetVariableModeAction(e,r,n){let o={nodeForFindingTopmostScreenId:Q.toFigGUID(e),targetVariableSetId:is.toKiwi(r),targetVariableModeId:n};this._addVariableModeToHistory(o)}performMultiplayerSetVariableAction(e){F().runSetVariable(Q.fromFigGUID(e.nodeForFindingTopmostScreenId),e.targetVariableId,JSON.parse(e.targetVariableData),JSON.parse(e.resolvedVariableModes)),this._addVariableToHistory(e)}performMultiplayerSetVariableModeAction(e){F().runSetVariableMode(Q.fromFigGUID(e.nodeForFindingTopmostScreenId),is.fromKiwi(e.targetVariableSetId),e.targetVariableModeId),this._addVariableModeToHistory(e)}_addVariableToHistory(e){let r=e.targetVariableId;if(this._variableIdToSetVariableActionHistoryIndex.has(r)){let n=this._variableIdToSetVariableActionHistoryIndex.get(r);this._setVariableActionHistory[n]=e}else this._variableIdToSetVariableActionHistoryIndex.set(r,this._setVariableActionHistory.length),this._setVariableActionHistory.push(e);this._notifyMultiplayerSetVariableActionHistory()}_addVariableModeToHistory(e){let r=is.fromKiwi(e.targetVariableSetId);if(!is.isValid(r)){be.trackEvent("variable_set_mode_action_invalid_id",{variableSetID:r});return}if(this._variableSetIdToSetVariableModeActionHistoryIndex.has(r)){let n=this._variableSetIdToSetVariableModeActionHistoryIndex.get(r);this._setVariableModeActionHistory[n]=e}else this._variableSetIdToSetVariableModeActionHistoryIndex.set(r,this._setVariableModeActionHistory.length),this._setVariableModeActionHistory.push(e);this._notifyMultiplayerSetVariableModeActionHistory(),this._setOverlaysToParentModes(this.getCurrentOverlayData(),this.getCurrentBaseScreenId(),!0)}_notifyMultiplayerSetVariableActionHistory(){this._observers.forEach(e=>{var r;(r=e.handleSetVariableAction)==null||r.call(e,this._setVariableActionHistory)})}_notifyMultiplayerSetVariableModeActionHistory(){this._observers.forEach(e=>{var r;(r=e.handleSetVariableModeAction)==null||r.call(e,this._setVariableModeActionHistory)})}resetVariablePrototypeState(){F().resetLocalVariableChanges(),F().resetLocalVariableModeChanges(),this.resetSetVariableActionHistory(),this.resetSetVariableModeActionHistory()}resetSetVariableActionHistory(){this._setVariableActionHistory=[],this._variableIdToSetVariableActionHistoryIndex=new Map,this._notifyMultiplayerSetVariableActionHistory()}resetSetVariableModeActionHistory(){this._setVariableModeActionHistory=[],this._variableSetIdToSetVariableModeActionHistoryIndex=new Map,this._notifyMultiplayerSetVariableModeActionHistory()}createVideoStateChange(e,r,n,o,i){if(e==null||r==null||n==null)return;let a={targetNodeId:Q.toFigGUID(e),isPlaying:r,isPlayingSound:n,currentTimes:o,actionTakenTimestamp:i};this._addVideoStateChangeToHistory(a)}performMultiplayerVideoStateChange(e,r){this._appState.videoManager().multiplayerUpdateVideoRuntimes(e,r),this._addVideoStateChangeToHistory(r)}_addVideoStateChangeToHistory(e){if(!e.targetNodeId)return;let r=Q.fromFigGUID(e.targetNodeId);this._guidToVideoStateChangeMap.set(r,e),this._notifyMultiplayerVideoStateChangeToHistory()}_notifyMultiplayerVideoStateChangeToHistory(){this._observers.forEach(e=>{var r;(r=e.handleVideoStateChange)==null||r.call(e,Array.from(this._guidToVideoStateChangeMap.values()))})}getVideoStateChangeForGuid(e){return this._guidToVideoStateChangeMap.get(e)}allVisibleVideosAreLoaded(){var e;return((e=this._appState.videoManager())==null?void 0:e.allVisibleVideosAreLoaded())??!1}snapshotLatestVideoStateChanges(){var e;(e=this._appState.videoManager())==null||e.snapshotVideoStates()}getVideoStateChanges(){return Array.from(this._guidToVideoStateChangeMap.values())}resetSectionsState(){let e=this._appState.getActiveCanvas();if(e!=null){let r=e.findAllSectionsInNode();for(let n of r){let o=this._getStateMachineOrNull(new ht([n.id()]));o!=null&&o.resetHistoryToFirstFrameInSection(n)}}}setActiveSlidesPrototypeEmbedGUID(e){this._activeSlidesPrototypeEmbed=e,this._notifyMultiplayerActiveSlidesPrototypeEmbedChange(e),this._emitter.trigger("activeSlidesPrototypeEmbedChange",e)}getActiveSlidesPrototypeEmbedGUID(){return this._activeSlidesPrototypeEmbed}_notifyMultiplayerActiveSlidesPrototypeEmbedChange(e){this._observers.forEach(r=>{var n;(n=r.handleActiveSlidesEmbeddedPrototypeChange)==null||n.call(r,e)})}notifyMultiplayerEmbeddedPrototypeDataChange(e){this._observers.forEach(r=>{var n;(n=r.handleEmbeddedPrototypeDataChange)==null||n.call(r,e)})}resetPrototype(e=!0){var r;this._appState.scene()!=null&&(this._clearInitiatedChangesBeforeNewChange(),this._isResettingStateChangeMutations=!0,(r=F())==null||r.resetLocalChanges(),this._initiatedInstanceChanges=new Map,this._isResettingStateChangeMutations=!1,this._clearOverlays(this.getCurrentOverlayData()),this.resetSectionsState(),Nr.clearCachedNodePaths(),this.componentStateSyncer.handleRestartPrototype()),this._initiatedChange=null,this._initiatedHistory=null,e&&(this._changeHistory=[]),this._tlfHistory=[],this._upcomingTlfs=new Set,this.resetSetVariableActionHistory(),this.resetSetVariableModeActionHistory(),this._actionCounter=this._actionCounter+1,this._lastInitiatedTopLevelStateChange=null,this._lastInitiatedInstanceStateChange=null}getOrSetRestartPrototypeNode(){var o;let e=this._appState.activePrototypeStartingPointNodeId();if((e?(o=this._appState.scene())==null?void 0:o.findNode(e):null)==null){let i=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();i!=null&&(this._appState.prototypeState().mostRecentFixInvalidStateInitiator="PrototypeState.getOrSetRestartPrototypeNode",this._appState.setActivePrototypeStartingPointNodeId(i.id()))}return this._appState.prototypeStructure().nodeToRestartPrototypeOn(this._appState.getActiveCanvas())}restartPrototype(e){if(this.logVerbose(()=>`[PrototypeState] restartPrototype started for ${_s[e]}`),this.mostRecentBaseScreenIdChangeInitiator="PrototypeState.restartPrototype "+_s[e],this.resetPrototype(),this._observers.forEach(n=>{n.handleRestartPrototype()}),K.getViewerMode()==K.ViewerMode.MIRROR)return;let r=this.getOrSetRestartPrototypeNode();r!=null&&(e==0&&(this._ongoingNavigateRepairsInvalidState=!0),this.navigateToFrameAndCloseOverlays(r.id()),this.tryToInitiateRequestedStateChange(t.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW)),this.logVerbose(()=>`[PrototypeState] restartPrototype finished for ${_s[e]}`)}returnToState1(e){this.returnToState2(null,null,e,0,null,null)}returnToState2(e,r,n,o,i,a){var u;if(!this._allowNewStateChanges()||this._changeHistory.length<=1)return;let s=n!=2,l=null;this._clearInitiatedChangesBeforeNewChange();let c=this._changeHistory.slice(),d=null;for(e!=null&&r!=null?d=Ao.forNoodle(e,r,a):d=Ao.getDefaultExternalExecution();c.length>1&&(s&&ie.List_last(c).isTransientChange());)l=c.pop();if(n==0||c.length<=1){((u=r==null?void 0:r.event())==null?void 0:u.interactionType())=="DRAG"&&this._returnToOverlayState(d,o,l==null?void 0:l.oldOverlayData(),l,c);return}for(l=ie.List_last(c);c.length>1;){let p=c.pop();if(c.length>1&&s&&ie.List_last(c).isTransientChange())continue;let h=p.oldStateId();if(Q.equals(h,this.getCurrentBaseScreenId()))this._returnToOverlayState(d,o,p.oldOverlayData(),l,c);else{if(this._appState.prototypeStructure().validDestinationForPrototypeFromId(p==null?void 0:p.oldStateId())==null)continue;this._returnToFrame(h,d,o,l,c,i)}break}}_returnToFrame(e,r,n,o,i,a){var _;let s=(_=this._appState.prototypeStructure())==null?void 0:_.getDestinationFrame(e),l=o.transitionParameters.withStateManagementSettings(a),c=new on(4,ht.ROOT_STABLE_PATH(),new vr(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new vr(e,[]),n,r.interactionAddress,1,l);if(s!=null)s.setUsedAsBaseScreen(!0);else{we("tried to return to deleted frame");return}let d=!1,u=s.findNearestAncestorOrSelf("SECTION"),p=this.getCurrentBaseScreenNode().findNearestAncestorOrSelf("SECTION");if(u!=null&&p!=null){if(u==p||u==p.parent()){let h=this._getStateMachineOrNull(new ht([u.id()])),A=ie.List_last(h.changeHistory()),m=Yt.FrozenList_cloneAndRemoveOne(h.changeHistory(),A);this._requestAndSaveSectionStateChange(h,c,m,i),d=!0}else if(p==u.parent()){c=new on(4,ht.ROOT_STABLE_PATH(),new vr(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new vr(u.id(),[]),n,r.interactionAddress,1,o.transitionParameters);let h=this._getStateMachineOrNull(new ht([p.id()])),A=ie.List_last(h.changeHistory()),m=Yt.FrozenList_cloneAndRemoveOne(h.changeHistory(),A);this._requestAndSaveSectionStateChange(h,c,m,i),d=!0}}d||this._requestStateChange(c,i)}_returnToOverlayState(e,r,n,o,i){var s;let a=this.getCurrentOverlayData();if(n.length<a.length)this._closeOverlayAtAndAbove(n.length,e.interactionAddress,e.canvasSpaceTriggerBoundsOrNull,r,i,0);else{for(let d=0,u=n.length;d<u;d=d+1){let p=(s=this._appState.prototypeStructure())==null?void 0:s.getDestinationFrame(n[d].id);if(p==null)break;p.setUsedAsBaseScreen(!1)}let l=this.getCurrentBaseScreenId(),c=new on(4,ht.ROOT_STABLE_PATH(),new vr(l,this.getCurrentOverlayData()),new vr(l,n),r,e.interactionAddress,1,o.transitionParameters);this._requestStateChange(c,i)}}swapTopOverlay(e,r,n,o,i){var h,A;if(!this._allowNewStateChanges())return;let a=this.getCurrentOverlayData(),s=this.getCurrentBaseScreenId();if(s==null||a.length==0)return;this._clearInitiatedChangesBeforeNewChange();let l=(h=this._appState.prototypeStructure())==null?void 0:h.getDestinationFrame(e);if(l==null){we("tried to swap to null overlay");return}(A=F())==null||A.resetLocalNodeSizeChanges(l.id());let c=a.slice();c[c.length-1]=c[c.length-1].cloneWithId(l.id(),this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen(),l));let d=null,u=0;r!=null&&o!=null?(d=Ao.forNoodle(r,o,i),u=rt.fromInteractionType(o.event().interactionType())):(d=Ao.getDefaultExternalExecution(),u=0);let p=new on(3,ht.ROOT_STABLE_PATH(),new vr(s,a),new vr(s,c),d.interactionAddress,d.canvasSpaceTriggerBoundsOrNull,d.transitionParameters,0,u);if(l==null){we("tried to swap to null overlay");return}l.setUsedAsBaseScreen(!1);let _=Yt.FrozenList_cloneAndAppendOne(this._changeHistory,p);this._requestStateChange(p,_)}baseScreenWasValidDestinationBeforeNodeChanges(){return this._baseScreenWasValidDestinationBeforeNodeChanges}checkValidBaseScreenBeforeNodeChanges(){this._baseScreenWasValidDestinationBeforeNodeChanges||(this._initiatedChangeBeforeNodeChanges=this._initiatedChange,this._changeHistoryBeforeNodeChanges=this._changeHistory,this._baseScreenWasValidDestinationBeforeNodeChanges=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._getBaseScreenIdBeforeNodeChanges())!=null)}checkValidBaseScreenAfterNodeChanges(){if(!this._baseScreenWasValidDestinationBeforeNodeChanges)return;let e=this._appState.prototypeStructure();if(e.validDestinationForPrototypeFromId(this.getCurrentBaseScreenId())==null){if(e.validDestinationForPrototypeFromId(this._getBaseScreenIdBeforeNodeChanges())==null)return;this._initiatedChange=this._initiatedChangeBeforeNodeChanges,this._changeHistory=this._changeHistoryBeforeNodeChanges}this._initiatedChangeBeforeNodeChanges=null,this._changeHistoryBeforeNodeChanges=[],this._baseScreenWasValidDestinationBeforeNodeChanges=!1}_getBaseScreenIdBeforeNodeChanges(){return this._getBaseScreenIdFromChangeOrHistory(this._initiatedChangeBeforeNodeChanges,this._changeHistoryBeforeNodeChanges)}_clearInitiatedChangesBeforeNewChange(){this._disableNewStateChanges=!0,this._appState.scene()!=null&&this._forEachTransitioningStateMachine(e=>{let r=this._getStateMachineOrNull(e);return r!=null&&r.clearInitiatedChangesInSelfAndSubstates(),0}),this._initiatedChange!=null&&(this.mostRecentFixInvalidStateInitiator="PrototypeState._clearInitiatedChangesBeforeNewChange",this.commitStateChange()),this._disableNewStateChanges=!1}_allowNewStateChanges(){return!this._disableNewStateChanges}abortStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._initiatedChange=null,this._initiatedHistory=null,this._broadcastStateChange(e,2,null),this._handleOverlaysModeSetting(e,2),this._enforceValidPrototypeState()}commitStateChange(){if(this._initiatedChange==null||this._initiatedHistory==null)return;let e=this._initiatedChange;this._changeHistory=this._initiatedHistory,this._initiatedChange=null,this._initiatedHistory=null,this.logVerbose(()=>`[PrototypeState] commitTopLevelChange ${e.debugString(this._appState.scene())}`);let r=[],n=o=>{r.push(o)};if(this._broadcastStateChange(e,3,n),this._handleOverlaysModeSetting(e,3),this._allowNewStateChanges())for(let o of r)o();K.isInlinePreview()||this._enforceValidPrototypeState()}_enqueueUpcomingTlfs(){let e=this.getCurrentBaseScreenNode();if(e==null)return;let r=sn.adjacentBaseScreens(this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF(),e);for(let n of r.asList())this._upcomingTlfs.add(n);this._shouldNotifyNavigationInfoInvalidated=!0,this._enqueueUpcomingTlfsDeadline=0}getUpcomingTlf(){for(;this._upcomingTlfs.size>0;){let e=nP(this._appState.scene(),Array.from(this._upcomingTlfs.values()).map(r=>Q.fromString(r)))[0];if(this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)>=0){this._upcomingTlfs.delete(e);continue}return this._appState.scene().findNode(e)==null?null:Q.fromString(e)}return null}setForceInitiateStateChangeForTests(e){this._forceInitiateStateChangeForTests=e}_requestStateChange(e,r){var n;this._broadcastStateChange(e,0,null),this._requestedStateChange=new t.StateChangeRequest(e,r),this._requestedStateChangeAtMs=Xe.milliseconds(),this._emitter.trigger("requestedStateChange",{interactionId:(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId,cause:rt[e.cause],destinationId:e.newStateId()}),this._disableNewStateChanges=!0,this.tryToInitiateRequestedStateChange(t.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED)}_requestAndSaveSectionStateChange(e,r,n,o){this._appState.scene()!=null&&(e.stage(r,n),this._requestStateChange(r,o),Q.equals(r.oldStateId(),r.newStateId())||this.commitSectionStateChange(e))}_saveSectionStateChange(e,r,n){this._appState.scene()!=null&&(e.stage(r,n),Q.equals(r.oldStateId(),r.newStateId())||this.commitSectionStateChange(e))}tryToInitiateRequestedStateChange(e){this._requestedStateChange!=null&&(this._forceInitiateStateChangeForTests||e==t.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW?this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history):Array.from(this._requestedStateChange.change.newStateAndOverlays.statesAndOverlaysIncluded()).every(o=>{var a;let i=(a=this._appState.scene())==null?void 0:a.findNode(o);return i==null?!1:i.hasBeenLoaded()})&&this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history))}_maybeTrackStateChangeInitiated(e){var n;let r=e.newStateAndOverlays.statesAndOverlaysIncluded();for(let o of r)this._visitedScreenIds._in(o)||this._visitedScreenIds.add(o);if(this._requestedStateChangeAtMs>0){let o=Xe.milliseconds()-this._requestedStateChangeAtMs;if(o>100){let i={prototypeType:this._appState.prototypeStructure().navigationOrder().navigationOrderTypeString(),incrementalFrameLoading:!0,timeWaitedForLoadingMs:o,interactionId:(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId,interactionCause:rt[e.cause],destinationId:e.newStateId(),enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced},a=this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.newStateId());this._appState.requestedFrameMetricsTracker().clear(),a&&(i.destinationWasLoaded=a.wasAlreadyLoaded,i.destinationWasInWorkingSet=a.wasAlreadyInWorkingSet),be.trackDefinedEvent("prototype.viewer_reached_unloaded_frame",i)}}}_initializeStateForObjectAnimation(e){let r=e.oldStateId(),n=e.newStateId(),o=this._appState.scene().findNode(n);if(o==null)return;let i=o.objectAnimations();if(!i.length)return;let a=-1,s=0;if(r!=n)e.direction==0?a=0:e.direction==1&&(a=i.length-1,s=i[a].getAllActions().length-1);else{if(e.direction==0)return;if(e.direction==1)if(e.newObjectAnimationState()==null)a=0;else{let l=e.newObjectAnimationState();if(l==null)return;a=i.findIndex(c=>c.id()==l.interactionId),s=l.actionIndex}}this.logVerbose(()=>`[PrototypeState] _initializeAnimationStateForNewBaseScreen with animation index ${a} with direction ${e.direction}`),a!=-1&&F().previewSceneAt(n,a,s)}_initiateStateChange(e,r){var i;this._disableNewStateChanges=!0,this._updateCurrentBaseScreenIDs(e);for(let a of e.getRemovedFrameIds())this._forEachMaterializedStateInTlf(a,s=>{if(s.changeHistory().length>0&&ie.List_last(s.changeHistory()).isTransientChange(!0)){let l=rt.getOppositeTransientAction(ie.List_last(s.changeHistory()).cause);return this.returnInstanceToState(s.stablePath,0,l),s.clearInitiatedChangesInSelfAndSubstates(),2}return 0});this._emitter.trigger("requestedStateChangeInitiated",{interactionId:(i=e==null?void 0:e.interactionAddress)==null?void 0:i.interactionId,cause:rt[e.cause],destinationId:e.newStateId()}),this._maybeTrackStateChangeInitiated(e),this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._disableNewStateChanges=!1,this._initiatedChange=e,this._initiatedHistory=r;let n=e.newStateId(),o=this._tlfHistory.indexOf(n);this._initializeStateForObjectAnimation(e),o<0&&ie.List_appendOne(this._tlfHistory,n),this._shouldNotifyNavigationInfoInvalidated=!0,this.logVerbose(()=>`[PrototypeState] initiateTopLevelChange ${e.debugString(this._appState.scene())}`),this._lastInitiatedTopLevelStateChange=e,this._actionCounter=this._actionCounter+1,this._broadcastStateChange(e,1,null),this._handleOverlaysModeSetting(e,1),(e==null?void 0:e.oldStateId())!=(e==null?void 0:e.newStateId())&&(this._ongoingNavigateRepairsInvalidState=!1),e.canInstantlyCommit()&&(this.mostRecentFixInvalidStateInitiator="PrototypeState._initiateStateChange",this.commitStateChange()),this._deferEnqueueUpcomingTlfs()}_updateCurrentBaseScreenIDs(e){var n;let r=e.newStateAndOverlays.statesAndOverlaysIncluded();(n=F())==null||n.modules().prototype.updateCurrentBaseScreenIDs(r)}_handleOverlaysModeSetting(e,r){let n=e.oldOverlayData(),o=n.length,i=e.newOverlayData(),a=i.length;if(!(a==0&&o==0)){if(a>o)r==1?this._setOverlaysToParentModes(i.slice(o),e.oldStateAndOverlays.topId()):r==2&&this._clearOverlays(i.slice(o));else if(a<o)r==3&&this._clearOverlays(n.slice(a));else if(a>0&&o>0&&a===o&&i[a-1].id!=n[o-1].id){let s=[i[a-1]];r==1?this._setOverlaysToParentModes(s,this.getSecondTopmostOverlayNodeOrBaseScreen().id()):r==2&&this._clearOverlays(s),r==3&&this._clearOverlays([n[o-1]])}}}_getOverlayDerivedModes(e,r){let n=r.getExplicitVariableModesWithSetKeys(),o=r.getResolvedVariableModesWithSetKeys(),i=e.getResolvedVariableModesWithSetKeys();return Object.entries(i).filter(([a,s])=>o[a]!=null&&n[a]==null)}_setOverlaysToParentModes(e,r,n){var i;let o=r;e.forEach(a=>{let s=this._appState.scene().findNode(a.id),l=this._appState.scene().findNode(o),c=l.getResolvedVariableModesWithSetKeys(),d=[];n?a.newOverlayExplicitModes.forEach(([u,p])=>{c[u]!=p&&s.setExplicitVariableModeForCollectionWithSetKey(u,c[u],null),d.push([u,c[u]])}):this._getOverlayDerivedModes(l,s).forEach(([u,p])=>{s.setExplicitVariableModeForCollectionWithSetKey(u,c[u],null),d.push([u,c[u]])}),a.newOverlayExplicitModes=d,o=a.id}),(i=F())==null||i.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}_clearOverlays(e){var r;e.forEach(n=>{let o=this._appState.scene().findNode(n.id);if(o==null)return;let i=o.getExplicitVariableModesWithSetKeys();n.oldOverlayDerivedModes.filter(([a,s])=>i[a]!=null&&(n.newOverlayExplicitModes[a]==null||i[a]==n.newOverlayExplicitModes[a])).forEach(([a,s])=>{o.clearExplicitVariableConsumerModeForCollectionWithSetKey(a)})}),(r=F())==null||r.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}lastInitiatedTopLevelStateChange(){return this._lastInitiatedTopLevelStateChange}_broadcastStateChange(e,r,n){let o=this._isNotifyingStateChangeObservers;switch(o&&we("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,r){case 0:{this._observers.forEach(i=>{i.handleStateChangeRequested(e)});break}case 1:{this._observers.forEach(i=>{i.handleStateChangeInitiated(e)});break}case 2:{this._observers.forEach(i=>{i.handleStateChangeAborted(e)});break}case 3:{this._observers.forEach(i=>{i.handleStateChangeCommitted(e,n)});break}}this._isNotifyingStateChangeObservers=o}debugHSMTree(){console.log("== Component SST =="),console.log(this.componentStateSyncer.debugString()),console.log("== Component HSM =="),console.log(this._hsmRoot.debugHierarchy(this._appState.scene()))}addHsmObserver(e){this._hsmObservers.add(e)}removeHsmObserver(e){this._hsmObservers.remove(e)}_getStateMachineOrNull(e){let r=e==null?void 0:e.guids;if(r==null)return null;let n=this._hsmRoot;for(let o of r){if(n==null)break;n=n.childOrNull(o)}return n}getStateMachineOrNull(e){return this._getStateMachineOrNull(e)}_getStateMachineOrNullWithString(e){return this._getStateMachineOrNull(ht.fromString(e))}_getParentStateMachineOrNull(e){return e.guids.length==0?null:this._getStateMachineOrNull(e.slice2(0,e.guids.length-1))}_forMaterializedStateMachineAndDescendants(e,r){var i;let o=[this._getStateMachineOrNull(e)];for(;o.length>0;){let a=o.pop();if(a!=null){let s=((i=this._appState.scene())==null?void 0:i.findNodeByStablePath(a.stablePath))==null,l=0;s?a==this._hsmRoot?l=0:l=2:l=r(a);let c=!1;switch(l){case 1:{c=!0;break}case 0:{Wr(o,a.getChildren());break}case 2:continue}if(c)break}}}createOrRepairStateMachinesForInsertedSubtree(e){kn(e,r=>{if(r.isInstance()){let n=r.symbolID()??Q.invalid();Q.isValid(n)||console.warn("Unexpected null symbolData for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(r,n)}else r.type()=="SECTION"&&this.createOrRepairSectionStateMachineIfNeeded(r,r.id())})}createOrRepairSectionStateMachineIfNeeded(e,r){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){we("Could not create or repair state machine for section with null parent");return}let o=ie.List_last(e.stablePath().guids),i=n.childOrNull(o);if(i!=null)if(Q.equals(i.stateId(),r)){this._isResettingStateChangeMutations&&i.resetHistoryToFirstFrameInSection(e);return}else i.initiatedChange()!=null&&this.commitSectionStateChange(i);n.setChild(o,new ad(this,e,r,!0))}createOrRepairInstanceStateMachineIfNeeded(e,r){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){console.warn("Could not create or repair state machine with null parent");return}let o=ie.List_last(e.stablePath().guids),i=n.childOrNull(o);if(i!=null){if(Q.equals(i.stateId(),r)){this._isResettingStateChangeMutations&&i.resetHistoryToState(r);return}else if(i.initiatedChange()!=null){if(this.isApplyingStateChangeMutation())return;this.commitInstanceStateChange(i)}}n.setChild(o,new ad(this,e,r))}actionCounterForState(e){let r=this._getStateMachineOrNull(e);return r==null?-1:r.actionCounter}actionCountersForStateAndAncestors(e){let r=[this.actionCounter()];for(let n=0,o=e.guids.length;n<o;n=n+1)r.push(this.actionCounterForState(e.slice2(0,n+1)));return r}getStateMachineInitiatedChange(e){let r=this._getStateMachineOrNull(e);return r==null?void 0:r.initiatedChange()}getStateMachineLastChangeInHistory(e){let r=this._getStateMachineOrNull(e);return r==null||r.changeHistory().length==0?null:r!==null?ie.List_last(r.changeHistory()):null}getLastFrameOrSectionVisitedInSection(e){if(e==null)return null;let r=this.getStateMachineLastChangeInHistory(new ht([e]));return r!=null?r.newStateAndOverlays.stateId:null}getState(e){let r=this._getStateMachineOrNull(e);return r==null?void 0:r.stateId()}_forEachMaterializedStateInTlf(e,r){var o;let n=(o=this._appState.scene())==null?void 0:o.findNode(e);n==null||!n.isTopLevel()||kn(n,i=>{if(i.isInstance()){let a=this._getStateMachineOrNull(i.stablePath());if(a!=null)return r(a)}return 0})}_forEachTransitioningStateMachine(e){for(let r of Array.from(this._initiatedInstanceChanges.keys()))if(Array.from(this._initiatedInstanceChanges.keys()).indexOf(r)!=-1){let n=this._initiatedInstanceChanges.get(r);if(e(n.stablePath)==1)break}}getOnscreenStates(){let e=[],r=this.getLayersIds();for(let n of r)this._forEachMaterializedStateInTlf(n,o=>{if(!1){let i=this._appState.scene().findNodeByStablePath(o.stablePath)}return e.push(new ho(o.stablePath,o.stateId())),0});return e}forMaterializedStateInstanceAndDescendants(e,r){this._forMaterializedStateMachineAndDescendants(e,n=>r(n.stablePath))}_deferEnqueueUpcomingTlfs(){this._enqueueUpcomingTlfsDeadline=Xe.milliseconds()+(_n?0:250)}lastInitiatedInstanceStateChange(){return this._lastInitiatedInstanceStateChange}_forStateMachineAndParents(e,r){let n=e.guids,o=[],i=this._hsmRoot,a=0;for(;i!=null&&a<n.length;)i=i.childOrNull(n[a]),i!=null&&o.push(i),a=a+1;if(!(o.length==0||!ht.equals(ie.List_last(o).stablePath,e))){for(let s=o.length-1;s>=0;s=s-1)if(r(o[s])==1)return}}_shouldDisableNewChangesInStateMachine(e){var o;let r=(o=this._appState.scene())==null?void 0:o.findNodeByStablePath(e.stablePath);if(r==null)return!0;let n=r;for(;n!=null;){let i=this._getStateMachineOrNull(n.stablePath());if(i!=null&&i.isClearingChangesInSelfAndSubstates())return!0;n=n.parent()}return!1}swapInstanceToState1(e,r,n,o,i,a){this.swapInstanceToState2(e,r,n,o,i,a,null)}swapInstanceToState2(e,r,n,o,i,a,s){this.logVerbose(()=>`[HSM] >>>>>>>> swap instance ${e} to state -> ${r} cause: ${rt[o]}`);let l=this._getStateMachineOrNull(e);if(l==null||this._shouldDisableNewChangesInStateMachine(l)||this._validatedStateSwapDestination(l.stateId(),r)==null)return;l.clearInitiatedChangesInSelfAndSubstates();let d=n!=null&&i!=null?Ao.forNoodle(n,i,s):Ao.getDefaultExternalExecution(),u=new on(2,l.stablePath,l.stateId(),r,d.interactionAddress,d.canvasSpaceTriggerBoundsOrNull,d.transitionParameters,o),p=null;switch(a){case 0:{p=l.changeHistory();break}case 1:{p=Yt.FrozenList_cloneAndAppendOne(l.changeHistory(),u);break}case 2:{p=[u];break}}let _=this._shouldDisallowSwap(e,r);_==_l.DISALLOWED_CYCLE?this._onStateSwapFailedDueToCycle():_==_l.ALLOWED&&this._requestInstanceStateChange(l,u,p)}returnInstanceToState(e,r,n){var p,_;let o=(p=this._appState.scene())==null?void 0:p.findNodeByStablePath(e);this._appState.prototypeRecorder().isRecording()&&this._appState.prototypeRecorder().addHistoricalEvent({type:"INTERACTION",targetPath:e.toString(),action:n,timeRecorded:Date.now(),name:o.name(),currentFrameName:(_=this.getCurrentBaseScreenNode())==null?void 0:_.name()}),this.logVerbose(()=>`[HSM] >>>>>>>> return instance ${e} to previous state cause: ${rt[n]}`);let i=this._getStateMachineOrNull(e);if(i==null||this._shouldDisableNewChangesInStateMachine(i)||(i.clearInitiatedChangesInSelfAndSubstates(),i.changeHistory().length<=1))return;let a=i.cloneHistoryForReturnToState(r,(h,A)=>this._validatedStateSwapDestination(h,A)),s=a.a,l=a.b,c=this._validatedStateSwapDestination(i.stateId(),ie.List_last(l).newStateId());if(c==null)return;let d=new on(2,i.stablePath,i.stateId(),c.id(),s.interactionAddress,s.canvasSpaceTriggerBoundsOrNull,s.transitionParameters,n),u=this._shouldDisallowSwap(i.stablePath,c.id());u==_l.DISALLOWED_CYCLE?this._onStateSwapFailedDueToCycle():u==_l.ALLOWED&&this._requestInstanceStateChange(i,d,l)}_requestInstanceStateChange(e,r,n){this._forMaterializedStateMachineAndDescendants(e.stablePath,i=>{if(i!=e&&i.changeHistory().length>0&&ie.List_last(i.changeHistory()).isTransientChange(!0)){let a=rt.getOppositeTransientAction(ie.List_last(i.changeHistory()).cause);return this.returnInstanceToState(i.stablePath,0,a),i.clearInitiatedChangesInSelfAndSubstates(),2}return 0});let o=this._appState.scene();if(o!=null){e.stage(r,n),this._initiatedInstanceChanges.set(e.stablePath.toString(),r),this._lastInitiatedInstanceStateChange=r;let i=this._appState.scene().findNodeByStablePath(r.interactionAddress.hotspotStablePath),a=new Map,s=null;this._isApplyingStateChangeMutation=!0,e.broadcastHsmStateChange(this._hsmObservers,r,0,null),o.dangerouslyDeferNodeRemovalScope(()=>{let d=this._getFullscreenNodeChangesForStateSwap(e.stablePath,r.newStateId(),hl.MATERIALIZE_SWAPPED_OUT_TREE,!0);for(let u of d.cloneOps)u.clone.copyNodeCachedTransformAndBounds(u.source),a.set(u.source,u.clone);s=this._appState.scene().findNodeByStablePath(d.transitionRootStablePath)});let l=ep.Map_getOrDefault(a,i,null),c=ep.Map_getOrDefault(a,s,null);s!=null&&c!=null?s.transitioningFrom=new Nu(c,r.stablePath,l):we("Failed to find swapped out node after state swap"),Q.equals(r.oldStateId(),r.newStateId())||(this._forEachTransitioningStateMachine(d=>{if(!ht.equals(r.stablePath,d)){let u=o.findNodeByStablePath(d);if(s!=null&&s.isAncestorOf(u)){let p=this._getStateMachineOrNull(d);this.commitInstanceStateChange(p)}}return 0}),this._deferEnqueueUpcomingTlfs()),this._isApplyingStateChangeMutation=!1}e.actionCounter=e.actionCounter+1,e.broadcastHsmStateChange(this._hsmObservers,r,1,null),this.logVerbose(()=>`[HSM] initiate ${r.oldStateId()} -> ${r.newStateId()} finished for ${e.stablePath} -- ${r.transitionParameters.transitionType} !`)}commitChangesBelowStablePath(e){var n,o;let r=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e);for(let i of Array.from(this._initiatedInstanceChanges.keys())){let a=this._initiatedInstanceChanges.get(i);if(a!=null){let s=this._getStateMachineOrNull(a.stablePath);s!=null&&r!=null&&r.isAncestorOf((o=this._appState.scene())==null?void 0:o.findNodeByStablePath(s.stablePath))&&this.commitInstanceStateChange(s)}}}commitChangesBelowInstanceTransitionRoot(e){let r=this._findTransitionRootForSwappedPath(e),n=r==null?e:r.stablePath();this.commitChangesBelowStablePath(n)}commitInstanceStateChange(e){if(e.initiatedChange()==null)return;let r=e.initiatedChange();e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null),this._initiatedInstanceChanges.delete(e.stablePath.toString()),Q.equals(r.oldStateId(),r.newStateId())||this._finishStateSwapMutation(r.stablePath);let n=[],o=i=>{n.push(i)};if(e.broadcastHsmStateChange(this._hsmObservers,r,3,o),!e.isClearingChangesInSelfAndSubstates())for(let i of n)i();this.logVerbose(()=>`[HSM] commit ${r.oldStateId()} -> ${r.newStateId()} finished for ${r.stablePath} -- ${r.transitionParameters.transitionType} !`)}commitSectionStateChange(e){e.initiatedChange()!=null&&(e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null))}abortInstanceStateChange(e){let r=this._getStateMachineOrNull(e);if(r==null||r.initiatedChange()==null)return;let n=r.initiatedChange();if(this._appState.scene()!=null){r.stage(null,null),this._initiatedInstanceChanges.delete(r.stablePath.toString());let i=this._findTransitionRootForSwappedPath(e),a=i.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,i.transitioningFrom=null,a.removeSelfAndSubtree(),r.broadcastHsmStateChange(this._hsmObservers,n,0,null),this._getFullscreenNodeChangesForStateSwap(r.stablePath,n.oldStateId(),hl.SKIP_MATERIALIZATION),this._isApplyingStateChangeMutation=!1}r.broadcastHsmStateChange(this._hsmObservers,n,2,null),this.logVerbose(()=>`[HSM] abort ${n.oldStateId()} -> ${n.newStateId()} finished for ${r.stablePath} -- ${n.transitionParameters.transitionType} !`)}_validatedStateSwapDestination(e,r){var s,l;let n=(s=this._appState.scene())==null?void 0:s.findNode(e),o=n==null?void 0:n.parent();if((n==null?void 0:n.type())!="SYMBOL"||o==null||!o.isStateGroup())return null;let i=(l=this._appState.scene())==null?void 0:l.findNode(r),a=i==null?void 0:i.parent();return(i==null?void 0:i.type())!="SYMBOL"||a==null||!a.isStateGroup()||Q.equals(e,r)?null:Q.equals(o.id(),a.id())?i:null}isApplyingStateChangeMutation(){return this._isApplyingStateChangeMutation}isResettingStateChangeMutations(){return this._isResettingStateChangeMutations}_findTransitionRootForSwappedPath(e){var n;let r=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e);for(;r!=null;){if(r.transitioningFrom!=null&&r.transitioningFrom.swappedStablePath==e)return r;r=r.parent()}return null}_finishStateSwapMutation(e){let r=this._findTransitionRootForSwappedPath(e);if(this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation started for ${e}`),r==null)return;let n=r.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,r.transitioningFrom=null,n.removeSelfAndSubtree(),this._isApplyingStateChangeMutation=!1,r.invalidateRenderTreeForSelfAndParents(),r.invalidateRenderTreeForChildren(),this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation finished for ${e}`)}_getFullscreenNodeChangesForStateSwap(e,r,n,o){return F().getNodeChangesForSwap(e,r,n,o)}_shouldDisallowSwap(e,r){return F().shouldDisallowSwap(e,r)}logVerbose(e){this.VERBOSE_LOGS&&(this.debugHSMTree(),console.log(e()))}};(r=>{class t{constructor(o,i){this.change=o,this.history=i}}r.StateChangeRequest=t;let e;(i=>(i[i.WAIT_UNTIL_DESTINATIONS_LOADED=0]="WAIT_UNTIL_DESTINATIONS_LOADED",i[i.FORCE_INITIATE_NOW=1]="FORCE_INITIATE_NOW"))(e=r.InitiateRequestedStateChangePolicy||(r.InitiateRequestedStateChangePolicy={}))})(hs||(hs={}));var _s=(r=>(r[r.FIX_INVALID_STATE=0]="FIX_INVALID_STATE",r[r.USER_REQUESTED=1]="USER_REQUESTED",r))(_s||{});var ad=class{constructor(e,r,n,o){this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=e,r?(this.stablePath=r.stablePath(),o?this.resetHistoryToFirstFrameInSection(r):this.resetHistoryToState(n)):(this.stablePath=new ht([]),this.setChangeHistory([]))}changeHistory(){return this._changeHistory}setChangeHistory(e){this._changeHistory=e}debugHierarchy(e){return this._debugHierarchy(0,e)}_debugHierarchy(e,r){let n="";for(let p=0,_=e;p<_;p=p+1)n+="  ";n+=this.stablePath.toString()+": ";let o="missing state name",i="(N/A)";if(this.stateId()!=null){let p=r.findNode(this.stateId());p!=null&&(o=p.name()??"null state name"),i="("+this.stateId()+")"}n+="<"+o+" "+i+">";let a="[",s=0,l=3,c=this.changeHistory();c.length>l&&(a+="..., ",s=c.length-l);for(let p=s,_=c.length;p<_;p=p+1){let h=c[p];a+=`${(h==null?void 0:h.oldStateId())??"null"}->${h==null?void 0:h.newStateId()}`,p!=c.length-1&&(a+=", ")}a+="]",n+=" "+a;let d=r.findNodeByStablePath(this.stablePath);if(d!=null){let p=d.name()??"null node name";n+=" "+p}let u=this.initiatedChange()!=null?`{${this.initiatedChange().oldStateId()??"null"}->${this.initiatedChange().newStateId()}}`:"";n+=" "+u+`
`;for(let p of Array.from(this._children.values()))n+=p._debugHierarchy(e+1,r);return n}removeChild(e){this._children.delete(e)}setChild(e,r){this._children.set(e,r)}childOrNull(e){return Qe.StringMap_get(this._children,e,null)}getChildren(){return Array.from(this._children.values())}stage(e,r){this._initiatedChange=e,this._initiatedChangeHistory=r}initiatedChange(){return this._initiatedChange}initiatedChangeHistory(){return this._initiatedChangeHistory}stateId(){var r,n;if(((r=this.initiatedChange())==null?void 0:r.newStateId())!=null)return(n=this.initiatedChange())==null?void 0:n.newStateId();let e=this.changeHistory();return e!=null&&e.length>0?ie.List_last(e).newStateId():Q.invalid()}clearInitiatedChangesInSelfAndSubstates(){this._isClearingChangesInSelfAndSubstates=!0,this._prototypeState.commitChangesBelowInstanceTransitionRoot(this.stablePath),this._isClearingChangesInSelfAndSubstates=!1}isClearingChangesInSelfAndSubstates(){return this._isClearingChangesInSelfAndSubstates}cloneHistoryForReturnToState(e,r){let n=e!=2,o=null,i=this.changeHistory().slice();for(;i.length>1&&(n&&ie.List_last(i).isTransientChange());)o=i.pop();if(e==0||i.length<=1)return new ho(o,i);for(o=ie.List_last(i);i.length>1;){let a=i.pop();if(!(i.length>1&&n&&ie.List_last(i).isTransientChange()||r(a.newStateId(),a.oldStateId())==null))break}return new ho(o,i)}resetHistoryToState(e){let r=new on(2,this.stablePath,null,e,Lo.EXTERNAL,null,rn.getDefault(),0);this.setChangeHistory([r])}resetHistoryToFirstFrameInSection(e){let r=Zs.visuallySortedTopLevelFrames(e);if(r.length>0){let n=r[0];if(n!=null){let o=new on(2,this.stablePath,null,n.id(),Lo.EXTERNAL,null,rn.getDefault(),0);this.setChangeHistory([o])}}else this.setChangeHistory([])}broadcastHsmStateChange(e,r,n,o){let i=this._isNotifyingStateChangeObservers;switch(i&&console.warn("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,n){case 0:{e.forEach(a=>{a.handleHsmRequested(this.stablePath,r)});break}case 1:{e.forEach(a=>{a.handleHsmInitiated(this.stablePath,r)});break}case 2:{e.forEach(a=>{a.handleHsmAborted(this.stablePath,r)});break}case 3:{e.forEach(a=>{a.handleHsmCommitted(this.stablePath,r,o)});break}}this._isNotifyingStateChangeObservers=i}};var Hm=class{track(e,r){this._frameRequestInfo.set(e,r)}getMetricsForRequestedNode(e){return this._frameRequestInfo.get(e)}clear(){this._frameRequestInfo.clear()}constructor(){this._frameRequestInfo=new Map}};var zm=class{hash(){return nn.bytesToHex(this._hash)}binaryHash(){return this._hash}getVideoManager(){return this._videoManager}size(e){let r=this._videoManager.getVideoRuntimeForPaint(e);return r?r.size():new O(0,0)}didLoad(e){let r=this._videoManager.getVideoRuntimeForPaint(e);return r==null?!1:r.isReadyToPlay()}getOrCreateTexture(e,r,n){let o=this._videoManager.getVideoRuntimeForPaint(e);return o==null||o.shouldDisplayThumbnail?null:o.getOrCreateTexture(r,n)}pause(e){let r=this._videoManager.getVideoRuntimeForPaint(e);r!=null&&r.pause()}constructor(e,r){this.id=QM++,this._hash=e,this._videoManager=r,this._loadComplete=!1}},QM=0;var To;(e=>e.VERBOSE_LOGS=!1)(To||(To={}));var ld=class ld{constructor(e,r,n){this._videoLoadAttemptId=0;this.id=(ld.nextID=ld.nextID+1)+-1,this._videoResolver=r,this._hash=e,this._videoManager=n,this._loadTimeTracker=new qA,this._loadComplete=!1,this._texture=null,this._player=null,this._isInErrorState=!1,this._isErrorRetryable=null,this._fileTypeLoading="hls",this._loop=!1,this._seeking=!1,this._overrideSeeking=!1,this._prevReadyState=sd.HAVE_NOTHING,this.overriddenPlayingState=null,this.overriddenMutedState=null,this.shouldDisplayThumbnail=!0,this._MP4VideoUrl=null,this._loaded=new Un,this._preloadedData=null}clone(){let e=new ld(this._hash,this._videoResolver,this._videoManager);return this._videoManager.enqueueVideoOrStartLoad(e),e}isReadyToPlay(){if(this._player==null||!this._loadComplete||this._isInErrorState)return!1;if(Wt.ios()||this.isSeeking())return this._player.readyState()>sd.HAVE_NOTHING;{let e=this._player.currentTime()==this._player.duration()&&this._player.readyState()>=sd.HAVE_CURRENT_DATA;return this._player.readyState()>=sd.HAVE_FUTURE_DATA||e}}isInErrorState(){return this._isInErrorState}isErrorRetryable(){return this._isErrorRetryable}uninitialize(){this._player!=null&&(this.pause(),this.setMuted(!1),this.resetToStartTime(),this._player.dispose(),this._player=null,this.clearPreloadedData())}clearPreloadedData(){this._preloadedData!=null&&(URL.revokeObjectURL(this._preloadedData.objectUrl),this._preloadedData=null)}toString(){if(this._player==null)return`Runtime(id=${this.id},  <NO VIDEO INFORMATION> )`;let e=this._player.currentTime()|0,r=Ft.int_remainder(e,60)<10?`0${Ft.int_remainder(e,60)}`:`${Ft.int_remainder(e,60)}`,o=`${(e/60|0)<10?`0${e/60|0}`:`${e/60|0}`}:${r}`;return this._isInErrorState?`Runtime(id=${this.id}, <LOADING ERROR>)`:`Runtime(id=${this.id}, time=${o}, ready=${this.isReadyToPlay()}, P=${!this._player.paused()}, M=${this._player.muted()}, L=${this._loop})`}_setMuted(e,r){if(this._player!=null){Wt.ios()&&!e&&this._videoManager.muteAllOtherVideos(this);try{this._player.muted(e),r&&(this.overriddenMutedState=new pe(e))}catch{be.trackEvent("video_mute_failure",{errorState:this._isInErrorState,loadComplete:this._loadComplete,fileType:this._fileTypeLoading})}}}setMutedByVideoAction(e){this._setMuted(e,!0)}setMuted(e){this._setMuted(e,!1)}setShouldDisplayThumbnail(e){this.shouldDisplayThumbnail=e}muted(){return this._player!=null?this._player.muted():!0}ended(){var e;return((e=this._player)==null?void 0:e.ended())||!1}setLoop(e){this._loop=e}size(){return this._player==null?null:new O(this._player.videoWidth(),this._player.videoHeight())}_pause(e){To.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Pausing"),this._player!=null&&(this._player.pause(),e&&(this.overriddenPlayingState=new pe(!1)))}pauseByVideoAction(){this._pause(!0)}pause(){this._pause(!1)}_play(e,r){To.VERBOSE_LOGS&&(e?console.log("VideoResource #",this.id,": Loop playback"):console.log("VideoResource #",this.id,": Start playback")),this._player!=null&&this.isReadyToPlay()&&(this.shouldDisplayThumbnail=!1,this._player.play().then(n=>{r&&(this.overriddenPlayingState=new pe(!0)),this.reportPlaySuccessAnalytics()},n=>{var i;let o=n.message+"";o.indexOf("The play() request was interrupted")!=-1?this.reportPlayFailureAnalytics(e?`Loop error: ${o}`:o):(console.warn("User has yet to interact with page, starting video muted",n),this.setMuted(!0),(i=this._player)==null||i.play().then(a=>{this.reportPlaySuccessAnalytics()},a=>{let s=a.message+"";e&&(s=`Loop error: ${s}`),this.reportPlayFailureAnalytics(s)}))}))}_playLoop(){this._play(!0,!1)}playByVideoAction(){this._play(!1,!0)}play(){this._play(!1,!1)}duration(){return this._player!=null?this._player.liveTracker!=null?this._player.liveTracker.seekableEnd():this._player.duration():0}currentTime1(){return this._player!=null?this._player.currentTime():0}currentTime2(e){this._player!=null&&(this._player.paused()&&this._player.one("timeupdate",r=>{this.invalidateTexture()}),this._player.currentTime(e))}resetToStartTime(){this.currentTime2(0)}isPlaying(){return this._player==null?!1:!this._player.paused()}setIsSeeking(e){this._overrideSeeking=e}isSeeking(){return this._seeking||this._overrideSeeking}invalidateTexture(){if(this._texture==null)return;this._texture.invalidateVideoFrame()}_handleOnLoadedMetadata(e){var r;To.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Loading completed"),this.reportLoadSuccessAnalytics(e),this._loadComplete=!0,window.vid=this,this._loaded.resolve(),(r=this._videoManager)==null||r.onVideoLoaded(this)}_getVideoLoadAttemptIdAndIncrement(){return(this._videoLoadAttemptId++).toString()}_beginLoadingHLS(e){var r,n;this._loadTimeTracker.start(),this._fileTypeLoading="hls",(r=this._player)==null||r.src({type:"application/x-mpegURL",src:this._videoResolver.manifestUrl}),(n=this._player)==null||n.one("error",o=>{this._loadTimeTracker.end(),console.warn("Reverting to fallback media source"),this.reportLoadFailureAnalytics("Failed to access HLS manifest",e),this._beginLoadingMP4(e)})}_beginLoadingMP4(e,r=!1){this._loadTimeTracker.start(),this._fileTypeLoading="mp4",this._videoResolver.fetchMp4Url().then2(n=>{var o,i;r?fetch(n).then(a=>a.blob()).then(a=>{this._player&&(this._preloadedData={blob:a,objectUrl:URL.createObjectURL(a)},this._player.src({type:"video/mp4",src:this._preloadedData.objectUrl}))}):(o=this._player)==null||o.src({type:"video/mp4",src:n}),(i=this._player)==null||i.one("error",a=>{this._loadTimeTracker.end(),this._isInErrorState=!0,this._isErrorRetryable=!1;try{this.reportLoadFailureAnalytics(`Failed to access mp4. Error code: ${a.code} Message: ${a.message}`,e)}catch{this.reportLoadFailureAnalytics("Failed to access mp4.",e)}})},({message:n,statusCode:o})=>{this._loadTimeTracker.end(),this.reportLoadFailureAnalytics(`Failed to acquire mp4 url. ${n}`,e),this._isInErrorState=!0,this._isErrorRetryable=o!=404})}getMP4VideoBlob(){var e;return((e=this._preloadedData)==null?void 0:e.blob)||null}startLoadIfNeeded(e=!1){if(this._player!=null&&!e||e&&this._isPreloaded)return;this._isPreloaded=e;let r=this._getVideoLoadAttemptIdAndIncrement(),n=document.createElement("video");if(n.crossOrigin="anonymous",n.style.display="none",document.body.appendChild(n),this._player=vo.instance().getPlayer(n,e?"auto":void 0),this._player==null){vo.instance().isLibAvailable()&&(this._isInErrorState=!0,this._isErrorRetryable=!1,this.reportLoadFailureAnalytics("Failed to create VideoJS player",r));return}this._player.muted(!0),this._player.playsinline(!0),this._player.autoplay(!1),this._player.loop(!1),this._player.ready(()=>{var o,i,a,s;(o=this._player)==null||o.on("ended",l=>{this._loop?this._playLoop():this.resetToDefaultState()}),(i=this._player)==null||i.on("seeking",l=>{this._seeking=!0}),(a=this._player)==null||a.on("seeked",l=>{this._seeking=!1}),(s=this._player)==null||s.on("loadedmetadata",l=>{this._handleOnLoadedMetadata(r)})}),e?this._beginLoadingMP4(r,!0):this._beginLoadingHLS(r)}on(e,r){let n=o=>{r(this._player)};return this._player!=null&&this._player.on(e,n),n}off(e,r){this._player!=null&&this._player.off(e,r)}getHtmlVideoElement(){return this._player==null||!this._loadComplete?null:qd.VideoJsPlayer_getBackingVideo(this._player)}getOrCreateTexture(e,r){if(this._texture==null&&this._loadComplete&&this._player){let n=qd.VideoJsPlayer_getBackingVideo(this._player);this._texture=e.createTextureWithVideo(r,n,br.IMAGE)}return!this.isReadyToPlay()||this.isInErrorState()?null:this._texture}resetToDefaultState(){this.overriddenPlayingState=null,this.overriddenMutedState=null}_getCurrentLocation(){return window.location.href.indexOf("/community/")!=-1?"community_viewer":"viewer"}reportLoadFailureAnalytics(e,r){this._loadTimeTracker.end();let n=this._loadTimeTracker.getLoadTime();n<0||(console.warn("Video failed to load:",e),be.trackDefinedEvent("prototype.video_load",{status:"failure",hash:this._hash,load_time:n,file_type:this._fileTypeLoading,reason:e,location:this._getCurrentLocation(),attempt_id:r,runtime_id:this.id.toString()}))}reportLoadSuccessAnalytics(e){var n,o;this._loadTimeTracker.end();let r=this._loadTimeTracker.getLoadTime();r<0||be.trackDefinedEvent("prototype.video_load",{status:"success",hash:this._hash,load_time:r,file_type:this._fileTypeLoading,width:(n=this._player)==null?void 0:n.videoWidth(),height:(o=this._player)==null?void 0:o.videoHeight(),location:this._getCurrentLocation(),attempt_id:e,runtime_id:this.id.toString()})}reportPlaySuccessAnalytics(){be.trackDefinedEvent("prototype.video_play",{status:"success",hash:this._hash,location:this._getCurrentLocation()})}reportPlayFailureAnalytics(e){be.trackDefinedEvent("prototype.video_play",{status:"failure",hash:this._hash,reason:e,location:this._getCurrentLocation()})}waitForLoad(){return this._loaded}};ld.nextID=0;var $l=ld,sd;(i=>(i.HAVE_NOTHING=0,i.HAVE_METADATA=1,i.HAVE_CURRENT_DATA=2,i.HAVE_FUTURE_DATA=3,i.HAVE_ENOUGH_DATA=4))(sd||(sd={}));var qA=class{start(){this._endConditionSeconds=-1,this._startConditionSeconds=Xe.seconds()}end(){this._endConditionSeconds=Xe.seconds()}getLoadTime(){return this._endConditionSeconds<0||this._startConditionSeconds<0?-1:this._endConditionSeconds-this._startConditionSeconds}constructor(){this._startConditionSeconds=-1,this._endConditionSeconds=-1}},dp=class extends Qs{uninitialize1(){this.uninitialize2(e=>{e.uninitialize()})}toString1(){return this.toString2(e=>e.toString())}constructor(){super()}};var up=class{constructor(e){this._hash=e}},pp=class extends Un{},JA=new class extends up{get manifestUrl(){return""}fetchMp4Url(){let t=new pp;return t.resolve(""),t}}(""),XA=class extends up{constructor(r){super(r);this._cachedMp4Url=void 0;let n=Vt.getVideoPrefixUrl(),o=n!=null&&n.endsWith("/")?n:n+"/";this._metaMp4Url=`${o}${this._hash}`,this._manifestUrl=`${this._metaMp4Url}/manifest`}get manifestUrl(){return this._manifestUrl}fetchMp4Url(){let r=new pp;return this._cachedMp4Url?(r.resolve(this._cachedMp4Url),r):(new Vo(this._metaMp4Url).userIdHeader().get().then(n=>{let o=null;try{o=JSON.parse(n.text)}catch{r.reject({message:"Failed to parse response"});return}let i=new pe(o.status);if(i.value===void 0){r.reject({message:"Failed to parse status from response"});return}if(i.value!=200){r.reject({message:`Status is ${i.value}: ${o.message}`,statusCode:i.value});return}let a=o.meta;if(a===void 0){r.reject({message:"Failed to parse signed_url",statusCode:i.value});return}let s=a.signed_url;if(s===void 0){r.reject({message:"Failed to parse signed_url",statusCode:i.value});return}this._cachedMp4Url=s,r.resolve(s)},n=>{r.reject({message:"Request failed",statusCode:n.status})}),r)}},ZA=class extends up{constructor(e){super(e),this._mp4Url=`https://static.figma.com/uploads/${e}`}get manifestUrl(){return""}fetchMp4Url(){let e=new pp;return e.resolve(this._mp4Url),e}};function aP(t){return _n?new ZA(t):new XA(t)}var Wm=class{constructor(e){this._visiblePaints=new Set([]),this._appState=null,this._lastStateChange=null,this._appState=e}isPaintVisible(e){return this._visiblePaints.has(e)}getAllVisiblePaints(){return this._visiblePaints}forEachVisiblePaint(e){for(let r=0,n=Array.from(this._visiblePaints.values()).length;r<n;r=r+1)e(Array.from(this._visiblePaints.values())[r])}refreshVisibleVideosIfNeeded(){this.handlePrototypeStateChange(this._lastStateChange)}handlePrototypeStateChange(e){var a;if(e==null)return;this._visiblePaints=new Set;let r=e.newStateId(),n=(a=this._appState.scene())==null?void 0:a.findNode(r);if(n==null)return;this._lastStateChange=e,this._gatherVisibleVideoResources(n);let o=e.newOverlayData();for(let s=0,l=o.length;s<l;s=s+1){let c=this._appState.scene().findNode(o[s].id);this._gatherVisibleVideoResources(c)}let i="";this.forEachVisiblePaint(s=>{i+=" "+s.id().toString()+","}),To.VERBOSE_LOGS&&console.log("Found these visible paints:",i)}_gatherVisibleVideoResources(e){if(!e.visible())return;for(let n=0,o=e.childCount();n<o;n=n+1)this._gatherVisibleVideoResources(e.childAt1(n));let r=null;if(e.getCachedRenderTree()!=null)r=e.getCachedRenderTree();else if(e.getCachedRenderTreeForBaseScreen()!=null)r=e.getCachedRenderTreeForBaseScreen();else return;this._gatherVideosFromRenderNode((r==null?void 0:r.value)??null)}_gatherVideosFromRenderNode(e){if(e!=null)switch(e.op()){case 3:{this._gatherVideosFromFillNode(e);break}case 4:{this._gatherVideosFromFillStrokeNode(e);break}case 16:{this._gatherVideosFromScatterBrushFillNode(e);break}case 5:{this._gatherVideosFromMaskNode(e);break}case 1:{this._gatherVideosFromGroupNode(e);break}case 6:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 2:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 9:{let r=e;this._gatherVideosFromRenderNode(r.alpha);break}case 7:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 8:{let r=e;this._gatherVideosFromRenderNode(r.tree);break}case 10:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 11:{let r=e;this._gatherVideosFromRenderNode(r.child);break}case 12:{let r=e;this._gatherVideosFromRenderNode(r.startChild),this._gatherVideosFromRenderNode(r.endChild);break}case 0:{let r=e;this._gatherVideosFromRenderNode(r.child);break}}}_gatherVideosFromScatterBrushFillNode(e){for(let r=0,n=e.fillGeometries.length;r<n;r=r+1){let o=e.fillGeometries[r].paints;Se.forEachPaintWithVideo(o,i=>{this._visiblePaints.add(i)})}}_gatherVideosFromFillNode(e){let r=e.geometry.paints;Se.forEachPaintWithVideo(r,n=>{this._visiblePaints.add(n)})}_gatherVideosFromFillStrokeNode(e){let r=e.fillGeometries;for(let n=0,o=r.length;n<o;n=n+1){let i=r[n].paints;Se.forEachPaintWithVideo(i,a=>{this._visiblePaints.add(a)})}for(let n=0,o=e.strokeGeometries.length;n<o;n=n+1){let i=e.strokeGeometries[n].paints;Se.forEachPaintWithVideo(i,a=>{this._visiblePaints.add(a)})}}_gatherVideosFromMaskNode(e){this._gatherVideosFromRenderNode(e.color)}_gatherVideosFromGroupNode(e){for(let r=0,n=e.children.length;r<n;r=r+1)this._gatherVideosFromRenderNode(e.children[r])}getLastTopLevelStateChange(){return this._lastStateChange}};var ha=class ha extends $l{constructor(r,n,o,i){super(r,JA,i);this.guid="";this._isPlaying=!1;this._isPlayingSound=!0;this._currentTime=0;this._isReady=!1;this._duration=1/0;this.eventListener=r=>{var o,i,a,s;if((r==null?void 0:r.origin)!==ha.eventOrigin)return;let n=this.parseEventData(r);if(!(!n||n.id!==this.channelId||n.channel!==ha.channel))switch(n.event){case"onReady":this._isReady=!0;break;case"infoDelivery":if(typeof((o=n.info)==null?void 0:o.playerState)=="number"&&(n.info.playerState===1||n.info.playerState===2||n.info.playerState===3)){let l=n.info.playerState===1||n.info.playerState===3;this._isPlaying!==l&&(this._isPlaying=l,this._videoManager.updateVideoRuntime(this.getMediaAction(l?"PLAY":"PAUSE"),this.guid))}if(typeof((i=n.info)==null?void 0:i.muted)=="boolean"){let l=n.info.muted===!1;this._isPlayingSound!==l&&(this._isPlayingSound=l)}typeof((a=n.info)==null?void 0:a.currentTime)=="number"&&(this.shouldSeek(n.info.currentTime)&&this._videoManager.updateVideoRuntime(this.getMediaAction("SKIP_TO",{mediaSkipToTime:new pe(n.info.currentTime)}),this.guid),this._currentTime=n.info.currentTime),typeof((s=n.info)==null?void 0:s.duration)=="number"&&(this._duration=n.info.duration);break}};this.guid=n,this.iframe=o,this.channelId=ha.currentChannelId++,this.subscribeToEvents()}subscribeToEvents(){var r;window.addEventListener("message",this.eventListener),(r=this.iframe.contentWindow)==null||r.postMessage(JSON.stringify({event:"listening",id:this.channelId,channel:ha.channel}),"*")}issueCommand(r,n){var o,i;(i=(o=this.iframe)==null?void 0:o.contentWindow)==null||i.postMessage(JSON.stringify({event:"command",func:r,args:n}),ha.eventOrigin)}parseEventData(r){try{return JSON.parse(r.data)}catch{return null}}getMediaAction(r,n={}){let o=dr.NULL_ACTION.withTransitionNodeID(this.guid).withMediaAction(r);return n.mediaSkipToTime?o.withMediaSkipToTime(n.mediaSkipToTime.value):o}shouldSeek(r){return!isNaN(r)&&Math.abs(this._currentTime-r)>2}clone(){let r=new ha(this._hash,this.guid,this.iframe,this._videoManager);return this._videoManager.enqueueVideoOrStartLoad(r),r}isReadyToPlay(){return this._isReady}isInErrorState(){return!1}uninitialize(){window.removeEventListener("message",this.eventListener)}toString(){return`YoutubeRuntime(${this.guid})`}_setMuted(r,n){}muted(){return!this._isPlayingSound}size(){return new O(0,0)}_pause(r){this._isPlaying&&(this._isPlaying=!1,this.issueCommand("pauseVideo"))}_play(r,n){this._isPlaying||(n&&this._isPlayingSound&&(this._isPlayingSound=!1,this.issueCommand("mute")),this._isPlaying=!0,this.issueCommand("playVideo"))}duration(){return this._duration}currentTime1(){return this._currentTime}currentTime2(r){this.shouldSeek(r)&&(this._currentTime=r,this.issueCommand("seekTo",[r,!0]))}isPlaying(){return this._isPlaying}resetToDefaultState(){this.issueCommand("stopVideo")}setLoop(r){}invalidateTexture(){}startLoadIfNeeded(){}on(r,n){return i=>{}}off(r,n){}reportLoadFailureAnalytics(r){}reportLoadSuccessAnalytics(){}reportPlayFailureAnalytics(r){}};ha.currentChannelId=1,ha.channel="widget",ha.eventOrigin="https://www.youtube.com";var Km=ha;var dd=class t{constructor(e,r,n,o){this.status=t.Status.PENDING,this.interactionType=e,this.interactionID=r,this.hotspotNodeID=n,this.listener=o,this.internalEventListeners=[]}};(e=>{let t;(i=>(i[i.PENDING=0]="PENDING",i[i.ACTIVE=1]="ACTIVE",i[i.SUPERCEDED=2]="SUPERCEDED"))(t=e.Status||(e.Status={}))})(dd||(dd={}));var cd=class{constructor(e,r){this.nodePath=e,this.videoPlayback=r}},_p=class{constructor(e,r){this.eventName=e,this.listener=r}},XM="VideoManager",ZM=150,hp=class t{constructor(e){this.getVideoRuntimeForPaint=e=>{var a;if(!this._paintToNodeGUIDMap.has(e))return null;let r=this._paintToNodeGUIDMap.get(e);if(!r)return null;let n=(a=this.getNodeMetadata(r))==null?void 0:a.nodePath;if(!n)return null;let o=e.video().hash();return this._runtimeStorage.getData(n,o)};this._appState=null,this._guidToVideoMetadata=new Map,this._hashToRuntimeMap=new Map,this._nodeGUIDToVideoHashesMap=new Map,this._paintToNodeGUIDMap=new Map,this._runtimeStorage=new dp,this._deferredRuntimes=new Set,this._deferredInteractionEvents=new Set,this._visibilityTracker=null,this._needToRecalculateVisibleVideos=!1,this._framePotentiallyReadyToPlay=!0,this._paintsForPlaybackSettingsRefresh=new Set,this._lastTransitionShouldForceStateRefresh=!1,this._userHasInteractedWithPage=!1,this._appState=e,this._visibilityTracker=new Wm(e),this._lastPlayedVideo=null,this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._appState.addActionObserver(this),this._appState.addAppObserver(this),this._videoRuntimeUpdateSubscriptionKey=0,this._videoRuntimeUpdateSubscriptions=new Map}runtimeStorage(){return this._runtimeStorage}subscribeToVideoRuntimeUpdates(e){let r=this._videoRuntimeUpdateSubscriptionKey;return this._videoRuntimeUpdateSubscriptionKey+=1,this._videoRuntimeUpdateSubscriptions.set(r,e),()=>{this._videoRuntimeUpdateSubscriptions.delete(r)}}_fireVideoRuntimeSubscriptions(){this._videoRuntimeUpdateSubscriptions.forEach(e=>e())}associatePaintWithNode(e,r){this._needToRecalculateVisibleVideos=!0;let n=r.uniqueIdentifier();this._paintToNodeGUIDMap.set(e,n);let o=this._nodeGUIDToVideoHashesMap.get(n);o||(o=[],this._nodeGUIDToVideoHashesMap.set(n,o)),o.push(e.video().hash()),this._guidToVideoMetadata.set(n,new cd(Nr.getSemanticNodePath(r),r.videoPlayback())),this._paintsForPlaybackSettingsRefresh.add(e),this._fireVideoRuntimeSubscriptions()}associateYoutubeWithNode(e,r){let n=e;if(!this._hashToRuntimeMap.has(n)){let a=new Km(n,e,r,this);this._hashToRuntimeMap.set(n,a)}let o=this.getNodePathForNode(e);this._guidToVideoMetadata.set(e,new cd(o,{autoplay:!1,mediaLoop:!1,muted:!1,showControls:!1}));let i=this._hashToRuntimeMap.get(n).clone();this._runtimeStorage.insert(o,n,i),this._fireVideoRuntimeSubscriptions()}disassociateYoutubeWithNode(e){let r=e;this._hashToRuntimeMap.has(r)&&this._hashToRuntimeMap.delete(r),this._guidToVideoMetadata.has(e)&&this._guidToVideoMetadata.delete(e);let n=this.getNodePathForNode(e);this._runtimeStorage.remove(n,r),this._fireVideoRuntimeSubscriptions()}getNodePathForNode(e){let r=this._appState.scene();if(!r)return[];let n=r.findNode(e);if(!n)return[];let o=[];for(;n;)o.unshift(new Ys(n.name(),this.getPositionOutOfAllSiblingsWithSameName(n))),n=n.parent();return o}getPositionOutOfAllSiblingsWithSameName(e){let r=0,n=e.parent();if(n){let o=!1;n.forEachChild(i=>{o=o||i.id()===e.id(),!o&&i.name()===e.name()&&(r+=1)})}return r}getNodeMetadata(e){if(this._guidToVideoMetadata.has(e))return this._guidToVideoMetadata.get(e)}getPlaybackSettingsForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let r=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(r).videoPlayback;return n==null&&(n={autoplay:!0,mediaLoop:!0,muted:!1,showControls:!1}),n}getRuntimesForVisibleVideos(){return Array.from(this._visibilityTracker.getAllVisiblePaints()).flatMap(e=>this.getVideoRuntimeForPaint(e)||[])}_populateRuntimesForVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintToNodeGUIDMap.has(e))return;let r=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(r).nodePath;if(this.getVideoRuntimeForPaint(e)!=null)return;let o=e.video().hash(),i=this._hashToRuntimeMap.get(o).clone();this._runtimeStorage.insert(n,o,i)})}getVideoRuntimesForNode(e){var o;let r=(o=this.getNodeMetadata(e))==null?void 0:o.nodePath;if(r==null)return null;let n=this._runtimeStorage.getAllDataForNode(r);return n==null?null:Xu._filter(n,i=>(this._nodeGUIDToVideoHashesMap.get(e)??[]).includes(i))}updateVideoRuntime(e,r){let n=Q.isValid(e.transitionNodeID())?e.transitionNodeID():r;if(!this._guidToVideoMetadata.has(n))return;let o,i,a=[],s=this.getVideoRuntimesForNode(n);s!=null&&(s.forEach((l,c)=>{if(l==null)return;let d=e.mediaAction();switch(d){case"PLAY":{this.playVideo(l,n,d);break}case"PAUSE":{l.pauseByVideoAction();break}case"TOGGLE_PLAY_PAUSE":{l.isPlaying()?l.pauseByVideoAction():this.playVideo(l,n,d);break}case"MUTE":{l.setMutedByVideoAction(!0);break}case"UNMUTE":{l.setMutedByVideoAction(!1);break}case"TOGGLE_MUTE_UNMUTE":{l.setMutedByVideoAction(!l.muted());break}case"SKIP_FORWARD":{let u=e.mediaSkipByAmount(),p=Math.min(l.currentTime1()+u,l.duration()-.01);l.currentTime2(p);break}case"SKIP_BACKWARD":{let u=e.mediaSkipByAmount(),p=Math.max(0,l.currentTime1()-u);l.currentTime2(p);break}case"SKIP_TO":{let u=e.mediaSkipToTime(),p=Math.max(0,u);p=Math.min(p,l.duration()-.01),l.currentTime2(p);break}}o=l.isPlaying(),i=!l.muted(),a.push(l.currentTime1()*1e3)}),o!=null&&i!=null&&a.length>0&&this._createVideoStateChangeInPrototypeState(n,o,i,a))}snapshotVideoStates(e=[...this._guidToVideoMetadata.keys()]){e.forEach(r=>{let n=null,o=null,i=[],a=this.getVideoRuntimesForNode(r);a!=null&&(a.forEach(s=>{n=s.isPlaying(),o=!s.muted(),i.push(s.currentTime1()*1e3)}),n!=null&&o!=null&&i.length>0&&this._createVideoStateChangeInPrototypeState(r,n,o,i))})}_createVideoStateChangeInPrototypeState(e,r,n,o){this._appState.prototypeState().createVideoStateChange(e,r,n,o,this._currentTruncatedTimeInMilliseconds())}resetVideoStateChanges(e){Array.from(e.keys()).forEach(r=>{if(!this._guidToVideoMetadata.has(r))return;let n=this.getVideoRuntimesForNode(r);if(n==null)return;let o=[];n.forEach((i,a)=>{o.push(i.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(r,o)})}_createDefaultVideoStateChangeInPrototypeState(e,r){var i;let n=(i=this.getNodeMetadata(e))==null?void 0:i.videoPlayback,o=!(n!=null&&n.muted);this._appState.prototypeState().createVideoStateChange(e,(n==null?void 0:n.autoplay)??!1,o,r,this._currentTruncatedTimeInMilliseconds())}multiplayerUpdateVideoRuntimes(e,r){let n=Q.fromFigGUID(r.targetNodeId);if(!this._guidToVideoMetadata.has(n))return;let o=this.getVideoRuntimesForNode(n);if(o==null)return;let i=0;o.forEach((a,s)=>{if(a!=null){if(r.isPlaying!=a.isPlaying()&&(a.isPlaying()?a.pauseByVideoAction():(a.playByVideoAction(),this._lastPlayedVideo=n)),r.isPlayingSound!=!a.muted()&&a.setMutedByVideoAction(!r.isPlayingSound),!a.isPlaying()||r.currentTimes[i]!=e[i]){let l=this._currentTruncatedTimeInMilliseconds()-r.actionTakenTimestamp,d=(a.isPlaying()?r.currentTimes[i]+l:r.currentTimes[i])%(a.duration()*1e3);Math.abs(d-a.currentTime1()*1e3)>ZM&&a.currentTime2(d/1e3)}i+=1}})}_currentTruncatedTimeInMilliseconds(){return Date.now()%1e6}_registerDeferredInteractionEvent(e){if(e.status==1)return;let r=this.getVideoRuntimesForNode(e.hotspotNodeID);if(r!=null){for(let n of Array.from(r.keys())){let o=r.get(n);if(e.interactionType=="ON_MEDIA_END"){let i=o.on("ended",a=>{e.listener(a)});e.internalEventListeners.push(new _p("ended",i))}else if(e.interactionType=="ON_MEDIA_HIT"){let i=o.on("timeupdate",a=>{e.listener(a)});e.internalEventListeners.push(new _p("timeupdate",i)),i=o.on("play",a=>{e.listener(a)}),e.internalEventListeners.push(new _p("play",i))}}e.status=1}}_deregisterDeferredInteractionEvent(e){if(e.status!=2)return;let r=this.getVideoRuntimesForNode(e.hotspotNodeID);if(r!=null)for(let n of Array.from(r.keys())){let o=r.get(n);for(let i of e.internalEventListeners)o.off(i.eventName,i.listener)}}_getListenerForInteractionEvent(e,r,n){let o=null;if(e=="ON_MEDIA_END")o=i=>{n()};else if(e=="ON_MEDIA_HIT"){let i=!1;o=a=>{let s=a.currentTime(),l=a.liveTracker?a.liveTracker.seekableEnd():a.duration();r>l&&(r=l);let c=.3;if(s>=r-c&&s<r){let d=Math.ceil((r-s)*1e3)|0;setTimeout(()=>{let u=a.currentTime(),p=a.paused()&&u<r,_=u>=r&&u<r+c;!i&&!p&&_&&(i=!0,n())},d)}else i=!1}}else console.error("videoManager.addInteractionEvent() should only be called with video trigger events");return o}addInteractionEvent(e,r,n,o){let i=e.event().interactionType(),a=this._getListenerForInteractionEvent(i,n,o),s=new dd(i,e.id(),r,a);for(let l of Array.from(this._deferredInteractionEvents.values()))l.interactionID==s.interactionID&&(l.status=2,vo.instance().isLibAvailable()&&(this._deregisterDeferredInteractionEvent(l),this._deferredInteractionEvents.delete(l)));vo.instance().isLibAvailable()&&this._registerDeferredInteractionEvent(s),this._deferredInteractionEvents.add(s)}onFrame(){if(To.VERBOSE_LOGS&&console.log(this.debugString()),this._visibilityTracker!=null){if(this._needToRecalculateVisibleVideos&&(this._visibilityTracker.refreshVisibleVideosIfNeeded(),this._populateRuntimesForVisibleVideos(),this._framePotentiallyReadyToPlay=!0,this._needToRecalculateVisibleVideos=!1,To.VERBOSE_LOGS&&console.log(this.debugString())),this._framePotentiallyReadyToPlay&&this.allVisibleVideosAreLoaded()){this._framePotentiallyReadyToPlay=!1,this._applyPlaybackSettingsToVisibleVideos();for(let e of Array.from(this._deferredInteractionEvents.values()))e.status==0?this._registerDeferredInteractionEvent(e):e.status==2&&(this._deregisterDeferredInteractionEvent(e),this._deferredInteractionEvents.delete(e));To.VERBOSE_LOGS&&console.log(this.debugString())}this._invalidateTexturesOfPlayingVideos()}}resetAllRuntimesWithinNode(e){let r=new Kt(this._appState.scene().findNode(e)),n=Nr.getSemanticNodePath(r),o=this._runtimeStorage.getSubTrie(n),i=[];o!=null&&o.forEach(a=>{a.resetToStartTime(),i.push(a.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,i)}resetAllRuntimesWithinTLFNode(e){let r=this._appState.scene().findNode(e);if(!r){za.loge(XM,"Cannot find TLF node for resetAllRuntimesWithinTLFNode",{tlfGuid:e},{reportAsSentryError:!0,logToConsole:0});return}for(let i=0,a=r.childCount();i<a;i=i+1){let s=r.childAt1(i);this.resetAllRuntimesWithinNode(s.id())}let n=this._runtimeStorage.getSubTrie([new Ys(r.name(),0)]),o=[];n!=null&&n.forEach(i=>{i.resetToStartTime(),o.push(i.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,o)}handleHsmAborted(e,r){}handleHsmCommitted(e,r,n){if(this._lastTransitionShouldForceStateRefresh=r.transitionParameters.transitionResetVideoPosition,r.transitionParameters.transitionResetVideoPosition){let o=this._appState.scene().findNodeByStablePath(e);o&&this.resetAllRuntimesWithinNode(o.id())}this.reactToStateChange(this._visibilityTracker.getLastTopLevelStateChange(),r.getInsertedFrameIds())}handleHsmInitiated(e,r){}handleHsmRequested(e,r){}handleStateChangeCommitted(e,r){if(this._lastTransitionShouldForceStateRefresh=e.transitionParameters.transitionResetVideoPosition,e.transitionParameters.transitionResetVideoPosition){this.resetAllRuntimesWithinTLFNode(e.newStateId());let n=e.newOverlayData();for(let o=0,i=n.length;o<i;o=o+1)this.resetAllRuntimesWithinNode(n[o].id)}this.reactToStateChange(e,e.getInsertedFrameIds())}handleStateChangeAborted(e){}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){this._appState.isPreloaded||(this._lastPlayedVideo=null,this._deleteVisibleRuntimes(),this._framePotentiallyReadyToPlay=!0)}reactToStateChange(e,r){this._recalculateVisibleVideoPaints(e);let n=!0,o=new Set;this._visibilityTracker.forEachVisiblePaint(s=>{if(!this._paintToNodeGUIDMap.has(s))return;let l=s.video().hash(),c=this._paintToNodeGUIDMap.get(s),d=this.getNodeMetadata(c).nodePath,u=this.getVideoRuntimeForPaint(s);u!=null&&(o.add(u.id),this._lastPlayedVideo===c&&(n=!1));let p=this._appState.scene().findNode(c);for(let _ of r){let h=this._appState.scene().findNode(_);h!=null&&h.isAncestorOf(p)&&this._paintsForPlaybackSettingsRefresh.add(s)}if(u==null){let _=this._hashToRuntimeMap.get(l).clone();this._runtimeStorage.insert(d,l,_)}}),n&&(this._lastPlayedVideo=null);let i=Array.from(this._guidToVideoMetadata.entries()),a=new Set;i.forEach(([s,l])=>{var d;let c=(d=this._runtimeStorage.getAllDataForNode(l.nodePath))==null?void 0:d.values();c&&Array.from(c).forEach(u=>{!o.has(u.id)&&u.isPlaying()&&(u.pause(),a.add(s))})}),this.snapshotVideoStates([...a]),this._framePotentiallyReadyToPlay=!0}handleAction(e,r){this._userHasInteractedWithPage||(e==5||e==6||e==8||e==9||e==10)&&(this._userHasInteractedWithPage=!0,this._visibilityTracker.forEachVisiblePaint(n=>{let o=this.getVideoRuntimeForPaint(n),i=this.getPlaybackSettingsForPaint(n);o!=null&&i!=null&&!i.muted&&o.setMuted(i.muted)}),this._appState.removeActionObserver(this))}_applyPlaybackSettingsToVisibleVideos(){let e=[];this._visibilityTracker.forEachVisiblePaint(r=>{if(!this._paintsForPlaybackSettingsRefresh.has(r))return;this._paintsForPlaybackSettingsRefresh.delete(r);let n=this.getVideoRuntimeForPaint(r),o=this.getPlaybackSettingsForPaint(r),i=this._paintToNodeGUIDMap.get(r);if(!n||!o||!i)return;e.push(i),n.setLoop(o.mediaLoop),this._lastTransitionShouldForceStateRefresh&&n.resetToDefaultState();let s=n.overriddenMutedState==null?o.muted:n.overriddenMutedState.value;n.setMuted(s),(n.overriddenPlayingState==null?o.autoplay:n.overriddenPlayingState.value)?this._appState.editorType()==="COOPER"?n.setShouldDisplayThumbnail(!1):this.playVideo(n,i,void 0):n.pause()}),this.snapshotVideoStates(e)}_invalidateTexturesOfPlayingVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{let r=this.getVideoRuntimeForPaint(e);r!=null&&(r.isPlaying()||r.isSeeking())&&r.invalidateTexture()})}_recalculateVisibleVideoPaints(e){To.VERBOSE_LOGS&&console.log("Recalculating visible paints"),this._visibilityTracker.handlePrototypeStateChange(e),this._visibilityTracker.forEachVisiblePaint(r=>{let n=this.getVideoRuntimeForPaint(r);n==null||n.startLoadIfNeeded(this._appState.editorType()==="COOPER")}),this._framePotentiallyReadyToPlay=!0}_deleteVisibleRuntimes(){To.VERBOSE_LOGS&&console.log("Deleting existing runtimes"),this._runtimeStorage.uninitialize1()}buildVideoResource(e){this.initializeRuntimes();let r=new zm(e,this);return this.addToHashToRuntimeMap(r),r}addToHashToRuntimeMap(e){let r=e.hash();if(!this._hashToRuntimeMap.has(r)){let n=aP(r),o=new $l(r,n,this);this._hashToRuntimeMap.set(r,o)}}initializeRuntimes(){vo.instance().hasRequestedLibrary()||(vo.instance().onSuccess=()=>{for(let e of Array.from(this._deferredRuntimes.values()))e.startLoadIfNeeded(this._appState.editorType()==="COOPER")},vo.instance().requestLibrary())}allVisibleVideosAreLoaded(){let e=!0;return this._visibilityTracker.forEachVisiblePaint(r=>{let n=this.getVideoRuntimeForPaint(r);n!=null&&!n.isReadyToPlay()&&!n.isInErrorState()&&(e=!1)}),e}onVideoLoaded(e){this._fireVideoRuntimeSubscriptions();let r=this._appState.imageManager();r==null||r.onImageLoaded==null||(this.allVisibleVideosAreLoaded()?(To.VERBOSE_LOGS&&console.log("VideoManager - - : All videos in frame are loaded!"),this._appState.baseScreenNode()!=null&&r.onImageLoaded(this._appState.baseScreenNode())):To.VERBOSE_LOGS&&console.log("VideoManager - - : Not all videos in frame are loaded"))}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this)}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}handleSceneGraphEvent(e){e.property==75&&(this._guidToVideoMetadata.set(e.node.id(),new cd(Nr.getSemanticNodePath(new Kt(e.node)),e.newVal)),this._paintToNodeGUIDMap.forEach((r,n)=>{r==e.node.id()&&this._paintsForPlaybackSettingsRefresh.add(n)}),this._framePotentiallyReadyToPlay=!0)}debugString(){let e=`VideoManager 
`;return e+="Need to recalculate visible videos: "+this._needToRecalculateVisibleVideos.toString()+`
`,e+="Frame may be ready to start playing videos: "+this._framePotentiallyReadyToPlay.toString()+`
`,e+=`	Loading Runtimes:
`,this._hashToRuntimeMap.forEach((r,n)=>{e+="		hash: "+n+" -> "+r.toString()+`
`}),e+=`	VisiblePaints:
`,this._visibilityTracker.forEachVisiblePaint(r=>{let n=this.getPlaybackSettingsForPaint(r);n!=null?e+="		"+r.debugString()+" muted="+n.muted.toString()+" loop="+n.mediaLoop.toString()+" autoplay="+n.autoplay.toString()+" hash: "+r.video().hash()+`
`:e+="		"+r.debugString()+` (no playback settings found) 
`}),e+=`	Paint -> GUID:
`,this._paintToNodeGUIDMap.forEach((r,n)=>{e+="		P="+n.id().toString()+" => "+r+`
`}),e}enqueueVideoOrStartLoad(e){vo.instance().isLibAvailable()?e.startLoadIfNeeded(this._appState.editorType()==="COOPER"):this._deferredRuntimes.add(e)}muteAllOtherVideos(e){this._runtimeStorage.forEach(r=>{r.id!=e.id&&r.setMuted(!0)})}playNextVisibleVideo(){let e=(u,p)=>{let _=u.canvasSpaceRenderedBounds().x(),h=p.canvasSpaceRenderedBounds().x();if(_!==h)return _-h;{let A=u.canvasSpaceRenderedBounds().y(),m=p.canvasSpaceRenderedBounds().y();return A-m}},r=[],n=new Set;if(this._visibilityTracker.forEachVisiblePaint(u=>{if(!this._paintToNodeGUIDMap.has(u))return;let p=this._paintToNodeGUIDMap.get(u);if(!p||n.has(p))return;let _=this.getPlaybackSettingsForPaint(u);if(_!=null&&_.autoplay)return;let h=this._appState.scene().findNode(p);h!=null&&(n.add(p),r.push({node:h,paint:u}))}),r.sort((u,p)=>e(u.node,p.node)),r.length===0)return!1;let i=r.findIndex(u=>u.node.id()===this._lastPlayedVideo)+1;if(i>=r.length)return!1;let a=r[i],s=a.paint;if(!this.getVideoRuntimeForPaint(s))return!1;let c=a.node.id(),d=dr.NULL_ACTION.withTransitionNodeID(c).withMediaAction("PLAY");return this.updateVideoRuntime(d,c),!0}unloadAllVideos(){for(let e of this._hashToRuntimeMap.values())e.clearPreloadedData();this._runtimeStorage.uninitialize1()}preloadAllVideos(){var n,o;let e=(n=this._appState.scene())==null?void 0:n.root();if(!e)return;let r=[];for(let{video:i,paint:a,node:s}of t.getVideosInSubtree(e)){this._hashToRuntimeMap.has(i.hash())||(this.initializeRuntimes(),this.addToHashToRuntimeMap(i));let l=this._hashToRuntimeMap.get(i.hash());l==null||l.startLoadIfNeeded(!0),this.enqueueVideoOrStartLoad(l);let c=this._paintToNodeGUIDMap.get(a);c||(this.associatePaintWithNode(a,new Kt(s)),c=this._paintToNodeGUIDMap.get(a));let d=c&&((o=this.getNodeMetadata(c))==null?void 0:o.nodePath);d&&l&&(this._runtimeStorage.insert(d,i.hash(),l),r.push(l))}return r}static getVideosInSubtree(e){let r=new Map;t._getVideosInSubtree(e,r);let n=[];return r.forEach(o=>{n.push(o)}),n}static _getVideosInSubtree(e,r){e.forEachSinglePaint(n=>{n.video()!=null&&r.set(n.video().hash(),{video:n.video(),paint:n,node:e})});for(let n=0,o=e.childCount();n<o;n=n+1){let i=e.childAt1(n);t._getVideosInSubtree(i,r)}}getVideoLoadingProgress(e){return{loaded:e.reduce((n,o)=>{let i=o.isReadyToPlay()||o.isInErrorState()&&!o.isErrorRetryable();return n+(i?1:0)},0),total:e.length}}playVideo(e,r,n){n?e.playByVideoAction():e.play(),this._lastPlayedVideo=r}};var ur=class{constructor(){this.isPreloaded=!1;this.prototypeSecurityBoundariesEnforced=!1;this._appObservers=new dn,this._actionObservers=new dn,this._frameObservers=new dn,this._scene=null,this._canvas=null,this._requestedFrameMetricsTracker=new Hm,this._currentFileKey="",this._activePrototypeStartingPointNodeId=null,this._renderDots=!1,this._fontListPromise=Promise.resolve(),this._pendingSetActiveCanvas=null,this._emitter=Ht.getEventEmitter(),this._prototypeState=new hs(this),this._prototypeStructure=new sn(this),this._imageManager=new ss(this,()=>{this._emitter.trigger("showImageFetchFailureUI")}),this._videoManager=new hp(this),this._embeddedPrototypeManager=new Tu(this),this._prototypeRecorder=new wm(this),this._serialization=new ut(this,this._imageManager,this._videoManager),yo&&F()==null&&__(new rd(Sa,this))}emitter(){return this._emitter}scene(){return this._scene}prototypeState(){return this._prototypeState}prototypeStructure(){return this._prototypeStructure}imageManager(){return this._imageManager}videoManager(){return this._videoManager}embeddedPrototypeManager(){return this._embeddedPrototypeManager}prototypeRecorder(){return this._prototypeRecorder}requestedFrameMetricsTracker(){return this._requestedFrameMetricsTracker}serialization(){return this._serialization}currentFileKey(){return this._currentFileKey}setCurrentFileKey(e){this._currentFileKey=e}fontListPromise(){return this._fontListPromise}setFontListPromise(e){this._fontListPromise=e}renderDots(){return this._renderDots}setRenderDots(e){this._renderDots=e}baseScreenId(){return this._prototypeState.getCurrentBaseScreenId()}currentFitMode(){return this._prototypeState.getCurrentFitMode()}currentScalingInfo(){return this._prototypeState.getCurrentScalingInfo()}baseScreenNode(){return this._scene==null?null:this._prototypeState.getCurrentBaseScreenNode()}needsAlphaGPUBackingStore(){return!!new URLSearchParams(window.location.search).get("needsAlpha")}editorType(){return this._editorType}setEditorType(e){this._editorType!=e&&(this._editorType=e)}addAppObserver(e){this._appObservers.add(e)}removeAppObserver(e){this._appObservers.remove(e)}addActionObserver(e){this._actionObservers.add(e)}removeActionObserver(e){this._actionObservers.remove(e)}addFrameObserver(e){this._frameObservers.add(e)}removeFrameObserver(e){this._frameObservers.remove(e)}nodeTransitionTracker(){return this._prototypeStructure.nodeTransitionTracker()}triggerAction1(e){this.triggerAction2(e,null)}triggerAction2(e,r){this._actionObservers.forEach(n=>{n.handleAction(e,r)})}onFrame(){this._frameObservers.forEach(e=>{e.onFrame()})}resetStateForTests(){this._prototypeState.resetState()}setScene(e){var r;if(e!=this._scene){let n=this._scene;this._scene=e,(r=this._scene)==null||r.markLoaded(),this._appObservers.forEach(o=>{o.handleSceneChange(n,e)}),n!=null&&n.destroy(),this._scene==null?this.setActiveCanvas(null):this.setActiveCanvas(this._scene.firstUserCanvasOrNull())}}requestSetActiveCanvas(e){e.hasBeenLoaded()?this.setActiveCanvas(e):(this._pendingSetActiveCanvas=e,this.triggerAction2(11,e))}trySettingRequestedActiveCanvas(){this._pendingSetActiveCanvas!=null&&this._pendingSetActiveCanvas.hasBeenLoaded()&&(this.setActiveCanvas(this._pendingSetActiveCanvas),this._pendingSetActiveCanvas=null)}setActiveCanvas(e){if(this._canvas!=e){let r=this._canvas;this._canvas=e,this._appObservers.forEach(n=>{n.handleActiveCanvasChange(r,this._canvas)})}}getActiveCanvas(){return this._canvas!=null&&this._scene==null?(console.warn("getActiveCanvas called with null scene but non-null canvas"),null):this._canvas}activePrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.prototypeDevice()}storedPrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.storedPrototypeDevice()}activePrototypeStartingPointNodeId(){return this._activePrototypeStartingPointNodeId}setActivePrototypeStartingPointNodeId(e){let r=this._activePrototypeStartingPointNodeId;this._activePrototypeStartingPointNodeId=e,this._appObservers.forEach(n=>{n.handleActivePrototypeStartingPointChange(r,e)})}};function ud(){return AssertLib}function ma(t,e){ud()(t,e)}function Js(t,e,r=""){ma(Math.abs(t-e)<1e-6,`Expected ${t} to approximately equal ${e}. ${r}`)}function Ym(t,e,r){Js(e,r,`Expected velocity at timestep ${t} to equal ${e}, got ${r}`)}var lP=hc(sP());var An=class An{constructor(e){this._valueBySnapshotId=null,this._isDirty=!1,this._valueBySnapshotId=e}getValueOrNull(e){return Qe.StringMap_get(this._valueBySnapshotId,e,null)}updateValue(e,r){this._valueBySnapshotId.set(e,r),this._isDirty=!0}toString(){let e=Array.from(this._valueBySnapshotId.keys());e.sort((n,o)=>pi.string_compare(n,o));let r="";for(let n of e)r+=`
${An._PREFIX}snapshotId: ${n}
`,r+=this._valueBySnapshotId.get(n);return r}isDirty(){return this._isDirty}static _createEmptyDefaultDirtyAtPath(e){if(An._snapshotFileCache.has(e))throw new Error("Snapshot file at path already exists in cache");return An._snapshotFileCache.set(e,new An(new Map)),An._snapshotFileCache.get(e)._isDirty=!0,An._snapshotFileCache.get(e)}static loadOrCreateFromPath(e){let r=Qe.StringMap_get(An._snapshotFileCache,e,null);return r!=null?Promise.resolve(r):ProtoTestHost_readFile(e).then(n=>{let o=Qe.StringMap_get(An._snapshotFileCache,e,null);return o??(n==null?(console.log(`[Snapshot] Create empty default dirty snapshot at path ${e}`),An._createEmptyDefaultDirtyAtPath(e)):(An._snapshotFileCache.set(e,new An(An._snapshotStringToMap(n))),An._snapshotFileCache.get(e)))})}static _snapshotStringToMap(e){let r=new Map,n=e.split(`
`),o=null,i=null;for(let a of n){let s=`${An._PREFIX}snapshotId: `;a.startsWith(s)?(o!=null&&r.set(o,i.join(`
`)),o=a.slice(s.length),i=[]):i!=null&&i.push(a)}return o!=null&&r.set(o,i.join(`
`)),r}static flushSnapshotUpdates(){let e=[];return Qe.StringMap_each(An._snapshotFileCache,(r,n)=>{n.isDirty()&&e.push(An._saveToPath(r,n))}),Promise.all(e)}static _saveToPath(e,r){return console.log(`[Snapshot] Saving to file ${e}`),ProtoTestHost_writeFile(e,r.toString())}};An._PREFIX="#*#* ",An._snapshotFileCache=new Map;var pd=An;var ec=class{constructor(e){this._testFilepath=null,this._testFilepath=e}asyncAssertMatchesSnapshot(e,r){if(Qm==null)throw new Error("asyncAssertMatchesSnapshot called outside of a test");let o=this._testFilepath.split(".ts").join(".snapshot.txt"),i=Qm+" -- "+e,a=ProtoTestHost_env.UPDATE_SNAPSHOTS!==void 0;return $M(o,i).then(s=>{let l=new RegExp("\\d+\\.\\d*","g"),c=r.replaceAll(l,d=>`${Math.round(parseFloat(d)*1e3)/1e3}`);if(s==null||a){jM(o,i,c);return}if(s!==c)throw new Error(`${gp}Snapshot ${i} in file ${o} did not match previous value. Here's a diff that changes the ${dP}stored snapshot${gp} into the ${cP}received value${gp}:

${JM(s,c)}`)})}},fs;(i=>{function t(){return i.hasSetExpectedErrorsBeenCalled=!1,Sa.interactionTestHelpers.resetExpectedErrorsAndGetErrorString(d_.VIEWER_TEST)}i.resetExpectedErrorsAndGetErrorString=t;function e(a){if(i.hasSetExpectedErrorsBeenCalled)throw new Error("Can only call setExpectedErrors once per test");i.hasSetExpectedErrorsBeenCalled=!0,Sa.interactionTestHelpers.setExpectedErrors(a)}i.setExpectedErrors=e;function r(){i.isUnhandledErrorsExpected=!0}i.setUnhandledErrorsExpected=r,i.hasSetExpectedErrorsBeenCalled=!1,i.isUnhandledErrorsExpected=!1})(fs||(fs={}));function Ee(t,e){$A(t,()=>new Promise((r,n)=>{e(),setTimeout(()=>{r()},0)}))}function he(t,e,r=!1){$A(t,e,r)}function tc(t,e,r=!1){$A(t,()=>e().then(n=>{}),r)}function $A(t,e,r=!1){fp.push(t);let n=fp.join(" -- ");ie.List_removeLast(fp);let o=()=>{new ur;let i=e();return r||F().reset(),i};it(t,()=>{Qm=n,Oi=[],fs.isUnhandledErrorsExpected=!1;let i=fs.resetExpectedErrorsAndGetErrorString();return i.length>0&&Oi.push(new Error("Errors detected from before test started. Maybe from test harness initialization, or from a previous test: "+i)),o().catch(a=>{Oi.push(a)}).then(()=>{let a=fs.resetExpectedErrorsAndGetErrorString();if(a.length>0&&Oi.push(new Error(a)),Qm=null,fs.isUnhandledErrorsExpected){if(Oi.length==0)throw new Error("Expected errors, but none were triggered")}else{Oi=Oi.filter(l=>l.message.indexOf("/api/web_logger/metrics/unhandled_error")==-1);let s=Oi.length>1?Oi.length.toString()+` unhandled errors: 
`:`Unhandled error: 
`;if(Oi.length==1)throw Oi[0];if(Oi.length>1){for(let l of Oi)s+=l.message,s+=`
`,s+=l.stack;throw new Error(s)}}}).finally(()=>{r&&F().reset()})})}function Ct(t,e){fp.push(t),describe(t,()=>{e()}),ie.List_removeLast(fp)}function JM(t,e){let r=lP.diffLines(t,e),n="";return r.forEach(o=>{let i="",a="";o.added?(i="+ ",a=cP):o.removed?(i="- ",a=dP):(i="  ",a=gp),n+=`${a}${i}${o.value}${gp}
`}),n}function jM(t,e,r){pd.loadOrCreateFromPath(t).then(n=>{n.updateValue(e,r)})}function $M(t,e){return pd.loadOrCreateFromPath(t).then(r=>r.getValueOrNull(e))}var Oi=[],fp=[],Qm=null,cP="\x1B[32m",dP="\x1B[31m",gp="\x1B[0m";var rc=class{constructor(e,r,n){var o;this._property=0,this._activeCanvasGUID=null,this._onChange=null,this._property=r,this._activeCanvasGUID=(o=e.getActiveCanvas())==null?void 0:o.id(),this._onChange=n,e.addAppObserver(this)}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this)}handleActiveCanvasChange(e,r){if(r==null)return;this._activeCanvasGUID=r.id();let n=e==null?void 0:e.get(this._property),o=r.get(this._property);n!=o&&this._onChange(o)}handleActivePrototypeStartingPointChange(e,r){}handleSceneGraphEvent(e){var r;e.property==this._property&&Q.equals((r=e.node)==null?void 0:r.id(),this._activeCanvasGUID)&&e.oldVal!=e.newVal&&this._onChange(e.newVal)}};var zT=hc(Hd());function eT(t){switch(t){case 2:case 4:return 0;case 1:case 3:case 5:return 1;default:return 2}}var _d=class{createBallisticScrollSimulation(e,r,n,o,i,a){return null}applyOverscrollBehavior(e,r,n,o){return r}constructor(){}};var js=class{constructor(){this._startTime=0,this._startTime=Xe.seconds()}endPos(){return new O(this._xSimulation().endPos(),this._ySimulation().endPos())}pos1(){return this.pos2(this.elapsed())}pos2(e){return new O(this._xSimulation().pos(e),this._ySimulation().pos(e))}dPos(e){return new O(this._xSimulation().dPos(e),this._ySimulation().dPos(e))}elapsed(){return Xe.seconds()-this._startTime}isDone1(){return this.isDone2(this.elapsed())}isOverscrolled(){return!1}isDone2(e){return this._xSimulation().isDone(e)&&this._ySimulation().isDone(e)}xSimulation(e){return this._xSimulation().typeAt(e)}ySimulation(e){return this._ySimulation().typeAt(e)}},Sp=class Sp{static withDampingRatio(e,r,n){return new Sp(e,r,n*2*Math.sqrt(e*r))}constructor(e,r,n){this.mass=e,this.stiffness=r,this.damping=n}};Sp.DEFAULT_SPRING=Sp.withDampingRatio(.5,100,1.1);var hd=Sp,md=class{constructor(e,r){this.velocity=e,this.distance=r}};function tT(){return typeof window<"u"&&typeof zo()=="number"?new md(1/(.05*zo()),1/zo()):new md(1/.05,1)}var fd=class{constructor(e,r,n){this._friction=.015;this._initialVelocityPenetration=3.065;this._decelerationRate=Math.log(.78)/Math.log(.9);this._pos=e,this._velocity=r,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=n??this._flingDuration(r),this._distance=Math.abs(r*this._duration/this._initialVelocityPenetration)}duration(){return this._duration}pos(e){if(this._duration==0)return this._pos;let r=Ir.Math_clamp(e/this._duration,0,1);return this._pos+this._distance*this._flingDistancePenetration(r)*this._vSign}dPos(e){if(this._duration==0)return this._velocity;let r=Ir.Math_clamp(e/this._duration,0,1);return this._distance*this._flingVelocityPenetration(r)*this._vSign/this._duration}isDone(e){return e>=this._duration}endPos(){return this._pos+this._distance}_decelerationForFriction(e){return e*61774.04968}_flingDuration(e){let r=this._friction*this._decelerationForFriction(.84),n=Math.log(.35*Math.abs(e)/r);return Math.exp(n/(this._decelerationRate-1))}_flingDistancePenetration(e){return 1.2*e*e*e-3.27*e*e+this._initialVelocityPenetration*e}_flingVelocityPenetration(e){return 3.6*e*e-6.54*e+this._initialVelocityPenetration}},Ap=class{constructor(e,r,n,o=tT()){this._drag=e,this._dragLog=Math.log(e),this._p=r,this._v=n,this._tolerance=o}pos(e){return this._p+this._v*Math.pow(this._drag,e)/this._dragLog-this._v/this._dragLog}dPos(e){return this._v*Math.pow(this._drag,e)}endPos(){return this._p-this._v/this._dragLog}timeAtPos(e){if(e==this._p)return 0;let r=this.endPos();return this._v==0||(this._v>0?e<this._p||e>r:e>this._p||e<r)?1/0:Math.log(this._dragLog*(e-this._p)/this._v+1)/this._dragLog}isDone(e){return Math.abs(this.dPos(e))<this._tolerance.velocity}},$s=class{constructor(e,r,n,o,i=tT()){let a=r-n,s=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(s))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(s))/(2*e.mass),this._c2=(-(a*this._r1)+o)/(this._r2-this._r1),this._c1=a-this._c2,this._end=n,this._tolerance=i}endPos(){return this._end}pos(e){return this._end+this._c1*Math.pow(Math.E,this._r1*e)+this._c2*Math.pow(Math.E,this._r2*e)}dPos(e){return this._c1*this._r1*Math.pow(Math.E,this._r1*e)+this._c2*this._r2*Math.pow(Math.E,this._r2*e)}isDone(e){return Math.abs(this.pos(e)-this._end)<=this._tolerance.distance&&Math.abs(this.dPos(e))<=this._tolerance.velocity}},gd=class{pos(e){return this._c}dPos(e){return 0}isDone(e){return!0}endPos(){return this._c}constructor(e){this._c=e}};var Tp=class{applyOverscrollBehavior(e,r,n,o){let i=e.subtract(n),s=e.subtract(r).divide(o).makeAbs(),l=this._frictionFactor2(s);return n.add(l.multiply(i))}_frictionFactor1(e){return e==0?1:.52*Math.pow(1-e,2)}_frictionFactor2(e){return new O(this._frictionFactor1(e.x()),this._frictionFactor1(e.y()))}createBallisticScrollSimulation(e,r,n,o,i,a){return new Sd(e,r,n,o,i,a)}constructor(){}},Sd=class extends js{constructor(e,r,n,o,i,a){super(),this._xSim=null,this._ySim=null;let s=hd.DEFAULT_SPRING;this._xSim=new Xm(e.x(),r.x(),n,o,s),this._ySim=new Xm(e.y(),r.y(),i,a,s)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}isOverscrolled(){return this._xSimulation().typeAt(this.elapsed())==1||this._ySimulation().typeAt(this.elapsed())==1}},Xm=class{constructor(e,r,n,o,i){if(this._frictionSimulationIOS=null,this._springSimulation=null,this._fixedSolution=null,this._startTime=0,this._springTime=0,this._timeOffset=0,e<n)this._springSimulation=new $s(i,e,n,r),this._springTime=-1/0;else if(e>o)this._springSimulation=new $s(i,e,o,r),this._springTime=-1/0;else if(r==0)this._fixedSolution=new gd(e);else{this._frictionSimulationIOS=new Ap(eB,e,r);let a=this._frictionSimulationIOS.endPos();r>0&&a>o?(this._springTime=this._frictionSimulationIOS.timeAtPos(o),this._springSimulation=new $s(i,o,o,Math.min(this._frictionSimulationIOS.dPos(this._springTime),uP))):r<0&&a<n?(this._springTime=this._frictionSimulationIOS.timeAtPos(n),this._springSimulation=new $s(i,n,n,Math.min(this._frictionSimulationIOS.dPos(this._springTime),uP))):this._springTime=1/0}}_simulation(e){return this._fixedSolution!=null?this._fixedSolution:e>this._springTime?(this._timeOffset=isFinite(this._springTime)?this._springTime:0,this._springSimulation):(this._timeOffset=0,this._frictionSimulationIOS)}typeAt(e){return this._fixedSolution!=null?2:e<=this._springTime?0:1}endPos(){return this._fixedSolution!=null?this._fixedSolution.pos(0):isFinite(this._springTime)||this._springTime<0?this._springSimulation.endPos():this._frictionSimulationIOS.endPos()}pos(e){return this._simulation(e).pos(e-this._timeOffset)}dPos(e){return this._simulation(e).dPos(e-this._timeOffset)}isDone(e){return this._simulation(e).isDone(e-this._timeOffset)}},uP=5e3,eB=.135;var Ep=class{createBallisticScrollSimulation(e,r,n,o,i,a){return new nT(e,r,n,o,i,a)}applyOverscrollBehavior(e,r,n,o){return r}constructor(){}},nT=class extends js{constructor(e,r,n,o,i,a){if(super(),this._xSim=null,this._ySim=null,Math.abs(r.x())>Math.abs(r.y())){this._xSim=new Ad(e.x(),r.x(),n,o);let s=Math.abs(r.y())>=pP?r.y():0;this._ySim=new Ad(e.y(),s,i,a,this._xSimulation().duration())}else{this._ySim=new Ad(e.y(),r.y(),i,a);let s=Math.abs(r.x())>=pP?r.x():0;this._xSim=new Ad(e.x(),s,n,o,this._ySimulation().duration())}}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},Ad=class{constructor(e,r,n,o,i){this._duration=-1/0,this._min=n,this._max=o,r==0?this._simulation=new gd(e):i?this._simulation=new fd(e,r):(this._simulation=new fd(e,r,i),this._duration=this._simulation.duration()),this._startTime=Xe.seconds()}duration(){return this._duration}pos(e){let r=this._simulation.pos(e);return r<=this._min?this._min:r>=this._max?this._max:r}dPos(e){return this._simulation.dPos(e)}endPos(){return this._simulation.endPos()}isDone(e){if(this._simulation.isDone(e))return!0;let r=this.pos(e);return r>=this._max||r<=this._min}elapsed(){return Xe.seconds()-this._startTime}typeAt(e){return 0}},pP=50;var Ip=class extends js{constructor(e,r,n,o){super(),this._xSim=null,this._ySim=null,this._xSim=new Zm(e.x(),r.x(),n,o),this._ySim=new Zm(e.y(),r.y(),n,o)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},Zm=class{constructor(e,r,n,o){this._begin=0,this._end=0,this._duration=0,this._curve=null,this._begin=e,this._end=r,this._duration=n,this._curve=o}pos(e){let r=Ir.Math_clamp(e/this._duration,0,1);return r==0?this._begin:r==1?this._end:this._begin+(this._end-this._begin)*this._curve.get(r)}dPos(e){return(this.pos(e+.001)-this.pos(e-.001))/(2*.001)}endPos(){return this._end}isDone(e){return e>this._duration}typeAt(e){return 3}};var hP=new Map([["http:",80],["https:",443]]);function tB(t){return t==="http:"||t==="https:"}function rB(t){if(tB(t.protocol)){let e=t.port?parseInt(t.port):hP.get(t.protocol);return{scheme:t.protocol,hostname:t.hostname,port:e}}else return"INVALID_ORIGIN"}function nB(t,e){return e.scheme==="ALL"||e.scheme.scheme===t}function oB(t,e){if(e.hostname==="ALL"||e.hostname.hostname===t)return!0;try{let r=decodeURI(e.hostname.hostname);if(r.startsWith("*."))return new RegExp(`^${r.replace(/\./g,"\\.").replace("*",".*")}$`).test(t)}catch{return!1}return!1}function iB(t,e){return e.port==="ALL"||e.port.port===t}function aB(t,e){return nB(t.scheme,e)&&oB(t.hostname,e)&&iB(t.port,e)?"ALLOWED":"DENIED"}var _P="embedkit-wildcard-placeholder.";function sB(t){return t.map(e=>{let r=e.includes("*."),n=r?e.replace("*.",_P):e,o=new URL(n),i=r?o.hostname.replace(_P,"%2A."):o.hostname;return{scheme:{scheme:o.protocol},hostname:{hostname:i},port:{port:o.port?parseInt(o.port):hP.get(o.protocol)}}})}function lB(t,e){let r=sB(e);for(let n of r)if(aB(t,n)==="ALLOWED")return"ALLOWED";return"DENIED"}function oT(t,e){let r;try{r=new URL(t)}catch{return"DENIED"}let n=rB(r);return n==="INVALID_ORIGIN"?"DENIED":lB(n,e)}var iT={clientId:null,allowedEmbedOrigins:null,embedHost:null};function mP(){try{if(window.top===window)return null;if(window.location.origin===window.parent.location.origin)return window.location.origin}catch{return null}return null}var el;(A=>{function t(m){A._mockEmbedListener=m}A.setMockListener=t;function e(m,g,S){g.addObserver(new u(m,g)),A._prototypeObserver=new p(m,g),iT=S,K.getFeatureFlags().embedkit_v2_embed_api&&!K.getFeatureFlags().embedkit_v2_enforce_embed_origins&&S.clientId==null&&console.warn("[Figma Embed Kit] To continue using the Embed API for sending and receiving messages from your Figma embeds, you must register a Figma OAuth app, specify in the app's configuration the domains where you're hosting embeds, and provide the app's client ID in your embed URL using the client-id parameter. You need to do this by December 5th, 2024."),m.prototypeState().addObserver(A._prototypeObserver),m.prototypeState().addHsmObserver(A._prototypeObserver),Ht.getEventEmitter().on("sceneDidCompleteInitialLoad",P=>{m.scene().addObserver(A._prototypeObserver),o(0,{})}),Ht.getEventEmitter().on("requestClose",P=>{o(4,{})});let R=window;if(R===null)return;let E=K.getFeatureFlags().embedkit_v2_enforce_embed_origins;R.addEventListener("message",P=>{let T=P.data;if(!T)return;let f=T.type;if(!A.VALID_MESSAGE_TYPES.has(f))return;let y=T.data;if(!mP()&&K.getFeatureFlags().embedkit_v2_embed_api){let{clientId:w,allowedEmbedOrigins:I}=iT;if(w==null){if(E){console.error("[Figma Embed Kit] You must register an app and provide a client-id to enable the Embed API.");return}console.warn("[Figma Embed Kit] Starting on December 5th, 2024, you must register an app and provide a client-id to enable the Embed API. Please do so to avoid any disruption to your users.")}else if(I==null){if(E){console.error(`[Figma Embed Kit] The app (${w}) must have allowed embed origins set to enable the Embed API.`);return}console.warn(`[Figma Embed Kit] Starting on December 5th, 2024, to use the Embed API, you must set allowed embed origins for your app (${w}).`)}if(I&&oT(P.origin,I)==="DENIED"){if(E){console.error(`[Figma Embed Kit] The origin ${P.origin} does not match any allowed embed origins for the app (${w}). It must be be one of the following: ${I.join(", ")}`);return}console.warn(`[Figma Embed Kit] The origin ${P.origin} does not match any allowed embed origins for the app (${w}). It must be be one of the following: ${I.join(", ")}. Starting on December 5th, 2024, this will be enforced.`)}}n(m,g,f,y)})}A.init=e,A.VALID_MESSAGE_TYPES=new Set(["NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS","NAVIGATE_BACKWARD","NAVIGATE_FORWARD","CHANGE_COMPONENT_STATE","RESTART","REQUEST_EXPORT","TIMELINE_PLAYER_PLAY","TIMELINE_PLAYER_PAUSE"]);function n(m,g,S,R){var E,P,T;if(A.VALID_MESSAGE_TYPES.has(S))switch(S){case"NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS":{let f=Q.fromString(R.nodeId),y=Q.fromString(R.startingPointNodeId);if(K.isInlinePreview()&&(m.prototypeState().mostRecentBaseScreenIdChangeInitiator="EmbedAPI._receiveFromHost",m.prototypeState().resetPrototype(),A._prototypeObserver.handleRestartPrototype(),g.handleRestartPrototype(),m.videoManager().handleRestartPrototype()),!(K.isInlinePreview()&&f==null))if(Q.isValid(f)){let v=(E=m.scene())==null?void 0:E.findNode(f);if(v!=null){y&&(m.prototypeState().mostRecentFixInvalidStateInitiator="EmbedAPI._receiveFromHost",m.setActivePrototypeStartingPointNodeId(y));let w=y&&v.topLevelAncestor()==null?y:f;m.prototypeState().navigateToFrameAndCloseOverlays(w,null,2,0,0,null,null)}else A._prototypeObserver.setPendingNodeId(f)}else console.error(`Expected node id; got '${R.nodeId}' instead`);break}case"NAVIGATE_BACKWARD":{g.navigateBackward(18);break}case"NAVIGATE_FORWARD":{g.navigateForward(19);break}case"CHANGE_COMPONENT_STATE":{let f=(P=m.scene())==null?void 0:P.findNodeFromDeveloperFriendlyId(R.nodeId),y=(T=m.scene())==null?void 0:T.findNodeFromDeveloperFriendlyId(R.newVariantId);if(f==null){console.error(`Could not find node from specified node id '${R.nodeId}'`);return}if(y==null){console.error(`Could not find variant for CHANGE_COMPONENT_STATE from id '${R.newVariantId}'`);return}m.prototypeState().swapInstanceToState2(f.stablePath(),y.id(),null,0,null,1,null);break}case"RESTART":{m.prototypeState().restartPrototype(1);break}case"REQUEST_EXPORT":{g.exportVideos(R.nodeIds).then(f=>{o(5,{videoBuffer:f})}).catch(f=>{console.error(`[Figma Embed Kit] Error exporting video ${f.message}`),o(5,{error:f})});break}case"TIMELINE_PLAYER_PLAY":{let C=function(){o(6,{status:I,currentTimeMs:v,totalTimeMs:w})},f=m.baseScreenNode();if(!f)return;let y=f.id(),v=0,w=0,I="stopped";g.timelineManager().play({nodeId:y,onPause:()=>{I="paused",C()},onDurationMs:L=>{w=L,C()},onPlayheadTimeMs:L=>{v=L,C()},onStart:()=>{I="playing",v=0,C()},onResume:()=>{I="playing",C()},onStop:()=>{I="stopped",v=0,C()}}).catch(L=>{console.error(`[Figma Embed Kit] Error playing scene ${L.message}`)});break}case"TIMELINE_PLAYER_PAUSE":{g.timelineManager().pause();break}default:break}}A._receiveFromHost=n;function o(m,g){let S={type:d[m],data:g};if(A._mockEmbedListener!=null){(0,A._mockEmbedListener)(S);return}let R=window;if(R===null||R.parent===null||R.parent.postMessage===void 0||R.top===R)return;if(!mP()&&K.getFeatureFlags().embedkit_v2_embed_api){let{clientId:P,allowedEmbedOrigins:T}=iT,f=K.getFeatureFlags().embedkit_v2_enforce_embed_origins;if(P==null){if(f)return}else if(P!=null&&T==null||T.length===0){if(f){console.error(`[Figma Embed Kit] The app (${P}) must have allowed embed origins set to enable the Embed API.`);return}console.warn(`[Figma Embed Kit] Starting on December 5th, 2024, to use the Embed API, you must set allowed embed origins for your app (${P}). Please do so to avoid any disruption to your users.`)}}R.parent.postMessage(S,"*")}function i(m,g){for(let S=m.childCount()-1;S>=0;S=S-1)i(m.childAt2(S,!0),g);g(m)}A._forEachNodeInHitTestOrder=i;function a(m,g){let S=null,R=null;return i(m,E=>{if(S!=null)return;let P=E.canvasSpaceScrolledInteractiveBounds(0);if(E.isVisibleInCanvas()&&P.contains2(g)){S=E;let T=E.canvasSpaceScrolledInteractiveBounds(1);R=g.subtract(T.topLeft())}}),S==null?null:new c(S,R)}A.findClickInfoForUnhandledMouseRelease=a;function s(m,g,S){if(g.node==null){we("Hotspot node is null");return}let R=m.baseScreenNode();if(R==null)return;let E=m.prototypeState().getTopmostOverlayNode(),P=E??R,T=S;E!=null&&(T=m.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(R,S));let f=T.subtract(g.node.canvasSpaceScrolledInteractiveBounds(1).topLeft()),y={};y.handled=!0,y.presentedNodeId=P.developerFriendlyId(),y.targetNodeId=g.node.developerFriendlyId(),y.targetNodeMousePosition=f.toJSON();let v=g.node.findContainingScrollingFrameOrSelf();if(v!=null){let w=v.canvasSpaceScrolledInteractiveBounds(1),I=T.subtract(w.topLeft());y.nearestScrollingFrameId=v.developerFriendlyId(),y.nearestScrollingFrameMousePosition=I.toJSON(),y.nearestScrollingFrameOffset=v.scrollOffset().toJSON()}else y.nearestScrollingFrameId=null,y.nearestScrollingFrameMousePosition=null,y.nearestScrollingFrameOffset=null;o(1,y)}A.willTriggerClickLikeHotspot=s;function l(m,g){let S=m.baseScreenNode();if(S==null)return;let R=m.prototypeState().getTopmostOverlayNode(),E=g;R!=null&&(E=m.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(S,g));let P=R??S,T=a(P,E),f={};f.handled=!1,f.presentedNodeId=P.developerFriendlyId(),f.targetNodeId=T!=null?T.node.developerFriendlyId():null,f.targetNodeMousePosition=T!=null?T.nodeSpacePoint.toJSON():null;let y=T!=null?T.node.findContainingScrollingFrameOrSelf():null;if(y!=null){let v=y.canvasSpaceScrolledInteractiveBounds(1),w=E.subtract(v.topLeft());f.nearestScrollingFrameId=y.developerFriendlyId(),f.nearestScrollingFrameMousePosition=w.toJSON(),f.nearestScrollingFrameOffset=y.scrollOffset().toJSON()}else f.nearestScrollingFrameId=null,f.nearestScrollingFrameMousePosition=null,f.nearestScrollingFrameOffset=null;o(1,f)}A.notifyUnhandledMouseRelease=l;class c{constructor(g,S){this.node=g,this.nodeSpacePoint=S}}A.ClickedLayer=c;let d;(f=>(f[f.INITIAL_LOAD=0]="INITIAL_LOAD",f[f.MOUSE_PRESS_OR_RELEASE=1]="MOUSE_PRESS_OR_RELEASE",f[f.PRESENTED_NODE_CHANGED=2]="PRESENTED_NODE_CHANGED",f[f.NEW_STATE=3]="NEW_STATE",f[f.REQUEST_CLOSE=4]="REQUEST_CLOSE",f[f.EXPORT_COMPLETED=5]="EXPORT_COMPLETED",f[f.UPDATE_TIMELINE_PLAYER_STATE=6]="UPDATE_TIMELINE_PLAYER_STATE"))(d=A.MessageType||(A.MessageType={}));class u{willTriggerHotspot(g,S,R,E){let P=R==4||R==8||R==9||R==3;if(E!=null&&P){let T=this._canvasView.viewport().viewSpaceToCanvasSpace1().transformPoint(E.clone());s(this._appState,g,T)}}didScrollNode(g){}constructor(g,S){this._appState=g,this._canvasView=S}}A.EmbedCanvasViewObserver=u;class p{constructor(g,S){this.appState=null,this._pendingNodeId=null,this.appState=g,this._canvasView=S}setPendingNodeId(g){this._pendingNodeId=g}handleSceneGraphEvent(g){this._pendingNodeId!=null&&this.appState.prototypeStructure().validDestinationForPrototypeFromId(this._pendingNodeId)&&(K.isInlinePreview()?(this.appState.prototypeState().mostRecentFixInvalidStateInitiator="EmbedPrototypeObserver.handleSceneGraphEvent",this.appState.setActivePrototypeStartingPointNodeId(this._pendingNodeId),this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId,null,2,0,0,null,null)):this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}handlePresentedNodeChanged(g){if(g==null)return;let S=this.appState.baseScreenNode();if(!K.isInlinePreview()&&S==null)return;let R=this.appState.prototypeState().getTopmostOverlayNode(),E=R??S,P={};P.presentedNodeId=E==null?void 0:E.developerFriendlyId(),P.isStoredInHistory=!rt.isTransientAction(g.cause);let T={};this.appState.prototypeState().getOnscreenStates().forEach(f=>{let y=f.a,v=f.b,w=this.appState.scene().findNodeByStablePath(y);w!=null&&(T[w.developerFriendlyId()]=v)}),P.stateMappings=T,o(2,P)}handleInteractiveComponentStateChange(g,S){if(S==null)return;let R=this.appState.scene().findNodeByStablePath(g);if(R==null)return;let E={};E.nodeId=R.developerFriendlyId(),E.currentVariantId=S.oldStateId(),E.newVariantId=S.newStateId(),E.isStoredInHistory=!rt.isTransientAction(S.cause),E.isTimedChange=S.cause==1,o(3,E)}handleStateChangeAborted(g){this.handlePresentedNodeChanged(g)}handleStateChangeCommitted(g,S){}handleStateChangeInitiated(g){this.handlePresentedNodeChanged(g)}handleStateChangeRequested(g){this._canvasView.timelineManager().cancelCurrentTimelineActions()}handleFitModeChange(g,S){}handleRestartPrototype(){this._canvasView.timelineManager().cancelCurrentTimelineActions()}handleHsmAborted(g,S){this.handleInteractiveComponentStateChange(g,S)}handleHsmCommitted(g,S,R){}handleHsmInitiated(g,S){this.handleInteractiveComponentStateChange(g,S)}handleHsmRequested(g,S){}}A.EmbedPrototypeObserver=p,A._mockEmbedListener=null,A._prototypeObserver=null})(el||(el={}));var Jm=class{onClick(){this._timeOfLastClick=Xe.seconds()}getOpacity(){let e=Xe.seconds()-this._timeOfLastClick;return e<this._animationDuration?1-this._easingFunction.get(e):0}constructor(){this._animationDuration=.7,this._easingFunction=uo.makeEasingFunction([0,0,.58,1],.7),this._timeOfLastClick=0}},jm=class{constructor(e,r){this._context=e,this._materialStrings=Lr.instance(),this._hotspotMaterial=this._context.createMaterial("hotspot",_t.getPositionF4(),this._materialStrings.SHADER_SOURCE_RENDER_HOTSPOT_VERTEX,this._materialStrings.SHADER_SOURCE_RENDER_HOTSPOT_FRAGMENT);let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._hotspotQuad=r.allocateSmallManagedArea(It.getPositionF4(),n)}draw(e,r,n,o,i){if(o<=0)return;let a=e;for(let s of n){let l=X.new2();l.copyFrom(a);let c=s.canvasSpaceBounds;l.translate2(c.x(),c.y()),l.scale4(c.width(),c.height());let d=x.new2();s.canvasSpaceClipBounds.transformInto1(d,a);let u=new O(2/c.width(),2/c.height());u.divideUpdate(r*i),Oe.Material_setUniformMat32(this._hotspotMaterial,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,l),Oe.Material_setUniformVec22(this._hotspotMaterial,this._materialStrings.SHADER_NAME_U_STROKE_PROPORTION,u),this._hotspotMaterial.setUniformVec41(this._materialStrings.SHADER_NAME_U_UV_HOTSPOT_CLIPPING_RECT,d.x(),d.y(),d.width(),d.height()),this._hotspotMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_HOTSPOT_OPACITY,o),this._context.draw(qe.TRIANGLE_STRIP,this._hotspotMaterial,this._hotspotQuad,lt.UNPREMULTIPLIED,_r.NONE,null)}}},Rp=class{constructor(e,r){this.canvasSpaceBounds=e,this.canvasSpaceClipBounds=r}},yp=class{constructor(){this.backgroundColor=0,this.hotspots=null,this.hotspotOpacity=0,this.particles=null,this.mouse=null,this.renderDots=!1}};var $m=class{constructor(e,r){this._didFinishZooming=null,this._drawIdleCount=0,this._userIdleCount=0,this._isFirstFrame=!1,this._justInteracted=!1,this._zoomInProgress=!1,this._previousZoomScale=1,this._previousRenderStatus=2,this._emitter=null,this._didFinishZooming=e,this._emitter=r}handleSceneChange(){this._isFirstFrame=!0}updateZoomScaleNow(e){this._previousZoomScale=e,this._didFinishZooming(this._previousZoomScale)}handleInteraction(){this._justInteracted=!0}justInteracted(){return this._justInteracted}advanceFrame(e){e.isInvalid()||this._justInteracted?(this._userIdleCount=0,this._drawIdleCount=0):this._userIdleCount=this._userIdleCount+1,this._previousRenderStatus!=2?this._drawIdleCount=0:this._drawIdleCount=this._drawIdleCount+1,this._isFirstFrame&&(this._userIdleCount=0,this._isFirstFrame=!1,this.updateZoomScaleNow(e.zoomScale()));let r=this._zoomInProgress;this._zoomInProgress=this._previousZoomScale!=e.zoomScale(),this._zoomInProgress&&!r&&this._emitter.trigger("zoomStart");let n=this._userIdleCount>=2;this._zoomInProgress&&n&&this.updateZoomScaleNow(e.zoomScale()),!this._zoomInProgress&&r&&this._emitter.trigger("zoomStop"),this._justInteracted=!1}shouldRenderOptionalTiles(){return K.shouldApplyMobileOptimizations()?this._userIdleCount>6&&this._drawIdleCount<120:this._userIdleCount>6}zoomInProgress(){return this._zoomInProgress}previousZoomScale(){return this._previousZoomScale}setPreviousRenderStatus(e){this._previousRenderStatus=e}};var aT=class{delayedHotspotId(){return this._delayedHotspotId}interaction(){return this._interaction}action(){return this._action}counter(){return this._counter}reset(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=this._counter+1}set(e,r,n){this._delayedHotspotId=e,this._interaction=r,this._action=n,this._counter=this._counter+1}constructor(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=0}},tf=class{resetEntry(e,r){this.resetAllEntriesMatchingPredicate((n,o)=>Q.equals(n,e)&&o==r)}resetAllEntries(){this._maintainedDataEntries.length=0}resetAllEntriesWithInteractionType(e){this.resetAllEntriesMatchingPredicate((r,n)=>n==e)}resetAllEntriesMatchingPredicate(e){this._maintainedDataEntries=this._maintainedDataEntries.filter(r=>!e(r.delayedHotspotId(),r.interaction()))}set(e,r,n){let o=this.getByHotspotAndInteractionType(e,r);if(o==null){let i=new aT;i.set(e,r,n),this._maintainedDataEntries.push(i),o=i}else o.set(e,r,n);return o.counter()}getByHotspotAndInteractionType(e,r){for(let n of this._maintainedDataEntries)if(Q.equals(n.delayedHotspotId(),e)&&n.interaction()==r)return n;return null}constructor(){this._maintainedDataEntries=[]}};var rf=class{constructor(e){this._appState=null,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=[],this.currentlyEnteredGUIDsSet=new Set,this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=[],this.previouslyEnteredGUIDsSet=new Set,this._appState=e}reset(){this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.currentlyEnteredGUIDsSet.clear(),this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.previouslyEnteredGUIDsSet.clear()}updateEnteredNodes(e,r){this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._getNodesEnteredByCanvasSpacePoint(e,r),this.currentlyEnteredGUIDsSet=new Set(this._currentlyEnteredNodesGUIDsOrderedInnerToOuter),this.previouslyEnteredGUIDsSet=new Set(this._previouslyEnteredNodesGUIDsOrderedInnerToOuter)}getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(e){let r=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(i=>!this.previouslyEnteredGUIDsSet.has(i));r.reverse();let n=new Map;for(let i=0,a=r.length;i<a;i=i+1)n.set(r[i],i);let o=e.filter(i=>n.has(i.node.id()));return o.sort((i,a)=>Ft.int_compare(n.get(i.node.id()),n.get(a.node.id()))),o}getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(e){let r=this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.filter(i=>!this.currentlyEnteredGUIDsSet.has(i)),n=new Map;for(let i=0,a=r.length;i<a;i=i+1)n.set(r[i],i);let o=e.filter(i=>n.has(i.node.id()));return o.sort((i,a)=>Ft.int_compare(n.get(i.node.id()),n.get(a.node.id()))),o}markNodesAsNotEnteredWithoutTriggeringMouseLeave(e){let r=new Set(e);this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(n=>!r.has(n))}resetNoLongerMaintainedMouseEnterOrLeaveInteractions(e){e.resetAllEntriesMatchingPredicate((r,n)=>{let o=n=="MOUSE_ENTER"&&!this.currentlyEnteredGUIDsSet.has(r),i=n=="MOUSE_LEAVE"&&this.currentlyEnteredGUIDsSet.has(r);return o||i})}_getNodesEnteredByCanvasSpacePoint(e,r){if(this._appState.baseScreenNode()==null)return[];let o=[],[i,a]=this._appState.prototypeState().getTopmostScreenAndPoint(e),s=sn.getNodeInteractionPairs("MOUSE_ENTER",r),l=sn.getNodeInteractionPairs("MOUSE_LEAVE",r),c=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(i,0,u=>{let p=u.event().interactionType();return p=="MOUSE_LEAVE"||p=="MOUSE_ENTER"},[...s??[],...l??[]]),d=null;for(let u of c)u.canvasSpaceScrolledInteractiveBounds(0).contains2(a)&&(d==null||u.node.isAboveInLayerOrder(d.node))&&(d=u);if(d!=null&&d.node){let u=d.node;for(;u!=i;)o.push(u.id()),u=u.parent();o.push(i.id())}return o}};var nf=class{toggleRenderTreePrinting(){}addObserver(e){}removeObserver(e){}setBackgroundEnabled(e){}isRenderingDone(){return!0}getContext(){return null}graphicsCardName(){return""}setNeedsBlit(e){}checkNeedsBlit(){return!1}deviceRenderer(){return null}initializeThumbnailInvalidationManager(e){}thumbnailRenderer(){return null}changeFitMode(e){}setZoomScale(e){}updateScroll(e){}handleSceneChange(e,r){}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}resize(e,r,n,o){return new ra(new O(0,0),!1)}drawBlank(){}draw(e,r,n,o){return 2}clearTileCaches(){}resetTileStackUsage(){}reclaimTileStack(){}triggerTransition(e,r,n){}handleAbortedTransition(e){}handleCommittedTransition(e){}triggerHsmTransition(e,r,n){}abortHsmTransition(e,r){}commitHsmTransition(e,r){}triggerObjectAnimation(e,r){}handleAbortedObjectAnimation(e){}handleCommittedObjectAnimation(e){}isTopLevelTransitionOngoing(){return!1}easedTransitionProgress(){return 1}currentCanvasSpacePreviewBounds(){return new x(0,0,0,0)}currentCanvasSpaceFrameBounds(){return new x(0,0,0,0)}canvasSpacePreviewBoundsForTransition(e,r){return new x(0,0,0,0)}canvasSpaceFrameBoundsForTransition(e,r){return new x(0,0,0,0)}ongoingPrototypeStateChange(){return null}transitionProgressTracker(){return null}drawDeviceFrameIfNecessary(e,r,n,o){return!1}renderLayerByLayerActivate(e){}renderLayerByLayerDeactivate(){}renderLayerByLayerPlay(){}renderLayerByLayerPause(){}renderLayerByLayerForward(){}renderLayerByLayerBackward(){}renderLayerByLayerRewind(){}renderLayerByLayerIncreaseSpeed(){}renderLayerByLayerDecreaseSpeed(){}attachTo(e){}removeFrom(e){}setInViewerRenderServerForTests(e){}};var cB=["APPLE_IPHONE_14_PRO","APPLE_IPHONE_14_PLUS","APPLE_IPHONE_15","APPLE_WATCH_45MM","APPLE_WATCH_SERIES_10_42MM","APPLE_WATCH_SERIES_10_46MM","APPLE_IPHONE_16"],fP=t=>cB.some(e=>t.startsWith(e));var vp=class{constructor(e,r,n,o){this._delayFrames=0,this._onChange=null,this._equals=null,this._nextUpdateAfterFrameCount=-1,this._value=null,this._queuedValue=null,this._delayFrames=r,this._equals=n,this._onChange=o,e(this)}onFrame(){this._nextUpdateAfterFrameCount>0&&(this._nextUpdateAfterFrameCount=this._nextUpdateAfterFrameCount-1,this._nextUpdateAfterFrameCount<=0&&(this._value=this._queuedValue,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1,this._onChange()))}_updateQueuedValue(e){this._queuedValue=new pe(e),this._nextUpdateAfterFrameCount=this._delayFrames}hasQueuedValue(){return this._queuedValue!=null}queueValue(e){if(this._value==null){this._value=new pe(e),this._onChange();return}if(this._queuedValue!=null){if(this._equals(this._queuedValue.value,e))return;this._updateQueuedValue(e);return}else this._equals(this._value.value,e)||this._updateQueuedValue(e)}getValue(){return this._value.value}clear(){this._value=null,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1}unregister(e){e(this)}};function Cp(t,e){let r=new WeakMap,n=null;return o=>{let i=e(o);if(i===null)return n==null&&(n=new pe(t(o))),n.value;if(r.has(i))return r.get(i);let a=t(o);return r.set(i,a),a}}function lT(t){return Cp(t,e=>e)}function dB(t,e,r){let n=Cp(o=>Cp(i=>t(o,i),r),e);return(o,i)=>n(o)(i)}function gP(t,e,r,n){let o=dB((i,a)=>Cp(s=>t(i,a,s),n),e,r);return(i,a,s)=>o(i,a)(s)}function SP(t,e,r,n,o){let i=gP((a,s,l)=>Cp(c=>t(a,s,l,c),o),e,r,n);return(a,s,l,c)=>i(a,s,l)(c)}var of=class{constructor(e,r){this._deviceImageManager=new ro,this._hasPendingFrame=!1,this._context=e,this._bufferPool=r,this._materialStrings=Lr.instance();let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._deviceFrameQuad=this._bufferPool.allocateSmallManagedArea(It.getPositionF4(),n),this._deviceFrameMaterial=this._context.createMaterial("deviceFrame",_t.getPositionF4(),this._materialStrings.SHADER_SOURCE_RENDER_DEVICE_FRAME_VERTEX,this._materialStrings.SHADER_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT)}clearOnContextReset(){this._hasPendingFrame=!1,this._deviceImageManager.clearOnContextReset()}flush(){this._hasPendingFrame&&(this._context.draw(qe.TRIANGLE_STRIP,this._deviceFrameMaterial,this._deviceFrameQuad,lt.PREMULTIPLIED,_r.NONE,null),this._hasPendingFrame=!1)}isWaitingForDeviceFrameToLoad(e){let r=ro.infoForDevice(e);if(r==null)return!1;let n=this._deviceImageManager.getImage(r,this._context).imageResource;return!n.isDecoded()&&!n.loadDidFail()}canRenderDeviceFrame(e){let r=ro.infoForDevice(e);return r==null?!1:this._deviceImageManager.getImage(r,this._context).imageResource.isDecoded()}pixelAtPosition(e,r,n){if(r==null)return N.TRANSPARENT;let o=ro.infoForDevice(n);if(o==null)return N.TRANSPARENT;let i=this._deviceImageManager.getImage(o,this._context).imageResource;if(!i.isDecoded()||i.width()<=0||i.height()<=0)return N.TRANSPARENT;let a=i.decodedData(),s=n.canvasSpaceTopLeftOffset(o),l=r.topLeft().subtract(s),c=n.canvasSpaceImageSize(o),d=e.subtract(l).divide(c);switch(n.rotation){case"NONE":break;case"CCW_90":{d=new O(1-d.y(),d.x());break}default:break}let u=d.x()*o.nonRotatedImageSize.x()|0,p=d.y()*o.nonRotatedImageSize.y()|0;return a.pixelAtIndex(u,p)}drawPrototypeDeviceIfAny(e,r,n,o){if(n==null)return;let i=ro.infoForDevice(r);if(i==null)return;let a=this._deviceImageManager.getImage(i,this._context).imageResource;if(!a.isDecoded()&&!a.loadDidFail()){e.invalidate();return}if(a.width()<=0||a.height()<=0)return;let s=a.texture().width()/i.scaleFactor,l=a.texture().height()/i.scaleFactor,c=i.nonRotatedOffset,d=n.topLeft().subtract(c),u=x.new2();u.setTo1(d.x(),d.y(),s,l);let p=X.new2();p.copyFrom(o),p.translate2(u.x(),u.y()),r.rotation=="CCW_90"&&(p.translate1(i.nonRotatedOffset),p.rotate(-Math.PI/2),p.translate1(i.nonRotatedOffset.negative()),p.translate2(-i.nonRotatedFramePresetSize.x(),0)),p.scale4(u.width(),u.height()),Oe.Material_setUniformMat32(this._deviceFrameMaterial,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,p),this._deviceFrameMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,a.texture(),0),this._hasPendingFrame=!0}async preloadDeviceImage(e){let r=ro.infoForDevice(e);if(r!=null)return this._deviceImageManager.getImage(r,this._context).loadPromise}};var Op=class{constructor(e){this._dirtyNewBoundsBuilder=new Et,this._dirtyOldBoundsBuilder=new Et,this._cachedCanvasSpaceBounds=new Map,this._dirtyNodes=new Map,this._canvasSpaceDirtyNewBounds=x.new2(),this._canvasSpaceDirtyOldBounds=x.new2(),this._onBoundsInvalidate=e}initCanvas(e){this._dirtyNodes=new Map,this._cachedCanvasSpaceBounds=new Map,e!=null&&this._initCachedBounds(e)}handleSceneGraphEvent(e){switch(e.property){case 65:case 33:case 73:case 35:case 56:case 17:case 36:case 72:case 54:case 74:case 18:case 55:case 34:case 37:case 98:break;case 26:case 27:case 41:case 69:{this.dirtyNode(e.node);break}default:{this.dirtyNode(e.node);break}}}handleImageLoaded(e){this.dirtyNode(e)}dirtyNode(e){this._dirtyNodes.set(e.id(),e.id())}invalidateDirtyTiles(e,r){if(e==null||this._dirtyNodes.size==0)return;let n=[],o=new Map;this._dirtyOldBoundsBuilder.reset(),this._dirtyNewBoundsBuilder.reset(),Qe.StringMap_each(this._dirtyNodes,(i,a)=>{let s=e.scene().findNode(a);if(s!=null&&s.type()=="CANVAS"){this._onBoundsInvalidate(null);return}let l=s==null?void 0:s.topLevelAncestor();if(l!=null){if(!l.hasBeenLoaded())return;o.set(l.id(),!0)}let c=Qe.StringMap_get(this._cachedCanvasSpaceBounds,i,null),d=s==null?void 0:s.canvasSpaceRenderedBounds();if(c!=null&&this._dirtyOldBoundsBuilder.include3(c),d!=null?(this._dirtyNewBoundsBuilder.include3(d),this._cachedCanvasSpaceBounds.set(i,d)):this._cachedCanvasSpaceBounds.delete(i),r.overlayRenderData()!=null){let u=r.overlayRenderData();if(u!=null)for(let p of u.keys()){let _=u.get(p),h=c!=null&&c.overlaps(_.bounds),A=d!=null&&d.overlaps(_.bounds);(h||A)&&o.set(_.overlayId,!0)}}}),be.perfTimerScope("invalidateNestedBackgroundBlurRenderTrees",be.ProfileLevel.LEGACY,()=>{e.invalidateNestedBackgroundRenderTrees(o,n)});for(let i=0,a=n.length;i<a;i=i+1){let s=n[i];this._dirtyOldBoundsBuilder.include3(s)}this._dirtyOldBoundsBuilder.isValid()&&(this._dirtyOldBoundsBuilder.buildTo(this._canvasSpaceDirtyOldBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyOldBounds)),this._dirtyNewBoundsBuilder.isValid()&&(this._dirtyNewBoundsBuilder.buildTo(this._canvasSpaceDirtyNewBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyNewBounds)),this._dirtyNodes=new Map}_initCachedBounds(e){for(let r=0,n=e.childCount();r<n;r=r+1){let o=e.childAt1(r);this._cachedCanvasSpaceBounds.set(o.id(),o.canvasSpaceRenderedBounds()),this._initCachedBounds(o)}}};var xa=class{constructor(e,r){e.push(this),this._value=-1,this._needsLogInHistogramBatch=!1,this._needsLogInSlowFrameTracker=!1,this._stringName=r}getStringName(){return this._stringName}setValueForFutureLog(e){this._value=e?1:0,this._needsLogInHistogramBatch=!0,this._needsLogInSlowFrameTracker=!0}getAndClearHistogramBatchValue(){return this._needsLogInHistogramBatch?(this._needsLogInHistogramBatch=!1,this._value):-1}getAndClearSlowFrameTrackerValue(){return this._needsLogInSlowFrameTracker?(this._needsLogInSlowFrameTracker=!1,this._value):-1}},Dn=class Dn{static didDisablePrerenderingOnOngoingTransition(e){this.disablePrerenderingOnOngoingTransition.setValueForFutureLog(e)}static didEncounterIntraTileInterrupt(){this.encounteredIntraTileInterrupt.setValueForFutureLog(!0)}static didUseUnifiedRendererMaterial(e){this.usedUnifiedRendererMaterial.setValueForFutureLog(e)}static didEncounterPatternPaint(){this.encounteredPatternPaint.setValueForFutureLog(!0)}static didEncounterBlur(e){this.encounteredBlur.setValueForFutureLog(e)}static didEncounterTextureEffect(e){this.encounteredTextureEffect.setValueForFutureLog(e)}static didEncounterNoiseEffect(){this.encounteredNoiseEffect.setValueForFutureLog(!0)}static didEncounterNonAxisAlignedTransform(e){this.nonAATransform.setValueForFutureLog(e)}static getAndClearHistogramBatchFields(){let e=new Map;for(let r of this.allTrackedExposureLogs){let n=r.getAndClearHistogramBatchValue();n!=-1&&e.set(r.getStringName(),n===1)}return e}static getAndClearSlowFrameTrackerFields(){let e=new Map;for(let r of this.allTrackedExposureLogs){let n=r.getAndClearSlowFrameTrackerValue();n!=-1&&e.set(r.getStringName(),n===1)}return e}static clearAllSlowFrameTrackerFields(){for(let e of this.allTrackedExposureLogs)e.getAndClearSlowFrameTrackerValue()}};Dn.allTrackedExposureLogs=[],Dn.encounteredIntraTileInterrupt=new xa(Dn.allTrackedExposureLogs,"intraTile"),Dn.usedUnifiedRendererMaterial=new xa(Dn.allTrackedExposureLogs,"veruMaterial"),Dn.disablePrerenderingOnOngoingTransition=new xa(Dn.allTrackedExposureLogs,"disablePrerenderingForTransition"),Dn.encounteredPatternPaint=new xa(Dn.allTrackedExposureLogs,"patternPaint"),Dn.encounteredBlur=new xa(Dn.allTrackedExposureLogs,"blur"),Dn.encounteredTextureEffect=new xa(Dn.allTrackedExposureLogs,"textureEffect"),Dn.encounteredNoiseEffect=new xa(Dn.allTrackedExposureLogs,"noiseEffect"),Dn.nonAATransform=new xa(Dn.allTrackedExposureLogs,"nonAATransform");var qn=Dn;var uB=-1,AP=!1,Zt=class Zt{addProperty(e){return this.transition=e(this.transition!=null?this.transition:new Pn),this}dissolve(){return this.isDissolve=!0,this.transition=new Pn().transform(this.transition.from().transform1(),this.transition.to().transform1()),this}static buildStrategy(e,r){let n=new Zt;for(let o of Zt.propertyFunctions)if(o(e,r,n),n.isDissolve)return n;return n}static forDiscreteProperties(e,r,n){return n=Zt.nodeTypeToRenderSetMap.get(e.type())==Zt.nodeTypeToRenderSetMap.get(r.type())?n:n.dissolve(),n=e.blendMode()==r.blendMode()?n:n.dissolve(),n=e.clipsToBoundingRectangle()==r.clipsToBoundingRectangle()?n:n.dissolve(),n=e.isFixed()==r.isFixed()?n:n.dissolve(),n}static forSizes(e,r,n){let o=e.size(),i=r.size();if(n.addProperty(l=>l.transformOrigin(o.divideScalar(2),i.divideScalar(2))),n.transition.hasLegacyTransitioningSizesForImageRect()||n.transition.hasTransitioningGeometryForRoundedRectangles()||e.type()=="ROUNDED_RECTANGLE"&&r.type()=="ROUNDED_RECTANGLE")return n;let a=r.isResizeToFit()||Qt.isFrameLike(r.type())&&!r.clipsToBoundingRectangle();return(e.isResizeToFit()||Qt.isFrameLike(e.type())&&!e.clipsToBoundingRectangle())&&Zt._filterPaints3(e.fillPaintsToRender()).length==0&&a&&Zt._filterPaints3(r.fillPaintsToRender()).length==0||o.equals(i)?n:n.dissolve()}static forOpacity(e,r,n){return n.addProperty(o=>o.opacity(e,r))}static forRelativeTransforms(e,r,n){return n.addProperty(o=>o.transform(e,r))}static forFillPaints(e,r,n){let o=Zt._filterPaints2(e),i=Zt._filterPaints2(r);return Zt._maybeInterpolatePaints(o,i,n,a=>a.fillPaints1(o,i))}static forStrokePaints(e,r,n){let o=Zt._filterPaints2(e),i=Zt._filterPaints2(r);return Zt._maybeInterpolatePaints(o,i,n,a=>a.strokePaints1(o,i))}static _filterPaints1(e){return Zt._filterPaints2(e)}static _filterPaints2(e){return e.filter(r=>r.isEnabled())}static _filterPaints3(e){return Zt._filterPaints2(e)}static _maybeInterpolatePaints(e,r,n,o){return!n.transition.hasTransitioningGeometryForRoundedRectangles()&&Yt.FrozenList_equals(e,r,(i,a)=>i.equals1(a))?n:Yt.FrozenList_equals(e,r,(i,a)=>i.type()==a.type()&&i.blendMode()==a.blendMode())?n.addProperty(o):n.dissolve()}static forGeometryAndPaints(e,r,n){var d,u,p,_;let o=e.supportsGeometry(),i=r.supportsGeometry();if(!o&&!i)return n;if(o!=i||Se.containsPatternPaint(e.fillPaints())||Se.containsPatternPaint(r.fillPaints())||Se.containsPatternPaint(e.strokePaints())||Se.containsPatternPaint(r.strokePaints()))return n.dissolve();let a=((d=e.fillGeometry())==null?void 0:d.regions)??[],s=((u=r.fillGeometry())==null?void 0:u.regions)??[],l=(Qt.isFrameLike(e.type())&&e.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(e.type())!=-1)&&Zt._filterPaints2(e.strokePaints()).length==0&&a.length==1&&vt.isRoundedRectSupportedIgnoringCornerSmoothing(e.roundedRectInfo()),c=(Qt.isFrameLike(r.type())&&r.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(r.type())!=-1)&&Zt._filterPaints2(r.strokePaints()).length==0&&s.length==1&&vt.isRoundedRectSupportedIgnoringCornerSmoothing(r.roundedRectInfo());if(l&&c){if(a.length!=0&&s.length!=0){let h=(p=e.fillGeometry())==null?void 0:p.regions[0].bounds().size(),A=(_=r.fillGeometry())==null?void 0:_.regions[0].bounds().size(),m=e.roundedRectInfo(),g=r.roundedRectInfo();if(m!=null&&g!=null){let S=Ko.fromRoundedRect(m),R=Ko.fromRoundedRect(g);(!S.equals(R)||A!=null&&h!=null&&!h.equals(A))&&n.addProperty(E=>E.transitionGeometryForRoundedRectangles(h,S,A,R))}}}else{let h=!1;if(e.isAxisAlignedRectFill()&&r.isAxisAlignedRectFill())for(let A of[e.fillPaints(),r.fillPaints()]){for(let m=0,g=A.length;m<g;m=m+1)if(A[m].type()=="IMAGE"||A[m].type()=="VIDEO"){h=!0;break}if(h)break}if(h){let A=e.fillOrTextGeometry(),m=r.fillOrTextGeometry();if(!(A!=null&&A.geometryEquals(m))){let g=Zt._filterPaints1(e.fillRegionPaints()[0]),S=Zt._filterPaints1(r.fillRegionPaints()[0]);if(Yt.FrozenList_equals(g,S,(R,E)=>R.type()==E.type()))return n.addProperty(R=>R.fillPaints1(g,S)),n.addProperty(R=>R.shouldDoLegacyImageRectSizeTransition(!0)),n}}n=Zt._forGeometryStructure(e.fillOrTextGeometry(),r.fillOrTextGeometry(),n),K.getFeatureFlags().viewer_smart_animate_underline&&(n=Zt._forTextDecorationStructure(e.textGeometry(),r.textGeometry(),n))}return n=Zt._forGeometryPaints(e.fillRegionPaints(),r.fillRegionPaints(),n,(h,A,m)=>Zt.forFillPaints(h,A,m)),n=Zt._forGeometryStructure(e.strokeGeometry(),r.strokeGeometry(),n),n=Zt._forGeometryPaints(e.strokeRegionPaints(),r.strokeRegionPaints(),n,(h,A,m)=>Zt.forStrokePaints(h,A,m)),n}static forEffects(e,r,n){let o=e.filter(a=>a.isVisibleForRendering()),i=r.filter(a=>a.isVisibleForRendering());return ie.List_equalsWithComparison(o,i,(a,s)=>a.equalsWithinEffectType(s))&&!n.transition.hasTransitioningTransformOrigin()?n:ie.List_equalsWithComparison(o,i,(a,s)=>{let l=K.getFeatureFlags().enable_smart_animate_for_blurs,c=K.getFeatureFlags().enable_smart_animate_for_prog_blurs;return a.type()!=s.type()?!1:a.type()=="FOREGROUND_BLUR"||a.type()=="BACKGROUND_BLUR"?a.blurOpType()=="NORMAL"&&!l||a.blurOpType()=="PROGRESSIVE"&&!c?!1:a.blurOpType()==s.blurOpType():a.type()=="GRAIN"?a.clipToShape()==s.clipToShape()&&a.seed()==s.seed():a.type()=="NOISE"?a.noiseType()==s.noiseType()&&a.blendMode()==s.blendMode()&&a.seed()==s.seed():a.type()=="GLASS"?!0:!!a.equalsWithinEffectType(s)})?n.addProperty(a=>a.setEffectsForTransition(o,i)):n.dissolve()}static forTransformModifiers(e,r,n){let o=e.filter(a=>a.isVisibleForRendering()),i=r.filter(a=>a.isVisibleForRendering());return ie.List_equalsWithComparison(o,i,(a,s)=>a.equals(s))?n:n.dissolve()}static _forGeometryStructure(e,r,n){return e!=null&&r!=null?e.geometryEquals(r)?n:n.dissolve():e==null&&r==null?n:n.dissolve()}static _forTextDecorationStructure(e,r,n){return e!=null&&r!=null?e.decorationRegionsEquals(r)?n:n.dissolve():e==null&&r==null?n:n.dissolve()}static _forGeometryPaints(e,r,n,o){if(e.length==r.length){for(let i=0,a=e.length;i<a;i=i+1)if(n=o(e[i],r[i],n),n.isDissolve)return n;return n}return n.dissolve()}constructor(){this.isDissolve=!1,this.transition=new Pn}};Zt.propertyFunctions=[(e,r,n)=>{let o=e.overlayTransform().clone();o.multiply(e.relativeTransformAccountingForFixedOffset());let i=r.overlayTransform().clone();i.multiply(r.relativeTransformAccountingForFixedOffset()),Zt.forRelativeTransforms(o,i,n)},(e,r,n)=>{Zt.forGeometryAndPaints(e,r,n)},(e,r,n)=>{Zt.forSizes(e,r,n)},(e,r,n)=>{Zt.forDiscreteProperties(e,r,n)},(e,r,n)=>{Zt.forOpacity(e.opacity(),r.opacity(),n)},(e,r,n)=>{Zt.forEffects(e.effects(),r.effects(),n)},(e,r,n)=>{Zt.forTransformModifiers(e.transformModifiers(),r.transformModifiers(),n)}],Zt.nodeTypeToRenderSetMap=[["NONE","DOCUMENT","SLICE"],["CANVAS","GROUP","FRAME","SYMBOL","INSTANCE","CONNECTOR","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","MEDIA","SECTION_OVERLAY","TABLE","TABLE_CELL","SLIDE","MODULE"],["ELLIPSE","LINE","RECTANGLE","REGULAR_POLYGON","ROUNDED_RECTANGLE","STAR","VECTOR","STAMP","WASHI_TAPE"],["BOOLEAN_OPERATION"],["TEXT"]].reduce((e,r,n)=>(r.forEach(o=>{e.set(o,n)}),e),new Map);var Td=Zt;var ai=class t{constructor(e,r,n,o){this._lastInputTForAbsoluteTransform=-1;this._oldSceneNode=e,this._oldCanvasToRenderTreeTransform=r,this._newSceneNode=n,this._newCanvasToRenderTreeTransform=o,this._children=[],this._enabledTraits=uB,this._parent=null,this._transition=null,this._isDissolve=!1,this._scalesIndependentlyOfParent=!1,this._forceMask=!1,this._interpolateScalingToCachedAbsoluteTransform=new Map}get isDissolve(){return this._isDissolve}get scalesIndependentlyOfParent(){return this._scalesIndependentlyOfParent}get forceMask(){return this._forceMask}get enabledTraits(){return this._enabledTraits}get transition(){return this._transition}setTransition(e){this._transition=e,this._referenceTransitionForChildrenNodes=e}clearTransitionForDissolveRenderTrees(){var r;let e=((r=this.transition)==null?void 0:r.clone().transform(X.new2(),X.new2()))??null;this._transition=e}get parent(){return this._parent}get children(){return this._children}static debugStringRecursive(e,r,n,o){var s,l;r.result+=r.indent,n||(r.result+=o?"\u2514\u2500":"\u251C\u2500");let i=r.indent.length;n||(r.indent+=o?"  ":"\u2502 "),r.result+=`${((s=e._oldSceneNode)==null?void 0:s.name())??"null"} -> ${((l=e._newSceneNode)==null?void 0:l.name())??"null"}`,e.forceMask&&(r.result+=" (.MASK)");let a=e.transition;if(a!=null){let c=a.from(),d=a.to();if(r.result+=e.isDissolve?" (dissolve)":"",r.result+=a.hasTransitioningPaints()&&4&e.enabledTraits?` (paints) ${c.fillPaintsToString()} -> ${d.fillPaintsToString()}`:"",r.result+=a.hasTransitioningGeometryForRoundedRectangles()&&16&e.enabledTraits?" (geometry)":"",(c.opacity1()!=1||c.opacity1()!=d.opacity1())&&(r.result+=` (opacity: ${c.opacity1()} -> ${d.opacity1()})`),c.translation1().equals(d.translation1())||(r.result+=` (translation: ${c.translation1()} -> ${d.translation1()})`),!c.transform1().equals1(d.transform1())){let u=Do.from(c.transform1()),p=Do.from(d.transform1());u.translation.approximatelyEquals(p.translation,1e-6)||(r.result+=` (translation: ${u.translation} -> ${p.translation})`),u.scale.approximatelyEquals(p.scale,1e-6)||(r.result+=` (scale: ${u.scale} -> ${p.scale})`),u.angleDegrees!=p.angleDegrees&&(r.result+=` (angle: ${u.angleDegrees} deg -> ${p.angleDegrees} deg)`)}}r.result+=`
`;for(let c=0,d=e.children.length;c<d;c=c+1)this.debugStringRecursive(e.children[c],r,!1,c==e.children.length-1);e.isDissolve&&(this.debugStringRecursive(e.forDissolveStart1(),r,!1,!1),this.debugStringRecursive(e.forDissolveEnd1(),r,!1,!0)),r.indent=r.indent.slice(0,i)}static _generatePlanForMatchedNodes(e,r,n,o,i,a){let s=Td.buildStrategy(e,n);if(s.transition.hasLegacyTransitioningSizesForImageRect()){let c=s.transition;c.scaling(new O(1,1),n.size().divide(e.size()));let d=new t(e,r,n,o);return d._isDissolve=!1,d.setTransition(c),d}let l=this.getMagicMovePlan1(e,r,n,o,i,null,e.isFixed()?Vr.DISSOLVE:a);return l._isDissolve=s.isDissolve,l.setTransition(s.transition),l}static _generatePlanForRemovedNode(e,r,n){let o=new t(e,r,null,null);if(n!=null&&n.isDissolve()){let i=new Pn().opacity(e.opacity(),0);i.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),o.setTransition(i)}else{let i=new Pn().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(i.translation(n.exitingFrameTransition().from().translation1(),n.exitingFrameTransition().to().translation1()),i.opacity(e.opacity()*n.exitingFrameTransition().from().opacity1(),e.opacity()*n.exitingFrameTransition().to().opacity1())):i.opacity(e.opacity(),e.opacity()),o.setTransition(i)}return e.forEachChild(i=>{o._appendChild(this._generatePlanForRemovedNode(i,r,null))},!0),o}static _generatePlanForInsertedNode(e,r,n){let o=new t(null,null,e,r);if(n!=null&&n.isDissolve()){let i=new Pn().opacity(0,e.opacity());i.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),o.setTransition(i)}else{let i=new Pn().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(i.translation(n.enteringFrameTransition().from().translation1(),n.enteringFrameTransition().to().translation1()),i.opacity(e.opacity()*n.enteringFrameTransition().from().opacity1(),e.opacity()*n.enteringFrameTransition().to().opacity1())):i.opacity(e.opacity(),e.opacity()),o.setTransition(i)}return e.forEachChild(i=>{o._appendChild(this._generatePlanForInsertedNode(i,r,null))},!0),o}static _matchKey(e){return e.name()}static _getNodeMatches(e,r,n,o){if(!o&&(e.type()=="BOOLEAN_OPERATION"||r.type()=="BOOLEAN_OPERATION"))return;let i=new Map;r.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l;i.has(s)?l=i.get(s):(l=[],i.set(s,l)),l.push(a)}),e.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=Qe.StringMap_get(i,s,null);if(l==null||l.length==0)return;let c=l.shift();n.set(a.id(),c),n.set(c.id(),a),this._getNodeMatches(a,c,n,o)})}static getNodeMatches(e,r){let n=new Map;return this._getNodeMatches(e,r,n,!1),n}static getMagicMovePlan1(e,r,n,o,i,a,s){a==null&&(a=new Pn);let l=e.isTopLevel()&&n.isTopLevel(),c=new t(e,r,n,o);if(e.type()=="BOOLEAN_OPERATION"||n.type()=="BOOLEAN_OPERATION")return c;for(let u=0;u<n.childCount();u=u+1){let p=n.childAt2(u,!0),_=Qe.StringMap_get(i,p.id(),null);_==null?c._appendChild(this._generatePlanForInsertedNode(p,o,s)):c._appendChild(this._generatePlanForMatchedNodes(_,r,p,o,i,s))}let d=0;for(;d<e.childCount();){let u=[],p=d,_=d;for(;d<e.childCount();){let R=e.childAt2(d,!0);if(i.has(R.id()))break;u.push(this._generatePlanForRemovedNode(R,r,s)),_=d,d=d+1}if(u.length==0){d=d+1;continue}let h=-1,A=c.children.length;if(p-1>=0){let R=e.childAt2(p-1,!0);if(R!=null){let E=Qe.StringMap_get(i,R.id(),null);E!=null&&(h=c.indexOfSceneNodeInChildren(E))}}if(_+1<e.childCount()){let R=e.childAt2(_+1,!0);if(R!=null){let E=Qe.StringMap_get(i,R.id(),null);E!=null&&(A=c.indexOfSceneNodeInChildren(E))}}let m=Math.min(h,A),g=Math.max(h,A),S=s.drawsEnteringFrameOnTopOfExitingFrame()?m+1:g;c.insertChildren(S,u)}if(l){c._enabledTraits&=-5,c._enabledTraits&=-9,c._enabledTraits&=-65,c._enabledTraits&=-3,c._enabledTraits&=-33,c._enabledTraits&=-129;let u=e.clipsToBoundingRectangle()&&e.containerSupportsFillStrokeAndCorners()||n.clipsToBoundingRectangle()&&n.containerSupportsFillStrokeAndCorners(),p=new t(e,r,n,o);p._enabledTraits=156,u&&(p._enabledTraits&=-9),p._isDissolve=!0,p.setTransition(new Pn);let _=u,h=e.fillGeometry(),A=n.fillGeometry();if(h!=null&&A!=null&&(_=_&&!h.geometryEquals(A)),_){let S=c,R=new t(e,r,n,o);R._enabledTraits=20,R.setTransition(new Pn),R._forceMask=!0,R._isDissolve=!0,c=new t(e,r,n,o),c._enabledTraits=0,c._isDissolve=!1,c.setTransition(new Pn),c._appendChild(R),c._appendChild(S)}else c._enabledTraits|=130;let m=[p,c];if(u){let S=new t(e,r,n,o);S._enabledTraits=24,S._isDissolve=!0,S.setTransition(new Pn),m.push(S)}a.opacity(e.opacity(),n.opacity());let g=new t(e,r,n,o);return g._enabledTraits=224,g.insertChildren(0,m),g.setTransition(a),g}else return c}static getMagicMovePlanForStateSwapTransition(e,r){var a;let n=this.getNodeMatches(e,r),o=((a=r.parent())==null?void 0:a.absoluteTransform())??yt.FrozenAffineTransform_IDENTITY,i=this._generatePlanForMatchedNodes(e,yt.FrozenAffineTransform_IDENTITY,r,yt.FrozenAffineTransform_IDENTITY,n,Vr.DISSOLVE);if(i.transition!=null){let s=i.transition;i.setTransition(s.clone().transform(o.clone().multipliedBy1(s.from().transform1()),o.clone().multipliedBy1(s.to().transform1())))}return AP&&(console.log("------------------------------"),console.log("getMagicMovePlanForStateSwapTransition between interactive component states"),console.log(i.debugString()),console.log("------------------------------")),i}static getMagicMovePlan2(e,r,n,o,i){let a=this.getNodeMatches(e,n),s=new Pn().transform(r.clone().multipliedBy1(e.absoluteTransform()),o.clone().multipliedBy1(n.absoluteTransform()));return this.getMagicMovePlan1(e,r,n,o,a,s,i)}static renderTreeForMagicMove(e,r,n,o,i){let a=X.new2().copyFrom(e.absoluteTransform());a.invert();let s=X.new2();s.leftMultiply(a),s.leftMultiply(r.absoluteTransform());let l=yt.FrozenAffineTransform_IDENTITY,c=e.size().max(r.size()),d=this.getMagicMovePlan2(e,s,r,l,i.withScaledTranslation(c)),u=!0,p=()=>u?0:n(),_=new Qi(d,null,p,o,null),h=Re.renderTreeWithPerfLogging1(_,"renderTreeForMagicMove");return AP&&(console.log("------------------------------"),console.log(`renderTreeForMagicMove between top-level frames ${e.id()} -> ${r.id()}`),console.log(d.debugString()),console.log(h==null?void 0:h.debugString1()),console.log("------------------------------")),u=!1,h??null}forDissolveStart1(){return this.forDissolveStart2(null)}forDissolveStart2(e){var o,i,a;let r=new t(this._oldSceneNode,this._oldCanvasToRenderTreeTransform,null,null);r._enabledTraits=this._enabledTraits,r._forceMask=this._forceMask;let n=((a=this._referenceTransitionForChildrenNodes)==null?void 0:a.clone().opacity(((o=this._oldSceneNode)==null?void 0:o.opacity())??0,((i=this._oldSceneNode)==null?void 0:i.opacity())??0))??null;return n!=null&&this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._oldSceneNode,this._newSceneNode,s=>{n.scaling(ge.FrozenVector_ONE,new O(s,s))},n.to().transform1(),s=>{n.transform(n.from().transform1(),s)}):n.hasTransitioningGeometryForRoundedRectangles()||n.scaling(ge.FrozenVector_ONE,af(this._newSceneNode).divide(af(this._oldSceneNode))),n.transformOrigin(this._oldSceneNode.size().divideScalar(2),this._newSceneNode.size().divideScalar(2))),r._isDissolve=!1,r.setTransition(n),e!=null&&n!=null&&(n.from().scaling1().divide(n.to().scaling1()).equals(e.from().scaling1().divide(e.to().scaling1()))||(r._scalesIndependentlyOfParent=!0)),this.children.forEach(s=>{s._oldSceneNode!=null&&r._appendChild(s.forDissolveStart2(n))}),r}forDissolveEnd1(){return this.forDissolveEnd2(null)}forDissolveEnd2(e){var o,i,a;let r=new t(null,null,this._newSceneNode,this._newCanvasToRenderTreeTransform);r._enabledTraits=this._enabledTraits,r._forceMask=this._forceMask;let n=((a=this._referenceTransitionForChildrenNodes)==null?void 0:a.clone().opacity(((o=this._newSceneNode)==null?void 0:o.opacity())??0,((i=this._newSceneNode)==null?void 0:i.opacity())??0))??null;return n!=null&&this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._newSceneNode,this._oldSceneNode,s=>{n.scaling(new O(s,s),ge.FrozenVector_ONE)},n.from().transform1(),s=>{n.transform(s,n.to().transform1())}):n.hasTransitioningGeometryForRoundedRectangles()||n.scaling(af(this._oldSceneNode).divide(af(this._newSceneNode)),ge.FrozenVector_ONE),n.transformOrigin(this._oldSceneNode.size().divideScalar(2),this._newSceneNode.size().divideScalar(2))),r._isDissolve=!1,r.setTransition(n),e!=null&&n!=null&&(n.from().scaling1().divide(n.to().scaling1()).equals(e.from().scaling1().divide(e.to().scaling1()))||(r._scalesIndependentlyOfParent=!0)),this.children.forEach(s=>{s._newSceneNode!=null&&r._appendChild(s.forDissolveEnd2(n))}),r}_maybeUpdateDissolveTransitionsForText(e,r,n,o,i){if(r.type()!="TEXT"||e.type()!="TEXT")return;let a=r.textGeometry(),s=e.textGeometry();if(a==null||s==null)return;let l=1;!r.textHasMixedFontSizes()&&!e.textHasMixedFontSizes()&&r.fontSize()>0&&e.fontSize()>0&&(l=r.fontSize()/e.fontSize(),n(l));let c=O.new(),d=x.new4(r.relativeTransform().translation(),r.size()),u=x.new4(e.relativeTransform().translation(),e.size()),p,_,h=x.new2();switch(r.textAlignHorizontal()==e.textAlignHorizontal()?(p=a.bounds,_=s.bounds):(p=d,_=u),h.copyFrom(_).scaledBy1(l),e.textAlignHorizontal()){case"RIGHT":{c.setX(p.right()-_.right()-(h.right()-_.right()));break}case"CENTER":case"JUSTIFIED":{c.setX(p.center().x()-_.center().x()-(h.center().x()-_.center().x()));break}}switch(r.textAlignVertical()==e.textAlignVertical()?(p=a.bounds,_=s.bounds):(p=d,_=u),h.copyFrom(_).scaledBy1(l),e.textAlignVertical()){case"BOTTOM":{c.setY(p.bottom()-_.bottom()-(h.bottom()-_.bottom()));break}case"CENTER":{c.setY(p.center().y()-_.center().y()-(h.center().y()-_.center().y()));break}}if(!c.equals(O.new())){let A=X.new3(o);A.translate1(c),i(A)}}sceneNode(){return this._oldSceneNode??this._newSceneNode}isEverVisible(){return this._isSceneNodeEverVisible(this._oldSceneNode)||this._isSceneNodeEverVisible(this._newSceneNode)}_isSceneNodeEverVisible(e){return e!=null&&e.visible()&&e.opacity()>0}absoluteTransform1(e){return K.smartAnimateCacheTransform()?this.absoluteTransform2WithCaching(e,1):this.absoluteTransform2(e,1)}invalidateCachedAbsoluteTransformsForSelf(){K.smartAnimateCacheTransform()&&(this._lastInputTForAbsoluteTransform=-1,this._interpolateScalingToCachedAbsoluteTransform.set(0,null),this._interpolateScalingToCachedAbsoluteTransform.set(1,null))}absoluteTransform2WithCaching(e,r){return e!=this._lastInputTForAbsoluteTransform&&(this._lastInputTForAbsoluteTransform=e,this._interpolateScalingToCachedAbsoluteTransform.set(0,null),this._interpolateScalingToCachedAbsoluteTransform.set(1,null)),this._interpolateScalingToCachedAbsoluteTransform.get(r)||this._interpolateScalingToCachedAbsoluteTransform.set(r,this.absoluteTransform2(e,r)),this._interpolateScalingToCachedAbsoluteTransform.get(r)}absoluteTransform2(e,r){let n=X.new2();if(this._transition!=null){let o=this._transition.interpolateTranslation(e);n.translate1(o)}if(this._parent!=null&&n.multiply(this._parent.absoluteTransform2(e,0)),this._transition!=null){let o=this._transition.interpolateTransform(e);if(n.multiply(o),r){let i=this._transition.interpolateScaling(e);n.scale3(i)}}return n}rotatesOrScales1(){return this.rotatesOrScales2(!0)}rotatesOrScales2(e){var n,o,i;let r=this._transition!=null;return e?r=r&&!((n=this._transition)!=null&&n.from().equalTransformsUpToTranslation(this._transition.to(),1e-10)):r=r&&!((i=this._transition)!=null&&i.from().equalTransformsUpToTranslationAndScaling((o=this._transition)==null?void 0:o.to(),1e-10)),this._parent!=null&&(r=r||this._parent.rotatesOrScales2(!1)),r}_appendChild(e){e._parent=this,this._children.push(e)}insertChildren(e,r){for(let n of r)n._parent=this;GE(this._children,e,r)}removeChild(e){this._children.splice(e,1)}debugString(){let e=new cT;return t.debugStringRecursive(this,e,!0,!0),e.result}indexOfSceneNodeInChildren(e){for(let r=0;r<this.children.length;r=r+1){let n=this.children[r];if(n._oldSceneNode==e||n._newSceneNode==e)return r}return-1}indexInParent(){return this._parent!=null?this._parent.children.indexOf(this):-1}},cT=class{constructor(){this.result="",this.indent=""}},Qi=class t{constructor(){this._overlayRenderData=null;arguments.length==5?(this._planNode=arguments[0],this._node=arguments[1],this._getEasedT=arguments[2],this._easingFunction=arguments[3],this._overlayRenderData=arguments[4]):arguments.length==3&&(this._planNode=arguments[0],this._node=null,this._getEasedT=arguments[1],this._easingFunction=arguments[2]);let e=this._planNode.sceneNode();this._sceneNodeCursor=new Kt(e,this._overlayRenderData)}clone(){return new t(this._planNode,this._node,this._getEasedT,this._easingFunction,this._overlayRenderData)}_updateSceneNodeCursorForCurrentPlanNode(){let e=this._planNode.sceneNode();this._sceneNodeCursor.setNode(e)}moveToChildAt(e){this._planNode=this._planNode.children[e],this._node=this._node!=null&&e<this._node.childCount()?this._node.childAt2(e,!0):null,this._updateSceneNodeCursorForCurrentPlanNode()}moveToParent(){this._planNode=this._planNode.parent,this._node=this._node!=null?this._node.parent():null,this._updateSceneNodeCursorForCurrentPlanNode()}isRoot(){return this._planNode.parent==null}hasTransitioningPaints(){var e;return((e=this._planNode.transition)==null?void 0:e.hasTransitioningPaints())??!1}indexInParent(){return this._planNode.indexInParent()}renderableContentType(){return this.hasCustomRenderTree()?yr.RenderableContentType.CUSTOM_RENDER_TREE:16&this._planNode.enabledTraits?this._sceneNodeCursor.renderableContentType():yr.RenderableContentType.RENDERABLE_GROUP}isFrameLike(){return this._planNode.isDissolve?!1:Qt.isFrameLike(this.type())}isTopLevel(){return!1}paintsDebugString(){var e,r;return`AnimationPlanNode [from=${((e=this._planNode._oldSceneNode)==null?void 0:e.paintsDebugString())??"null"}] [to=${((r=this._planNode._newSceneNode)==null?void 0:r.paintsDebugString())??"null"}]`}isBrushInstanceType(e){return this._sceneNodeCursor.isBrushInstanceType(e)}getStrokeBrush(){return this._sceneNodeCursor.getStrokeBrush()}getStrokeBrushCursor(){return this._sceneNodeCursor.getStrokeBrushCursor()}getScatterBrushInstanceTransforms(){return this._sceneNodeCursor.getScatterBrushInstanceTransforms()}hasScatterBrushInstanceTransforms(){return this._sceneNodeCursor.hasScatterBrushInstanceTransforms()}subtreeWillChange(){var r,n,o,i,a,s;if(this._planNode.cachedSubtreeWillChange!==void 0)return this._planNode.cachedSubtreeWillChange;if(this._sceneNodeCursor.node!=null&&this._sceneNodeCursor.node.isTopLevel())return this._planNode.cachedSubtreeWillChange=!0,!0;if((r=this._planNode._oldSceneNode)!=null&&r.dependsOnBackgroundContent()||(n=this._planNode._newSceneNode)!=null&&n.dependsOnBackgroundContent())return this._planNode.cachedSubtreeWillChange=!0,!0;if((((i=(o=this._planNode._oldSceneNode)==null?void 0:o.effects().filter(l=>l.type()=="DROP_SHADOW"&&l.isVisibleForRendering()))==null?void 0:i.length)??0)>0||(((s=(a=this._planNode._newSceneNode)==null?void 0:a.effects().filter(l=>l.type()=="DROP_SHADOW"&&l.isVisibleForRendering()))==null?void 0:s.length)??0)>0)return this._planNode.cachedSubtreeWillChange=!0,!0;if(!this._planNode.isEverVisible())return this._planNode.cachedSubtreeWillChange=!1,!1;if(this.willChange()!==0)return this._planNode.cachedSubtreeWillChange=!0,!0;if(this._planNode.isDissolve||this._planNode.transition!=null&&(this._planNode.transition.hasTransitioningPaints()||this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()||this._planNode.transition.hasTransitioningEffects()))return this._planNode.cachedSubtreeWillChange=!0,!0;if(this.childCount()===0)return this._planNode.cachedSubtreeWillChange=!1,!1;for(let l=this.childCount()-1;l>=0;l=l-1){this.moveToChildAt(l);let c=this.subtreeWillChange();if(this.moveToParent(),c!=!1)return this._planNode.cachedSubtreeWillChange=!0,!0}return this._planNode.cachedSubtreeWillChange}willChange(){if(this._planNode.transition==null||!this._planNode.isEverVisible())return 0;let e=0;return this._planNode.transition.from().opacity1()!=this._planNode.transition.to().opacity1()&&(e|=2),this._planNode.transition.hasTransitioningEffects()&&(e|=4),(this._planNode.transition.hasTransitioningTranslation()||this._planNode.transition.hasTransitioningTransform()||this._planNode.transition.hasTransitioningScaling()||this._planNode.transition.hasTransitioningTransformOrigin())&&(e|=1),this._planNode.scalesIndependentlyOfParent&&(e|=1),e}size(){return this._planNode.sceneNode().size()}shouldOptimizeShadowForAnimation(e){return e==null||e.equals(ge.FrozenVector_ZERO)?!1:this._planNode.rotatesOrScales1()}hasCustomRenderTree(){return this._planNode.isDissolve}customRenderTree(e){var r,n,o,i;if(this._planNode.isDissolve){let a=this._planNode.indexInParent(),s=this._planNode.forDissolveStart1();(r=this._planNode.parent)==null||r.insertChildren(a,[s]);let l=Re.generateRenderTree(new t(s,this._getEasedT,this._easingFunction),e);(n=this._planNode.parent)==null||n.removeChild(a);let c=null;if(this._node!=null&&this._node.dependsOnBackgroundContent())c=Re.generateRenderTree(new Kt(this._node),e);else{let u=this._planNode.forDissolveEnd1();(o=this._planNode.parent)==null||o.insertChildren(a,[u]),c=Re.generateRenderTree(new t(u,this._getEasedT,this._easingFunction),e),(i=this._planNode.parent)==null||i.removeChild(a)}let d=new Nn(l,c,St.forAnimateableDissolve(this._planNode.sceneNode().id()),this._getEasedT);return this._planNode.clearTransitionForDissolveRenderTrees(),this._planNode.invalidateCachedAbsoluteTransformsForSelf(),this._planNode.cachedSubtreeWillChange=!0,d}throw new Error("Unhandled customRenderTree case")}opacity(){return 32&this._planNode.enabledTraits?this._planNode.transition!=null?this._planNode.transition.interpolateOpacity(this._getEasedT()):this._sceneNodeCursor.opacity():1}absoluteTransform(){return this._planNode.absoluteTransform1(this._getEasedT())}relativeTransform(){return this._sceneNodeCursor.relativeTransform()}maxTransformScale(){let e=this._planNode.transition;if(e==null)return 1;let r=e.from().scaling1(),o=e.to().scaling1().divide(r).minComponent();return Math.max(o,1)}scene(){return this._sceneNodeCursor.scene()}parent(){if(this._planNode.parent==null)return null;let e=this._node!=null?this._node.parent():null;return new t(this._planNode.parent,e,this._getEasedT,this._easingFunction,this._overlayRenderData)}blendMode(){return 32&this._planNode.enabledTraits?this._sceneNodeCursor.blendMode():"PASS_THROUGH"}visible(){return this._sceneNodeCursor.visible()}isVisibleMask(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.isVisibleMask():!1}maskType(){return this._sceneNodeCursor.maskType()}isSpreadEligibleNode(){return this._sceneNodeCursor.isSpreadEligibleNode()}type(){return this._sceneNodeCursor.type()}childCount(){return this._planNode.children.length}clipsChildren(){return 2&this._planNode.enabledTraits?this._sceneNodeCursor.clipsChildren():!1}stopsMaskPropagation(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.stopsMaskPropagation():!1}strokeAlign(){return this._sceneNodeCursor.strokeAlign()}strokeWeight(){return this._sceneNodeCursor.strokeWeight()}hasDefaultStrokeParameters(){return this._sceneNodeCursor.hasDefaultStrokeParameters()}strokeJoin(){return this._sceneNodeCursor.strokeJoin()}setStrokeJoin(e){this._sceneNodeCursor.setStrokeJoin(e)}strokeMiterLimit(){return this._sceneNodeCursor.strokeMiterLimit()}setStrokeMiterLimit(e){this._sceneNodeCursor.setStrokeMiterLimit(e)}uniqueIdentifier(){return this._sceneNodeCursor.id()}isInsideOutlineMask(){return this._sceneNodeCursor.isInsideOutlineMask()}textData(){return this._sceneNodeCursor.textData()}derivedTextData(){return this._sceneNodeCursor.derivedTextData()}arcData(){return this._sceneNodeCursor.arcData()}isRoundedRect(){return this._sceneNodeCursor.isRoundedRect()}roundedRectInfo(){return this._sceneNodeCursor.roundedRectInfo()}codeSnapshot(){return this._sceneNodeCursor.codeSnapshot()}fillGeometry(){if(16&this._planNode.enabledTraits){if(this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles())return this._planNode.transition.fillGeometryForRoundedRectangles(this._getEasedT,this._easingFunction.bounds)}else return null;return this._sceneNodeCursor.fillGeometry()}strokeGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.strokeGeometry():null}fillGeometryForSpread(e,r,n){return 16&this._planNode.enabledTraits&&this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()?this._planNode.transition.fillGeometryForSpreadDynamic(e,r,this._getEasedT,n,this.uniqueIdentifier(),this._easingFunction.bounds):this._sceneNodeCursor.fillGeometryForSpread(e,r,n)}strokeGeometryForSpread(e,r,n,o){return this._sceneNodeCursor.strokeGeometryForSpread(e,r,n,o)}textGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.textGeometry():null}getCachedRenderTree(){return null}getCachedBaseScreenRenderTree(){return null}renderTree(){if(!this.subtreeWillChange()){let r=null;return this._sceneNodeCursor.node.getCachedRenderTreeForBaseScreen()!=null?r=this._sceneNodeCursor.node.renderTreeForBaseScreen1():r=this._sceneNodeCursor.renderTree(),this.wrapNonAnimatingSubTreeWithPositionTransform(r)}let e=new Re.GenerateArgs(Re.RenderMode.NORMAL);return Re.generateRenderTree(this.clone(),e)}renderTreeWithoutBackgroundBlursAndGlassEffects(){if(!this.subtreeWillChange()){let r=this._sceneNodeCursor.renderTreeWithoutBackgroundBlursAndGlassEffects();return this.wrapNonAnimatingSubTreeWithPositionTransform(r)}let e=new Re.GenerateArgs(Re.RenderMode.WITHOUT_BACKGROUND_BLURS_AND_GLASS_EFFECTS);return Re.generateRenderTree(this.clone(),e)}renderTreeWithoutGlassEffects(){if(!this.subtreeWillChange()){let r=this._sceneNodeCursor.renderTreeWithoutGlassEffects();return this.wrapNonAnimatingSubTreeWithPositionTransform(r)}let e=new Re.GenerateArgs(Re.RenderMode.WITHOUT_GLASS_EFFECTS);return Re.generateRenderTree(this.clone(),e)}renderTreeForShadowRoot(){if(!this.subtreeWillChange()){let r=this._sceneNodeCursor.renderTreeForShadowRoot();return this.wrapNonAnimatingSubTreeWithPositionTransform(r)}let e=new Re.GenerateArgs(Re.RenderMode.SHADOW,this.uniqueIdentifier());return Re.generateRenderTree(this.clone(),e)}renderTreeForShadowDescendant(){if(!this.subtreeWillChange()){let r=this._sceneNodeCursor.renderTreeForShadowDescendant();return this.wrapNonAnimatingSubTreeWithPositionTransform(r)}let e=new Re.GenerateArgs(Re.RenderMode.SHADOW);return Re.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowRoot(){if(!this.subtreeWillChange()){let r=this._sceneNodeCursor.renderTreeForKnockoutShadowRoot();return this.wrapNonAnimatingSubTreeWithPositionTransform(r)}let e=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Re.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowDescendant(){if(!this.subtreeWillChange()){let r=this._sceneNodeCursor.renderTreeForKnockoutShadowDescendant();return this.wrapNonAnimatingSubTreeWithPositionTransform(r)}let e=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW);return Re.generateRenderTree(this.clone(),e)}renderTreeForSlideThumbnail(){if(!this.subtreeWillChange()){let r=this._sceneNodeCursor.renderTreeForSlideThumbnail();return this.wrapNonAnimatingSubTreeWithPositionTransform(r)}let e=new Re.GenerateArgs(Re.RenderMode.SLIDE_THUMBNAIL);return Re.generateRenderTree(this.clone(),e)}renderTreeWithoutEffects(){if(!this.subtreeWillChange()){let r=this._sceneNodeCursor.renderTreeWithoutEffects();return this.wrapNonAnimatingSubTreeWithPositionTransform(r)}let e=new Re.GenerateArgs(Re.RenderMode.WITHOUT_EFFECTS);return Re.generateRenderTree(this.clone(),e)}wrapNonAnimatingSubTreeWithPositionTransform(e){if(e==null)return null;if(this._planNode._oldSceneNode==null){let r=this._planNode._newSceneNode.absoluteTransform(),n=this.absoluteTransform().clone();return n=n.multipliedBy1(r.inverse()),new So(e,n)}else return new So(e,this._planNode._oldCanvasToRenderTreeTransform)}isFixed(){return this._sceneNodeCursor.isFixed()}isStandardScrolling(){return this._sceneNodeCursor.isStandardScrolling()}isStickyScrolling(){return this._sceneNodeCursor.isStickyScrolling()}scrollOffset(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollOffset():ge.FrozenVector_ZERO}scrollSpeedMultiplier(){return this._sceneNodeCursor.scrollSpeedMultiplier()}scrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollDirection():"NONE"}hasOverflowingContentInScrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.hasOverflowingContentInScrollDirection():!1}effects(){var r;if(this._planNode.isDissolve||!(64&this._planNode.enabledTraits))return[];let e=((r=this._planNode.transition)==null?void 0:r.effects2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.effects():e}transformModifiers(){return this._planNode.isDissolve||!(512&this._planNode.enabledTraits)?[]:this._sceneNodeCursor.transformModifiers()}fillPaints(){var r;if(!(4&this._planNode.enabledTraits))return Se.EMPTY;if(this._planNode.forceMask)return[ee.createSolid(N.BLACK,1)];let e=((r=this._planNode.transition)==null?void 0:r.fillPaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.fillPaints():e}strokePaints(){var r;if(!(8&this._planNode.enabledTraits))return Se.EMPTY;let e=((r=this._planNode.transition)==null?void 0:r.strokePaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.strokePaints():e}textDecorationFillPaints(){var r;if(!(256&this._planNode.enabledTraits))return Se.EMPTY;if(this._planNode.forceMask)return[ee.createSolid(N.BLACK,1)];let e=((r=this._planNode.transition)==null?void 0:r.setTextDecorationPaints(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.textDecorationFillPaints():e}fillPaintsToRender(){return 4&this._planNode.enabledTraits?this._sceneNodeCursor.fillPaintsToRender():Se.EMPTY}videoPlayback(){return this._sceneNodeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._sceneNodeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._sceneNodeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._sceneNodeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._sceneNodeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._sceneNodeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._sceneNodeCursor.node.overrideKey()}name(){return this._sceneNodeCursor.node.name()}getSemanticNodePath(){return this._sceneNodeCursor.getSemanticNodePath()}dependsOnBackgroundContent(){return this._sceneNodeCursor.dependsOnBackgroundContent()}overlayRenderData(){return this._sceneNodeCursor.overlayRenderData()}containsIndependentBordersStrokeMask(){return this._sceneNodeCursor.containsIndependentBordersStrokeMask()}generateStrokeAndStrokeMaskGeometries(e,r,n){return this._sceneNodeCursor.generateStrokeAndStrokeMaskGeometries(e,r,n)}canvasSpaceContentBounds(){return this._sceneNodeCursor.canvasSpaceContentBounds()}};function af(t){var i;if(t.fillGeometry()!=null&&((i=t.fillGeometry())==null?void 0:i.regions.length)!=0)return t.size();let e=t.size().x()<=.1,r=t.size().y()<=.1;if(e==r)return t.size();let n=Math.max(t.strokeWeight(),.1),o=O.new(t.size());return e?o.setX(n):o.setY(n),o}var qi=class t{constructor(){var e,r,n,o;if(arguments.length==6){let i=arguments[0],a=arguments[2];if(this._stateGroupSwapInteractionCounts=arguments[3],this._ongoingObjectAnimation=arguments[4],this._objectAnimationProgressTracker=arguments[5],this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this._sceneCursor=null,this._planTrees=new Map,this.transitionMap=arguments[1],i.transitioningFrom!=null){let s=i.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=s;let l=this._getOrCreateSmartAnimatePlanTreeAt(i,s);if(l!=null){let c=(e=this.transitionMap.get(s))==null?void 0:e.progress,d=(r=this.transitionMap.get(s))==null?void 0:r.change.transitionParameters;if(d!=null&&c!=null){this._activeCursor=new Qi(l,i,c,d.easingFunction,a);return}}}if(i.animationFrom&&this._ongoingObjectAnimation!=null){if(this._ongoingObjectAnimation.change.objectAnimationTargetNode(i.scene())!=i)throw new Error("Ongoing object animation target node does not match node with animatingFrom set");let s=i.id();this._activeTransitionKey=s;let l=this._getOrCreateObjectAnimationPlanTree(i,s);if(l!=null){let c=()=>this._objectAnimationProgressTracker.progress(),d=this._ongoingObjectAnimation.change.transitionParameters;this._activeCursor=new Qi(l,i,c,d.easingFunction,a);return}}this._sceneCursor=new Kt(i,a),this._activeCursor=this._sceneCursor}else if(arguments.length==1){let i=arguments[0];this._sceneCursor=(n=i._sceneCursor)==null?void 0:n.clone(),this._planTrees=i._planTrees,i._activeCursor==i._sceneCursor?this._activeCursor=this._sceneCursor:this._activeCursor=(o=i._activeCursor)==null?void 0:o.clone(),this._activeTransitionKey=i._activeTransitionKey,this._activeTransitionIndexInParent=i._activeTransitionIndexInParent,this.transitionMap=i.transitionMap,this._stateGroupSwapInteractionCounts=i._stateGroupSwapInteractionCounts,this._ongoingObjectAnimation=i._ongoingObjectAnimation,this._objectAnimationProgressTracker=i._objectAnimationProgressTracker}}clone(){return new t(this)}isBrushInstanceType(e){return this._activeCursor.isBrushInstanceType(e)}getStrokeBrush(){return this._activeCursor.getStrokeBrush()}getStrokeBrushCursor(){return this._activeCursor.getStrokeBrushCursor()}getScatterBrushInstanceTransforms(){return this._activeCursor.getScatterBrushInstanceTransforms()}hasScatterBrushInstanceTransforms(){return this._activeCursor.hasScatterBrushInstanceTransforms()}_getOrCreateSmartAnimatePlanTreeAt(e,r){var o;let n=(o=this.transitionMap.get(r))==null?void 0:o.change.transitionParameters;if(n!=null&&(n.transitionType=="SMART_ANIMATE"||zn.supportsSmartAnimate(n.transitionType)&&n.transitionShouldSmartAnimate)){if(!this._planTrees.has(r)){let i=ai.getMagicMovePlanForStateSwapTransition(e.transitioningFrom.exitingTransitionRoot,e);this._planTrees.set(r,i)}return this._planTrees.get(r)??null}return null}_getOrCreateObjectAnimationPlanTree(e,r){if(this._planTrees.has(r))return this._planTrees.get(r)??null;if(!e.animatingFrom)throw new Error("Expected target node to have an animatingFrom node");let n=ai.getMagicMovePlanForStateSwapTransition(e.animatingFrom,e);return this._planTrees.set(r,n),n}moveToChildAt(e){var r,n;if(this._activeTransitionKey==null&&this._sceneCursor!=null){let o=this._sceneCursor.node.childAt2(e,!0);if(o.transitioningFrom!=null){this._activeTransitionIndexInParent=e;let i=o.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=i;let a=this._getOrCreateSmartAnimatePlanTreeAt(o,i);if(a!=null){let s=(r=this.transitionMap.get(i))==null?void 0:r.progress,l=(n=this.transitionMap.get(i))==null?void 0:n.change.transitionParameters;if(s!=null&&l!=null){this._sceneCursor.moveToChildAt(e),this._activeCursor=new Qi(a,o,s,l.easingFunction,this.overlayRenderData());return}}}else if(o.animatingFrom!=null&&this._ongoingObjectAnimation!=null){let i=o.id();this._activeTransitionKey=i,this._activeTransitionIndexInParent=e;let a=this._getOrCreateObjectAnimationPlanTree(o,this._activeTransitionKey);if(a!=null){let s=this._ongoingObjectAnimation.change.transitionParameters,l=()=>{let c=this._objectAnimationProgressTracker.progress();return s.easingFunction?s.easingFunction.get(c):c};this._sceneCursor.moveToChildAt(e),this._activeCursor=new Qi(a,o,l,s.easingFunction,this.overlayRenderData());return}}}this._activeCursor.moveToChildAt(e)}moveToParent(){var r;this._activeCursor.isRoot()?((r=this._sceneCursor)==null||r.moveToParent(),this._activeCursor=this._sceneCursor,this._activeTransitionIndexInParent=-1,this._activeTransitionKey=null):(this._activeCursor==this._sceneCursor&&(this._activeTransitionKey=null),this._activeCursor.moveToParent())}isRoot(){return this._activeCursor.isRoot()?this._sceneCursor==null||this._sceneCursor==this._activeCursor:!1}indexInParent(){return!this.isRoot()&&this._activeCursor.isRoot()?this._activeTransitionIndexInParent:this._activeCursor.indexInParent()}renderableContentType(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?yr.RenderableContentType.CUSTOM_RENDER_TREE:this._activeCursor.renderableContentType()}isFrameLike(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?!1:this._activeCursor.isFrameLike()}isTopLevel(){return this._activeTransitionKey!=null||this._sceneCursor==null?!1:this._sceneCursor.node.isTopLevel()}paintsDebugString(){var e;return`PlaybackCursor ${(e=this._sceneCursor)==null?void 0:e.node.paintsDebugString()}`}willChange(){return this._activeCursor.willChange()}shouldOptimizeShadowForAnimation(e){return this._activeCursor.shouldOptimizeShadowForAnimation(e)}customRenderTree(e){var h,A;if(this._sceneCursor!=this._activeCursor||this._sceneCursor.node.transitioningFrom==null||this._activeTransitionKey==null)return this._activeCursor.customRenderTree(e);let r=(h=this.transitionMap.get(this._activeTransitionKey))==null?void 0:h.progress,n=(A=this.transitionMap.get(this._activeTransitionKey))==null?void 0:A.change;if(r==null||n==null)return this._activeCursor.customRenderTree(e);let o=n.transitionParameters,i=Vr.get(o==null?void 0:o.transitionType);n.direction==1&&(i=i.reversed());let a=this._sceneCursor.node,s=a.transitioningFrom.exitingTransitionRoot,l=m=>g=>gt.forTranslation(gt.forOpacity(g,St.forAnimateableOpacity(a.id()),()=>m.interpolateOpacity(r())),St.forAnimateableTranslation(a.id()),()=>u.multiply(m.interpolateTranslation(r()))),c=Re.generateRenderTree(new Xl(a,this.overlayRenderData(),l(i.enteringFrameTransition())),e),d=Re.generateRenderTree(new Xl(s,this.overlayRenderData(),l(i.exitingFrameTransition()),a,s),e),u=a.size().max(s.size()),p=null;c!=null&&(p=c),p!=null?(p=gt.forOpacity(p,St.forAnimateableOpacity(a.id()),()=>i.enteringFrameTransition().interpolateOpacity(r())),p=gt.forTranslation(p,St.forAnimateableTranslation(a.id()),()=>u.multiply(i.enteringFrameTransition().interpolateTranslation(r())))):p=new Ue([]);let _=null;if(d!=null&&(_=d),_!=null?(_=gt.forOpacity(_,St.forAnimateableOpacity(s.id()),()=>i.exitingFrameTransition().interpolateOpacity(r())),_=gt.forTranslation(_,St.forAnimateableTranslation(s.id()),()=>u.multiply(i.exitingFrameTransition().interpolateTranslation(r())))):_=new Ue([]),i!=null&&i.isDissolve()){let m=St.forAnimateableDissolve(a.id());return new Nn(_,p,m,r)}else return i!=null&&i.drawsEnteringFrameOnTopOfExitingFrame()?Ue.wrap([_,p]):Ue.wrap([p,_])}name(){return this._activeCursor.name()}scene(){return this._activeCursor.scene()}parent(){if(this.isRoot())return null;let e=this.clone();return e.moveToParent(),e}blendMode(){return this._activeCursor.blendMode()}opacity(){return this._activeCursor.opacity()}visible(){return this._activeCursor.visible()}isVisibleMask(){return this._activeCursor.isVisibleMask()}maskType(){return this._activeCursor.maskType()}isSpreadEligibleNode(){return this._activeCursor.isSpreadEligibleNode()}type(){return this._activeCursor.type()}childCount(){return this._activeCursor.childCount()}absoluteTransform(){return this._activeCursor.absoluteTransform()}relativeTransform(){return this._activeCursor.relativeTransform()}maxTransformScale(){return this._activeCursor.maxTransformScale()}clipsChildren(){return this._activeCursor.clipsChildren()}stopsMaskPropagation(){return this._activeCursor.stopsMaskPropagation()}arcData(){return this._activeCursor.arcData()}isRoundedRect(){return this._activeCursor.isRoundedRect()}roundedRectInfo(){return this._activeCursor.roundedRectInfo()}codeSnapshot(){return this._activeCursor.codeSnapshot()}fillGeometry(){return this._activeCursor.fillGeometry()}strokeGeometry(){return this._activeCursor.strokeGeometry()}fillGeometryForSpread(e,r,n){return this._activeCursor.fillGeometryForSpread(e,r,n)}strokeGeometryForSpread(e,r,n,o){return this._activeCursor.strokeGeometryForSpread(e,r,n,o)}size(){return this._activeCursor.size()}strokeAlign(){return this._activeCursor.strokeAlign()}strokeWeight(){return this._activeCursor.strokeWeight()}hasDefaultStrokeParameters(){return this._activeCursor.hasDefaultStrokeParameters()}strokeJoin(){return this._activeCursor.strokeJoin()}setStrokeJoin(e){this._activeCursor.setStrokeJoin(e)}strokeMiterLimit(){return this._activeCursor.strokeMiterLimit()}setStrokeMiterLimit(e){this._activeCursor.setStrokeMiterLimit(e)}uniqueIdentifier(){return this._activeCursor.uniqueIdentifier()}isInsideOutlineMask(){return this._activeCursor.isInsideOutlineMask()}textData(){return this._activeCursor.textData()}derivedTextData(){return this._activeCursor.derivedTextData()}textGeometry(){return this._activeCursor.textGeometry()}getCachedRenderTree(){return this._activeCursor.getCachedRenderTree()}_shouldPreemptivelyMarkAsVolatile(){var o,i,a;if(K.shouldPreventVolatileCaching())return!1;let e=(i=(o=this._sceneCursor)==null?void 0:o.node.canvas().parent())==null?void 0:i.scene(),r=(a=this._sceneCursor)==null?void 0:a.node;if(!r||!r.isInstance())return!1;let n=r.getBackingSymbolParent();return n==null||!n.isStateGroup()?!1:this._stateGroupSwapInteractionCounts.get(n.id(),0)>0}renderTree(){if(this._sceneCursor==null){let e=new Re.GenerateArgs(Re.RenderMode.NORMAL);return Re.generateRenderTree(this.clone(),e)}else if(this._activeCursor==this._sceneCursor){let e=this._sceneCursor.node.renderTree2(this);return this._shouldPreemptivelyMarkAsVolatile()&&e!=null?gt.forStateSwap(e):e}else{if(this._activeCursor.isRoot())return this._sceneCursor.node.renderTree2(this);{let e=new Re.GenerateArgs(Re.RenderMode.NORMAL);return Re.generateRenderTree(this.clone(),e)}}}renderTreeWithoutBackgroundBlursAndGlassEffects(){return this._activeCursor.renderTreeWithoutBackgroundBlursAndGlassEffects()}renderTreeWithoutGlassEffects(){return this._activeCursor.renderTreeWithoutGlassEffects()}renderTreeWithoutEffects(){return this._activeCursor.renderTreeWithoutEffects()}renderTreeForShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowRoot2(this);{let e=new Re.GenerateArgs(Re.RenderMode.SHADOW,this.uniqueIdentifier());return Re.generateRenderTree(this.clone(),e)}}renderTreeForShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowDescendant2(this);{let e=new Re.GenerateArgs(Re.RenderMode.SHADOW);return Re.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowRoot2(this);{let e=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Re.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowDescendant2(this);{let e=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW);return Re.generateRenderTree(this.clone(),e)}}renderTreeForSlideThumbnail(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForSlideThumbnail2(this);{let e=new Re.GenerateArgs(Re.RenderMode.SLIDE_THUMBNAIL);return Re.generateRenderTree(this.clone(),e)}}isFixed(){return this._activeCursor.isFixed()}isStandardScrolling(){return this._activeCursor.isStandardScrolling()}isStickyScrolling(){return this._activeCursor.isStickyScrolling()}scrollOffset(){return this._activeCursor.scrollOffset()}scrollSpeedMultiplier(){return this._activeCursor.scrollSpeedMultiplier()}scrollDirection(){return this._activeCursor.scrollDirection()}hasOverflowingContentInScrollDirection(){return this._activeCursor.hasOverflowingContentInScrollDirection()}effects(){return this._activeCursor.effects()}transformModifiers(){return this._activeCursor.transformModifiers()}fillPaints(){return this._activeCursor.fillPaints()}textDecorationFillPaints(){return this._activeCursor.textDecorationFillPaints()}strokePaints(){return this._activeCursor.strokePaints()}fillPaintsToRender(){return this._activeCursor.fillPaintsToRender()}videoPlayback(){return this._activeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._activeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._activeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._activeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._activeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._activeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._activeCursor.overrideKey()}getSemanticNodePath(){return Nr.getSemanticNodePathHelper(this)}dependsOnBackgroundContent(){return this._activeCursor.dependsOnBackgroundContent()}overlayRenderData(){return this._activeCursor.overlayRenderData()}containsIndependentBordersStrokeMask(){return this._activeCursor.containsIndependentBordersStrokeMask()}generateStrokeAndStrokeMaskGeometries(e,r,n){return this._activeCursor.generateStrokeAndStrokeMaskGeometries(e,r,n)}canvasSpaceContentBounds(){return this._activeCursor.canvasSpaceContentBounds()}};var sf=class sf{static initialize(e){sf.safeModeOptions=e}};sf.safeModeOptions=null;var Ed=sf;var dT=class{constructor(e,r,n,o){this.key=e,this.value=r,this.prev=n,this.next=o,this.lastUsedGeneration=0}},Id=class{constructor(e,r=null){this._nodeByKey=new Map;this._size=0;this._head=null;this._tail=null;this._generation=1;this._maxElements=e,this._afterEvict=r}maximumCapacity(){return this._maxElements}atMaximumCapacity(){return this._size==this._maxElements}increaseCapacity(e){this._maxElements=this._maxElements+e}capacityUsedForGeneration(){return this.atMaximumCapacity()?this._tail.lastUsedGeneration==this._generation:!1}incrementGeneration(){this._generation=this._generation+1}keys(){return Array.from(this._nodeByKey.keys())}_in(e){return this._nodeByKey.has(e)?(this._moveElemToHead(this._nodeByKey.get(e)),!0):!1}count(){return this._size}get1(e){return this._moveElemToHead(this._nodeByKey.get(e)),this._nodeByKey.get(e).value}get(e,r){let n=Qe.StringMap_get(this._nodeByKey,e,null);return n==null?r:(this._moveElemToHead(n),n.value)}tailElement(){return this._tail.value}set(e,r){let n=Qe.StringMap_get(this._nodeByKey,e,null);if(n!=null)this._moveElemToHead(n),n.value=r;else if(n=new dT(e,r,null,null),this._addElemAsHead(n),this._nodeByKey.set(e,n),this._size=this._size+1,this._size>this._maxElements){let o=this._tail.value,i=this._tail.key;this.remove(this._tail.key)}}remove(e){let r=Qe.StringMap_get(this._nodeByKey,e,null);r!=null&&(this._nodeByKey.delete(r.key),this._removeFromList(r),this._size=this._size-1,this._afterEvict!=null&&this._afterEvict(r.key,r.value))}removeValue(e){let r=[];Qe.StringMap_each(this._nodeByKey,(n,o)=>{o.value==e&&r.push(n)}),r.forEach(n=>{this.remove(n)})}makeLeastRecent(e){let r=Qe.StringMap_get(this._nodeByKey,e,null);r!=null&&(this._removeFromList(r),this._addElemAsTail(r))}_moveElemToHead(e){this._removeFromList(e),this._addElemAsHead(e)}_removeFromList(e){let r=e.prev,n=e.next;r!=null&&(r.next=n),n!=null&&(n.prev=r),e==this._tail&&(this._tail=r),e==this._head&&(this._head=n),e.next=e.prev=null}_addElemAsHead(e){this._head==null?this._head=this._tail=e:(e.prev=null,e.next=this._head,e.next.prev=e,this._head=e),this._head.lastUsedGeneration=this._generation}_addElemAsTail(e){this._tail==null?this._tail=this._head=e:(e.next=null,e.prev=this._tail,e.prev.next=e,this._tail=e),this._tail.lastUsedGeneration=0}};var La=class{constructor(e,r,n){this.textureSize=e;this.baseTileSize=r;this.numInitialTextures=n;this._CACHED_SUPERSAMPLE_COUNT=null;this.tileAtlasTilesPerSide=this.textureSize/this.baseTileSize|0;this.numInitialTileAtlasTiles=this.numInitialTextures()*this.tileAtlasTilesPerSide*this.tileAtlasTilesPerSide}SUPERSAMPLE_COUNT(){return this._CACHED_SUPERSAMPLE_COUNT==null&&(this._CACHED_SUPERSAMPLE_COUNT=K.useSSAA()?4:2),this._CACHED_SUPERSAMPLE_COUNT}SSAA_SIZE(){return this.baseTileSize*this.SUPERSAMPLE_COUNT()}DRAW_TO_SCREEN_LARGE_TILE_SIZE(){return this.SSAA_SIZE()}};La.DEFAULT_TILE_SIZE=512;var gs=class{_createNewTexture(){let e=this._context.createTexture(Me.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP,this._config.textureSize,this._config.textureSize,br.TILE_ATLAS),r=this._context.createFramebuffer(e,null,"Tile Atlas");this._tileCacheFramebuffers.push(r)}allocateTile(){let e=`tile${this._tileIdCounter}`;this._tileIdCounter=this._tileIdCounter+1,this._tilesLRU.capacityUsedForGeneration()&&(K.shouldApplyMobileOptimizations()&&Br.getFeatureGate("viewer_atlas_cap_capacity")?console.warn("cannot allocate a new texture in the atlas to handle demand for current frame"):(this._createNewTexture(),this._tilesLRU.increaseCapacity(this._config.tileAtlasTilesPerSide*this._config.tileAtlasTilesPerSide),console.warn("allocated new texture in the atlas to handle demand for current frame")));let r=this._tilesLRU.atMaximumCapacity()?this._tilesLRU.tailElement():this._tilesLRU.count();return this._tilesLRU.set(e,r),e}maximumCapacity(){return this._tilesLRU.maximumCapacity()}prepareForNewFrame(){this._tilesLRU.incrementGeneration()}capacityUsedForCurrentFrame(){return this._tilesLRU.capacityUsedForGeneration()}totalVRAM(){let e=0;for(let r of this._tileCacheFramebuffers)e=e+hi.Texture_totalVRAM(r.colorTexture());return e}tileIsStillValid(e){return this._tilesLRU._in(e)}framebufferForTile(e){let r=this._tilesLRU.get1(e);return this._tileCacheFramebuffers[r/(this._config.tileAtlasTilesPerSide*this._config.tileAtlasTilesPerSide)|0]}devalueTile(e){this._tilesLRU.makeLeastRecent(e)}viewportForTile(e,r){let n=this._tilesLRU.get1(e),o=Ft.int_remainder(n,this._config.tileAtlasTilesPerSide),i=Ft.int_remainder(n/this._config.tileAtlasTilesPerSide|0,this._config.tileAtlasTilesPerSide),a=this._config.baseTileSize;r.setTo1(o*a,i*a,a,a)}tileSize(){return this._config.baseTileSize}textureSize(){return this._config.textureSize}drawToScreenLargeTileSize(){return this._config.DRAW_TO_SCREEN_LARGE_TILE_SIZE()}clearCache(){let r=this._tileCacheFramebuffers.length*this._config.tileAtlasTilesPerSide*this._config.tileAtlasTilesPerSide;this._tilesLRU=new Id(r,this._afterEvictOrNull)}constructor(e,r,n){this._config=n,this._tileIdCounter=0,this._tileCacheFramebuffers=[],this._afterEvictOrNull=r,this._tilesLRU=new Id(this._config.numInitialTileAtlasTiles,this._afterEvictOrNull),e.addContextResetHandler(()=>{this.clearCache()}),this._context=e;for(let o=0,i=this._config.numInitialTextures();o<i;o=o+1)this._createNewTexture()}};gs.PRE_RENDERING_MULIPLIER=K.shouldApplyMobileOptimizations()?16:64;var wn=class t{willStartTransitionWithDuration(e){this._durationSeconds=e,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=Xe.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0,this._progressAtStart=0,this._lastProgress=0}transitionEnded(){this._lastProgress=-1,this._progressType=t.ProgressType.FORWARD,this._externalOnTickProgress=null;let e=this._externalOnTransitionEnded;return this._externalOnTransitionEnded=null,e!=null?e():t.TransitionEndedAction.COMMIT}isTransitionInProgress(){return this.isProgressControlledExternally()?!0:this._progressType==t.ProgressType.REVERSE?0<this._lastProgress&&this._lastProgress<=1:0<=this._lastProgress&&this._lastProgress<1}duration(){return this._durationSeconds}progress(){return this._lastProgress}isProgressControlledExternally(){return this._progressType==t.ProgressType.EXTERNAL}pinProgressToRealTimeWithDuration(e,r,n){this._progressAtStart=e,this._durationSeconds=r,this._progressType=n?t.ProgressType.REVERSE:t.ProgressType.FORWARD,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=Xe.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0}pinProgressToExternalControl(e,r){this._externalOnTickProgress=e,this._externalOnTransitionEnded=r,this._progressType=t.ProgressType.EXTERNAL,this._timeOfTransitionStart=Xe.seconds(),this.frameTimesMs.length=0}advanceToNextFrame(){if(this.isProgressControlledExternally())this._lastProgress=this._externalOnTickProgress();else if(this._durationSeconds>0){let e=Xe.seconds(),r=e-this._timeOfLastTransitionFrame;this.frameTimesMs.push(1e3*r),r=Math.min(r,1/30),this._elapsedSeconds+=r,this._timeOfLastTransitionFrame=e;let n=this._progressType==t.ProgressType.REVERSE?-1:1;this._lastProgress=Ir.Math_clamp(n*this._elapsedSeconds/this._durationSeconds+this._progressAtStart,0,1)}else this._lastProgress=this._progressType==t.ProgressType.REVERSE?0:1}constructor(){this._lastProgress=-1,this._durationSeconds=-1,this._elapsedSeconds=-1,this._timeOfLastTransitionFrame=-1,this._progressAtStart=0,this._timeOfTransitionStart=-1,this.frameTimesMs=[],this._progressType=t.ProgressType.FORWARD,this._externalOnTickProgress=null,this._externalOnTransitionEnded=null}};(r=>{let t;(a=>(a[a.FORWARD=0]="FORWARD",a[a.REVERSE=1]="REVERSE",a[a.EXTERNAL=2]="EXTERNAL"))(t=r.ProgressType||(r.ProgressType={}));let e;(i=>(i[i.ABORT=0]="ABORT",i[i.COMMIT=1]="COMMIT"))(e=r.TransitionEndedAction||(r.TransitionEndedAction={}))})(wn||(wn={}));var nc;(r=>{function t(n,o){n(o)}r.applyTo=t;function e(n){return n}r._new=e})(nc||(nc={}));var lf=class{constructor(e){this._dragToAnimateBehavior=null,this._canvasView=null,this._canvasView=e}clearDrag(e){this._dragToAnimateBehavior==e&&(this._canvasView.removeInteractionObserver(this._dragToAnimateBehavior),this._dragToAnimateBehavior=null)}removeFrom(e){this.clearDrag(this._dragToAnimateBehavior)}getTransitionMixin(e,r,n){let o=r.interactionAddress.hotspotStablePath!=null?e.findNodeByStablePath(r.interactionAddress.hotspotStablePath):null;if(o==null)return null;switch(r.cause){case 5:{if(!n&&rt.getControlSource(r.cause)!=0){let i=Cr.computeDragVector2(r,o,e);if(i!=null&&i.length()>0)return nc._new(a=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new Cr(this,i,a,r.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}getTransitionMixinForStateSwap(e,r,n){switch(r.cause){case 5:{if(!n&&rt.getControlSource(r.cause)!=0){let o=Cr.computeDragVectorForStateSwap(r,e);if(o!=null&&o.length()>0)return nc._new(i=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new Cr(this,o,i,r.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}},Ma=class Ma{static computeOverlaySwipeDragVector(e,r,n){let o=n.size(),i=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return o.multiply(i.to().translation1().subtract(i.from().translation1()))}static computeScreenSwipeDragVector(e,r,n){let o=r.size().max(n.size()),i=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return o.multiply(i.to().translation1().subtract(i.from().translation1()))}static computeSmartAnimateDragVector(e,r,n){if(r!=null&&n!=null&&e!=null){let o=ai.getNodeMatches(r,n),i=Qe.StringMap_get(o,e.id(),null);if(i!=null){let a=r.absoluteTransform().inverse().multipliedBy1(e.absoluteTransform()).transformPoint(e.size().divideScalar(2));return n.absoluteTransform().inverse().multipliedBy1(i.absoluteTransform()).transformPoint(i.size().divideScalar(2)).subtract(a)}}return null}static computeDragVectorImpl(e,r,n,o,i,a,s){if(e==null)return null;if(r!=null&&n!=null){if(i=="SMART_ANIMATE"||zn.supportsSmartAnimate(i)&&s){let d=Ma.computeSmartAnimateDragVector(e,r,n);if(d!=null&&d.length()>0)return d}if(["DISSOLVE","INSTANT_TRANSITION","SMART_ANIMATE"].indexOf(i)==-1){let d=Vr.get(i);o==1&&(d=d.reversed());let u=null;if(["OVERLAY","SWAP"].indexOf(a)!=-1?u=Ma.computeOverlaySwipeDragVector(d,r,n):u=Ma.computeScreenSwipeDragVector(d,r,n),u.length()>0)return u}}return null}static computeDragVector1(e,r,n,o,i){if(e==null||r==null)return null;let a=null;for(let h of r.allActions())if(["INTERNAL_NODE","BACK","CLOSE"].indexOf(h.connectionType())!=-1){a=h;break}if(a==null)return null;let s=a.connectionType(),l=null,c=null,d=a.transitionShouldSmartAnimate(),u=0,p=n,_=null;if(s=="INTERNAL_NODE")if(c=a.navigationType(),l=a.transitionType(),c=="SWAP_STATE"){let h=$t.whichInstanceToSwap(e,a.transitionNodeID());h!=null&&(p=h,_=e.scene().findNode(a.transitionNodeID()))}else c=="SWAP"&&(p=e.topLevelAncestor()),_=o.getDestinationFrame(a.transitionNodeID());else if(s=="BACK"){let h=i.getPreviousNonTransientChange();if(h==null)return null;_=o.getDestinationFrame(h.oldStateId()),l=h.transitionParameters.transitionType,c="NAVIGATE",u=1}else if(s=="CLOSE"){_=e.topLevelAncestor();let h=i.getOpenOverlayData(_.id());if(h==null)return null;l=h.openingTransitionType(),c="OVERLAY",u=1}return Ma.computeDragVectorImpl(e,p,_,u,l,c,d)}static computeDragVector2(e,r,n){let o=null,i=null;if(e.oldStateId()==e.newStateId()&&e.oldOverlayData().length>0&&e.oldOverlayData().length==e.newOverlayData().length){let s=e.oldOverlayData()[e.oldOverlayData().length-1],l=e.newOverlayData()[e.newOverlayData().length-1];o=n.findNode(s.id),i=n.findNode(l.id)}else if(o=n.findNode(e.oldStateId()),e.transitionParameters.navigationType=="OVERLAY"){let s=e.direction==1?e.getRemovedFrameIds():e.getInsertedFrameIds();i=n.findNode(s[0])}else i=n.findNode(e.newStateId());return Ma.computeDragVectorImpl(r,o,i,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}static computeDragVectorForStateSwap(e,r){var a,s;let n=r.findNodeByStablePath(e.stablePath),o=(a=n==null?void 0:n.transitioningFrom)==null?void 0:a.exitingTransitionRoot,i=(s=n==null?void 0:n.transitioningFrom)==null?void 0:s.hotspotInExitingTree;return Ma.computeDragVectorImpl(i,o,n,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}constructor(e,r,n,o){var i;this._dragStartPosition=null,this._currPointerPosition=null,this._lastPointerPosition=null,this._currPointerTime=-1,this._lastPointerTime=-1,this._didRecordPointerPosition=!1,this._pointerVelocity=null,this._shouldRevertTransition=!1,this._behaviorManager=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._lastPointerTime=Xe.seconds(),this._behaviorManager=e,this._dragVector=r,this._easingFunction=o,this._transitionProgress=n,(i=this._transitionProgress)==null||i.pinProgressToExternalControl(()=>this.onTickProgress(),()=>this.onTransitionEnded())}handleDrag(e){this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,this._currPointerTime=Xe.seconds(),this._currPointerPosition=e,this._didRecordPointerPosition=!0}handleDragStart(e){this._dragStartPosition=e}handleRelease(e){if(this._transitionProgress!=null&&this._transitionProgress.isProgressControlledExternally()){let r=this._transitionProgress.progress(),n=this._easingFunction!=null?this._easingFunction.invert(r):r,o=this.signedDragSpeed(),i=this._transitionProgress.duration(),a=i>0?Ma.DRAG_SPEED_THRESHOLD_MULTIPLE/i:0,s=o>=a,l=o<=-a;this._shouldRevertTransition=!1,r>=.5?this._shouldRevertTransition=l:this._shouldRevertTransition=!s;let c=1;if(this._shouldRevertTransition&&(c=Ir.Math_clamp(Math.log(n+.5)/Math.log(2)+1,.02,1)),Math.abs(o)>=1/i){let d=this._easingFunction!=null?this._easingFunction.getDerivative(n,o):1;c=Math.abs(o/d)}this._transitionProgress.pinProgressToRealTimeWithDuration(n,i/c,this._shouldRevertTransition)}}onTickProgress(){if(this._dragVector!=null){if(this._currPointerPosition!=null&&this._dragStartPosition!=null){if(this._lastPointerPosition!=null&&this._lastPointerTime!=-1){let n=this._currPointerTime;this._didRecordPointerPosition||(this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,n=Xe.seconds(),this._currPointerTime=n),this._pointerVelocity=this._currPointerPosition.subtract(this._lastPointerPosition).divideScalar(n-this._lastPointerTime)}let e=this._currPointerPosition.subtract(this._dragStartPosition),r=Ir.Math_clamp(e.dot(this._dragVector)/Math.pow(this._dragVector.length(),2),0,1);return this._didRecordPointerPosition=!1,r}return this._didRecordPointerPosition=!1,0}return this._didRecordPointerPosition=!1,1}onTransitionEnded(){return this._dragStartPosition=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._behaviorManager!=null&&this._behaviorManager.clearDrag(this),this._shouldRevertTransition?wn.TransitionEndedAction.ABORT:wn.TransitionEndedAction.COMMIT}signedDragSpeed(){return this._pointerVelocity==null||this._dragVector==null?0:this._dragVector.length()>0?this._pointerVelocity.dot(this._dragVector)/Math.pow(this._dragVector.length(),2):0}};Ma.DRAG_SPEED_THRESHOLD_MULTIPLE=.15;var Cr=Ma;var Rd=hc(Hd());var bp=class{constructor(){if(arguments[0]==0){let[,e]=arguments;this.ws=null,this.ws=e}else if(arguments[0]==1){let[,e]=arguments;this.ws=null,this.ws=new WebSocket(e)}}url(){return this.ws.url}readyState(){return this.ws.readyState}setBinaryType(e){this.ws.binaryType=e}binaryType(){return this.ws.binaryType}setOnclose(e){this.ws.onclose=r=>{e(r)}}setOnerror(e){this.ws.onerror=r=>{e(r)}}setOnmessage(e){this.ws.onmessage=r=>{e(new pT(r))}}setOnopen(e){this.ws.onopen=r=>{e(r)}}close(){this.ws.close()}send1(e){this.ws.send(e)}send2(e){this.ws.send(e)}equals(e){var r;return this.ws==((r=e==null?void 0:e.asHTMLSocket())==null?void 0:r.ws)}asHTMLSocket(){return this}asMockSocket(){return null}},cf=class cf{simulateDidOpen(){if(this._readyState=si.Socket_OPEN,this._onopen!=null){let e={meta:"Fake open event for testing"};this._onopen(e)}}simulateDidClose(){if(this._readyState=si.Socket_CLOSED,this._onclose!=null){let e={meta:"Fake close event for testing"};this._onclose(e)}}simulateMessage(e){this._onmessage!=null&&this._onmessage(e)}url(){return cf.FAKE_URL}readyState(){return this._readyState}setBinaryType(e){this._binaryType=e}binaryType(){return this._binaryType}setOnclose(e){this._onclose=e}setOnerror(e){this._onerror=e}setOnmessage(e){this._onmessage=e}setOnopen(e){this._onopen=e}close(){this._readyState=si.Socket_CLOSING}send1(e){if(this._readyState!=si.Socket_OPEN)throw new Error("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.");this.sent.push(new Uint8Array(e))}send2(e){if(this._readyState!=si.Socket_OPEN)throw new Error("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.");this.sent.push(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}equals(e){return(e==null?void 0:e.asMockSocket())==this}asHTMLSocket(){return null}asMockSocket(){return this}constructor(){this._readyState=si.Socket_CONNECTING,this._binaryType="blob",this._onclose=null,this._onerror=null,this._onmessage=null,this._onopen=null,this.sent=[]}};cf.FAKE_URL="ws://fake_url_for_tests_value_does_not_matter.com";var uT=cf;var pT=class{isArrayBuffer(){return this.messageEvent.data[Symbol.toStringTag]==="ArrayBuffer"}isBlob(){return this.messageEvent.data instanceof Blob}isString(){return typeof this.messageEvent.data=="string"}dataAsArrayBuffer(){return this.messageEvent.data}dataAsBlob(){return this.messageEvent.data}dataAsString(){return this.messageEvent.data}constructor(e){this.messageEvent=e}},si;(o=>(o.Socket_CONNECTING=0,o.Socket_OPEN=1,o.Socket_CLOSING=2,o.Socket_CLOSED=3))(si||(si={}));var kr;(n=>{function t(o,i){let a={};return a.startingNode=Q.toFigGUID(o),a.depth=i,a}n.create=t;function e(o){if(o==null)return"";let i="";for(let a of o)i+=gn.serializeForMultiplayerURL(a),i+=",";return i.slice(0,i.length-1)}n.serializeListForMultiplayerURL=e;function r(o){return o.startingNode.localID==0&&o.startingNode.sessionID==0&&o.depth==0}n.isUnlimitedRootQuery=r})(kr||(kr={}));var Pr=class Pr{static logVerbose(e){Pr.VERBOSE_LOGS&&console.log("[IncrementalFrameLoader]",e())}static MAX_SLIDESHOW_PRELOAD_DISTANCE(){return 2}constructor(e,r){this._multiplayer=null,this._appState=null,this._emitter=null,this._canvas=null,this._currentQueries=new Ss,this._previousSceneGraphReply=new Ss,this._rootLevelSceneGraphQuery=kr.create(Q._new(0,0),1),this._requestedTlfIds=new no,this._currentTlfIds=[],this._requestedSectionsQueue=[],this._bfsOrderWorkingSet=[],this._pendingNodeToRequest=null,this._multiplayer=r,this._multiplayer.addObserver(this),this._appState=e,e.addAppObserver(this),e.prototypeState().addObserver(this),this._emitter=Ht.getEventEmitter(),this._emitter.on("slowIncrementalLoad",n=>{be.trackEvent("Slow incremental load",n)})}dangerouslySetLoadFullDocument(e){this._setLoadFullDocument(e)}setLoadFullDocumentForTests(e){this._setLoadFullDocument(e)}_setLoadFullDocument(e){e?this._rootLevelSceneGraphQuery=kr.create(Q._new(0,0),0):this._rootLevelSceneGraphQuery=kr.create(Q._new(0,0),1)}simulateRepliedQueriesForTests(e){this._currentQueries=Ss.fromList(e),this.handleSceneGraphReply(0,e)}requestTlf(e){return this._setCurrentTlfIds([e]),this._isFullyLoaded(e)?!0:(this._requestedTlfIds.add(e),this._redeferUpdate(0),!1)}_setCurrentTlfIds(e){this._currentTlfIds=e}_requestTlfs(e){this._setCurrentTlfIds(e);for(let r of e){if(this._isFullyLoaded(r)){this._appState.requestedFrameMetricsTracker().track(r,{wasAlreadyLoaded:!0,wasAlreadyInWorkingSet:!0});continue}else{let n={wasAlreadyLoaded:!1,wasAlreadyInWorkingSet:!1};for(let o of this._bfsOrderWorkingSet)if(o.nodeId==r){n.wasAlreadyInWorkingSet=!0;break}this._appState.requestedFrameMetricsTracker().track(r,n)}this._requestedTlfIds.add(r),this._redeferUpdate(0)}}_isFullyLoaded(e){var o;let r=(o=this._multiplayer.scene())==null?void 0:o.findNode(e);if(r==null)return!1;let n=r;for(;n!=null;){if(this._previousSceneGraphReply.containsExactQuery(kr.create(n.id(),0)))return!0;n=n.parent()}return!1}_isQueryPresent(e,r){for(let n of r)if(gn.equals(n,e))return!0;return!1}_getQueriesToLoad(){let e=new Ss;return this._addRequestedTlfs(e),this._appState.scene()!=null&&this._addScreenAdjacencies(e),e}_addRequestedTlfs(e){var r;Pr.logVerbose(()=>"Visiting requestedTlfs for next queries:"+this._requestedTlfIds.asList().join(","));for(let n of this._requestedTlfIds.asList()){let o=Q.fromString(n);if(o==null)continue;if(!this._previousSceneGraphReply.containsNodeById(o)){e.add(kr.create(o,1));continue}let a=(r=this._multiplayer.scene())==null?void 0:r.findNode(o);if(this._requestedTlfIds.remove(o),a==null){let s=Q._new(0,0);e.add(kr.create(s,1)),this._requestedTlfIds.add(s);let l=this._multiplayer.scene().firstUserCanvasOrNull();if(l==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(l.id()),e.add(kr.create(l.id(),1))}else if(a.type()=="DOCUMENT"){this._emitter.trigger("redirectingToFirstPageDueToInvalidStartNode");let s=this._multiplayer.scene().firstUserCanvasOrNull();if(s==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(s.id()),e.add(kr.create(s.id(),1))}else if(a.type()=="CANVAS"){let s=this._appState.prototypeStructure().nodeToRestartPrototypeOn(a);if(s==null)continue;this._requestedTlfIds.add(s.id()),e.add(kr.create(s.id(),0)),this._setCurrentTlfIds([s.id()])}else{for(;a!=null&&!a.isTopLevel();)a=a.parent();a!=null&&(e.add(kr.create(a.id(),0)),this._canvas=a.findContainingCanvasOrParent(),e.add(kr.create(this._canvas.id(),1)))}}}_addScreenAdjacencies(e){K.getViewerMode()==K.ViewerMode.PROTOTYPE&&this._appState.prototypeStructure().isLinear()&&this._addScreenAdjacenciesForLinearPrototype(e),this._addScreenAdjacenciesForPrototype(e)}_getMaxBFSDistance(){return Wt.isCurrentOSMobileOrIPad()?Pr.MOBILE_MAX_PROTOTYPE_BFS_DEPTH:Pr.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH}_getMaxBFSCount(){return Wt.isCurrentOSMobileOrIPad()?Pr.MOBILE_MAX_PROTOTYPE_BFS_COUNT:Pr.DEFAULT_MAX_PROTOTYPE_BFS_COUNT}_addScreenAdjacenciesForLinearPrototype(e){let r=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();if(!this._currentTlfIds.length||!Q.isValid(this._currentTlfIds[0]))return;let n=r.indexOf(this._currentTlfIds[0]);if(!(n<0)){for(let o=n-Pr.MAX_SLIDESHOW_PRELOAD_DISTANCE(),i=n+Pr.MAX_SLIDESHOW_PRELOAD_DISTANCE()+1;o<i;o=o+1)o>=0&&o<r.length&&e.add(kr.create(r[o],0));if(this._currentTlfIds.length>1)for(let o=1,i=this._currentTlfIds.length;o<i;o=o+1)Q.isValid(this._currentTlfIds[o])&&e.add(kr.create(this._currentTlfIds[o],0))}}_addScreenAdjacenciesForPrototype(e){if(this._currentTlfIds.length==0||!Q.isValid(this._currentTlfIds[0]))return;let r=new Pr.Queue;for(let l=this._currentTlfIds.length-1;l>=0;l=l-1)r.pushBackIfUnseen(this._currentTlfIds[l],0);let n=0;this._bfsOrderWorkingSet=[];let o=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF();for(;r.nonempty()&&(r.front().depth<=1||n<this._getMaxBFSCount());){let l=r.popFront(),c=l.guid,d=this._previousSceneGraphReply.containsExactQuery(kr.create(c,0));this._bfsOrderWorkingSet.push(new Pr.WorkingSetItem(c,d));let u=this._appState.scene().findNode(c);if(u==null||(l.depth>0&&(n=n+1),l.depth>=this._getMaxBFSDistance()))continue;let p=sn.adjacentBaseScreens(o,u);kn(u,_=>{var h;if(_.isInstance()&&!_.isPrimaryInstance()&&_.getBoundVariables().componentProperties){let A=this._appState.scene().findNode(_.symbolID());if(A!=null){let m=A.parent();m.isStateGroup()&&(p.add(m.id()),_.invalidateRenderTreeForSelfAndParents(),_.invalidateRenderTreeForChildren())}}(h=_.prototypeInteractions())==null||h.forEach(A=>{for(let m of A.allActions())if(Q.isValid(m.transitionNodeID())&&p.add(m.transitionNodeID()),m.connectionType()=="BACK"){let g=this._appState.prototypeState().getLastChangeInHistory();g!=null&&g.getRemovedFrameIds().forEach(S=>{S!=null&&p.add(S)})}}),K.getFeatureFlags().viewer_ifl_enhancements&&Fn.isNodeInteractableBecauseOfHyperlinks(_)&&_.textHyperlinkBoxes().forEach(A=>{A.guid&&p.add(Q.fromFigGUID(A.guid))})});for(let _ of p.asList())r.pushBackIfUnseen(_,l.depth+1)}be.trackDefinedEvent("prototype.ifl_nodes_loaded_count",{nodesLoadedCount:n,enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced});let i=this._appState.prototypeState().getInitiatedChange();if(i!=null)for(let l of i.oldStateAndOverlays.statesAndOverlaysIncluded()){let c=Q.fromString(l);this._bfsOrderWorkingSet.unshift(new Pr.WorkingSetItem(c,this._previousSceneGraphReply.containsExactQuery(kr.create(c,0))))}Kr.trackNumber("[IFL] Working set size",this._bfsOrderWorkingSet.length);let a=0,s=0;for(let l of this._bfsOrderWorkingSet)if(e.add(kr.create(l.nodeId,0)),l.isAlreadySubscribed?s=s+1:a=a+1,a>=Pr.MAX_PROTOTYPE_TLF_BATCH_SIZE)break;Kr.trackNumber("[IFL] Working set frames loaded",s)}getMetricsForNode(e){return this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.id())}_requestNextQueriesToLoad(e){var n;if(e.add(this._rootLevelSceneGraphQuery),e.equals(this._currentQueries))return;K.protoUseFrameEviction()?(this._multiplayer.scene()!=null&&(this._currentQueries.each(i=>{let a=this._multiplayer.scene().findNode(xs.toString(i.startingNode));a!=null&&(a.type()=="DOCUMENT"||a.type()=="CANVAS")&&e.add(i)}),((n=F())==null?void 0:n.getChangedVariables()).forEach(i=>{e.add(kr.create(i,0))})),this._currentQueries=e):e.each(o=>{this._currentQueries.add(o)});let r=[];for(let o of this._currentQueries.asList())r.push(o);Pr.logVerbose(()=>"setting scene graph queries:"+r.map(o=>gn.toString(o)).join(",")),this._multiplayer.setSceneGraphQueries(r)}_redeferUpdate(e){this._deferredUpdate!==void 0?this._deferredUpdate.redefer(e):this._deferredUpdate=new Np(()=>{Pr.logVerbose(()=>`update............
`+(Pr.VERBOSE_LOGS_SHOW_SCENEGRAPH?this._multiplayer.scene().root().hierarchyString():"")),this._requestNextQueriesToLoad(this._getQueriesToLoad()),this._deferredUpdate=void 0},e)}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._redeferUpdate(0)}handleActiveCanvasChange(e,r){this._redeferUpdate(0)}handleActivePrototypeStartingPointChange(e,r){}handleStateChangeAborted(e){}handleStateChangeCommitted(e,r){}handleStateChangeInitiated(e){this._redeferUpdate(0)}handleStateChangeRequested(e){let r=e.newStateAndOverlays.statesAndOverlaysIncluded(),n=[];for(let o of r)n.push(Q.fromString(o));this._requestTlfs(n)}handleFitModeChange(e,r){}handleRestartPrototype(){}handleConnect(e,r){e==0&&(this._previousSceneGraphReply=new Ss,this._currentQueries=new Ss,this._redeferUpdate(0),K.getViewerMode()==K.ViewerMode.PROTOTYPE&&r==null&&(r=Q._new(0,0)),r!=null&&(this._pendingNodeToRequest=r))}handleDisconnect(){}handleJoinStart(e,r,n){this._pendingNodeToRequest!=null&&this.requestTlf(this._pendingNodeToRequest),this._pendingNodeToRequest=null}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){}handleSceneChangedLoadingPhase(e,r){}handleSceneGraphReply(e,r){be.handleMultiplayerFirstResponse(),Pr.logVerbose(()=>{let a="";return a+=`
-----handleSceneGraphReply-----
`,a+="sceneGraphQueries:"+r.map(s=>gn.toString(s)).join(",")+`
`,Pr.VERBOSE_LOGS_SHOW_SCENEGRAPH&&(a+=this._multiplayer.scene().root().hierarchyString()+`
`),a+="-----------------------------------",a}),this._previousSceneGraphReply=Ss.fromList(r);let n=this._getQueriesToLoad(),o=r.some(a=>kr.isUnlimitedRootQuery(a));n.isSubsetOf(this._previousSceneGraphReply)||o?(be.handleMultiplayerIFLSatisfied(),Pr.logVerbose(()=>"All queries satisfied! Calling finishIncrementalLoading..."),this._multiplayer.finishIncrementalLoading(),be.handleIFLCompleted()):this._requestNextQueriesToLoad(n)}handleSceneGraphEvent(e){if(mo.isPrototypeStructuralChange(e.property)){if(this._deferredUpdate!=null&&this._deferredUpdate.delayMs==0)return;this._redeferUpdate(_n||yo?0:250)}}};Pr.VERBOSE_LOGS=!1,Pr.VERBOSE_LOGS_SHOW_SCENEGRAPH=!1,Pr.MOBILE_MAX_PROTOTYPE_BFS_DEPTH=2,Pr.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH=8,Pr.MOBILE_MAX_PROTOTYPE_BFS_COUNT=4,Pr.DEFAULT_MAX_PROTOTYPE_BFS_COUNT=64,Pr.MAX_PROTOTYPE_TLF_BATCH_SIZE=4;var tl=Pr;(n=>{class t{constructor(i,a){this.guid=i,this.depth=a}}n.Entry=t;class e{constructor(i,a){this.nodeId=i,this.isAlreadySubscribed=a}}n.WorkingSetItem=e;class r{nonempty(){return this._queue.length>0}pushBackIfUnseen(i,a){this._seen.has(i)||(this._seen.set(i,!0),this._queue.push(new n.Entry(i,a)))}front(){return this._queue[0]}popFront(){return this._queue.shift()}constructor(){this._queue=[],this._seen=new Map}}n.Queue=r})(tl||(tl={}));var Ss=class t{add(e){let r=gn.nodeIdString(e);if(!this._hash.has(r))this._hash.set(r,e);else{let n=this._hash.get(r);if(n.depth==0)return;(e.depth==0||e.depth>n.depth)&&this._hash.set(r,e)}}containsNodeById(e){return e!=null&&this._hash.has(e)}containsExactQuery(e){return this.containsNodeById(Q.fromFigGUID(e.startingNode))?this._hash.get(gn.nodeIdString(e)).depth==e.depth:!1}remove(e){this._hash.delete(gn.hash(e))}count(){return this._hash.size}asList(){return Array.from(this._hash.values())}each(e){Array.from(this._hash.values()).forEach(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let r of Array.from(this._hash.values()))if(!e.containsExactQuery(r))return!1;return!0}isSubsetOf(e){if(e==null||this.count()>e.count())return!1;for(let r of Array.from(this._hash.values()))if(!e.containsExactQuery(r))return!1;return!0}toJSObject(){return Qe.StringMap_toJSObject(this._hash)}static fromList(e){let r=new t;for(let n of e)r.add(n);return r}constructor(){this._hash=new Map}},li=class li{constructor(e,r){this.complete=()=>{var r;let e=this._executionTime-Date.now();e<=0||!1?((r=this.callback)==null||r.call(this),this.callback=null):this._timeoutID=li._setTimeout(this.complete,e)};this.delayMs=r,this.callback=e,this._timeoutID=li._setTimeout(this.complete,r),this._executionTime=Date.now()+r}redefer(e){this._executionTime=Date.now()+e}cancel(){this.callback=null,li._clearTimeout(this._timeoutID)}static _setTimeout(e,r){if(!1){let n=(li._nextMockTimeoutID=li._nextMockTimeoutID+1)+-1;return li._mockTimeouts.set(n,e),n}else return AC()?(Promise.resolve().then(e),0):setTimeout(e,r)}static _clearTimeout(e){clearTimeout(e)}static fireAllMockedTimeouts(){let e=Array.from(li._mockTimeouts.keys());for(let r of e)li._mockTimeouts.get(r)(),li._mockTimeouts.delete(r)}};li._nextMockTimeoutID=1,li._mockTimeouts=new Map;var Np=li;var _T=class{constructor(e,r){this.nodeId=e,this.offset=r}},df=class{version(){return mpGlobal.version}sock(){return mpGlobal.sock!=null?new bp(0,mpGlobal.sock):null}setSock(e){if(e!=null){let r=e.asHTMLSocket();r==null&&console.warn("Ignoring invalid socket binding for mpGlobal"),mpGlobal.sock=r.ws}else mpGlobal.sock=null}msgs(){return mpGlobal.msgs}setMsgs(e){mpGlobal.msgs=e}perfMetrics(){return mpGlobal.perfMetrics}setPerfMetrics(e){mpGlobal.perfMetrics=e}url(e){return mpGlobal.url(e)}preconnect(e){mpGlobal.preconnect(e)}newSocket(e){return new bp(1,e)}constructor(){}},hT=class t{static attemptToParseFrom(e){try{let r=JSON.parse(e);return new t(r.url,r.type)}catch{we("Failed to parse TooManyConnectionsPayload")}return null}constructor(e,r){this.url=e,this.type=r}},mT=class{static attemptToParseFrom(e){try{let r=JSON.parse(e);return{enforcePrototypeSecurityBoundaries:r.enforcePrototypeSecurityBoundaries,docNotInitiallyDecoded:r.docNotInitiallyDecoded,incremental:r.incremental,numMultiplayerConnections:r.numMultiplayerConnections}}catch{we("Failed to parse ServerSideLoadTimeMetadata")}return null}};var Tn=class Tn{static hasPrefix(e,r){if(e.length>=r.length){for(let n=0,o=r.length;n<o;n=n+1)if(e[n]!=r.charCodeAt(n))return!1;return!0}return!1}constructor(e,r,n){this._appState=null,this._isWindowActive=null,this._emitter=null,this._mpContext=null,this._incrementalLoader=null,this._role="viewer",this._scene=null,this._userSyncing=null,this._heartbeatTimeout=0,this._consecutiveFailedConnectionAttempts=0,this._attemptsSinceLastConnectionSuccess=0,this._hasConnectedAtLeastOnce=!1,this._onlineChangeHandler=null,this._reconnectionTimeout=0,this._isConnected=!1,this._isJoined=!1,this._shouldReconnect=!0,this._socket=null,this._url=null,this._fileKey=null,this._nodeId=null,this._partialSnapshotInfo=new uf(null,null),this._reconnectKey=null,this._previousTlfID=null,this._previousCanvasSpaceMouseLocation=null,this._sessionID=0,this._observingSessionID=-1,this._presenterSessionID=null,this._sessionsNominatingCurrentUser=new Set,this._sessionNominatedByCurrentUser=null,this._cachedNextUserChange=null,this._canvasSpaceClicks=[],this._nextCanvasSpaceClickID=0,this._pendingSceneGraphQueriesOrNull=null,this._lastSceneGraphQueryTime=0,this._lastSceneGraphQueryConcurrency=0,this._lastSentSceneGraphQueriesOrNull=null,this._observers=new dn,this._messageObservers=new dn,this._sceneLoadingPhase=In.PENDING_INITIAL_LOAD,this._connectType=0,this._sessionSchema=null,this._staticFileRequest=null,this.maxScrollPositionsToStore=10,this._recentlyChangedScrollPositions=[],this._lastFlush=-1,this._appState=e,this._isWindowActive=r,this._emitter=Ht.getEventEmitter(),this._appState.addAppObserver(this),e.prototypeState().addObserver(this),e.prototypeState().addHsmObserver(this),this._wasBackgrounded=!1,this._mpContext=n,this._incrementalLoader=new tl(this._appState,this),this._flushQueueWhenAvailable=!1,this._localUserChangesHandler=null}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}addMultiplayerMessageObserver(e){this._messageObservers.add(e)}removeMultiplayerMessageObserver(e){this._messageObservers.remove(e)}addLocalUserChangesHandler(e){this._localUserChangesHandler=e}removeLocalUserChangesHandler(){this._localUserChangesHandler=null}fileKey(){return this._fileKey}observingSessionID(){return this._observingSessionID}setObservingSessionID(e){this._observingSessionID=e,this._getOrCreateNextUserChange().observing=[e]}observedUser(){return this._userSyncing!=null?Xt.IntMap_get(this._userSyncing.userBySessionID(),this._observingSessionID,null):null}isObserving(){return this.observingSessionID()!=-1}presenterSessionID(){return this._presenterSessionID}isPresenterSession(){return this._presenterSessionID&&this._presenterSessionID.value===this._sessionID}removeNominator(e){this._sessionsNominatingCurrentUser.delete(e)}sessionsNominatingCurrentUser(){return Array.from(this._sessionsNominatingCurrentUser.values())}sessionNominatedByCurrentUser(){return this._sessionNominatedByCurrentUser}setPresenterSessionID(e){this._presenterSessionID=e}scene(){return this._scene}nodeId(){return this._nodeId}incrementalLoader(){return this._incrementalLoader}socketForTesting(){var e;return(e=this._socket)==null?void 0:e.asMockSocket()}setMultiplayerUserSyncing(e){this._userSyncing=e}hasMultiplayerUserSyncing(){return this._userSyncing!=null}setScene(e){this._scene=e}isConnected(){return this._isConnected}fulfilledMultiplayerQueries(){return this._partialSnapshotInfo.fulfilledQueries}_setSceneLoadingPhase(e){let r=this._sceneLoadingPhase;switch(this._sceneLoadingPhase=e,r!=e&&this._observers.forEach(n=>{n.handleSceneChangedLoadingPhase(r,e)}),e){case In.PENDING_INITIAL_LOAD:break;case In.PENDING_LOAD_AFTER_RECONNECT:{console.log("sceneWillRebuildAfterReconnecting"),this._emitter.trigger("sceneWillRebuildAfterReconnecting");break}case In.LOADED:{r==In.PENDING_INITIAL_LOAD?this._appState.fontListPromise().then(()=>{console.debug("sceneDidCompleteInitialLoad"),this._emitter.trigger("sceneDidCompleteInitialLoad")}):r==In.PENDING_LOAD_AFTER_RECONNECT&&(console.log("sceneDidRebuildAfterReconnecting"),this._emitter.trigger("sceneDidRebuildAfterReconnecting")),this._socket!=null&&this._sendSignal("client-rendered","");break}}}setNodeLoadedStatusesAndUpdate(e){this._setCanvasLoadedStatuses(e),this._setTlfLoadedStatuses(e),this._appState.prototypeState().tryToInitiateRequestedStateChange(hs.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED),this._appState.trySettingRequestedActiveCanvas()}_setCanvasLoadedStatuses(e){this.scene().root().forEachChild(r=>{r.type()!="CANVAS"||r.isInternalOnly()||(e==null||e.some(n=>gn.fullyLoadsNode(n,r)))&&r.setHasBeenLoaded(!0)})}_setTlfLoadedStatuses(e){var o,i,a;let r=0,n=0;Tn.VERBOSE&&(console.log("-----------_setTlfLoadedStatuses-----------"),((o=this.scene())==null?void 0:o.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(r=r+1)})})),this.scene().setTlfsLoaded(s=>e==null||e.some(l=>gn.fullyLoadsNode(l,s))),Tn.VERBOSE&&(((i=this.scene())==null?void 0:i.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(n=n+1)})}),console.log(`\u{1F69A} numLoaded ${n-r} (${r} -> ${n})`),console.log("--------------------------------------------")),(a=F())==null||a.applyExistingVariableChangesToIFLLoadedNodes()}_finishLoadingIfNecessary(){this._sceneLoadingPhase!=In.LOADED&&(this._appState.setCurrentFileKey(this._fileKey),this._appState.prototypeState().mostRecentFixInvalidStateInitiator="Multiplayer._finishLoadingIfNecessary",this._appState.setScene(this._scene),this._appState.prototypeState().navigateToFrameAndCloseOverlaysOrRestart(this._nodeId,"Multiplayer._finishLoadingIfNecessary"),this._setSceneLoadingPhase(In.LOADED))}finishIncrementalLoading(){this._finishLoadingIfNecessary(),this._emitter.trigger("incrementalLoadingInfo",{type:"finishIncrementalLoading",fileKey:this._fileKey})}sessionID(){return this._sessionID}role(){return this._role}setRole(e){this._role=e}currentSceneGraphQueries(){return this._pendingSceneGraphQueriesOrNull!=null?this._pendingSceneGraphQueriesOrNull:this._lastSentSceneGraphQueriesOrNull!=null?this._lastSentSceneGraphQueriesOrNull:[]}connectTo(e,r){this._connectTo(e,0,r)}attemptReconnect(){var r;if(this._scene==null||this._sceneLoadingPhase==In.PENDING_INITIAL_LOAD){this._scene!=null&&this._sceneLoadingPhase==In.PENDING_INITIAL_LOAD&&be.trackEvent("Viewer reconnected during initial load",{}),this._connectTo(this._fileKey,0,this._nodeId);return}let e=this._appState.baseScreenId()??((r=this._appState.getActiveCanvas())==null?void 0:r.id());this._connectTo(this._fileKey,1,e)}_connectTo(e,r,n){this._attemptsSinceLastConnectionSuccess=this._attemptsSinceLastConnectionSuccess+1,be.handleMultiplayerOpenConnection(),this.disconnect(),this._fileKey=e,this._connectType=r,this._nodeId=n,this._staticFileRequest!=null&&(this._staticFileRequest.cancel(),this._staticFileRequest=null);let o="";switch(r){case 0:{o="initial-load",this._lastSentSceneGraphQueriesOrNull=null,this._pendingSceneGraphQueriesOrNull=null,this._partialSnapshotInfo=new uf(null,null);break}case 1:{o="reconnect",this._pendingSceneGraphQueriesOrNull==null&&this._lastSentSceneGraphQueriesOrNull!=null&&(this._pendingSceneGraphQueriesOrNull=this._lastSentSceneGraphQueriesOrNull,this._lastSentSceneGraphQueriesOrNull=null);break}}let i=this._mpContext.url({fileKey:e,role:this._role,connectionType:o,canvasQuerySkipContainers:!0}),a=this._partialSnapshotInfo.isValid()&&this._pendingSceneGraphQueriesOrNull!=null&&this._queriesAreEqual(this._partialSnapshotInfo.fulfilledQueries,this._pendingSceneGraphQueriesOrNull);if(this._scene!=null&&a){this._partialSnapshotInfo.reconnectSequenceNumber!=null&&(i+=`&reconnect-sequence-number=${encodeURIComponent(this._partialSnapshotInfo.reconnectSequenceNumber.value.toString())}`);let _=encodeURIComponent(kr.serializeListForMultiplayerURL(this._pendingSceneGraphQueriesOrNull));i+=`&scenegraph-queries=${_}`,this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,0),this._pendingSceneGraphQueriesOrNull=null}this._reconnectKey!=null&&(console.log(`reconnecting with reconnect key ${this._reconnectKey}`),i+=`&reconnect-key=${encodeURIComponent(this._reconnectKey)}`),this._url=i,console.debug(`attempting to connect to ${i}`);let s=this._mpContext.sock(),l=this._mpContext.msgs();if(s!=null&&s.url()==i&&(s.readyState()==si.Socket_CONNECTING||s.readyState()==si.Socket_OPEN))console.debug(`Applied the preconnect optimization for URL ${i}`),this._mpContext.setSock(null),this._mpContext.setMsgs([]),this._mpContext.setPerfMetrics([]);else{if(s!=null){console.warn(`Preconnect URL ${s.url()} doesn't match URL ${i}, skipping preconnect optimization`),be.trackDefinedEvent("prototype.multiplayer_preconnect_failed",{role:this._role,socketUrl:s.url(),generatedUrl:i});try{s.close()}catch{}}s=this._mpContext.newSocket(i),s.setBinaryType("arraybuffer"),l=[]}let c=()=>this._socket==null?s==null:this._socket.equals(s),d=!0,u=null;s.setOnopen(_=>{if(!c()){console.warn("ignoring 'open' event on old socket");return}this._consecutiveFailedConnectionAttempts=0,u()}),u=()=>{this._isConnected=!0,console.debug(`connected to ${this._url}`),be.handleMultiplayerSocketConnectionAttempt(!0,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this._hasConnectedAtLeastOnce=!0,this._attemptsSinceLastConnectionSuccess=0,this._observers.forEach(_=>{_.handleConnect(r,n)})};let p=null;s.setOnmessage(_=>{if(!c()){console.warn("ignoring 'message' event on old socket");return}if(!_.isArrayBuffer()){console.warn("ignoring 'message' event without an ArrayBuffer payload");return}let h=new Uint8Array(_.dataAsArrayBuffer());p(h)}),p=_=>{let h=F();if(d){if(d=!1,!h.modules().prototype.handleServerSchema(_)){this.disconnect();return}this._sendSignal("feature-flags",JSON.stringify(K.getFeatureFlags()))}else h.modules().prototype.handleCompressedMultiplayerMessage(_,this.sessionID(),_n,!1)},s.setOnclose(_=>{if(!c()){console.warn("ignoring 'close' event on old socket");return}if(this._isConnected?be.handleMultiplayerSocketDisconnected(this._isWindowActive()):be.handleMultiplayerSocketConnectionAttempt(!1,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this.disconnect(),!this._shouldReconnect){console.warn("File too busy, not reconnecting");return}let h=null,A=()=>{clearTimeout(this._reconnectionTimeout),this._onlineChangeHandler!=null&&(sr.EventTarget_removeEventListener1(window,"online",this._onlineChangeHandler),this._onlineChangeHandler=null),this._isWindowActive()?this.attemptReconnect():h()};h=()=>{let m=Math.min(Tn.RECONNECTION_DELAY_MAX,Tn.RECONNECTION_DELAY_MIN*Math.pow(2,this._consecutiveFailedConnectionAttempts)),g=Tn.RECONNECTION_DELAY_MIN+(m-Tn.RECONNECTION_DELAY_MIN)*Math.random();console.debug(`attempting to reconnect to ${this._url} in ${g}s`),this._reconnectionTimeout=setTimeout(A,g*1e3|0),this._onlineChangeHandler=()=>{console.log("attempting to reconnect due to connectivity change"),navigator.onLine&&(this._consecutiveFailedConnectionAttempts=0,A())},sr.EventTarget_addEventListener1(window,"online",this._onlineChangeHandler)},h(),this._consecutiveFailedConnectionAttempts=this._consecutiveFailedConnectionAttempts+1}),this._socket=s,s.readyState()==si.Socket_OPEN&&u(),l.forEach(p)}_decodeConcatenatedUncompressedMessages(e,r){let n=new Rd.ByteBuffer(e);for(;n.length!==n._index;){let o=null;try{o=this._sessionSchema.decodeMessage(n)}catch(i){console.error(`decoding failed: '${i.message}'`);return}Tn.VERBOSE&&console.log(`got message of type '${o.type}'`),r(o)}}handleUncompressedMessage(e,r){this._decodeConcatenatedUncompressedMessages(e,n=>{var o;switch(n.type){case"JOIN_START":case"JOIN_START_SKIP_RELOAD":{this._handleJoinStartOrJoinStartSkipReload(n,this._connectType);break}case"JOIN_END":{this._handleJoinEnd();break}case"SCENE_GRAPH_REPLY":{this._handleSceneGraphReply(n);break}case"NODE_CHANGES":throw new Error("handleUncompressedMessage cannot handle a NODE_CHANGES payload. Did you mean to process this message in C++ and call PrototypeApp::willReceiveNodeChanges/PrototypeApp::didReceiveNodeChanges instead?");case"USER_CHANGES":{this._userSyncing!=null&&this._userSyncing.handleUserChanges(n,this,r,this._localUserChangesHandler),(o=this._localUserChangesHandler)==null||o.maybeForceUpdateOnUserChange();break}case"SIGNAL":{this._handleSignal(n);break}case"NOTIFY_SHOULD_UPGRADE":{this._handleNotifyShouldUpgrade();break}case"CLIENT_BROADCAST":{this._handleClientBroadcast(n);break}}})}handleUncompressedSchema(e){try{this._sessionSchema=Rd.createKiwiCodec(!!K.getFeatureFlags().use_new_kiwi_codec_in_viewer,Rd.decodeBinarySchema(e))}catch(r){return console.error(`schema decoding failed: '${r.message}'; uncompressedBytes is ${e.length}`),!1}return!0}willReceiveNodeChanges(){this._appState.prototypeState().checkValidBaseScreenBeforeNodeChanges()}didReceiveNodeChanges(e,r){if(this._appState.prototypeState().checkValidBaseScreenAfterNodeChanges(),this._scene==null){console.warn("ignoring 'NODE_CHANGES' event without a scene");return}this._emitter.trigger("incrementalLoadingInfo",{type:"receiveNodeChanges",size:e}),r!==null&&r!=null&&(this._partialSnapshotInfo.reconnectSequenceNumber=new pe(r)),this._observers.forEach(n=>{n.handleNodeChanges()}),K.getFeatureFlags().prototype_ifl_join_protocol_fix&&!_n||this._isJoined||(console.debug("server sent the full document (vs. incrementally loading)"),this.setNodeLoadedStatusesAndUpdate(null),this._finishLoadingIfNecessary())}getSceneLoadingPhase(){return this._sceneLoadingPhase}_handleJoinStartOrJoinStartSkipReload(e,r){let n=0;if(e.type=="JOIN_START"?n=0:(n=1,console.debug("performing fast reconnect to skip scene reload")),r==0?this._setSceneLoadingPhase(In.PENDING_INITIAL_LOAD):r==1&&n!=1&&this._setSceneLoadingPhase(In.PENDING_LOAD_AFTER_RECONNECT),this._sessionID=e.sessionID,n!=1){e.fileVersion||we("Viewer received JOIN_START message without a file version"),this._appState.prototypeState().mostRecentFixInvalidStateInitiator="Multiplayer._handleJoinStartOrJoinStartSkipReload",this._appState.setScene(null);let o=ft.createScene(this._sessionID,e.fileVersion||null);this.setScene(o),o.setFileKey(this.fileKey())}else this._sendSignal("client-rendered","");this._observers.forEach(o=>{o.handleJoinStart(n,e.sessionID,e.fileVersion)})}_handleJoinEnd(){this._isJoined=!0,this._enableHeartbeatTimer(),this._cachedNextUserChange!=null&&(this._getOrCreateNextUserChange().recentClicks=[]),this._pendingSceneGraphQueriesOrNull!=null&&(this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,1),this._pendingSceneGraphQueriesOrNull=null),this._observers.forEach(e=>{e.handleJoinEnd()}),this.handleStateChangeInitiated(new on(0,ht.ROOT_STABLE_PATH()))}_handleSceneGraphReply(e){this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency-1,Kr.increment("[IFL] sceneGraphQueriesReceived",1),Kr.trackNumber("[IFL] Total Loaded Nodes",e.sceneGraphQueries.length),this._emitter.trigger("incrementalLoadingInfo",{type:"receiveSceneGraphReply",queries:e.sceneGraphQueries.map(r=>gn.toString(r))}),this._partialSnapshotInfo.fulfilledQueries=e.sceneGraphQueries,this.setNodeLoadedStatusesAndUpdate(e.sceneGraphQueries),this._observers.forEach(r=>{r.handleSceneGraphReply(this._lastSceneGraphQueryConcurrency,e.sceneGraphQueries)}),this.handleStateChangeInitiated(new on(0,ht.ROOT_STABLE_PATH()))}_handleSignal(e){if(e.signalName!==void 0&&e.signalPayload!==void 0&&(e.signalName==="invalid-permissions"||e.signalName==="ip-allowlist"||e.signalName==="network-access-restriction")){console.warn(`received ${e.signalName} message.`),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="client-too-old"){console.warn("received 'client-too-old' message. refreshing!"),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName==="server-side-load-time-metadata"){let r=mT.attemptToParseFrom(e.signalPayload)}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-sequence-number"&&(this._partialSnapshotInfo.reconnectSequenceNumber=new pe(parseInt(e.signalPayload))),e.signalName!==void 0&&e.signalName=="reconnect-immediately"&&(console.log("received 'reconnect-immediately' signal. reconnecting."),this.attemptReconnect()),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-key"&&(this._reconnectKey=e.signalPayload,console.debug(`server sent reconnect key ${this._reconnectKey}`)),e.signalName!==void 0&&e.signalName=="too-many-connections"){let r=hT.attemptToParseFrom(e.signalPayload!==void 0?e.signalPayload:"");r!=null&&(this._staticFileRequest=new Vo(r.url).format(1),this._staticFileRequest.get().then(n=>{this._observers.forEach(o=>{o.handleJoinStart(0,-1,-1)}),this._appState.serialization().decodeSceneForViewerAndPrototypeLib1(n.bytes).then(o=>{o!=null?(this._scene=o,this.setNodeLoadedStatusesAndUpdate(null),this._observers.forEach(i=>{i.handleJoinEnd()}),this._finishLoadingIfNecessary()):we("Failed to parse scene")})})),console.warn("too many connections to multiplayer or example file, not reconnecting"),this._shouldReconnect=!1}}_handleNotifyShouldUpgrade(){console.warn("received NOTIFY_SHOULD_UPGRADE message. refreshing!"),location.reload()}_handleClientBroadcast(e){for(let r of e.broadcasts)r.prototypePresenter!=null&&(r.prototypePresenter.nomination!=null?this.updateNominatedPresenter(r.prototypePresenter.nomination,r.sessionID):(this.setPresenterSessionID(new pe(r.prototypePresenter.sessionID)),this._presenterSessionID!=null&&(this._sessionsNominatingCurrentUser.clear(),this._sessionNominatedByCurrentUser=null)));this._observers.forEach(r=>{r.handlePresenterChange()})}updateNominatedPresenter(e,r){e.isCancelled?(e.sessionID==this._sessionID&&(r==this._sessionID?this._sessionsNominatingCurrentUser.clear():this._sessionsNominatingCurrentUser.delete(r)),this._sessionNominatedByCurrentUser!=null&&this._sessionNominatedByCurrentUser.value==e.sessionID&&(this._sessionNominatedByCurrentUser=null)):(e.sessionID==this._sessionID&&this._sessionsNominatingCurrentUser.add(r),r==this._sessionID&&(this._sessionNominatedByCurrentUser=new pe(e.sessionID)))}disconnect(){if(this._isJoined=!1,this._socket!=null){try{this._socket.close()}catch{}this._socket=null}this._lastSceneGraphQueryConcurrency=0,clearTimeout(this._heartbeatTimeout),clearTimeout(this._reconnectionTimeout),this._isConnected&&(console.debug(`disconnected from ${this._url}`),this._isConnected=!1,this._observers.forEach(e=>{e.handleDisconnect()}))}_enableHeartbeatTimer(){if(!1)return;let e=null,r=()=>{var n;if(this._isWindowActive()&&((n=this._socket)==null?void 0:n.readyState())==si.Socket_OPEN){console.debug("sending heartbeat message");let o={};o.type="USER_CHANGES",o.userChanges=[],this._sendMessage(o)}e()};e=()=>{this._heartbeatTimeout=setTimeout(r,Tn.HEARTBEAT_DELAY)},e()}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this)}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}handleSceneGraphEvent(e){let r=e.property==114&&ot.asString(e.newVal)=="CREATED",n=e.property==32;(r||n)&&this._partialSnapshotInfo.fulfilledQueries!=null&&this._partialSnapshotInfo.fulfilledQueries.some(o=>gn.fullyLoadsNode(o,e.node))&&e.node.setHasBeenLoaded(!0)}handleStateUpdate(e,r){this.pushAllInstanceStateChanges()}handleStateChangeAborted(e){e!=null&&(this.handleStateUpdate(e,"ABORTED"),this.handlePresentedStateChange(null,e.oldStateAndOverlays,null))}handleStateChangeCommitted(e,r){this.handleStateUpdate(e,"COMMITTED")}handleStateChangeInitiated(e){if(e==null||e.oldStateAndOverlays.stateId==null&&e.newStateAndOverlays.stateId==null)return;this.handleStateUpdate(e,"INITIATED");let r=this._getSynchronizableHotspotId_instanceHACK(e.interactionAddress.hotspotStablePath);this.handlePresentedStateChange(r,e.newStateAndOverlays,e.interactionAddress.interactionId)}handleStateChangeRequested(e){}_pushInstanceStateChange(e,r,n){let o=ut.encodeInstanceStateChange(r,n);o.hotspotStablePath==null&&(o.hotspotStablePath=ut.encodeGUIDPath(e)),this._getOrCreateNextUserChange().instanceStateChanges==null&&(this._getOrCreateNextUserChange().instanceStateChanges=[]),this._getOrCreateNextUserChange().instanceStateChanges.push(o)}handleHsmAborted(e,r){this._pushInstanceStateChange(e,r,"ABORTED")}handleHsmCommitted(e,r,n){this._pushInstanceStateChange(e,r,"COMMITTED")}handleHsmInitiated(e,r){this._pushInstanceStateChange(e,r,"INITIATED")}handleHsmRequested(e,r){}pushAllInstanceStateChanges(){let e=this._appState.prototypeState();e.getOnscreenStates().forEach(r=>{let n=e.getStateMachineLastChangeInHistory(r.a);this._pushInstanceStateChange(r.a,n,"INITIATED"),this._pushInstanceStateChange(r.a,n,"COMMITTED")})}onTransitionFrame(e){this._getOrCreateNextUserChange()}_getSynchronizableHotspotId_instanceHACK(e){var n,o;return(o=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e))==null?void 0:o.id()}_createTriggeredOverlaysDataForMultiplayer(e,r){let n=[];return r.overlays.forEach(o=>{let i=this._getSynchronizableHotspotId_instanceHACK(o.openingHotspotStablePath);n.push(ut.encodeOverlayData(o,i))}),n}_updateNextUserChangeForOverlay(e,r){this.observedUser()==null&&(this._getOrCreateNextUserChange().triggeredOverlaysData=this._createTriggeredOverlaysDataForMultiplayer(e,r))}handleVideoStateChange(e){this._getOrCreateNextUserChange().videoStateChangeData=e.slice()}handleEmbeddedPrototypeDataChange(e){this._getOrCreateNextUserChange().embeddedPrototypeData=e.slice()}handleEmbeddedPrototypeChange(e,r){if(this._getOrCreateNextUserChange().embeddedPrototypeData==null&&(this._getOrCreateNextUserChange().embeddedPrototypeData=[],this._userSyncing!=null)){let o=this._userSyncing.userBySessionID().get(this._sessionID);o!=null&&o.embeddedPrototypeData!=null&&(this._getOrCreateNextUserChange().embeddedPrototypeData=o.embeddedPrototypeData)}if(r===-1){this._getOrCreateNextUserChange().embeddedPrototypeData=this._getOrCreateNextUserChange().embeddedPrototypeData.filter(n=>!Q.equals(Q.fromFigGUID(n.nodeId),e));return}this._getOrCreateNextUserChange().embeddedPrototypeData.push({nodeId:Q.toFigGUID(e),sessionId:r})}handleActiveSlidesEmbeddedPrototypeChange(e){this._getOrCreateNextUserChange().activeSlidesEmbeddablePrototype=e?Q.toFigGUID(e):null}pushAllVideoStateChanges(){this._appState.prototypeState().snapshotLatestVideoStateChanges(),this._getOrCreateNextUserChange().videoStateChangeData=this._appState.prototypeState().getVideoStateChanges()}handlePresentedStateChange(e,r,n){var a;let o=this._previousTlfID,i=this._appState.baseScreenId();Q.equals(o,i)||(this._previousTlfID=i,this._getOrCreateNextUserChange().selection=[],i!=null&&this._getOrCreateNextUserChange().selection.push(Q.toFigGUID(i))),e!=null&&(this._getOrCreateNextUserChange().lastTriggeredHotspot=ut.encodeGUID(e)),n!=null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=ut.encodeGUID(n)),this._getOrCreateNextUserChange().lastTriggeredObjectAnimationIndex=(a=r.animationState)==null?void 0:a.actionIndex,r.animationState!=null?this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=ut.encodeGUID(r.animationState.interactionId):n==null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=ut.encodeGUID(Q.invalid())),this._updateNextUserChangeForOverlay(e,r)}pushAllSetVariableActions(){this.handleSetVariableAction(this._appState.prototypeState()._setVariableActionHistory)}handleSetVariableAction(e){this._getOrCreateNextUserChange().triggeredSetVariableActionData=e}pushAllSetVariableModeActions(){this.handleSetVariableModeAction(this._appState.prototypeState()._setVariableModeActionHistory)}handleSetVariableModeAction(e){this._getOrCreateNextUserChange().triggeredSetVariableModeActionData=e}handleFitModeChange(e,r){}handleRestartPrototype(){}clearNextUserChange(){this._cachedNextUserChange=null}_getOrCreateNextUserChange(){return this._cachedNextUserChange==null&&(this._cachedNextUserChange={},this._cachedNextUserChange.sessionID=this._sessionID,this._cachedNextUserChange.instanceStateChanges=null),this._cachedNextUserChange}getParticles(){var e;return(e=this.observedUser())==null?void 0:e.remainingParticles()}getMouse(){var e;return(e=this.observedUser())==null?void 0:e.canvasSpaceMouse}getScrollPositions(){var e;return(e=this.observedUser())==null?void 0:e.scrollPositions}setCanvasSpaceMouse(e){let r=this._previousCanvasSpaceMouseLocation;if(e==null&&r==null||e!=null&&r!=null&&e.equals(r))return;this._previousCanvasSpaceMouseLocation=(e==null?void 0:e.clone())??null;let n={};e!=null?(n.x=e.x(),n.y=e.y()):(n.x=NaN,n.y=NaN);let o={};o.canvasSpaceLocation=n,o.cursor="DEFAULT",this._getOrCreateNextUserChange().mouse=o}recordCanvasSpaceClick(e){for(;this._canvasSpaceClicks.length>10;)this._canvasSpaceClicks.shift();let r={};r.x=e.x(),r.y=e.y();let n={};n.id=this._nextCanvasSpaceClickID=this._nextCanvasSpaceClickID+1,n.point=r,this._canvasSpaceClicks.push(n),this._getOrCreateNextUserChange().recentClicks=this._canvasSpaceClicks.slice()}setScrollPosition(e,r){for(ie.List_removeIf(this._recentlyChangedScrollPositions,n=>n.nodeId==e);this._recentlyChangedScrollPositions.length>this.maxScrollPositionsToStore;)this._recentlyChangedScrollPositions.shift();this._recentlyChangedScrollPositions.push(new _T(e,r)),this._getOrCreateNextUserChange().scrollPositions=this._recentlyChangedScrollPositions.map(n=>{let o={};return o.node=ut.encodeGUID(Q.fromString(n.nodeId)),o.scrollOffset=ut.encodeVector2(n.offset),o})}maybeFlushNextUserChange(e){let r=Xe.seconds();(this._lastFlush==-1||r-this._lastFlush>Tn.FLUSH_INTERVAL_SEC||e==1)&&(this._flushNextUserChange(),this._lastFlush=r)}_flushNextUserChange(){if(this._cachedNextUserChange!=null){let e={};e.type="USER_CHANGES",e.userChanges=[this._cachedNextUserChange],this._messageObservers.forEach(r=>{r.handleMultiplayerMessage(e)}),this._isJoined&&(Tn.debugUserChanges&&console.log("flushNextUserChange",this._cachedNextUserChange),this._sendMessage(e),this._cachedNextUserChange=null)}}_queriesAreEqual(e,r){let n=new Map;for(let i of e)n.set(gn.hash(i),!0);let o=new Map;for(let i of r)o.set(gn.hash(i),!0);if(n.size!=o.size)return!1;for(let i of Array.from(n.keys()))if(!o.has(i))return!1;return!0}setSceneGraphQueries(e){this._queriesAreEqual(e,this.currentSceneGraphQueries())||(this._isJoined?this._sendSceneGraphQueries(e,1):this._pendingSceneGraphQueriesOrNull=e)}_sendSceneGraphQueries(e,r){if(this._lastSceneGraphQueryConcurrency==0&&(this._lastSceneGraphQueryTime=Xe.milliseconds()),this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency+1,e.length>0&&(this._lastSentSceneGraphQueriesOrNull=e,r==1)){let n={};n.type="SCENE_GRAPH_QUERY",n.sceneGraphQueries=e,Kr.increment("[IFL] sceneGraphQueriesSent",1),this._emitter.trigger("incrementalLoadingInfo",{type:"sendSceneGraphQuery",queries:n.sceneGraphQueries.map(o=>gn.toString(o))}),this._sendMessage(n)}}_sendSignal(e,r){let n={};n.type="SIGNAL",n.signalName=e,n.signalPayload=r,this._sendMessage(n)}nominatePresenter(e){let r=this.presenterClientBroadcastMessageWithNomination(e,!1);this._sendClientBroadcast(r)}cancelPresenterNomination(e){let r=this.presenterClientBroadcastMessageWithNomination(e,!0);this._sendClientBroadcast(r)}presenterClientBroadcastMessageWithNomination(e,r){let n={};n.type="CLIENT_BROADCAST";let o={};o.sessionID=this._sessionID;let i={},a={};return this._presenterSessionID!=null&&(i.sessionID=this._presenterSessionID.value),a.sessionID=e,a.isCancelled=r,i.nomination=a,o.prototypePresenter=i,n.broadcasts=[o],n}startPresenting(){let e=this.presenterClientBroadcastMessage(!0);this._sendClientBroadcast(e)}stopPresenting(){let e=this.presenterClientBroadcastMessage(!1);this._sendClientBroadcast(e)}setSlideSpeakerNotes(e,r){let n={};n.type="NODE_CHANGES";let o={guid:Q.toFigGUID(e),slideSpeakerNotes:r};n.nodeChanges=[o],this._sendClientBroadcast(n)}setInteractiveSlideConfigData(e,r,n){let o={};o.type="NODE_CHANGES";let i={entries:[{key:r,value:n}]},a={guid:Q.toFigGUID(e),interactiveSlideConfigData:i};o.nodeChanges=[a],this._sendClientBroadcast(o)}setInteractiveSlideParticipantData(e,r,n){let o={};o.type="INTERACTIVE_SLIDE_CHANGE";let i={anonymousUserID:r,nodeID:Q.toFigGUID(e),responseData:n};o.interactiveSlideElementChange=i,this._sendClientBroadcast(o)}presenterClientBroadcastMessage(e){let r={};r.type="CLIENT_BROADCAST";let n={},o={};return e&&(o.sessionID=this._sessionID),n.prototypePresenter=o,r.broadcasts=[n],r}_sendClientBroadcast(e){this._socket!=null&&this._sendMessage(e)}_sendMessage(e){K.getFeatureFlags().prototype_log_all_ws&&console.log(e),this._socket.send2(gi.deflateRaw(Ve().encodeMessage(e)))}};Tn.debugUserChanges=!1,Tn.VERBOSE=!1,Tn.SCHEMA_PREFIX="fig-wire\0\0\0",Tn.SCHEMA_PREFIX_BYTES=new Uint8Array([102,105,103,45,119,105,114,101,1,0,0,0]),Tn.RECONNECTION_DELAY_MIN=1,Tn.RECONNECTION_DELAY_MAX=128,Tn.FLUSH_INTERVAL_SEC=1/30,Tn.HEARTBEAT_DELAY=60*1e3;var Ba=Tn;var uf=class{constructor(e,r){this.reconnectSequenceNumber=null,this.fulfilledQueries=null,this.reconnectSequenceNumber=e,this.fulfilledQueries=r}isValid(){return this.reconnectSequenceNumber!=null&&this.fulfilledQueries!=null}};var Pp=class Pp{age(){return Ir.Math_clamp((Xe.seconds()-this.startTimestamp)/Pp.LIFETIME,0,1)}constructor(e,r,n){this.sessionID=e,this.canvasSpaceLocation=r,this.startTimestamp=n}};Pp.LIFETIME=.25,Pp.RADIUS=25;var yd=Pp,Fp=class{remainingParticles(){let e=Xe.seconds(),r=null;return this.particles!=null&&ie.List_removeIf(this.particles,n=>e-n.startTimestamp>yd.LIFETIME?!0:(r==null&&(r=[]),r.push(n),!1)),r}toJSON(){return{sessionID:this.sessionID,userID:this.userID,name:this.name,color:this.color!=N.TRANSPARENT?N.toCSS(this.color):null,imageURL:this.imageURL,deviceName:this.deviceName,currentFrame:this.currentFrame!=null?this.currentFrame:null}}constructor(e){this.sessionID=e,this.userID=null,this.clientID=null,this.name=null,this.color=N.TRANSPARENT,this.imageURL=null,this.deviceName=null,this.currentFrame=null,this.canvasSpaceMouse=null,this.largestClickID=-1,this.particles=null,this.scrollPositions=new Map,this.observedSessions=[],this.lastTriggeredHotspot=null,this.lastTriggeredPrototypeInteractionID=null,this.lastTriggeredObjectAnimationIndex=null,this.triggeredOverlaysData=[],this.instanceStateChanges=[],this.triggeredSetVariableActionData=[],this.triggeredSetVariableModeActionData=[],this.videoStateChangeData=[],this.embeddedPrototypeData=[],this.activeSlidesEmbeddablePrototype=Q.invalid()}},oc=class{userBySessionID(){return this._userBySessionID}addUserBySessionId(e){this._userBySessionID.set(e,new Fp(e))}handleUserChanges(e,r,n=!1,o=null){if(e.userChanges===void 0){console.error("decoded node change message with missing required field: 'userChanges'");return}let i=!1,a=!1;for(let s of e.userChanges){if(s.sessionID===void 0){we("skipping user change message without sessionID");continue}if(o&&!o.shouldHandleUserChange(s,n))continue;let l=s.sessionID,c=Ba.debugUserChanges&&r!=null&&l!=r.sessionID();s.observing&&s.observing.includes(r.sessionID())&&(a=!0),s.connected!==void 0&&(s.connected?(this._userBySessionID.set(l,new Fp(l)),c&&console.log(`user sessionID ${l} connected`,this._userBySessionID.get(l).toJSON()),r!=null&&(r.pushAllInstanceStateChanges(),r.pushAllSetVariableActions(),r.pushAllSetVariableModeActions(),r.pushAllVideoStateChanges())):(c&&this._userBySessionID.has(l)&&console.log(`user sessionID ${l} disconnected`,this._userBySessionID.get(l).toJSON()),r!=null&&r.removeNominator(l),this._userBySessionID.delete(l)),i=!0);let d=Xt.IntMap_get(this._userBySessionID,l,null);d!=null?(i=this._applyChangeToUser(s,d,c)||i,this._applyNullChecksToUserStrings(d)):c&&we("could not find existing user to apply user change message"),c&&console.log("recvUserChange",s,i)}a&&r.pushAllVideoStateChanges(),i&&this.onChange!=null&&this.onChange()}_applyNullChecksToUserStrings(e){e.userID==null&&(e.userID=""),e.name==null&&(e.name=""),e.imageURL==null&&(e.imageURL="")}_applyChangeToUser(e,r,n){let o=!1,i=e.sessionID;if(e.color!==void 0&&(r.color=ut.decodeColor(e.color),o=!0),e.name!==void 0&&(r.name=e.name,o=!0),e.deviceName!==void 0&&(r.deviceName=e.deviceName,o=!0),e.imageURL!==void 0&&(r.imageURL=e.imageURL,o=!0),e.userID!==void 0&&(r.userID=e.userID,o=!0),e.clientID!==void 0&&(r.clientID=e.clientID,o=!0),e.observing!==void 0&&(r.observedSessions=e.observing,o=!0),e.selection!==void 0){let a=e.selection;r.currentFrame=a.length==1?ut.decodeGUID(a[0]):null,o=!0}if(e.mouse!==void 0){let a=e.mouse;if(a.canvasSpaceLocation!==void 0){let s=ut.decodeVector(a.canvasSpaceLocation);(r.canvasSpaceMouse==null||!r.canvasSpaceMouse.equals(s))&&(r.canvasSpaceMouse=s.equals(s)?s:null,this.onMouseCursorChange!=null&&this.onMouseCursorChange(i))}}if(e.recentClicks!==void 0)if(r.particles==null){r.particles=[];for(let a of e.recentClicks)a.id>r.largestClickID&&(r.largestClickID=a.id)}else for(let a of e.recentClicks)a.id>r.largestClickID&&(r.largestClickID=a.id,r.particles.push(new yd(i,ut.decodeVector(a.point),Xe.seconds())),this.onMouseCursorChange!=null&&this.onMouseCursorChange(i));if(e.scrollPositions!==void 0)for(let a of e.scrollPositions)r.scrollPositions.set(ut.decodeGUID_instanceHACK(a.node),ut.decodeVector(a.scrollOffset));return e.lastTriggeredHotspot!==void 0&&(r.lastTriggeredHotspot=ut.decodeGUID_instanceHACK(e.lastTriggeredHotspot),o=!0),e.lastTriggeredPrototypeInteractionID!==void 0&&(r.lastTriggeredPrototypeInteractionID=ut.decodeGUID(e.lastTriggeredPrototypeInteractionID),r.lastTriggeredObjectAnimationIndex=e.lastTriggeredObjectAnimationIndex===void 0?null:e.lastTriggeredObjectAnimationIndex,o=!0),e.triggeredOverlaysData!==void 0&&(r.triggeredOverlaysData=e.triggeredOverlaysData.slice(),o=!0),e.instanceStateChanges!==void 0&&(e.instanceStateChanges.forEach(a=>{r.instanceStateChanges.push(a)}),o=!0),e.triggeredSetVariableActionData!==void 0&&(r.triggeredSetVariableActionData=e.triggeredSetVariableActionData.slice(),o=!0),e.triggeredSetVariableModeActionData!==void 0&&(r.triggeredSetVariableModeActionData=e.triggeredSetVariableModeActionData.slice(),o=!0),e.videoStateChangeData!==void 0&&(r.videoStateChangeData=e.videoStateChangeData.slice(),o=!0),e.embeddedPrototypeData!==void 0&&(r.embeddedPrototypeData=e.embeddedPrototypeData.slice(),o=!0),e.activeSlidesEmbeddablePrototype!==void 0&&(r.activeSlidesEmbeddablePrototype=Q.fromFigGUID(e.activeSlidesEmbeddablePrototype),o=!0),n&&console.log("_applyChangeToUser",e,r.toJSON()),o}constructor(){this._sessionID=-1,this._userBySessionID=new Map,this.onChange=null,this.onMouseCursorChange=null}};var ic;(a=>{function t(){let s=null;try{s=localStorage}catch{return 1}let l=+s.getItem("cursorScaleFactor");return l||1}a._globalCursorScaleFactor=t;function e(s,l,c,d,u,p,_){let h=x.new2(),A=x.new2(),m=c.clone(),g=1/l;if(K.isInlinePreview()&&m.expand1(3),A.copyFrom(d),A.expand1(g),A.left()<m.left()&&s.fillRect(h.setTo1(A.left(),A.top(),m.left()-A.left(),A.height()),u),m.right()<A.right()&&s.fillRect(h.setTo1(m.right(),A.top(),A.right()-m.right(),A.height()),u),A.top()<m.top()&&s.fillRect(h.setTo1(m.left()-g,A.top(),m.width()+2*g,m.top()-A.top()),u),m.bottom()<A.bottom()&&s.fillRect(h.setTo1(m.left()-g,m.bottom(),m.width()+2*g,A.bottom()-m.bottom()),u),p>0){let S=_==null?void 0:_.clone();S==null||S.expand1(g);let R=p*Math.cos(Math.PI/4)+4*g;(S.left()+R>m.left()||S.top()+R>m.top())&&s.fillConvexPolygon([S.topLeft(),S.topLeft().add(new O(R,0)),S.topLeft().add(new O(0,R))],u),(S.right()-R<m.right()||S.top()+R>m.top())&&s.fillConvexPolygon([S.topRight(),S.topRight().add(new O(0,R)),S.topRight().add(new O(-R,0))],u),(S.right()-R<m.right()||S.bottom()-R<m.bottom())&&s.fillConvexPolygon([S.bottomRight(),S.bottomRight().add(new O(-R,0)),S.bottomRight().add(new O(0,-R))],u),(S.left()+R>m.left()||S.bottom()-R<m.bottom())&&s.fillConvexPolygon([S.bottomLeft(),S.bottomLeft().add(new O(0,-R)),S.bottomLeft().add(new O(R,0))],u)}}a.drawPreviewStencil=e;function r(s,l,c,d){for(let u of l){let p=O.new(u.canvasSpaceLocation);if(!d.contains2(p))continue;let _=[],h=u.age(),A=h*yd.RADIUS,m=Math.max(8,(A|0)*2);for(let g=0;g<m;g=g+1){let S=Math.PI*2*g/m;_.push(new O(p.x()+Math.cos(S)*A*c,p.y()+Math.sin(S)*A*c))}s.fillConvexPolygon(_,N.new3(.9,.9,.9,.5*(1-h)))}}a.drawParticles=r;function n(s,l,c){let d=l.x(),u=l.y(),p=t()/c,_=[],h=[];for(let R of a.cursorOutlineOuter)_.push(O.new());for(let R of a.cursorOutlineInner)h.push(O.new());let A=2,m=.5,g=(A+1)*(A+1)*(A+1)*(A+1),S=m/g;for(let R=-A,E=A+1;R<E;R=R+1)for(let P=-A,T=A+1;P<T;P=P+1){let y=(A+1-Math.abs(R))*(A+1-Math.abs(P))*S;if(!(y<1/255)){for(let v=0,w=a.cursorOutlineOuter.length;v<w;v=v+1){let I=a.cursorOutlineOuter[v],C=_[v];C.setX(d+(I.x()+R)*p),C.setY(u+(I.y()+P+1)*p)}s.fillConvexPolygon(_,N.new3(0,0,0,y))}}for(let R=0,E=a.cursorOutlineOuter.length;R<E;R=R+1){let P=a.cursorOutlineOuter[R],T=_[R];T.setX(d+P.x()*p),T.setY(u+P.y()*p)}s.fillConvexPolygon(_,N.WHITE);for(let R=0,E=a.cursorOutlineInner.length;R<E;R=R+1){let P=a.cursorOutlineInner[R],T=h[R];T.setX(d+P.x()*p),T.setY(u+P.y()*p)}s.fillConvexPolygon(h,N.BLACK)}a.drawMouseCursor=n,a.cursorOutlineOuter=[new O(14.933,9.027),new O(7.755,10.975),new O(3.57,17.299),new O(0,0)],a.cursorOutlineInner=[new O(12.416,8.674),new O(7.13,10.109),new O(4.063,14.742),new O(1.442,2.04)]})(ic||(ic={}));var fT=class{constructor(e,r){this.hash=0,this.tree=e,this.bounds=r;let n=new Wo;n.hash1(r.x()),n.hash1(r.y()),n.hash1(r.width()),n.hash1(r.height()),this.hash=n.value(),this._equalsImpl=(o,i)=>o.bounds.equals(i.bounds)?o.tree.equalsWithinBounds(i.tree,o.bounds):!1}equals(e){return this._equalsImpl(this,e)}},Dp=class{constructor(e,r){this._resetMaps();let n=o=>{let i=Qe.StringMap_get(this._tileHandleToKey,o,null);i!=null&&(this._tileHandleToKey.delete(o),this._keyToTileHandle.remove(i),this._keyToNeededImages.remove(i))};this._tileAtlas=new gs(e,n,r)}tileSize(){return this._tileAtlas.tileSize()}textureSize(){return this._tileAtlas.textureSize()}drawToScreenLargeTileSize(){return this._tileAtlas.drawToScreenLargeTileSize()}_resetMaps(){this._keyToTileHandle=new Vi(e=>e.hash,(e,r)=>e.equals(r),e=>null),this._keyToNeededImages=new Vi(e=>e.hash,(e,r)=>e.equals(r),e=>null),this._tileHandleToKey=new Map}_allocateTileHandle(e){let r=this._tileAtlas.allocateTile();return this._tileHandleToKey.set(r,e),this._keyToTileHandle.set(e,r),r}getOrInsertOrNull(e,r){if(e==null)return null;let n=new tn(Tr.solidColorRect(r,N.BLACK,1),e).optimized();if(n==null)return null;let o=new fT(n,r),i=new Cm(o,this);return i.tileHandleOrNull=this._keyToTileHandle.get(o,null),i.neededImagesOrNull=this._keyToNeededImages.get(o,null),i}setNeededImagesForTile(e,r){this._keyToNeededImages.set(e.key,r),e.neededImagesOrNull=r}maximumCapacity(){return this._tileAtlas.maximumCapacity()}prepareForNewFrame(){this._tileAtlas.prepareForNewFrame()}capacityUsedForCurrentFrame(){return this._tileAtlas.capacityUsedForCurrentFrame()}totalVRAM(){return this._tileAtlas.totalVRAM()}hasRenderedContent(e){return e.tileHandleOrNull!=null&&this._tileAtlas.tileIsStillValid(e.tileHandleOrNull)}prepareToRenderTo(e,r){return(!this.hasRenderedContent(e)||e.tileHandleOrNull==null)&&(e.tileHandleOrNull=this._allocateTileHandle(e.key)),this._tileAtlas.viewportForTile(e.tileHandleOrNull,r),this._tileAtlas.framebufferForTile(e.tileHandleOrNull)}textureRegionOrNull(e){if(!this.hasRenderedContent(e)||e.tileHandleOrNull==null)return null;let r=x.new2();this._tileAtlas.viewportForTile(e.tileHandleOrNull,r);let n=this._tileAtlas.framebufferForTile(e.tileHandleOrNull).colorTexture();return new Tc(n,r.scaledBy1(1/n.width()))}devalueTile(e){this._tileAtlas.devalueTile(e.tileHandleOrNull)}clear(){this._tileAtlas.clearCache(),this._resetMaps()}};var EP=(t,e,r)=>{var n;if(qn.didUseUnifiedRendererMaterial(K.useUnifiedRenderer()),K.useUnifiedRenderer()){let o={m00:r.m00(),m01:r.m01(),m02:r.m02(),m10:r.m10(),m11:r.m11(),m12:r.m12()};(n=F().modules().wasmRendererBindings)==null||n.bindSolidColorPaintForStencilUniforms(o)}else Oe.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r)},vd=(t,e,r,n,o)=>{var i;if(qn.didUseUnifiedRendererMaterial(K.useUnifiedRenderer()),K.useUnifiedRenderer()){let a={m00:r.m00(),m01:r.m01(),m02:r.m02(),m10:r.m10(),m11:r.m11(),m12:r.m12()};(i=F().modules().wasmRendererBindings)==null||i.bindSolidColorPaintUniforms(a,o,N.toColorF(n))}else Oe.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,r),Oe.Material_setUniformVec42(t,e.SHADER_NAME_U_COLOR,n),t.setUniformFloat(e.SHADER_NAME_U_OPACITY,o)},IP=(t,e,r,n,o,i,a,s,l,c,d)=>{Oe.Material_setUniformMat32(t,e.SHADER_NAME_U_PAINT_TRANSFORM0,r),Oe.Material_setUniformMat32(t,e.SHADER_NAME_U_VERTEX_TRANSFORM,n),Oe.Material_setUniformVec22(t,e.SHADER_NAME_PATTERN_BOUNDS_OFFSET_PIXELS,i),Oe.Material_setUniformVec22(t,e.SHADER_NAME_PATTERN_TEX_SIZE_PIXELS,o),t.setUniformFloat(e.SHADER_NAME_TILE_SIZE_PIXELS,a),Oe.Material_setUniformVec22(t,e.SHADER_NAME_FILL_SIZE_PIXELS,s),Oe.Material_setUniformVec22(t,e.SHADER_NAME_OFFSET_PIXELS,l),t.setUniformInt(e.SHADER_NAME_PATTERN_TILE_TYPE,c),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,d,0)},RP=(t,e,r,n,o)=>{Oe.Material_setUniformMat32(t,e.SHADER_NAME_PAINT_TRANSFORM,r),Oe.Material_setUniformMat32(t,e.SHADER_NAME_VERTEX_TRANSFORM,n),t.setUniformSampler(e.SHADER_NAME_TEXTURE0,o,0)};var Cd=class{constructor(e,r){this.type=e,this.interruptIndex=r}},pf=class extends Cd{constructor(e,r,n,o){super(3,0),this.node=e,this.transform=r,this.canvasSpaceTileBounds=n,this.inverseVolatileTransform=o}},_f=class extends Cd{constructor(e){super(2,0),this.scissor=e}},hf=class extends Cd{constructor(e,r,n,o,i){super(4,0),this.blendIsNoOp=e,this.node=r,this.transform=n,this.canvasSpaceTileBounds=o,this.inverseVolatileTransform=i}},Eo=class extends Cd{constructor(e,r,n,o,i){super(1,i),this.node=e,this.transform=r,this.canvasSpaceTilebounds=n,this.inverseVolatileTransform=o}};var Od=class Od{texture(e){return this._texture==null&&(this._texture=e.createTextureWithPixels(Me.RGBA_LINEAR_CLAMP,Od.WIDTH,Od.HEIGHT,this.pixels,br.GRADIENT)),this._texture}totalVRAM(){return this._texture!=null?hi.Texture_totalVRAM(this._texture):0}constructor(e){this.pixels=e,this._texture=null}};Od.WIDTH=1024,Od.HEIGHT=2;var rl=Od,wp=class t{constructor(){this._table=null;let e=new Wo;this._table=new Vi(r=>t._hashGradient(e,r),(r,n)=>r.equals2(n),r=>t._evaluateGradient(r))}allocate(e){return this._table.getOrInsertFallback(e)}totalVRAM(){let e=0;return this._table.each((r,n)=>{e=e+n.totalVRAM()}),e}static _hashGradient(e,r){let n=r.colorStops(),o=n.length;e.hash2(Ml.shouldWrap(r.type())?1:0),e.hash2(o);for(let i=0,a=o;i<a;i=i+1){let s=n[i];e.hash2(s.color),e.hash1(s.position)}return e.value()}static _evaluateGradient(e){let r=new Uint8Array(rl.WIDTH*rl.HEIGHT*4),n=e.flattenedStops(),o=n.length;if(o!=0){let i=1,a=n[0],s=a,l=0;for(let c=0;c<rl.WIDTH;c=c+1){let d=c/(rl.WIDTH-1);for(;a.position<d&&i<o;)s=a,a=n[i],i=i+1;let u=s.position,p=a.position,_=d<u?0:d>p?1:u<p?(d-u)/(p-u):0,h=s.color,A=a.color,m=((h>>>24)+((A>>>24)-(h>>>24))*_)/255;for(let g=0;g<4;g=g+1){let S=h&255,R=A&255,E=S+(R-S)*_,P=.5+257*(g<3?E*m:E)|0;r[l]=P>>8,r[l+rl.WIDTH*4]=P,h>>=8,A>>=8,l=l+1}}}return new rl(r)}};var gT=new Map([["SOLID",0],["GRADIENT_LINEAR",1],["GRADIENT_RADIAL",2],["GRADIENT_ANGULAR",3],["GRADIENT_DIAMOND",4],["IMAGE",5],["EMOJI",6],["VIDEO",7]]),mf=class{constructor(e,r,n,o){this._gradientDataCache=new Map,this._gradientPool=new wp,this._batchAntialiasing=null,this._currentBatchScissorBuilder=new Et,this._shouldFlushAfterStencilCover=!1,this._materialStrings=Lr.instance(),this.computeStates=new Map([["ODD",_r.ODD_WINDING_NUMBER_COMPUTE],["NONZERO",_r.NONZERO_WINDING_NUMBER_COMPUTE]]),this.useStates=new Map([["ODD",_r.ODD_WINDING_NUMBER],["NONZERO",_r.NONZERO_WINDING_NUMBER]]),this.clearStates=new Map([["ODD",_r.ODD_WINDING_NUMBER_CLEAR],["NONZERO",_r.NONZERO_WINDING_NUMBER_CLEAR]]),this.setFillStates=new Map([["ODD",_r.ODD_WINDING_NUMBER_FILL],["NONZERO",_r.NONZERO_WINDING_NUMBER_FILL]]),this.setStrokeStates=new Map([["ODD",_r.ODD_WINDING_NUMBER_STROKE],["NONZERO",_r.NONZERO_WINDING_NUMBER_STROKE]]),this.compoundUseStates=new Map([[0,_r.STROKE_INSIDE],[1,_r.STROKE_OUTSIDE]]),this.compoundClearStates=new Map([[0,_r.STROKE_INSIDE_CLEAR],[1,_r.STROKE_OUTSIDE_CLEAR]]),this._delegate=e,this._context=r,this._tileConfig=n,this._bufferPool=o,K.useUnifiedRenderer()?this._solidColorMaterial=new sh(this._context,"solidColorPaint",_t.getPositionF2CoordF3()):this._solidColorMaterial=this._context.createMaterial("solidColor",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_SOLID_COLOR_PAINT_FRAGMENT),this._gradientPaintMaterial=this._context.createMaterial("gradientPaint",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_GRADIENT_FRAGMENT),this._lerpGradientPaintMaterial=this._context.createMaterial("lerpGradientPaint",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_LERP_GRADIENT_FRAGMENT),this._stencilMaterial=this._context.createMaterial("stencil",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_LOOP_BLINN_VERTEX,this._materialStrings.SHADER_SOURCE_LOOP_BLINN_FRAGMENT),this._stencilMaterialInstanced=this._context.createMaterial("stencilInstanced",_t.getPositionF2CoordF3_InstanceTransform_F3_F3(),this._materialStrings.SHADER_SOURCE_LOOP_BLINN_INSTANCED_VERTEX,this._materialStrings.SHADER_SOURCE_LOOP_BLINN_FRAGMENT),this._imageMaterial=this._context.createMaterial("image",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_IMAGE_FRAGMENT),this._lerpImageMaterial=this._context.createMaterial("lerpImage",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_LERP_IMAGE_FRAGMENT),this._imageColorAdjustMaterial=this._context.createMaterial("imageColorAdjust",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT),this._lerpImageColorAdjustMaterial=this._context.createMaterial("lerpImageColorAdjust",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT),xc()&&(this._aaaShapeSolidColorMaterial=this._context.createMaterial("aaaShapeSolidColor",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT),this._aaaShapeGradientPaintMaterial=this._context.createMaterial("aaaShapeGradientPaint",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT),this._aaaShapeLerpGradientPaintMaterial=this._context.createMaterial("aaaShapeLerpGradientPaint",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT),this._aaaShapeImageMaterial=this._context.createMaterial("aaaShapeImage",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT),this._aaaShapeLerpImageMaterial=this._context.createMaterial("aaaShapeLerpImage",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT),this._aaaShapeImageColorAdjustMaterial=this._context.createMaterial("aaaShapeImageColorAdjust",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT),this._aaaShapeLerpImageColorAdjustMaterial=this._context.createMaterial("aaaShapeLerpImageColorAdjust",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT)),this._quadArea=this._bufferPool.allocateSmallManagedArea(It.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._shouldFlushAfterStencilCover=this._checkShouldFlushAfterStencilCover()}totalVRAM(){return this._gradientPool.totalVRAM()}clearGradientCache(){this._gradientDataCache=new Map,this._gradientPool=new wp}canSkipStencil(e,r,n){let o=n.paints;return n.rotation!=0&&o.length==1&&o[0].type()==="EMOJI"?!0:r.hasNoCurves?!!(r.hasNoOverlaps||e=="NONZERO"&&r.hasNoCurvesAndSameOrientation&&!Se.containsAtLeastOneNonOpaquePaint(o)):!1}currentBatchAA(){return this._batchAntialiasing}currentBatchScissor(){return this._currentBatchScissorBuilder.build()}includeBoundsInBatchScissor(e){this._currentBatchScissorBuilder.include3(e)}beginBatch(e){this._batchAntialiasing=new pe(e),this._batchAntialiasing.value===2&&this._delegate.pushSSAARenderState(null)}finishBatch(){var e,r;if(this._delegate.supersampleState().level==1&&this._delegate.supersampleState().mode==0&&((e=this._batchAntialiasing)==null?void 0:e.value)==2){let n=this.currentBatchScissor();this._delegate.currentTile().pushScissorRect(n)}this._currentBatchScissorBuilder.reset(),((r=this._batchAntialiasing)==null?void 0:r.value)==2&&this._delegate.popSSAARenderState(),this._batchAntialiasing=null}renderStencilQuad(e,r,n){let o=this._solidColorMaterial,i=X.new3(e).translatedBy1(r.topLeft()).scaledBy1(r.size());EP(o,this._materialStrings,i),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,o,this._quadArea,lt.KEEP,n),this._delegate.markDidDraw()}renderFill(e,r){if(r.geometry.paints.length==0)return;let n=r.geometry.type==1?r.geometry.path().bounds().size():r.paintSize,o=X.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(r.transform),i=this._delegate.currentTile(),a=i.tileSize(),s=X.new2().scaledBy2(a).multipliedBy1(e).multipliedBy1(r.transform),l=i.scissorsEmpty()?new x(0,0,a,a):i.scissor(),c=x.new3(r.geometry.path().bounds());if(s.transformRect(c),c.intersectWith(l),this.includeBoundsInBatchScissor(c),r.geometry.canBeAnalyticallyAntialiased()){this.renderAAAShape(o,r.geometry,n,a,lt.PREMULTIPLIED);return}let d=r.geometry.path().windingRule(),u=r.geometry.path().triangles(this._bufferPool,It.getPositionF2CoordF3()),p=!0;for(let _=0,h=u.length;_<h;_=_+1)if(!this.canSkipStencil(d,u[_],r.geometry)){p=!1;break}p?this.renderGeometryDirectly(o,r.geometry,n,a,lt.PREMULTIPLIED):(this.renderStencilGeometry(o,r.geometry,this.computeStates.get(d)),this.renderCoverQuad(o,r.geometry,r.geometry.path().bounds(),n,this.useStates.get(d),this.clearStates.get(d),a,lt.PREMULTIPLIED))}renderFillStroke(e,r){let n=this._delegate.currentTile(),o=n.tileSize(),i=X.new2().scaledBy2(o).multipliedBy1(e).multipliedBy1(r.transform),a=n.scissorsEmpty()?new x(0,0,o,o):n.scissor(),s=X.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(r.transform);for(let l=0,c=r.fillGeometries.length;l<c;l=l+1){let d=r.fillGeometries[l],u=d.path().bounds(),p=x.new3(u);i.transformRect(p),this.includeBoundsInBatchScissor(p.intersectedWith(a));let _=d.path().windingRule();this.renderStencilGeometry(s,d,this.computeStates.get(_)),this.renderCoverQuad(s,d,u,r.paintSize,this.useStates.get(_),this.setFillStates.get(_),o,lt.PREMULTIPLIED)}for(let l=0,c=r.strokeGeometries.length;l<c;l=l+1){let d=r.strokeGeometries[l],u=x.new3(d.path().bounds());i.transformRect(u),this.includeBoundsInBatchScissor(u.intersectedWith(a));let p=d.path().windingRule(),_=d.path().bounds();this.renderStencilGeometry(s,d,this.computeStates.get(p)),this.renderStencilQuad(s,_,this.setStrokeStates.get(p)),this.renderCoverQuad(s,d,_,r.paintSize,this.compoundUseStates.get(r.mode),this.compoundClearStates.get(r.mode),o,lt.PREMULTIPLIED)}if(r.strokeGeometries.length!=0){let l=ie.List_last(r.strokeGeometries).path().bounds(),c=ie.List_last(r.fillGeometries).path().bounds();l.contains1(c)||this.renderStencilQuad(s,c,this.compoundClearStates.get(r.mode))}}renderScatterBrushFill(e,r){let n=X.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(r.transform),o=this._delegate.currentTile(),i=o.tileSize(),a=X.new2().scaledBy2(i).multipliedBy1(e).multipliedBy1(r.transform),s=o.scissorsEmpty()?new x(0,0,i,i):o.scissor(),l=r.getAccumulatedFillGeometryPathBounds(),c=r.paintSize,d=this._context.supportsGpuInstancing()?"NATIVE":"PROXY",u={canvasToClipSpaceTransform:n,canvasToTileSpaceTransform:e,nodeTransform:r.transform,instanceBuffer:this._context.supportsGpuInstancing()?r.getInstanceBuffer(this._bufferPool):null,instanceTransforms:r.instanceTransforms,renderMode:d};for(let p=0;p<r.fillGeometries.length;p++){let _=r.fillGeometries[p];if(_.paints.length==0)continue;let h=l[p],A=x.new3(h);a.transformRect(A),A.intersectWith(s),this.includeBoundsInBatchScissor(A);let m=_.path().windingRule();this.renderStencilGeometryInstanced(u,_,this.computeStates.get(m)),this.renderCoverQuad(n,_,h,c,this.useStates.get(m),this.clearStates.get(m),i,lt.PREMULTIPLIED)}}uvTransformFromBounds(e,r){let n=X.new2();return n.scale4(1/r.x(),1/r.y()),n.translate1(e.topLeft()),n.scale3(e.size()),n}canSkipPaint(e,r,n,o){let i=n.asSinglePaint();if(i==null)return!1;if((i.type()=="GRADIENT_RADIAL"||i.type()=="GRADIENT_DIAMOND")&&i.lastStopIsTransparent()){let a=X.new3(i.transform());if(a.multiply(r),a.invert()){let s=ie.List_last(i.colorStops()).position*.5,l=new O(.5,.5),c=x.new4(l.subtractScalar(s),l.addScalar(s));return X.new3(e).translatedBy1(o.topLeft()).scaledBy1(o.size()).multipliedBy1(a).transformRect(c),!x.CLIP.overlaps(c)}}return!1}_findOrCreateGradientData(e){let r=Xt.IntMap_get(this._gradientDataCache,e.id(),null);return r==null&&(r=this._gradientPool.allocate(e),this._gradientDataCache.set(e.id(),r)),r}_setAaaShapeUniforms(e,r,n){if(e.setUniformVec21(this._materialStrings.SHADER_NAME_U_UV_SCALE,n.x(),n.y()),Oe.Material_setUniformVec22(e,this._materialStrings.SHADER_NAME_U_PATH_SIZE,r.bounds().size()),r instanceof cs){let o=r;e.setUniformInt(this._materialStrings.SHADER_NAME_U_SHAPE_TYPE,ff.ELLIPSE),Oe.Material_setUniformVec22(e,this._materialStrings.SHADER_NAME_U_ELLIPSE_CENTER,o.center.subtract(o.bounds().topLeft())),e.setUniformVec21(this._materialStrings.SHADER_NAME_U_ELLIPSE_RADII,o.xRadius,o.yRadius)}else if(r instanceof vt){let o=r;e.setUniformInt(this._materialStrings.SHADER_NAME_U_SHAPE_TYPE,ff.ROUNDED_RECT),Oe.Material_setUniformVec43(e,this._materialStrings.SHADER_NAME_U_RECT,r.bounds().translatedBy(r.bounds().topLeft())),e.setUniformVec41(this._materialStrings.SHADER_NAME_U_CORNER_RADII,Math.max(o.radii().topLeft,0),Math.max(o.radii().topRight,0),Math.max(o.radii().bottomRight,0),Math.max(o.radii().bottomLeft,0))}else throw new Error("Unxpected path type")}renderAAAShape(e,r,n,o,i){let a=r.paints,s=r.path().bounds(),l=e.clone(),c=l.invert(),d=2/o,u=l.scale1().x()*d,p=s.clone().expandedBy1(u),_=X.new3(e).translatedBy1(p.topLeft()).scaledBy1(p.size()),h=this.uvTransformFromBounds(s,n),A=new O(p.width()/s.width(),p.height()/s.height()),m=r.path().path();for(let g=0,S=a.length;g<S;g=g+1){let R=a[g];if(!this.canSkipPaint(e,h,R,s))if(R.type()=="SOLID"){let E=this._aaaShapeSolidColorMaterial;this._setAaaShapeUniforms(E,m,A),Oe.Material_setUniformMat32(E,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,_),Oe.Material_setUniformVec42(E,this._materialStrings.SHADER_NAME_U_COLOR,N.premultiplied(R.color())),E.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,R.opacity()),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,E,this._quadArea,i),this._delegate.markDidDraw()}else if(Ml.isGradient(R.type())){let E=X.new3(R.transform()).multipliedBy1(h),P,T=R.asVolatilePaint();if(T!=null){P=this._aaaShapeLerpGradientPaintMaterial;let f=this._findOrCreateGradientData(T.from()).texture(this._context),y=this._findOrCreateGradientData(T.to()).texture(this._context);f.setFormat(Me.RGBA_LINEAR_CLAMP),y.setFormat(Me.RGBA_LINEAR_CLAMP),P.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,f,0),P.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,y,1),P.setUniformFloat(this._materialStrings.SHADER_NAME_U_PROGRESS,T.t())}else{let f=R.asSinglePaint();P=this._aaaShapeGradientPaintMaterial;let y=this._findOrCreateGradientData(f).texture(this._context);y.setFormat(Me.RGBA_LINEAR_CLAMP),P.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,y,0)}this._setAaaShapeUniforms(P,m,A),Oe.Material_setUniformMat32(P,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,_),Oe.Material_setUniformMat32(P,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,E),P.setUniformInt(this._materialStrings.SHADER_NAME_U_TYPE,gT.get(R.type())),P.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,R.opacity()),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,P,this._quadArea,i),this._delegate.markDidDraw()}else if(R.type()=="IMAGE"||R.type()=="VIDEO"){let E=X.new3(h).scaledBy3(1/s.size().x(),1/s.size().y()),P=!0,T=R.asVolatilePaint();if(T!=null){let f=this.getImageToDraw(T.from(),n,e,E,T.from().imageScaleMode(),o);if(f!=null){let y=X.new2(),v;if(T.from().image()==T.to().image()&&!(T.from().imageScaleMode()=="TILE"||T.to().imageScaleMode()=="TILE"))v=this._aaaShapeImageMaterial,T.colorAdjustIsActive()&&(v=this._aaaShapeImageColorAdjustMaterial,T.colorAdjustSetData(v)),y=this.allocateObjectSpaceToNormalizedImageSpaceTransform(T,n,h);else{v=this._aaaShapeLerpImageMaterial,T.colorAdjustIsActive()&&(v=this._aaaShapeLerpImageColorAdjustMaterial,T.colorAdjustSetData(v)),y=this.allocateObjectSpaceToNormalizedImageSpaceTransform(T.from(),n,h);let I=this.getImageToDraw(T.to(),n,e,E,T.to().imageScaleMode(),o);if(I==null)P=!1;else{let C=this.getOrCreateVideoTexture(T.to());C==null&&(C=this._delegate.getOrCreateImageTexture(I));let L=this.allocateObjectSpaceToNormalizedImageSpaceTransform(T.to(),n,h);Oe.Material_setUniformMat32(v,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM1,L),C!=null&&!I.image.isCompressedTexture()&&C.setFormat(Me.RGBA_NEAREST_CLAMP),C!=null&&v.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,C,1),v.setUniformFloat(this._materialStrings.SHADER_NAME_U_PROGRESS,xt.double_clamp(T.t(),0,1))}}v.setUniformFloat(this._materialStrings.SHADER_NAME_U_PIXEL_RATIO,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale());let w=this.getOrCreateVideoTexture(T.from());w==null&&(w=this._delegate.getOrCreateImageTexture(f)),P&&w!=null&&(w!=null&&!f.image.isCompressedTexture()&&w.setFormat(Me.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(R,v),Oe.Material_setUniformMat32(v,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,_),Oe.Material_setUniformMat32(v,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,y),v.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,T.opacity()),v.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,w,0),this._setAaaShapeUniforms(v,m,A),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,v,this._quadArea,i),this._delegate.markDidDraw())}}else{let f=R.asSinglePaint(),y=null,v=!1;if(y=this.getOrCreateVideoTexture(f),y==null){let w=this.getImageToDraw(f,n,e,E,f.imageScaleMode(),o);w!=null&&(y=this._delegate.getOrCreateImageTexture(w),v=w.image.isCompressedTexture())}if(y!=null){let w=this._aaaShapeImageMaterial;f.colorAdjustIsActive()&&(w=this._aaaShapeImageColorAdjustMaterial,f.colorAdjustSetData(w));let I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(f,n,h);v||y.setFormat(Me.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(R,w),Oe.Material_setUniformMat32(w,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,_),Oe.Material_setUniformMat32(w,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,I),w.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,f.opacity()),w.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,y,0),w.setUniformFloat(this._materialStrings.SHADER_NAME_U_PIXEL_RATIO,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale()),this._setAaaShapeUniforms(w,m,A),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,w,this._quadArea,i),this._delegate.markDidDraw()}}}else R.type()=="EMOJI"&&we("Emoji should always be rendered by renderGeometryDirectly")}}renderGeometryDirectly(e,r,n,o,i){let a=r.path().triangles(this._bufferPool,It.getPositionF2CoordF3()),s=r.paints,l=r.path().bounds(),c=this.uvTransformFromBounds(l,n),d;for(let u=0,p=s.length;u<p;u=u+1){let _=s[u];if(!this.canSkipPaint(e,c,_,l))switch(_.type()){case"SOLID":{d=this._solidColorMaterial,vd(d,this._materialStrings,e,N.premultiplied(_.color()),_.opacity());for(let h=0,A=a.length;h<A;h=h+1)a[h].bufferArea!=null&&(this._delegate.drawToCurrentTile(qe.TRIANGLES,d,a[h].bufferArea,i),this._delegate.markDidDraw());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let h=X.new3(_.transform()).scaledBy3(1/n.x(),1/n.y()),A=_.asVolatilePaint();if(A!=null){d=this._lerpGradientPaintMaterial;let m=this._findOrCreateGradientData(A.from()).texture(this._context),g=this._findOrCreateGradientData(A.to()).texture(this._context);m.setFormat(Me.RGBA_LINEAR_CLAMP),g.setFormat(Me.RGBA_LINEAR_CLAMP),d.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,m,0),d.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,g,1),d.setUniformFloat(this._materialStrings.SHADER_NAME_U_PROGRESS,A.t())}else{let m=_.asSinglePaint();d=this._gradientPaintMaterial;let g=this._findOrCreateGradientData(m).texture(this._context);g.setFormat(Me.RGBA_LINEAR_CLAMP),d.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,g,0)}Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,e),Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,h),d.setUniformInt(this._materialStrings.SHADER_NAME_U_TYPE,gT.get(_.type())),d.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,_.opacity());for(let m=0,g=a.length;m<g;m=m+1)a[m].bufferArea!=null&&(this._delegate.drawToCurrentTile(qe.TRIANGLES,d,a[m].bufferArea,i),this._delegate.markDidDraw());break}case"IMAGE":case"VIDEO":{let h=X.new2().scaledBy3(1/n.x(),1/n.y()),A=_.asVolatilePaint();if(A!=null){let m=this.getImageToDraw(A.from(),n,e,h,A.from().imageScaleMode(),o);if(m!=null){let g=X.new2(),S=!0;if(A.from().image()==A.to().image()&&!(A.from().imageScaleMode()=="TILE"||A.to().imageScaleMode()=="TILE"))d=this._imageMaterial,A.colorAdjustIsActive()&&(d=this._imageColorAdjustMaterial,A.colorAdjustSetData(d)),g=this.allocateObjectSpaceToNormalizedImageSpaceTransform(A,n,h);else{let E=this.getImageToDraw(A.to(),n,e,h,A.to().imageScaleMode(),o);if(E==null)S=!1;else{d=this._lerpImageMaterial,A.colorAdjustIsActive()&&(d=this._lerpImageColorAdjustMaterial,A.colorAdjustSetData(d)),g=this.allocateObjectSpaceToNormalizedImageSpaceTransform(A.from(),n,h);let P=this._delegate.getOrCreateImageTexture(E),T=this.allocateObjectSpaceToNormalizedImageSpaceTransform(A.to(),n,h);Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM1,T),P!=null&&(this._setupClampingForImageOrGIF(E.image,P),d.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,P,1)),d.setUniformFloat(this._materialStrings.SHADER_NAME_U_PROGRESS,xt.double_clamp(A.t(),0,1))}}let R=this._delegate.getOrCreateImageTexture(m);if(S&&R!=null){Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,e),Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,g),d.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,A.opacity()),this._setupRepeatingForImage(_,d),this._setupClampingForImageOrGIF(m.image,R),d.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,R,0);for(let E=0,P=a.length;E<P;E=E+1)a[E].bufferArea!=null&&(this._delegate.drawToCurrentTile(qe.TRIANGLES,d,a[E].bufferArea,i),this._delegate.markDidDraw())}}}else{let m=_.asSinglePaint(),g=null;if(g=this.getOrCreateVideoTexture(m),g==null){let S=this.getImageToDraw(m,n,e,h,m.imageScaleMode(),o);S!=null&&(g=this._delegate.getOrCreateImageTexture(S),g!=null&&this._setupClampingForImageOrGIF(S.image,g))}if(g!=null){let S=this.allocateObjectSpaceToNormalizedImageSpaceTransform(m,n,h);d=this._imageMaterial,m.colorAdjustIsActive()&&(d=this._imageColorAdjustMaterial,m.colorAdjustSetData(d)),Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,e),Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,S),d.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,m.opacity()),this._setupRepeatingForImage(_,d),d.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,g,0);for(let R=0,E=a.length;R<E;R=R+1)a[R].bufferArea!=null&&(this._delegate.drawToCurrentTile(qe.TRIANGLES,d,a[R].bufferArea,i),this._delegate.markDidDraw())}}break}case"EMOJI":{let h=_.asSinglePaint();if(h==null)continue;let A=this._delegate.getOrCreateImageTexture(new Ra(h.image(),2));if(h.decodedImageIsReady()||(A=null),A!=null){let m=A;d=this._imageMaterial;let g=l.size(),S=l.topLeft(),R=l.center(),E=X.new2();r.rotation!=null&&r.rotation!=0&&r.unrotatedGlyphSize!=null&&(g=new O(r.unrotatedGlyphSize.x(),r.unrotatedGlyphSize.y()),S=R.subtract(g.divideScalar(2)),E=E.translatedBy1(R).rotatedBy(r.rotation).translatedBy2(-R.x(),-R.y()));let P=new O(1,1).divide(g),T=X.new2().scaledBy3(P.x(),P.y()).translatedBy2(-S.x(),-S.y()).multipliedBy1(E);Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,e),Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,T),d.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,h.opacity()),d.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,m,0),m!=null&&m.setFormat(Me.RGBA_NEAREST_CLAMP);for(let f=0,y=a.length;f<y;f=f+1)a[f].bufferArea!=null&&(this._delegate.drawToCurrentTile(qe.TRIANGLES,d,a[f].bufferArea,i),this._delegate.markDidDraw())}break}case"PATTERN":{d=this._solidColorMaterial,vd(d,this._materialStrings,e,N.WHITE,0);for(let h=0,A=a.length;h<A;h=h+1)a[h].bufferArea!=null&&(this._delegate.drawToCurrentTile(qe.TRIANGLES,d,a[h].bufferArea,i),this._delegate.markDidDraw());break}}}}_setupRepeatingForImage(e,r){let n=!1,o=e.asVolatilePaint();o!=null?o.eitherPaint(i=>i.imageScaleMode()=="TILE")&&(n=!0):e.asSinglePaint()!=null&&(n=e.asSinglePaint().imageScaleMode()=="TILE"),r.setUniformInt(this._materialStrings.SHADER_NAME_U_EMULATE_WRAP_ADDRESS,n?1:0),r.setUniformInt(this._materialStrings.SHADER_NAME_U_EMULATE_BORDER_ADDRESS,n?0:1)}_setupClampingForImageOrGIF(e,r){e.isGIF()?r.setFormat(Me.RGBA_LINEAR_CLAMP):e.isCompressedTexture()||r.setFormat(Me.RGBA_NEAREST_CLAMP)}renderStencilGeometry(e,r,n){let o=r.path().triangles(this._bufferPool,It.getPositionF2CoordF3()),i=this._stencilMaterial;Oe.Material_setUniformMat32(i,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,e);for(let a=0,s=o.length;a<s;a=a+1)o[a].bufferArea!=null&&(this._delegate.drawToCurrentTile(qe.TRIANGLES,i,o[a].bufferArea,lt.KEEP,n),this._delegate.markDidDraw())}renderStencilGeometryInstanced(e,r,n){let o=!1,i=r.path().triangles(this._bufferPool,It.getPositionF2CoordF3());if(e.instanceBuffer){let a=this._stencilMaterialInstanced;Oe.Material_setUniformMat32(a,Lr.instance().SHADER_NAME_CANVAS_SPACE_TO_CLIP_SPACE_TRANSFORM,e.canvasToClipSpaceTransform);for(let s=0,l=i.length;s<l;s=s+1)i[s].bufferArea!=null&&(this._delegate.drawToCurrentTile(qe.TRIANGLES,a,i[s].bufferArea,lt.KEEP,n,e.instanceBuffer),o=!0)}else{let a=e.instanceTransforms.length,s=this._stencilMaterial,l=this._delegate.currentTile(),c=l.tileSize(),d=l.scissorsEmpty()?this._delegate.defaultTileScissor():x.new3(l.scissor()),u=X.new2().scaledBy2(c).multipliedBy1(e.canvasToTileSpaceTransform).multipliedBy1(e.nodeTransform),p=x.new3(r.path().bounds());for(let _=0;_<a;_++){let h=e.instanceTransforms[_],m=u.clone().multipliedBy1(h).transformRect(p.clone());if(!d.overlaps(m))continue;let S=e.canvasToClipSpaceTransform.clone().multipliedBy1(h);Oe.Material_setUniformMat32(s,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,S);for(let R=0,E=i.length;R<E;R=R+1)i[R].bufferArea!=null&&(this._delegate.drawToCurrentTile(qe.TRIANGLES,s,i[R].bufferArea,lt.KEEP,n),o=!0)}}o&&this._delegate.markDidDraw()}_checkShouldFlushAfterStencilCover(){return!!K.shouldFlushAfterStencilCover()}renderCoverQuad(e,r,n,o,i,a,s,l){let c=r.paints;if(c.length==0){this.renderStencilQuad(e,n,a),this._shouldFlushAfterStencilCover&&this._context.flush();return}let d=X.new3(e).translatedBy1(n.topLeft()).scaledBy1(n.size()),u=this.uvTransformFromBounds(n,o),p;for(let _=0,h=c.length;_<h;_=_+1){let A=c[_],m=_+1==h;if(!m&&this.canSkipPaint(e,u,A,n))continue;let g=m?a:i;switch(A.type()){case"SOLID":{p=this._solidColorMaterial,vd(p,this._materialStrings,d,N.premultiplied(A.color()),A.opacity()),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,p,this._quadArea,l,g),this._delegate.markDidDraw();break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let S=X.new3(A.transform()).multipliedBy1(u),R=A.asVolatilePaint();if(R!=null){p=this._lerpGradientPaintMaterial;let E=this._findOrCreateGradientData(R.from()).texture(this._context),P=this._findOrCreateGradientData(R.to()).texture(this._context);E.setFormat(Me.RGBA_LINEAR_CLAMP),P.setFormat(Me.RGBA_LINEAR_CLAMP),p.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,E,0),p.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,P,1),p.setUniformFloat(this._materialStrings.SHADER_NAME_U_PROGRESS,R.t())}else{let E=A.asSinglePaint();p=this._gradientPaintMaterial;let P=this._findOrCreateGradientData(E).texture(this._context);P.setFormat(Me.RGBA_LINEAR_CLAMP),p.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,P,0)}Oe.Material_setUniformMat32(p,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,d),Oe.Material_setUniformMat32(p,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,S),p.setUniformInt(this._materialStrings.SHADER_NAME_U_TYPE,gT.get(A.type())),p.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,A.opacity()),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,p,this._quadArea,l,g),this._delegate.markDidDraw();break}case"IMAGE":case"VIDEO":{let S=X.new3(u).scaledBy3(1/n.size().x(),1/n.size().y()),R=!0,E=!1,P=A.asVolatilePaint();if(P!=null){let T=this.getImageToDraw(P.from(),o,e,S,P.from().imageScaleMode(),s);if(T!=null){let f=X.new2();if(P.from().image()==P.to().image()&&!(P.from().imageScaleMode()=="TILE"||P.to().imageScaleMode()=="TILE"))p=this._imageMaterial,P.colorAdjustIsActive()&&(p=this._imageColorAdjustMaterial,P.colorAdjustSetData(p)),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(P,o,u);else{p=this._lerpImageMaterial,P.colorAdjustIsActive()&&(p=this._lerpImageColorAdjustMaterial,P.colorAdjustSetData(p)),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(P.from(),o,u);let v=this.getImageToDraw(P.to(),o,e,S,P.to().imageScaleMode(),s);if(v==null)R=!1;else{let w=this._delegate.getOrCreateImageTexture(v),I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(P.to(),o,u);Oe.Material_setUniformMat32(p,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM1,I),w!=null&&w.setFormat(Me.RGBA_NEAREST_CLAMP),w!=null&&p.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,w,1),p.setUniformFloat(this._materialStrings.SHADER_NAME_U_PROGRESS,xt.double_clamp(P.t(),0,1))}}let y=this._delegate.getOrCreateImageTexture(T);R&&y!=null&&(y!=null&&y.setFormat(Me.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(A,p),Oe.Material_setUniformMat32(p,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,d),Oe.Material_setUniformMat32(p,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,f),p.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,P.opacity()),p.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,y,0),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,p,this._quadArea,l,g),this._delegate.markDidDraw(),E=!0)}}else{let T=A.asSinglePaint(),f=null,y=!1;if(f=this.getOrCreateVideoTexture(T),f==null){let v=this.getImageToDraw(T,o,e,S,T.imageScaleMode(),s);v!=null&&(f=this._delegate.getOrCreateImageTexture(v),y=v.image.isCompressedTexture())}if(f!=null){p=this._imageMaterial,T.colorAdjustIsActive()&&(p=this._imageColorAdjustMaterial,T.colorAdjustSetData(p));let v=this.allocateObjectSpaceToNormalizedImageSpaceTransform(T,o,u);y||f.setFormat(Me.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(A,p),Oe.Material_setUniformMat32(p,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,d),Oe.Material_setUniformMat32(p,this._materialStrings.SHADER_NAME_U_PAINT_TRANSFORM0,v),p.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,T.opacity()),p.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,f,0),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,p,this._quadArea,l,g),this._delegate.markDidDraw(),E=!0}}m&&!E&&(vd(this._solidColorMaterial,this._materialStrings,d,N.TRANSPARENT,0),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,this._solidColorMaterial,this._quadArea,l,g),this._delegate.markDidDraw());break}case"EMOJI":{we("Emoji should always be rendered by renderGeometryDirectly");break}case"PATTERN":{p=this._solidColorMaterial,vd(p,this._materialStrings,d,N.WHITE,0),this._delegate.drawToCurrentTile(qe.TRIANGLE_STRIP,p,this._quadArea,l,g),this._delegate.markDidDraw();break}}}this._shouldFlushAfterStencilCover&&this._context.flush()}allocateObjectSpaceToNormalizedImageSpaceTransform(e,r,n){let o=e.allocateImageTransformForGeometrySize(r);return X.new2().multipliedBy1(o).multipliedBy1(n)}getImageToDraw(e,r,n,o,i,a){if(e.image()==null&&e.imageThumbnail()==null)return null;e.imageThumbnail()!=null&&this._delegate.getOrCreateImageTexture(new Ra(e.imageThumbnail(),1)),e.image()!=null&&e.image().isGIF()&&this._delegate.getOrCreateImageTexture(new Ra(e.image(),0));let s=e.decodedImageThumbnailIsReady()?e.decodedImageThumbnail():null,l=!1;if(e.imageThumbnail()==null)l=!0;else if(s!=null){let c=this.allocateObjectSpaceToNormalizedImageSpaceTransform(e,r,o),d=X.new3(c);d.invert();let u=X.new2().scaledBy2(a).multipliedBy1(n).multipliedBy1(d).scaledBy3(1/s.width(),1/s.height()),p=u.axisX().length(),_=u.axisY().length();l=Math.max(_,p)>1||e.image()!=null&&e.image().isGIF(),i=="TILE"&&(l=!0)}if(l&&(this._delegate.getOrCreateImageTexture(new Ra(e.image(),0)),e.decodedImageIsReady())){let c=e.decodedImage();if(c!=null)return new Ra(c,0)}if(s!=null)return new Ra(s,1);if(e.decodedImageIsReady()){let c=e.decodedImage();if(c!=null)return new Ra(c,0)}return null}getOrCreateVideoTexture(e){var r;return(r=e==null?void 0:e.video())==null?void 0:r.getOrCreateTexture(e,this._context,Me.RGBA_NEAREST_CLAMP)}},ff;(r=>(r.ELLIPSE=0,r.ROUNDED_RECT=1))(ff||(ff={}));var gf=class{activate(e){this.reset(),this._isEnabled=!0,this._invalidateFn=e}deactivate(){var e;this.isEnabled()&&((e=this._invalidateFn)==null||e.call(this),this.reset())}isEnabled(){return this._isEnabled}reset(){this._isPlaying=!1,this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._framesUntilUpdate=this._frameDelay,this._filteredTree=null,this._invalidateFn=null,this._frameDelay=this._defaultFrameDelay}play(){var e;this.isEnabled()&&(this._isPlaying=!0,(e=this._invalidateFn)==null||e.call(this))}pause(){this.isEnabled()&&(this._isPlaying=!1)}forward(){var e;this.isEnabled()&&(this._maxLayersToRender=Math.min(this._maxLayersToRender+1,this._totalLayersInRenderTree),(e=this._invalidateFn)==null||e.call(this))}backward(){var e;this.isEnabled()&&(this._maxLayersToRender=Math.max(this._maxLayersToRender-1,1),(e=this._invalidateFn)==null||e.call(this))}rewind(){var e;this.isEnabled()&&(this._maxLayersToRender=1,(e=this._invalidateFn)==null||e.call(this))}increaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.max(this._minFrameDelay,this._frameDelay-5))}decreaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.min(this._maxFrameDelay,this._frameDelay+5))}finishLayerByLayerDrawToScreen(){var e;this.isEnabled()&&this._isPlaying&&(this._maxLayersToRender>=this._totalLayersInRenderTree||((e=this._invalidateFn)==null||e.call(this),this._framesUntilUpdate=this._framesUntilUpdate-1,this._framesUntilUpdate<=0&&(this._maxLayersToRender=this._maxLayersToRender+1,this._framesUntilUpdate=this._frameDelay)))}_filterCompositeTileGridNodes(e){if(e==null)return null;switch(e.op()){case 0:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new ds(n,r.flags):null}case 2:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new ni(n):null}case 1:{let r=e,n=[];for(let o=0,i=r.children.length;o<i;o=o+1){let a=this._filterCompositeTileGridNodes(r.children[o]);a&&n.push(a)}return new Ue(n,r.isFirstChildSolidBackground())}case 3:case 4:case 16:return e;case 5:{let r=e,n=this._filterCompositeTileGridNodes(r.alpha),o=this._filterCompositeTileGridNodes(r.color);return n!=null&&o!=null?new tn(n,o,r.type,r.innerShadowFill,r.innerShadowAlphaRequiresHardMask):null}case 6:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new fo(r.blurOpType,r.startRadius,r.endRadius,r.startPoint,r.endPoint,n,r.clamp):null}case 7:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new go(r.blendMode,r.opacity,n):null}case 9:{let r=e,n=this._filterCompositeTileGridNodes(r.alpha);return n!=null?new oi(n,r.color):null}case 8:{let r=e;return this._filterCompositeTileGridNodes(r.tree)}case 10:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new gt(n,r.id,r.property,r.getter):null}case 11:{let r=e,n=this._filterCompositeTileGridNodes(r.child);return n!=null?new So(n,r.transform):null}case 12:{let r=e,n=r.startChild?this._filterCompositeTileGridNodes(r.startChild):null,o=r.endChild?this._filterCompositeTileGridNodes(r.endChild):null;return new Nn(n,o,r.id,r.progressFn)}default:throw new Error(`Unhandled node op ${Yn[e.op()]}`)}return null}_renderTreeWithNLayers(e,r){let n=(a,s)=>new ho(a,s);if(r<=0)return n(null,0);let o=[];switch(e.op()){case 0:{let a=e;o.push(a.child);break}case 2:{let a=e;o.push(a.child);break}case 1:{let a=e;for(let s=0,l=a.children.length;s<l;s=s+1){let c=a.children[s];o.push(c)}break}case 3:case 4:case 16:return n(e,r-1);case 5:{let a=e;o.push(a.color),o.push(a.alpha);break}case 6:{let a=e;o.push(a.child);break}case 7:{let a=e;o.push(a.child);break}case 9:{let a=e;o.push(a.alpha);break}case 8:{let a=e;o.push(a.tree);break}case 10:{let a=e;o.push(a.child);break}case 11:{let a=e;o.push(a.child);break}case 12:{let a=e;a.startChild&&o.push(a.startChild),a.endChild&&o.push(a.endChild);break}default:throw new Error(`Unhandled node op ${Yn[e.op()]}`)}let i=[];for(let a=0,s=o.length;a<s;a=a+1){let l=o[a],c=this._renderTreeWithNLayers(l,r);if(r=c.b,c.a!=null&&i.push(c.a),r<=0)return n(new Ue(i).optimized(),0)}return this._isRenderableLayer(e)?r>0?n(e,r-1):n(new Ue(i).optimized(),0):n(e,r)}_isRenderableLayer(e){switch(e.op()){case 8:case 1:case 0:return!1}return!0}_countLayers(e){let r=0;switch(e.op()){case 0:{let n=e;r=r+this._countLayers(n.child);break}case 2:{let n=e;r=r+this._countLayers(n.child);break}case 1:{let n=e;for(let o=0,i=n.children.length;o<i;o=o+1){let a=n.children[o];r=r+this._countLayers(a)}break}case 3:case 4:case 16:break;case 5:{let n=e;r=r+this._countLayers(n.alpha),r=r+this._countLayers(n.color);break}case 6:{let n=e;r=r+this._countLayers(n.child);break}case 7:{let n=e;r=r+this._countLayers(n.child);break}case 9:{let n=e;r=r+this._countLayers(n.alpha);break}case 8:{let n=e;r=r+this._countLayers(n.tree);break}case 10:{let n=e;r=r+this._countLayers(n.child);break}case 11:{let n=e;r=r+this._countLayers(n.child);break}case 12:{let n=e;n.startChild&&(r=r+this._countLayers(n.startChild)),n.endChild&&(r=r+this._countLayers(n.endChild));break}default:throw new Error(`Unhandled node op ${Yn[e.op()]}`)}return this._isRenderableLayer(e)&&(r=r+1),r}treeToRender(e){let r=e;if(!this.isEnabled())return r;r!=this._originalTree&&(this._totalLayersInRenderTree=this._countLayers(r),this._filteredTree=this._filterCompositeTileGridNodes(r),this._originalTree=r);let n=this._filteredTree!=null?this._renderTreeWithNLayers(this._filteredTree,this._maxLayersToRender).a:null;return n!=this._lastTreeToRender&&console.log(`LayerByLayerRendering: rendering ${this._maxLayersToRender} instructions out of ${this._totalLayersInRenderTree}
`+(n==null?void 0:n.debugString1())),this._lastTreeToRender=n,n}constructor(){this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._maxFrameDelay=60,this._defaultFrameDelay=45,this._minFrameDelay=5,this._frameDelay=60,this._framesUntilUpdate=0,this._filteredTree=null,this._originalTree=null,this._invalidateFn=null,this._isPlaying=!1,this._lastTreeToRender=null}};var nl;(o=>{function t(i){return i.length==0}o.isEmpty=t;function e(i,a){return i[a]}o.get=e;function r(i){return ie.List_last(i)}o.last=r;function n(i){return i.length}o.count=n})(nl||(nl={}));var xp=class{constructor(e){this._scissorStack=[],this._framebuffer=e}pushScissor(e,r,n,o){let i=new x(e,r,n,o);this.pushScissorRect(i)}pushScissorRect(e){this._scissorStack.length!=0&&e.intersectWith(ie.List_last(this._scissorStack)),this._scissorStack.push(e)}popScissor(){ie.List_removeLast(this._scissorStack)}takeScissor(){return this._scissorStack.pop()??null}scissors(){return this._scissorStack}clearScissors(){this._scissorStack.length=0}activeScissor(){return this._scissorStack.length==0?null:ie.List_last(this._scissorStack)}};var mB=1e-4;var Lp;(o=>{function t(){return new Map}o._new=t;function e(i,a){i.set(a.hash(),a)}o.add=e;function r(i){let a=i;return Array.from(a.values())}o.asList=r;function n(i,a){let s=a,l=i;Qe.StringMap_each(s,(c,d)=>{l.set(c,d)})}o.addAllImagesInSet=n})(Lp||(Lp={}));var Sf=class{constructor(e,r,n){this.includesBackgroundColor=e,this.status=r,this.neededImagesOrNull=n}},ol=class t{constructor(e,r,n){this._frameBudgetInformation=null;this._interruptedCommands=new Array;this._interruptArgs=null;this._cleanUpInterruptCallback=null;this._currentlyInDissolveCounter=0;this._currentlyInVolatilePropertyCounter=0;this._currentlyInPatternFillCounter=0;this._canvasToPixelsScale=1;this._canvas=null,this._backgroundEnabled=!0,this._didDraw=!1,this._includesBackgroundColor=!1,this._boundsCache=null,this._canvasSpaceTileBounds=x.INVALID,this._neededImagesOrNull=null,this._ssaaState=new ST,this._downsampleNeedsBlend=!1,this._shouldDisableAllAntialiasing=!1,this._requestImage=null,this._layerByLayerRendering=new gf,this._context=e,this._bufferPool=r,this._materialStrings=Lr.instance(),this._quadArea=this._bufferPool.allocateSmallManagedArea(It.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._transparentClearTexture=e.createTextureWithPixels(Me.RGBA_LINEAR_CLAMP,1,1,new Uint8Array([0,0,0,0]),br.SINGLE_PIXEL_TEXTURE),this._tileConfig=n,this._tileStack=new t.TileStack(e,this._transparentClearTexture,this._tileConfig),this._pathRasterizer=new mf(this,this._context,this._tileConfig,this._bufferPool);let o=this._context.graphicsCardName();Re.setFlushBeforeMasks((o.indexOf("NVIDIA")!=-1&&o.indexOf("Direct3D11")!=-1||K.getFeatureFlags().flush_before_masks)??!1),this._noiseMaterial=this._context.createMaterial("noise",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_NOISE_EFFECT_FRAGMENT),this._glassMaterial=this._context.createMaterial("glass",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_GLASS_FRAGMENT),this._clampedBlurMaterial=this._context.createMaterial("clampedBlur",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT),this._unclampedBlurMaterial=this._context.createMaterial("unclampedBlur",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT),this._unclampedGrainMaterial=this._context.createMaterial("unclampedGrain",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UNCLAMPED_GRAIN_FRAGMENT),this._clampedGrainMaterial=this._context.createMaterial("clampedGrain",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_CLAMPED_GRAIN_FRAGMENT),this._clampedGradientBlurMaterial=this._context.createMaterial("clampedGradientBlur",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_CLAMPED_GRADIENT_BLUR_TILE_FRAGMENT),this._unclampedGradientBlurMaterial=this._context.createMaterial("unclampedGradientBlur",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UNCLAMPED_GRADIENT_BLUR_TILE_FRAGMENT),this._upscaleAndBlendGradientBlurTileMaterial=this._context.createMaterial("upscaleAndBlendGradientBlurTile",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_GRADIENT_BLUR_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UPSAMPLE_AND_BLEND_GRADIENT_BLUR_TILE_FRAGMENT),this._rectangleBlurMaterial=this._context.createMaterial("rectangleBlur",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_RECTANGLE_BLUR_VERTEX,this._materialStrings.SHADER_SOURCE_RECTANGLE_BLUR_FRAGMENT),this._roundedRectangleBlurMaterial=this._context.createMaterial("roundedRectangleBlur",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX,this._materialStrings.SHADER_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT),this._upscaleTileMaterial=this._context.createMaterial("upscaleTile",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_UPSAMPLE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_UPSAMPLE_TILE_FRAGMENT),this._downscaleTileMaterial=this._context.createMaterial("downscaleTile",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_DOWNSAMPLE_TILE_FRAGMENT),this._hardMaskWithColorAndDownscaleTileMaterial=this._context.createMaterial("hardMaskWithColorAndDownscaleTile",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT),this._blendTextureMaterial=this._context.createMaterial("blendTexture",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.SHADER_SOURCE_BLEND_TEXTURE_FRAGMENT),this._lerpTileMaterial=this._context.createMaterial("lerpTexture",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.SHADER_SOURCE_LERP_TILE_FRAGMENT),this._blendTileSimpleMaterial=this._context.createMaterial("blendTileSimple",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_BLEND_TEXTURE_FRAGMENT),this._blendTileCustomMaterial=this._context.createMaterial("blendTileCustom",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_BLEND_MODE_FRAGMENT),this._maskInnerShadowTileMaterial=this._context.createMaterial("maskInnerShadowTile",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT),this._maskInnerShadowTileAndFirstHardMaskAlpha=this._context.createMaterial("maskInnerShadowTileAndFirstHardMaskAlpha",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT),this._maskBackgroundBlurTileMaterial=this._context.createMaterial("maskBackgroundBlurTile",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT),this._maskTileMaterial=this._context.createMaterial("maskTile",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_TILE_FRAGMENT),this._maskTileLuminanceMaterial=this._context.createMaterial("maskTileLuminance",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT),this._maskTileLuminancePassThroughMaterial=this._context.createMaterial("maskTileLuminancePassThrough",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT),this._maskTilePassThroughMaterial=this._context.createMaterial("maskTilePassThrough",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT),this._maskKnockoutShadowTileMaterial=this._context.createMaterial("maskKnockoutShadowTile",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT),this._maskKnockoutShadowTilePassThroughMaterial=this._context.createMaterial("maskKnockoutShadowTile",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT),this._hardMaskTileWithColorMaterial=this._context.createMaterial("hardMaskWithColor",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_TILE_VERTEX,this._materialStrings.SHADER_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT),this._drawTextureMaterial=this._context.createMaterial("drawTexture",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_DRAW_TEXTURE_VERTEX,this._materialStrings.SHADER_SOURCE_DRAW_TEXTURE_FRAGMENT),this._superSSAA4x4DownsampleMaterial=this._context.createMaterial("superSSAA4x4Downsample",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.SHADER_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT),this._imagePatternMaterial=this._context.createMaterial("imagePattern",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.SHADER_SOURCE_IMAGE_PATTERN_FRAGMENT),this._imagePatternSingleMaterial=this._context.createMaterial("imagePatternSingle",_t.getPositionF2CoordF3(),this._materialStrings.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_VERTEX,this._materialStrings.SHADER_SOURCE_IMAGE_PATTERN_SINGLE_FRAGMENT)}context(){return this._context}bufferPool(){return this._bufferPool}resetTileStackUsage(){this._tileStack.resetUsedTiles()}reclaimTileStack(){this._tileStack.reclaim()}totalVRAM(){let e=0;return e=e+this._pathRasterizer.totalVRAM(),e=e+this._tileStack.totalVRAM(),e}debugString(){return`RTRenderer(vram: path=${this._pathRasterizer.totalVRAM()}, tileStack=${this._tileStack.totalVRAM()}; tileStack: ${this._tileStack.debugString()})`}upscaleRectForSSAA(e){let r=this._tileConfig.SSAA_SIZE()/this._tileConfig.baseTileSize|0;return e.scaledBy1(r)}downscaleRectForSSAA(e){let r=this._tileConfig.baseTileSize/this._tileConfig.SSAA_SIZE();return e.scaledBy1(r)}setBackgroundEnabled(e){this._backgroundEnabled=e}currentTextureSize(){var e;return((e=this._currentTile1())==null?void 0:e.tileSize())??0}defaultTileScissor(){return this._tileStack.defaultTileScissor()}markDidDraw(){this._didDraw=!0}pushSSAARenderState(e){if(this._shouldDisableAllAntialiasing){we("Pushing SSAA state during final composite");return}if(this._ssaaState.level==0){this._tileStack.setSSAARenderState(),this._ssaaState.mode=e==null?0:1;let r;this._tileStack.isEmpty()?r=this._tileStack.defaultTileScissor():r=this.upscaleRectForSSAA(this._currentTile1().scissor().clone()),e!=null&&this._needsBackgroundColor(e)?(this.duplicateTile1(r),this._downsampleNeedsBlend=!0):(this._downsampleNeedsBlend=!1,this._tileStack.pushTile(r))}this._ssaaState!=null&&(this._ssaaState.level+=1)}popSSAARenderState(){if(this._shouldDisableAllAntialiasing){we("Popping SSAA state during final composite");return}if(this._ssaaState!=null&&(this._ssaaState.level-=1),this._ssaaState.level==0){let e=this._tileStack.popTile();this._tileStack.unsetSSAARenderState();let r;this._downsampleNeedsBlend?r=lt.COPY:r=lt.PREMULTIPLIED,this.downsampleSuperSSAATile(e,r),this._tileStack.freeTileToPool(e)}}supersampleState(){return this._ssaaState}currentTile(e){return e===void 0?this._currentTile1():this._currentTile2(e)}computeTileTransform(){return X.new2().scaledBy2(1/this._canvasSpaceTileBounds.size().x()).translatedBy1(new O(-this._canvasSpaceTileBounds.x(),-this._canvasSpaceTileBounds.y()))}canvasSpaceToViewSpaceScale(){return this._tileSize/this._canvasSpaceTileBounds.size().x()}drawTileContinued(e,r,n,o,i,a,s,l){return be.perfTimerScope("tile-render-continued-viewer",be.ProfileLevel.LOW,()=>{this._canvasSpaceTileBounds=new x(r,n,o,o),this._canvasToPixelsScale=i,this._boundsCache=s.boundsCache;let c=this.computeTileTransform(),d=new Af(s.renderTree,c,this._interruptArgs.framebuffer,this._interruptArgs.originalOutputTextureFormat);if(!d.equals(this._interruptArgs)||this._interruptedCommands.length==0)return we("Clearing interrupt state, prototype in potentially precarious state."),null;this._interruptArgs.framebuffer.colorTexture().format()!=Me.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(Me.RGBA_LINEAR_CLAMP);let p=this._interruptedCommands;return this._interruptedCommands=new Array,this._frameBudgetInformation=l,p.forEach(h=>{if(this._interruptedCommands.length>0)this._interruptedCommands.push(h);else switch(h.type){case 1:let m=h;this.visitWithCanvasSpaceTileBounds(m.node,m.transform,m.canvasSpaceTilebounds,m.inverseVolatileTransform,m.interruptIndex);break;case 2:let g=h;this._tileStack.popScissorFromCurrentTile(),this._tileStack.pushScissor(g.scissor);break;case 3:let S=h;this.visitGroupChildWithSSAA(S.node,S.transform,S.canvasSpaceTileBounds,S.inverseVolatileTransform);break;case 4:let R=h;this.renderBlend(R.blendIsNoOp,R.node,R.transform,R.canvasSpaceTileBounds,R.inverseVolatileTransform,1);break;default:}}),this._interruptedCommands.length>0?this._interruptArgs=d:this._tileStack.popScissorFromCurrentTile(),this._interruptedCommands.length==0&&this._interruptArgs.originalOutputTextureFormat!=Me.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(this._interruptArgs.originalOutputTextureFormat),this.drawTileFinish(d,e,this._interruptArgs.framebuffer)})}cleanUpExistingInterrupt(){var r,n;for(this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtClearedExistingInterrupt=!0,((r=this._interruptArgs)==null?void 0:r.originalOutputTextureFormat)!=Me.RGBA_LINEAR_CLAMP&&((n=this._interruptArgs)==null||n.framebuffer.colorTexture().setFormat(this._interruptArgs.originalOutputTextureFormat)),this._interruptedCommands=new Array,this._interruptArgs=null,this._frameBudgetInformation=null,this._cleanUpInterruptCallback=null,this._currentlyInDissolveCounter=0,this._currentlyInVolatilePropertyCounter=0,this._currentlyInPatternFillCounter=0;this._tileStack.count()>0;)if(this._tileStack.count()==1&&!this._tileStack.last().isBackedBySingleTileTexture()){this._tileStack.popScissorFromCurrentTile(),this._includesBackgroundColor&&!this._didDraw&&(this._tileStack.last().clearToColor(N.TRANSPARENT),this._includesBackgroundColor=!1),this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(mr.COLOR);let o=this._tileStack.popTile();this._tileStack.assertPoolAfterRender()}else this._tileStack.freeTileToPool(this._tileStack.popTile())}drawTile(e,r,n,o,i,a,s,l,c){return this._canvasToPixelsScale=i,this._context.annotateAndReturn(`Draw tile (${r}, ${n})`,()=>{this._interruptArgs!=null&&this._cleanUpInterruptCallback!=null&&this._cleanUpInterruptCallback();let d=a.colorTexture().format();s.useLargeTilesForDrawToScreen&&this._tileStack.setDrawToScreenLargeTileState(),s.shouldDisableAllAntialiasing,d!=Me.RGBA_LINEAR_CLAMP&&a.colorTexture().setFormat(Me.RGBA_LINEAR_CLAMP),this._requestImage=s.requestImage,this._boundsCache=s.boundsCache,this._canvasSpaceTileBounds=new x(r,n,o,o),this._tileSize=s.useLargeTilesForDrawToScreen?this._tileConfig.SSAA_SIZE():this._tileConfig.baseTileSize,this._shouldDisableAllAntialiasing=s.shouldDisableAllAntialiasing,this._neededImagesOrNull=s.shouldCollectNeededImages?Lp._new():null;let u=this.computeTileTransform(),p=s.renderTree;this._frameBudgetInformation=l;let _=new Af(p,u,a,d);if(this._didDraw=!1,this._includesBackgroundColor=!1,this._includesBackgroundColor=p!=null&&this.nodeNeedsBackgroundColor(p,u),this._includesBackgroundColor){let A=N.premultiplied(N.TRANSPARENT);this._tileStack.pushTileBackedByExistingFramebufferAndClearToColor(a,e,s,A)}else this._tileStack.pushTileBackedByExistingFramebuffer(a,e,s);if(p!=null){let A=this.allocateAndComputeTileScissor(u,this.bounds(p));this._tileStack.last().pushScissorRect(A);let m=X.new2();this.visit(p,X.new3(u),m,0),this._interruptedCommands.length==0&&this._tileStack.popScissorFromCurrentTile()}this._interruptedCommands.length>0&&(this._interruptArgs=_,this._cleanUpInterruptCallback=c);let h=this.drawTileFinish(_,e,a);return this._interruptedCommands.length==0&&d!=Me.RGBA_LINEAR_CLAMP&&a.colorTexture().setFormat(d),s.useLargeTilesForDrawToScreen&&this._tileStack.unsetDrawToScreenLargeTileState(),h})}setCanvas(e){this._canvas!=e&&(this._canvas=e,this._pathRasterizer.clearGradientCache())}drawToCurrentTile(e,r,n,o,i,a){n instanceof Ya&&(n=n.bufferArea()),i==null&&(i=_r.NONE);let s=this._currentTile1().needsColorClear(),l=(i==null?void 0:i.isEnabled)&&this._currentTile1().needsDepthStencilClear();if(s||l){let c=s&&l?mr.ALL:s?mr.COLOR:mr.DEPTH_STENCIL;this._currentTile1().doDeferredClear(c)}a==null||a==null?this._context.draw(e,r,n,o,i,this._currentTile1().framebuffer(),this._currentTile1().activeScissorRelativeToFramebuffer(),this._currentTile1().viewport()):this._context.drawInstanced(e,r,n,a,o,i,this._currentTile1().framebuffer(),this._currentTile1().activeScissorRelativeToFramebuffer(),this._currentTile1().viewport()),this._currentTile1().setIsColorClear(!1)}_currentTile1(){return this._tileStack.last()}_currentTile2(e){return this._tileStack.get(this._tileStack.count()-e-1)}_needsBackgroundColor(e){return e.hasNonIsolatedBlends()||e.dependsOnBackgroundContent()}bounds(e){return e.currentBounds(this._boundsCache)}nodeNeedsBackgroundColor(e,r){let n=x.new3(this.bounds(e));r.transformRect(n);let o=x.UNIT.overlaps(n);if(e==null||!this._needsBackgroundColor(e)||!o)return!1;if(e.op()==1){let i=e;for(let a of i.children){let s=x.new3(this.bounds(a)),l=x.UNIT.overlaps(r.transformRect(s));if(this._needsBackgroundColor(a)&&l)return!0}return!1}return!0}drawTileFinish(e,r,n){if(this._interruptedCommands.length==0){this._includesBackgroundColor&&!this._didDraw&&(this._tileStack.last().clearToColor(N.TRANSPARENT),this._includesBackgroundColor=!1),this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(mr.COLOR);let o=this._tileStack.popTile();this._interruptArgs=null,this._cleanUpInterruptCallback=null,this._tileStack.assertPoolAfterRender()}return this._frameBudgetInformation=null,new Sf(this._includesBackgroundColor,this._interruptedCommands.length>0?1:0,this._neededImagesOrNull)}checkIfNodeIsNotInTileWithNonAABBTransform(e,r,n=!1){if(r.isAxisAligned(mB))return!1;let o=K.nonAABBRenderingCheck();if(qn.didEncounterNonAxisAlignedTransform(o),!o&&!n)return!1;let i=x.new3(this._currentTile1().scissor()).intersectedWith(this._tileStack.defaultTileScissor());if(i.width()<=0||i.height()<=0)return!0;let a=i.scaledBy1(1/this._currentTile1().tileSize()),s=new Na(a),l=X.new3(r);if(!l.invert())return!1;let c=s.transform(l),d=this.bounds(e),u=c.points();for(let p of u)if(d.contains2(p))return!1;for(let p of new Na(x.fromRect(d)).points())if(p.isContainedInSimpleHull(u))return!1;for(let p=0;p<u.length;p++){let _=(p+1)%u.length,h=u[p],A=u[_];if(d.intersectsLineSegment(h,A))return!1}return!0}visit(e,r,n,o){let i=x.new3(x.UNIT),a=X.new3(r);a.invert();let s=a.transformRect(i);this.visitWithCanvasSpaceTileBounds(e,r,s,n,o)}visitWithCanvasSpaceTileBounds(e,r,n,o,i){this._context.annotateProfile(e.opProfileString(),()=>{this._visitWithCanvasSpaceTileBounds(e,r,n,o,i)})}_canSkipNodeOutsideScissor(e,r){if(this._currentTile1()==null)return!1;let n=x.new3(this._currentTile1().scissor());return n.equals(this._tileStack.defaultTileScissor())?!1:!n.scaledBy1(1/this._currentTile1().tileSize()).overlaps(r.transformRect(x.new3(this.bounds(e))))}_visitWithCanvasSpaceTileBounds(e,r,n,o,i){var s,l,c,d;if(n.overlaps(this.bounds(e))&&!this._currentTile1().scissorsEmpty()&&!(i<1&&(this._canSkipNodeOutsideScissor(e,r)||this.checkIfNodeIsNotInTileWithNonAABBTransform(e,r)))){if(this._frameBudgetInformation){if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Eo(e,r,n,o,i));return}else if(!this._frameBudgetInformation.permitsMoreWork()){qn.didEncounterIntraTileInterrupt();let u=this._ssaaState.level!=0||this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,p=this._currentlyInDissolveCounter>0,_=this._currentlyInVolatilePropertyCounter>0,h=this._currentlyInPatternFillCounter>0;if(!_&&!p&&!u&&!h){this._interruptedCommands.push(new Eo(e,r,n,o,i));return}}}switch(e.op()){case 0:{let u=e;this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);break}case 2:{let u=e;this._shouldDisableAllAntialiasing?this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0):(this.pushSSAARenderState(u.child),this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0),this.popSSAARenderState());break}case 1:{let u=e;this.visitGroupHelper(u,r,n,o,i);break}case 3:{let u=e,p=this._shouldDisableAllAntialiasing?0:u.desiredAntialiasing();this._pathRasterizer.beginBatch(p),this._pathRasterizer.renderFill(r,u),this._pathRasterizer.finishBatch();break}case 4:{let u=e,p=this._shouldDisableAllAntialiasing?0:u.desiredAntialiasing();this._pathRasterizer.beginBatch(p),this._pathRasterizer.renderFillStroke(r,u),this._pathRasterizer.finishBatch();break}case 16:{let u=e,p=this._shouldDisableAllAntialiasing?0:u.desiredAntialiasing();this._pathRasterizer.beginBatch(p),this._pathRasterizer.renderScatterBrushFill(r,u),this._pathRasterizer.finishBatch();break}case 5:{let u=e,p=(u.type==0||u.type==4||u.type==1)&&u.hasNonIsolatedBlends(),_=this.allocateAndComputeTileScissor(r,this.bounds(u.color)),h=u.type==0&&!u.hasNonIsolatedBlends()&&u.alpha.isAxisAlignedRectFill()&&u.alpha.op()==3&&Se.containsAtLeastOneVisibleOpaquePaint(u.alpha.geometry.paints)&&r.isAxisAligned(.001),A=h?u.alpha.geometryBounds():this.bounds(u.alpha),m=u.type==2||gc&&u.type==3?this.allocateAndComputeTileScissor(r,A):u.type==4?_:this.allocateAndComputeTileScissor(r,A).intersectedWith(_);if(h){let E=this._tileStack.takeScissorFromCurrentTile();if(m.intersectWith(E),this._tileStack.pushScissor(m),this.visitWithCanvasSpaceTileBounds(u.color,r,n,o,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new _f(E.clone()));return}else{this._tileStack.popScissorFromCurrentTile(),this._tileStack.pushScissor(E);return}}let g=x.new3(this._currentTile1().scissor()).intersectedWith(m);if(i<1){if(g.isEmpty())return;if(p?(this.duplicateTile1(g),this.duplicateTile1(g)):u.type==3?this._tileStack.pushTileAndClearToColor(N.premultiplied(((s=this._canvas)==null?void 0:s.computedBackgroundColor())??N.BLACK),g):this._tileStack.pushTile(g),u.type===5){qn.didEncounterPatternPaint(),this._currentlyInPatternFillCounter++;let E=null,P=null;if(u.color.op()===5){var a=u.color.color;a.op()===3?E=a:P=a}else u.color.op()===3?E=u.color:P=u.color;let T=X.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(r).multipliedBy1(E?E.transform:P==null?void 0:P.transform),f=E?E.geometry.paints[0]:P==null?void 0:P.fillGeometries[0].paints[0];if(E!=null)this.renderSinglePatternPaint(r,E.transform,T,f.asSinglePaint(),u.sourceRenderTree,this._canvasToPixelsScale,E.geometry.path().bounds(),this._tileSize,lt.PREMULTIPLIED);else{let y=P.getAccumulatedFillGeometryPathBounds();for(let v=0;v<P.fillGeometries.length;v++){let w=y[v];this.renderSinglePatternPaint(r,P.transform,T,f.asSinglePaint(),u.sourceRenderTree,this._canvasToPixelsScale,w,this._tileSize,lt.PREMULTIPLIED)}}this._currentlyInPatternFillCounter--}else this.visitWithCanvasSpaceTileBounds(u.color,r,n,o,0);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Eo(e,r,n,o,1));return}}if(i<2&&(this._tileStack.pushTile(g),this.visitWithCanvasSpaceTileBounds(u.alpha,r,n,o,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Eo(e,r,n,o,2));return}let S=this._tileStack.popTile(),R=this._tileStack.popTile();switch(u.type){case 0:case 5:{if(p){let E=this._tileStack.popTile();this.maskTilePassThrough(E,S,R,g),this._tileStack.freeTileToPool(E)}else this.maskTile(S,R,g);break}case 1:{if(p){let E=this._tileStack.popTile();this.maskTileLuminancePassThrough(E,S,R,g),this._tileStack.freeTileToPool(E)}else this.maskTileLuminance(S,R,g);break}case 4:{if(p){let E=this._tileStack.popTile();this.maskKnockoutShadowTilePassThrough(E,S,R,g),this._tileStack.freeTileToPool(E)}else this.maskKnockoutShadowTile(S,R,g);break}case 3:{this.maskBackgroundBlurTile(S,R,g);break}case 2:{this.maskInnerShadowTile(S,R,g,u.innerShadowFill,u.innerShadowAlphaRequiresHardMask);break}}this._tileStack.freeTileToPool(S),this._tileStack.freeTileToPool(R);break}case 9:{let u=e,p=this.allocateAndComputeTileScissor(r,this.bounds(u.alpha)),_=x.new3(this._currentTile1().scissor()).intersectedWith(p);if(_.isEmpty())return;if(i<1&&(this._tileStack.pushTile(_),this.visitWithCanvasSpaceTileBounds(u.alpha,r,n,o,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Eo(e,r,n,o,1));return}let h=this._tileStack.popTile();this.hardMaskTileWithColor(h,u.color,_),this._tileStack.freeTileToPool(h);break}case 6:{let u=e,p=x.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=u.hasInvertedStartAndEndPoints()?u.startRadius*r.scale1().maxComponent():u.endRadius*r.scale1().maxComponent();if(qn.didEncounterBlur(u.blurOpType==="PROGRESSIVE"),u.blurOpType=="PROGRESSIVE"){let h=u.hasInvertedStartAndEndPoints()?u.endRadius:u.startRadius,A=u.hasInvertedStartAndEndPoints()?u.startRadius:u.endRadius,m=u.hasInvertedStartAndEndPoints()?u.endPoint:u.startPoint,g=u.hasInvertedStartAndEndPoints()?u.startPoint:u.endPoint;if(i==1){let R=x.new3(this._currentTile2(1).scissor()).intersectedWith(p);this.renderProgressiveBlur(h,A,m,g,u.child,r,_,R,o,u.clamp,n,i,e);return}if(i==2){let R=x.new3(this._currentTile2(2).scissor()).intersectedWith(p);this.renderProgressiveBlur(h,A,m,g,u.child,r,_,R,o,u.clamp,n,i,e);return}let S=x.new3(this._currentTile1().scissor()).intersectedWith(p);if(S.isEmpty())return;if(_<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);return}this.renderProgressiveBlur(h,A,m,g,u.child,r,_,S,o,u.clamp,n,i,e);break}else if(u.blurOpType=="NORMAL"){if(i==1){let E=x.new3(this._currentTile2(1).scissor()).intersectedWith(p);this.renderBlur(e,u.child,r,_,E,o,u.clamp,n,i);return}let h=x.new3(this._currentTile1().scissor()).intersectedWith(p);if(h.isEmpty())return;if(_<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);return}let A=J1(u.child),m=A.a,g=A.b??yt.FrozenAffineTransform_IDENTITY,S=m.isRectFill()?m:null;if(S!=null&&u.clamp.isInvalid()){let E=Se.onlySolidPaintOrNull(S.geometry.paints);if(E!=null){let P=X.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(r).multipliedBy1(g).multipliedBy1(S.transform);this.renderBlurredRectangle(P,S.geometry.path().bounds(),N.multiplyOpacity(E.color(),E.opacity()),u.endRadius);return}}let R=m.isRoundedRectFill()?m:null;if(R!=null&&u.clamp.isInvalid()){let E=R.geometry.path().path(),P=E.radii();if(P.isUniform()){let T=Se.onlySolidPaintOrNull(R.geometry.paints);if(T!=null){let f=P.topLeft,y=X.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(r).multipliedBy1(g).multipliedBy1(R.transform);this.renderBlurredRoundedRectangle(y,E.bounds(),f,N.multiplyOpacity(T.color(),T.opacity()),u.endRadius);return}}}this.renderBlur(e,u.child,r,_,h,o,u.clamp,n,i);break}}case 17:{let u=e,p=x.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=r.scale1().maxComponent(),h=u.blurRadius*_,A=u.textureRadius*_,m=u.reflectionRadius*_,g=u.cornerRadii.topLeft*_,S=Math.min(u.centerPoint.x(),u.centerPoint.y()),E=Math.min(S,u.refractionDistance)*_,P=x.new3(this._currentTile1().scissor()).intersectedWith(p);this.renderRectangularLiquidGlass(u,u.child,r,h,A,m,E,u.blurRadius,u.textureRadius,u.refractionIntensity,u.refractionDistance,u.cornerRadii.topLeft,u.nodeToCanvasSpaceTransform,u.centerPoint,u.reflectionRadius,u.lightIntensity,u.lightAngle,u.bevelSize,u.chromaticAberration,u.cornerSmoothing,u.tintColor,P,o,n,i);break}case 7:{let u=e,p=fB(u.blendMode)&&(this._currentTile1().isColorClear()||this._currentTile1().needsColorClear())&&u.opacity==1;this.renderBlend(p,u,r,n,o,0);break}case 14:{let u=e,p=x.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=u.radius*r.scale1().maxComponent();if(qn.didEncounterTextureEffect(u.clipToShape),_<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);break}if(i==1){let A=x.new3(this._currentTile2(1).scissor()).intersectedWith(p);u.clipToShape?this.renderClampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,A,o,n,i,u.seed):this.renderUnclampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,A,o,n,i,u.seed);return}if(i==2){let A=x.new3(this._currentTile2(2).scissor()).intersectedWith(p);this.renderClampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,A,o,n,i,u.seed);return}let h=x.new3(this._currentTile1().scissor()).intersectedWith(p);if(h.isEmpty())return;u.clipToShape?this.renderClampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,h,o,n,i,u.seed):this.renderUnclampedGrain(u,u.child,r,_,u.radius,u.noiseSize.x(),u.nodeToCanvasSpaceTransform,u.centerPoint,h,o,n,i,u.seed);break}case 15:{let u=e,p=x.new3(this.bounds(u));if(r.transformRect(p),p.scaledBy1(this.currentTextureSize()),qn.didEncounterNoiseEffect(),this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0),i==1){let h=x.new3(this._currentTile2(1).scissor()).intersectedWith(p);this.renderNoise(u,u.child,r,h,u.blendMode,u.nodeToCanvasSpaceTransform,u.noiseType,u.noiseSize.x(),u.density,u.color,u.secondaryColor,u.nodeSpaceCenterPoint,o,n,i,u.seed);return}let _=x.new3(this._currentTile1().scissor()).intersectedWith(p);this.renderNoise(u,u.child,r,_,u.blendMode,u.nodeToCanvasSpaceTransform,u.noiseType,u.noiseSize.x(),u.density,u.color,u.secondaryColor,u.nodeSpaceCenterPoint,o,n,i,u.seed);break}case 8:{let u=e;this.visitCompositeChildWithOpacity(u,1,r,n);break}case 10:{this._currentlyInVolatilePropertyCounter++;let u=e;switch(u.property){case 2:{let p=X.new3(r);p.multipliedBy1(u.transform());let _=X.new3(u.transform());_.invert()||_.copyFrom(yt.FrozenAffineTransform_IDENTITY),_.multipliedBy1(o),this.visit(u.child,p,_,0);break}case 1:{let p=X.new2();this.visitWithCanvasSpaceTileBounds(u.child,r,n,p,0);break}case 0:{let p=X.new2(),_=X.new2();p.copyFrom(r).multipliedBy1(o),this.visit(u.child,p,_,0);break}case 4:{let p=u.opacity(),_=!1;if(p==1)this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0),_=!0;else if(p==0)_=!0;else if(u.child.op()==3){let h=u.child,A=(l=Se.onlyPaintOrNull(h.geometry.paints))==null?void 0:l.asSinglePaint();if(A!=null){let m=A.cloneAsSinglePaint();m.setOpacity(m.opacity()*p),this.visitWithCanvasSpaceTileBounds(h.withPaints([m]),r,n,o,0),_=!0}}else if(u.child.op()==8){let h=u.child;this.visitCompositeChildWithOpacity(h,p,r,n),_=!0}if(!_){let h=this.allocateAndComputeTileScissor(r,this.bounds(u.child)),A=x.new3(this._currentTile1().scissor()).intersectedWith(h);u.child.hasNonIsolatedBlends()?this.duplicateTile1(A):this._tileStack.pushTile(A),this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0),u.child.hasNonIsolatedBlends()?this.blendAndPopTile("PASS_THROUGH",p):this.blendAndPopTile("NORMAL",p)}break}case 3:{this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);break}case 5:{this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);break}default:throw new Error(`Unhandled VolatileProperty value ${Xs.VolatileProperty_toString(u.property)}`)}this._currentlyInVolatilePropertyCounter--;break}case 13:{this._currentlyInVolatilePropertyCounter++;let u=e;switch(u.property){case 0:{let p=x.new3(u.computeBounds(this._boundsCache));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=x.new3(this._currentTile1().scissor()).intersectedWith(p);if(_.isEmpty())return;let h=u.hasInvertedStartAndEndPoints()?u.startRadius():u.endRadius(),A=h*r.scale1().maxComponent();if(A<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);return}let m=u.hasInvertedStartAndEndPoints()?u.endRadius():u.startRadius(),g=u.hasInvertedStartAndEndPoints()?u.getOffsetInCanvasSpace():u.getStartOffsetInCanvasSpace(),S=u.hasInvertedStartAndEndPoints()?u.getStartOffsetInCanvasSpace():u.getOffsetInCanvasSpace();u.blurOpType=="PROGRESSIVE"?this.renderProgressiveBlur(m,h,g,S,u.child,r,A,_,o,u.canvasSpaceClamp,n,i,e):this.renderBlur(e,u.child,r,A,_,o,u.canvasSpaceClamp,n,i);break}case 1:{let p=x.new3(u.computeBounds(this._boundsCache));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=x.new3(this._currentTile1().scissor()).intersectedWith(p);if(_.isEmpty())return;let h=u.grainRadius()*r.scale1().maxComponent(),A=u.grainNoiseSize(),m=u.getNodeToCanvasSpaceTransform(),g=u.getNodeSpaceCenterPoint();u.clipToShape?this.renderClampedGrain(u,u.child,r,h,u.grainRadius(),A,m,g,_,o,n,i,u.seed):this.renderUnclampedGrain(u,u.child,r,h,u.grainRadius(),A,m,g,_,o,n,i,u.seed);break}case 2:{let p=x.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize()),this.visitWithCanvasSpaceTileBounds(u.child,r,n,o,0);let _=x.new3(this._currentTile1().scissor()).intersectedWith(p);this.renderNoise(u,u.child,r,_,u.blendMode,u.nodeToCanvasSpace,u.noiseType,u.getNoiseSize(),u.getNoiseDensity(),u.getNoiseColor(),u.getSecondaryNoiseColor(),u.getNodeSpaceCenterPoint(),o,n,i,u.seed);break}case 3:{let p=x.new3(this.bounds(u));r.transformRect(p),p.scaledBy1(this.currentTextureSize());let _=r.scale1().maxComponent(),h=u.glassBlurRadius()*_,A=u.glassTextureRadius()*_,m=u.glassReflectionDistance()*_,g=u.glassCornerRadius()*_,S=x.new3(this._currentTile1().scissor()).intersectedWith(p);this.renderRectangularLiquidGlass(u,u.child,r,h,A,m,g,u.glassBlurRadius(),u.glassTextureRadius(),u.glassRefractionIntensity(),u.glassRefractionDistance(),u.glassCornerRadius(),u.getNodeToCanvasSpaceTransform(),u.glassCenterPoint(),u.glassReflectionDistance(),u.glassSpecularIntensity(),u.glassSpecularAngle(),u.glassBevelSize(),u.glassChromaticAberration(),u.cornerSmoothing,u.glassTintColor(),S,o,n,i);break}}this._currentlyInVolatilePropertyCounter--;break}case 11:{let u=e,p=X.new3(r);p.multipliedBy1(u.transform);let _=X.new3(u.transform);_.invert()||_.copyFrom(yt.FrozenAffineTransform_IDENTITY),_.multipliedBy1(o),this.visit(u.child,p,_,0);break}case 12:{this._currentlyInDissolveCounter++;let u=e,p=u.startChild?this.allocateAndComputeTileScissor(r,this.bounds(u.startChild)):this._tileStack.defaultTileScissor(),_=u.endChild?this.allocateAndComputeTileScissor(r,this.bounds(u.endChild)):this._tileStack.defaultTileScissor(),h=x.new2();h.copyFrom(this._currentTile1().scissor()).intersectedWith(p);let A=h.clone().scaledBy1(1/this.currentTextureSize());(c=u.startChild)!=null&&c.hasNonIsolatedBlends()?this.duplicateTile1(h):this._tileStack.pushTile(h),u.startChild&&this.visitWithCanvasSpaceTileBounds(u.startChild,r,n,o,0);let m=this._tileStack.popTile();h.copyFrom(this._currentTile1().scissor()).intersectedWith(_);let g=h.clone().scaledBy1(1/this.currentTextureSize());(d=u.endChild)!=null&&d.hasNonIsolatedBlends()?this.duplicateTile1(h):this._tileStack.pushTile(h),u.endChild&&this.visitWithCanvasSpaceTileBounds(u.endChild,r,n,o,0);let S=this._tileStack.popTile();this._lerpTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,m.colorTextureForSampling(),0),this._lerpTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,S.colorTextureForSampling(),1),Oe.Material_setUniformVec43(this._lerpTileMaterial,this._materialStrings.SHADER_NAME_TEXTURE0_UV_SPACE_SCISSOR,A),Oe.Material_setUniformVec43(this._lerpTileMaterial,this._materialStrings.SHADER_NAME_TEXTURE1_UV_SPACE_SCISSOR,g),this._lerpTileMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,xt.double_clamp(u.progress(),0,1));let R=this.allocateAndComputeTileScissor(r,this.bounds(e));this._tileStack.pushScissor(R),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._lerpTileMaterial,this._quadArea,lt.PREMULTIPLIED),this._tileStack.popScissorFromCurrentTile(),this._tileStack.freeTileToPool(S),this._tileStack.freeTileToPool(m),this._currentlyInDissolveCounter--;break}}}}visitCompositeChildWithOpacity(e,r,n,o){let i=X.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(n),a=this.allocateAndComputeTileScissor(n,this.bounds(e));this._tileStack.pushScissor(a),e.forEachTileWithinBounds(1,o,s=>{let l=s.textureRegionOrNull();if(l!=null){if(this.drawTextureRegion2(l,s.canvasSpaceBounds(),i,1,r),s.neededImagesOrNull!=null){let c=Lp.asList(s.neededImagesOrNull);for(let d of c)this.getOrCreateImageTexture(d)}}else if(K.shouldApplyMobileOptimizations()&&Br.getFeatureGate("viewer_atlas_cap_capacity")&&s.skippedPrerasterization){let c=X.new2().scaledBy2(1/s.canvasSpaceBounds().size().x()).translatedBy1(new O(-s.canvasSpaceBounds().x(),-s.canvasSpaceBounds().y())),d=X.new3(c);d.invert()||(we("Failed to invert tile transform when rendering directly to screen"),d.copyFrom(yt.FrozenAffineTransform_IDENTITY));let u=this.allocateAndComputeTileScissor(c,s.bounds());this._tileStack.pushTile(u),this.visit(e.tree,c,d,0);let p=this._tileStack.popTile(),_=new Tc(p.backingColorTexture(),p.uvSpaceRect());this.drawTextureRegion2(_,s.canvasSpaceBounds(),i,1,r),this._tileStack.freeTileToPool(p)}}),this._tileStack.popScissorFromCurrentTile()}visitGroupHelper(e,r,n,o,i){if(i<1)for(let a of e.children)this.visitGroupChildWithSSAA(a,r,n,o);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Eo(e,r,n,o,1));return}this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.finishBatch()}visitGroupChildWithSSAA(e,r,n,o){let i=this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,a=e.desiredAntialiasing()==2&&!this._shouldDisableAllAntialiasing;if(this._interruptedCommands.length>0){this._interruptedCommands.push(new pf(e,r,n,o));return}let s=!1;K.getFeatureFlags().viewer_ssaa_scissor_fix&&a&&!i&&this._ssaaState.level===0?s=this.upscaleRectForSSAA(x.new3(this._currentTile1().scissor())).overlaps(this.allocateAndComputeTileScissor(r,this.bounds(e),this._tileConfig.SSAA_SIZE())):K.getFeatureFlags().viewer_ssaa_scissor_fix&&!a&&i&&this._ssaaState.level===1?s=this._currentTile2(1).scissor().overlaps(this.allocateAndComputeTileScissor(r,this.bounds(e),this._tileConfig.baseTileSize)):s=this._currentTile1().scissor().overlaps(this.allocateAndComputeTileScissor(r,this.bounds(e))),s&&(a&&!i?this._pathRasterizer.beginBatch(2):!a&&i&&this._pathRasterizer.finishBatch(),a?e.op()==3?this._pathRasterizer.renderFill(r,e):e.op()==4?this._pathRasterizer.renderFillStroke(r,e):e.op()===16&&this._pathRasterizer.renderScatterBrushFill(r,e):this.visitWithCanvasSpaceTileBounds(e,r,n,o,0))}allocateAndComputeTileScissor(e,r,n){let o=x.new3(r);e.transformRect(o);let i=o.scaledBy1(n??this.currentTextureSize());return i.round(),i}renderBlurredRectangle(e,r,n,o){N.alpha(n)!=0&&(Oe.Material_setUniformMat32(this._rectangleBlurMaterial,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,e),Oe.Material_setUniformVec42(this._rectangleBlurMaterial,this._materialStrings.SHADER_NAME_U_COLOR,N.premultiplied(n)),Oe.Material_setUniformVec43(this._rectangleBlurMaterial,this._materialStrings.SHADER_NAME_U_QUAD,r),this._rectangleBlurMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_BLUR_RADIUS,o),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._rectangleBlurMaterial,this._quadArea,lt.PREMULTIPLIED),this._didDraw=!0)}renderBlurredRoundedRectangle(e,r,n,o,i){N.alpha(o)!=0&&(Oe.Material_setUniformMat32(this._roundedRectangleBlurMaterial,this._materialStrings.SHADER_NAME_U_VERTEX_TRANSFORM,e),Oe.Material_setUniformVec42(this._roundedRectangleBlurMaterial,this._materialStrings.SHADER_NAME_U_COLOR,N.premultiplied(o)),Oe.Material_setUniformVec43(this._roundedRectangleBlurMaterial,this._materialStrings.SHADER_NAME_U_QUAD,r),this._roundedRectangleBlurMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS,n/i),Oe.Material_setUniformVec22(this._roundedRectangleBlurMaterial,this._materialStrings.SHADER_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS,r.size().divideScalar(2*i)),this._roundedRectangleBlurMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_BLUR_RADIUS,i),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._roundedRectangleBlurMaterial,this._quadArea,lt.PREMULTIPLIED),this._didDraw=!0)}scaleLimitForBlursAndEffects(e){return 1/(1+2*e)}renderBlur(e,r,n,o,i,a,s,l,c){let d=32;K.getFeatureFlags().increase_blur_max_texel_radius&&(d=64);let u=.5,p=this.scaleLimitForBlursAndEffects(o),_=Math.min(d,p*o*this.currentTextureSize()),h=_/this.currentTextureSize(),A=h/o;A>2/u/this.currentTextureSize()&&(A=Math.round(A*(this.currentTextureSize()*u))/(this.currentTextureSize()*u),_=Math.min(d/u,A*o*this.currentTextureSize()),h=_/this.currentTextureSize());let m=X.new2().translatedBy2(.5,.5).scaledBy2(A).translatedBy2(-.5,-.5),g=x.new3(i).scaledBy1(1/this.currentTextureSize());m.transformRect(g);let S=x.new3(g).expandedBy2(0,h),R=x.new3(S).expandedBy2(h,0),E=m.multipliedBy1(n),P=null;if(!s.isInvalid()){P=E.transformRect(s.clone()),P.scaledBy1(this.currentTextureSize());let v=Math.ceil(P.left()-.5)+.5,w=Math.ceil(P.top()-.5)+.5,I=Math.floor(P.right()+.5)-.5,C=Math.floor(P.bottom()+.5)-.5;P=new x(v,w,I-v,C-w),P.scaledBy1(1/this.currentTextureSize())}let T=_>4,f=T&&r.op()==9;if(c<1){if(this._tileStack.pushTile(x.new3(R).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),f){let v=r;this.visit(v.alpha,E,a,0)}else this.visit(r,E,a,0);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Eo(e,n,l,a,1));return}}let y=!1;if(T){let v=_*u,w=x.new3(R).scaledBy1(u),I=x.new3(S).scaledBy1(u),C=x.new3(g).scaledBy1(u),L=null;if(P!=null){L=x.new3(P).scaledBy1(u),L.scaledBy1(this.currentTextureSize());let z=Math.ceil(L.left()-.5)+.5,q=Math.ceil(L.top()-.5)+.5,Y=Math.floor(L.right()+.5)-.5,j=Math.floor(L.bottom()+.5)-.5;L=new x(z,q,Y-z,j-q),L.scaledBy1(1/this.currentTextureSize())}let B=this._tileStack.popTile(),V=x.new3(w).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();if(this._tileStack.pushTile(V,y),f){let z=r;this.hardMaskWithColorAndDownscaleTile(B,z.color,w,R)}else this.downscaleTile(B,w,R);this._tileStack.freeTileToPool(B);let b=this._tileStack.popTile(),D=x.new3(I).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(D,y),this.blurTile(b,1/this.currentTextureSize(),0,x.new3(D).scaledBy1(1/this.currentTextureSize()),v,L),this._tileStack.freeTileToPool(b);let U=this._tileStack.popTile(),H=x.new3(C).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(H,y),this.blurTile(U,0,1/this.currentTextureSize(),x.new3(H).scaledBy1(1/this.currentTextureSize()),v,L),this._tileStack.freeTileToPool(U);let k=this._tileStack.popTile();this.upscaleTile(k,i.scaledBy1(1/this.currentTextureSize()),C),this._tileStack.freeTileToPool(k)}else{let v=this._tileStack.popTile(),w=x.new3(S).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(w,y),this.blurTile(v,1/this.currentTextureSize(),0,x.new3(w).scaledBy1(1/this.currentTextureSize()),_,P),this._tileStack.freeTileToPool(v);let I=this._tileStack.popTile(),C=x.new3(g).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(C,y),this.blurTile(I,0,1/this.currentTextureSize(),x.new3(C).scaledBy1(1/this.currentTextureSize()),_,P),this._tileStack.freeTileToPool(I);let L=this._tileStack.popTile();this.upscaleTile(L,i.scaledBy1(1/this.currentTextureSize()),g),this._tileStack.freeTileToPool(L)}}needsSourceTextureForProgressiveBlur(e,r,n,o,i){let a=!1,s=r.subtract(e),l=Number.MIN_VALUE,c=Number.MAX_VALUE;for(let d of[n.topLeft(),n.topRight(),n.bottomRight(),n.bottomLeft()]){let p=d.subtract(e).dot(s)/s.dot(s),_=Math.min(Math.max(p,0),1),h=(i-o)*_+o;l=Math.max(l,h),c=Math.min(c,h)}if(c<=1)a=!0;else{let d=.00390625,u=l*l,_=((l-1)*(l-1)+2*(l-1))/2*2,h=_*_;a=u/(u+h)>=d}return a}blendModePreTraverseHelper(e,r){e=="PASS_THROUGH"?this.duplicateTile1(r):this._tileStack.pushTile(r)}renderNoise(e,r,n,o,i,a,s,l,c,d,u,p,_,h,A,m){let g=o.expandedBy1(1).rounded();if(A<1){if(g.isEmpty())return;if(this._tileStack.pushTile(g),this.visitWithCanvasSpaceTileBounds(r,n,h,_,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new Eo(e,n,h,_,1));return}}let S=this._tileStack.popTile(),R=this.scissorQuad(x.new3(S.scissor())).scaledBy1(this.currentTextureSize());this.blendModePreTraverseHelper(i,R);let E=X.new3(n),P=a;E.multiply(P);let f=E.clone().clone();f.invert()||console.error("Noise Inv Err"),this.noiseTile(S,s,1/l,c,d,u,O.new(p),f,x.new3(o).scaledBy1(1/this.currentTextureSize()),m),this.blendAndPopTile(i,1),this._tileStack.freeTileToPool(S)}renderUnclampedGrain(e,r,n,o,i,a,s,l,c,d,u,p,_){let h=this.currentTextureSize()/2-1,A=this.scaleLimitForBlursAndEffects(o),m=Math.min(h,A*o*this.currentTextureSize()),g=m/this.currentTextureSize(),S=g/o;S>2/this.currentTextureSize()&&(S=Math.round(S*this.currentTextureSize())/this.currentTextureSize(),m=Math.min(h,S*o*this.currentTextureSize()),g=m/this.currentTextureSize());let R=X.new2().translatedBy2(.5,.5).scaledBy2(S).translatedBy2(-.5,-.5),E=x.new3(c).scaledBy1(1/this.currentTextureSize());R.transformRect(E);let P=x.new3(E).expandedBy2(0,g),T=x.new3(P).expandedBy2(g,0),f=R.multipliedBy1(n),y=null;if(p<1&&(this._tileStack.pushTile(x.new3(T).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),this.visit(r,f,d,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Eo(e,n,u,d,1));return}let v=this._tileStack.popTile();this._tileStack.pushTile(new x(0,0,this.currentTextureSize(),this.currentTextureSize()));let w=X.new3(n),I=X.new3(s);w.multiply(I);let C=w.clone();w.invert()||console.error("Grain Inv Err");let L=w.clone();this.unclampedGrainTile(v,i,x.new3(c).scaledBy1(1/this.currentTextureSize()),S,1/a,C,L,O.new(l),_);let B=this._tileStack.popTile();this.copyTileRegion(B,x.new3(c).scaledBy1(1/this.currentTextureSize()),x.new3(c).scaledBy1(1/this.currentTextureSize()),lt.PREMULTIPLIED),this._tileStack.freeTileToPool(v),this._tileStack.freeTileToPool(B)}renderClampedGrain(e,r,n,o,i,a,s,l,c,d,u,p,_){let h=this.currentTextureSize()/2-1,A=this.scaleLimitForBlursAndEffects(o),m=Math.min(h,A*o*this.currentTextureSize()),g=m/this.currentTextureSize(),S=g/o;S>2/this.currentTextureSize()&&(S=Math.round(S*this.currentTextureSize())/this.currentTextureSize(),m=Math.min(h,S*o*this.currentTextureSize()),g=m/this.currentTextureSize());let R=X.new2().translatedBy2(.5,.5).scaledBy2(S).translatedBy2(-.5,-.5),E=x.new3(c).scaledBy1(1/this.currentTextureSize());R.transformRect(E);let P=x.new3(E).expandedBy2(0,g),T=x.new3(P).expandedBy2(g,0),f=R.multipliedBy1(n);if(K.clipToShapeBoundsReducton()&&T.intersectWith(f.transformRect(x.new3(this.bounds(e)))),p<1&&(this._tileStack.pushTile(x.new3(c).expandedBy1(1).rounded()),this.visit(r,n,d,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Eo(e,n,u,d,1));return}if(p<2&&(this._tileStack.pushTile(x.new3(T).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),this.visit(r,f,d,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Eo(e,n,u,d,2));return}let y=this._tileStack.popTile(),v=this._tileStack.popTile();this._tileStack.pushTile(new x(0,0,this.currentTextureSize(),this.currentTextureSize()));let w=X.new3(n),I=X.new3(s);w.multiply(I);let C=w.clone();w.invert()||console.error("Grain Inv Err");let L=w.clone();this.clampedGrainTile(v,y,i,x.new3(c).scaledBy1(1/this.currentTextureSize()),S,1/a,C,L,O.new(l),_);let B=this._tileStack.popTile();this.copyTileRegion(B,x.new3(c).scaledBy1(1/this.currentTextureSize()),x.new3(c).scaledBy1(1/this.currentTextureSize()),lt.PREMULTIPLIED),this._tileStack.freeTileToPool(v),this._tileStack.freeTileToPool(y),this._tileStack.freeTileToPool(B)}renderRectangularLiquidGlass(e,r,n,o,i,a,s,l,c,d,u,p,_,h,A,m,g,S,R,E,P,T,f,y,v){let w=128,I=32;K.getFeatureFlags().increase_blur_max_texel_radius&&(I=64);let C=c==0,L=Math.max(o+i+s*(d+R),a),B=this.scaleLimitForBlursAndEffects(L),V=L,b=Math.min(w,B*V*this.currentTextureSize()),D=b/this.currentTextureSize(),U=D/V;U>2/this.currentTextureSize()&&(U=Math.round(U*this.currentTextureSize())/this.currentTextureSize(),b=Math.min(w,U*V*this.currentTextureSize()),D=b/this.currentTextureSize());let H=X.new2().translatedBy2(.5,.5).scaledBy2(U).translatedBy2(-.5,-.5),k=x.new3(T).scaledBy1(1/this.currentTextureSize());H.transformRect(k);let z=x.new3(k).expandedBy2(0,D),q=x.new3(z).expandedBy2(D,0),Y=H.multipliedBy1(n);this._tileStack.pushTile(x.new3(T).expandedBy1(1).rounded()),this.visit(r,n,f,0),this._tileStack.pushTile(x.new3(q).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),this.visit(r,Y,f,0);let j=Math.min(I,o/V*b),ae=this._tileStack.popTile(),xe=j<1/this.currentTextureSize();if(!xe){let mt=x.new3(q).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(mt),this.blurTile(ae,1/this.currentTextureSize(),0,x.new3(mt).scaledBy1(1/this.currentTextureSize()),j,null);let He=this._tileStack.popTile(),et=x.new3(q).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(et),this.blurTile(He,0,1/this.currentTextureSize(),x.new3(et).scaledBy1(1/this.currentTextureSize()),j,null),this._tileStack.freeTileToPool(He)}if(!C){let mt=this._tileStack.popTile(),He=x.new3(q).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(He);let et=Y,tt=_,wt=et.multipliedBy1(tt),zt=wt;zt.invert()||console.error("Glass Inv Err");let kt=x.new3(q).scaledBy1(1/this.currentTextureSize()).expandedBy1(1).rounded();this.unclampedGrainTile(mt,c,kt,1,1/1,wt,zt,O.new(h),1),this._tileStack.freeTileToPool(mt)}let Je=xe?ae:this._tileStack.popTile(),We=this._tileStack.popTile();this._tileStack.pushTile(x.new3(T).expandedBy1(1).rounded());let pt=X.new3(n),Mt=X.new3(_);pt.multiply(Mt);let nr=pt.clone();pt.invert()||console.error("Glass Inv Err");let ir=pt.clone(),le=Math.floor(a/V*b);this.glassTile(x.new3(T).scaledBy1(1/this.currentTextureSize()),Je,ae,We,p,U,nr,ir,h,d,u,A,le,l,m,g*(Math.PI/180),S,R,E,P);let Ut=this._tileStack.popTile();this.copyTileRegion(Ut,x.new3(T).scaledBy1(1/this.currentTextureSize()),x.new3(T).scaledBy1(1/this.currentTextureSize()),lt.PREMULTIPLIED),this._tileStack.freeTileToPool(We),this._tileStack.freeTileToPool(ae),xe||this._tileStack.freeTileToPool(Je),this._tileStack.freeTileToPool(Ut)}renderProgressiveBlur(e,r,n,o,i,a,s,l,c,d,u,p,_){let A=this.scaleLimitForBlursAndEffects(s),m=Math.min(64,A*s*this.currentTextureSize()),g=m/this.currentTextureSize(),S=g/s;S>2/this.currentTextureSize()&&(S=Math.round(S*this.currentTextureSize())/this.currentTextureSize(),m=Math.min(64,S*s*this.currentTextureSize()),g=m/this.currentTextureSize());let R=X.new2().translatedBy2(.5,.5).scaledBy2(S).translatedBy2(-.5,-.5),E=x.new3(l).scaledBy1(1/this.currentTextureSize());E=R.transformRect(E);let P=x.new3(E).expandedBy2(g,g),T=R.multipliedBy1(a),f=null;if(!d.isInvalid()){f=T.transformRect(d.clone()),f.scaledBy1(this.currentTextureSize());let We=Math.ceil(f.left()-.5)+.5,pt=Math.ceil(f.top()-.5)+.5,Mt=Math.floor(f.right()+.5)-.5,nr=Math.floor(f.bottom()+.5)-.5;f=new x(We,pt,Mt-We,nr-pt),f.scaledBy1(1/this.currentTextureSize())}let y=x.new3(P).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded(),v=e/r,w=m*v,I=m,C=T.transformPoint(O.new(n)),L=T.transformPoint(O.new(o)),B=x.new3(l).scaledBy1(1/this.currentTextureSize()),V=this.needsSourceTextureForProgressiveBlur(C,L,B,w,I);if(p<1&&(this._tileStack.pushTile(x.new3(l).expandedBy1(1).rounded(),!0),V&&(this.visit(i,a,c,0),this._interruptedCommands.length>0))){this._interruptedCommands.push(new Eo(_,a,u,c,1));return}if(p<2&&(this._tileStack.pushTile(y,!0),this.visit(i,T,c,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Eo(_,a,u,c,2));return}let b=n.clone(),D=o.clone(),U=T.transformPoint(b),H=T.transformPoint(D),k=H.subtract(U),q=k.divideScalar(k.length()).divideScalar(this.currentTextureSize()),Y=new O(q.y(),-q.x()),j=this._tileStack.popTile(),ae=this._tileStack.popTile();this._tileStack.pushTile(y),this.gradientBlurTile(j,Y.x(),Y.y(),x.new3(y).scaledBy1(1/this.currentTextureSize()),x.new3(y).scaledBy1(1/this.currentTextureSize()),m*v,m,f,U,H,x.new3(y).scaledBy1(1/this.currentTextureSize())),this._tileStack.freeTileToPool(j);let xe=this._tileStack.popTile();this._tileStack.pushTile(y),this.gradientBlurTile(xe,q.x(),q.y(),x.new3(y).scaledBy1(1/this.currentTextureSize()),x.new3(y).scaledBy1(1/this.currentTextureSize()),m*v,m,f,U,H,x.new3(y).scaledBy1(1/this.currentTextureSize())),this._tileStack.freeTileToPool(xe);let Je=this._tileStack.popTile();V?this.upscaleAndBlendGradientBlurTile(Je,x.new3(l).scaledBy1(1/this.currentTextureSize()),E,m*v,m,U,H,ae,S,E):this.copyTileRegion(Je,B,E,lt.PREMULTIPLIED),this._tileStack.freeTileToPool(ae),this._tileStack.freeTileToPool(Je)}hardMaskTileWithColor(e,r,n){let o=x.new3(n);Oe.Material_setUniformVec43(this._hardMaskTileWithColorMaterial,this._materialStrings.SHADER_NAME_U_QUAD,this.scissorQuad(o)),Oe.Material_setUniformVec42(this._hardMaskTileWithColorMaterial,this._materialStrings.SHADER_NAME_U_COLOR,N.premultiplied(r)),e.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._hardMaskTileWithColorMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._hardMaskTileWithColorMaterial,this._quadArea,lt.PREMULTIPLIED),this._didDraw=!0,e.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP)}upscaleAndBlendGradientBlurTile(e,r,n,o,i,a,s,l,c,d){let u=this._upscaleAndBlendGradientBlurTileMaterial;Oe.Material_setUniformVec43(u,this._materialStrings.SHADER_NAME_QUAD,r),Oe.Material_setUniformVec43(u,this._materialStrings.SHADER_NAME_SOURCE,n),Oe.Material_setUniformVec43(u,this._materialStrings.SHADER_NAME_BLUR_RANGE_SOURCE,d),u.setUniformFloat(this._materialStrings.SHADER_NAME_START_COUNT,o),u.setUniformFloat(this._materialStrings.SHADER_NAME_END_COUNT,i),u.setUniformVec21(this._materialStrings.SHADER_NAME_BLUR_GRADIENT_START,a.x(),a.y()),u.setUniformVec21(this._materialStrings.SHADER_NAME_BLUR_GRADIENT_END,s.x(),s.y()),u.setUniformFloat(this._materialStrings.SHADER_NAME_SCALE_TO_UNADJUST,c),u.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),u.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,l.colorTextureForSampling(),1),this.drawToCurrentTile(qe.TRIANGLE_STRIP,u,this._quadArea,lt.PREMULTIPLIED),this._didDraw=!0}gradientBlurTile(e,r,n,o,i,a,s,l,c,d,u){let p;l==null?p=this._unclampedGradientBlurMaterial:(p=this._clampedGradientBlurMaterial,Oe.Material_setUniformVec43(p,this._materialStrings.SHADER_NAME_BLUR_CLAMP,l)),Oe.Material_setUniformVec43(p,this._materialStrings.SHADER_NAME_QUAD,o),Oe.Material_setUniformVec43(p,this._materialStrings.SHADER_NAME_SOURCE,i),Oe.Material_setUniformVec43(p,this._materialStrings.SHADER_NAME_BLUR_RANGE_SOURCE,u),p.setUniformFloat(this._materialStrings.SHADER_NAME_START_COUNT,a),p.setUniformFloat(this._materialStrings.SHADER_NAME_END_COUNT,s),p.setUniformVec21(this._materialStrings.SHADER_NAME_BLUR_DELTA,r,n),p.setUniformVec21(this._materialStrings.SHADER_NAME_BLUR_GRADIENT_START,c.x(),c.y()),p.setUniformVec21(this._materialStrings.SHADER_NAME_BLUR_GRADIENT_END,d.x(),d.y()),p.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(qe.TRIANGLE_STRIP,p,this._quadArea,lt.COPY),this._didDraw=!0}blurTile(e,r,n,o,i,a){let s;a==null?s=this._unclampedBlurMaterial:(s=this._clampedBlurMaterial,Oe.Material_setUniformVec43(s,this._materialStrings.SHADER_NAME_U_BLUR_CLAMP,a)),Oe.Material_setUniformVec43(s,this._materialStrings.SHADER_NAME_U_QUAD,o),s.setUniformFloat(this._materialStrings.SHADER_NAME_U_COUNT,i),s.setUniformVec21(this._materialStrings.SHADER_NAME_U_BLUR_DELTA,r,n),s.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0);let l=K.getFeatureFlags().increase_blur_max_texel_radius?1:0;s.setUniformInt(this._materialStrings.SHADER_NAME_INCREASE_MAX_RADIUS_FOR_BLURS,l),this.drawToCurrentTile(qe.TRIANGLE_STRIP,s,this._quadArea,lt.COPY),this._didDraw=!0}glassTile(e,r,n,o,i,a,s,l,c,d,u,p,_,h,A,m,g,S,R,E){Oe.Material_setUniformVec43(this._glassMaterial,this._materialStrings.SHADER_NAME_U_QUAD,e),this._glassMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),this._glassMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1),this._glassMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE2,o.colorTextureForSampling(),2),this._glassMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_CORNER_RADIUS_IN_PIXEL_SPACE,i),this._glassMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_SCALE,a),Oe.Material_setUniformMat32(this._glassMaterial,this._materialStrings.SHADER_NAME_NODE_TO_TILE_SPACE,s),Oe.Material_setUniformMat32(this._glassMaterial,this._materialStrings.SHADER_NAME_TILE_TO_NODE_SPACE,l),Oe.Material_setUniformVec22(this._glassMaterial,this._materialStrings.SHADER_NAME_NODE_SPACE_CENTER_POINT,c),this._glassMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_REFRACTION_INTENSITY,d),this._glassMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_REFRACTION_DISTANCE,u),this._glassMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_LIGHT_INTENSITY,A),this._glassMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_LIGHT_ANGLE,m),this._glassMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_BEVEL_SIZE,g),this._glassMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_CHROMATIC_ABERRATION,S),this._glassMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_CORNER_SMOOTHING,R);let P=N.alphaF(E);this._glassMaterial.setUniformVec41(this._materialStrings.SHADER_NAME_TINT_COLOR,N.redF(E)*P,N.greenF(E)*P,N.blueF(E)*P,P),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._glassMaterial,this._quadArea,lt.COPY),this._didDraw=!0}copyTileRegion(e,r,n,o){Oe.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.SHADER_NAME_U_QUAD,r),Oe.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.SHADER_NAME_U_SOURCE,n),this._downscaleTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._downscaleTileMaterial,this._quadArea,o),this._didDraw=!0}noiseTile(e,r,n,o,i,a,s,l,c,d){let u=this._noiseMaterial;Oe.Material_setUniformVec43(u,this._materialStrings.SHADER_NAME_U_QUAD,c),u.setUniformInt(this._materialStrings.SHADER_NAME_U_SEED,d),u.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),r=="MULTITONE"?u.setUniformInt(this._materialStrings.SHADER_NAME_U_NOISE_TYPE,0):r=="MONOTONE"?u.setUniformInt(this._materialStrings.SHADER_NAME_U_NOISE_TYPE,1):u.setUniformInt(this._materialStrings.SHADER_NAME_U_NOISE_TYPE,2),u.setUniformFloat(this._materialStrings.SHADER_NAME_U_NOISE_SIZE,n),u.setUniformFloat(this._materialStrings.SHADER_NAME_U_DENSITY,o),u.setUniformVec41(this._materialStrings.SHADER_NAME_U_COLOR,N.redF(i),N.greenF(i),N.blueF(i),N.alphaF(i)),u.setUniformVec41(this._materialStrings.SHADER_NAME_U_SECONDARY_COLOR,N.redF(a),N.greenF(a),N.blueF(a),N.alphaF(a)),u.setUniformVec21(this._materialStrings.SHADER_NAME_U_NODE_SPACE_CENTER_POINT,s.x(),s.y()),u.setUniformMat31(this._materialStrings.SHADER_NAME_U_TILE_TO_NODE_SPACE,l.m00(),l.m01(),l.m02(),l.m10(),l.m11(),l.m12()),this.drawToCurrentTile(qe.TRIANGLE_STRIP,u,this._quadArea,lt.COPY),this._didDraw=!0}unclampedGrainTile(e,r,n,o,i,a,s,l,c){let d=this._unclampedGrainMaterial;Oe.Material_setUniformVec43(d,this._materialStrings.SHADER_NAME_U_QUAD,n),d.setUniformInt(this._materialStrings.SHADER_NAME_U_SEED,c),d.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),d.setUniformFloat(this._materialStrings.SHADER_NAME_RADIUS_IN_PIXEL_SPACE,r),d.setUniformFloat(this._materialStrings.SHADER_NAME_SCALE,o),d.setUniformFloat(this._materialStrings.SHADER_NAME_NOISE_SIZE,i),Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_NODE_TO_TILE_SPACE,a),Oe.Material_setUniformMat32(d,this._materialStrings.SHADER_NAME_TILE_TO_NODE_SPACE,s),Oe.Material_setUniformVec22(d,this._materialStrings.SHADER_NAME_NODE_SPACE_CENTER_POINT,l),this.drawToCurrentTile(qe.TRIANGLE_STRIP,d,this._quadArea,lt.COPY),this._didDraw=!0}clampedGrainTile(e,r,n,o,i,a,s,l,c,d){let u=this._clampedGrainMaterial;Oe.Material_setUniformVec43(u,this._materialStrings.SHADER_NAME_U_QUAD,o),u.setUniformInt(this._materialStrings.SHADER_NAME_U_SEED,d),u.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),u.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,e.colorTextureForSampling(),1),u.setUniformFloat(this._materialStrings.SHADER_NAME_RADIUS_IN_PIXEL_SPACE,n),u.setUniformFloat(this._materialStrings.SHADER_NAME_SCALE,i),u.setUniformFloat(this._materialStrings.SHADER_NAME_NOISE_SIZE,a),Oe.Material_setUniformMat32(u,this._materialStrings.SHADER_NAME_NODE_TO_TILE_SPACE,s),Oe.Material_setUniformMat32(u,this._materialStrings.SHADER_NAME_TILE_TO_NODE_SPACE,l),Oe.Material_setUniformVec22(u,this._materialStrings.SHADER_NAME_NODE_SPACE_CENTER_POINT,c),this.drawToCurrentTile(qe.TRIANGLE_STRIP,u,this._quadArea,lt.COPY),this._didDraw=!0}scissorQuad(e){return e.scaledBy1(1/this.currentTextureSize())}blendAndPopTile(e,r){if(e=="PASS_THROUGH"||e=="NORMAL"||e=="SCREEN"||e=="LINEAR_DODGE"){let n=this._tileStack.popTile(),o=this.scissorQuad(x.new3(n.scissor()));Oe.Material_setUniformVec43(this._blendTileSimpleMaterial,this._materialStrings.SHADER_NAME_U_QUAD,o);let i;e=="PASS_THROUGH"?(this._blendTileSimpleMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,1),i=lt.createInterpolateBlendState(r)):(this._blendTileSimpleMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,r),e=="SCREEN"?i=lt.SCREEN:e=="LINEAR_DODGE"?i=lt.LINEAR_DODGE:i=lt.PREMULTIPLIED),n.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._blendTileSimpleMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,n.colorTextureForSampling(),0),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._blendTileSimpleMaterial,this._quadArea,i),this._didDraw=!0,n.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n)}else{this.duplicateTile2(this._currentTile1().scissor(),1);let n=this._tileStack.popTile(),o=this._tileStack.popTile(),i=this.scissorQuad(x.new3(o.scissor()));Oe.Material_setUniformVec43(this._blendTileCustomMaterial,this._materialStrings.SHADER_NAME_U_QUAD,i),this._blendTileCustomMaterial.setUniformInt(this._materialStrings.SHADER_NAME_U_TYPE,gB.get(e)),this._blendTileCustomMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,r),o.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),n.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._blendTileCustomMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,o.colorTextureForSampling(),0),this._blendTileCustomMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,n.colorTextureForSampling(),1),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._blendTileCustomMaterial,this._quadArea,lt.COPY),this._didDraw=!0,n.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),o.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n),this._tileStack.freeTileToPool(o)}}upscaleTile(e,r,n){Oe.Material_setUniformVec43(this._upscaleTileMaterial,this._materialStrings.SHADER_NAME_U_QUAD,r),Oe.Material_setUniformVec43(this._upscaleTileMaterial,this._materialStrings.SHADER_NAME_U_SOURCE,n),this._upscaleTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._upscaleTileMaterial,this._quadArea,lt.PREMULTIPLIED),this._didDraw=!0}downscaleTile(e,r,n){Oe.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.SHADER_NAME_U_QUAD,r),Oe.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.SHADER_NAME_U_SOURCE,n),this._downscaleTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._downscaleTileMaterial,this._quadArea,lt.COPY),this._didDraw=!0}hardMaskWithColorAndDownscaleTile(e,r,n,o){Oe.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.SHADER_NAME_U_QUAD,n),Oe.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.SHADER_NAME_U_SOURCE,o),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),Oe.Material_setUniformVec42(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.SHADER_NAME_U_COLOR,N.premultiplied(r)),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_TEXTURE_SIZE,this.currentTextureSize()),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_TEXTURE_PX,1/this.currentTextureSize()),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._hardMaskWithColorAndDownscaleTileMaterial,this._quadArea,lt.COPY),this._didDraw=!0}_advanceGIFAndUpload(e,r){var o;let n=(o=e.gif())==null?void 0:o.nextFrameIfNecessary();n!=null&&hi.Texture_resize3(r,e.width(),e.height(),cr.createFromPixels(e.width(),e.height(),n))}getOrCreateImageTexture(e){var i,a,s;if((e==null?void 0:e.image)==null)return null;this._neededImagesOrNull!=null&&Lp.add(this._neededImagesOrNull,e);let r=e.image,n=e.purpose,o=r.texture();return o!=null?r.gif()!=null&&this._advanceGIFAndUpload(r,o):(((i=r.decodedData())==null?void 0:i.pixels)!=null||r.gif()!=null)&&(o=this._context.createTexture(r.isCompressedTexture()?K.shouldUseDesktopCompressedTextureFormat()?Me.BC3_NEAREST_CLAMP:Me.ASTC_6X6_NEAREST_CLAMP:Me.RGBA_NEAREST_CLAMP,r.width(),r.height(),br.IMAGE),o.setShouldUnloadImageBuffer(K.shouldApplyMobileOptimizations()),r.setTexture(o),((a=r.decodedData())==null?void 0:a.pixels)!=null?(hi.Texture_resize3(r.texture(),r.width(),r.height(),r.decodedData()),K.shouldApplyMobileOptimizations()&&r.freeMemoryForDecodedData()):r.gif()!=null&&this._advanceGIFAndUpload(r,o)),r.state()==0&&((s=this._requestImage)==null||s.call(this,r,n)),o}duplicateTile1(e){this.duplicateTile2(e,0)}duplicateTile2(e,r){let n=this._currentTile2(r),o=n.isColorClear()||n.needsColorClear(),i=o;this._tileStack.pushTile(e,i);let a=this._currentTile1();if(o)return;let s=n.colorTextureForSampling();s.setFormat(Me.RGBA_NEAREST_CLAMP);let l=n.uvSpaceRect(),c=e?this.scissorQuad(x.new3(e)):x.UNIT,d=new x(l.x()+l.width()*c.x(),l.y()+l.height()*c.y(),l.width()*c.width(),l.height()*c.height()),u=new x(-1+2*c.x(),-1+2*c.y(),2*c.width(),2*c.height());this.drawTexture1(s,d,null,u,0),s.setFormat(Me.RGBA_LINEAR_CLAMP)}renderBlend(e,r,n,o,i,a){if(a<1){let s=this.allocateAndComputeTileScissor(n,this.bounds(r.child)),l=x.new3(this._currentTile1().scissor()).intersectedWith(s);if(l.isEmpty())return;if(e?this._currentTile1().pushScissorRect(l.clone()):this.blendModePreTraverseHelper(r.blendMode,l),this.visitWithCanvasSpaceTileBounds(r.child,n,o,i,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new hf(e,r,n,o,i));return}}e?this._currentTile1().popScissor():this.blendAndPopTile(r.blendMode,r.opacity)}maskBackgroundBlurTile(e,r,n){Re.flushBeforeMasks()&&this._context.flush();let o=x.new3(n);Oe.Material_setUniformVec43(this._maskBackgroundBlurTileMaterial,this._materialStrings.SHADER_NAME_U_QUAD,this.scissorQuad(o)),r.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._maskBackgroundBlurTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),this._maskBackgroundBlurTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._maskBackgroundBlurTileMaterial,this._quadArea,lt.COPY),this._didDraw=!0,e.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP)}maskInnerShadowTile(e,r,n,o,i){Re.flushBeforeMasks()&&this._context.flush();let a=x.new3(n),s=i?this._maskInnerShadowTileAndFirstHardMaskAlpha:this._maskInnerShadowTileMaterial;Oe.Material_setUniformVec43(s,this._materialStrings.SHADER_NAME_U_QUAD,this.scissorQuad(a)),Oe.Material_setUniformVec42(s,this._materialStrings.SHADER_NAME_U_COLOR,N.premultiplied(o)),r.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),s.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),s.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(qe.TRIANGLE_STRIP,s,this._quadArea,lt.PREMULTIPLIED),e.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTile(e,r,n){Re.flushBeforeMasks()&&this._context.flush();let o=x.new3(n);Oe.Material_setUniformVec43(this._maskTileMaterial,this._materialStrings.SHADER_NAME_U_QUAD,this.scissorQuad(o)),r.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._maskTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),this._maskTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._maskTileMaterial,this._quadArea,lt.PREMULTIPLIED),e.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminance(e,r,n){Re.flushBeforeMasks()&&this._context.flush();let o=x.new3(n);Oe.Material_setUniformVec43(this._maskTileLuminanceMaterial,this._materialStrings.SHADER_NAME_U_QUAD,this.scissorQuad(o)),r.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._maskTileLuminanceMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),this._maskTileLuminanceMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._maskTileLuminanceMaterial,this._quadArea,lt.PREMULTIPLIED),e.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminancePassThrough(e,r,n,o){Re.flushBeforeMasks()&&this._context.flush();let i=x.new3(o);Oe.Material_setUniformVec43(this._maskTileLuminancePassThroughMaterial,this._materialStrings.SHADER_NAME_U_QUAD,this.scissorQuad(i)),n.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),r.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,n.colorTextureForSampling(),0),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,e.colorTextureForSampling(),1),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE2,r.colorTextureForSampling(),2),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._maskTileLuminancePassThroughMaterial,this._quadArea,lt.COPY),r.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTilePassThrough(e,r,n,o){Re.flushBeforeMasks()&&this._context.flush();let i=x.new3(o);Oe.Material_setUniformVec43(this._maskTilePassThroughMaterial,this._materialStrings.SHADER_NAME_U_QUAD,this.scissorQuad(i)),n.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),r.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,n.colorTextureForSampling(),0),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,e.colorTextureForSampling(),1),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE2,r.colorTextureForSampling(),2),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._maskTilePassThroughMaterial,this._quadArea,lt.COPY),r.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTile(e,r,n){Re.flushBeforeMasks()&&this._context.flush();let o=x.new3(n);Oe.Material_setUniformVec43(this._maskKnockoutShadowTileMaterial,this._materialStrings.SHADER_NAME_U_QUAD,this.scissorQuad(o)),r.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,r.colorTextureForSampling(),0),this._maskKnockoutShadowTileMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,e.colorTextureForSampling(),1),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._maskKnockoutShadowTileMaterial,this._quadArea,lt.PREMULTIPLIED),e.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTilePassThrough(e,r,n,o){Re.flushBeforeMasks()&&this._context.flush();let i=x.new3(o);Oe.Material_setUniformVec43(this._maskKnockoutShadowTilePassThroughMaterial,this._materialStrings.SHADER_NAME_U_QUAD,this.scissorQuad(i)),n.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),r.colorTextureForSampling().setFormat(Me.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,n.colorTextureForSampling(),0),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE1,e.colorTextureForSampling(),1),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE2,r.colorTextureForSampling(),2),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._maskKnockoutShadowTilePassThroughMaterial,this._quadArea,lt.COPY),r.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(Me.RGBA_LINEAR_CLAMP),this._didDraw=!0}downsampleSuperSSAATile(e,r){let n=this.downscaleRectForSSAA(e.scissor().clone());n.expand1(1),n.round(),this._tileStack.pushScissor(n);let o;switch(this._tileConfig.SUPERSAMPLE_COUNT()){case 4:{o=this._superSSAA4x4DownsampleMaterial;break}case 2:{o=this._blendTextureMaterial;break}default:throw new Error(`Unrecognized SUPERSAMPLE_COUNT (${this._tileConfig.SUPERSAMPLE_COUNT()}) when downsampling`)}o.setUniformInt(this._materialStrings.SHADER_NAME_TILE_ATLAS_TILE_SIZE,this._tileConfig.baseTileSize),o.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,1),o.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(qe.TRIANGLE_STRIP,o,this._quadArea,r),this._tileStack.popScissorFromCurrentTile()}renderSinglePatternPaint(e,r,n,o,i,a,s,l,c){let d=i,u=o.patternSourceAbsoluteBounds(),p=i.currentBounds(this._boundsCache),_=o.patternScale(),h=u.width()*_,A=u.height()*_,m=new O(o.patternSpacing().x()*h,o.patternSpacing().y()*A),g=p.size().multiplyScalar(_*a),S=new O(h+m.x(),A+m.y());if(h+m.x()<=0||A+m.y()<=0)return;let R=O.new();switch(o.patternHorizontalAlignment()){case"START":R.setX(0);break;case"CENTER":R.setX(s.width()/2-h/2);break;case"END":R.setX(s.width()-h);break}switch(o.patternVerticalAlignment()){case"START":R.setY(0);break;case"CENTER":R.setY(s.height()/2-A/2);break;case"END":R.setY(s.height()-A);break}if(R.setX(R.x()%S.x()-S.x()),R.setY(R.y()%S.y()-S.y()),o.patternTileType()=="HORIZONTAL_HEXAGONAL"){let I=Math.floor((s.height()+m.y())/S.y())+1;o.patternVerticalAlignment()=="CENTER"?I>1&&Math.floor(I/2)%2==0&&R.setX(R.x()+S.x()/2):o.patternVerticalAlignment()=="END"&&I>1&&I%2==1&&R.setX(R.x()+S.x()/2)}else if(o.patternTileType()=="VERTICAL_HEXAGONAL"){let I=Math.floor((s.width()+m.x())/S.x())+1;o.patternHorizontalAlignment()=="CENTER"?I>1&&Math.floor(I/2)%2==0&&R.setY(R.y()+S.y()/2):o.patternHorizontalAlignment()=="END"&&I>1&&I%2==1&&R.setY(R.y()+S.y()/2)}let E=S.multiplyScalar(a),P=new O(h,A).multiplyScalar(a),T=!1;if((g.x()>=l||g.y()>=l)&&(T=!0),!T){this._tileStack.pushTile(new x(0,0,Math.max(E.x(),P.x(),g.x()),Math.max(E.y(),P.y(),g.y())).scaledBy1(this._tileConfig.SUPERSAMPLE_COUNT()).expandedBy1(1));let I=mn.new2().scaledBy(1/l).scaledBy(a).scaledBy(_).translatedBy1(p.topLeft().multiplyScalar(-1)),C=X.new2();this.visit(d,X.new4(I),C,0)}let f=X.new3(n).translatedBy1(s.topLeft()).scaledBy1(s.size()),y=p.size().subtract(u.size()).multiplyScalar(_),v=u.topLeft().subtract(p.topLeft()).multiplyScalar(_),w=0;switch(o.patternTileType()){case"RECTANGULAR":w=0;break;case"HORIZONTAL_HEXAGONAL":w=1;break;case"VERTICAL_HEXAGONAL":w=2;break}if(!T&&m.x()>=0&&m.y()>=0&&y.x()<=m.x()&&y.y()<=m.y()){let I=this._tileStack.popTile();IP(this._imagePatternMaterial,this._materialStrings,X.new2(),f,E,v.multiplyScalar(a),l,s.size().multiplyScalar(a),R.multiplyScalar(a),w,I.colorTextureForSampling()),this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._imagePatternMaterial,this._quadArea,c),this._tileStack.freeTileToPool(I)}else{let I=Math.ceil(s.width()/Math.max(.01,h+m.x()))+2,C=Math.ceil(s.height()/Math.max(.01,A+m.y()))+2,L=Math.floor((p.right()-u.left())*_/(h+m.x())),B=Math.ceil((u.right()-p.left())*_/(h+m.x())),V=Math.floor((p.bottom()-u.top())*_/(A+m.y())),b=Math.ceil((u.bottom()-p.top())*_/(A+m.y())),D=s.topLeft().subtract(u.topLeft()).multiplyScalar(_).subtract(new O(h+m.x(),A+m.y())),U;if(!T){let z=I+L+B,q=C+V+b;U=new Float32Array((z*q*4+(z*q-1)*2)*5)}let H=0,k=z=>{U[H*5]=z.x,U[H*5+1]=z.y,U[H*5+2]=z.u,U[H*5+3]=z.v,H++};for(let z=-V;z<C+b;z++)for(let q=-L;q<I+B;q++){let Y=R.x(),j=R.y();switch(o.patternTileType()){case"RECTANGULAR":break;case"HORIZONTAL_HEXAGONAL":Math.abs(z)%2==1&&(Y+=S.x()/2);break;case"VERTICAL_HEXAGONAL":Math.abs(q)%2==1&&(j+=S.y()/2);break}let ae=new O((h+m.x())*q,(A+m.y())*z),xe=new O(Y,j);if(T)this.visit(d,X.new3(e).multipliedBy1(r).translatedBy1(ae).translatedBy1(D).translatedBy1(xe).scaledBy2(_),X.new2(),0);else{let Je=new O(h+m.x(),A+m.y()).multiplyScalar(-1).divide(p.size().multiplyScalar(_)).subtract(v.divide(p.size().multiplyScalar(_))),We=ae.add(xe).divide(p.size().multiplyScalar(_)),pt=Je.add(We),Mt=X.new2().scaledBy2(_).translatedBy1(pt),nr=Mt.transformPoint(new O(0,0)),ir=Mt.transformPoint(new O(1,0)),le=Mt.transformPoint(new O(0,1)),Ut=Mt.transformPoint(new O(1,1)),mt={x:nr.x(),y:nr.y(),u:0,v:0};(q>-L||z>-V)&&k(mt),k(mt),k({x:ir.x(),y:ir.y(),u:1,v:0}),k({x:le.x(),y:le.y(),u:0,v:1});let He={x:Ut.x(),y:Ut.y(),u:1,v:1};k(He),(q<I+B-1||z<C+b-1)&&k(He)}}if(!T&&U!==void 0&&U.length>0){let z=this._tileStack.popTile();RP(this._imagePatternSingleMaterial,this._materialStrings,X.new2().scaledBy1(g.divideScalar(l)),X.new3(n).translatedBy1(s.topLeft()).scaledBy1(p.size()),z.colorTextureForSampling());let q=this._bufferPool.allocateVertexBufferAreas(qe.TRIANGLE_STRIP,It.getPositionF2CoordF3(),new Uint8Array(U.buffer));for(let Y=0,j=q.length;Y<j;Y=Y+1)this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._imagePatternSingleMaterial,q[Y],c);for(let Y=0;Y<q.length;Y+=1)q[Y].free();this._tileStack.freeTileToPool(z)}}this._didDraw=!0}drawTextureRegion1(e,r,n){this.drawTextureRegion2(e,r,yt.FrozenAffineTransform_IDENTITY,n,1)}drawTextureRegion2(e,r,n,o,i){let a=e.uvSpaceRect,s=null;if(e.texture.format().minFilter==1||e.texture.format().magFilter==1){s=a.clone();let l=1/e.texture.width();s.contract(l/2)}this.drawTexture2(e.texture,e.uvSpaceRect,s,r,n,o,i)}drawTexture1(e,r,n,o,i){this.drawTexture2(e,r,n,o,yt.FrozenAffineTransform_IDENTITY,i,1)}drawTexture2(e,r,n,o,i,a,s){let l=this._setupDrawTextureState(e,r,n,o,i,a,s);this.drawToCurrentTile(qe.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea,l),this._didDraw=!0}drawTextureToCurrentFramebuffer(e,r,n,o,i,a,s,l,c){let d=this._setupDrawTextureState(e,r,n,o,i,a,s);this._context.draw(qe.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea,d,_r.NONE,l,null,c)}_setupDrawTextureState(e,r,n,o,i,a,s){let l;switch(a){case 0:{l=lt.COPY;break}case 1:{l=lt.PREMULTIPLIED;break}}return Oe.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.SHADER_NAME_U_UV_SPACE_CLAMPING_RECT,n??r),Oe.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.SHADER_NAME_U_UV_SPACE_SOURCE_RECT,r),Oe.Material_setUniformMat32(this._drawTextureMaterial,this._materialStrings.SHADER_NAME_U_TO_CLIP_SPACE_TRANSFORM,i),Oe.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.SHADER_NAME_U_DESTINATION_RECT,o),this._drawTextureMaterial.setUniformFloat(this._materialStrings.SHADER_NAME_U_OPACITY,s),this._drawTextureMaterial.setUniformSampler(this._materialStrings.SHADER_NAME_TEXTURE0,e,0),l}renderLayerByLayerActivate(e){this._layerByLayerRendering.activate(e)}renderLayerByLayerDeactivate(){this._layerByLayerRendering.deactivate()}finishLayerByLayerDrawToScreen(){this._layerByLayerRendering.finishLayerByLayerDrawToScreen()}isLayerByLayerRenderingEnabled(){return this._layerByLayerRendering.isEnabled()}treeToRender(e){return this._layerByLayerRendering.treeToRender(e)??e}renderLayerByLayerPlay(){this._layerByLayerRendering.play()}renderLayerByLayerPause(){this._layerByLayerRendering.pause()}renderLayerByLayerForward(){this._layerByLayerRendering.forward()}renderLayerByLayerBackward(){this._layerByLayerRendering.backward()}renderLayerByLayerRewind(){this._layerByLayerRendering.rewind()}renderLayerByLayerIncreaseSpeed(){this._layerByLayerRendering.increaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._layerByLayerRendering.decreaseSpeed()}},il=class{constructor(e,r,n,o,i,a,s){this.renderTree=e,this.shouldCollectNeededImages=r,this.boundsCache=n,this.requestImage=o,this.shouldDisableAllAntialiasing=i,this.outputTextureNeedsClear=a,this.useLargeTilesForDrawToScreen=s}};(r=>{class t{constructor(o,i,a){this._maxUsedTilesPerDrawByTileSize=new Map;this._maxUsedTilesSinceResetByTileSize=new Map;this._context=o,this._tileConfig=a,this._tilePools=new Map([[this._tileConfig.baseTileSize,[]],[this._tileConfig.SSAA_SIZE(),[]]]),this._stack=[],this._tileSizeState=r.TileStack.TileSizeState.REGULAR;let s=this._tileConfig.baseTileSize;this._liveTileCount=new Map([[s,0],[this._tileConfig.SSAA_SIZE(),0]]),this._sharedStencilTexture=null,this._sharedSSAAStencilTexture=null,this._transparentClearTexture=i;let l=this._tileConfig.SSAA_SIZE();this._defaultScissors=new Map([[this._tileConfig.baseTileSize,new x(0,0,this._tileConfig.baseTileSize,this._tileConfig.baseTileSize)],[this._tileConfig.SSAA_SIZE(),new x(0,0,this._tileConfig.SSAA_SIZE(),this._tileConfig.SSAA_SIZE())]])}debugString(){var o,i;return`TileStack(
            on stack:
                ${this._stack.filter(a=>a.tileSize()==this._tileConfig.baseTileSize).length} small,
                ${this._stack.filter(a=>a.tileSize()==this._tileConfig.SSAA_SIZE()).length} SSAA
                out of ${this._stack.length} tilestack tiles
            free pools:
                (${this._tileConfig.baseTileSize}, ${(o=this._tilePools.get(this._tileConfig.baseTileSize))==null?void 0:o.length}),
                (${this._tileConfig.SSAA_SIZE()}, ${(i=this._tilePools.get(this._tileConfig.SSAA_SIZE()))==null?void 0:i.length});
            total live:
                ${this._liveTileCount.get(this._tileConfig.baseTileSize)} small,
                ${this._liveTileCount.get(this._tileConfig.SSAA_SIZE())} SSAA;
            max used for tile:
                ${this._maxUsedTilesPerDrawByTileSize.get(this._tileConfig.baseTileSize)} small,
                ${this._maxUsedTilesPerDrawByTileSize.get(this._tileConfig.SSAA_SIZE())} SSAA;
            max used since reset:
                ${this._maxUsedTilesSinceResetByTileSize.get(this._tileConfig.baseTileSize)} small,
                ${this._maxUsedTilesSinceResetByTileSize.get(this._tileConfig.SSAA_SIZE())} SSAA;
            SSAA state: ${r.TileStack.TileSizeState[this._tileSizeState]}
        )
        `}resetUsedTiles(){this._maxUsedTilesSinceResetByTileSize.clear()}reclaim(){let o=new Map,i=new Map;for(let[a,s]of this._tilePools){let l=this._maxUsedTilesSinceResetByTileSize.get(a)||0,c=s.length-l;if(o.set(a,c),i.set(a,s.length),K.shouldReclaimTileStackTiles()&&c>0){let d=s.pop();d&&d.deleteTexture(),this._liveTileCount.set(a,this._liveTileCount.get(a)?this._liveTileCount.get(a)-1:0),be.trackDefinedEvent("mobile_platform.tilestack_tile_reclamation",{small_tiles_pool:i.get(this._tileConfig.baseTileSize),small_tiles_reclaimable:o.get(this._tileConfig.baseTileSize),ssaa_tiles_pool:i.get(this._tileConfig.SSAA_SIZE()),ssaa_tiles_reclaimable:o.get(this._tileConfig.SSAA_SIZE())})}}}setSSAARenderState(){this._tileSizeState=r.TileStack.TileSizeState.SUPERSAMPLING}unsetSSAARenderState(){this._tileSizeState=r.TileStack.TileSizeState.REGULAR}setDrawToScreenLargeTileState(){this._tileSizeState=r.TileStack.TileSizeState.DRAW_TO_SCREEN_LARGE_TILES}unsetDrawToScreenLargeTileState(){this._tileSizeState=r.TileStack.TileSizeState.REGULAR}isEmpty(){return this._stack.length==0}count(){return this._stack.length}get(o){return this._stack[o]}last(){return this._stack.length==0?null:ie.List_last(this._stack)}assertPoolAfterRender(){for(let[o,i]of this._maxUsedTilesPerDrawByTileSize){let a=this._maxUsedTilesSinceResetByTileSize.get(o)||0;this._maxUsedTilesSinceResetByTileSize.set(o,Math.max(i,a))}this._maxUsedTilesPerDrawByTileSize.clear()}popScissorFromCurrentTile(){ie.List_last(this._stack).popScissor()}takeScissorFromCurrentTile(){return ie.List_last(this._stack).takeScissor()}freeTileToPool(o){o.clearScissors(),o.setIsColorClear(!1),o.setNeedsColorClear(!0),o.setNeedsDepthStencilClear(!0),o.setScissorForClear(null),o.tileSize()==this._tileConfig.SSAA_SIZE()?this._tilePools.get(this._tileConfig.SSAA_SIZE()).push(o):this._tilePools.get(this._tileConfig.baseTileSize).push(o)}pushScissor(o){let i=ie.List_last(this._stack);i.pushScissorRect(o.clone());let a=i.scissorForClear()}pushTile(o,i=!0){let a=this._allocateTileFromPool();this._stack.push(a),i||a.setNeedsColorClear(!1),a.backingColorTexture().hasContentBeenInitialized()||a.setNeedsColorClear(!0),a.backingDepthStencilTexture()!=null&&!a.backingDepthStencilTexture().hasContentBeenInitialized()&&a.setNeedsDepthStencilClear(!0),K.viewerScissorClear()&&a.setScissorForClear(o??this.defaultTileScissor()),this.pushScissor(o)}pushTileAndClearToColor(o,i){this.pushTile(i),o!=N.TRANSPARENT&&ie.List_last(this._stack).clearToColor(o)}pushTileBackedByExistingFramebuffer(o,i,a){let s=a.outputTextureNeedsClear,l=a.useLargeTilesForDrawToScreen?this._tileConfig.SSAA_SIZE():this._tileConfig.baseTileSize,c=!s,d=new r.TileStackTile(1,l,this._context,o,i,c,this._tileConfig,this._transparentClearTexture);this._stack.push(d),d.setNeedsColorClear(s),d.setNeedsDepthStencilClear(s)}pushTileBackedByExistingFramebufferAndClearToColor(o,i,a,s){this.pushTileBackedByExistingFramebuffer(o,i,a),s!=N.TRANSPARENT&&ie.List_last(this._stack).clearToColor(s)}popTile(){return this._stack.pop()??null}totalVRAM(){let o=0;this._sharedStencilTexture!=null&&(o=o+hi.Texture_totalVRAM(this._sharedStencilTexture));for(let i of this._tilePools.get(this._tileConfig.baseTileSize))o=o+hi.Texture_totalVRAM(i.backingColorTexture());for(let i of this._tilePools.get(this._tileConfig.SSAA_SIZE()))o=o+hi.Texture_totalVRAM(i.backingColorTexture());for(let i of this._stack)o=o+hi.Texture_totalVRAM(i.backingColorTexture());return o}_pool(){return this._tileSizeState==r.TileStack.TileSizeState.REGULAR?this._tilePools.get(this._tileConfig.baseTileSize):this._tilePools.get(this._tileConfig.SSAA_SIZE())}_size(){return this._tileSizeState==r.TileStack.TileSizeState.REGULAR?this._tileConfig.baseTileSize:this._tileConfig.SSAA_SIZE()}defaultTileScissor(){return this._defaultScissors.get(this._size())}_purpose(){return this._tileSizeState==r.TileStack.TileSizeState.REGULAR?"TileStack":this._tileSizeState==r.TileStack.TileSizeState.SUPERSAMPLING?"SSAATileStack":"DrawToScreenLargeTiles"}_sizeState(){return this._tileSizeState}_allocateTileFromPool(){let o=this._pool(),i=this._size(),a=this._purpose(),s=this._sizeState(),l=null,c=this._maxUsedTilesPerDrawByTileSize.get(i)||0,d=this._stack.filter(u=>u.tileSize()==i).length+1;if(this._maxUsedTilesPerDrawByTileSize.set(i,Math.max(c,d)),o!=null&&o.length!=0)l=o.pop();else{this._liveTileCount.set(i,this._liveTileCount.get(i)+1);let u;s==r.TileStack.TileSizeState.REGULAR?(this._sharedStencilTexture==null&&(this._sharedStencilTexture=this._context.createTexture(Me.STENCIL,i,i,br.TILE_STACK)),u=this._sharedStencilTexture):(s==r.TileStack.TileSizeState.SUPERSAMPLING||s==r.TileStack.TileSizeState.DRAW_TO_SCREEN_LARGE_TILES)&&(this._sharedSSAAStencilTexture==null&&(this._sharedSSAAStencilTexture=this._context.createTexture(Me.STENCIL,i,i,br.TILE_STACK)),u=this._sharedSSAAStencilTexture),l=new r.TileStackTile(0,i,a,u,this._context,this._tileConfig,this._transparentClearTexture)}return l}_isAllocatedUnusedTile(o){return o!=null&&o!=this.last()&&this._stack.indexOf(o)==-1&&this._tilePools.get(this._tileConfig.baseTileSize).indexOf(o)==-1&&this._tilePools.get(this._tileConfig.SSAA_SIZE()).indexOf(o)==-1}}r.TileStack=t,(o=>{let n;(l=>(l[l.REGULAR=0]="REGULAR",l[l.SUPERSAMPLING=1]="SUPERSAMPLING",l[l.DRAW_TO_SCREEN_LARGE_TILES=2]="DRAW_TO_SCREEN_LARGE_TILES"))(n=o.TileSizeState||(o.TileSizeState={}))})(t=r.TileStack||(r.TileStack={}));class e{constructor(){this._scissorForClear=null;if(arguments[0]==0){let[,o,i,a,s,l,c]=arguments;this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=s,this._framebuffer=this._context.createFramebuffer(this._context.createTexture(Me.RGBA_LINEAR_CLAMP,o,o,br.TILE_STACK),a,i),this._tileConfig=l,this._viewport=new x(0,0,o,o),this._isBackedBySingleTileTexture=!0,this._transparentClearTexture=c,this._isColorClear=!0,this._scissorStack=new xp(this._framebuffer)}else if(arguments[0]==1){let[o,i,a,s,l,c,d,u]=arguments;this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=a,this._tileConfig=d,this._framebuffer=s,this._viewport=new x(l.x()|0,l.y()|0,i,i),this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=u,this._isColorClear=c,this._scissorStack=new xp(this._framebuffer)}}uvSpaceRect(){if(this._isBackedBySingleTileTexture)return x.UNIT;{let o=this._viewport,i=this._framebuffer.colorTexture();return new x(o.x()/i.width(),o.y()/i.height(),o.width()/i.width(),o.height()/i.height())}}tileSize(){return this._viewport.width()|0}colorTextureForSampling(){return this._isColorClear||this._needsColorClear?this._transparentClearTexture:this._framebuffer.colorTexture()}backingColorTexture(){return this._framebuffer.colorTexture()}backingDepthStencilTexture(){return this._framebuffer.depthStencilTexture()}context(){return this._context}framebuffer(){return this._framebuffer}viewport(){return this._viewport}isBackedBySingleTileTexture(){return this._isBackedBySingleTileTexture}deleteTexture(){this._framebuffer.colorTexture().deleteTexture()}popScissor(){this._scissorStack.popScissor()}scissor(){return nl.last(this._scissors())}scissorsEmpty(){return nl.isEmpty(this._scissors())}scissorsCount(){return nl.count(this._scissors())}takeScissor(){let o=this._scissorStack.takeScissor();if(o==null&&(o=x.new3(this.framebuffer().bounds())),this._isBackedBySingleTileTexture)return o;let i=this._viewport;return o.setX(o.x()-i.x()),o.setY(o.y()-i.y()),o}_scissors(){let o=this._scissorStack.scissors();if(this._isBackedBySingleTileTexture)return o;let i=[],a=this._viewport;for(let s=0,l=nl.count(o);s<l;s=s+1){let c=x.new3(nl.get(o,s));c.setX(c.x()-a.x()),c.setY(c.y()-a.y()),i.push(c)}return i}activeScissorRelativeToFramebuffer(){return this._scissorStack.activeScissor()}pushScissor(o,i,a,s){if(this._isBackedBySingleTileTexture)this._scissorStack.pushScissor(o,i,a,s);else{let l=this._viewport;this._scissorStack.pushScissor((l.x()|0)+o,(l.y()|0)+i,a,s)}}pushScissorRect(o){this.pushScissor(o.x()|0,o.y()|0,o.width()|0,o.height()|0)}clearScissors(){this._scissorStack.clearScissors()}clearToColor(o){if(this.needsColorClear()||this.needsDepthStencilClear()){let a=this.needsColorClear()&&this.needsDepthStencilClear()?mr.ALL:this.needsColorClear()?mr.COLOR:mr.DEPTH_STENCIL;this.doDeferredClear(a)}if(o==N.TRANSPARENT&&this.isColorClear())return;let i=null;if(this._scissorForClear!=null)i=this._scissorForClear.clone();else if(!this._isBackedBySingleTileTexture){let a=this._viewport;i=new x(a.x()|0,a.y()|0,a.width()|0,a.height()|0)}this._context.clear(mr.COLOR,o,this._framebuffer,i,this._viewport),this._isColorClear=o==N.TRANSPARENT}doDeferredClear(o){let i=null;if(this._scissorForClear!=null)i=this._scissorForClear.clone();else if(!this._isBackedBySingleTileTexture){let a=this._viewport;i=new x(a.x()|0,a.y()|0,a.width()|0,a.height()|0)}this._context.clear(o,N.TRANSPARENT,this._framebuffer,i,this._viewport),(o==mr.ALL||o==mr.COLOR)&&(this._needsColorClear=!1,this._isColorClear=!0),(o==mr.ALL||o==mr.DEPTH_STENCIL)&&(this._needsDepthStencilClear=!1)}setNeedsColorClear(o){this._needsColorClear=o}needsColorClear(){return this._needsColorClear}setNeedsDepthStencilClear(o){this._needsDepthStencilClear=o}needsDepthStencilClear(){return this._needsDepthStencilClear}setIsColorClear(o){this._isColorClear=o}isColorClear(){return this._isColorClear}setScissorForClear(o){this._scissorForClear=o}scissorForClear(){return this._scissorForClear}downloadImage(){if(0)var o}}r.TileStackTile=e})(ol||(ol={}));var Af=class{constructor(e,r,n,o){this.node=e,this.transform=r,this.framebuffer=n,this.originalOutputTextureFormat=o}equals(e){return e==this?!0:e==null?!1:e.node==this.node&&e.transform.equals2(this.transform,.001)}};var ST=class{constructor(){this.level=0,this.mode=0}};function Tf(t,e,r,n){return n==null?N.BLACK:t!=null?r?N.TRANSPARENT:e=="free"?n.computedBackgroundColor():K.prototypeBackgroundColorOverride!=null&&K.prototypeBackgroundColorOverride.value!=N.TRANSPARENT?K.prototypeBackgroundColorOverride.value:n.prototypeBackgroundColor()!=N.TRANSPARENT?n.prototypeBackgroundColor():N.BLACK:n.computedBackgroundColor()}function fB(t){switch(t){case"PASS_THROUGH":case"NORMAL":case"DARKEN":case"MULTIPLY":case"LINEAR_BURN":case"COLOR_BURN":case"LIGHTEN":case"SCREEN":case"LINEAR_DODGE":case"COLOR_DODGE":case"OVERLAY":case"SOFT_LIGHT":case"HARD_LIGHT":case"DIFFERENCE":case"EXCLUSION":case"HUE":case"SATURATION":case"COLOR":case"LUMINOSITY":return!0;default:break}return!1}var gB=new Map([["PASS_THROUGH",0],["NORMAL",1],["DARKEN",2],["MULTIPLY",3],["LINEAR_BURN",4],["COLOR_BURN",5],["LIGHTEN",6],["SCREEN",7],["LINEAR_DODGE",8],["COLOR_DODGE",9],["OVERLAY",10],["SOFT_LIGHT",11],["HARD_LIGHT",12],["DIFFERENCE",13],["EXCLUSION",14],["HUE",15],["SATURATION",16],["COLOR",17],["LUMINOSITY",18]]);var Xi=class Xi{constructor(e,r,n,o){this._boundsCache=Pa._new(),this._backbuffer=null,this._context=e,this._compositeTileCache=r,this._renderer=n,this._protoCleanUpInterruptCallback=o,this._prepareForEfficientCompositingMemoized=lT(i=>{let a=[1],s=this._prepareForEfficientCompositing(i,a);return Xi._VERBOSE_LOGS&&(console.log("Before Preparation for Rasterization"),console.log("--------------"),console.log(i.debugString1()),console.log(""),console.log("After Preparation for Rasterization"),console.log("--------------"),console.log(s.debugString1())),s})}beginFrameAndCreateBudget(){this._compositeTileCache.prepareForNewFrame(),Pa.clear(this._boundsCache),this._context.resetNumFramebufferSwitches();let e=this._compositeTileCache.maximumCapacity(),r=K.shouldLockPreRenderingRatio()?Math.ceil(e/gs.PRE_RENDERING_MULIPLIER)*gs.PRE_RENDERING_MULIPLIER:e;return r>=1e3&&(Xi._alreadyLoggedTooManyTiles||(be.trackEvent("viewer_prototype_too_many_tiles",{numTiles:r}),Xi._alreadyLoggedTooManyTiles=!0)),new Xi.FrameBudget(this._context,Xi.FrameBudget.defaultTimeBudgetInSeconds,Xi.FrameBudget.defaultTileRenderingBudget,r,Xi.FrameBudget.defaultFramebufferSwitchBudget)}prepareForEfficientCompositing(e){return e===null?null:this._prepareForEfficientCompositingMemoized(e)}_prepareForEfficientCompositing(e,r){if(e!=null&&e.isAxisAlignedRectFill()){let n=e;if(Se.onlySolidPaintOrNull(n.geometry.paints)!=null)return e}if(e.op()==11){let n=e;return new So(this._prepareForEfficientCompositing(n.child,r),n.transform)}if((e.op()==3||e.op()==4||e.op()==16)&&ie.List_last(r)>10)return e;if(e.canCacheRasterized())return new Om(e,this._compositeTileCache);switch(e.op()){case 0:{let n=e;return new ds(this._prepareForEfficientCompositing(n.child,r),n.flags)}case 2:{let n=e;return new ni(this._prepareForEfficientCompositing(n.child,r))}case 1:{let n=e,o=[],i=[];for(let a of n.children)if(a.canCacheRasterized())i.push(a);else{if(i.length!=0){let s=Ue.wrap(i);o.push(this._prepareForEfficientCompositing(s,r)),i=[]}o.push(this._prepareForEfficientCompositing(a,r))}if(i.length!=0){let a=Ue.wrap(i);o.push(this._prepareForEfficientCompositing(a,r))}return Ue.wrap(o)}case 5:{let n=e;return new tn(this._prepareForEfficientCompositing(n.alpha,r),this._prepareForEfficientCompositing(n.color,r),n.type,n.innerShadowFill,n.innerShadowAlphaRequiresHardMask)}case 6:{let n=e;if(n.endRadius>=1||n.startRadius>=1)return n;if(n.blurOpType==="NORMAL")return fo.createForStandardBlur(n.endRadius,this._prepareForEfficientCompositing(n.child,r),n.clamp);if(n.blurOpType==="PROGRESSIVE")return fo.createForProgressiveBlur(n.startRadius,n.endRadius,n.startPoint,n.endPoint,this._prepareForEfficientCompositing(n.child,r),n.clamp)}case 17:{let n=e;return qs.createForGlassEffect(n.blurRadius,n.textureRadius,n.refractionIntensity,n.refractionDistance,n.lightIntensity,n.lightAngle,n.bevelSize,n.chromaticAberration,n.reflectionRadius,n.tintColor,n.cornerRadii,n.cornerSmoothing,n.nodeToCanvasSpaceTransform,n.centerPoint,this._prepareForEfficientCompositing(n.child,r))}case 7:{let n=e;return new go(n.blendMode,n.opacity,this._prepareForEfficientCompositing(n.child,r))}case 14:{let n=e;return new $c(n.radius,n.noiseSize,n.clipToShape,this._prepareForEfficientCompositing(n.child,r),n.nodeToCanvasSpaceTransform,n.centerPoint,n.seed)}case 15:{let n=e;return new ed(n.noiseType,n.blendMode,n.noiseSize,n.density,n.color,n.secondaryColor,this._prepareForEfficientCompositing(n.child,r),n.nodeToCanvasSpaceTransform,n.nodeSpaceCenterPoint,n.seed)}case 9:{let n=e;return new oi(this._prepareForEfficientCompositing(n.alpha,r),n.color)}case 10:{let n=e;n.property==3&&r.push(n.maxTransformScale());let o=new gt(this._prepareForEfficientCompositing(n.child,r),n.id,n.property,n.getter);return n.property==3&&r.pop(),o}case 11:{let n=e;return new So(this._prepareForEfficientCompositing(n.child,r),n.transform)}case 13:{let n=e;return new Fa(this._prepareForEfficientCompositing(n.child,r),n.blurOpType,n.id,n.property,n.getter,n.getter1,n.canvasSpaceClamp,n.maxEffectRadius,n.cornerSmoothing,n.clipToShape,n.nodeToCanvasSpace,n.noiseType,n.blendMode,n.seed,n.getter2)}case 12:{let n=e;return new Nn(n.startChild!=null?this._prepareForEfficientCompositing(n.startChild,r):null,n.endChild!=null?this._prepareForEfficientCompositing(n.endChild,r):null,n.id,n.progressFn)}case 3:case 4:case 16:{if(e.hasAnimatingMedia()||e.hasVolatileContent()&&e.op()!=8)return e;throw new Error(`Unexpectedly received ${Yn[e.op()]} node`)}case 8:throw new Error(`Unexpectedly received ${Yn[e.op()]} node`);default:throw new Error(`Node type ${Yn[e.op()]} is unhandled`)}}getPrioritizedListOfTilesToPopulate(e,r,n,o){if(o==null)return[];let i=[X.new2()],a=[X.new2()],s=[1],l=[],c=u=>{switch(u.op()){case 10:{let p=u;switch(p.property){case 2:{let _=X.new3(ie.List_last(i));_.multipliedBy1(p.transform()),i.push(_);let h=X.new3(p.transform());h.invert()||h.copyFrom(yt.FrozenAffineTransform_IDENTITY),h.multipliedBy1(ie.List_last(a)),a.push(h);break}case 0:{let _=X.new3(ie.List_last(i));_.multipliedBy1(ie.List_last(a)),i.push(_);let h=X.new2();a.push(h);break}case 1:{a.push(X.new2());break}case 3:{s.push(p.maxTransformScale());break}}break}case 11:{let p=u,_=X.new3(ie.List_last(i));_.multipliedBy1(p.transform),i.push(_);let h=X.new3(p.transform);h.invert()||h.copyFrom(yt.FrozenAffineTransform_IDENTITY),h.multipliedBy1(ie.List_last(a)),a.push(h);break}case 8:{let p=u,_=ie.List_last(i),h=X.new3(_);h.invert();let A=x.new3(n);h.transformRect(A);let m=x.new3(r);h.transformRect(m);let g=e*ie.List_last(s),S=(this._context.maxTextureSize()/this._compositeTileCache.tileSize()|0)**2;K.viewerDoubleTileCompositionLimit()&&(S*=2),p.setDevicePixelPerCanvasPixel(g);let R=p.numTilesNeededForBounds(m);if(R>S){let E=Math.ceil(Math.log(R/S)/Math.log(4));g/=Math.pow(2,E),p.setDevicePixelPerCanvasPixel(g),R=p.numTilesNeededForBounds(m),R>S&&(g/=2),p.setDevicePixelPerCanvasPixel(g)}p.forEachTileWithinBounds(0,A,E=>{let T=E.bounds().distanceTo(m)*_.scale1().maxComponent();l.push(new Xi.TileWithPriority(E,T))});break}}},d=u=>{switch(u.op()){case 10:{let p=u.property;(p==2||p==0||p==1)&&ie.List_removeLast(a),(p==2||p==0)&&ie.List_removeLast(i),p==3&&ie.List_removeLast(s);break}case 11:{ie.List_removeLast(a),ie.List_removeLast(i);break}}};return Ar.visitEachNodeInTree(o,c,d),l.sort((u,p)=>u.canvasSpaceDistanceToViewport<p.canvasSpaceDistanceToViewport?-1:1),l}cleanExistingInterrupt(e){this._renderer.cleanUpExistingInterrupt(),this._compositeTileCache.devalueTile(e),this._protoCleanUpInterruptCallback(),e.tileHandleOrNull=null,e.neededImagesOrNull=null}ensureTileIsPopulatedContinue(e,r,n,o){let i=x.new2(),a=this._compositeTileCache.prepareToRenderTo(e,i),s=!0,l=new il(e.key.tree,s,this._boundsCache,o,!1,!0,!1);return this._renderer.drawTileContinued(i,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),n,a,l,r)==null?(this.cleanExistingInterrupt(e),2):(r.recordTileWasRendered(),0)}ensureTileIsPopulated(e,r,n,o){if(e.skippedPrerasterization=!1,this._compositeTileCache.hasRenderedContent(e))return r.recordTileCacheSlotWasUsed(),2;if(K.shouldApplyMobileOptimizations()&&Br.getFeatureGate("viewer_atlas_cap_capacity")&&this._compositeTileCache.capacityUsedForCurrentFrame())return e.skippedPrerasterization=!0,3;let i=x.new2(),a=this._compositeTileCache.prepareToRenderTo(e,i);r.recordTileCacheSlotWasUsed();let s=!0,l=new il(e.key.tree,s,this._boundsCache,o,!1,!0,!1),c=()=>{this.cleanExistingInterrupt(e)},d=this._renderer.drawTile(i,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),n,a,l,r,c);return d.status!=1&&r.recordTileWasRendered(),d.neededImagesOrNull!=null&&this._compositeTileCache.setNeededImagesForTile(e,d.neededImagesOrNull),d.status==1?1:0}drawToScreen(e,r,n,o,i,a){this._context.annotate("Composite",()=>{var P;let s=mn.new2();s.copyFrom(r);let l=s.invert();if(this._backbuffer==null||this._backbuffer.colorTexture().width()!=(n.size().x()|0)||this._backbuffer.colorTexture().height()!=(n.size().y()|0)){this._backbuffer!=null&&this._backbuffer.deleteTexture();let T=this._context.createTexture(Me.RGBA_LINEAR_CLAMP,n.size().x()|0,n.size().y()|0,br.BACKBUFFER),f=this._context.createTexture(Me.STENCIL,n.size().x()|0,n.size().y()|0,br.BACKBUFFER);this._backbuffer=this._context.createFramebuffer(T,f,"Compositor Backbuffer")}this._context.clear(mr.ALL,N.TRANSPARENT,this._backbuffer);let c=K.viewerLargeTilesDrawToScreen(),d=c?this._compositeTileCache.drawToScreenLargeTileSize():this._compositeTileCache.tileSize(),u=new x(0,0,d,d),p=x.new2();K.internalDebugTools()&&e!=null&&(e=this._renderer.treeToRender(e));let _=!1,h=!0,A=new il(e,_,this._boundsCache,a,h,!1,c);for(let T=n.left();T<=n.right();T+=d)for(let f=n.top();f<=n.bottom();f+=d)u.setX(T),u.setY(f),p.copyFrom(u),s.transformRect(p),u.translate2(n.topLeft().negative()),this._renderer.drawTile(u,p.x(),p.y(),p.width(),r.scale(),this._backbuffer,A,null,null);K.internalDebugTools()&&this._renderer.finishLayerByLayerDrawToScreen();let m=X.new2();m.translate2(-1,1),m.scale4(2/o.width(),-2/o.height());let g=x.new2();g.copyFrom(n),g.transformBy1(m),g.setY(g.y()+g.height()),g.setHeight(-g.height());let S=null,R=new x(o.left()|0,o.top()|0,o.width()|0,o.height()|0);this._context.clear(mr.ALL,i,S,null,R);let E=x.UNIT;this._renderer.drawTextureToCurrentFramebuffer((P=this._backbuffer)==null?void 0:P.colorTexture(),E,null,g,yt.FrozenAffineTransform_IDENTITY,1,1,S,R)})}};Xi._VERBOSE_LOGS=!1,Xi._alreadyLoggedTooManyTiles=!1;var ac=Xi;(r=>{class t{overlapsViewport(){return this.canvasSpaceDistanceToViewport==0}constructor(o,i){this.node=o,this.canvasSpaceDistanceToViewport=i}}r.TileWithPriority=t;class e{constructor(o,i,a,s,l){var c;this._context=o,this._renderingDeadline=0,this._tileRenderingBudgetRemaining=0,this._tileCacheCapacityRemaining=0,this._overrideFrameBudget=!1,this._renderingDeadline=Xe.seconds()+i,this._tileRenderingBudgetRemaining=a,this._tileCacheCapacityRemaining=s,this._framebufferSwitchBudget=l,this._budgetCreationTimeMs=Xe.milliseconds(),this._safeModeRenderingBudgetLimitMs=((c=Ed.safeModeOptions)==null?void 0:c.getForcedRenderTimeMs())??null,this.isSafeModeRendering=(this._safeModeRenderingBudgetLimitMs??0)>0}recordTileWasRendered(){this._tileRenderingBudgetRemaining=this._tileRenderingBudgetRemaining-1}recordTileCacheSlotWasUsed(){this._tileCacheCapacityRemaining=this._tileCacheCapacityRemaining-1}tileCacheCapacityRemaining(){return this._tileCacheCapacityRemaining}permitsMoreWork(){return this._safeModeRenderingBudgetLimitMs!=null&&this._safeModeRenderingBudgetLimitMs>0&&Xe.milliseconds()-this._budgetCreationTimeMs>this._safeModeRenderingBudgetLimitMs?!1:this._overrideFrameBudget?!0:!(this.pastRenderingBudgetTime()>=0||this._tileRenderingBudgetRemaining<=0||this._tileCacheCapacityRemaining<=0||this._framebufferSwitchBudget-this._context.getNumFramebufferSwitches()<=0)}pastRenderingBudgetTime(){return Xe.seconds()-this._renderingDeadline}frameBufferSwitchBudgetRemaining(){return this._framebufferSwitchBudget-this._context.getNumFramebufferSwitches()}tileRenderingBudgetRemaining(){return this._tileRenderingBudgetRemaining}permitWorkAfterBudgetExceeded(){this._overrideFrameBudget=!0}forbidWorkAfterBudgetExceeded(){this._overrideFrameBudget=!1}frameBudgetOverride(){return this._overrideFrameBudget}}e.defaultTimeBudgetInSeconds=.016,e.defaultTileRenderingBudget=2,e.defaultFramebufferSwitchBudget=250,r.FrameBudget=e})(ac||(ac={}));var AT=class{constructor(){this._emitter=Ht.getEventEmitter()}handleImageLoaded(e){this._dirtyNode(e)}handleObjectAnimationStateChange(e){this._dirtyNode(e)}handleSceneGraphEvent(e){this._shouldDirtyNodeFromEvent(e)&&this._dirtyNode(e.node)}_dirtyNode(e){let r=this._getDirtyContainerNodeFor(e);r&&this._emitter.trigger("nodeThumbnailInvalidated",r.id())}},Ef=class extends AT{_getDirtyContainerNodeFor(e){return e.findNearestAncestorOrSelf("SLIDE")}_shouldDirtyNodeFromEvent(e){switch(e.property){case 68:case 69:case 71:case 72:case 75:case 90:case 93:case 108:case 109:return!1;case 30:case 32:case 101:return e.node.type()!=="SLIDE";default:return!0}}};var If=class{constructor(e,r,n,o){this._context=e,this._tileConfig=r,this._renderer=n,this._requestImage=o,this._boundsCache=Pa._new()}generateThumbnail(e,r,n,o){if(!e.hasBeenLoaded())return null;let i=this.renderTreeForThumbnail(e);if(i==null)return null;let a=new il(i,!0,this._boundsCache,this._requestImage,!1,!1,!1);this._resetBuffer(n,o);let s=this._tileConfig.baseTileSize;for(let c=0;c<=n;c+=s)for(let d=0;d<=o;d+=s){let u=new x(c,d,s,s),p=x.new2();p.copyFrom(u),r.transformRect(p),this._renderer.drawTile(u,p.x(),p.y(),p.width(),r.scale(),this._frameBuffer,a,null,null)}return this._context.readPixels(this._frameBuffer,0,0,n,o)}renderTreeForThumbnail(e){let r=new Kt(e);return e.type()==="SLIDE"?e.renderTreeForSlideThumbnail2(r):e.type()==="FRAME"&&e.isTopLevel()?e.renderTreeForBaseScreen2(r):e.renderTree2(r)}_resetBuffer(e,r){this._frameBuffer!=null&&this._frameBuffer.deleteTexture();let n=this._context.createTexture(Me.RGBA_LINEAR_CLAMP,e,r,br.EXPORT),o=this._context.createTexture(Me.STENCIL,e,r,br.EXPORT);this._frameBuffer=this._context.createFramebuffer(n,o,"thumbnailRenderer")}};var Bo=class Bo{constructor(e,r,n,o,i,a,s,l){this._isInViewerRenderServerForTests=!1;this._frameIndexForTests=0;this._prerenderViewport=new xo,this._devicePixelRatio=0,this._needsBlit=!0,this._isAnimatedMediaPlaying=!1,this._printRenderTree=!1,this._activeRenderTree=null,this._overlayBaseScreenId=null,this._generatedOverlays=new Map,this._didRasterizeContentOnLastDraw=!0,this._observers=new dn,this.PORTION_TO_LOG=50/100,this.MAX_TRANSITION_LOGS=50,this._numTransitionsLogged=0,this._transitionStats=new Map,this._transitionWasInterruptedByVisibilityChange=!1,this._visibilityListener=null,this.HEADERS=["frame_count","transition_count","mean_frame_ms","median_transition_mean","median_transition_max","count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"],this._ongoingTransition=null,this._drewFirstFrameOfTransition=!0,this._transitionProgressTracker=new wn,this._ongoingObjectAnimation=null,this._objectAnimationProgressTracker=new wn,this._hsmTransitionMap=new Map,this._appState=r,this._context=i;let c=K.shouldApplyMobileOptimizations(),d=this._getTextureSizeForTileConfig(),u=this._getTileSizeForTileConfig();this._tileConfig=l??new La(d,u,()=>c?3:6),this._bufferPool=a,this._compositeTileCache=new Dp(this._context,this._tileConfig),this._renderer=s(this._tileConfig),this._thumbnailRenderer=new If(this._context,this._tileConfig,this._renderer,this._requestImageOnScreen);let p=()=>{this._interruptCompletionCallback=null};this._compositor=new ac(this._context,this._compositeTileCache,this._renderer,p),this._viewport=e,this._appState.addAppObserver(this),this._emitter=o,this._renderer.context().addContextResetHandler(()=>{this._deviceRenderer.clearOnContextReset(),this._viewport.invalidate(),K.shouldApplyMobileOptimizations()&&n.clearQueuesAndDecodedDataForAllImages(this._canvas())}),n.onImageLoaded=h=>{var A;h.invalidateRenderTreeForSelfAndParents(),this._dirtinessTracker.handleImageLoaded(h),(A=this._thumbnailInvalidationManager)==null||A.handleImageLoaded(h),this._viewport.invalidate()};let _=h=>{this._onBoundsInvalidate(h)};this._dirtinessTracker=new Op(_),this._smoothPath=new ys(this._context,this._bufferPool),this._deviceRenderer=new of(this._context,this._bufferPool),this._hotspotRenderer=new jm(this._context,this._bufferPool),this._debouncedDevicePixelsPerCanvasPixel=new vp(h=>{r.addFrameObserver(h)},2,(h,A)=>h==A,()=>{this.setNeedsBlit(!0)}),this._initMagicMoveRenderTreeCache(),this._requestImageOnScreen=(h,A)=>{let m=vn.forOnScreenPurpose(A);n.requestImageForRendering(h,m)},this._requestImageForPrerendering=(h,A)=>{let m=vn.forPrerenderPurpose(A);n.requestImageForRendering(h,m)},console.debug(`Graphics card: '${this._context.graphicsCardName()}'`)}setInViewerRenderServerForTests(e){xr()&&(this._isInViewerRenderServerForTests=e)}toggleRenderTreePrinting(){this._printRenderTree=!this._printRenderTree,this._printRenderTree&&this._activeRenderTree!=null&&console.log(this._activeRenderTree.debugString1())}_currentBaseScreenId(){var e;return(e=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:e.id()}_currentOverlayData(){return this._appState.prototypeState().getCurrentOverlayData()}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){}_uninitialize(){this._debouncedDevicePixelsPerCanvasPixel.unregister(e=>{this._appState.removeFrameObserver(e)}),this._appState.removeAppObserver(this)}isRenderingDone(){return!this._didRasterizeContentOnLastDraw}getContext(){return this._context}graphicsCardName(){return this._context.graphicsCardName()}tileAtlasTileSize(){return this._compositeTileCache.tileSize()}tileAtlasTextureSize(){return this._compositeTileCache.textureSize()}drawToScreenLargeTileSize(){return this._compositeTileCache.drawToScreenLargeTileSize()}tileRenderer(){return this._renderer}setNeedsBlit(e){this._needsBlit=e,this._observers.forEach(r=>{r.handleSetNeedsBlit(e)})}checkNeedsBlit(){return this.setNeedsBlit(this._needsBlit||this._viewport.isInvalid()||this.isTopLevelTransitionOngoing()||this._animatedMediaPlaying()||this.hasHsmTransition()),this._needsBlit||Qa.hasUnexpectedCompositingBug()}deviceRenderer(){return this._deviceRenderer}initializeThumbnailInvalidationManager(e){var r,n;switch(e){case"SLIDES":this._thumbnailInvalidationManager=new Ef;break;default:this._thumbnailInvalidationManager=null;break}this._thumbnailInvalidationManager&&((n=(r=this._canvas())==null?void 0:r.scene())==null||n.addObserver(this._thumbnailInvalidationManager))}thumbnailRenderer(){return this._thumbnailRenderer}changeFitMode(e){this._viewport.invalidate()}setZoomScale(e){}updateScroll(e){this.setNeedsBlit(!0)}handleSceneChange(e,r){this._debouncedDevicePixelsPerCanvasPixel.clear()}handleActiveCanvasChange(e,r){this._renderer.setCanvas(r),e!=null&&(e.scene().removeObserver(this._dirtinessTracker),this._thumbnailInvalidationManager&&e.scene().removeObserver(this._thumbnailInvalidationManager)),r!=null&&(r.scene().addObserver(this._dirtinessTracker),this._thumbnailInvalidationManager&&r.scene().addObserver(this._thumbnailInvalidationManager)),this._dirtinessTracker.initCanvas(r)}handleActivePrototypeStartingPointChange(e,r){}resize(e,r,n,o){let a=new O(e,r).multiplyScalar(o),s=this._context.resizeDefaultFramebuffer(Math.round(a.x())|0,Math.round(a.y())|0);return this._devicePixelRatio=o,this.setZoomScale(n),this._debouncedDevicePixelsPerCanvasPixel.clear(),new ra(s.canvasSize.divideScalar(o),s.webGLDidAdjustCanvasSize)}drawBlank(){this._context.annotate("Draw blank",()=>{K.isInlinePreview()&&this._ongoingTransition!=null&&this._onBeforeFrameForTransition(),this._renderer.context().beginFrame(),this._renderer.context().clear(mr.ALL,N.TRANSPARENT,null)})}_renderTreeToDraw(e){if(this.isTopLevelTransitionOngoing())return this._renderTreeForTransition(e);{let r=this._appState.prototypeState().getCurrentBaseScreenNode(),n=this._appState.prototypeState().bindOverlays(this._currentOverlayData());return be.perfTimerScope("invalidateDirtyTiles",be.ProfileLevel.LEGACY,()=>{this._dirtinessTracker.invalidateDirtyTiles(this._canvas(),new qi(this._canvas(),this._hsmTransitionMap,new ps(this._generatedOverlays),this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker))}),this._generatedOverlays=new Map,this._renderTreeForBaseScreenAndOverlays(r,n)}}_renderTreeForBaseScreenAndOverlays(e,r){if(e==null)return null;let n=Re.renderTreeForBaseScreenWithPerfLogging(e,new qi(e,this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_renderTreeForBaseScreenAndOverlays");if(n==null)return null;let o=Ue.wrap([this._compositor.prepareForEfficientCompositing(n),this._renderTreeForOverlays(e,r)]).optimized();return o==null?null:gt.forTransformIsolation(o)}_renderTreeForOverlays(e,r){let n=[],o=new ps;for(let i=0,a=r.length;i<a;i=i+1){let s=Re.renderTreeForOverlayBackground(r[i].backgroundAppearance(),e.canvasSpaceBoundingBox());s!=null&&n.push(s);let l=this._renderTreeForOverlay1(r[i],e,i,o,null);l!=null&&n.push(l)}return Ue.wrap(n)}_getTextureSizeForTileConfig(){return K.shouldApplyMobileOptimizations()?Br.getFeatureGate("viewer_mobile_half_texture_size")?1024:2048:this._context.maxTextureSize()}_getTileSizeForTileConfig(){return La.DEFAULT_TILE_SIZE}_renderTreeForOverlay1(e,r,n,o,i){return this._renderTreeForOverlay2(e,r,n,null,o,i)}_renderTreeForOverlay2(e,r,n,o,i,a){if(r==null)return null;let s=e.node();if(s==null)return null;let l=e.renderedBounds(r),c=s.canvasSpaceBoundingBox(),d=l.center().subtract(c.center());this._overlayBaseScreenId!=null&&r.id()!=this._overlayBaseScreenId&&(s.invalidateRenderTreeForSelfAndParents(),s.invalidateRenderTreeForChildren()),this._overlayBaseScreenId=r.id();let u=new Kt(r,null),p=new id(e.id(),e.node(),l,u,e.backgroundAppearance(),o,()=>d,a);i.addEntry(e.id(),p),this._generatedOverlays.set(e.id(),p),s.transitioningFrom!=null&&i.addEntry(s.transitioningFrom.exitingTransitionRoot.id(),{...p,overlayNode:s.transitioningFrom.exitingTransitionRoot});let _=Re.renderTreeForOverlayWithPerfLogging(s,new qi(s,this._hsmTransitionMap,i,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_renderTreeForOverlay");if(_==null)return null;let h=this._compositor.prepareForEfficientCompositing(_);return h==null?null:(h=gt.forTranslation(h,St.forOverlayPosition(n),()=>d),h)}_animatedMediaPlaying(){return this._isAnimatedMediaPlaying}_setAnimatedMediaPlaying(e){this._isAnimatedMediaPlaying=e}draw(e,r,n,o){var l;if(this._didRasterizeContentOnLastDraw=!1,this._renderer.context().isContextLost())return 2;if(((l=this._canvas())==null?void 0:l.scene())==null)return 2;if(this._currentTlf()==null)return 2;if(n.viewSpaceBounds().isEmpty())return 2;let i=this._compositor.beginFrameAndCreateBudget();var a="";let s=this._context.annotateAndReturn("draw",()=>{var E,P,T;let c=i.tileCacheCapacityRemaining();this._interruptCompletionCallback==null&&this._renderer.context().beginFrame(),this._isInViewerRenderServerForTests&&xr()&&(this._renderer.context().getGpuMetricsCollection().nextFrame(this._frameIndexForTests++),be.nextFrame(this._renderer.context().getGpuMetricsCollection().getCurrentFrameIndex()));let d=this._ongoingTransition!=null,u=this._ongoingObjectAnimation!=null,p=this.isTopLevelTransitionOngoing();d&&this._onBeforeFrameForTransition(),u&&this._onBeforeFrameForObjectAnimation(),this._onBeforeFrameForHsm();let _=this._renderTreeToDraw(n);this._activeRenderTree=_,_!=null&&this._setAnimatedMediaPlaying(_.hasAnimatingMedia()),this._debouncedDevicePixelsPerCanvasPixel.queueValue(n.zoomScale()*this._devicePixelRatio);let h=this._debouncedDevicePixelsPerCanvasPixel.hasQueuedValue()&&!(p&&!this._drewFirstFrameOfTransition);this._drewFirstFrameOfTransition=!0;let A=[],m=0,g=x.new2();n.computeCanvasSpaceBounds1(g);let S=this.currentCanvasSpacePreviewBounds();if(S==null)return be.trackEvent("prototype_null_canvas_space_preview_bounds",{currentTlfID:((E=this._currentTlf())==null?void 0:E.id)??"null",baseScreenNodeID:((P=this._appState.baseScreenNode())==null?void 0:P.id)??"null",sceneNull:((T=this._canvas())==null?void 0:T.scene())==null,transitionOngoing:this._ongoingTransition!=null}),2;let R=this.currentCanvasSpaceFrameBounds()!=null?this.currentCanvasSpaceFrameBounds().topLeft():new O(0,0);return S.intersectWith(g),this._interruptCompletionCallback&&be.perfTimerScope("interruptCompletion",be.ProfileLevel.LEGACY,()=>{i.permitWorkAfterBudgetExceeded(),this._interruptCompletionCallback(i),i.forbidWorkAfterBudgetExceeded(),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtDidCompleteInterruptedFrame=!0,this._interruptCompletionCallback=null}),this._renderer.context().beginFrame(),be.perfTimerScope("drawOnScreenTiles",be.ProfileLevel.LEGACY,()=>{this._context.annotate("On-screen tiles",()=>{if(!h){let v=x.new3(S);for(v.expandedBy1(S.height()),A=this._compositor.getPrioritizedListOfTilesToPopulate(this._debouncedDevicePixelsPerCanvasPixel.getValue(),S,v,_),i.permitWorkAfterBudgetExceeded();m<A.length&&(!i.isSafeModeRendering||i.permitsMoreWork());){let w=A[m];if(!w.overlapsViewport()){a+="tileOutsideViewport_";break}let I=this._compositor.ensureTileIsPopulated(w.node,i,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageOnScreen);I==0?(this._didRasterizeContentOnLastDraw=!0,Bo.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame INSIDE of viewport. Capacity left: ${i.tileCacheCapacityRemaining()} / ${c}`),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOnScreenTileCompletionCount++):I==1?(this._didRasterizeContentOnLastDraw=!0,this._interruptCompletionCallback=C=>{this._compositor.ensureTileIsPopulatedContinue(w.node,C,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)}):I==2&&this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOnScreenTileReuseCount++,m=m+1}i.forbidWorkAfterBudgetExceeded()}})}),this._interruptCompletionCallback!=null?(a+="safeModeInterrupt_",1):(be.perfTimerScope("drawToScreen",be.ProfileLevel.LEGACY,()=>{var f,y;if(this._needsBlit){this._printRenderTree&&console.log((f=this._activeRenderTree)==null?void 0:f.debugString1());let v=x.new2(),w=0,I=(y=this._canvas())==null?void 0:y.prototypeDevice(),C=I!=null&&I.type=="PRESET"&&this._appState.prototypeState().showDeviceFrame(),L=this._appState.prototypeState().showTransparentBackground();C?(v.setTo2(R,I.size()),w=N.BLACK):(v.copyFrom(S),w=o.backgroundColor),L&&(w=N.TRANSPARENT);let B=mn.new2().scaledBy(this._devicePixelRatio).multipliedBy(n.canvasSpaceToViewSpace1());B.transformRect(v),v.round();let V=n.viewSpaceBounds(),b=new x(V.left()*this._devicePixelRatio,V.top()*this._devicePixelRatio,V.width()*this._devicePixelRatio,V.height()*this._devicePixelRatio).rounded();this._compositor.drawToScreen(_,B,v,b,w,this._requestImageOnScreen),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics().setCurrentFrameSubMetricsType(es.GpuSubMetricsType.OVERLAY_UI_RENDERING),this._drawUI(n,o),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics().setCurrentFrameSubMetricsType(es.GpuSubMetricsType.SCENE_GRAPH_RENDERING),this.setNeedsBlit(!1),this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtBlitToScreen=!0}}),be.perfTimerScope("drawOffScreenTiles",be.ProfileLevel.LEGACY,()=>{this._context.annotate("Off-screen tiles",()=>{if(!h){for(var f=i.permitsMoreWork();(f=i.permitsMoreWork())&&m<A.length;){let w=this._compositor.ensureTileIsPopulated(A[m].node,i,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering);if(w==3){a+="offscreenHitCacheLimit_";break}if(w==0)this._didRasterizeContentOnLastDraw=!0,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOffScreenTileCompletionCount++;else if(w==1){this._didRasterizeContentOnLastDraw=!0;let I=A[m].node;this._interruptCompletionCallback=C=>{this._compositor.ensureTileIsPopulatedContinue(I,C,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)},a+="optionalOffscreenInterrupt_";break}w==0&&Bo.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame OUTSIDE of viewport. Capacity left: ${i.tileCacheCapacityRemaining()} / ${c}`),m=m+1}f||(a+="offscreenHitBudget_"),m==A.length&&(a+="completedScreenTiles_"),r=r&&this._interruptCompletionCallback==null;let y=r;if(K.getFeatureFlags().viewer_disable_prerendering_on_ongoing_interaction){let w=this._ongoingTransition!=null;y=y&&!this.hasHsmTransition()&&!w}if(r&&qn.didDisablePrerenderingOnOngoingTransition(!y),y){let w=this._appState.prototypeState().bindOverlays(this._currentOverlayData()),I=null,C=this._appState.baseScreenNode().canvasSpaceBoundingBox().topLeft();for(let L of this._appState.prototypeStructure().getPrerenderingJobs(()=>i.permitsMoreWork())){let B=null,V=null,b=null,D=null,U=L.asScreen(),H=L.asSmartAnimate();if(U!=null){if(U.role==an.FrameRole.BASE_SCREEN&&Q.equals(U.nodeId,this._currentBaseScreenId())||(b=this._canvas().scene().findNode(U.nodeId),b==null||!b.hasBeenLoaded()))continue;if(!i.permitsMoreWork()){a+="startFutureFrame_";break}let j=null;if(U.role==an.FrameRole.OVERLAY){let xe=rn.fromPrototypeAction(U.prototypeAction,0);j=ap.BoundOverlay_computeNewBounds(b,this._appState.baseScreenNode(),xe,C,b.overlayPositionType()),C=j.topLeft();let Je=new Kt(this._appState.baseScreenNode(),null),We=new id(b.id(),b,j,Je,b.overlayBackgroundAppearance(),null,()=>b.canvasSpaceBoundingBox().topLeft().negative().add(C),null);this._generatedOverlays.set(b.id(),We),I==null&&(I=new ps),I.addEntry(b.id(),We),B==null&&U.precedingOverlays!=null&&(B=new ps)}if(U.role==an.FrameRole.OVERLAY&&w.some(xe=>Q.equals(U.nodeId,xe.id())))continue;if(D=this.canvasSpacePreviewBoundsForTransition(b,b),B!=null){let xe=!1;for(let Je of U.precedingOverlays){let We=I==null?void 0:I.get(Je);if(We==null){xe=!0;break}B.addEntry(Je,We)}if(xe){a+="nonLoadedPrecedingOverlays_";break}}let ae=new qi(b,this._hsmTransitionMap,B,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker);V=U.role==an.FrameRole.BASE_SCREEN?Re.renderTreeForBaseScreenWithPerfLogging(b,ae,"_draw"):Re.renderTreeForOverlayWithPerfLogging(b,ae,"_draw")}else if(H!=null){let j=this._canvas().scene().findNode(H.srcNodeId),ae=this._canvas().scene().findNode(H.dstNodeId);if(j==null||ae==null||!j.hasBeenLoaded()||!ae.hasBeenLoaded())continue;D=this.canvasSpacePreviewBoundsForTransition(j,ae);let xe=Vr.get(H.transitionType);V=this._renderTreeForMagicMove(j,ae,xe,H.role,H.easingFunction),b=ae}if(V==null)continue;if(!i.permitsMoreWork()){a+="beforePrepareFutureTree_";break}let k=this._compositor.prepareForEfficientCompositing(V);if(!i.permitsMoreWork()){a+="afterPrepareFutureTree_";break}if(D==null)continue;this._prerenderViewport.copyFrom(this._viewport),this._prerenderViewport.updateForCurrentPreview(b.canvasSpaceBoundingBox(),D,this._appState.currentScalingInfo(),this._appState.activePrototypeDevice());let z=x.new2();this._prerenderViewport.computeCanvasSpaceBounds1(z),D.intersectWith(z);let q=this._prerenderViewport.zoomScale()*this._devicePixelRatio,Y=this._compositor.getPrioritizedListOfTilesToPopulate(q,D,D,k);for(let j of Y){if(i.tileCacheCapacityRemaining()==0){a+="tileCapacityFutureFrame_";break}let ae=this._compositor.ensureTileIsPopulated(j.node,i,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering);if(ae==3){a+="optionalFutureHitCacheLimit_";break}if(ae==0)this._didRasterizeContentOnLastDraw=!0,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtOptionalTileCompletionCount++,Bo.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendering tile for future frame. Capacity left: ${i.tileCacheCapacityRemaining()} / ${c}`);else if(ae==1){this._didRasterizeContentOnLastDraw=!0;let xe=j.node;this._interruptCompletionCallback=Je=>{this._compositor.ensureTileIsPopulatedContinue(xe,Je,this._debouncedDevicePixelsPerCanvasPixel.getValue(),this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)},a+="optionalFutureInterrupt_";break}if(!i.permitsMoreWork()){a+="postFutureFrameRaster_";break}}}}}})}),0)});return this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtDidRasterWork=this._didRasterizeContentOnLastDraw,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtHasPendingInterruptForNextFrame=this._interruptCompletionCallback!=null,this._context.getGpuMetricsCollection().getCurrentFrameGPUMetrics()._bgtBrokeRenderAt=a,this._renderer.context().getGpuMetricsCollection().getCurrentFrameGPUMetrics().updateFrameBudgetInfo(i),s}_canvas(){return this._appState.getActiveCanvas()}_currentTlf(){var e;return(e=this._canvas())==null?void 0:e.scene().findNode(this._currentBaseScreenId())}_drawUI(e,r){this._context.annotate("Draw UI",()=>{var h;if(this._appState.getActiveCanvas()==null)return;let n=this.currentCanvasSpacePreviewBounds(),o=(h=this.currentCanvasSpaceFrameBounds())==null?void 0:h.topLeft(),i=x.new2();e.computeCanvasSpaceBounds1(i);let l=1/(e.zoomScale()*this._devicePixelRatio);if(n==null)return;let c=i.topLeft().subtract(n.topLeft()).makeAbs();this._smoothPath.setTransformAndPixelScale(e.canvasSpaceToClipSpace1(),l);let d=this._canvas().prototypeDevice(),u=d.type=="PRESET"&&this._appState.prototypeState().showDeviceFrame(),p=0;if(u&&fP(d.presetIdentifier)&&(p=25),!u)n.intersectWith(i),ic.drawPreviewStencil(this._smoothPath,e.zoomScale(),n,i,r.backgroundColor,p);else if(o!=null){let A=x.new2();A.setTo2(o,d.size()),A.expand1(1/e.zoomScale());let m=A.clone();n.intersectWith(i),A.intersectWith(i),ic.drawPreviewStencil(this._smoothPath,e.zoomScale(),A,i,r.backgroundColor,p,m)}this._currentTlf()!=null&&this._drawDeviceFrameIfNecessary(this._smoothPath,e,this._currentTlf().canvasSpaceBoundingBox(),i),r.particles!=null&&ic.drawParticles(this._smoothPath,r.particles,1/e.zoomScale(),n),r.mouse!=null&&n.contains2(r.mouse)&&ic.drawMouseCursor(this._smoothPath,r.mouse,e.zoomScale()),r.hotspots!=null&&this._hotspotRenderer.draw(e.canvasSpaceToClipSpace1(),e.zoomScale(),r.hotspots,r.hotspotOpacity,this._devicePixelRatio),this._smoothPath.flush(),this.deviceRenderer().flush()})}drawDeviceFrameIfNecessary(e,r,n,o){return this._drawDeviceFrameIfNecessary(this._smoothPath,r,n,o)}_drawDeviceFrameIfNecessary(e,r,n,o){return this._canvas()==null||!this._appState.prototypeState().showDeviceFrame()?!1:(this._context.annotate("Draw device frame",()=>{var i;if(this.deviceRenderer().drawPrototypeDeviceIfAny(r,this._canvas().prototypeDevice(),n,r.canvasSpaceToClipSpace1()),this.deviceRenderer().isWaitingForDeviceFrameToLoad(this._canvas().prototypeDevice())){let a=Tf((i=this._appState.baseScreenNode())==null?void 0:i.id(),this._appState.currentScalingInfo().fitMode,this._appState.prototypeState().showTransparentBackground(),this._canvas());e.fillRect(o,a)}}),!0)}_totalVRAM(){let e=0;return e=e+this._bufferPool.totalVRAM(),e=e+this._compositeTileCache.totalVRAM(),e=e+this._renderer.totalVRAM(),e}_onBoundsInvalidate(e){this._viewport.invalidate()}clearTileCaches(){this._compositeTileCache.clear()}resetTileStackUsage(){this._renderer.resetTileStackUsage()}reclaimTileStack(){this._renderer.reclaimTileStack()}_maybeLogPerformanceMetricsForTransition(){let e=this._transitionWasInterruptedByVisibilityChange;if(this._transitionWasInterruptedByVisibilityChange=!1,!(e||document.hidden)&&!this._transitionProgressTracker.isProgressControlledExternally()&&this._transitionProgressTracker.duration()>0){let r=Math.random()<this.PORTION_TO_LOG&&this._numTransitionsLogged<this.MAX_TRANSITION_LOGS;if(Bo.VERBOSE_LOGS||r){let n=this._transitionProgressTracker.frameTimesMs,o=n.length,i=0,a=0,s=0,l=0,c=0,d=0,u=0,p=0,_=0;for(let R of n)p=Math.max(p,R),_+=R,R<20?i=i+1:R<40?a=a+1:R<80?s=s+1:R<160?l=l+1:R<320?c=c+1:R<640?d=d+1:u=u+1;if(p>60*1e3||this._ongoingTransition==null)return;let h=_/o,A=this._ongoingTransition.change,m=A.transitionParameters.transitionType,g=m=="SMART_ANIMATE"||zn.supportsSmartAnimate(m)&&A.transitionParameters.transitionShouldSmartAnimate,S=new Map([["is_smart_animate",g],["mean_frame_ms",h],["max_frame_ms",p],["frame_count",o],["count_0_to_20ms",i],["count_20_to_40ms",a],["count_40_to_80ms",s],["count_80_to_160ms",l],["count_160_to_320ms",c],["count_320_to_640ms",d],["count_640_ms_or_higher",u]]);Bo.VERBOSE_LOGS&&(console.group("ProtoRenderManager: Transition complete"),console.table(Qe.StringMap_toJSObject(S)),console.groupEnd()),r&&(be.trackEvent("viewer_transition_frame_times_v2",Qe.StringMap_toJSObject(S)),this._numTransitionsLogged=this._numTransitionsLogged+1)}}}triggerTransition(e,r,n){this._drewFirstFrameOfTransition=!1,this._ongoingTransition=new Bo.TransitionState(e,r),this._transitionProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration),n!=null&&nc.applyTo(n,this._transitionProgressTracker)}handleAbortedTransition(e){var r;e==((r=this._ongoingTransition)==null?void 0:r.change)&&(this._ongoingTransition=null)}handleCommittedTransition(e){var r;e==((r=this._ongoingTransition)==null?void 0:r.change)&&(this._ongoingTransition=null)}triggerHsmTransition(e,r,n){let o=e.toString(),i=new wn;i.willStartTransitionWithDuration(r.transitionParameters.transitionDuration),n!=null&&nc.applyTo(n,i),this._hsmTransitionMap.set(o,new Bo.InstanceSwapTransition(i,()=>{let a=i.progress();return r.transitionParameters.easingFunction==null||i.isProgressControlledExternally()?a:r.easingFunction().get(a)},r))}abortHsmTransition(e,r){this._hsmTransitionMap.delete(e.toString())}commitHsmTransition(e,r){this._hsmTransitionMap.delete(e.toString())}hasHsmTransition(){return this._hsmTransitionMap.size>0}triggerObjectAnimation(e,r){Bo.VERBOSE_LOGS&&console.log("[ProtoRenderManager] triggerObjectAnimation",e),this._ongoingObjectAnimation=new Bo.TransitionState(e,r),this._objectAnimationProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration);let n=e.objectAnimationTargetNode(this._appState.scene());if(!n)throw new Error("Expected object animation target node");if(n.animatingFrom)throw new Error("Expected target node's animatingFrom property to be null when triggering a new object animation");let o=F().cloneNode(n.id()),i=this._appState.scene().findNode(o);if(!i)throw new Error("Expected cloned node");F().setNodeToInitialObjectAnimationState(o,n.id()),F().setNodeToFinalObjectAnimationState(n.id(),n.id()),n.animatingFrom=i;let a=this._appState.getActiveCanvas();a.invalidateRenderTreeForSelfAndParents(),a.invalidateRenderTreeForChildren()}_setObjectAnimationToState(e,r){var o,i,a;let n=(o=this._ongoingObjectAnimation)==null?void 0:o.change.objectAnimationTargetNode(this._appState.scene());n&&(n.animatingFrom=null,r==="initial"?F().setNodeToInitialObjectAnimationState(n.id(),n.id()):F().setNodeToFinalObjectAnimationState(n.id(),n.id()),this._dirtinessTracker.dirtyNode(n),(i=this._thumbnailInvalidationManager)==null||i.handleObjectAnimationStateChange(n),n.invalidateRenderTreeForSelfAndParents(),n.invalidateRenderTreeForChildren()),e==((a=this._ongoingObjectAnimation)==null?void 0:a.change)&&(this._ongoingObjectAnimation=null)}handleAbortedObjectAnimation(e){Bo.VERBOSE_LOGS&&console.log("[ProtoRenderManager] handleAbortedObjectAnimation",e),this._setObjectAnimationToState(e,"initial")}handleCommittedObjectAnimation(e){Bo.VERBOSE_LOGS&&console.log("[ProtoRenderManager] handleCommittedObjectAnimation",e),this._setObjectAnimationToState(e,"final")}isTopLevelTransitionOngoing(){return this._ongoingTransition!=null&&this._transitionProgressTracker.isTransitionInProgress()}easedTransitionProgress(){let e=this._ongoingTransition;if(e==null)return 0;let r=this._transitionProgressTracker.progress();return e.change.easingFunction()==null||this._transitionProgressTracker.isProgressControlledExternally()?r:e.change.easingFunction().get(r)}_renderTreeForTransition(e){let r=this._ongoingTransition;return r==null?null:r.cachedRenderTree!=null?r.cachedRenderTree:Q.equals(r.change.oldStateId(),r.change.newStateId())?this._renderTreeForOverlayTransition(r):this._renderTreeForBaseScreenTransition(r,e)}_initMagicMoveRenderTreeCache(){let e=a=>a[1]==an.FrameRole.OVERLAY?Re.renderTreeWithPerfLogging2(a[0],new qi(a[0],this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_initMagicMoveRenderTreeCache"):Re.renderTreeForBaseScreenWithPerfLogging(a[0],new qi(a[0],this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_initMagicMoveRenderTreeCache"),r=a=>a,n=a=>a,o=(a,s,l,c)=>{let d=null;try{d=ai.renderTreeForMagicMove(a,s,()=>this.easedTransitionProgress(),c,l)}catch(u){d=null,we(u)}return Bo.VERBOSE_LOGS&&(console.log("Smart animate render tree"),console.log("-------------------------"),console.log(d==null?void 0:d.debugString1())),d},i=(a,s,l,c)=>o(a[0],s[0],l,c);this._consolidatedRenderTreeForMagicMove=SP(i,e,e,r,n)}_renderTreeForMagicMove(e,r,n,o,i){return this._consolidatedRenderTreeForMagicMove([e,o],[r,o],n,i)}_preparedRenderTreeForMagicMove(e,r,n,o,i,a){let s=this._renderTreeForMagicMove(n,o,r,i,a);return e.cachedRenderTree=s?this._compositor.prepareForEfficientCompositing(s):null,e.cachedRenderTree}_renderTreeForBaseScreenTransition(e,r){let n=e.change,o=e.viewportBeforeTransition.zoomScale()*this._devicePixelRatio,i=this._appState.prototypeState().lastNodeForBaseScreen();if(i==null)return null;let a=r.zoomScale()*this._devicePixelRatio,s=this._appState.prototypeState().nextNodeForBaseScreen();if(s==null)return null;let l=n.oldOverlays(this._appState.prototypeState()),c=n.newOverlays(this._appState.prototypeState()),d=Vr.get(n.transitionParameters.transitionType);n.direction==1&&(d=d.reversed());let u=n.transitionParameters.transitionType=="SMART_ANIMATE"||zn.supportsSmartAnimate(n.transitionParameters.transitionType)&&n.transitionParameters.transitionShouldSmartAnimate,p=l.length!=0;if(u){let g=this._preparedRenderTreeForMagicMove(e,d,i,s,an.FrameRole.BASE_SCREEN,n.easingFunction());if(p){let S=s.size().max(i.size()),R=X.new2(),E=this._renderTreeForOverlays(i,l);if(E==null)return null;if(E=gt.forOpacity(E,St.EXITING_TLF,()=>d.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),E=gt.forTransform(E,St.EXITING_TLF,()=>R.copyFrom(yt.FrozenAffineTransform_IDENTITY).translatedBy1(S.multiply(d.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(o/a).translatedBy1(i.canvasSpaceBoundingBox().center().negative())),n.transitionParameters.transitionType=="SMART_ANIMATE"){let P=St.DISSOLVE_TRANSITION;E=new Nn(E,g,P,()=>this.easedTransitionProgress())}return e.cachedRenderTree=Ue.wrap([g,E]).optimized(),e.cachedRenderTree}else return g}let _=s.size().max(i.size()),h=X.new2(),A=this._renderTreeForBaseScreenAndOverlays(i,l);A!=null?(A=gt.forOpacity(A,St.EXITING_TLF,()=>d.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),A=gt.forTransform(A,St.EXITING_TLF,()=>h.copyFrom(yt.FrozenAffineTransform_IDENTITY).translatedBy1(_.multiply(d.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(o/a).translatedBy1(i.canvasSpaceBoundingBox().center().negative()))):A=new Ue([]);let m=this._renderTreeForBaseScreenAndOverlays(s,c);if(m!=null?(m=gt.forOpacity(m,St.ENTERING_TLF,()=>d.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),m=gt.forTranslation(m,St.ENTERING_TLF,()=>_.multiply(d.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())))):m=new Ue([]),d.isDissolve()){let g=St.DISSOLVE_TRANSITION;e.cachedRenderTree=new Nn(A,m,g,()=>this.easedTransitionProgress())}else d.drawsEnteringFrameOnTopOfExitingFrame()?e.cachedRenderTree=Ue.wrap([A,m]):e.cachedRenderTree=Ue.wrap([m,A]);return e.cachedRenderTree}_renderTreeForOverlayTransition(e){var S,R;let r=e.change,n=r.oldOverlays(this._appState.prototypeState()),o=r.newOverlays(this._appState.prototypeState()),i=this._appState.prototypeState().lastNodeForBaseScreen(),a=i.canvasSpaceBoundingBox().topLeft();if(i==null)return null;let s=Re.renderTreeForBaseScreenWithPerfLogging(i,new qi(i,this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts(),this._ongoingObjectAnimation,this._objectAnimationProgressTracker),"_renderTreeForOverlayTransition");if(s==null)return null;let l=[],c=this._compositor.prepareForEfficientCompositing(s);c!=null&&l.push(gt.forTransformIsolation(c));let d=r.getFramePairTransition(),u=new ps,p=0;for(let E=0,P=Math.min(n.length,o.length);E<P&&Q.equals(n[E].id(),o[E].id());E=E+1){let T=Re.renderTreeForOverlayBackground(n[E].backgroundAppearance(),i.canvasSpaceBoundingBox());T!=null&&l.push(T);let f=this._renderTreeForOverlay1(n[E],i,E,u,null);f!=null&&l.push(f),p=p+1}if(n.length==o.length&&p==n.length-1&&r.transitionParameters.transitionType=="SMART_ANIMATE"){let E=n[n.length-1],P=o[o.length-1],T=this._appState.prototypeState().lastNodeForOverlayAt(n.length-1),f=this._appState.prototypeState().nextNodeForOverlayAt(o.length-1);if(T!=null&&f!=null){let y=[];Wr(y,l);let v=Re.renderTreeForOverlayBackground(E.backgroundAppearance(),i.canvasSpaceBoundingBox()),w=Re.renderTreeForOverlayBackground(P.backgroundAppearance(),i.canvasSpaceBoundingBox());(v!=null||w!=null)&&y.push(new Nn(v,w,St.OVERLAY_BACKGROUND_DISSOLVE,()=>this.easedTransitionProgress()));let I=this._preparedRenderTreeForMagicMove(e,d,T,f,an.FrameRole.OVERLAY,r.easingFunction());return I==null?null:(I=gt.forTranslation(I,St.SMART_ANIMATE_OVERLAY_TRANSLATION,()=>{let C=P.deltaFromRenderedPositionToCanvasSpacePosition(i),L=E.renderedOrigin(i).subtract(f.canvasSpaceBoundingBox().topLeft());return C.multiplyScalar(this.easedTransitionProgress()).add(L.multiplyScalar(1-this.easedTransitionProgress()))}),y.push(I),e.cachedRenderTree=Ue.wrap(y).optimized(),e.cachedRenderTree)}}let A=[];for(let E=p,P=n.length;E<P;E=E+1){let T=Re.renderTreeForOverlayBackground(n[E].backgroundAppearance(),i.canvasSpaceBoundingBox()),f=null;T!=null&&(f=()=>1-this.easedTransitionProgress(),A.push(gt.forOpacity(T,St.EXITING_OVERLAY_BACKGROUND,f)));let y=n[E].renderedOrigin(i).subtract(a),v=((S=n[E].node())==null?void 0:S.size())??ge.FrozenVector_new1(),w=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(r.transitionParameters.transitionType)!=-1?i.size().subtract(y.add(v)):y,I=v.add(w),C=()=>I.multiply(d.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress())),L=this._renderTreeForOverlay2(n[E],i,E,f,u,C);u!=null&&u.removeEntry(n[E].id()),L!=null&&(L=gt.forOpacity(L,St.EXITING_OVERLAY,()=>d.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),L=gt.forTranslation(L,St.EXITING_OVERLAY,C),A.push(L))}let m=[];for(let E=p,P=o.length;E<P;E=E+1){let T=Re.renderTreeForOverlayBackground(o[E].backgroundAppearance(),i.canvasSpaceBoundingBox()),f=null;T!=null&&(f=()=>this.easedTransitionProgress(),m.push(gt.forOpacity(T,St.ENTERING_OVERLAY_BACKGROUND,f)));let y=o[E].renderedOrigin(i).subtract(a),v=((R=o[E].node())==null?void 0:R.size())??ge.FrozenVector_new1(),w=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(r.transitionParameters.transitionType)!=-1?i.size().subtract(y.add(v)):y,I=v.add(w),C=()=>I.multiply(d.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())),L=this._renderTreeForOverlay2(o[E],i,E,f,u,C);L!=null&&(L=gt.forOpacity(L,St.ENTERING_OVERLAY,()=>d.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),L=gt.forTranslation(L,St.ENTERING_OVERLAY,C),m.push(L))}let g=[];if(Wr(g,l),d.isDissolve()){let E=St.DISSOLVE_TRANSITION,P=Ue.wrap(A),T=Ue.wrap(m);g.push(new Nn(P,T,E,()=>this.easedTransitionProgress()))}else Wr(g,A),Wr(g,m);return e.cachedRenderTree=Ue.wrap(g),e.cachedRenderTree}_onBeforeFrameForTransition(){if(this._ongoingTransition!=null&&(this._transitionProgressTracker.advanceToNextFrame(),!this._transitionProgressTracker.isTransitionInProgress())){this._maybeLogPerformanceMetricsForTransition();let r=this._transitionProgressTracker.transitionEnded();switch(this._appState.prototypeState().mostRecentFixInvalidStateInitiator="ProtoRenderManager._onBeforeFrameForTransition "+r,r){case wn.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case wn.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}}_onBeforeFrameForHsm(){this._hsmTransitionMap.size!=0&&Array.from(this._hsmTransitionMap.keys()).forEach(e=>{if(Array.from(this._hsmTransitionMap.keys()).indexOf(e)!=-1){let r=this._hsmTransitionMap.get(e);if(r==null)return;let n=r.tracker;if(n.advanceToNextFrame(),!n.isTransitionInProgress()){let o=n.transitionEnded(),i=this._appState.prototypeState(),a=r.change;if(i.getStateMachineInitiatedChange(a.stablePath)==a)switch(o){case wn.TransitionEndedAction.COMMIT:{i.commitChangesBelowInstanceTransitionRoot(a.stablePath);let s=this._appState.scene().findNodeByStablePath(a.stablePath);s!=null&&this._dirtinessTracker.dirtyNode(s);break}case wn.TransitionEndedAction.ABORT:{i.abortInstanceStateChange(a.stablePath);break}}}}})}_onBeforeFrameForObjectAnimation(){let e=this._ongoingObjectAnimation;if(e)if(this._objectAnimationProgressTracker.advanceToNextFrame(),this._objectAnimationProgressTracker.isTransitionInProgress()){let r=e.change.objectAnimationTargetNode(this._appState.scene());if(!r)throw new Error("Expected object animation target node");this._dirtinessTracker.dirtyNode(r)}else{let r=this._objectAnimationProgressTracker.transitionEnded();switch(this._appState.prototypeState().mostRecentFixInvalidStateInitiator="ProtoRenderManager._onBeforeFrameForObjectAnimation "+r,r){case wn.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case wn.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}}currentCanvasSpacePreviewBounds(){if(this._ongoingTransition!=null){let n=this.ongoingPrototypeStateChange();if((n==null?void 0:n.transitionParameters.transitionType)!="INSTANT_TRANSITION"){let o=this._appState.prototypeState(),i=o.lastNodeForBaseScreen(),a=o.nextNodeForBaseScreen()??o.lastNodeForBaseScreen();return this.canvasSpacePreviewBoundsForTransition(i,a)}}let r=this._appState.baseScreenNode();return this.canvasSpacePreviewBoundsForTransition(r,r)}currentCanvasSpaceFrameBounds(){if(this._ongoingTransition!=null){let n=this.ongoingPrototypeStateChange();if((n==null?void 0:n.transitionParameters.transitionType)!="INSTANT_TRANSITION"){let o=this._appState.prototypeState(),i=o.lastNodeForBaseScreen(),a=o.nextNodeForBaseScreen()??o.lastNodeForBaseScreen();return this.canvasSpaceFrameBoundsForTransition(i,a)}}let r=this._appState.baseScreenNode();return this.canvasSpaceFrameBoundsForTransition(r,r)}canvasSpacePreviewBoundsForTransition(e,r){if(e==null&&r==null)return null;if(!Q.equals(e==null?void 0:e.id(),r==null?void 0:r.id())){let n=ge.FrozenVector_ZERO,o=ge.FrozenVector_ZERO,i=0,a=0;if(e!=null){n=e.canvasSpaceBoundingBox().size();let p=e.strokeGeometry();p!=null&&p.bounds.isFinite()&&e.strokeAlign()!="INSIDE"&&(i=Math.abs(p.bounds.left()))}o=r.canvasSpaceBoundingBox().size();let s=r.strokeGeometry();s!=null&&s.bounds.isFinite()&&r.strokeAlign()!="INSIDE"&&(a=Math.abs(s.bounds.left()));let l=n.max(o),c=new x(0,0,l.x(),l.y()),d=Math.max(i,a),u=X.new2().translatedBy1(r.canvasSpaceBoundingBox().center()).translatedBy1(c.center().negative());return c.transformInto1(c,u),c.expand1(d),c}return r.canvasSpacePreviewBounds()}canvasSpaceFrameBoundsForTransition(e,r){if(e==null&&r==null)return null;if(!Q.equals(e==null?void 0:e.id(),r==null?void 0:r.id())){let n=e!=null?e.size():ge.FrozenVector_ZERO,o=r.size(),i=n.max(o),a=new x(0,0,i.x(),i.y());return a.transformInto1(a,r.absoluteTransform()),a}return e.canvasSpaceBoundingBox()}ongoingPrototypeStateChange(){var e;return((e=this._ongoingTransition)==null?void 0:e.change)??null}transitionProgressTracker(){return this._transitionProgressTracker}renderLayerByLayerActivate(e){this._renderer.renderLayerByLayerActivate(e)}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}attachTo(e){e.element().appendChild(this._context.gl().canvas)}removeFrom(e){e.element().removeChild(this._context.gl().canvas),this._uninitialize()}};Bo.VERBOSE_LOGS=!1;var As=Bo;(r=>{class t{constructor(o,i){this.cachedRenderTree=null,this.change=o,this.viewportBeforeTransition=new xo,this.viewportBeforeTransition.copyFrom(i)}}r.TransitionState=t;class e{constructor(o,i,a){this.tracker=o,this.progress=i,this.change=a}}r.InstanceSwapTransition=e})(As||(As={}));var bd=class{constructor(e,r){this._ballisticSimulation=null,this._scrollingNodeID=null,this._isValid=!1,this._ballisticSimulation=e,this._scrollingNodeID=r,this._isValid=e!=null}nodeID(){return this._scrollingNodeID}simulation(){return this._ballisticSimulation}isOverscrolled(){return this._ballisticSimulation.isOverscrolled()}isValid(e){return e!=null&&e.findNode(this._scrollingNodeID)!=null}isDone(){return this._ballisticSimulation.isDone1()}performScroll(e,r){if(!this.isValid(r))return;let n=this._ballisticSimulation.pos1(),o=r.findNode(this._scrollingNodeID);e.setScrollOffsetUnconditionally(o,n)}};var Mp=class{uninit(){this._semanticScrollStorage.uninitialize1()}getValueFromStorage(e){let r=new Kt(e),n=Nr.getSemanticNodePath(r);return this._semanticScrollStorage.getData(n,Nr.DEFAULT_STORAGE_KEY)}setValueInStorage(e,r){let n=new Kt(e),o=Nr.getSemanticNodePath(n);this._semanticScrollStorage.insert(o,Nr.DEFAULT_STORAGE_KEY,r)}_getOldNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode(e.oldStateId()):this._appState.scene().findNodeByStablePath(e.stablePath)}_getNewNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode(e.newStateId()):this._appState.scene().findNodeByStablePath(e.stablePath)}commitCurrentScrollStateToStorage(e){switch(e.transitionParameters.navigationType){case"NAVIGATE":case"SWAP_STATE":let r=this._getOldNode(e);this._recursivelyRecordOffsets(r);break;case"OVERLAY":case"SWAP":let n=e.oldStateAndOverlays.overlays[e.oldStateAndOverlays.overlays.length-1];if(n){let o=this._appState.scene().findNode(n.id);this._recursivelyRecordOffsets(o)}break;case"SCROLL_TO":}}applyStoredScrollStateToScene(e){switch(e.transitionParameters.navigationType){case"NAVIGATE":case"SWAP_STATE":let r=this._getNewNode(e);this._recursivelySetOffsets(r);break;case"OVERLAY":case"SWAP":let n=e.newStateAndOverlays.overlays[e.newStateAndOverlays.overlays.length-1];if(n){let o=this._appState.scene().findNode(n.id);this._recursivelySetOffsets(o)}break;case"SCROLL_TO":}}resetScrollStateToScene(e){switch(e.transitionParameters.navigationType){case"NAVIGATE":case"SWAP_STATE":let r=this._getNewNode(e);this._recursivelyResetOffsets(r);break;case"OVERLAY":case"SWAP":let n=e.newStateAndOverlays.overlays[e.newStateAndOverlays.overlays.length-1];if(n){let o=this._appState.scene().findNode(n.id);this._recursivelyResetOffsets(o)}break;case"SCROLL_TO":}}_recursivelyRecordOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&this.setValueInStorage(e,e.scrollOffset()),e.forEachChild(r=>{this._recursivelyRecordOffsets(r)}))}_recursivelySetOffsets(e){if(e!=null){if(e.scrollDirection()!="NONE"){let r=this.getValueFromStorage(e);r!=null?r.equals(e.scrollOffset())||(be.trackDefinedEvent("prototype.viewer_scroll_state_transferred",{}),e.setScrollOffset(this._canvasView.restrictScrollDeltaAxes(e,r))):e.setScrollOffset(ge.FrozenVector_ZERO)}e.forEachChild(r=>{this._recursivelySetOffsets(r)})}}_recursivelyResetOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&(be.trackDefinedEvent("prototype.viewer_scroll_state_reset",{}),e.setScrollOffset(ge.FrozenVector_ZERO),this.setValueInStorage(e,ge.FrozenVector_ZERO)),e.forEachChild(r=>{this._recursivelyResetOffsets(r)}))}toString(){return this._semanticScrollStorage.toString2(e=>e.toString())}debugString(){return this._semanticScrollStorage.toString2(e=>`{x: ${e.x()}, y: ${e.y()}}`)}constructor(e,r){this._canvasView=e,this._appState=r,this._semanticScrollStorage=new Qs}};var Rf=class{constructor(e,r,n,o,i,a,s,l,c){this.type="HOTSPOT",this.hotspot=e,this.prototypeInteraction=r,this.action=n,this.viewSpacePointOrNull=o,this.prototypeAction=i,this.connectionType=a,this.actionIndexPath=s,this.resolvedVariableModes=l,this.nodeForFindingTopmostScreen=c}},TT=class{constructor(e,r,n){this.type="OBJECT_ANIMATION",this.interactionId=e,this.actionIndex=r,this.transitionDirection=n}},yf=class{constructor(e,r){this._queue=[],this._canvasView=e,this._prototypeState=r,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this),this._canvasView.addObserver(this)}appendHotspotActionToQueue(e,r,n,o,i,a,s,l,c){this._queue.push(new Rf(e,r,n,o,i,a,s,l,c))}insertHotspotActionInQueue(e,r,n,o,i,a,s,l,c,d){this._queue.splice(l,0,new Rf(e,r,n,o,i,a,s,c,d))}appendObjectAnimationActionToQueue(e,r,n){this._queue.push(new TT(e,r,n))}runNextAction(){if(this._queue.length>0){let e=this._queue.shift();e!=null&&this._runAction(e)}}_runAction(e){if(e.type=="HOTSPOT")this._canvasView.runSequentialAction(e.hotspot,e.prototypeInteraction,e.action,e.viewSpacePointOrNull,e.prototypeAction,e.connectionType,e.actionIndexPath,e.resolvedVariableModes,e.nodeForFindingTopmostScreen);else if(e.type=="OBJECT_ANIMATION"){let r=this._prototypeState.getCurrentBaseScreenNode(),n=new Mo(e.interactionId,e.actionIndex);this._prototypeState.playObjectAnimation(r,n,e.transitionDirection)}}handleStateChangeAborted(e){this._queue.length=0}handleStateChangeCommitted(e,r){if(this._queue.length>0&&this._shouldProcessAction(e)){let n=this._queue.shift();n!=null&&r(()=>{this._runAction(n)})}}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){this._queue.length=0}handleHsmAborted(e,r){this._queue.length=0}handleHsmCommitted(e,r,n){if(this._queue.length>0&&this._shouldProcessAction(r)){let o=this._queue.shift();o!=null&&n(()=>{this._runAction(o)})}}handleHsmInitiated(e,r){}handleHsmRequested(e,r){}willTriggerHotspot(e,r,n,o){(n==4||n==8||n==9||n==3)&&(this._queue.length=0)}didScrollNode(e){}_shouldProcessAction(e){return!(e.cause==6||e.cause==7)}};var sc;(o=>{function t(i){return i.stateManagementVersion()==1}o.newStateManagementRulesEnabledForChange=t;function e(){return o._seenOldStateManagementInteraction}o.seenOldStateManagementInteraction=e;function r(){o._seenOldStateManagementInteraction=!0}o.markOldStateManagementInteractionSeen=r,o._seenOldStateManagementInteraction=!1})(sc||(sc={}));var FT=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},fe=(t,e,r)=>(FT(t,e,"read from private field"),r?r.call(t):e.get(t)),er=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},so=(t,e,r,n)=>(FT(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r),Hr=(t,e,r)=>(FT(t,e,"access private method"),r),hr=new Uint8Array(8),Ts=new DataView(hr.buffer),Zi=t=>[(t%256+256)%256],Fr=t=>(Ts.setUint16(0,t,!1),[hr[0],hr[1]]),AB=t=>(Ts.setInt16(0,t,!1),[hr[0],hr[1]]),vP=t=>(Ts.setUint32(0,t,!1),[hr[1],hr[2],hr[3]]),Dt=t=>(Ts.setUint32(0,t,!1),[hr[0],hr[1],hr[2],hr[3]]),TB=t=>(Ts.setUint32(0,Math.floor(t/2**32),!1),Ts.setUint32(4,t,!1),[hr[0],hr[1],hr[2],hr[3],hr[4],hr[5],hr[6],hr[7]]),DT=t=>(Ts.setInt16(0,2**8*t,!1),[hr[0],hr[1]]),Ua=t=>(Ts.setInt32(0,2**16*t,!1),[hr[0],hr[1],hr[2],hr[3]]),ET=t=>(Ts.setInt32(0,2**30*t,!1),[hr[0],hr[1],hr[2],hr[3]]),Ga=(t,e=!1)=>{let r=Array(t.length).fill(null).map((n,o)=>t.charCodeAt(o));return e&&r.push(0),r},uc=t=>t&&t[t.length-1],Yp=(t,e,r=!0)=>{let n=t*e;return r?Math.round(n):n},CP=t=>{let e=t*(Math.PI/180),r=Math.cos(e),n=Math.sin(e);return[r,n,0,-n,r,0,0,0,1]},EB=CP(0),OP=t=>[Ua(t[0]),Ua(t[1]),ET(t[2]),Ua(t[3]),Ua(t[4]),ET(t[5]),Ua(t[6]),Ua(t[7]),ET(t[8])],Vp=t=>!t||typeof t!="object"?t:Array.isArray(t)?t.map(Vp):Object.fromEntries(Object.entries(t).map(([e,r])=>[e,Vp(r)])),Io=(t,e,r)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:r}),Ro=(t,e,r,n,o)=>Io(t,[Zi(e),vP(r),n??[]],o),IB=t=>t?Io("ftyp",[Ga("isom"),Dt(0),Ga("iso4"),Ga("hvc1")]):Io("ftyp",[Ga("isom"),Dt(0),Ga("isom"),Ga("avc1"),Ga("mp41")]),yP=t=>({type:"mdat",largeSize:t}),RB=t=>({type:"free",size:t}),IT=(t,e)=>Io("moov",null,[yB(e,t),...t.map(r=>vB(r,e))]),yB=(t,e)=>{let r=Yp(Math.max(0,...e.filter(o=>o.samples.length>0).map(o=>uc(o.samples).timestamp+uc(o.samples).duration)),vT),n=Math.max(...e.map(o=>o.id))+1;return Ro("mvhd",0,0,[Dt(t),Dt(t),Dt(vT),Dt(r),Ua(1),DT(1),Array(10).fill(0),OP(EB),Array(24).fill(0),Dt(n)])},vB=(t,e)=>Io("trak",null,[CB(t,e),OB(t,e)]),CB=(t,e)=>{let r=uc(t.samples),n=Yp(r?r.timestamp+r.duration:0,vT);return Ro("tkhd",0,3,[Dt(e),Dt(e),Dt(t.id),Dt(0),Dt(n),Array(8).fill(0),Fr(0),Fr(0),DT(t.info.type==="audio"?1:0),Fr(0),OP(CP(t.info.type==="video"?t.info.rotation:0)),Ua(t.info.type==="video"?t.info.width:0),Ua(t.info.type==="video"?t.info.height:0)])},OB=(t,e)=>Io("mdia",null,[bB(t,e),NB(t.info.type==="video"?"vide":"soun"),PB(t)]),bB=(t,e)=>{let r=uc(t.samples),n=Yp(r?r.timestamp+r.duration:0,t.timescale);return Ro("mdhd",0,0,[Dt(e),Dt(e),Dt(t.timescale),Dt(n),Fr(21956),Fr(0)])},NB=t=>Ro("hdlr",0,0,[Ga("mhlr"),Ga(t),Dt(0),Dt(0),Dt(0),Ga("mp4-muxer-hdlr")]),PB=t=>Io("minf",null,[t.info.type==="video"?FB():DB(),wB(),MB(t)]),FB=()=>Ro("vmhd",0,1,[Fr(0),Fr(0),Fr(0),Fr(0)]),DB=()=>Ro("smhd",0,0,[Fr(0),Fr(0)]),wB=()=>Io("dinf",null,[xB()]),xB=()=>Ro("dref",0,0,[Dt(1)],[LB()]),LB=()=>Ro("url ",0,1),MB=t=>Io("stbl",null,[BB(t),YB(t),QB(t),qB(t),XB(t),ZB(t)]),BB=t=>Ro("stsd",0,0,[Dt(1)],[t.info.type==="video"?GB(JB[t.info.codec],t):zB($B[t.info.codec],t)]),GB=(t,e)=>Io(t,[Array(6).fill(0),Fr(1),Fr(0),Fr(0),Array(12).fill(0),Fr(e.info.width),Fr(e.info.height),Dt(4718592),Dt(4718592),Dt(0),Fr(1),Array(32).fill(0),Fr(24),AB(65535)],[jB[e.info.codec](e)]),UB=t=>t.codecPrivate&&Io("avcC",[...t.codecPrivate]),VB=t=>t.codecPrivate&&Io("hvcC",[...t.codecPrivate]),kB=t=>t.codecPrivate&&Io("vpcC",[...t.codecPrivate]),HB=t=>t.codecPrivate&&Io("av1C",[...t.codecPrivate]),zB=(t,e)=>Io(t,[Array(6).fill(0),Fr(1),Fr(0),Fr(0),Dt(0),Fr(e.info.numberOfChannels),Fr(16),Fr(0),Fr(0),Ua(e.info.sampleRate)],[e2[e.info.codec](e)]),WB=t=>Ro("esds",0,0,[Dt(58753152),Zi(32+t.codecPrivate.byteLength),Fr(1),Zi(0),Dt(75530368),Zi(18+t.codecPrivate.byteLength),Zi(64),Zi(21),vP(0),Dt(130071),Dt(130071),Dt(92307584),Zi(t.codecPrivate.byteLength),...t.codecPrivate,Dt(109084800),Zi(1),Zi(2)]),KB=t=>Io("dOps",[Zi(0),Zi(t.info.numberOfChannels),Fr(3840),Dt(t.info.sampleRate),DT(0),Zi(0)]),YB=t=>Ro("stts",0,0,[Dt(t.timeToSampleTable.length),t.timeToSampleTable.map(e=>[Dt(e.sampleCount),Dt(e.sampleDelta)])]),QB=t=>{if(t.samples.every(r=>r.type==="key"))return null;let e=[...t.samples.entries()].filter(([,r])=>r.type==="key");return Ro("stss",0,0,[Dt(e.length),e.map(([r])=>Dt(r+1))])},qB=t=>Ro("stsc",0,0,[Dt(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(e=>[Dt(e.firstChunk),Dt(e.samplesPerChunk),Dt(1)])]),XB=t=>Ro("stsz",0,0,[Dt(0),Dt(t.samples.length),t.samples.map(e=>Dt(e.size))]),ZB=t=>t.finalizedChunks.length>0&&uc(t.finalizedChunks).offset>=2**32?Ro("co64",0,0,[Dt(t.finalizedChunks.length),t.finalizedChunks.map(e=>TB(e.offset))]):Ro("stco",0,0,[Dt(t.finalizedChunks.length),t.finalizedChunks.map(e=>Dt(e.offset))]),JB={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},jB={avc:UB,hevc:VB,vp9:kB,av1:HB},$B={aac:"mp4a",opus:"Opus"},e2={aac:WB,opus:KB},wT=class{constructor(){this.buffer=null}},bP=class{constructor(t,e,r){this.onData=t,this.onDone=e,this.options=r}},t2=class{constructor(t,e){this.stream=t,this.options=e}},lc,Nd,xT=class{constructor(){this.pos=0,er(this,lc,new Uint8Array(8)),er(this,Nd,new DataView(fe(this,lc).buffer)),this.offsets=new WeakMap}seek(t){this.pos=t}writeU32(t){fe(this,Nd).setUint32(0,t,!1),this.write(fe(this,lc).subarray(0,4))}writeU64(t){fe(this,Nd).setUint32(0,Math.floor(t/2**32),!1),fe(this,Nd).setUint32(4,t,!1),this.write(fe(this,lc).subarray(0,8))}writeAscii(t){for(let e=0;e<t.length;e++)fe(this,Nd).setUint8(e%8,t.charCodeAt(e)),e%8===7&&this.write(fe(this,lc));t.length%8!==0&&this.write(fe(this,lc).subarray(0,t.length%8))}writeBox(t){if(this.offsets.set(t,this.pos),t.contents&&!t.children)this.writeBoxHeader(t,t.size??t.contents.byteLength+8),this.write(t.contents);else{let e=this.pos;if(this.writeBoxHeader(t,0),t.contents&&this.write(t.contents),t.children)for(let o of t.children)o&&this.writeBox(o);let r=this.pos,n=t.size??r-e;this.seek(e),this.writeBoxHeader(t,n),this.seek(r)}}writeBoxHeader(t,e){this.writeU32(t.largeSize?1:e),this.writeAscii(t.type),t.largeSize&&this.writeU64(e)}measureBoxHeader(t){return 8+(t.largeSize?8:0)}patchBox(t){let e=this.pos;this.seek(this.offsets.get(t)),this.writeBox(t),this.seek(e)}measureBox(t){if(t.contents&&!t.children)return this.measureBoxHeader(t)+t.contents.byteLength;{let e=this.measureBoxHeader(t);if(t.contents&&(e+=t.contents.byteLength),t.children)for(let r of t.children)r&&(e+=this.measureBox(r));return e}}};lc=new WeakMap;Nd=new WeakMap;var vf,dc,Qp,Bp,Cf,RT,r2=class extends xT{constructor(t){super(),er(this,Cf),er(this,vf,void 0),er(this,dc,new ArrayBuffer(2**16)),er(this,Qp,new Uint8Array(fe(this,dc))),er(this,Bp,0),so(this,vf,t)}write(t){Hr(this,Cf,RT).call(this,this.pos+t.byteLength),fe(this,Qp).set(t,this.pos),this.pos+=t.byteLength,so(this,Bp,Math.max(fe(this,Bp),this.pos))}finalize(){Hr(this,Cf,RT).call(this,this.pos),fe(this,vf).buffer=fe(this,dc).slice(0,Math.max(fe(this,Bp),this.pos))}};vf=new WeakMap;dc=new WeakMap;Qp=new WeakMap;Bp=new WeakMap;Cf=new WeakSet;RT=function(t){let e=fe(this,dc).byteLength;for(;e<t;)e*=2;if(e===fe(this,dc).byteLength)return;let r=new ArrayBuffer(e),n=new Uint8Array(r);n.set(fe(this,Qp),0),so(this,dc,r),so(this,Qp,n)};var Gp,cc,NP=class extends xT{constructor(t){super(),er(this,Gp,void 0),er(this,cc,[]),so(this,Gp,t)}write(t){fe(this,cc).push({data:t.slice(),start:this.pos}),this.pos+=t.byteLength}flush(){if(fe(this,cc).length===0)return;let t=[],e=[...fe(this,cc)].sort((r,n)=>r.start-n.start);t.push({start:e[0].start,size:e[0].data.byteLength});for(let r=1;r<e.length;r++){let n=t[t.length-1],o=e[r];o.start<=n.start+n.size?n.size=Math.max(n.size,o.start+o.data.byteLength-n.start):t.push({start:o.start,size:o.data.byteLength})}for(let r of t){r.data=new Uint8Array(r.size);for(let n of fe(this,cc))r.start<=n.start&&n.start<r.start+r.size&&r.data.set(n.data,n.start-r.start);fe(this,Gp).onData(r.data,r.start)}fe(this,cc).length=0}finalize(){var t,e;(e=(t=fe(this,Gp)).onDone)==null||e.call(t)}};Gp=new WeakMap;cc=new WeakMap;var n2=2**24,o2=2,kp,fa,Ni,Nf,yT,LT,PP,MT,FP,Hp,Pf,DP=class extends xT{constructor(t){var e;if(super(),er(this,Nf),er(this,LT),er(this,MT),er(this,Hp),er(this,kp,void 0),er(this,fa,void 0),er(this,Ni,[]),so(this,kp,t),so(this,fa,((e=t.options)==null?void 0:e.chunkSize)??n2),!Number.isInteger(fe(this,fa))||fe(this,fa)<2**10)throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(t){Hr(this,Nf,yT).call(this,t,this.pos),Hr(this,Hp,Pf).call(this),this.pos+=t.byteLength}finalize(){var t,e;Hr(this,Hp,Pf).call(this,!0),(e=(t=fe(this,kp)).onDone)==null||e.call(t)}};kp=new WeakMap;fa=new WeakMap;Ni=new WeakMap;Nf=new WeakSet;yT=function(t,e){let r=fe(this,Ni).findIndex(s=>s.start<=e&&e<s.start+fe(this,fa));r===-1&&(r=Hr(this,MT,FP).call(this,e));let n=fe(this,Ni)[r],o=e-n.start,i=t.subarray(0,Math.min(fe(this,fa)-o,t.byteLength));n.data.set(i,o);let a={start:o,end:o+i.byteLength};if(Hr(this,LT,PP).call(this,n,a),n.written[0].start===0&&n.written[0].end===fe(this,fa)&&(n.shouldFlush=!0),fe(this,Ni).length>o2){for(let s=0;s<fe(this,Ni).length-1;s++)fe(this,Ni)[s].shouldFlush=!0;Hr(this,Hp,Pf).call(this)}i.byteLength<t.byteLength&&Hr(this,Nf,yT).call(this,t.subarray(i.byteLength),e+i.byteLength)};LT=new WeakSet;PP=function(t,e){let r=0,n=t.written.length-1,o=-1;for(;r<=n;){let i=Math.floor(r+(n-r+1)/2);t.written[i].start<=e.start?(r=i+1,o=i):n=i-1}for(t.written.splice(o+1,0,e),(o===-1||t.written[o].end<e.start)&&o++;o<t.written.length-1&&t.written[o].end>=t.written[o+1].start;)t.written[o].end=Math.max(t.written[o].end,t.written[o+1].end),t.written.splice(o+1,1)};MT=new WeakSet;FP=function(t){let r={start:Math.floor(t/fe(this,fa))*fe(this,fa),data:new Uint8Array(fe(this,fa)),written:[],shouldFlush:!1};return fe(this,Ni).push(r),fe(this,Ni).sort((n,o)=>n.start-o.start),fe(this,Ni).indexOf(r)};Hp=new WeakSet;Pf=function(t=!1){for(let e=0;e<fe(this,Ni).length;e++){let r=fe(this,Ni)[e];if(!(!r.shouldFlush&&!t)){for(let n of r.written)fe(this,kp).onData(r.data.subarray(n.start,n.end),r.start+n.start);fe(this,Ni).splice(e--,1)}}};var i2=class extends DP{constructor(t){var e;super(new bP((r,n)=>t.stream.write({type:"write",data:r,position:n}),void 0,{chunkSize:(e=t.options)==null?void 0:e.chunkSize}))}},vT=1e3,a2=["avc","hevc","vp9","av1"],s2=["aac","opus"],l2=2082844800,c2=.5,d2=["strict","offset"],tr,Er,Ff,bi,al,sl,Up,zp,Wp,CT,wP,OT,xP,BT,LP,bT,MP,GT,BP,Of,NT,UT,GP,Kp,Df,qp,wf,bf,PT,UP=class{constructor(t){var e;if(er(this,CT),er(this,OT),er(this,BT),er(this,bT),er(this,GT),er(this,Of),er(this,UT),er(this,Kp),er(this,qp),er(this,bf),er(this,tr,void 0),er(this,Er,void 0),er(this,Ff,void 0),er(this,bi,void 0),er(this,al,null),er(this,sl,null),er(this,Up,Math.floor(Date.now()/1e3)+l2),er(this,zp,[]),er(this,Wp,!1),Hr(this,CT,wP).call(this,t),t.video=Vp(t.video),t.audio=Vp(t.audio),t.fastStart=Vp(t.fastStart),this.target=t.target,so(this,tr,{firstTimestampBehavior:"strict",...t}),t.target instanceof wT)so(this,Er,new r2(t.target));else if(t.target instanceof bP)so(this,Er,(e=t.target.options)!=null&&e.chunked?new DP(t.target):new NP(t.target));else if(t.target instanceof t2)so(this,Er,new i2(t.target));else throw new Error(`Invalid target: ${t.target}`);Hr(this,OT,xP).call(this),Hr(this,bT,MP).call(this)}addVideoChunk(t,e,r){let n=new Uint8Array(t.byteLength);t.copyTo(n),this.addVideoChunkRaw(n,t.type,r??t.timestamp,t.duration,e)}addVideoChunkRaw(t,e,r,n,o){if(Hr(this,bf,PT).call(this),!fe(this,tr).video)throw new Error("No video track declared.");if(typeof fe(this,tr).fastStart=="object"&&fe(this,al).samples.length===fe(this,tr).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${fe(this,tr).fastStart.expectedVideoChunks}).`);Hr(this,Of,NT).call(this,fe(this,al),t,e,r,n,o)}addAudioChunk(t,e,r){let n=new Uint8Array(t.byteLength);t.copyTo(n),this.addAudioChunkRaw(n,t.type,r??t.timestamp,t.duration,e)}addAudioChunkRaw(t,e,r,n,o){if(Hr(this,bf,PT).call(this),!fe(this,tr).audio)throw new Error("No audio track declared.");if(typeof fe(this,tr).fastStart=="object"&&fe(this,sl).samples.length===fe(this,tr).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${fe(this,tr).fastStart.expectedAudioChunks}).`);Hr(this,Of,NT).call(this,fe(this,sl),t,e,r,n,o)}finalize(){if(fe(this,Wp))throw new Error("Cannot finalize a muxer more than once.");fe(this,al)&&Hr(this,Kp,Df).call(this,fe(this,al)),fe(this,sl)&&Hr(this,Kp,Df).call(this,fe(this,sl));let t=[fe(this,al),fe(this,sl)].filter(Boolean);if(fe(this,tr).fastStart==="in-memory"){let e;for(let n=0;n<2;n++){let o=IT(t,fe(this,Up)),i=fe(this,Er).measureBox(o);e=fe(this,Er).measureBox(fe(this,bi));let a=fe(this,Er).pos+i+e;for(let s of fe(this,zp)){s.offset=a;for(let l of s.sampleData)a+=l.byteLength,e+=l.byteLength}if(a<2**32)break;e>=2**32&&(fe(this,bi).largeSize=!0)}let r=IT(t,fe(this,Up));fe(this,Er).writeBox(r),fe(this,bi).size=e,fe(this,Er).writeBox(fe(this,bi));for(let n of fe(this,zp)){for(let o of n.sampleData)fe(this,Er).write(o);n.sampleData=null}}else{let e=fe(this,Er).offsets.get(fe(this,bi)),r=fe(this,Er).pos-e;fe(this,bi).size=r,fe(this,bi).largeSize=r>=2**32,fe(this,Er).patchBox(fe(this,bi));let n=IT(t,fe(this,Up));if(typeof fe(this,tr).fastStart=="object"){fe(this,Er).seek(fe(this,Ff)),fe(this,Er).writeBox(n);let o=e-fe(this,Er).pos;fe(this,Er).writeBox(RB(o))}else fe(this,Er).writeBox(n)}Hr(this,qp,wf).call(this),fe(this,Er).finalize(),so(this,Wp,!0)}};tr=new WeakMap;Er=new WeakMap;Ff=new WeakMap;bi=new WeakMap;al=new WeakMap;sl=new WeakMap;Up=new WeakMap;zp=new WeakMap;Wp=new WeakMap;CT=new WeakSet;wP=function(t){if(t.video){if(!a2.includes(t.video.codec))throw new Error(`Unsupported video codec: ${t.video.codec}`);if(t.video.rotation!==void 0&&![0,90,180,270].includes(t.video.rotation))throw new Error(`Invalid video rotation: ${t.video.rotation}. Has to be 0, 90, 180 or 270.`)}if(t.audio&&!s2.includes(t.audio.codec))throw new Error(`Unsupported audio codec: ${t.audio.codec}`);if(t.firstTimestampBehavior&&!d2.includes(t.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${t.firstTimestampBehavior}`);if(typeof t.fastStart=="object"){if(t.video&&t.fastStart.expectedVideoChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(t.audio&&t.fastStart.expectedAudioChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory"].includes(t.fastStart))throw new Error("'fastStart' option must be false, 'in-memory' or an object.")};OT=new WeakSet;xP=function(){var e;let t=((e=fe(this,tr).video)==null?void 0:e.codec)==="hevc";if(fe(this,Er).writeBox(IB(t)),so(this,Ff,fe(this,Er).pos),fe(this,tr).fastStart==="in-memory")so(this,bi,yP(!1));else{if(typeof fe(this,tr).fastStart=="object"){let r=Hr(this,BT,LP).call(this);fe(this,Er).seek(fe(this,Er).pos+r)}so(this,bi,yP(!0)),fe(this,Er).writeBox(fe(this,bi))}Hr(this,qp,wf).call(this)};BT=new WeakSet;LP=function(){if(typeof fe(this,tr).fastStart!="object")return;let t=0,e=[fe(this,tr).fastStart.expectedVideoChunks,fe(this,tr).fastStart.expectedAudioChunks];for(let r of e)r&&(t+=8*Math.ceil(2/3*r),t+=4*r,t+=12*Math.ceil(2/3*r),t+=4*r,t+=8*r);return t+=4096,t};bT=new WeakSet;MP=function(){if(fe(this,tr).video&&so(this,al,{id:1,info:{type:"video",codec:fe(this,tr).video.codec,width:fe(this,tr).video.width,height:fe(this,tr).video.height,rotation:fe(this,tr).video.rotation??0},timescale:720,codecPrivate:new Uint8Array(0),samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),fe(this,tr).audio){let t=Hr(this,GT,BP).call(this,2,fe(this,tr).audio.sampleRate,fe(this,tr).audio.numberOfChannels);so(this,sl,{id:fe(this,tr).video?2:1,info:{type:"audio",codec:fe(this,tr).audio.codec,numberOfChannels:fe(this,tr).audio.numberOfChannels,sampleRate:fe(this,tr).audio.sampleRate},timescale:fe(this,tr).audio.sampleRate,codecPrivate:t,samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}};GT=new WeakSet;BP=function(t,e,r){let o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(e),i=r,a="";a+=t.toString(2).padStart(5,"0"),a+=o.toString(2).padStart(4,"0"),o===15&&(a+=e.toString(2).padStart(24,"0")),a+=i.toString(2).padStart(4,"0");let s=Math.ceil(a.length/8)*8;a=a.padEnd(s,"0");let l=new Uint8Array(a.length/8);for(let c=0;c<a.length;c+=8)l[c/8]=parseInt(a.slice(c,c+8),2);return l};Of=new WeakSet;NT=function(t,e,r,n,o,i){var l;let a=n/1e6,s=o/1e6;if(t.firstTimestamp===void 0&&(t.firstTimestamp=a),a=Hr(this,UT,GP).call(this,a,t),t.lastTimestamp=a,(!t.currentChunk||a-t.currentChunk.startTimestamp>=c2)&&(t.currentChunk&&Hr(this,Kp,Df).call(this,t),t.currentChunk={startTimestamp:a,sampleData:[],sampleCount:0}),t.currentChunk.sampleData.push(e),t.currentChunk.sampleCount++,(l=i==null?void 0:i.decoderConfig)!=null&&l.description&&(t.codecPrivate=new Uint8Array(i.decoderConfig.description)),t.samples.push({timestamp:a,duration:s,size:e.byteLength,type:r}),t.lastTimescaleUnits!==null){let c=Yp(a,t.timescale,!1),d=Math.round(c-t.lastTimescaleUnits);t.lastTimescaleUnits+=d;let u=uc(t.timeToSampleTable);u.sampleCount===1?(u.sampleDelta=d,u.sampleCount++):u.sampleDelta===d?u.sampleCount++:(u.sampleCount--,t.timeToSampleTable.push({sampleCount:2,sampleDelta:d}))}else t.lastTimescaleUnits=0,t.timeToSampleTable.push({sampleCount:1,sampleDelta:Yp(s,t.timescale)})};UT=new WeakSet;GP=function(t,e){if(fe(this,tr).firstTimestampBehavior==="strict"&&e.lastTimestamp===-1&&t!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${t}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(fe(this,tr).firstTimestampBehavior==="offset"&&(t-=e.firstTimestamp),t<e.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${e.lastTimestamp*1e6} to ${t*1e6}).`);return t};Kp=new WeakSet;Df=function(t){if(t.currentChunk){if((t.compactlyCodedChunkTable.length===0||uc(t.compactlyCodedChunkTable).samplesPerChunk!==t.currentChunk.sampleCount)&&t.compactlyCodedChunkTable.push({firstChunk:t.finalizedChunks.length+1,samplesPerChunk:t.currentChunk.sampleCount}),t.finalizedChunks.push(t.currentChunk),fe(this,zp).push(t.currentChunk),fe(this,tr).fastStart==="in-memory"){t.currentChunk.offset=0;return}t.currentChunk.offset=fe(this,Er).pos;for(let e of t.currentChunk.sampleData)fe(this,Er).write(e);t.currentChunk.sampleData=null,Hr(this,qp,wf).call(this)}};qp=new WeakSet;wf=function(){fe(this,Er)instanceof NP&&fe(this,Er).flush()};bf=new WeakSet;PT=function(){if(fe(this,Wp))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};function VP(t){if(t.startsWith("avc1"))return"avc";if(t.startsWith("av01"))return"av1";if(t.startsWith("vp09"))return"vp9";if(t.startsWith("hvc1")||t.startsWith("hev1"))return"hevc";throw new Error(`Codec ${t} not supported for Mp4`)}function kP(t){if(t.startsWith("mp4a"))return"aac";if(t.startsWith("opus"))return"opus";throw new Error(`Codec ${t} not supported for Audio`)}function HP(t,e,r,n,o,i,a){try{var s=t[i](a),l=s.value}catch(c){r(c);return}s.done?e(l):Promise.resolve(l).then(n,o)}function u2(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(l){HP(i,n,o,a,s,"next",l)}function s(l){HP(i,n,o,a,s,"throw",l)}a(void 0)})}}function Va(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function p2(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{},n=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable}))),n.forEach(function(o){Va(t,o,r[o])})}return t}function _2(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function h2(t,e){return e=e??{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_2(Object(e)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}),t}var m2=t=>new VideoEncoder(t),f2=t=>new AudioEncoder(t),xf=class{encodeVideoFrame(e){if(this._cancelledOrError)throw e.close(),new Error("Video recording stopped");try{this._videoEncoder.encode(e)}catch(r){this.handleError(r)}finally{e==null||e.close()}}encodeAudioData(e){if(this._cancelledOrError)throw e.close(),new Error("Video recording stopped");try{var r;(r=this._audioEncoder)===null||r===void 0||r.encode(e)}catch(n){this.handleError(n)}finally{e.close()}}cancel(){this._cancelledOrError=!0}getFinalBuffer(){var e=this;return u2(function*(){var r,n,o;if(e._cancelledOrError)throw new Error("Video recording stopped");yield e._videoEncoder.flush(),yield(r=e._audioEncoder)===null||r===void 0?void 0:r.flush(),e._videoEncoder.close(),(n=e._audioEncoder)===null||n===void 0||n.close(),e._muxer.finalize();let{buffer:i}=e._muxer.target;if(e._videoEncoder.encodeQueueSize||!((o=e._audioEncoder)===null||o===void 0)&&o.encodeQueueSize){var a;console.error(`Exported video before encoding finished, pending video encodes: ${e._videoEncoder.encodeQueueSize}, pending audio encodes: ${(a=e._audioEncoder)===null||a===void 0?void 0:a.encodeQueueSize}`)}if(e._cancelledOrError)throw new Error("Error");return i})()}constructor(e){Va(this,"params",void 0),Va(this,"_videoEncoder",void 0),Va(this,"_audioEncoder",void 0),Va(this,"_muxer",void 0),Va(this,"_videoChunksAlreadyEncoded",void 0),Va(this,"_cancelledOrError",void 0),Va(this,"handleVideoChunk",void 0),Va(this,"handleAudioChunk",void 0),Va(this,"handleError",void 0),this.params=e,this._videoChunksAlreadyEncoded=0,this._cancelledOrError=!1,this.handleVideoChunk=(s,l)=>{if(!this._cancelledOrError)try{this._muxer.addVideoChunk(s,l),this._videoChunksAlreadyEncoded++;let{numFramesToRender:c}=this.params.video;if(!c)return;this.params.onProgress(Math.min(this._videoChunksAlreadyEncoded/c,1))}catch(c){this.handleError(c)}},this.handleAudioChunk=(s,l)=>{if(!this._cancelledOrError)try{this._muxer.addAudioChunk(s,l)}catch(c){this.handleError(c)}},this.handleError=s=>{this._cancelledOrError=!0,this.params.onError(s)};let{width:r,height:n,codec:o}=e.video.config,{videoEncoderFactory:i=m2,audioEncoderFactory:a=f2}=e;if(this._muxer=new UP({target:new wT,firstTimestampBehavior:"offset",fastStart:!1,video:{codec:VP(o),width:r,height:n},audio:e.audio&&h2(p2({},e.audio),{codec:kP(e.audio.codec)})}),this._videoEncoder=i({output:this.handleVideoChunk,error:this.handleError}),this._videoEncoder.configure(e.video.config),this._videoEncoder.state!=="configured")throw new Error("Video encoder config failed");if(e.audio&&(this._audioEncoder=a({output:this.handleAudioChunk,error:this.handleError}),this._audioEncoder.configure(e.audio),this._audioEncoder.state!=="configured"))throw new Error("Audio encoder config failed")}};function zP(t,e,r,n,o,i,a){try{var s=t[i](a),l=s.value}catch(c){r(c);return}s.done?e(l):Promise.resolve(l).then(n,o)}function Lf(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(l){zP(i,n,o,a,s,"next",l)}function s(l){zP(i,n,o,a,s,"throw",l)}a(void 0)})}}function Pd(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Mf=class{recordVideo(e){var r=this;return Lf(function*(){if(r._session)throw new Error("Recording already in progress");return new Promise(function(){var n=Lf(function*(o,i){let a=new xf({video:r.params.video,audio:r.params.audio,onError:r.onError,onProgress:r.params.onProgress});for(r._session={clockSource:e,videoEncoder:a,currentPendingEncode:null,resolve:o,reject:i},e.start();r._session;)r._session.currentPendingEncode=r.captureFrame(r._session),yield r._session.currentPendingEncode;r.params.onProgress(1)});return function(o,i){return n.apply(this,arguments)}}())})()}stopRecording(e=!1){var r=this;return Lf(function*(){if(!r._session)return;let n=r._session;r._session=null;let{clockSource:o,resolve:i,reject:a,videoEncoder:s}=n;if(o.stop(),e){s.cancel(),a(new Error("Cancelled"));return}if(yield n.currentPendingEncode,r._pendingError){a(r._pendingError);return}s.getFinalBuffer().then(i).catch(a)})()}constructor(e){var r=this;Pd(this,"params",void 0),Pd(this,"_session",void 0),Pd(this,"_pendingError",void 0),Pd(this,"_reader",void 0),Pd(this,"captureFrame",void 0),Pd(this,"onError",void 0),this.params=e,this._session=null,this._pendingError=null,this.captureFrame=function(){var n=Lf(function*(o){let{done:i,value:a}=yield r._reader.read();if(i||!a){r.stopRecording(!1);return}try{"numberOfChannels"in a?o.videoEncoder.encodeAudioData(a):(o.videoEncoder.encodeVideoFrame(a),r.params.onFrameCaptured())}catch(s){r.onError(s)}});return function(o){return n.apply(this,arguments)}}(),this.onError=n=>{this._session&&(this._pendingError=n,this.stopRecording(!1))},this._reader=e.readableStream.getReader()}};var Bf;(function(t){t.AVC_MAIN_LEVEL_4="avc1.4d0028",t.AVC_HIGH_LEVEL_5="avc1.640032",t.AVC_HIGH_LEVEL_6="avc1.64003c",t.AVC_HIGH_LEVEL_6_2="avc1.64003e",t.AVC_HIGH_PROGRESSIVE_LEVEL_6_2="avc1.64083e",t.AVC_HIGH_10_LEVEL_4="avc1.6e0028",t.AVC_HIGH_10_LEVEL_5="avc1.6e0032",t.AVC_HIGH_10_LEVEL_6="avc1.6e003c",t.AVC_HIGH_10_INTRA_LEVEL_1="avc1.6e100a",t.AVC_HIGH_10_INTRA_LEVEL_6="avc1.6e103c",t.AVC_HIGH_4_2_2_LEVEL_6="avc1.7a003c",t.AVC_HIGH_4_4_4_PREDICTIVE_LEVEL_6="avc1.f4003c",t.AV1_MAIN_LEVEL_4="av01.0.08M.08",t.VP9_PROFILE_2_LEVEL_1="vp09.02.10.10.01.09.16.09.01",t.HEVC_BASIC="hev1.1.6.L93.90",t.HEVC_MAIN_PROGRESSIVE_LEVEL_3_1="hvc1.1.6.L93.B0"})(Bf||(Bf={}));function WP(t,e){return new ReadableStream({start(r){let n=[t.getReader(),e.getReader()],o=[!1,!1];function i(a,s){a.read().then(({value:l,done:c})=>{if(c){o[s]=!0,o[0]&&o[1]&&r.close();return}r.enqueue(l),i(a,s)})}i(n[0],0),i(n[1],1)}})}function Gf(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Uf=class{stop(){this._started&&(this._started=!1,this.params.onStop())}start(){this._started||(this._started=!0,this._frameNumber=0,this.params.onStart(),this.params.setPlayheadTimeMs(this.getPlayheadTimeMs()))}getPlayheadTimeMs(){return Math.round(this._frameNumber*1e3*1e3/this.params.fps)/1e3}constructor(e){Gf(this,"params",void 0),Gf(this,"_started",void 0),Gf(this,"_frameNumber",void 0),Gf(this,"bumpTime",void 0),this.params=e,this._started=!1,this._frameNumber=0,this.bumpTime=()=>{if(!this._started)return;this._frameNumber+=1;let r=this.getPlayheadTimeMs();if(r>=this.params.durationMs){this.stop();return}this.params.setPlayheadTimeMs(r)}}};var Vf=class{constructor(e){this._readableStreamController=null;this._channelData=[];this._currentPlayheadTimeMs=0;this._framesConsumed=0;this._totalFrames=0;for(let r=0;r<e.numberOfChannels;++r)this._channelData.push(e.getChannelData(r));this._totalFrames=Math.min(...this._channelData.map(r=>r.length))||0,this._sampleRate=e.sampleRate,this._readableStream=new ReadableStream({start:r=>{this._readableStreamController=r}})}get readable(){return this._readableStream}captureAudio(e){if(this._channelData.length!==0)for(;this._currentPlayheadTimeMs+10<e;){let r=Math.min(this._totalFrames-this._framesConsumed,Math.floor(this._sampleRate*10/1e3));if(r<=0)break;this.enqueueAudioData(r),this._framesConsumed+=r,this._currentPlayheadTimeMs+=10}}stop(e=!0){var r;e&&this.enqueueAudioData(this._totalFrames-this._framesConsumed),(r=this._readableStreamController)==null||r.close()}enqueueAudioData(e){var r;e<=0||(r=this._readableStreamController)==null||r.enqueue(new AudioData({timestamp:this._currentPlayheadTimeMs*1e3,format:"f32-planar",numberOfChannels:this._channelData.length,sampleRate:this._sampleRate,data:this.createF32PlanarArrayBuffer(this._framesConsumed,e),numberOfFrames:e}))}createF32PlanarArrayBuffer(e,r){let n=this._channelData.reduce((a,s)=>Math.min(s.length-e,r)+a,0),o=new Float32Array(n),i=0;for(let a of this._channelData){let s=a.slice(e,e+Math.min(a.length-e,r));o.set(s,i),i+=s.length}return o}};var kf=class{constructor(e,r,n){this._readableStreamController=null;this._appState=e,this._canvasView=r,this._nodeId=n,this._readableStream=new ReadableStream({start:i=>{this._readableStreamController=i}});let o=this._canvasView.thumbnailRenderer();if(!o)throw new Error("Thumbnail renderer not ready");this._thumbnailRenderer=o}get readable(){return this._readableStream}getSize(){let r=this.getNode().fullSizeCanvasSpaceBoundingBox(),n=Math.min(Math.min(3840/r.width(),1),Math.min(2160/r.height(),1));return{width:2*Math.round(r.width()*n/2),height:2*Math.round(r.height()*n/2)}}getNode(){let e=this._appState.scene().findNode(this._nodeId);if(!e)throw new Error(`Cannot find node ${this._nodeId} in scene`);return e}captureFrame(e){var s;let r=this.getNode(),n=r.fullSizeCanvasSpaceBoundingBox(),o=n.topLeft(),i=new mn(o,1),a=this._thumbnailRenderer.generateThumbnail(r,i,n.width(),n.height());if(!a)throw new Error("Failed to generate thumbnail for node");(s=this._readableStreamController)==null||s.enqueue(new VideoFrame(a,{codedWidth:n.width(),codedHeight:n.height(),format:"RGBA",timestamp:e*1e3}))}stop(){var e;(e=this._readableStreamController)==null||e.close()}};var Fd=class{constructor(e){this._currentSeeked=0;this._allSeekedPromise=new Un;this._listeners=[];this.onSeeked=()=>{this._currentSeeked+=1,this._currentSeeked>=this._runtimes.length&&this._allSeekedPromise.resolve()};this._runtimes=e,this._listeners=e.map(r=>r.on("seeked",this.onSeeked))}async seek(e){this._allSeekedPromise=new Un,this._currentSeeked=0,this._runtimes.forEach(r=>{r.currentTime2((e+.001)/1e3)}),this._runtimes.length===0&&this._allSeekedPromise.resolve(),await this._allSeekedPromise.realPromise()}destroy(){this._runtimes.forEach((e,r)=>e.off("seeked",this._listeners[r]))}};var KP=30,g2=4e6,S2=48e3,Hf=class{constructor(e,r){this._isExporting=!1;this._appState=e,this._canvasView=r}async exportVideo(e,r){if(this._isExporting)throw new Error("Video export is already in progress");this._isExporting=!0;let n=[],o=[],i=null,a=null;try{let s=this._appState.videoManager().getRuntimesForVisibleVideos();if(s.length===0)throw new Error("No videos found for export");i=new Fd(s);let l=Math.max(...s.map(S=>S.duration()))*1e3,c=new kf(this._appState,this._canvasView,e),{allReadableStreams:d,audio:u,audioExportController:p}=await this.prepareVideoExport(s,c);if(r!=null&&r.aborted)throw new Error("Export cancelled");let _=new Uo;n=ss.getImagesInSubtree(c.getNode()).map(S=>S.gif()).filter(S=>S!==null),o=n.map(S=>S.replaceTimeSource(_));let h=new Uf({fps:KP,durationMs:l,onStop:()=>{c.stop(),p==null||p.stop()},onStart:()=>{},setPlayheadTimeMs:async S=>{_.setCurrentTime(S);let R=i==null?void 0:i.seek(S);p==null||p.captureAudio(S),await R,c.captureFrame(S)}}),{width:A,height:m}=c.getSize(),g=new Mf({video:{config:{bitrate:g2,codec:Bf.AVC_HIGH_LEVEL_6_2,latencyMode:"quality",bitrateMode:"variable",width:A,height:m,framerate:KP}},audio:u,onProgress:S=>{},onFrameCaptured:h.bumpTime,readableStream:d});return a=()=>{g.stopRecording(!0)},r==null||r.addEventListener("abort",a,{once:!0}),await g.recordVideo(h)}finally{i==null||i.destroy(),a&&(r==null||r.removeEventListener("abort",a)),n.forEach((s,l)=>s.replaceTimeSource(o[l])),this._isExporting=!1}}isExporting(){return this._isExporting}async prepareVideoExport(e,r){var a;let n=(a=e[0])==null?void 0:a.getMP4VideoBlob();if(!n)return{allReadableStreams:r.readable};let o=await n.arrayBuffer(),i=new AudioContext({sampleRate:S2});try{let s=await i.decodeAudioData(o),l=new Vf(s);return{allReadableStreams:WP(l.readable,r.readable),audio:{numberOfChannels:s.numberOfChannels,sampleRate:s.sampleRate,codec:"mp4a.40.2"},audioExportController:l}}catch{return{allReadableStreams:r.readable}}finally{i.close()}}};var zf=class{constructor(e){this.params=e;this._startedAtMs=null;this._pausedAtMs=null;this._currentPlayheadTimeMs=0}stop(){this._startedAtMs&&(this.params.appState.removeFrameObserver(this),this._startedAtMs=null,this._pausedAtMs=null,this.params.onStop())}start(){this._startedAtMs||this._pausedAtMs||(this.params.appState.addFrameObserver(this),this._startedAtMs=performance.now(),this._currentPlayheadTimeMs=0,this.params.onStart(),this.params.setPlayheadTimeMs(this._currentPlayheadTimeMs))}pause(){this._pausedAtMs=performance.now(),this.params.onPause()}resume(){if(!this._startedAtMs||!this._pausedAtMs)return;let e=performance.now()-this._pausedAtMs;this._startedAtMs=this._startedAtMs+e,this._pausedAtMs=null,this.params.onResume()}onFrame(){if(!this._startedAtMs||this._pausedAtMs)return;let e=performance.now();if(this._currentPlayheadTimeMs=e-this._startedAtMs,this._currentPlayheadTimeMs>=this.params.durationMs){this.stop();return}this.params.setPlayheadTimeMs(this._currentPlayheadTimeMs)}};var A2=1e3,Wf=class{constructor(e){this.appState=e;this._session=null;this.stop=()=>{if(!this._session)return;let{clockSource:e,gifs:r,videoRuntimes:n,oldGifTimeSources:o,signal:i}=this._session;this._session=null,i==null||i.removeEventListener("abort",this.stop),r.forEach((a,s)=>a.replaceTimeSource(o[s])),n.forEach(a=>a.pause()),e.stop()}}async play({nodeId:e,onPlayheadTimeMs:r,onPause:n,onResume:o,onStop:i,onStart:a,onDurationMs:s,signal:l}){var g,S;if(((g=this._session)==null?void 0:g.state)==="playing"||((S=this._session)==null?void 0:S.state)==="paused")return;l==null||l.addEventListener("abort",this.stop,{once:!0});let c=this.appState.scene().findNode(e);if(!c)throw new Error(`Cannot find node with ID ${e} in scene`);let d=this.appState.videoManager().getRuntimesForVisibleVideos(),u=new Uo,p=ss.getImagesInSubtree(c).map(R=>R.gif()).filter(R=>R!==null),_=p.map(R=>R.replaceTimeSource(u)),h=Math.max(...d.map(R=>R.duration()))*A2;s(h),await new Fd(d).seek(0);let m=new zf({appState:this.appState,durationMs:h,onStop:()=>{i(),this.stop()},onStart:()=>{a(),d.forEach(R=>R.play())},onPause:n,onResume:o,setPlayheadTimeMs:R=>{r(R),u.setCurrentTime(R)}});m.start(),this._session={state:"playing",clockSource:m,videoRuntimes:d,gifs:p,oldGifTimeSources:_,mockGlobalTime:u,signal:l}}isPlayingOrPaused(){return this._session!==null}resume(){var e;((e=this._session)==null?void 0:e.state)==="paused"&&(this._session.state="playing",this._session.videoRuntimes.filter(r=>!r.ended()).forEach(r=>r.play()),this._session.clockSource.resume())}pause(){!this._session||this._session.state==="paused"||(this._session.state="paused",this._session.videoRuntimes.forEach(e=>e.pause()),this._session.clockSource.pause())}};var Kf=class{constructor(e,r){this._mockGlobalTime=new Uo;this._gifsStopped=!1;this._abortController=null;this._appState=e,this._exporter=new Hf(e,r),this._player=new Wf(e),this._sceneDidCompleteInitialLoadPromise=new Promise(n=>{function o(){Ht.getEventEmitter().off("sceneDidCompleteInitialLoad",o),n()}Ht.getEventEmitter().on("sceneDidCompleteInitialLoad",o)})}async waitForSceneHydratedAndAssetsLoaded(){await this._sceneDidCompleteInitialLoadPromise;let e=this._appState;await new Promise(r=>{function n(){e.imageManager().hasPendingImages()?setTimeout(n,0):r()}n()}),await Promise.all(this._appState.videoManager().getRuntimesForVisibleVideos().map(r=>r.waitForLoad().realPromise())).then(()=>{})}exportVideo(e){var n;(n=this._abortController)==null||n.abort();let r=this._abortController=new AbortController;return this.waitForSceneHydratedAndAssetsLoaded().then(()=>this._exporter.exportVideo(e,r.signal)).finally(()=>{r===this._abortController&&(this._abortController=null)})}cancelCurrentTimelineActions(){var e;(e=this._abortController)==null||e.abort(),this._abortController=null}async play(e){var n;if(this._exporter.isExporting())throw new Error("Cannot play video while exporting");if(this._player.isPlayingOrPaused()){this._player.resume();return}(n=this._abortController)==null||n.abort();let r=this._abortController=new AbortController;this.waitForSceneHydratedAndAssetsLoaded().then(()=>this._player.play({...e,onStop:()=>{r===this._abortController&&(this._abortController=null),e.onStop()},signal:r.signal}))}pause(){this._player.pause()}stop(){this._player.stop()}};var Yf=class{check(e){(!this._lastOffset.equals(e.offset())||this._lastZoomScale!=e.zoomScale())&&(this._lastOffset=e.offset(),this._lastZoomScale=e.zoomScale(),this.onChange!=null&&this.onChange(this._lastOffset,this._lastZoomScale))}resetStateForTests(){this._lastOffset=ge.FrozenVector_ZERO,this._lastZoomScale=0}constructor(){this._lastOffset=ge.FrozenVector_ZERO,this._lastZoomScale=0,this.onChange=null}};var kT=(r=>(r[r.SHORTCUT=0]="SHORTCUT",r[r.SCROLL=1]="SCROLL",r))(kT||{});var Qf=class{constructor(e,r){this.swappedStablePath=e,this.hotspotStablePath=r}},qf=class{willTriggerHotspot(e,r,n,o){this.willTriggerHotspotCallback!=null&&this.willTriggerHotspotCallback(e,r,n,o)}didScrollNode(e){this.didScrollNodeCallback!=null&&this.didScrollNodeCallback(e)}constructor(e,r){this.willTriggerHotspotCallback=e,this.didScrollNodeCallback=r}},Dd=class t{constructor(e,r){this.FRAMES_TO_FINISH_RENDERING=3,this._state=t.State.INACTIVE,this._framesToFinishRendering=0,this._observers=new dn,this._emitter=null,e.addObserver(this),this._emitter=r}onFrame(){this._state==t.State.WAITING_TO_FINISH&&(this._framesToFinishRendering==0?(this._emitter.trigger("renderingStop"),this._observers.forEach(e=>{e.handleRenderingStop()}),this._state=t.State.INACTIVE):this._framesToFinishRendering=this._framesToFinishRendering-1)}handleSetNeedsBlit(e){this._state==t.State.INACTIVE?e&&(this._emitter.trigger("renderingStart"),this._observers.forEach(r=>{r.handleRenderingStart()}),this._state=t.State.ACTIVE):this._state==t.State.ACTIVE?e||(this._state=t.State.WAITING_TO_FINISH,this._framesToFinishRendering=this.FRAMES_TO_FINISH_RENDERING):e&&(this._state=t.State.ACTIVE)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}};(e=>{let t;(i=>(i[i.ACTIVE=0]="ACTIVE",i[i.INACTIVE=1]="INACTIVE",i[i.WAITING_TO_FINISH=2]="WAITING_TO_FINISH"))(t=e.State||(e.State={}))})(Dd||(Dd={}));var me=class me extends Su{constructor(e){super(),this._appState=null,this._observers=new dn,this._renderer=null,this._renderingStateTracker=null,this._idlenessTracker=null,this._transitionBehaviorManager=null,this._scrollSyncer=null,this._sequentialActionManager=null,this._viewportTracker=new Yf,this._viewport=new xo,this._hotspotAnimation=new Jm,this._uiRenderData=new yp,this._showHotspots=!0,this._multiplayer=null,this._mostRecentTransitionViaArrows=!1,this._mostRecentTransitionViaArrowsLegacy=!1,this._mostRecentFrameNum=0,this._sequentialBlankFrameStartTimestamp=null,this._microtasksSinceLastFrame=0,this.MAX_MICROTASKS_PER_FRAME=2,this.onResize=null,this.onBaseScreenIdChanged=null,this.onScalingModeChanged=null,this.userDidAttemptZoom=null,this.disengageObservationMode=null,this.onURLClicked=null,this.onNavigateToPrototype=null,this.afterFrame=null,this.afterFirstRenderOfScreenStack=null,this._emitter=null,this._pointerEventDelegate=null,this.INTERACTION_REPORTING_RATE=10/100,this._currentMouseLocation=null,this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedData=new tf,this._mouseEnteredNodesManager=null,this._initialFlingVelocity=new O(0,0),this._interactionObservers=new dn,this.ALT_CODE=18,this.SHIFT_CODE=16,this.META_CODE=91,this.CONTROL_CODE=17,this._appState=e,this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._emitter=Ht.getEventEmitter(),this.makeRenderer(),this.setPhysicsForOS(this.getRelevantOS()),this._idlenessTracker=new $m(r=>{this._renderer.setZoomScale(r)},this._emitter),this._pointerEventDelegate=new me.CanvasPointerEventDelegate(this),this._scrollSyncer=new Mp(this,this._appState),this._sequentialActionManager=new yf(this,this._appState.prototypeState()),this._mouseEnteredNodesManager=new rf(this._appState),this._loggedInvalidFramePresetSize=!1,this._timelineManager=new Kf(e,this)}scrollPositionSyncer(){return this._scrollSyncer}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){this._renderer.setBackgroundEnabled(e)}renderingStateTracker(){return this._renderingStateTracker}makeRenderer(){let e=this._renderer;if(e!=null&&e.removeFrom(this),K.getFeatureFlags().viewer_disable_rendering)this._renderer=new nf;else{let r=new ki({needsAlpha:this._appState.needsAlphaGPUBackingStore()}),n=r.createVertexBufferPool(),o=i=>new ol(r,n,i);this._renderer=new As(this._viewport,this._appState,this._appState.imageManager(),this._emitter,r,n,o)}this._transitionBehaviorManager!=null&&this._transitionBehaviorManager.removeFrom(this),this._transitionBehaviorManager=new lf(this),this._renderingStateTracker!=null&&this._appState.removeFrameObserver(this._renderingStateTracker),this._renderingStateTracker=new Dd(this._renderer,this._emitter),this._appState.addFrameObserver(this._renderingStateTracker),e!=null&&this._renderer!=null&&this._renderer.attachTo(this)}graphicsCardName(){return this._renderer.graphicsCardName()}deviceRenderer(){return this._renderer.deviceRenderer()}initializeThumbnailInvalidationManager(e){e!==null&&this._renderer.initializeThumbnailInvalidationManager(e)}thumbnailRenderer(){return this._renderer.thumbnailRenderer()}getContext(){return this._renderer.getContext()}appState(){return this._appState}idlenessTracker(){return this._idlenessTracker}viewport(){return this._viewport}viewportTracker(){return this._viewportTracker}timelineManager(){return this._timelineManager}mostRecentFrameNum(){return this._mostRecentFrameNum}setScrollPadding(e,r,n,o){this._viewport.setScrollPadding([e,r,n,o])}setMultiplayer(e){this._multiplayer=e}setShowHotspots(e){this._showHotspots=e}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._viewport.invalidate(),this._invalidateZoomScaleForRender(),this._idlenessTracker.handleSceneChange(),this._setCurrentViewportSizeOnCanvas()}resetStateForTests(){this._viewport.resetStateForTests(),this._viewportTracker.resetStateForTests(),this._appState.resetStateForTests(),this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedData.resetAllEntries(),this._pointerEventDelegate.resetStateForTests(),this._mouseEnteredNodesManager.reset(),this._appState.prototypeState().addHsmObserver(this)}handleActiveCanvasChange(e,r){r!=null?this._viewport.invalidate():this._currentMouseLocation=null}handleActivePrototypeStartingPointChange(e,r){}afterEnteredViewer(){this._appState.nodeTransitionTracker().triggerPotentialTimedTransition=()=>{let e=this._appState.prototypeState(),r=[];e.getCurrentBaseScreenNode()!=null&&r.push(e.getCurrentBaseScreenNode());for(let n=0,o=e.getCurrentOverlayData().length;n<o;n=n+1)r.push(e.nodeForOverlayAt(n));this._triggerPotentialTimedTransition(r,0)},this._appState.nodeTransitionTracker().triggerPotentialTimedTransitionForSpecificRootNode=e=>{e&&this._triggerPotentialTimedTransition([e],0)},this._appState.nodeTransitionTracker().createVideoTriggerEventsForNodesInFrame=e=>{e&&this._createVideoTriggerEvents([e])},this._appState.nodeTransitionTracker().createVideoTriggerEventsForAllNodesOnscreen=()=>{let e=[],r=this._appState.prototypeState();r.getCurrentBaseScreenNode()!=null&&e.push(r.getCurrentBaseScreenNode());for(let n=0,o=r.getCurrentOverlayData().length;n<o;n=n+1)e.push(r.nodeForOverlayAt(n));this._createVideoTriggerEvents(e)}}navigateForward(e,r){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let o=this._appState.prototypeState().getCurrentBaseScreenNode();if(o==null)return;if(this._appState.prototypeState().getInitiatedChange()&&this._appState.prototypeStructure().navigationOrder().shouldCommitInitiatedChangeOnNavigate()){this._appState.prototypeState().commitStateChange(),this._viewport.invalidate();return}let i=this._appState.prototypeStructure().navigationOrder().getNextObjectAnimation();if(i!=null){let s=o.getObjectAnimationInteraction(i);if(s!=null)for(let l=i.actionIndex;l<s.allActions().length;l++)this._sequentialActionManager.appendObjectAnimationActionToQueue(s.id(),l,0);this._sequentialActionManager.runNextAction();return}if(K.shouldPlayVideosLinearly()&&this._appState.videoManager().playNextVisibleVideo()&&r)return;let a=this._appState.prototypeStructure().navigationOrder().getNextBaseScreenNode();if(a!=null){this.navigateViaArrows(o.id(),a.id(),0,e);return}}navigateBackward(e){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenNode();if(n==null)return;if(this._appState.prototypeState().getInitiatedChange()){this._appState.prototypeState().abortStateChange(),this._viewport.invalidate();return}let i=this._appState.prototypeState().getCurrentAnimationState(),a=this._appState.prototypeStructure().navigationOrder().getPreviousObjectAnimation();if(i!=null){this._appState.prototypeState().playObjectAnimation(n,a,1);return}let s=this._appState.prototypeState().getPreviousBaseScreenNode();if(s!=null){this.navigateViaArrows(n.id(),s.id(),1,e);return}}navigateToFrameAtIndex(e){let r=this._appState.prototypeState().getCurrentBaseScreenId();if(r==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenIndex(),o=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();if(e<0||e>o.length-1||e==n)return;let i=Q.fromString(o[e]),a=n<e?0:1;this.navigateViaArrows(r,i,a,null)}navigateViaArrows(e,r,n,o){this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,Math.random()<this.INTERACTION_REPORTING_RATE&&be.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:On[n],nonInteraction:0,prototypeType:this._appState.prototypeStructure().navigationOrder().navigationOrderTypeString()});let i=this._appState.prototypeState().getCurrentBaseScreenNode();if(i!=null&&i.prototypeInteractions().length>0){let a=null;for(let s=0,l=i.prototypeInteractions().length;s<l;s=s+1){let c=i.prototypeInteractions()[s],d=(c==null?void 0:c.action())!=null?c.action().value:null;if(c!=null&&c.allActions().length>0)for(let p of c.allActions())p.transitionNodeID()!=null&&p.transitionNodeID()==r&&(d=p);let u=d!=null?this._appState.scene().findNode(d.transitionNodeID()):null;if(u!=null){let p=Fn.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),i==null?void 0:i.id(),u==null?void 0:u.id(),d.navigationType(),d.connectionType());a=p??null}if(Q.equals(a,r)){this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,i,1,n,o,c,d);return}}}this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,null,1,n,o,null,null)}_navigateToHyperlink(e,r){var n;if(e.hyperlink.url!==void 0){this.onURLClicked(e.hyperlink.url,!0);return}else if(e.hyperlink.guid!==void 0){let o=ut.decodeGUID(e.hyperlink.guid);if(Q.equals(o,this._appState.getActiveCanvas().id())){this._appState.prototypeState().restartPrototype(1);return}let i=this._appState.scene().findNode(o),a=Fn.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),(n=e.node)==null?void 0:n.id(),i==null?void 0:i.id(),r,"URL");if(a!=null){this._appState.prototypeState().navigateToFrameAndCloseOverlays(a);return}let s=this._appState.currentFileKey();this.onNavigateToPrototype(s,o)}}triggerHotspot(e,r,n,o){var a;if(this._multiplayer!=null&&this._multiplayer.isObserving()||(this._observers.forEach(s=>{s.willTriggerHotspot(e,r,n,o)}),this._appState.prototypeRecorder().isRecording()&&this._appState.prototypeRecorder().addHistoricalEvent({type:"INTERACTION",targetPath:e.node.stablePath().toString(),name:e.node.name(),interaction:r.id(),action:n,timeRecorded:Date.now(),currentFrameName:(a=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:a.name(),canvasViewSpaceMousePosition:o==null?void 0:this._canvasSpacePoint(o).toJSON()}),r==null||r.actions().length==0))return;!sc.seenOldStateManagementInteraction()&&r.stateManagementVersion()==0&&(be.trackDefinedEvent("prototype.viewer_old_noodle_used",{}),sc.markOldStateManagementInteractionSeen());let i=e.node.getResolvedVariableModesForPrototype();for(let s=0,l=r.actions().length;s<l;s=s+1){let c=r.actions()[s],d=c.connectionType();Math.random()<this.INTERACTION_REPORTING_RATE&&be.trackEvent("prototype_view_interaction",{type:"triggerHotspot",transitionAction:rt[n],transitionType:c==null?void 0:c.transitionType(),action:d=="INTERNAL_NODE"?c==null?void 0:c.navigationType():d=="UPDATE_MEDIA_RUNTIME"?c==null?void 0:c.mediaAction():d,nonInteraction:0}),K.getViewerMode()==K.ViewerMode.MIRROR&&be.trackDefinedEvent("mobile_platform.first_prototype_interaction_mirror",{});let u=e.node.id();if(e.node.isOrInInstance()){let p=e.node.findContainingPrimaryInstance();p&&p.id()&&(u=p.id())}this._sequentialActionManager.appendHotspotActionToQueue(e,r,n,o,c,d,[s],i,u)}this._sequentialActionManager.runNextAction()}runSequentialAction(e,r,n,o,i,a,s,l,c){let d=!0;switch(a){case"INTERNAL_NODE":{let u=i.transitionNodeID();this._performNavigationOrOverlayChangeForHotspot(e.node,u,n,r,o,s),i.navigationType()=="SCROLL_TO"&&i.transitionType()!="SCROLL_ANIMATE"||(d=!1);break}case"URL":{e.hyperlink==null?this.onURLClicked(i.connectionURL(),i.openUrlInNewTab()):this._navigateToHyperlink(e,i.navigationType());break}case"BACK":{this.requestBack(e.node,r,1,rt.fromInteractionType(r.event().interactionType()),rn.fromPrototypeAction(i,r.stateManagementVersion()),i,o),d=!1;break}case"CLOSE":{this._appState.prototypeState().closeOverlayForHotspot(e.node,r,1,i),d=!1;break}case"SET_VARIABLE":{let u=F();if(u.fonts().isWaitingForFontList())return;let p=i.targetVariableID()?u.getICActionsForSetVariableAction(c,i.targetVariableID(),i.targetVariableData(),this._appState.prototypeState().getTopmostScreenId(),l):[];if(p.length>0){let _=Qn.instance.setReverseVariantBindingsForICsDisabled(!0);for(let h of p){let m=e.node.scene().findNode(h.nodeToSwap),g=m.prototypeInteractions()[h.interactionIndex];this.runSequentialAction(new Ci(m),g,0,null,g.actions()[h.actionIndex],"INTERNAL_NODE",[h.actionIndex],l,c)}Qn.instance.setReverseVariantBindingsForICsDisabled(_),d=!1}if(i.targetVariableID()){let _=F().runSetVariable(c,i.targetVariableID(),i.targetVariableData(),l);this._appState.prototypeState().createMultiplayerSetVariableAction(c,i.targetVariableID(),_,l)}break}case"SET_VARIABLE_MODE":{let u=i.targetVariableSetID()?i.targetVariableSetID():i.deprecatedTargetVariableSetKey()?F().sceneGraphTsApi().getVariableSetIDByKey(i.deprecatedTargetVariableSetKey()):null,p=i.targetVariableModeID();if(u===null){console.warn(`SET_VARIABLE_MODE action has ${!!i.targetVariableSetID()} targetVariableSetID and ${!!i.deprecatedTargetVariableSetKey()} deprecatedTargetVariableSetKey, and was not able to resolve the final setID. Cannot set variable mode.`);break}if(p===null){we("SET_VARIABLE_MODE action has no targetVariableModeId. Cannot set variable mode.");break}let _=K.getFeatureFlags().prototype_log_run_action?performance.now():0;if(F().runSetVariableMode(c,u,p),K.getFeatureFlags().prototype_log_run_action){let h=performance.now()-_,A=F().sceneGraphTsApi().getVariableSetInfoForSetModeAnalytics(u);be.trackDefinedEvent("prototype.run_action",{action:"SET_VARIABLE_MODE",interaction_type:r.event().interactionType(),time_in_ms:h,...A})}this._appState.prototypeState().createMultiplayerSetVariableModeAction(c,u,p);break}case"UPDATE_MEDIA_RUNTIME":{this._appState.videoManager().updateVideoRuntime(i,e.node.id());break}case"CONDITIONAL":{if(F().fonts().isWaitingForFontList()||i.conditionalActions().length==0)return;let u=F().getFirstTruthyConditionalIndex(c,i.conditionalActions()[0].condition());if(u>=0&&u<i.conditionalActions().length){let _=i.conditionalActions()[u].actions();for(let h=0,A=_.length;h<A;h=h+1){let m=_[h],g=[s[0],u,h];this._sequentialActionManager.insertHotspotActionInQueue(e,r,n,o,m,m.connectionType(),g,h,l,c)}}break}default:console.error(`Unhandled connection type: ${a}`)}d&&this._sequentialActionManager.runNextAction()}triggerDelayedHotspot(e,r,n){var i;let o=(i=this._appState.scene())==null?void 0:i.findNode(e);o!=null&&this.triggerHotspot(new Ci(o),r,n,null)}_findPrototypeActionGivenActionIndexPath(e,r){let n=e.actions(),o=r[0];if(o<n.length){let i=n[o];if(r.length>2){let a=r[1],s=r[2];if(i.conditionalActions()!=null&&i.conditionalActions().length>a){let l=i.conditionalActions()[a];if(l.actions()!=null&&l.actions().length>s)return l.actions()[s]}}return i}return null}_performNavigationOrOverlayChangeForHotspot(e,r,n,o,i,a){var l;this._mostRecentTransitionViaArrows=!1,this._mostRecentTransitionViaArrowsLegacy=i==null;let s=this._findPrototypeActionGivenActionIndexPath(o,a);if(e==null&&we("Hotspot node unexepectedly null when performing navigation or overlay change for hotspot"),e==null||s.navigationType()=="NAVIGATE"||s.navigationType()=="SWAP"&&this._appState.prototypeState().getTopmostOverlayId()==null)this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,e,1,0,n,o,s);else if(s.navigationType()=="SCROLL_TO")this.scrollToDestinationInFrame(r,o);else if(s.navigationType()=="OVERLAY")this._appState.prototypeState().overlayFrame(r,e,0,n,o,s);else if(s.navigationType()=="SWAP")this._appState.prototypeState().swapTopOverlay(r,e,n,o,s);else if(s.navigationType()=="SWAP_STATE"){if(F().fonts().isWaitingForFontList())return;let c=(l=$t.whichInstanceToSwap(e,s.transitionNodeID()))==null?void 0:l.stablePath();c!=null&&this._appState.prototypeState().swapInstanceToState2(c,r,e,n,o,1,s)}}requestBack(e,r,n,o,i,a,s){var l;this._appState.prototypeRecorder().isRecording()&&this._appState.prototypeRecorder().addHistoricalEvent({type:"INTERACTION",targetPath:e.stablePath().toString(),name:e.name(),interaction:r?r.id():"-1:-1",action:o,timeRecorded:Date.now(),currentFrameName:(l=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:l.name(),canvasViewSpaceMousePosition:s==null?void 0:this._canvasSpacePoint(s).toJSON()}),this._appState.prototypeState().returnToState2(e,r,n,o,i,a)}handleHsmAborted(e,r){this._renderer.abortHsmTransition(e,r),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(r.stablePath);let n=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(e,o=>(n.push(this._appState.scene().findNodeByStablePath(o)),0)),this._onCommitOrAbortForInteractions(n,r.cause,r.oldStateId())}handleHsmCommitted(e,r,n){this._renderer.commitHsmTransition(e,r),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(r.stablePath);let o=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(e,i=>(o.push(this._appState.scene().findNodeByStablePath(i)),0)),n(()=>{this._onCommitOrAbortForInteractions(o,r.cause,r.oldStateId())})}handleHsmRequested(e,r){sc.newStateManagementRulesEnabledForChange(r)&&this._scrollSyncer.commitCurrentScrollStateToStorage(r)}handleHsmInitiated(e,r){sc.newStateManagementRulesEnabledForChange(r)&&(r.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(r):this._scrollSyncer.resetScrollStateToScene(r));let n=this._multiplayer!=null&&this._multiplayer.isObserving(),o=this._transitionBehaviorManager.getTransitionMixinForStateSwap(this._appState.scene(),r,n);this._renderer.triggerHsmTransition(e,r,o),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(r.stablePath)}handleStateChangeAborted(e){this._updateCanvasForCurrentBaseScreen();let r=null,n=[];Q.equals(e.oldStateId(),e.newStateId())||n.push(e.oldStateId());let o=e.oldOverlayData(),i=e.newOverlayData();for(let a=0,s=o.length;a<s;a=a+1)(a>=i.length||!Q.equals(o[a].id,i[a].id))&&n.push(o[a].id);if(r=n.map(a=>{var s;return(s=this._appState.scene())==null?void 0:s.findNode(a)}).filter(a=>a!=null),!Q.equals(e.oldStateId(),e.newStateId())&&this.onBaseScreenIdChanged!=null){let a=this._appState.scene().findNode(e.newStateId()),s=a==null?void 0:a.isSymbol();this.onBaseScreenIdChanged(e.oldStateId(),rt.getControlSource(e.cause),!e.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState(),s)}e.isObjectAnimation()?this._renderer.handleAbortedObjectAnimation(e):this._renderer.handleAbortedTransition(e),this._updateViewportForCurrentPreview(),this._appState.currentScalingInfo().fitMode=="free"&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate(),this._onCommitOrAbortForInteractions(r,e.cause,e.oldStateId())}handleStateChangeCommitted(e,r){this._updateCanvasForCurrentBaseScreen(),e.isObjectAnimation()?this._renderer.handleCommittedObjectAnimation(e):this._renderer.handleCommittedTransition(e);let n=e.getNewOrChangedFrames(this._appState.scene()),o=this._appState.scene().findNode(this._appState.prototypeState().getTopmostScreenId());o!=null&&kn(o,i=>(i!=o&&i.isInstance()&&n.push(i),0)),r(()=>{this._onCommitOrAbortForInteractions(n,e.cause,e.oldStateId())})}handleStateChangeInitiated(e){if(this._updateCanvasForCurrentBaseScreen(),this._appState.baseScreenNode()==null&&!K.isInlinePreview()){console.warn("no current TLF after receiving update");return}if(this.setPhysicsForOS(this.getRelevantOS()),e.isObjectAnimation())this._renderer.triggerObjectAnimation(e,this._viewport);else{let n=this._multiplayer!=null&&this._multiplayer.isObserving(),o=this._transitionBehaviorManager.getTransitionMixin(this._appState.scene(),e,n);this._renderer.triggerTransition(e,this._viewport,o)}if(this.setPhysicsForOS(this.getRelevantOS()),!Q.equals(e==null?void 0:e.oldStateId(),e==null?void 0:e.newStateId())&&this.onBaseScreenIdChanged!=null){let n=this._appState.scene().findNode(e.newStateId()),o=n==null?void 0:n.isSymbol();this.onBaseScreenIdChanged(e.newStateId(),rt.getControlSource(e.cause),!e.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState(),o)}let r=this._appState.prototypeState();if(e.stateManagementVersion()==1)this._scrollSyncer.commitCurrentScrollStateToStorage(e),e.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(e):this._scrollSyncer.resetScrollStateToScene(e);else if(e.preserveScroll()==1)me.matchNodesAndPreserveScroll(this,r,e);else{let n=e.getNewOrChangedFrames(this._appState.scene());for(let o of n)this._resetScrollForTlf(o)}this._pointerEventDelegate.unlockScroll(),this._updateViewportForCurrentPreview(),this._appState.currentScalingInfo().fitMode=="free"&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate()}handleStateChangeRequested(e){}handleFitModeChange(e,r){this._appState.baseScreenNode()!=null&&!M1(this._appState.prototypeState().getCurrentScalingInfo())&&(this._appState.activePrototypeDevice()!=null&&ws.hasDevice(this._appState.activePrototypeDevice().type)||this.updateScrollOffsetForNode(this._appState.baseScreenNode(),new O(0,0))),this._renderer.changeFitMode(r.fitMode),this.onScalingModeChanged!=null&&this.onScalingModeChanged(r),(e.contentScalingMode=="responsive"||r.contentScalingMode=="responsive")&&(this.maybeAbortStateChanges("CanvasView.handleFitModeChange"),this.resetResponsiveState()),this._setCurrentViewportSizeOnCanvas()}resetResponsiveState(e){var r;(r=F())==null||r.resetLocalNodeSizeChanges(e??null)}handleRestartPrototype(){this._scrollSyncer.uninit(),this.cancelAnimationManager(),this._mouseEnteredNodesManager.reset()}_updateCanvasForCurrentBaseScreen(){let e=this._appState.baseScreenNode();(e==null?void 0:e.canvas())!=null&&(this._appState.setActiveCanvas(e.canvas()),this._setCurrentViewportSizeOnCanvas())}_updateViewportForCurrentPreview(){let e=this._appState.currentScalingInfo(),r=this._appState.activePrototypeDevice(),n=this._renderer.currentCanvasSpaceFrameBounds(),o=this._renderer.currentCanvasSpacePreviewBounds();n!=null&&o!=null?this._viewport.updateForCurrentPreview(n,o,e,r):this._viewport.updateForBaseScreen(this._appState.baseScreenNode(),e,r)}_updateResponsiveSizeForCurrentBaseScreen(){var c;if(this._appState.currentScalingInfo().contentScalingMode!=="responsive")return;let e=this._appState.baseScreenNode();if(e==null||e.isSymbol())return;let r=this._appState.baseScreenId(),n=this._appState.storedPrototypeDevice(),o=n&&n.type==="PRESET",i=e.fullSize(),a=null;if(o&&K.getViewerMode()!==K.ViewerMode.MIRROR){let d=me._canvasSpaceBoundsOfDeviceBackground(e,n);if(d.isEmpty()&&!this._loggedInvalidFramePresetSize){this._loggedInvalidFramePresetSize=!0,we(`responsive viewer (inline preview ${K.isInlinePreview()}): frame preset size does not exist for device`);return}a=d.size()}else a=this.window().size();!i.floatEquals(a,1)&&((c=F())==null||c.modules().prototype.updateResponsiveSize(r,a.x()||1,a.y()||1))}_invalidateZoomScaleForRender(){this._idlenessTracker.updateZoomScaleNow(this._viewport.zoomScale())}handleSceneGraphEvent(e){Q.equals(e.node.id(),this._appState.baseScreenId())?e.property==32?this._updateCanvasForCurrentBaseScreen():e.property==57&&this._updateViewportForCurrentPreview():e.property==69&&(this._updateViewportForCurrentPreview(),this._invalidateZoomScaleForRender(),this._maybeChangePhysicsForDevice(e.oldVal)),this._handleScrollingPropertyChange(e.node,e.property,e.oldVal,e.newVal),e.property!=65&&this._viewport.invalidate()}handleAction(e,r){switch(e){case 1:{if(K.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,2),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 2:{if(K.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,.5),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 3:{this._viewport.setCameraZoom(1,1),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 4:{if(K.isInlinePreview())break;this.canvasContentBounds()!=null&&this._viewport.zoomToFit2(1,this.canvasContentBounds()),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}}}setup(){this._setupInteractionHandlers(this._emitter),fn.addUpdate(rr.windowResize(this.events()),e=>{this._resize()}),fn.addUpdate(rr.windowFrame(this.window().events()),e=>{this._onFrame()}),this._renderer.attachTo(this),this._resize(),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}canvasSpaceToWindowSpace(){let e=mn.new2();return e.translate2(this._viewport.viewSpaceBounds().topLeft()),e.multiply(this._viewport.canvasSpaceToViewSpace1()),e}_tryResizingTo(e){this._viewport.setBounds(new x(0,0,e.x(),e.y())),this._updateViewportForCurrentPreview();let r=this._renderer.resize(e.x(),e.y(),this._viewport.zoomScale(),zo());return this.onResize!=null&&(this._setCurrentViewportSizeOnCanvas(),this.onResize()),this._idlenessTracker.handleInteraction(),r}_resize(){let e=this.absoluteBounds(),r=ge.FrozenVector_new4(e.width(),e.height()),n=this._tryResizingTo(r),o=n.canvasSize;if(n.webGLDidAdjustCanvasSize){let i=this._tryResizingTo(o).canvasSize}this._appState.currentScalingInfo().contentScalingMode==="responsive"&&this.maybeAbortStateChanges("CanvasView._resize")}maybeAbortStateChanges(e){let r=this._appState.prototypeState().getInitiatedChange(),n=r&&r.oldStateId()!=null;this.renderingIsComplete()&&this.isTopLevelTransitionOngoing()&&n&&(this._appState.prototypeState().mostRecentFixInvalidStateInitiator=e,this._appState.prototypeState().abortStateChange())}_setCurrentViewportSizeOnCanvas(){let e=this._appState.baseScreenNode();if(e==null)return;let r=e.findContainingCanvasOrSelf();if(r==null)return;let n=null,o=this._appState.prototypeState().getCurrentFitMode();if(o=="contain"||o=="scale-down"||o=="contain-with-zoom")n=ge.FrozenVector_INFINITY;else if(o=="scale-down-width"||o=="fit-width"){let i=this._viewport.getScaleFactorForCurrentTlf(e.fullSize(),this._appState.prototypeState().getCurrentScalingInfo(),r.prototypeDevice()),a=this._viewport.viewSpaceBounds().size().y()/i;n=new O(1/0,a)}else this._viewport.viewSpaceBounds()!=null&&(n=this._viewport.viewSpaceBounds().size());n!=null&&!r.currentViewportSize().equals(n)&&r.setCurrentViewportSize(n)}renderingIsComplete(){return this._renderer.isRenderingDone()}isTopLevelTransitionOngoing(){return this._renderer.isTopLevelTransitionOngoing()}dangerouslyAccessProtoRenderManager(){return this._renderer}clearTileCaches(){this._renderer.clearTileCaches()}_onFrame(){var o,i,a;this._mostRecentFrameNum=this._mostRecentFrameNum+1,this._microtasksSinceLastFrame=0,this._appState.onFrame();let e=this._appState.getActiveCanvas();if(e==null)return;this._clampDirtyScrollContainers(),me._scrollAnimationManager!=null&&this._updateForAnimation(),(this._idlenessTracker.justInteracted()||this._renderer.checkNeedsBlit())&&this._renderer.setNeedsBlit(!0),this._idlenessTracker.advanceFrame(this._viewport),this._viewportTracker.check(this._viewport),this._viewport.prepareForRendering(),this._updateResponsiveSizeForCurrentBaseScreen(),this._updateViewportForCurrentPreview(),this._appState.baseScreenNode()!=null&&this._sendMouseCursorUpdate(),this._updateScrollOffsetsFromMultiplayer();let r=this._appState.baseScreenNode()!=null&&this._appState.baseScreenNode().visible();if(!r){if(this._sequentialBlankFrameStartTimestamp==null){let c=this._appState.prototypeState(),d=this._appState.scene(),u=(o=this._multiplayer)==null?void 0:o.scene(),p=this._appState.baseScreenNode(),_=((i=this._multiplayer)==null?void 0:i.nodeId())||Q.invalid(),h=(a=this._appState.prototypeStructure())==null?void 0:a.getDestinationFrame(_);this._blankFrameLoggingEventParameters={hasScene:!!d,hasBaseScreenId:!!c.getCurrentBaseScreenId(),hasBaseScreen:!!p,baseScreenVisible:!!(p!=null&&p.visible()),hasMultiplayerScene:!!u,appStateAndMultiplayerScenesMatch:d===u,hasDestinationFrame:!!h,destinationFrameIsTopLevel:!!(h!=null&&h.isTopLevel()),destinationFrameIsVisibleInCanvas:!!(h!=null&&h.isVisibleInCanvas()),destinationFrameIsStateGroup:!!(h!=null&&h.isStateGroup()),destinationFrameIsGroup:!!(h!=null&&h.isGroup()),destinationFrameIsImmutableFrame:!!h&&!!Qt.isImmutableFrame(h==null?void 0:h.type()),mostRecentBaseScreenIdChangeInitiator:c.mostRecentBaseScreenIdChangeInitiator,mostRecentFixInvalidStateInitiator:c.mostRecentFixInvalidStateInitiator,baseScreenWasValidDestinationBeforeNodeChanges:c.baseScreenWasValidDestinationBeforeNodeChanges(),enforcePrototypeSecurityBoundaries:this._appState.prototypeSecurityBoundariesEnforced}}let s=performance.now();this._sequentialBlankFrameStartTimestamp??(this._sequentialBlankFrameStartTimestamp=s);let l=s-this._sequentialBlankFrameStartTimestamp>1e3;if(!K.isInlinePreview()&&l){this._sequentialBlankFrameStartTimestamp=1/0;let c=this._renderer.getContext();c!=null&&c.isVisible()&&(be.trackDefinedEvent("prototype.draw_blank",this._blankFrameLoggingEventParameters),K.getFeatureFlags().prototype_blank_frame_report_error&&we("drawing blank frames for >1s"))}this._renderer.drawBlank()}else this._sequentialBlankFrameStartTimestamp=null,this._appState.renderDots()?this._uiRenderData.backgroundColor=N.WHITE:this._uiRenderData.backgroundColor=Tf(this._appState.baseScreenId(),this._appState.currentScalingInfo().fitMode,this._appState.prototypeState().showTransparentBackground(),e),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspots=this._findHotspotsToAnimate(),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspotOpacity=this._hotspotAnimation.getOpacity(),this._uiRenderData.particles=this._multiplayer==null?null:this._multiplayer.getParticles(),this._uiRenderData.mouse=this._multiplayer==null?null:this._multiplayer.getMouse(),this._uiRenderData.renderDots=this._appState.renderDots(),this.mostRecentFrameNum()&&this.mostRecentFrameNum()%300==0&&(this._renderer.reclaimTileStack(),this._renderer.resetTileStackUsage()),be.perfTimerScope("rendererDraw",be.ProfileLevel.LEGACY,()=>{let s=this._renderer.draw(this._idlenessTracker.zoomInProgress(),this._idlenessTracker.shouldRenderOptionalTiles(),this._viewport,this._uiRenderData);this._idlenessTracker.setPreviousRenderStatus(s)}),this._uiRenderData.particles!=null&&this._uiRenderData.particles.length!=0&&this._viewport.invalidate(),this._multiplayer!=null&&this.isTopLevelTransitionOngoing()&&this._multiplayer.onTransitionFrame(this._renderer.transitionProgressTracker().progress());this.afterFrame!=null&&this.afterFrame(),this.afterFirstRenderOfScreenStack!=null&&r&&this.afterFirstRenderOfScreenStack(),this._pointerEventDelegate.maybeProcessStoredPointerRelease()}_findHotspotsToAnimate(){let e=i=>{let a=i.canvasSpaceScrolledInteractiveBounds(1),s=i.canvasSpaceScrolledInteractiveBounds(0);return new Rp(a,s)},r=this._appState.prototypeState(),n=this._appState.baseScreenNode();if(!(!this._showHotspots||!r.getTransitionOnClick()||this._hotspotAnimation.getOpacity()<=0)&&n!=null){let i=(s,l)=>{var u;let c=l.event().interactionType(),d=(u=l.action())==null?void 0:u.value;if(c=="ON_MEDIA_HIT"||c=="ON_MEDIA_END")return!1;if(l.actions().length==1&&d.navigationType()=="SWAP_STATE"){if(["ON_HOVER","ON_PRESS","AFTER_TIMEOUT"].indexOf(c)!=-1)return!1;if(s!=null)return $t.whichInstanceToSwap(s,d==null?void 0:d.transitionNodeID())!=null}return!0},a=r.getTopmostOverlayNode();if(a!=null){let s=r.getTopmostOverlay();return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(a,0,i).map(l=>{let c=e(l),d=s.overlaySpaceToBaseTlfSpace2(n,c.canvasSpaceBounds),u=s.overlaySpaceToBaseTlfSpace2(n,c.canvasSpaceClipBounds);return new Rp(d,u)})}else return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(n,1,i).map(e)}return null}hitTestDeviceFrame(e){let r=this._appState.getActiveCanvas();if(r==null)return!1;let n=this._appState.baseScreenNode();if(n==null)return!1;let o=this._renderer.deviceRenderer();if(o==null||!o.canRenderDeviceFrame(r.prototypeDevice()))return!1;let i=o.pixelAtPosition(e,n.canvasSpaceBoundingBox(),r.prototypeDevice());return N.alpha(i)>0}hitTestBaseScreen(e){let r=this._appState.baseScreenNode();if(r==null)return 0;let n=this._canvasSpacePoint(e),o=r.canvasSpaceBoundingBox();return o.contains2(n)?o.leftThird().contains2(n)?1:o.rightThird().contains2(n)?3:2:0}_canvasSpacePoint(e){return this._viewport.canvasSpaceToViewSpace1().clone().inverseTransformPoint(e.clone())}canvasContentBounds(){var e;return(e=this._appState.getActiveCanvas())==null?void 0:e.canvasSpaceRenderedBounds()}setMaximumDrawingBufferSizeForTesting(e){this._renderer.getContext().setMaximumDrawingBufferSizeForTesting(e)}clearMaximumDrawingBufferSizeForTesting(){this._renderer.getContext().clearMaximumDrawingBufferSizeForTesting()}triggerResizeForTesting(){let e=this._cachedAbsoluteBounds,r=e.clone();r.setWidth(r.width()-1),this._cachedAbsoluteBounds=r,this._resize(),this._cachedAbsoluteBounds=e,this._resize()}toggleRenderTreePrinting(){this._renderer.toggleRenderTreePrinting()}invalidateIdlenessTracker(){this._idlenessTracker.handleInteraction()}_nonNull(e){return e}_setupInteractionHandlers(e){let r=i=>a=>{be.perfTimerScope("discreteUserAction",be.ProfileLevel.LOW,()=>{i(a)})},n=i=>a=>{be.perfTimerScope("mouseMove",be.ProfileLevel.LOW,()=>{i(a)})},o=i=>a=>{be.perfTimerScope("dragUserAction",be.ProfileLevel.LOW,()=>{i(a)})};fn.addUpdate(rr.mousePress(this.events()),r(i=>{this._pointerEventDelegate.onMousePress(this._nonNull(i.asMouseEvent()))})),fn.addUpdate(rr.mouseDrag(this.events()),o(i=>{this._pointerEventDelegate.onDrag(this._nonNull(i.asMouseEvent()))})),fn.addUpdate(rr.mouseRelease(this.events()),r(i=>{this._pointerEventDelegate.onMouseRelease(this._nonNull(i.asMouseEvent()))})),fn.addUpdate(rr.mouseMove(this.events()),n(i=>{this._pointerEventDelegate.onMouseMove(this._nonNull(i.asMouseEvent()))})),fn.addUpdate(rr.mouseScroll(this.events()),o(i=>{this._pointerEventDelegate.onMouseScroll(this._nonNull(i.asMouseEvent()))})),fn.addUpdate(rr.mouseLeave(this.window().root().events()),r(i=>{this._pointerEventDelegate.onMouseLeave(this._nonNull(i.asMouseEvent()))})),fn.addUpdate(rr.touchPress(this.events()),r(i=>{this._pointerEventDelegate.onTouchPress(this._nonNull(i.asTouchEvent()))})),fn.addUpdate(rr.touchDrag(this.events()),o(i=>{this._pointerEventDelegate.onDrag(this._nonNull(i.asTouchEvent()))})),fn.addUpdate(rr.touchRelease(this.events()),r(i=>{this._pointerEventDelegate.onTouchRelease(this._nonNull(i.asTouchEvent()))})),fn.addUpdate(rr.keyPress(this.events()),r(i=>{this._pointerEventDelegate.onKeyPress(i.asKeyEvent(),e)})),fn.addUpdate(rr.gamepadDown(this.events()),r(i=>{this._pointerEventDelegate.onGamepadDown(i.asGamepadEvent())}))}_updateHoveredStateInstanceIfNeeded(e){let r=this._appState.prototypeState(),n=r.getStateMachineInitiatedChange(e)??r.getStateMachineLastChangeInHistory(e);n!=null&&n.cause==2?this._hoveredStateInstances.set(e.toString(),n):this._hoveredStateInstances.delete(e.toString())}_onCommitOrAbortForInteractions(e,r,n){if(this._triggerPotentialTimedTransition(e,r),this._createVideoTriggerEvents(e),this._mouseEnteredNodesManager.markNodesAsNotEnteredWithoutTriggeringMouseLeave(e.map(o=>o.id())),n!=null&&this._currentMouseLocation!=null&&!this._mostRecentTransitionViaArrows){let o=!this._mostRecentTransitionViaArrowsLegacy,i=this._currentMouseLocation;this._microtasksSinceLastFrame=this._microtasksSinceLastFrame+1,this._microtasksSinceLastFrame<=this.MAX_MICROTASKS_PER_FRAME&&x_(()=>{this.handleInteractionsForMove(i,o)})}}_createCallbackForMediaEvent(e,r,n){return()=>{this.triggerHotspot(e,r,n,null)}}_createVideoTriggerEvents(e){var r,n;if(this._appState.prototypeState().interactionsEnabled())if(K.viewerCreateVideoTriggersOpt()){let o=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpMediaHitInteractionMap();for(let a of o.hotspots()){let s=o.getHotspotInteractions(a),l=(r=this._appState.scene())==null?void 0:r.findNode(a);if(l==null||s==null)return;for(let c of e)if(c.isAncestorOf(l)){this._createMediaHitEvents(s,new Ci(l));break}}let i=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpMediaEndInteractionMap();for(let a of i.hotspots()){let s=i.getHotspotInteractions(a),l=(n=this._appState.scene())==null?void 0:n.findNode(a);if(l==null||s==null)return;for(let c of e)if(c.isAncestorOf(l)){this._createMediaEndEvents(s,new Ci(l));break}}}else{let o=new Set([rt.mapToInteractionType(20),rt.mapToInteractionType(21)]),i=s=>o.has(s.event().interactionType()),a=this._appState.prototypeStructure().findHotspotsWithInteractionFilterWithinMultipleNodes(new Set(e),0,i);for(let s of a)this._registerMediaEventsForHotspot(s)}}_createMediaHitEvents(e,r){for(let n of e){let o=n.event().mediaHitTime();this._appState.videoManager().addInteractionEvent(n,r.node.id(),o,this._createCallbackForMediaEvent(r,n,20))}}_createMediaEndEvents(e,r){for(let n=0,o=e.length;n<o;n=n+1){let i=e[n],a=this._createCallbackForMediaEvent(r,i,21);if(this._appState.videoManager().addInteractionEvent(i,r.node.id(),0,a),n+1<e.length){let s=e[n+1];if(this._shouldTriggerVariantInteractionWithMediaAction(i,s)){let l=this._createCallbackForMediaEvent(r,s,21);this._appState.videoManager().addInteractionEvent(s,r.node.id(),0,l)}}}}_registerMediaEventsForHotspot(e){let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,rt.mapToInteractionType(20));this._createMediaHitEvents(r,e);let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,rt.mapToInteractionType(21));this._createMediaEndEvents(n,e)}_triggerPotentialTimedTransition(e,r){if(!this._appState.prototypeState().interactionsEnabled())return;let n=[],o=[],i=e.filter(s=>!e.some(l=>l&&l!==s&&l.isAncestorOf(s)));for(let s of i){let l=this._appState.prototypeStructure().findHotspotsWithInteractionType(s,0,"AFTER_TIMEOUT");for(let c of l){let d=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(c.node,rt.mapToInteractionType(1));for(let u of d)n.push(u),o.push(c.node)}}let a=0;n.forEach(s=>{var g;let l=o[a];a=a+1;let c=s.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),d=c!=null?(g=$t.whichInstanceToSwap(l,c.transitionNodeID()))==null?void 0:g.stablePath():null,u=this._appState.prototypeState(),p=d!=null?u.actionCountersForStateAndAncestors(d):[u.actionCounter()],_=this._appState.nodeTransitionTracker().topmostScreenChangeCounter(),h=l.stablePath(),A=()=>{var T;let S=(T=this._appState.scene())==null?void 0:T.findNodeByStablePath(h);if(S==null)return;let R=d!=null?u.actionCountersForStateAndAncestors(d):[u.actionCounter()];this._appState.nodeTransitionTracker().topmostScreenChangeCounter()==_&&ie.List_equalsWithComparison(p,R,(f,y)=>f==y)&&this.triggerDelayedHotspot(S.id(),s,1)},m=s.event().transitionTimeout()*1e3|0;(r==18||r==19)&&(m=Math.max(500,m)),setTimeout(A,m)})}updateCursorType(e,r){if(!this._appState.prototypeState().interactionsEnabled()){this.setCursor(0);return}if(Wt.isMobile(this.getRelevantOS())){this.setCursor(2);return}let n=this._appState.prototypeState().getTopmostScreen();if(n==null){this.setCursor(0);return}let o=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_CLICK",sn.getNodeInteractionPairs("ON_CLICK",r));o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_PRESS",sn.getNodeInteractionPairs("ON_PRESS",r))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN",sn.getNodeInteractionPairs("MOUSE_DOWN",r))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_UP",sn.getNodeInteractionPairs("MOUSE_UP",r))),o!=null&&!Q.equals(o.node.id(),n.id())?this.setCursor(1):this.setCursor(0)}_handleMaintainedInteraction(e,r,n){var p;if(!this._appState.prototypeState().interactionsEnabled()||r==null)return;let o=e.node.id(),i=r.event().interactionType();if(this._maintainedData.getByHotspotAndInteractionType(o,i)!=null)return;let a=this._maintainedData.set(o,i,n),s=r.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),l=s!=null?(p=$t.whichInstanceToSwap(e.node,s.transitionNodeID()))==null?void 0:p.stablePath():null,c=l!=null?this._appState.prototypeState().actionCounterForState(l):-1,d=this._appState.prototypeState().actionCounter();setTimeout(()=>{var E;let _=this._maintainedData.getByHotspotAndInteractionType(o,i);if(_==null)return;let h=_.counter(),A=l!=null?this._appState.prototypeState().actionCounterForState(l):-1,m=this._appState.prototypeState().actionCounter(),g=(E=this._appState.scene())==null?void 0:E.findNode(o),S=a==h,R=S&&d==m&&c==A;S&&this._maintainedData.resetEntry(o,i),R&&g!=null&&this.triggerDelayedHotspot(g.id(),r,_.action())},r.event().interactionDuration()*1e3|0)}_handleMouseEnterMouseLeave(e,r){let n=this._canvasSpacePoint(e);this._mouseEnteredNodesManager.updateEnteredNodes(n,r),this._mouseEnteredNodesManager.resetNoLongerMaintainedMouseEnterOrLeaveInteractions(this._maintainedData);let o=me.WasHandled.NOT_HANDLED,i=this._appState.prototypeState().actionCounter(),a=this._appState.prototypeState(),s=a.getTopmostOverlayNode(),l=this._appState.baseScreenNode(),c=s??l,d=a.getSecondTopmostOverlayNodeOrBaseScreen(),u=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,A=>A.event().interactionType()=="MOUSE_LEAVE",sn.getNodeInteractionPairs("MOUSE_LEAVE",r));if(d!=null){let A=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(d,0,m=>m.event().interactionType()=="MOUSE_LEAVE");Wr(u,A)}let p=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,A=>A.event().interactionType()=="MOUSE_ENTER",sn.getNodeInteractionPairs("MOUSE_ENTER",r)),_=this._mouseEnteredNodesManager.getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(u);for(let A of _){let m=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(A.node,"MOUSE_LEAVE"),g=this._appState.prototypeState().actionCounter();if(i!=g)return o;o=this._triggerOrHandleMaintainedInteractions(m,A,13,e)}let h=this._mouseEnteredNodesManager.getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(p);for(let A of h){let m=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(A.node,"MOUSE_ENTER"),g=this._appState.prototypeState().actionCounter();if(i!=g)return o;o=this._triggerOrHandleMaintainedInteractions(m,A,12,e)}return o}handleInteractionsForMove(e,r){if(this._appState.scene()==null||!this._appState.prototypeState().interactionsEnabled())return;let n=this._appState.prototypeState().getTopmostScreen(),o=this._appState.prototypeStructure().getInteractionsGroupedByType([n]);this.updateCursorType(e,o);let i=this._handleMouseEnterMouseLeave(e,o);r&&(i=this._handleGranularMoveForDeprecatedMouseInMouseOut(e,o)),i==me.WasHandled.NOT_HANDLED&&r&&(this._handleHover1(e,o),this._handleReverseHover(e))}_handleGranularMoveForDeprecatedMouseInMouseOut(e,r){let n=10,o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_IN",sn.getNodeInteractionPairs("MOUSE_IN",r));if(o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_OUT",sn.getNodeInteractionPairs("MOUSE_OUT",r)),n=11),this._maintainedData.resetAllEntriesMatchingPredicate((a,s)=>["MOUSE_IN","MOUSE_OUT"].indexOf(s)!=-1&&!Q.equals(o!=null?o.node.id():null,a)),o==null)return me.WasHandled.NOT_HANDLED;let i=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(o.node,rt.mapToInteractionType(n));return this._triggerOrHandleMaintainedInteractions(i,o,n,e)}_handleHover1(e,r){let n=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_HOVER",sn.getNodeInteractionPairs("ON_HOVER",r));return this._handleHover2(n,e)}handleHoverAtHotspot(e){return this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,this._handleHover2(e,null)}_handleHover2(e,r){if(e!=null){let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,rt.mapToInteractionType(2));for(let o of n)return this.triggerHotspot(e,o,2,r),o.setHoverLastHandledFrameNum(this.mostRecentFrameNum()),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}handleReverseHoverAtHotspot(e){var o;let r=e.node,n=Qe.StringMap_get(this._hoveredStateInstances,e.node.stablePath().toString(),null);return n==null||!Q.equals((o=r.topLevelAncestor())==null?void 0:o.id(),this._appState.prototypeState().getTopmostScreenId())?me.WasHandled.NOT_HANDLED:(this._appState.prototypeState().returnInstanceToState(n.stablePath,2,6),me.WasHandled.HANDLED)}_handleReverseHover(e){var m,g;if(this._multiplayer!=null&&this._multiplayer.isObserving())return me.WasHandled.HANDLED;let r=this._appState.prototypeState(),n=me.WasHandled.NOT_HANDLED,o=[];for(let S of Array.from(this._hoveredStateInstances.keys())){let R=Qe.StringMap_get(this._hoveredStateInstances,S,null);if(R==null){o.push(S);continue}let E=this._appState.scene().findNodeByStablePath(R.stablePath);if(E==null)continue;let P=(m=R==null?void 0:R.canvasSpaceTriggerBoundsOrNull)==null?void 0:m.clone();if(!Q.equals((g=E.topLevelAncestor())==null?void 0:g.id(),r.getTopmostScreenId()))continue;let T=r.getCurrentBaseScreenNode();if(P!=null&&T!=null){let f=null,y=this._canvasSpacePoint(e),v=this._appState.prototypeState().getTopmostOverlay();if(f=(v==null?void 0:v.baseTlfSpaceToOverlaySpace1(T,y))??y,E.scrollAndClipBoundsBySelfAndAncestors(P,0).contains2(f))continue;r.returnInstanceToState(R.stablePath,2,6),o.push(S),n=me.WasHandled.HANDLED}}for(let S of o)this._hoveredStateInstances.delete(S);if(n==me.WasHandled.HANDLED)return n;let i=this._appState.prototypeState().getInitiatedChange()??this._appState.prototypeState().getLastChangeInHistory(),a=i==null?void 0:i.canvasSpaceTriggerBoundsOrNull;if(!(a!=null&&i.cause==2))return me.WasHandled.NOT_HANDLED;let l=null;if(l=this._appState.scene().findNode(i==null?void 0:i.oldStateId()),l==null)return me.WasHandled.NOT_HANDLED;let c=null,d=this._canvasSpacePoint(e);Q.equals(i==null?void 0:i.oldStateId(),i==null?void 0:i.newStateId())||(d=this._canvasSpacePointInPreviousFrame(l,this._appState.baseScreenNode(),d));let u=i==null?void 0:i.oldOverlays(this._appState.prototypeState());u.length>0?c=ie.List_last(u).baseTlfSpaceToOverlaySpace1(l,d):c=d;let p=i!=null?i.interactionAddress.hotspotStablePath:null,_=this._retrieveReverseInteractionHotspotFromStoredData(p);if(_==null||_.scrollAndClipBoundsBySelfAndAncestors(a,0).contains2(c))return me.WasHandled.NOT_HANDLED;let A=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(this._retrieveReverseInteractionHotspotFromStoredData(p),rt.mapToInteractionType(2));for(let S of A){if(S.getHoverLastHandledFrameNum()==this.mostRecentFrameNum())break;return this.requestBack(_,S,2,6,null,null,e),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}_retrieveReverseInteractionHotspotFromStoredData(e){return this._appState.scene().findNodeByStablePath(e)}handleInteractionsForPress(e){if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_UP");let r=this._handleMouseDown(e);return r==me.WasHandled.NOT_HANDLED&&(r=this._handlePress(e)),r}_handleMouseDown(e){if(!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN");if(r==null)return me.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,rt.mapToInteractionType(8));return this._triggerOrHandleMaintainedInteractions(n,r,8,e)}_handlePress(e){if(!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_PRESS");if(r==null)return me.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,rt.mapToInteractionType(3));for(let o of n){let i=r.node.stablePath(),a=o.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE");if(a!=null){let s=$t.whichInstanceToSwap(r.node,a.transitionNodeID());this._lastPressData=new Qf(s==null?void 0:s.stablePath(),i)}else this._lastPressData=new Qf(null,i);return this.triggerHotspot(r,o,3,e),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}maybeHandleSingleTapAsNavigation(e){if(this._appState.scene()==null||this._appState.getActiveCanvas()==null)return!1;if(this._appState.prototypeStructure().isLinear()){let o=this.hitTestBaseScreen(e);if(o!=0&&o!=2){let i=o==1?-1:1;return i==1?this.navigateForward(17):this.navigateBackward(17),Math.random()<this.INTERACTION_REPORTING_RATE&&be.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:i==1?"FORWARD":"REVERSE",inputType:"tap",nonInteraction:0,prototypeType:this._appState.prototypeStructure().navigationOrder().navigationOrderTypeString()}),!0}}return!1}handleInteractionsForRelease(e,r,n){let o=this._lastPressData;if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN");let i=this._appState.prototypeState().isDragging(),a=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());if(this._interactionObservers.forEach(d=>{d.handleRelease(a)}),i)return this._appState.prototypeState().setIsDragging(!1),me.WasHandled.HANDLED;let s=this._handleMouseUp(e);s==me.WasHandled.NOT_HANDLED&&r&&(s=this._handleClick(e)),s==me.WasHandled.NOT_HANDLED&&(s=this._handleReversePress(o));let l=s==me.WasHandled.NOT_HANDLED,c=n==me.WasHandled.NOT_HANDLED;return l&&c&&el.notifyUnhandledMouseRelease(this._appState,a),s}_handleMouseUp(e){if(!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_UP");if(r==null)return me.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,rt.mapToInteractionType(9));return this._triggerOrHandleMaintainedInteractions(n,r,9,e)}_handleReversePress(e){if(!this._appState.prototypeState().interactionsEnabled()||this._multiplayer!=null&&this._multiplayer.isObserving())return me.WasHandled.HANDLED;if(e==null)return me.WasHandled.NOT_HANDLED;if(e.swappedStablePath!=null)return this._appState.prototypeState().returnInstanceToState(e.swappedStablePath,2,7),me.WasHandled.HANDLED;{let r=e.hotspotStablePath!=null?this._retrieveReverseInteractionHotspotFromStoredData(e.hotspotStablePath):null,n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r,rt.mapToInteractionType(3));for(let o of n)return this.requestBack(r,o,2,7,null,null,null),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}_handleSlideshowNavigation(e,r,n){let o=n.filter(i=>{let a=i.actions();for(let s of a)if(s.navigationType()=="NAVIGATE"&&s.connectionType()=="INTERNAL_NODE")return!1;return!0});if(o.length>0)o.forEach(i=>{this.triggerHotspot(r,i,4,e)});else{if(K.getFeatureFlags().slides_mobile_web_hyperlink&&Wt.isMobile(this.getRelevantOS()))return me.WasHandled.NOT_HANDLED;this.navigateForward(4)}return me.WasHandled.HANDLED}_handleClick(e){if(!this._appState.prototypeState().interactionsEnabled()||!K.getFeatureFlags().slides_mobile_web_hyperlink&&!this._appState.prototypeState().getTransitionOnClick())return me.WasHandled.HANDLED;this._appState.prototypeState().disengageObservationOnClick()&&this.disengageObservationMode();let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_CLICK"),n=(r==null?void 0:r.node)||null,o=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n,rt.mapToInteractionType(4));if(this._appState.prototypeStructure().navigationOrderType()==2)return this._handleSlideshowNavigation(e,r,o);if(K.getFeatureFlags().slides_mobile_web_hyperlink&&!this._appState.prototypeState().getTransitionOnClick())return me.WasHandled.HANDLED;for(let i=0,a=o.length;i<a;i=i+1){let s=o[i];if(this.triggerHotspot(r,s,4,e),i+1<o.length){let l=o[i+1];this._shouldTriggerVariantInteractionWithMediaAction(s,l)&&this.triggerHotspot(r,l,4,e)}return me.WasHandled.HANDLED}if(this._shouldCloseTopmostOverlayOnClickOutside(e)){let i=this._appState.prototypeState().getCurrentOverlayData().length-1;return this._appState.prototypeState().closeOverlayAtAndAbove(i,1),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}performHotspotAnimationOnClick(){this._hotspotAnimation.onClick()}handleInteractionsForDrag(e){let r=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN");this._maintainedData.resetAllEntriesMatchingPredicate((o,i)=>i=="MOUSE_DOWN"&&!Q.equals(r!=null?r.node.id():null,o));let n=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());this._interactionObservers.forEach(o=>{o.handleDrag(n)})}handleDragStart(e,r,n){if(!this._appState.prototypeState().interactionsEnabled()||this._appState.prototypeState().isDragging())return me.WasHandled.HANDLED;if(r==null)return me.WasHandled.NOT_HANDLED;let o=this._appState.prototypeStructure().findPrototypeInteractionWithId(r!=null?r.id():null,n);if(o==null)return me.WasHandled.NOT_HANDLED;this.triggerHotspot(new Ci(r),o,5,e),this._appState.prototypeState().setIsDragging(!0);let i=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());return this._interactionObservers.forEach(a=>{a.handleDragStart(i)}),me.WasHandled.HANDLED}handleInteractionsForScroll(){this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._lastPressData!=null&&(this._handleReversePress(this._lastPressData),this._lastPressData=null)}handleFling(e,r){var l;let n=r.length,o=Xe.seconds(),i=this._appState.getActiveCanvas();if(i==null)return me.WasHandled.NOT_HANDLED;if(!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;let a=(l=i.scene())==null?void 0:l.findNode(e),s=50*zo();this._initialFlingVelocity=new O(0,0);for(let c=n-1;c>=0;c=c-1)if(c==0||o-r[c-1].startTime>.1){let d=r[c],u=r[n-1],p=u.startLocation.subtract(d.startLocation).divideScalar(u.startTime-d.startTime),_=p.length(),h=Math.log(1+_)/5,A=_*h/5,m=p.multiplyScalar(A/_);if(d!=u&&_>s)if(a==null||a==i)this._viewport.flingCameraOffset(m,h);else{this._initialFlingVelocity=this.restrictScrollDeltaAxes(a,p).negative();let g=me._scrollPhysics.createBallisticScrollSimulation(a.scrollOffset(),this._initialFlingVelocity,a.minScrollOffsetX(),a.maxScrollOffsetX(),a.minScrollOffsetY(),a.maxScrollOffsetY());return g!=null&&(me._scrollAnimationManager=new bd(g,a.id())),me.WasHandled.HANDLED}break}return me.WasHandled.NOT_HANDLED}handleInteractionsForLeave(){this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_IN"),this.handleInteractionsForMove(ge.FrozenVector_new4(-1,-1),!0)}handleInteractionsForKeyPress(e){let r=this._appState.prototypeState().getTopmostScreen(),n=this._appState.prototypeStructure().findHotspotsWithInteractionType(r,0,"ON_KEY_DOWN"),o=this._createListFromKeyEvent(e),i=s=>(s=Wt.current()!=4&&s==this.META_CODE?this.CONTROL_CODE:s,o.some(l=>l.indexOf(s)!=-1)),a=s=>{let l=s.event().keyTrigger().triggerDevice=="KEYBOARD",c=s.event().keyTrigger().keyCodes;if(c==null)return!1;let d=c.length==o.length;return l&&d&&c.every(i)};for(let s of n){let c=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(s.node,rt.mapToInteractionType(14)).filter(a);for(let d=0,u=c.length;d<u;d=d+1){let p=c[d];if(this.triggerHotspot(s,p,14,null),d+1<c.length){let _=c[d+1];this._shouldTriggerVariantInteractionWithMediaAction(p,_)&&this.triggerHotspot(s,_,14,null)}return e.accept(),me.WasHandled.HANDLED}}return me.WasHandled.NOT_HANDLED}_createListFromKeyEvent(e){let r=[];return 1&e.modifiers()&&r.push([this.ALT_CODE]),4&e.modifiers()&&r.push([this.SHIFT_CODE]),2&e.modifiers()&&r.push([this.META_CODE]),8&e.modifiers()&&r.push([this.CONTROL_CODE]),gu.Key_isModifier(e.key)||r.push(gu.Key_keyToKeyCode(e.key)),r}handleInteractionsForGamepadDown(e){let r=this._appState.prototypeState().getTopmostScreen(),n=i=>{let a=i.event().keyTrigger().triggerDevice!="KEYBOARD";return i.event().keyTrigger().keyCodes==null?!1:a&&i.event().keyTrigger().keyCodes.indexOf(e.button)!=-1},o=this._appState.prototypeStructure().findHotspotsWithInteractionType(r,0,"ON_KEY_DOWN");for(let i of o){let s=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(i.node,rt.mapToInteractionType(14)).filter(n);for(let l=0,c=s.length;l<c;l=l+1){let d=s[l];if(this.triggerHotspot(i,d,14,null),l+1<s.length){let u=s[l+1];this._shouldTriggerVariantInteractionWithMediaAction(d,u)&&this.triggerHotspot(i,u,14,null)}return e.accept(),me.WasHandled.HANDLED}}return me.WasHandled.NOT_HANDLED}addInteractionObserver(e){this._interactionObservers.add(e)}removeInteractionObserver(e){this._interactionObservers.remove(e)}_hotspotAtViewportSpacePointWithInteractionType(e,r,n){let o=K.getFeatureFlags().slides_mobile_web_hyperlink&&this._appState.prototypeStructure().navigationOrderType()===2;if(!this._appState.prototypeState().getTransitionOnClick()&&!o)return null;let i=this._canvasSpacePoint(e);return this._hotspotAtCanvasSpacePointWithInteractionType(i,r,n)}_hotspotAtCanvasSpacePointWithInteractionType(e,r,n){let o=this._appState.baseScreenNode();if(o==null||!o.canvasSpaceBoundingBox().contains2(e)&&r!="MOUSE_OUT")return null;let i=this._appState.prototypeState(),a=i.getTopmostOverlayNode();if(a!=null){let s=i.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(o,e);return this._appState.prototypeStructure().hotspotOnPresentedNode(a,s,r,n)}else return this._appState.prototypeStructure().hotspotOnPresentedNode(o,e,r,n)}_canvasSpacePointInPreviousFrame(e,r,n){if(e==r)return n;let o=r.absoluteTransform().clone();if(!o.invert())return n;let i=e.absoluteTransform(),a=n.clone();return o.transformPoint(a),i.transformPoint(a),a}updateUserCursor(e){this._currentMouseLocation=e==null?void 0:e.locationInView(this),this._sendMouseCursorUpdate()}_shouldCloseTopmostOverlayOnClickOutside(e){let r=this._appState.prototypeState().getTopmostOverlay(),n=this._appState.prototypeState().getTopmostOverlayNode(),o=this._appState.baseScreenNode();if(o==null||n==null||r.backgroundInteraction()!="CLOSE_ON_CLICK_OUTSIDE")return!1;let i=this._canvasSpacePoint(e),a=r.baseTlfSpaceToOverlaySpace1(o,i);return!n.canvasSpaceBoundingBox().contains2(a)}recordViewportSpaceClick(e){if(this._multiplayer==null)return;let r=this._canvasSpacePoint(e);this._multiplayer.recordCanvasSpaceClick(r)}_sendMouseCursorUpdate(){if(this._multiplayer!=null)if(this._currentMouseLocation==null)this._multiplayer.setCanvasSpaceMouse(null);else{let e=this._canvasSpacePoint(this._currentMouseLocation);e!=null&&this._multiplayer.setCanvasSpaceMouse(e)}}triggerMouseAction(e,r){this._appState.triggerAction2(e,r)}_triggerOrHandleMaintainedInteractions(e,r,n,o){for(let i=0,a=e.length;i<a;i=i+1){let s=me.WasHandled.NOT_HANDLED,l=e[i];if(l.event().interactionMaintained()?(this._handleMaintainedInteraction(r,l,n),s=me.WasHandled.MAINTAINED):(this.triggerHotspot(r,l,n,o),s=me.WasHandled.HANDLED),i+1<e.length){let c=e[i+1];this._shouldTriggerVariantInteractionWithMediaAction(l,c)&&(l.event().interactionMaintained()?(this._handleMaintainedInteraction(r,c,n),s=me.WasHandled.MAINTAINED):(this.triggerHotspot(r,c,n,o),s=me.WasHandled.HANDLED))}return s}return me.WasHandled.NOT_HANDLED}_shouldTriggerVariantInteractionWithMediaAction(e,r){let n=e.allActions().length>=1&&e.allActions().every(l=>l.connectionType()=="UPDATE_MEDIA_RUNTIME"),o=e.allActions().length>=1&&e.allActions().every(l=>Q.isValid(l.transitionNodeID())),i=r.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),a=i!=null&&i.connectionType()=="INTERNAL_NODE",s=n&&o&&a;return s&&K.getFeatureFlags().prototype_log_video_and_ic_swap&&be.trackEvent("prototype_interaction_conflict_override_triggered",{interaction_type:e.event().interactionType(),action_type:e.actions().map(l=>l.mediaAction())}),s}getRelevantOS(){return this._appState.getActiveCanvas()==null?0:me._getRelevantOSForDevice(this._appState.getActiveCanvas().prototypeDevice())}_resetScrollForTlf(e){if(e!=null){this.updateScrollOffsetForNode(e,ge.FrozenVector_ZERO);let r=e.scrollableFrameDescendants();for(let n of r)this.updateScrollOffsetForNode(n,ge.FrozenVector_ZERO)}}getBestScrollOrDragProposal(e,r,n){let o=this._appState.getActiveCanvas();if(o==null)return null;if(this._appState.currentScalingInfo().fitMode=="min-zoom"&&this._viewport.zoomScale()!=1)return new me.ScrollOrDragProposal(me.ScrollOrDragProposal.InteractionType.SCROLL,1,o==null?void 0:o.id(),null);let i=this._canvasSpacePoint(r);if(i==null||this._appState.baseScreenNode()==null)return null;let a=null;e==me.ScrollOrDragQuerySet.SCROLL_OR_DRAG&&(a=(l,c)=>Cr.computeDragVector1(l,c,this._appState.baseScreenNode(),this._appState.prototypeStructure(),this._appState.prototypeState()));let s=this._appState.prototypeState().getCurrentOverlays();for(let l=0,c=s.length;l<c;l=l+1){let d=s[s.length-l-1],u=d.node();if(u==null)continue;let p=d.baseTlfSpaceToOverlaySpace1(this._appState.baseScreenNode(),i);if(!u.canvasSpaceBoundingBox().contains2(p)){if(d.backgroundAppearance().backgroundType=="SOLID_COLOR")return null;continue}let _=me.findBestScrollOrDragProposalInFrame(o,p,n,u,this._appState.activePrototypeDevice(),a);return Q.equals(_==null?void 0:_.targetNodeId,o==null?void 0:o.id())?null:_}return me.findBestScrollOrDragProposalInFrame(o,i,n,this._appState.baseScreenNode(),this._appState.activePrototypeDevice(),a)}_updateForAnimation(){if(me._scrollAnimationManager==null)return;let e=!me._scrollAnimationManager.isValid(this._appState.scene());e||(me._scrollAnimationManager.performScroll(this,this._appState.scene()),e=me._scrollAnimationManager.isDone()),e&&(this.cancelAnimationManager(),this._sequentialActionManager.runNextAction())}cancelAnimationManager(){me._scrollAnimationManager=null}maybeHandleOverdragRelease(){var n;if(me._overscrolledNodeID==null)return;let e=(n=this._appState.scene())==null?void 0:n.findNode(me._overscrolledNodeID);me._overscrolledNodeID=null,!(e==null||me.clampScrollOffsetForNode(e,e.scrollOffset()).equals(e.scrollOffset()))&&(me._scrollAnimationManager=new bd(new Sd(e.scrollOffset(),new O(0,0),e.minScrollOffsetX(),e.maxScrollOffsetX(),e.minScrollOffsetY(),e.maxScrollOffsetY()),e.id()))}setPhysicsForOS(e){switch(eT(e)){case 0:{me._scrollPhysics=new Tp;break}case 1:{me._scrollPhysics=new Ep;break}case 2:{me._scrollPhysics=new _d;break}}}_maybeChangePhysicsForDevice(e){let r=this.getRelevantOS(),n=me._getRelevantOSForDevice(e);r!=n&&this.setPhysicsForOS(r)}updateScrollOffsetForNode(e,r){let n=me.clampScrollOffsetForNode(e,r),o=this.restrictScrollDeltaAxes(e,r),i=this._pointerEventDelegate.isDragging();if(e.scrollOffset().equals(n)&&(!i||e.scrollOffset().equals(r)))return!1;if(i&&!n.equals(r)){let s=me._scrollPhysics.applyOverscrollBehavior(o,n,e.scrollOffset(),e.size());s.equals(n)||(me._overscrolledNodeID=e.id(),n=s)}e.setScrollOffset(n),this._observers.forEach(s=>{s.didScrollNode(e)}),this._emitter.trigger("scrollNode",e.id());let a=e.id();return this._multiplayer!=null&&this._multiplayer.setScrollPosition(a,e.scrollOffset()),!0}setScrollOffsetUnconditionally(e,r){e.setScrollOffset(r);let n=e.id();this._multiplayer!=null&&this._multiplayer.setScrollPosition(n,r)}restrictScrollDeltaAxes(e,r){let n=r.clone();switch(e.scrollDirection()){case"HORIZONTAL":{n.setY(0);break}case"VERTICAL":{n.setX(0);break}case"NONE":{n.setX(0),n.setY(0);break}case"BOTH":{let o=null;switch(e.overflowDirection()){case"NONE":{o="NONE";break}case"HORIZONTAL":{o="HORIZONTAL";break}case"VERTICAL":{o="VERTICAL";break}case"BOTH":{o="BOTH";break}}!bn.scrollsHorizontally(o)&&!e.hasOverflowingContentInXDirection()&&n.setX(0),!bn.scrollsVertically(o)&&!e.hasOverflowingContentInYDirection()&&n.setY(0);break}}return n}scrollToDestinationInFrame(e,r){var i;let n=this._appState.scene().findNode(e),o=(n==null?void 0:n.parent())??null;for(;o!=null&&!((o.scrollDirection()!="NONE"||o.isTopLevel())&&!o.isTooRotatedToScroll());)o=o.parent();if(o!=null){let a=(i=r.action())==null?void 0:i.value;for(let c of r.getAllActionsWithSpecificTransitionType("SCROLL_ANIMATE"))a=c;let s=rn.fromPrototypeAction(a,r.stateManagementVersion()),l=n.absoluteTransform().translation().add(s.extraScrollOffset).subtract(o.absoluteTransform().translation());if(a.transitionType()=="SCROLL_ANIMATE"){let c=me.clampScrollOffsetForNode(o,l);me._scrollAnimationManager=new bd(new Ip(o.scrollOffset(),c,s.transitionDuration,s.easingFunction),o.id())}else this.updateScrollOffsetForNode(o,l)}}scrollNode(e,r,n,o){var l,c,d;let i=(l=this._appState.scene())==null?void 0:l.findNode(e);if(i==null)return!1;if(this._appState.prototypeRecorder().isRecording()&&this._appState.prototypeRecorder().addHistoricalEvent({type:"INTERACTION",targetPath:i.stablePath().toString(),name:i.name(),scrollOffset:n.toJSON(),action:Dm,timeRecorded:Date.now(),currentFrameName:(c=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:c.name(),canvasViewSpaceMousePosition:o==null?void 0:this._canvasSpacePoint(o).toJSON()}),me._scrollAnimationManager!=null&&me._scrollAnimationManager.isOverscrolled()){let u=me._scrollAnimationManager;if(i.id()!=u.nodeID()){let p=(d=this._appState.scene())==null?void 0:d.findNode(u.nodeID());p!=null&&p.setScrollOffset(u.simulation().endPos())}this.cancelAnimationManager()}else me._scrollAnimationManager!=null&&r!=me.ScrollSource.FLING&&this.cancelAnimationManager();if(i.isTooRotatedToScroll()||i.scrollDirection()=="NONE")return!1;let a=i.scrollOffset().clone();i.scrollDirection()=="HORIZONTAL"?a.setX(a.x()+(n.x()==0&&r==me.ScrollSource.SCROLL_EVENT?n.y():n.x())):a.addUpdate1(n);let s=this.updateScrollOffsetForNode(i,a);return this.disengageObservationMode(),s}async exportVideos(e){var n,o,i;(n=this._multiplayer)==null||n.disconnect();let r=[];try{for(let a of e){await this._navigateToNodeForExport(a),await this._waitForNavigationComplete();let s=await this._timelineManager.exportVideo(a),l=(o=this._appState.scene())==null?void 0:o.findNode(a),c=(l==null?void 0:l.name())||"";this.downloadVideo(s,c),r.push(s)}}finally{(i=this._multiplayer)==null||i.attemptReconnect()}return r}downloadVideo(e,r){let n=new Blob([e],{type:"video/mp4"}),o=window.URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=`${r}.mp4`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o)}async _navigateToNodeForExport(e){this._appState.prototypeState().navigateToFrameAndCloseOverlays(e,null,2,0,0)}async _waitForNavigationComplete(){return new Promise(e=>{let r=()=>{if(this._appState.prototypeState().getInitiatedChange()===null){e();return}setTimeout(r,16)};r()})}_updateScrollOffsetsFromMultiplayer(){var r,n;let e=((r=this._multiplayer)==null?void 0:r.getScrollPositions())||new Map;if(e!=null)for(let o of Array.from(e.keys())){let i=Q.fromString(o),a=(n=this._appState.scene())==null?void 0:n.findNode(i);a!=null&&a.setScrollOffset(e.get(o))}}_clampDirtyScrollContainers(){let e=this._appState.scene();if(e==null)return;let r=new Set;for(let n of Array.from(me._dirtyNodesForScrollClamping.values())){let o=e.findNode(n);for(let i=o;i!=null&&!(r.has(i.id())||i!=o&&Qt.isFrameLike(i.type())&&i.clipsToBoundingRectangle());i=i.parent())i.scrollDirection()!="NONE"&&this.updateScrollOffsetForNode(i,i.scrollOffset()),r.add(i.id())}me._dirtyNodesForScrollClamping=new Set}_handleScrollingPropertyChange(e,r,n,o){if(r==41)e.setScrollOffset(ge.FrozenVector_ZERO);else if(r==57||r==30)me._dirtyNodesForScrollClamping.add(e.id());else if(r==69){let i=this._appState.baseScreenNode();i!=null&&this.updateScrollOffsetForNode(i,i.scrollOffset())}else r==98&&(this._renderer.updateScroll(e),this._emitter.trigger("scrollEvent"))}renderLayerByLayerActivate(){this._renderer.renderLayerByLayerActivate(()=>{this.viewport().invalidate()})}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}static findBestScrollOrDragProposalInTree(e,r,n,o,i){let a=o==0,s=null;return s=(l,c)=>{let d=l.canvasSpaceGeometryBounds().contains2(c),u=l.canvasSpaceBoundingBox().contains2(c);if(l.clipsToBoundingRectangle()&&!d&&!u)return null;let p=null;for(let R=0,E=l.childCount();R<E;R=R+1){let P=l.childAt2(l.childCount()-R-1,!0),T=c,f=_a.getScrollTranslationOfNodeRelativeToParent(P);T=c.add(f);let y=s(P,T);p=(p==null?void 0:p.updateToBestProposal1(y))??y}let _=l.scrollDirectionWithScrollableContent(),h=u||d,A=_!="NONE"&&h&&!l.isInvisibleOrTransparent(),m=h&&l.visible()&&l.prototypeInteractions().some(R=>R.event().interactionType()=="DRAG"&&R.allActions().some(E=>lp.isValidForConnection(R.event().interactionType(),E.connectionType()))),g=r.length()>0?r.divideScalar(r.length()):r,S=null;if(h){if(A){let R=V1(_),E=me.ScrollOrDragProposal.InteractionType.OVERSCROLL;Math.abs(g.y())>0&&Math.abs(R.y())>0&&(g.y()>0?l.scrollOffset().y()<l.maxScrollOffsetY():l.scrollOffset().y()>l.minScrollOffsetY())&&(E=me.ScrollOrDragProposal.InteractionType.SCROLL),Math.abs(g.x())>0&&Math.abs(R.x())>0&&(g.x()>0?l.scrollOffset().x()<l.maxScrollOffsetX():l.scrollOffset().x()>l.minScrollOffsetX())&&(E=me.ScrollOrDragProposal.InteractionType.SCROLL);let P=bn.getDirectionSimilarity(_,g);(E==me.ScrollOrDragProposal.InteractionType.SCROLL||a)&&(S=new me.ScrollOrDragProposal(E,P,l.id(),null))}if(i!=null&&m){let R=g.multiplyScalar(-1);for(let E of l.prototypeInteractions().filter(P=>P.event().interactionType()=="DRAG")){let P=i(l,E),T=P!=null?R.dot(P.divideScalar(P.length())):0;S=(S==null?void 0:S.updateToBestProposal2(me.ScrollOrDragProposal.InteractionType.DRAG,T,l.id(),E.id()))??new me.ScrollOrDragProposal(me.ScrollOrDragProposal.InteractionType.DRAG,T,l.id(),E.id())}}}return S=(p==null?void 0:p.updateToBestProposal1(S))??S,S},s(n,e)}static _canvasSpaceBoundsOfDeviceBackground(e,r){let n=ro.infoForDevice(r);if(n==null)return Gr.FrozenRect_EMPTY;let o=e.canvasSpaceBoundingBox().topLeft(),i=r.canvasSpaceFramePresetSize(n);return new x(o.x(),o.y(),i.x(),i.y())}static findBestScrollOrDragProposalInFrame(e,r,n,o,i,a){if(o==null)return null;let s=i!=null&&ws.hasDevice(i.type),l=eT(me._getRelevantOSForDevice(i)),c=Math.abs(n.y())>Math.abs(n.x())?"VERTICAL":"HORIZONTAL",d=o.scrollsInPreferredDirection(c)&&o.hasOverflowingContentInScrollDirection();if(o.canvasSpaceBoundingBox().contains2(r)){let u=me.findBestScrollOrDragProposalInTree(r,n,o,l,a);if(u!=null)return u;if(s)return null}else if(s){if(me._canvasSpaceBoundsOfDeviceBackground(o,i).contains2(r))return null}else if(d)return new me.ScrollOrDragProposal(me.ScrollOrDragProposal.InteractionType.SCROLL,1,o.id(),null);return new me.ScrollOrDragProposal(me.ScrollOrDragProposal.InteractionType.SCROLL,1,e==null?void 0:e.id(),null)}static copyScrollOffset(e,r,n){r!=null&&n!=null&&(e==null?n.setScrollOffset(r.scrollOffset()):e.updateScrollOffsetForNode(n,r.scrollOffset()))}static findMatchingTransitionNode(e,r){let n=r.filter(l=>l.name()==e.name());if(n.length==1)return n[0];let o=e.canvasSpaceBoundingBox(),i=r.filter(l=>l.canvasSpaceBoundingBox().size().approximatelyEquals(o.size(),1));if(i.length==0)return null;if(i.length==1)return i[0];let a=e.topLevelAncestor(),s=o.topLeft();a!=null&&s.subtractUpdate1(a.canvasSpaceBoundingBox().topLeft());for(let l of i){let c=l.canvasSpaceBoundingBox().topLeft(),d=l.topLevelAncestor();if(d!=null&&c.subtractUpdate1(d.canvasSpaceBoundingBox().topLeft()),s.approximatelyEquals(c,1))return l}return null}static matchNodesAndPreserveScroll(e,r,n){if(!Q.equals(n.oldStateId(),n.newStateId())){let a=r.lastNodeForBaseScreen(),s=r.nextNodeForBaseScreen();me.findMatchingNodesAndPreserveScroll(e,a,s)}let o=n.oldStateAndOverlays.overlays,i=n.newStateAndOverlays.overlays;for(let a=0,s=Math.min(o.length,i.length);a<s;a=a+1)if(!Q.equals(o[a].id,i[a].id)){let l=r.lastNodeForOverlayAt(a),c=r.nextNodeForOverlayAt(a);me.findMatchingNodesAndPreserveScroll(e,l,c)}}static findMatchingNodesAndPreserveScroll(e,r,n){if(r!=null&&n!=null){me.copyScrollOffset(e,r,n);let o=r.scrollableFrameDescendants(),i=n.scrollableFrameDescendants();for(let a of o){if(i.length==0)break;let s=me.findMatchingTransitionNode(a,i);s!=null&&(me.copyScrollOffset(e,a,s),ie.List_removeOne(i,s))}}}static clampScrollOffsetForNode(e,r){if(e.scrollDirection()=="NONE")return ge.FrozenVector_ZERO.clone();let n=O.new();return e.scrollDirection()=="HORIZONTAL"?n.setX(Ir.Math_clamp(r.x(),e.minScrollOffsetX(),e.maxScrollOffsetX())):e.scrollDirection()=="VERTICAL"?n.setY(Ir.Math_clamp(r.y(),e.minScrollOffsetY(),e.maxScrollOffsetY())):e.scrollDirection()=="BOTH"&&(n.setX(Ir.Math_clamp(r.x(),e.minScrollOffsetX(),e.maxScrollOffsetX())),n.setY(Ir.Math_clamp(r.y(),e.minScrollOffsetY(),e.maxScrollOffsetY()))),n}static _getRelevantOSForDevice(e){return Wt.current()==2||Wt.current()==1||e==null?Wt.current():e.os()==2||e.os()==1?e.os():Wt.current()}};me._scrollPhysics=new _d,me._scrollAnimationManager=null,me._overscrolledNodeID=null,me._dirtyNodesForScrollClamping=new Set;var ci=me;(i=>{class t{constructor(s){this._canvasView=null,this._dragStart=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1,this._isPinchGestureConfirmed=!1,this._activeScrollOrDrag=null,this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0,this._canvasView=s}unlockScroll(){this._lastScrollEvent=0,this._scrollingNodeId=null}resetStateForTests(){this._resetDragInfo(),this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0}isDragging(){return this._isDragging}_handleSinglePointerPress(s,l){let c=s.locationInView(this._canvasView);this._canvasView.triggerMouseAction(l,c),this._dragStart=c,this._isDragGestureConfirmed=!1,this._canvasView.recordViewportSpaceClick(this._dragStart),s.accept(),this._flingPoints=[],this._currentGesture=new Xf(c,Xe.seconds(),s.interactionType()),this._lastPointerPressHandled=this._canvasView.handleInteractionsForPress(c),this._lastPointerPressHandled!=0&&(this._lastPointerPressHandledAt=Xe.seconds())}onMousePress(s){this._handleSinglePointerPress(s,6),this._canvasView.cancelAnimationManager()}onTouchPress(s){this._canvasView.cancelAnimationManager(),s.touches.length==1?this._handleSinglePointerPress(s,10):s.accept()}_processPointerRelease(s){var m,g;if(!this._canvasView.appState().prototypeState().interactionsEnabled())return!1;let l=this._isDragGestureConfirmed,c=!l&&this._lastPointerPressHandled!=2,d=l&&this._lastPointerPressHandled==1&&(this._activeScrollOrDrag==null||this._activeScrollOrDrag.interactionType==i.ScrollOrDragProposal.InteractionType.DRAG),u=c||d,p=this._canvasView.handleInteractionsForRelease(s,u,this._lastPointerPressHandled);return(this._isDragging?this._canvasView.handleFling((m=this._activeScrollOrDrag)==null?void 0:m.targetNodeId,this._flingPoints):0)==0&&this._canvasView.maybeHandleOverdragRelease(),!l&&p==0&&this._lastPointerPressHandled==0&&(this._canvasView.appState().prototypeRecorder().isRecording()&&this._canvasView.appState().prototypeRecorder().addHistoricalEvent({type:"MISCLICK",action:4,currentFrameName:(g=this._canvasView.appState().prototypeState().getCurrentBaseScreenNode())==null?void 0:g.name(),canvasViewSpaceMousePosition:this._canvasView.viewport().canvasSpaceToViewSpace1().inverseTransformPoint(new O(s.x(),s.y())).toJSON(),timeRecorded:Date.now()}),this._canvasView.performHotspotAnimationOnClick()),!l&&this._canvasView.appState().scene()!=null&&K.getViewerMode()==K.ViewerMode.MIRROR&&this._canvasView.appState().triggerAction1(5),this._canvasView.updateCursorType(s,null),this._resetDragInfo(),l||p==1||this._lastPointerPressHandled==1}_storeOrProcessPointerReleaseAtPoint(s){if(Xe.seconds()-this._lastPointerPressHandledAt<v2)this._storedPointerReleasePoint=s;else if(this._processPointerRelease(s))return 1;return this._lastPointerPressHandledAt=0,0}onMouseRelease(s){let l=s.locationInView(this._canvasView);this._canvasView.triggerMouseAction(9,l),this._storeOrProcessPointerReleaseAtPoint(l)}onTouchRelease(s){if(this._isPinchGestureConfirmed&&s.touches.length===0&&be.trackEvent("slides.mobile_web.pinch_to_zoom",{fileKey:this._canvasView.appState().currentFileKey()}),s.touches.length==0&&this._currentGesture!=null){if(this._currentGesture!=null)if(this._currentGesture.endTime=Xe.seconds(),this.isSingleTap()){let l=this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation);K.getFeatureFlags().slides_mobile_web_hyperlink&&this._canvasView.appState().prototypeStructure().navigationOrderType()===2&&l===0?this._canvasView.maybeHandleSingleTapAsNavigation(this._currentGesture.endLocation):l==0&&this._canvasView.appState().prototypeState().getTransitionOnClick()&&this._canvasView.maybeHandleSingleTapAsNavigation(this._currentGesture.endLocation)}else this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation);this._resetDragInfo()}else s.touches.length==0&&this._canvasView.maybeHandleOverdragRelease();this._previousGesture=this._currentGesture,this._currentGesture=null}_resetDragInfo(){this._dragStart=null,this._activeScrollOrDrag=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1,this._isPinchGestureConfirmed=!1}_onPinchToZoom(s){let l=s.asTouchEvent();if(!l)return;let c=l.getPinchScale(),d=l.getPinchCenter();if(c===null||d===null)return;let u=d.subtract(this._canvasView.viewport().viewSpaceBounds().topLeft());this._canvasView.viewport().adjustCameraZoomWithPin(c,u)}onDrag(s){var d;let l=s.locationInView(this._canvasView);if(this._isDragging=!0,this._dragStart!=null&&!this._isDragGestureConfirmed&&(this._isDragGestureConfirmed=s.interactionCount()>1||l.distanceTo(this._dragStart)>E2),this._isDragGestureConfirmed&&s.interactionCount()===2&&this._canvasView.appState().editorType()==="SLIDES"&&s.asTouchEvent().isPinching()){this._isPinchGestureConfirmed=!0,this._onPinchToZoom(s);return}if(this._dragStart!=null&&this._isDragGestureConfirmed&&!this._isDragInteractionLocked){let u=l.subtract(this._dragStart).multiplyScalar(-1);this._activeScrollOrDrag=this._canvasView.getBestScrollOrDragProposal(1,this._dragStart,u)}if(!this._canvasView.appState().prototypeState().isDragging()){if(this._isDragGestureConfirmed&&K.getDragToPan()&&this._activeScrollOrDrag!=null){let u=s.delta(),p=(d=this._canvasView.appState().scene())==null?void 0:d.findNode(this._activeScrollOrDrag.targetNodeId);switch(this._activeScrollOrDrag.interactionType){case i.ScrollOrDragProposal.InteractionType.SCROLL:case i.ScrollOrDragProposal.InteractionType.OVERSCROLL:{p!=null&&p!=this._canvasView.appState().getActiveCanvas()?this._canvasView.scrollNode(p.id(),1,u.negative().divideScalar(this._canvasView.viewport().zoomScale()),s.locationInView(this._canvasView))&&(this._lastPointerPressHandled=1,this._isDragInteractionLocked=!0,this._canvasView.handleInteractionsForScroll()):this._canvasView.viewport().panCamera(u);break}case i.ScrollOrDragProposal.InteractionType.DRAG:{this._lastPointerPressHandled=this._canvasView.handleDragStart(l,p,this._activeScrollOrDrag.targetInteractionId),this._isDragInteractionLocked=!0;break}}s.interactionCount()!=1?this._currentGesture=null:this._currentGesture!=null&&(this._flingPoints.push(new Xf(l,Xe.seconds(),s.interactionType())),this._currentGesture.endLocation=l,this._currentGesture.endTime=Xe.seconds())}}this._canvasView.idlenessTracker().handleInteraction(),this._canvasView.handleInteractionsForDrag(l),s.interactionType()==0&&(this._canvasView.updateUserCursor(s),this._canvasView.triggerMouseAction(8,l))}onMouseScroll(s){var p;let l=this._canvasView.appState().getActiveCanvas();if(l==null)return;let c=Xe.seconds();c-this._lastScrollEvent>I2&&(this._scrollingNodeId=null);let d=s.locationInView(this._canvasView),u=this._canvasView.appState().activePrototypeDevice()!=null&&ws.hasDevice(this._canvasView.appState().activePrototypeDevice().type);if((8&s.modifiers()||2&s.modifiers())&&_m(this._canvasView.appState().prototypeState().getCurrentScalingInfo(),u))this._canvasView.viewport().adjustCameraZoomWithPin(Math.pow(.99,s.scrollDelta.y()),d.subtract(this._canvasView.viewport().viewSpaceBounds().topLeft())),s.accept(),this._canvasView.userDidAttemptZoom!=null&&this._canvasView.userDidAttemptZoom(1);else{let _=(p=l.scene())==null?void 0:p.findNode(this._scrollingNodeId);if(_==null){let h=this._canvasView.getBestScrollOrDragProposal(0,d,s.scrollDelta);_=this._canvasView.appState().scene().findNode(h==null?void 0:h.targetNodeId),this._scrollingNodeId=_==null?void 0:_.id()}_==null||(_!=l?(this._canvasView.scrollNode(this._scrollingNodeId,0,s.scrollDelta.divideScalar(this._canvasView.viewport().zoomScale()),null)&&(this._canvasView.handleInteractionsForScroll(),this._canvasView.handleInteractionsForMove(d,!0)),s.accept()):K.getScrollToPan()&&(this._canvasView.viewport().panCamera(s.scrollDelta.negative()),this._scrollingNodeId=l.id(),s.accept(),this._canvasView.handleInteractionsForMove(d,!0)))}this._lastScrollEvent=c,this._canvasView.idlenessTracker().handleInteraction()}onMouseMove(s){let l=s.locationInView(this._canvasView);this._canvasView.updateUserCursor(s),this._canvasView.triggerMouseAction(7,l),this._canvasView.handleInteractionsForMove(l,!0),this._scrollingNodeId=null}onMouseLeave(s){this._canvasView.updateUserCursor(null),this._canvasView.handleInteractionsForLeave()}onKeyPress(s,l){let c=this._canvasView.handleInteractionsForKeyPress(s);K.isInlinePreview()&&c==0&&(s.key==7||s.key==8&&4&s.modifiers())&&l.trigger("requestClose")}onGamepadDown(s){this._canvasView.handleInteractionsForGamepadDown(s)}maybeProcessStoredPointerRelease(){this._storedPointerReleasePoint!=null&&(this._processPointerRelease(this._storedPointerReleasePoint),this._storedPointerReleasePoint=null)}isSingleTap(){return this._canvasView.appState().baseScreenNode()!=null&&this._currentGesture!=null&&this._currentGesture.isTap()}}i.CanvasPointerEventDelegate=t;let e;(c=>(c[c.NOT_HANDLED=0]="NOT_HANDLED",c[c.HANDLED=1]="HANDLED",c[c.MAINTAINED=2]="MAINTAINED"))(e=i.WasHandled||(i.WasHandled={}));let r;(l=>(l[l.SCROLL_ONLY=0]="SCROLL_ONLY",l[l.SCROLL_OR_DRAG=1]="SCROLL_OR_DRAG"))(r=i.ScrollOrDragQuerySet||(i.ScrollOrDragQuerySet={}));class n{updateToBestProposal1(s){return s!=null&&this.updateToBestProposal2(s.interactionType,s.directionSimilarity,s.targetNodeId,s.targetInteractionId),this}updateToBestProposal2(s,l,c,d){return(this.interactionType==i.ScrollOrDragProposal.InteractionType.OVERSCROLL&&s==i.ScrollOrDragProposal.InteractionType.DRAG||l>this.directionSimilarity)&&(this.interactionType=s,this.directionSimilarity=l,this.targetNodeId=c,this.targetInteractionId=d),this}constructor(s,l,c,d){this.interactionType=s,this.directionSimilarity=l,this.targetNodeId=c,this.targetInteractionId=d}}i.ScrollOrDragProposal=n,(s=>{let a;(u=>(u[u.OVERSCROLL=0]="OVERSCROLL",u[u.SCROLL=1]="SCROLL",u[u.DRAG=2]="DRAG"))(a=s.InteractionType||(s.InteractionType={}))})(n=i.ScrollOrDragProposal||(i.ScrollOrDragProposal={}));let o;(c=>(c[c.SCROLL_EVENT=0]="SCROLL_EVENT",c[c.DRAGGING=1]="DRAGGING",c[c.FLING=2]="FLING"))(o=i.ScrollSource||(i.ScrollSource={}))})(ci||(ci={}));var Xf=class{constructor(e,r,n){this.startLocation=null,this.startTime=0,this.endLocation=null,this.endTime=0,this.type=0,this.startLocation=e,this.startTime=r,this.endLocation=e,this.endTime=r,this.type=n}isTap(){return(this.endLocation==null||this.startLocation.distanceTo(this.endLocation)<y2)&&this.endTime-this.startTime<R2}},E2=5,I2=.2,R2=.4,y2=50,v2=.1;var wd=class t{constructor(e,r,n){this._appState=null,this._canvasView=null,this._emitter=null,this._session=null,this._userSyncing=null,this._isFirst=!1,this._appState=e,this._canvasView=r,this._emitter=Ht.getEventEmitter(),this._session=n,this._userSyncing=null,this._isFirst=!0,this._session.addObserver(this),this._appState.addFrameObserver(this)}reset(){this._isFirst=!0}userInfoJSON(){var l;if(this._userSyncing==null)return null;let e=[],r=this._userSyncing.userBySessionID(),n=this._session.sessionID(),o=r.get(n),i=o==null?void 0:o.clientID,a=(l=this._session.presenterSessionID())==null?void 0:l.value;o!=null&&e.push(o.toJSON());for(let c of Array.from(this._userSyncing.userBySessionID().values()))if(c.sessionID!=n){if(i!=null&&c.clientID==i){a==c.sessionID&&(a=null);continue}e.push(c.toJSON())}let s=0;if(a!=null&&a==n)for(let c of Array.from(this._userSyncing.userBySessionID().values()))c.sessionID!=n&&c.observedSessions.indexOf(n)!=-1&&(s=s+1);return{deviceNameFilter:this._session.role(),sessionID:n,allUsers:e,followerCount:s,observingSessionID:this._session.observingSessionID(),presenterSessionID:a,sessionNominatedByCurrentUser:this._session.sessionNominatedByCurrentUser()!=null?this._session.sessionNominatedByCurrentUser().value:null,sessionsNominatingCurrentUser:this._session.sessionsNominatingCurrentUser()}}syncObservedVariableActions(e){let r=this._appState.prototypeState(),n=this._session.observedUser();if(n==null)return;e&&r.resetVariablePrototypeState();let o=n.triggeredSetVariableActionData??[],i=n.triggeredSetVariableModeActionData??[];(r.getSetVariableActionHistoryLength()>o.length||r.getSetVariableModeActionHistoryLength()>i.length)&&r.resetVariablePrototypeState();let a=r.getSetVariableActionHistoryLength();for(let l=0;l<o.length;l++){let c=o[l];(l>=a||c.targetVariableData!==r._setVariableActionHistory[l].targetVariableData)&&r.performMultiplayerSetVariableAction(c)}let s=r.getSetVariableModeActionHistoryLength();for(let l=0;l<i.length;l++){let c=i[l];(l>=s||c.targetVariableModeId!==r._setVariableModeActionHistory[l].targetVariableModeId)&&r.performMultiplayerSetVariableModeAction(c)}}syncObservedVideoState(){let e=this._appState.prototypeState(),r=this._session.observedUser();if(r==null)return;let n=r.videoStateChangeData??[];for(let o=0;o<n.length;o++){let i=n[o];if(!i.targetNodeId)continue;let a=Q.fromFigGUID(i.targetNodeId),s=e.getVideoStateChangeForGuid(a);(!s||!this._videoStateEqual(i,s))&&e.performMultiplayerVideoStateChange((s==null?void 0:s.currentTimes)||[],i)}}syncObservedEmbeddedPrototypeState__OLD__(e){if(this._userSyncing==null)return null;let r=this._session.observedUser(),n=this._userSyncing.userBySessionID(),o=this._session.sessionID(),i=n.get(o);if(i==null)return;let a=i.embeddedPrototypeData.map(s=>s.nodeId).filter(s=>s!=null);r==null?a.forEach(s=>{this._emitter.trigger("embeddedPrototypeChange",{presenterSessionId:null,nodeId:Q.fromFigGUID(s)})}):r.embeddedPrototypeData.forEach(s=>{s.nodeId!=null&&this._emitter.trigger("embeddedPrototypeChange",{presenterSessionId:s.sessionId,nodeId:Q.fromFigGUID(s.nodeId)})})}syncObservedEmbeddedPrototypeState(e){let r=this._session.observedUser();if(r==null)return;let n=r.embeddedPrototypeData;for(let o of n){if(o.nodeId==null)continue;let i=Q.fromFigGUID(o.nodeId);this._appState.embeddedPrototypeManager().requestPrototype(i),this._appState.embeddedPrototypeManager().setSessionId(i,o.sessionId??null)}}syncObservedActiveEmbeddedPrototypes(){let e=this._session.observedUser();if(e==null)return;let r=e.activeSlidesEmbeddablePrototype;this._appState.prototypeState().getActiveSlidesPrototypeEmbedGUID()!==r&&this._appState.prototypeState().setActiveSlidesPrototypeEmbedGUID(r)}_videoStateEqual(e,r){if(!(!e.targetNodeId&&!r.targetNodeId||e.targetNodeId&&r.targetNodeId&&Q.fromFigGUID(e.targetNodeId)===Q.fromFigGUID(r.targetNodeId))||e.isPlaying!=r.isPlaying||e.isPlayingSound!=r.isPlayingSound||e.actionTakenTimestamp!=r.actionTakenTimestamp)return!1;let o=e.currentTimes,i=r.currentTimes;return!(!o&&i||o&&!i)}syncObservedFrameOrOverlay(e){if(!this._appState.getActiveCanvas()||!this._appState.getActiveCanvas().scene())return;let r=this._session.observedUser();if(r==null)return;this.applyInstanceStateSwaps(e);let n=this._appState.baseScreenId(),o=this._appState.prototypeState().getCurrentAnimationState();this._applyBaseScreenStateFromDriver(r),this._applyOverlayStateFromDriver(r),(!e||this._appState.prototypeState().getInitiatedChange()==null)&&this._applyObjectAnimationStateFromDriver(r,n,o,e);let i=this._appState.prototypeState();i.getInitiatedChange()!=null&&!e&&(i.mostRecentFixInvalidStateInitiator="MultiplayerCoupler.setPreviewToObservedFrameOrOverlay",i.commitStateChange())}_applyBaseScreenStateFromDriver(e){let r=e.currentFrame;if(r==null||Q.equals(this._appState.baseScreenId(),r))return;let n=e.triggeredOverlaysData.length>0,o=n?null:e.lastTriggeredHotspot,i=n?null:e.lastTriggeredPrototypeInteractionID,a=null;if(o!=null&&i!=null)a=this._appState.prototypeStructure().findPrototypeInteractionWithId(o,i);else if(o!=null){let c=this._appState.getActiveCanvas().scene().findNode(o);if(c!=null){let d=Fn.cleanedInteractionsForNode(this._appState,c);d.length!=0&&(a=d[0])}}let s=this._appState.prototypeStructure().navigationOrder().transitionDirectionBetweenFrames(this._appState.baseScreenId(),r),l=o!=null?this._appState.scene().findNode(o):null;this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,l,1,s,0,a,null)}_applyOverlayStateFromDriver(e){let r=this._appState.prototypeState(),n=this._appState.prototypeStructure(),o=r.getCurrentOverlays(),i=e.triggeredOverlaysData??[];o.length>i.length&&(r.closeOverlayAtAndAbove(i.length,1),o=r.getCurrentOverlays());for(let a=0,s=i.length;a<s;a=a+1){let l=ut.decodeGUID(i[a].overlayGuid),c=ut.decodeGUID(i[a].swapGuid),d=ut.decodeGUID_instanceHACK(i[a].hotspotGuid),u=ut.decodeGUID(i[a].prototypeInteractionGuid),p=e.lastTriggeredPrototypeInteractionID,_=null;if(u!=null)_=n.findPrototypeInteractionWithId(d,u);else{let A=this._appState.prototypeStructure().findPrototypeInteractionsWithTransition(d,c);A.length!=0&&(_=A[0])}if(o.length<=a){let A=this._appState.scene().findNode(d);if(A==null)return;r.overlayFrame(c,A,0,0,_,null),o=r.getCurrentOverlays()}let h=o[a];if(!h){za.loge("MultiplayerCoupler","Cannot find overlay for setPreviewToObservedFrameOrOverlay",{driverOverlayId:l,driverOpeningOverlayId:c},{reportAsSentryError:!0,logToConsole:0});continue}if(!Q.equals(h.id(),l)||!Q.equals(h.overlayDataModelId(),c)){if(a<o.length-1&&r.closeOverlayAtAndAbove(a+1,1),!Q.equals(h.overlayDataModelId(),c)){r.closeOverlayAtAndAbove(a,1);let R=this._appState.scene().findNode(d);r.overlayFrame(c,R,0,0,_,null)}let A=this._appState.scene().findNode(h.id()),m=e.lastTriggeredHotspot,g=this._appState.scene().findNode(m);g=A!=null&&A.isAncestorOf(g)?g:null;let S=null;g!=null&&p!=null?S=n.findPrototypeInteractionWithId(g.id(),p):g!=null&&n.nodeTransitionTracker().cleanedUpInteractionMap()._in(g.id())&&(S=n.nodeTransitionTracker().cleanedUpInteractionMap().getHotspotInteractions(g.id())[0]),r.swapTopOverlay(l,g,0,S,null)}o=r.getCurrentOverlays()}}compareAnimationState(e,r,n,o){if(e.id()!==n.id())return this._appState.prototypeStructure().navigationOrder().compare(e.id(),n.id());if(KA(r,o))return 0;if(r==null)return-1;if(o==null)return 1;let i=n.getObjectAnimationInteractionIndex(o),a=n.getObjectAnimationInteractionIndex(r);return i!==a?a-i:r.actionIndex-o.actionIndex}_applyObjectAnimationStateFromDriver(e,r,n,o){if(!this._appState.prototypeStructure().navigationOrder().shouldSyncObjectAnimations())return;let i=e.currentFrame,a=t.getAnimationStateFromDriver(e);if(Q.equals(r,i)&&KA(n,a)||!Q.equals(this._appState.baseScreenId(),i))return;let s=this._appState.scene().findNode(i),l=this._appState.scene().findNode(r);if(!s||!l)return;let c=this.compareAnimationState(l,n,s,a)<0?0:1;if(a==null)F().previewSceneAt(i,0,0);else{let u=s.getObjectAnimationInteractionIndex(a),p=s.objectAnimations(),_=p[u];u>=0&&u<p.length&&a.actionIndex>=0&&_&&a.actionIndex<_.getAllActions().length?F().previewSceneAt(i,u,a.actionIndex):za.loge("MultiplayerCoupler","Trying to sync invalid object animation state",{driverBaseScreenId:i,driverInteractionIndex:u,interactions:p,actionIndex:a.actionIndex},{reportAsSentryError:!0,logToConsole:0})}let d=this._appState.prototypeState();d.playObjectAnimation(s,a,c),o||d.commitStateChange()}static getAnimationStateFromDriver(e){let r=e.lastTriggeredPrototypeInteractionID,n=e.lastTriggeredObjectAnimationIndex;return r===Q.invalid()||n===null||n<0?null:new Mo(r,n)}_initiateStateSwap(e){var a;let r=this._appState.prototypeState(),n=ut.decodeGUIDPath(e.hotspotStablePath),o=(a=this._appState.scene())==null?void 0:a.findNodeByStablePath(n),i=ut.decodeGUID(e.interactionID);r.swapInstanceToState2(ut.decodeGUIDPath(e.instanceStablePath),ut.decodeGUID(e.stateID),o,0,o==null?void 0:o.findPrototypeInteraction(i),1,null)}_commitStateSwap(e){let r=this._appState.prototypeState(),n=ut.decodeGUIDPath(e.instanceStablePath);r.commitChangesBelowInstanceTransitionRoot(n)}applyInstanceStateSwaps(e){let r=this._session.observedUser();if(r.instanceStateChanges!=null){for(let n of r.instanceStateChanges)n.phase=="INITIATED"&&this._initiateStateSwap(n),(n.phase=="COMMITTED"||!e)&&this._commitStateSwap(n);r.instanceStateChanges=[]}}handleConnect(e,r){this._userSyncing=new oc,this._session.setMultiplayerUserSyncing(this._userSyncing),this._userSyncing.onChange=()=>{this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())},this._userSyncing.onMouseCursorChange=n=>{var o;n==this._session.observingSessionID()&&((o=this._canvasView)==null||o.viewport().invalidate())}}handleDisconnect(){this._userSyncing=null,this._session.setMultiplayerUserSyncing(null),this._emitter.trigger("multiplayerUserInfoChange",null)}handleJoinStart(e,r,n){e!=1&&this._emitter.trigger("joinStart")}handleJoinEnd(){var r;this._session.scene()!=this._appState.scene()&&this._appState.setActiveCanvas(null),this._isFirst&&(this._isFirst=!1);let e=this._appState.getActiveCanvas();e!=null&&(K.isSlidesEmbed()?this._emitter.trigger("prototypeDeviceChanged",e.storedPrototypeDevice().toJSON()):this._emitter.trigger("prototypeDeviceChanged",e.prototypeDevice().toJSON())),(r=this._canvasView)==null||r.afterEnteredViewer()}handleNodeChanges(){this._appState.prototypeState().mostRecentFixInvalidStateInitiator="MultiplayerCoupler.didApplyNodeChanges",this._appState.prototypeState().didApplyNodeChanges()}handlePresenterChange(){this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())}handleSceneGraphReply(e,r){}handleSceneChangedLoadingPhase(e,r){}onFrame(){this.syncObservedFrameOrOverlay(!0),this.syncObservedVariableActions(!1),this.syncObservedVideoState(),K.getFeatureFlags().slides_iframe_embedded_prototypes_improvements?this.syncObservedEmbeddedPrototypeState(!1):this.syncObservedEmbeddedPrototypeState__OLD__(!1),this.syncObservedActiveEmbeddedPrototypes()}};var Zf;(u=>{function t(p){return p}u._shortcut1=t;function e(p,_){return p|_<<u.MODIFIERS_SHIFT}u._shortcut2=e;function r(p,_,h){return p|_<<u.MODIFIERS_SHIFT|h<<u.FLAGS_SHIFT}u._shortcut3=r;function n(p){let _=new Map([[3,[e(20,4),e(20,16)]],[4,[21,29]],[1,[93,92,69,e(93,16),e(92,16),e(69,16)]],[2,[91,70,e(91,16),e(70,16)]]]);for(let h of Array.from(_.keys()))for(let A of _.get(h)){let m=A&u.KEY_MASK,g=A>>u.MODIFIERS_SHIFT&u.MODIFIERS_MASK,S=A>>u.FLAGS_SHIFT&u.FLAGS_MASK;i.Flags_currentlyApplies(S)&&(16&g&&(g|=Fl.Modifiers_currentPlatformModifier()),Fc.KeyShortcutMap_set(p,m,g,h))}}u.addTo=n;let o;(A=>(A[A.__NONE=0]="__NONE",A[A.MAC=1]="MAC",A[A.NON_MAC=2]="NON_MAC"))(o=u.Flags||(u.Flags={}));let i;(A=>{function p(m){return(1&m)!=0}A.Flags_isMacOnly=p;function _(m){return(2&m)!=0}A.Flags_isNonMacOnly=_;function h(m){return(!p(m)||Wt.current()==4)&&(!_(m)||Wt.current()!=4)}A.Flags_currentlyApplies=h})(i=u.in_Flags||(u.in_Flags={})),u.KEY_MASK=255,u.MODIFIERS_MASK=255,u.MODIFIERS_SHIFT=8,u.FLAGS_MASK=255,u.FLAGS_SHIFT=16})(Zf||(Zf={}));var xd=class{constructor(e,r,n,o){this._window=null,this._appState=null,this._canvasView=null,this._shortcuts=new Map,this._multiplayerSession=null,this._multiplayerCoupler=null,this._window=new j_(e,r,o==1,()=>K.disableKeyboardHandling(),()=>K.isInlinePreview()),this._appState=new ur,this._canvasView=new ci(this._appState),this._canvasView.setParent(this._window.root()),this._canvasView.setup(),this._canvasView.focus(),this._registerShortcuts(),this._multiplayerSession=new Ba(this._appState,()=>this._window.isActive(),n),this._multiplayerCoupler=new wd(this._appState,this._canvasView,this._multiplayerSession),this._canvasView.setMultiplayer(this._multiplayerSession),Qn.instance.setMultiplayer(this._multiplayerSession)}state(){return this._appState}canvasView(){return this._canvasView}window(){return this._window}multiplayerSession(){return this._multiplayerSession}multiplayerCoupler(){return this._multiplayerCoupler}_registerShortcuts(){let e=!0;fn.addUpdate(rr.keyPress(this._window.root().events()),r=>{e&&(Zf.addTo(this._shortcuts),e=!1);let n=Fc.KeyShortcutMap_get(this._shortcuts,r.asKeyEvent().key,r.modifiers(),0);n!=0&&(this._appState.triggerAction1(n),r.accept())})}unloadSceneAndResetPrototypeLib(){this._multiplayerSession.disconnect(),this._appState.prototypeState().mostRecentFixInvalidStateInitiator="App.unloadSceneAndResetPrototypeLib",this._appState.setScene(null),this._multiplayerSession.setScene(null),F()!=null&&(console.debug("Resetting PrototypeLib..."),h_())}initializePrototypeLib(e){if(this.unloadSceneAndResetPrototypeLib(),e==null)throw new Error("Can't initialize PrototypeLib with null CppModules");__(new rd(e,this._appState))}connectTo(e,r,n,o,i,a){this._appState.prototypeState().mostRecentFixInvalidStateInitiator="App.connectTo",this._appState.setActivePrototypeStartingPointNodeId(n),this._appState.prototypeState().mostRecentBaseScreenIdChangeInitiator="App.connectTo",this._appState.prototypeState().resetPrototype(),this._multiplayerCoupler.reset(),this._appState.setRenderDots(!!o),this._canvasView.setBackgroundEnabled(!o),this._appState.setEditorType(a),this._canvasView.initializeThumbnailInvalidationManager(a),Vt.setImagePrefixURL(`/file/${e}/image`),Vt.setVideoPrefixUrl(`/api/files/${e}/videos`),Vt.setCompressedTexturesAvailabilityURL(`/file/${e}/compressed_texture_available/batch`),K.shouldApplyMobileOptimizations()?Vt.setImageBatchURL(`/file/${e}/image/batch?max_size=2048`):Vt.setImageBatchURL(`/file/${e}/image/batch`),this.canvasView().dangerouslyAccessProtoRenderManager().getContext().supportsCompressedTextures()&&K.shouldUseCompressedTextures()&&Vt.setShouldUseCompressedTextures(!0),this.initializePrototypeLib(i),this._multiplayerSession.connectTo(e,r)}};var HT;(o=>{function t(i){return Array.from(i.values())}o.Set_values=t;function e(i,a){return n(i,a)}o.Set_subtract=e;function r(i){return new Set(i)}o.Set_new1=r;function n(i,a){let s=new Set(Array.from(i.values()));return i.forEach(l=>{a.has(l)&&s.delete(l)}),s}o.Set_difference=n})(HT||(HT={}));var WT=class{constructor(e,r){this._context=e,this._byteCount=r,this._bytes=new Uint8Array(r)}context(){return this._context}bytesForUpload(){return this._bytes}byteCount(){return this._byteCount}moveBytesForUpload(e,r,n){n>=0,0<=e&&e+n<=this._byteCount,0<=r&&r+n<=this._byteCount,e!=r&&n!=0&&this._bytes.set(this._bytes.subarray(e,e+n),r)}setBytesForUpload(e,r){0<=r&&r+e.length<=this._byteCount,this._bytes.set(e,r)}prepare(){}},KT=class{constructor(e,r,n){this._context=e,this._name=r,this._inputLayout=n}prepare(){throw new Error("Method not implemented.")}program(){throw new Error("Method not implemented.")}getEmscriptenProgramId(){throw new Error("Method not implemented.")}context(){return this._context}name(){return this._name}inputLayout(){return this._inputLayout}setUniformFloat(e,r){}setUniformInt(e,r){}setUniformVec21(e,r,n){}setUniformVec41(e,r,n,o,i){}setUniformMat31(e,r,n,o,i,a,s){}setUniformSampler(e,r,n){}},ll=class{createVertexBuffer(e){let r=new WT(this,e);return this.buffers.push(r),r}createVertexBufferPool(){return new ts(this,this)}addContextResetHandler(e){}beginFrame(){}clear(e,r){this.clearCount+=1}createMaterial(e,r,n,o){return new KT(this,e,r)}createTexture(e,r,n,o){return null}createTextureWithPixels(e,r,n,o,i){return null}createTextureWithVideo(e,r,n){return null}createFramebuffer(e,r,n){return null}currentBlendState(){return null}draw(e,r,n){}drawInstanced(e,r,n){}supportsGpuInstancing(){return!1}flush(){}getNumFramebufferSwitches(){return 0}height(){return 0}maxTextureSize(){return 4096}removeContextResetHandler(e){}resizeDefaultFramebuffer(e,r){return new ra(new O(e,r),!1)}readPixels(e,r,n,o,i){return null}resetNumFramebufferSwitches(){}bindWebGLFramebufferAndTrackForBudget(e){}width(){return 0}annotate(e,r){r()}annotateAndReturn(e,r){return r()}annotateProfile(e,r){r()}isContextLost(){return!1}graphicsCardName(){return"Unknown"}isVisible(){return!1}setMaximumDrawingBufferSizeForTesting(e){}clearMaximumDrawingBufferSizeForTesting(){}hasLoggedHighpPrecisionUnsupported(){return!0}setHasLoggedHighpPrecisionUnsupported(){}stats(){return null}getGpuMetricsCollection(){return this._gpuMetricsCollection}supportsCompressedTextures(){return!1}constructor(){this.buffers=[],this._gpuMetricsCollection=new es.GpuMetricsCollection,this._gpuMetricsCollection.setBufferSize(2),this.clearCount=0}};var jP;(s=>{function t(){let l=AssertLib.deepStrictEqual,c=new a,d=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),0);l(d.area.byteOffset(),0);let u=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),1);l(u.area.byteOffset(),c.quarterChunkSizeInBytes());let p=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),2);l(p.area.byteOffset(),c.quarterChunkSizeInBytes()*2);let _=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),3);l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*3),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),d.free(),p.free(),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*2);let h=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),4);l(u.area.byteOffset(),0),l(_.area.byteOffset(),c.quarterChunkSizeInBytes()),l(h.area.byteOffset(),c.quarterChunkSizeInBytes()*2),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*3),l(c.context.buffers.length,1);let A=c.context.buffers[0];u.check(A),_.check(A),h.check(A)}s.testBasicBufferPoolGC=t;function e(){let l=AssertLib.deepStrictEqual,c=new a,d=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),0);l(d.area.byteOffset(),0);let u=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),1);l(u.area.byteOffset(),c.quarterChunkSizeInBytes());let p=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),2);l(p.area.byteOffset(),c.quarterChunkSizeInBytes()*2);let _=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),3);l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*3),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),d.free(),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*3);let h=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),4);l(u.area.byteOffset(),0),l(p.area.byteOffset(),c.quarterChunkSizeInBytes()),l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*2),l(h.area.byteOffset(),c.quarterChunkSizeInBytes()*3),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),l(c.context.buffers.length,1);let A=c.context.buffers[0];u.check(A),p.check(A),_.check(A),h.check(A)}s.testBasicBufferPoolGC2=e;async function r(){Br.updateFeatureGateForTesting("viewer_cleanup_buffer_areas",!0);let l=AssertLib.deepStrictEqual,c=new a,d=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),0);l(d.area.byteOffset(),0);let u=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),1);l(u.area.byteOffset(),c.quarterChunkSizeInBytes());let p=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),2);l(p.area.byteOffset(),c.quarterChunkSizeInBytes()*2);let _=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),3);l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*3),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),d=null,p=null,await P2(),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*2);let h=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),4);l(u.area.byteOffset(),0),l(_.area.byteOffset(),c.quarterChunkSizeInBytes()),l(h.area.byteOffset(),c.quarterChunkSizeInBytes()*2),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*3),l(c.context.buffers.length,1);let A=c.context.buffers[0];u.check(A),_.check(A),h.check(A)}s.testBufferPoolGCAfterSystemGC=r;function n(){let l=AssertLib.deepStrictEqual,c=new a,d=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),0);l(d.area.byteOffset(),0);let u=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),1);l(u.area.byteOffset(),c.quarterChunkSizeInBytes());let p=c.add(It.getPositionF2(),c.quarterChunkSizeInBytes(),2);l(p.area.byteOffset(),c.quarterChunkSizeInBytes()*2),u.free();let _=c.add(It.getPositionF2(),c.chunkSizeInBytes()/2|0,3);l(d.area.byteOffset(),0),l(p.area.byteOffset(),c.quarterChunkSizeInBytes()),l(_.area.byteOffset(),c.quarterChunkSizeInBytes()*2),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()/4*4),l(c.context.buffers.length,1);let h=c.context.buffers[0];d.check(h),p.check(h),_.check(h)}s.testByteOffsetBugFig5426=n;function o(){let l=AssertLib.deepStrictEqual,c=new a,d=c.add(It.getPositionF2(),8,0);l(d.area.byteOffset(),0);let u=c.add(It.getPositionF2(),8,1);l(u.area.byteOffset(),8);let p=c.add(It.getPositionF4CoordF4(),32,2);l(p.area.byteOffset(),32);let _=c.add(It.getPositionF4CoordF4(),32,3);l(_.area.byteOffset(),64),u.free(),p.free();let h=c.add(It.getPositionF2(),c.chunkSizeInBytes()-64,4);l(d.area.byteOffset(),0),l(_.area.byteOffset(),32),l(h.area.byteOffset(),64),l(c.pool.totalVRAM(),c.chunkSizeInBytes()),l(c.pool.usedVRAM(),c.chunkSizeInBytes()-64+40),l(c.context.buffers.length,1);let A=c.context.buffers[0];d.check(A),_.check(A),h.check(A)}s.testStrideBugFig5426=o;class i{free(){this.area.free(),this.area.wasFreed()}check(c){let d=c.bytesForUpload();if(d==null){return}for(let u=0,p=this.bytes.length;u<p;u=u+1)d[this.area.byteOffset()+u]==this.bytes[u]}constructor(c,d){this.bytes=c,this.area=d}}s.Result=i;class a{constructor(){this.context=new ll,this.pool=this.context.createVertexBufferPool()}add(c,d,u){let p=new Uint8Array(d);p[0]=u*2+1,p[p.length-1]=u*2+2;let _=this.pool.allocate(c,p);return _.byteCount()==d,_.wasFreed(),new i(p,_)}chunkSizeInBytes(){return this.pool.chunkSizeInBytes()}quarterChunkSizeInBytes(){return this.chunkSizeInBytes()/4}}s.Helper=a})(jP||(jP={}));function N2(t){return new Promise(e=>setTimeout(e,t))}async function P2(){window.gc(),await N2(100)}var Xp=class{constructor(e){this._scene=null,this._watchedNodeIDs=new Map,this.onChangeCallback=null,e.addAppObserver(this)}watchNodesWithIDs(e){this._watchedNodeIDs=new Map;for(let r of e)this._watchedNodeIDs.set(r,!0)}handleSceneChange(e,r){this._scene=r,e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this.onChangeCallback!=null&&this.onChangeCallback()}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}_isWatchedNode(e){return this._watchedNodeIDs.has(e)}_isAncestorOrSelfOfWatchedNode(e){for(let r of Array.from(this._watchedNodeIDs.keys())){let n=this._scene.findNode(r);for(let o=n;o!=null;o=o.parent())if(Q.equals(o.id(),e))return!0}return!1}handleSceneGraphEvent(e){let r=!1;if(e.property==32){let n=e.oldVal!=null&&ot.isParentIndex(e.oldVal)?ot.asParentIndex(e.oldVal):null,o=e.newVal!=null&&ot.isParentIndex(e.newVal)?ot.asParentIndex(e.newVal):null;(n==null||o==null||n.id!=o.id)&&(r=this._isAncestorOrSelfOfWatchedNode(e.node.id()))}else e.property==30?r=this._isAncestorOrSelfOfWatchedNode(e.node.id()):(e.property==57||e.property==98)&&(r=this._isWatchedNode(e.node.id()));r&&this.onChangeCallback!=null&&this.onChangeCallback()}};var pc=class t{toJSON(){let e={nodeId:this.nodeId};return this.nodeOffset!=null&&(e.nodeOffset={x:this.nodeOffset.x(),y:this.nodeOffset.y()}),this.canvasPosition!=null&&(e.canvasPosition={x:this.canvasPosition.x(),y:this.canvasPosition.y()}),e}static fromJSON(e){let r=null,n=null,o=null;return e.nodeId!==null&&e.nodeId!==void 0&&(r=Q.fromString(e.nodeId)),e.nodeOffset!==null&&e.nodeOffset!==void 0&&(n=new O(e.nodeOffset.x,e.nodeOffset.y)),e.canvasPosition!==null&&e.canvasPosition!==void 0&&(o=new O(e.canvasPosition.x,e.canvasPosition.y)),new t(r,n,o)}constructor(e,r,n){this.nodeId=e,this.nodeOffset=r,this.canvasPosition=n}},Zp=class{constructor(e){this._appState=null,this._boundsWatcher=null,this._shouldNotifyCommentPositionsChanged=!1,this._nodesWithComments=[],this.notifyCommentPositionsChange=null,this._appState=e,this._boundsWatcher=new Xp(e),this._boundsWatcher.onChangeCallback=()=>{this._shouldNotifyCommentPositionsChanged=!0},this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this)}setNodesWithComments(e){this._boundsWatcher.watchNodesWithIDs(e),this._nodesWithComments=e}onFrame(){this._shouldNotifyCommentPositionsChanged&&(this.notifyCommentPositionsChange!=null&&this.notifyCommentPositionsChange(),this._shouldNotifyCommentPositionsChanged=!1)}handleSceneChange(e,r){this._shouldNotifyCommentPositionsChanged=!0}handleActiveCanvasChange(e,r){this._shouldNotifyCommentPositionsChanged=!0}handleActivePrototypeStartingPointChange(e,r){}_isAncestorOrSelfOfNodeWithComment(e){let r=this._appState.scene();if(r==null)return!1;for(let n of this._nodesWithComments){let o=r.findNode(n);for(let i=o;i!=null;i=i.parent()){let a=i.id();if(Q.equals(a,e))return!0}}return!1}handleStateChangeAborted(e){this.handlePresentedStateChange(e)}handleStateChangeCommitted(e,r){this.handlePresentedStateChange(e)}handleStateChangeInitiated(e){this.handlePresentedStateChange(e)}handleStateChangeRequested(e){}handlePresentedStateChange(e){if(e==null||this._shouldNotifyCommentPositionsChanged)return;if(this._isAncestorOrSelfOfNodeWithComment(e.oldStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let r=e.oldStateAndOverlays.overlays;for(let o=0,i=r.length;o<i;o=o+1){let a=r[o].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}if(this._isAncestorOrSelfOfNodeWithComment(e.newStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let n=e.newStateAndOverlays.overlays;for(let o=0,i=n.length;o<i;o=o+1){let a=n[o].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}}handleFitModeChange(e,r){}handleRestartPrototype(){}getCommentDestinationAtPosition(e){let r=this._appState.scene();if(r==null)return null;let n=this._appState.baseScreenNode();if(n==null)return null;let o=this._appState.prototypeState().getCurrentOverlays();for(let a=o.length-1;a>=0;a=a-1){let s=r.findNode(o[a].id());if(s==null)continue;let l=o[a].renderedBounds(n);if(l.contains2(e)){let c=e.subtract(l.topLeft());return new pc(s.id(),c,null)}}let i=e.subtract(n.canvasSpaceBoundingBox().topLeft());return new pc(n.id(),i,null)}_currentCommentsScreen(){return this._appState.prototypeState().getTopmostScreen()}_currentCommentsScreenRenderedBounds(){let e=this._appState.baseScreenNode(),r=this._appState.prototypeState().getTopmostOverlay();return e!=null&&r!=null?r.renderedBounds(e):e==null?void 0:e.canvasSpaceBoundingBox()}getCanvasSpaceCommentLocations(e,r){let n={};for(let o of Array.from(r.keys())){let i=r.get(o),a=e.findNode(i.nodeId),s=this._currentCommentsScreen(),l=this._currentCommentsScreenRenderedBounds();if(a==null||s==null||l==null)continue;let c=!1;if(c=s.isAncestorOf(a),!c)continue;let d=a.canvasSpaceScrolledBounds(1).topLeft().subtract(s.canvasSpaceBoundingBox().topLeft()),p=l.topLeft().add(d).add(i.nodeOffset),_={};_.x=p.x(),_.y=p.y(),n[o]=_}return n}};var jf;(m=>{function t(g,S){let R=new jr("NONZERO",0,Bt.forCenterStrokeAroundRect(g,S),g);return new $r([R],null,R.bounds(),null)}m.strokeGeometryForRect=t;function e(g,S){if(Math.abs(N.redF(g)-N.redF(S))+Math.abs(N.greenF(g)-N.greenF(S))+Math.abs(N.blueF(g)-N.blueF(S))+Math.abs(N.alphaF(g)-N.alphaF(S))>.01)throw new Error(`Colors are too different ${N.toString(g)} ${N.toString(S)}`)}m.assertColorRoughlyEquals=e;function r(g,S,R){var P,T;let E=Sb(g);return E.setTestOnlyFillPaints([ee.createSolid(N.BLACK,R)]),E.setTestOnlyFillGeometry(Ib(S)),je(E,(P=E.fillGeometry())==null?void 0:P.bounds.topLeft(),(T=E.fillGeometry())==null?void 0:T.bounds.size()),E}m.createStaticVectorWithMultipleRegions=r;function n(g,S,R,E){g.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),A.GeometryType_hasFill(S)&&g.setTestOnlyFillGeometry(zi(R)),A.GeometryType_hasStroke(S)&&(g.setTestOnlyStrokeGeometry(t(R,E)),g.setStrokeWeight(E)),je(g,R.topLeft(),R.size())}m.addPaintsAndGeometry=n;function o(g,S,R,E){let P=Wn(g);return n(P,S,R,E),P}m.createRectangleWithPaintsAndGeometry1=o;function i(g,S,R){return o(g,S,R,1)}m.createRectangleWithPaintsAndGeometry2=i;function a(g,S,R,E,P){let T=Ab(g,S);return n(T,R,E,P),T}m.createRoundedRectangleWithPaintsAndGeometry1=a;function s(g,S,R,E){return a(g,S,R,E,1)}m.createRoundedRectangleWithPaintsAndGeometry2=s;function l(g,S,R,E,P,T,f,y,v,w){let I=new jr("NONZERO",0,vt.fromRect(R),R),C=new $r([I],null,I.bounds(),null),L=Qr(g,"RECTANGLE");return L.setTestOnlyFillGeometry(C),L.setTestOnlyFillPaints(E),L.setTestOnlyStrokeGeometry(C),L.setTestOnlyStrokePaints(P),L.setStrokeAlign(T),L.setStrokeWeight(10),L.setStrokeJoin("MITER"),L.setStrokeMiterLimit(4),L.setTestOnlyEffects([Pe.createDropShadow(f,y,v,w)]),L}m.createRoundedRectangleWithStrokeFillAndDropShadow=l;function c(g,S){let R=Wn(g);R.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]);let E=S.topLeft().x(),P=S.topLeft().y(),T=S.width(),f=S.height(),y=new jr("NONZERO",0,Bt.new2().moveTo1(E,P).lineTo(E+T,P).lineTo(E+T,P+f).lineTo(E,P+f-1).close(),S),v=new $r([y],null,y.bounds(),null);return R.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),R.setTestOnlyFillGeometry(v),R.setTestOnlyStrokeGeometry(v),je(R,S.topLeft(),S.size()),R}m.createNonRectangleInNode=c;function d(g,S,R){let E=g.canvasSpaceBoundingBox();switch(R){case"INSIDE":case"OUTSIDE":{g.setTestOnlyStrokeGeometry(t(E,S*2));break}case"CENTER":{g.setTestOnlyStrokeGeometry(t(E,S));break}}g.setStrokeAlign(R)}m.setStrokeForRect=d;function u(){let g=AssertLib.deepStrictEqual,S=new ec("./src/test/rendertree.test.ts");Ct("generateRenderTree",()=>{let R=ft.createSceneWithCanvasForTests1(),E=R.root().childAt1(0),P=()=>{R=ft.createSceneWithCanvasForTests1(),E=R.root().childAt1(0),E.setPrototypeDevice(Cn.DEFAULT)};beforeEach(P),he("simple rect",()=>{var f;let T=i(E,0,new x(0,0,100,100));return S.asyncAssertMatchesSnapshot("should emit single fill",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("simple rounded rect",()=>{var f;let T=s(E,10,0,new x(0,0,100,100));return S.asyncAssertMatchesSnapshot("should emit single rounded rect fill",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("rounded rect symbol",()=>{var f;let T=da(E);return n(T,0,new x(0,0,100,100),0),T.setIsFrameMaskDisabled(!0),T.setCornerRadius(10),S.asyncAssertMatchesSnapshot("symbol should emit rounded rect fill",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("rounded rect instance",()=>{var y;let T=da(E),f=Bs(E,T);return n(f,0,new x(0,0,100,100),0),f.setIsFrameMaskDisabled(!0),f.setCornerRadius(10),S.asyncAssertMatchesSnapshot("instance should emit rounded rect fill",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),tc("simple vector with multiple regions",()=>{var v,w;let T=[],f=r(E,[new x(0,0,10,10),new x(20,20,10,10)],.5);T.push(S.asyncAssertMatchesSnapshot("should emit single fill",((v=f.renderTree1())==null?void 0:v.debugString1())??""));let y=r(E,[new x(0,0,10,10),new x(5,5,10,10)],.5);return T.push(S.asyncAssertMatchesSnapshot("should emit multiple fills",((w=y.renderTree1())==null?void 0:w.debugString1())??"")),Promise.all(T)}),he("multiply blend mode",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setBlendMode("MULTIPLY"),S.asyncAssertMatchesSnapshot("should emit fill with blend mode",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("foreground blur",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyEffects([Pe.createForegroundBlur(4)]),S.asyncAssertMatchesSnapshot("should emit foreground blur",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("foreground blur w/ radius zero",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyEffects([Pe.createForegroundBlur(0)]),S.asyncAssertMatchesSnapshot("blur should be ellided",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("foreground blur disabled",()=>{var y;let T=i(E,0,new x(0,0,100,100)),f=Pe.createForegroundBlur(4);return f.setIsEnabled(!1),T.setTestOnlyEffects([f]),S.asyncAssertMatchesSnapshot("blur should be ellided",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("background blur",()=>{var y;i(E,0,new x(25,25,50,50)).setTestOnlyFillPaints([ee.createSolid(N.RED,1)]);let f=i(E,0,new x(0,0,100,100));return f.setTestOnlyEffects([Pe.createBackgroundBlur(4)]),S.asyncAssertMatchesSnapshot("blur should be ellided because rect with blur is opaque",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("background blur on partially transparent node",()=>{var v;let T=Object({viewer_background_blur_opts:!1});K.updateFeatureFlags(T),i(E,0,new x(25,25,50,50)).setTestOnlyFillPaints([ee.createSolid(N.RED,1)]);let y=i(E,0,new x(0,0,100,100));return y.setTestOnlyFillPaints([ee.createSolid(N.BLACK,.5)]),y.setTestOnlyEffects([Pe.createBackgroundBlur(4)]),S.asyncAssertMatchesSnapshot("background blur should be emitted",((v=y.renderTree1())==null?void 0:v.debugString1())??"")}),he("rectangle won't show up in the background blur",()=>{var w;let T=Object({viewer_background_blur_opts:!1});K.updateFeatureFlags(T),i(E,0,new x(0,0,10,10)).setTestOnlyFillPaints([ee.createSolid(N.RED,1)]);let y=dt(E);y.setTestOnlyFillPaints([ee.createSolid(N.BLACK,.5)]),je(y,new O(0,0),new O(10,10));let v=i(y,0,new x(0,0,10,10));return v.setTestOnlyFillPaints([ee.createSolid(N.GREEN,.5)]),v.setTestOnlyEffects([Pe.createBackgroundBlur(4)]),S.asyncAssertMatchesSnapshot("red rectangle should not show up in the background blur",((w=y.renderTree1())==null?void 0:w.debugString1())??"")}),Ct("noise effect",()=>{he("noise with size greater than 1",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createNoise("MONOTONE","NORMAL",new O(2.4,2.4),1,N.WHITE,N.BLACK,.25,123)]),S.asyncAssertMatchesSnapshot("noise should emitted",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("noise with size less than 1",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createNoise("MONOTONE","NORMAL",new O(.4,.4),1,N.WHITE,N.BLACK,.25,123)]),S.asyncAssertMatchesSnapshot("noise should be wrapped in SSAA group",((f=T.renderTree1())==null?void 0:f.debugString1())??"")})}),Ct("grain effect",()=>{he("grain with size greater than 1",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createGrain(new O(2.4,2.4),!0,1,123)]),S.asyncAssertMatchesSnapshot("grain should be emitted",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("grain with size less than 1",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createGrain(new O(.4,.4),!0,1,123)]),S.asyncAssertMatchesSnapshot("grain should be wrapped in SSAA group",((f=T.renderTree1())==null?void 0:f.debugString1())??"")})}),Ct("scrolling frames",()=>{he("wrap scrollable layers in a volatile property binding",()=>{var y;let T=dt(E);return T.setOverflowDirection("VERTICAL"),je(T,new O(0,0),new O(100,100)),i(T,0,new x(0,0,100,200)).setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),S.asyncAssertMatchesSnapshot("red fill should be in volatile property binding",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("wrap scrollable layers with non-isolated blends with a group",()=>{let T=dt(E);T.setOverflowDirection("VERTICAL"),je(T,new O(0,0),new O(100,100));let f=i(T,0,new x(0,0,100,200));f.setBlendMode("MULTIPLY"),f.setTestOnlyFillPaints([ee.createSolid(N.RED,1)]);let y=T.renderTree1();return S.asyncAssertMatchesSnapshot("red rectangle should be wrapped with a group",(y==null?void 0:y.debugString1())??"")}),tc("fixed layers and their descendants should be re-positioned",()=>{var w,I,C;let T=[];E.setPrototypeDevice(new Cn("CUSTOM",new O(100,100),"","NONE"));let f=dt(E);je(f,new O(0,0),new O(100,500));let y=dt(f);return y.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),y.setVerticalConstraint("MAX"),je(y,new O(0,400),new O(100,100)),i(y,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),T.push(S.asyncAssertMatchesSnapshot("Red square should NOT be culled because the screen is 100 x 500",((w=f.renderTree1())==null?void 0:w.debugString1())??"")),T.push(S.asyncAssertMatchesSnapshot("Red square should NOT be culled even though the screen is 100 x 100 because it is a fixed footer that was repositioned to be in in the screen",((I=f.renderTreeForBaseScreen1())==null?void 0:I.debugString1())??"")),y.setScrollBehavior("SCROLLS"),T.push(S.asyncAssertMatchesSnapshot("Red square SHOULD be culled because the screen is 100 x 100 and the footer is not fixed",((C=f.renderTreeForBaseScreen1())==null?void 0:C.debugString1())??"")),Promise.all(T)}),he("do not wrap fixed layers in a volatile property binding",()=>{var v;let T=dt(E);T.setOverflowDirection("VERTICAL"),je(T,new O(0,0),new O(100,100));let f=dt(T);return f.setTestOnlyFillPaints([ee.createSolid(N.GREEN,1)]),f.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),i(T,0,new x(0,50,100,150)).setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),S.asyncAssertMatchesSnapshot("red fill should be in volatile property binding; green fill should not",((v=T.renderTree1())==null?void 0:v.debugString1())??"")}),he("Background blur trees should not cull scrollable content",()=>{var w,I;let T=Object({viewer_background_blur_opts:!1});K.updateFeatureFlags(T);let f=dt(E);f.setOverflowDirection("VERTICAL"),je(f,new O(0,0),new O(100,100)),f.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]);let y=i(f,0,new x(0,150,100,100));je(y,new O(150,0),new O(100,101)),y.setTestOnlyFillPaints([ee.createSolid(N.GREEN,1)]);let v=i(f,0,new x(0,0,100,100));return v.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),je(v,new O(0,0),new O(100,100)),v.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]),v.setTestOnlyEffects([Pe.createBackgroundBlur(4)]),S.asyncAssertMatchesSnapshot("blur node should contain green fill",((I=(w=f==null?void 0:f.renderTree1())==null?void 0:w.optimized())==null?void 0:I.debugString1())??"")}),["FRAME","GROUP"].forEach(T=>{he(`Background blur inside ${T} in scrolling content should contain transformed scrolling siblings`,()=>{var C,L;let f=Object({viewer_background_blur_opts:!1});K.updateFeatureFlags(f);let y=dt(E);y.setOverflowDirection("VERTICAL"),je(y,new O(0,0),new O(100,100)),y.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]);let v=T=="FRAME"?dt(y):ca(y),w=i(v,0,new x(0,0,100,101));je(w,new O(0,0),new O(100,101)),w.setTestOnlyFillPaints([ee.createSolid(N.GREEN,1)]);let I=i(v,0,new x(0,0,100,100));return je(I,new O(0,0),new O(100,100)),I.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]),I.setTestOnlyEffects([Pe.createBackgroundBlur(4)]),je(v,new O(0,0),new O(100,101)),S.asyncAssertMatchesSnapshot("blur node should contain transformed green fill",((L=(C=y.renderTree1())==null?void 0:C.optimized())==null?void 0:L.debugString1())??"")})}),he("calling .renderTree on a frame should NOT make it scrollable by default",()=>{var y;E.setCurrentViewportSize(new O(100,50));let T=dt(E);return je(T,new O(0,0),new O(100,100)),i(T,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),S.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should NOT be present",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("calling .renderTreeForBaseScreen on a frame should make it scrollable by default",()=>{var y;E.setCurrentViewportSize(new O(100,50));let T=dt(E);return je(T,new O(0,0),new O(100,100)),i(T,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),S.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should be present",((y=T.renderTreeForBaseScreen1())==null?void 0:y.debugString1())??"")})}),he("drop shadow",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("drop shadow should be emitted",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("two drop shadows",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createDropShadow(0,new O(50,50),N.RED,1),Pe.createDropShadow(0,new O(-50,-50),N.GREEN,1)]),S.asyncAssertMatchesSnapshot("two drop shadows should be emitted",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("drop shadow on semi-transparent layer",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),T.setOpacity(.5),S.asyncAssertMatchesSnapshot("should be wrapped in blend with 0.5 opacity",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("drop shadow on clipping frame with visible background paints",()=>{var v;let T=dt(E);je(T,new O(-100,-100),new O(300,300));let f=dt(T);return je(f,new O(0,0),new O(200,200)),f.setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),i(f,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.GREEN,1)]),f.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("shadow tree does not contain rect fill",((v=f.renderTree1())==null?void 0:v.debugString1())??"")}),he("drop shadow on non-clipping frame with visible background paints",()=>{var v;let T=dt(E);je(T,new O(-100,-100),new O(300,300));let f=dt(T);return je(f,new O(0,0),new O(200,200)),f.setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),f.setIsFrameMaskDisabled(!0),i(f,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.GREEN,1)]),f.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill",((v=f.renderTree1())==null?void 0:v.debugString1())??"")}),he("drop shadow on clipping frame with no background paints",()=>{var v;let T=dt(E);je(T,new O(-100,-100),new O(300,300));let f=dt(T);return je(f,new O(0,0),new O(200,200)),f.setTestOnlyFillPaints([]),i(f,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.GREEN,1)]),f.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",((v=f.renderTree1())==null?void 0:v.debugString1())??"")}),he("drop shadow on clipping frame with no visible background paints",()=>{var v;let T=dt(E);je(T,new O(-100,-100),new O(300,300));let f=dt(T);return je(f,new O(0,0),new O(200,200)),f.setTestOnlyFillPaints([ee.createSolid(N.RED,0)]),i(f,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.GREEN,1)]),f.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",((v=f.renderTree1())==null?void 0:v.debugString1())??"")}),he("drop shadow on clipping frame with visible background paint with transparent area",()=>{var w;let T=ee.createLinearGradient([new ct(N.new3(0,0,0,1),0),new ct(N.new3(0,0,0,0),.5)]),f=dt(E);je(f,new O(-100,-100),new O(300,300));let y=dt(f);return je(y,new O(0,0),new O(200,200)),y.setTestOnlyFillPaints([T]),i(y,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.GREEN,1)]),y.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("shadow tree should contain frame background and rect",((w=y.renderTree1())==null?void 0:w.debugString1())??"")}),he("drop shadow on clipping frame with inside stroke",()=>{var y;let T=dt(E);je(T,new O(-100,-100),new O(300,300));let f=Gl(T,"frame",[ee.createSolid(N.RED,1)],[ee.createSolid(N.BLACK,1)],new x(0,0,50,50));return je(f,new O(0,0),new O(50,50)),f.setStrokeAlign("INSIDE"),f.setStrokeWeight(4),c(f,new x(0,0,100,100)),f.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("drop shadow should not be clipped by frame mask",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow on rounded rectangle clipping frame with inside stroke",()=>{var y;let T=dt(E);je(T,new O(-100,-100),new O(300,300));let f=Gl(T,"frame",[ee.createSolid(N.RED,1)],[ee.createSolid(N.WHITE,1)],new x(0,0,50,50));return je(f,new O(0,0),new O(50,50)),f.setStrokeAlign("INSIDE"),f.setStrokeWeight(4),f.setCornerRadius(10),f.setTestOnlyFillGeometry(Tb(f.canvasSpaceBoundingBox(),10)),f.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("drop shadow should be a rounded rect",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow and inner shadow on clipping frame with inside stroke",()=>{var y;let T=dt(E);je(T,new O(-100,-100),new O(300,300));let f=Gl(T,"frame",[ee.createSolid(N.RED,1)],[ee.createSolid(N.BLACK,1)],new x(0,0,50,50));return je(f,new O(0,0),new O(50,50)),f.setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),f.setStrokeAlign("INSIDE"),f.setTestOnlyStrokePaints([ee.createSolid(N.RED,1)]),f.setStrokeWeight(4),c(f,new x(0,0,100,100)),f.setTestOnlyEffects([Pe.createInnerShadow(4,new O(0,0),N.BLACK,.25),Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("inner shadow should be clipped by frame mask",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("spread shadow for eligible frame",()=>{var y;let T=dt(E);je(T,new O(0,0),new O(300,300));let f=Xo(T,"frame",ee.createSolid(N.RED,1));return je(f,new O(0,0),new O(50,50)),f.setTestOnlyEffects([Pe.createDropShadow(0,new O(0,0),N.BLACK,.25,10)]),S.asyncAssertMatchesSnapshot("should generate shadow with spread for eligible frame: max bounds",`${(y=f.renderTree1())==null?void 0:y.maxBounds}
`)}),he("no spread shadow for frame with no visible fill paints",()=>{var y;let T=Xo(E,"frame",ee.createSolid(N.RED,0));return je(T,new O(0,0),new O(50,50)),i(T,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createDropShadow(0,new O(0,0),N.BLACK,.25,10)]),S.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no visible fill: max bounds",`${(y=T.renderTree1())==null?void 0:y.maxBounds}
`)}),he("no spread shadow for frame that does not clip",()=>{var y;let T=dt(E);je(T,new O(0,0),new O(300,300));let f=Xo(T,"frame",ee.createSolid(N.RED,1));return je(f,new O(0,0),new O(50,50)),f.setIsFrameMaskDisabled(!0),f.setTestOnlyEffects([Pe.createDropShadow(0,new O(0,0),N.BLACK,.25,10)]),S.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no clipping: max bounds",`${(y=f.renderTree1())==null?void 0:y.maxBounds}
`)}),he("drop shadow with knockout: translucent node",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]),T.setTestOnlyEffects([Pe.createDropShadow(10,new O(10,0),N.BLACK,.25,5,!1)]),S.asyncAssertMatchesSnapshot("should generate knockout shadow for regular translucent node",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("drop shadow with knockout: opaque node",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),T.setTestOnlyEffects([Pe.createDropShadow(10,new O(10,0),N.BLACK,.25,5,!1)]),S.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque node",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("drop shadow with knockout: opaque frame",()=>{var y;let T=dt(E);je(T,new O(-100,-100),new O(300,300));let f=Xo(T,"frame",ee.createSolid(N.RED,1));return je(f,new O(0,0),new O(50,50)),f.setIsFrameMaskDisabled(!0),f.setTestOnlyEffects([Pe.createDropShadow(10,new O(10,0),N.BLACK,.25,20,!1)]),S.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque frame",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow with knockout: node with gradient transparency",()=>{var y;let T=i(E,0,new x(0,0,100,100)),f=ee.createLinearGradient([new ct(N.new3(0,0,0,1),0),new ct(N.new3(0,0,0,0),.3),new ct(N.new3(0,0,0,0),.7),new ct(N.new3(0,0,0,1),.7)]);return T.setTestOnlyFillPaints([f]),T.setTestOnlyEffects([Pe.createDropShadow(10,new O(10,0),N.BLACK,.25,5,!1)]),S.asyncAssertMatchesSnapshot("should knockout gradient with transparency",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow with knockout: with effect blend mode",()=>{var y;let T=i(E,0,new x(0,0,100,100));T.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]);let f=Pe.createDropShadow(0,new O(10,0),N.BLACK,.25,5,!1);return f.setBlendMode("DIFFERENCE"),T.setTestOnlyEffects([f]),S.asyncAssertMatchesSnapshot("should generate blend for knockout shadow",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("drop shadow with knockout: with an inner shadow",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]),T.setTestOnlyEffects([Pe.createDropShadow(10,new O(10,0),N.BLACK,.25,5,!1),Pe.createInnerShadow(4,new O(5,5),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("should generate knockout shadow and inner shadow",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("drop shadow with knockout: with fill/stroke blend modes",()=>{var v;let T=i(E,0,new x(0,0,100,100)),f=ee.createSolid(N.RED,.5);f.setBlendMode("HARD_LIGHT"),T.setTestOnlyFillPaints([f]);let y=ee.createSolid(N.BLUE,.5);return y.setBlendMode("SOFT_LIGHT"),T.setTestOnlyStrokePaints([y]),T.setStrokeWeight(5),T.setStrokeAlign("OUTSIDE"),T.setTestOnlyEffects([Pe.createDropShadow(10,new O(10,0),N.BLACK,.25,5,!1)]),S.asyncAssertMatchesSnapshot("should generate fills/strokes with effects correctly (should not nest blends into knockout shadow mask alpha)",((v=T.renderTree1())==null?void 0:v.debugString1())??"")}),he("drop shadow with knockout: with clip to shape grain effect",()=>{var f;P();let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]),T.setTestOnlyEffects([Pe.createGrain(new O(2,2),!0,100,123),Pe.createDropShadow(137,new O(10,0),N.BLACK,1,0,!1)]),S.asyncAssertMatchesSnapshot("knockout shadow mask should wrap the grain node",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("with fill/stroke blend modes (fast stroke optimization)",()=>{var w;let T=Object({viewer_fast_stroke_shadow:!0});K.updateFeatureFlags(T);let f=i(E,1,new x(0,0,100,100)),y=ee.createSolid(N.RED,.5);y.setBlendMode("HARD_LIGHT"),f.setTestOnlyFillPaints([y]);let v=ee.createSolid(N.BLACK,1);return v.setBlendMode("SOFT_LIGHT"),f.setTestOnlyStrokePaints([v]),f.setStrokeAlign("OUTSIDE"),f.setStrokeJoin("MITER"),f.setStrokeMiterLimit(4),f.setTestOnlyEffects([Pe.createDropShadow(10,new O(10,0),N.BLACK,.25,5,!1)]),S.asyncAssertMatchesSnapshot("should generate strokes with a combined rendertree.",((w=f.renderTree1())==null?void 0:w.debugString1())??"")}),he("drop shadow with knockout: should not render knockout shadow inside bg blur",()=>{var v;let T=Object({viewer_background_blur_opts:!1});K.updateFeatureFlags(T);let f=Xo(E,"frame",ee.createSolid(N.RED,1));je(f,new O(0,0),new O(50,50));let y=i(E,0,new x(0,0,100,100));return y.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]),y.setTestOnlyEffects([Pe.createDropShadow(10,new O(10,0),N.BLACK,.25,5,!1),Pe.createBackgroundBlur(10)]),S.asyncAssertMatchesSnapshot("should not render knockout shadow inside bg blur",((v=y.renderTree1())==null?void 0:v.debugString1())??"")}),he("drop shadow with knockout: with drop shadow that does not overlap node at all",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]),T.setTestOnlyEffects([Pe.createDropShadow(10,new O(200,0),N.BLACK,.25,5,!1)]),S.asyncAssertMatchesSnapshot("should optimize but not cull knockout shadow that does not overlap node",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("drop shadow with knockout: transparent frame with stroke should have no shadows inside",()=>{var y;let T=dt(E);je(T,new O(-100,-100),new O(300,300));let f=Gl(T,"frame",[ee.createSolid(N.RED,0)],[ee.createSolid(N.BLACK,1)],new x(0,0,50,50));return je(f,new O(0,0),new O(50,50)),f.setTestOnlyEffects([Pe.createDropShadow(10,new O(10,0),N.BLACK,1,5,!1)]),S.asyncAssertMatchesSnapshot("should generate knockout shadow for transparent node",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("inner shadow",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createInnerShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("should output inner shadow",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("two inner shadows",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createInnerShadow(0,new O(50,50),N.RED,1),Pe.createInnerShadow(0,new O(-50,-50),N.GREEN,1)]),S.asyncAssertMatchesSnapshot("should output two inner shadows",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("inner shadow w/ zero blur radius",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyEffects([Pe.createInnerShadow(0,new O(0,4),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("should NOT output inner shadow",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("inner shadow, with outside stroke (mask.alpha HARD_MASK_WITH_COLOR inlines into shader)",()=>{var f;let T=i(E,1,new x(0,0,100,100));return T.setStrokeAlign("OUTSIDE"),T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyStrokePaints([ee.createSolid(N.WHITE,1)]),T.setTestOnlyEffects([Pe.createInnerShadow(1,new O(0,4),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("should have mask without hard mask alpha",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("semi-transparent rect",()=>{var f;let T=i(E,0,new x(0,0,100,100));return T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,.5)]),T.setOpacity(.5),S.asyncAssertMatchesSnapshot("opacity should be baked into fill paint",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("simple rect with stroke",()=>{var f;let T=i(E,1,new x(0,0,100,100));return T.setStrokeAlign("INSIDE"),T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),T.setTestOnlyStrokePaints([ee.createSolid(N.WHITE,1)]),S.asyncAssertMatchesSnapshot("should output FillStroke",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("rect with stroke and disabled fill should NOT render fill",()=>{var y;let T=i(E,1,new x(0,0,100,100));T.setStrokeAlign("INSIDE");let f=ee.createSolid(N.BLACK,1);return f.setIsEnabled(!1),T.setTestOnlyFillPaints([f]),T.setTestOnlyStrokePaints([ee.createSolid(N.WHITE,1)]),S.asyncAssertMatchesSnapshot("FILL_STROKE should NOT have black fill",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("background blur with no background",()=>{var y;let T=Object({viewer_background_blur_opts:!0});K.updateFeatureFlags(T);let f=Xo(E,"frame",ee.createSolid(N.RED,.5));return je(f,new O(0,0),new O(100,100)),f.setTestOnlyEffects([Pe.createBackgroundBlur(10)]),S.asyncAssertMatchesSnapshot("should not generate a background blur subtree",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("background blur with no scrolling elements",()=>{var v;let T=Object({viewer_background_blur_opts:!0});K.updateFeatureFlags(T);let f=Xo(E,"frame",ee.createSolid(N.RED,1));je(f,new O(0,0),new O(100,100));let y=i(E,0,new x(0,0,50,50));return y.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]),y.setTestOnlyEffects([Pe.createBackgroundBlur(10)]),S.asyncAssertMatchesSnapshot("should not include an INVERSE_TRANSFORM node",((v=y.renderTree1())==null?void 0:v.debugString1())??"")}),he("background blur with scroll: foreground and background in clipping frame",()=>{var w;let T=Object({viewer_background_blur_opts:!0});K.updateFeatureFlags(T);let f=Xo(E,"frame",ee.createSolid(N.RED,1));je(f,new O(0,0),new O(100,100)),f.setOverflowDirection("VERTICAL");let y=Xo(f,"container",ee.createSolid(N.WHITE,1));je(y,new O(0,0),new O(100,500));let v=i(y,0,new x(0,0,50,50));return v.setTestOnlyFillPaints([ee.createSolid(N.RED,.5)]),v.setTestOnlyEffects([Pe.createBackgroundBlur(10)]),S.asyncAssertMatchesSnapshot("background blur should not include INVERSE_TRANSFORM or scrolling TRANSFORM nodes",((w=v.renderTree1())==null?void 0:w.debugString1())??"")}),Ct("simple stroke-only rect",()=>{let T;beforeEach(()=>{P(),T=i(E,1,new x(0,0,100,100)),T.setTestOnlyFillPaints(Se.EMPTY),T.setTestOnlyStrokePaints([ee.createSolid(N.WHITE,1)])}),he("inside stroke",()=>{var f;return d(T,1,"INSIDE"),S.asyncAssertMatchesSnapshot("should output FillStroke with mode .INSIDE",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("outside stroke",()=>{var f;return d(T,1,"OUTSIDE"),S.asyncAssertMatchesSnapshot("should output FillStroke with mode .OUTSIDE",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("center stroke",()=>{var f;return d(T,1,"CENTER"),S.asyncAssertMatchesSnapshot("should output FillStroke with mode .CENTER",((f=T.renderTree1())==null?void 0:f.debugString1())??"")})}),Ct("drop shadow with stroke, no spread",()=>{let T;he("strokeAlign = CENTER, drop shadow",()=>{var y;let f=Object({viewer_fast_stroke_shadow:!0});return K.updateFeatureFlags(f),P(),T=l(E,0,new x(0,0,100,100),[ee.createSolid(N.BLACK,1)],[ee.createSolid(N.WHITE,1)],"CENTER",4,new O(0,0),N.BLACK,.25),S.asyncAssertMatchesSnapshot("Should output one BLUR and three FILLS",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("strokeAlign = INSIDE, drop shadow",()=>{var y;let f=Object({viewer_fast_stroke_shadow:!0});return K.updateFeatureFlags(f),P(),T=l(E,0,new x(0,0,100,100),[ee.createSolid(N.BLACK,1)],[ee.createSolid(N.WHITE,1)],"INSIDE",4,new O(0,0),N.BLACK,.25),S.asyncAssertMatchesSnapshot("Should output one BLUR, two FILLS and one FILL_STROKE",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("strokeAlign = OUTSIDE, drop shadow",()=>{var y;let f=Object({viewer_fast_stroke_shadow:!0});return K.updateFeatureFlags(f),P(),T=l(E,0,new x(0,0,100,100),[ee.createSolid(N.BLACK,1)],[ee.createSolid(N.WHITE,1)],"OUTSIDE",4,new O(0,0),N.BLACK,.25),S.asyncAssertMatchesSnapshot("Should output one BLUR, TWO FILLS, and one FILL_STROKE",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("simulated image border, corner radius > 0",()=>{var w;let f=Object({viewer_fast_stroke_shadow:!0});K.updateFeatureFlags(f),P(),T=s(E,20,1,new x(0,0,100,100));let y=ee.createSolid(N.WHITE,1);T.setTestOnlyFillPaints([y]);let v=ee.createSolid(N.WHITE,1);return T.setTestOnlyStrokePaints([v]),T.setStrokeAlign("OUTSIDE"),T.setTestOnlyEffects([Pe.createDropShadow(6,new O(0,2),N.BLACK,.1,0,!1),Pe.createDropShadow(6,new O(0,0),N.BLACK,.08,0,!1),Pe.createDropShadow(6,new O(0,0),N.BLACK,.2,0,!1)]),T.setStrokeJoin("MITER"),T.setStrokeMiterLimit(4),S.asyncAssertMatchesSnapshot("should output three BLURs with FILLs, a FILL, and a FILL_STROKE.",((w=T.renderTree1())==null?void 0:w.debugString1())??"")})}),Ct("Simple tests on non-rects",()=>{he("simple non-rectangle",()=>{var f;let T=c(E,new x(0,0,100,100));return S.asyncAssertMatchesSnapshot("should be single fill without isRect flag",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("non-rectangle not clipped by frame",()=>{var f;let T=dt(E);return je(T,new O(0,0),new O(100,100)),T.setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),c(T,new x(0,0,99,99)),S.asyncAssertMatchesSnapshot("group with two fills (frame background and non-rect layer)",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("non-rectangle clipped by frame",()=>{var f;let T=dt(E);return je(T,new O(0,0),new O(50,50)),T.setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),c(T,new x(0,0,100,100)),S.asyncAssertMatchesSnapshot("clipping should not be optimized",((f=T.renderTree1())==null?void 0:f.debugString1())??"")})}),he("grouped single node",()=>{var y;let T=ca(E);Gs(T,!1),je(T,new O(0,0),new O(100,100));let f=i(T,0,new x(0,0,100,100));return f.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),S.asyncAssertMatchesSnapshot("group should be ellided since it does not affect rendering",((y=f.renderTree1())==null?void 0:y.debugString1())??"")}),he("nested groups",()=>{var I;let T=ca(E);Gs(T,!1),je(T,new O(0,0),new O(100,100));let f=ca(T);Gs(f,!1),je(f,new O(0,0),new O(50,50)),i(f,0,new x(0,0,50,50)).setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]);let v=ca(T);return Gs(v,!1),je(v,new O(50,50),new O(50,50)),i(v,0,new x(0,0,50,50)).setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),S.asyncAssertMatchesSnapshot("render tree should contain only 1 group since groups do not affect rendering",((I=T.renderTree1())==null?void 0:I.debugString1())??"")}),he("flatten nested opacities",()=>{var I;let T=ca(E);je(T,new O(0,0),new O(100,100)),T.setOpacity(.8);let f=ca(T);je(f,new O(0,0),new O(50,50)),f.setOpacity(.5);let y=i(f,0,new x(0,0,50,50));y.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),y.setOpacity(.5);let v=ca(T);je(v,new O(50,50),new O(50,50)),v.setOpacity(.25);let w=i(v,0,new x(0,0,50,50));return w.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]),w.setOpacity(.1),S.asyncAssertMatchesSnapshot("opacities for ellided groups should be applied to leaves",((I=T.renderTree1())==null?void 0:I.debugString1())??"")}),Ct("node outside bounds of frame",()=>{let T;beforeEach(()=>{P(),T=dt(E),T.setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),je(T,new O(0,0),new O(100,100)),i(T,0,new x(110,110,100,100)).setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)])}),he("without frame clipping",()=>{var f;return T.setIsFrameMaskDisabled(!0),S.asyncAssertMatchesSnapshot("there should be two fills; one for the non-clipped rect",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("with frame clipping",()=>{var f;return T.setIsFrameMaskDisabled(!1),S.asyncAssertMatchesSnapshot("there should be on fill; rect was clipped",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),Ee("with frame clipping and no background color",()=>{T.setIsFrameMaskDisabled(!1),Gs(T,!1),g(T.renderTree1(),null)})}),Ct("frame background",()=>{let T;beforeEach(()=>{P(),T=dt(E),T.setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),Gs(T,!0),je(T,new O(0,0),new O(100,100))}),he("with solid paint",()=>{var f;return T.setTestOnlyFillPaints([ee.createSolid(N.new3(1,.5,0,1),1)]),S.asyncAssertMatchesSnapshot("frame background fill should be present",((f=E.renderTree1())==null?void 0:f.debugString1())??"")}),he("with solid paint and blend mode",()=>{var y;let f=ee.createSolid(N.new3(1,.5,0,1),1);return f.setBlendMode("MULTIPLY"),T.setTestOnlyFillPaints([f]),S.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",((y=E.renderTree1())==null?void 0:y.debugString1())??"")}),he("with solid paint and blended gradient",()=>{var v;let f=ee.createSolid(N.new3(1,.5,0,1),1),y=ee.createLinearGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);return y.setBlendMode("MULTIPLY"),T.setTestOnlyFillPaints([f,y]),S.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",((v=E.renderTree1())==null?void 0:v.debugString1())??"")}),he("with solid paint and blend mode and children",()=>{var v;let f=ee.createSolid(N.new3(1,.5,0,1),1);return f.setBlendMode("MULTIPLY"),T.setTestOnlyFillPaints([f]),i(T,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.BLACK,.5)]),S.asyncAssertMatchesSnapshot("should output background and children",((v=E.renderTree1())==null?void 0:v.debugString1())??"")}),he("with drop shadow and opaque fill",()=>{var f;return T.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("should not output a drop shadow",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("with drop shadow and no opaque fill",()=>{var f;return T.setTestOnlyFillPaints([ee.createSolid(N.WHITE,.5)]),T.setTestOnlyEffects([Pe.createDropShadow(4,new O(0,0),N.BLACK,.25)]),S.asyncAssertMatchesSnapshot("should output a drop shadow",((f=T.renderTree1())==null?void 0:f.debugString1())??"")})}),Ct("frame fills for containers supporting fill stroke and corners",()=>{let T;beforeEach(()=>{P(),T=dt(E),T.setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),je(T,new O(0,0),new O(100,100))}),he("with solid paint",()=>{var f;return T.setTestOnlyFillPaints([ee.createSolid(N.new3(1,.5,0,1),1)]),S.asyncAssertMatchesSnapshot("frame background fill should be present",((f=E.renderTree1())==null?void 0:f.debugString1())??"")}),he("with solid paint and blend mode",()=>{var y;let f=ee.createSolid(N.new3(1,.5,0,1),1);return f.setBlendMode("MULTIPLY"),T.setTestOnlyFillPaints([f]),S.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",((y=E.renderTree1())==null?void 0:y.debugString1())??"")}),he("with solid paint and blended gradient",()=>{var v;let f=ee.createSolid(N.new3(1,.5,0,1),1),y=ee.createLinearGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);return y.setBlendMode("MULTIPLY"),T.setTestOnlyFillPaints([f,y]),S.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",((v=E.renderTree1())==null?void 0:v.debugString1())??"")}),he("with solid paint and blend mode and children",()=>{var v;let f=ee.createSolid(N.new3(1,.5,0,1),1);return f.setBlendMode("MULTIPLY"),T.setTestOnlyFillPaints([f]),i(T,0,new x(0,0,100,100)).setTestOnlyFillPaints([ee.createSolid(N.BLACK,.5)]),S.asyncAssertMatchesSnapshot("should output background and children",((v=E.renderTree1())==null?void 0:v.debugString1())??"")}),he("with inside stroke",()=>{var y;let f=Gl(E,"frame",[ee.createSolid(N.RED,1)],[ee.createSolid(N.BLACK,1)],new x(0,0,50,50));return je(f,new O(0,0),new O(50,50)),f.setStrokeAlign("INSIDE"),f.setStrokeWeight(4),c(f,new x(0,0,100,100)),S.asyncAssertMatchesSnapshot("should generate a fill render node that is clipped by the frame mask",((y=E.renderTree1())==null?void 0:y.debugString1())??"")}),he("with outside stroke",()=>{var y;let f=Gl(E,"frame",[ee.createSolid(N.RED,1)],[ee.createSolid(N.BLACK,1)],new x(0,0,50,50));return je(f,new O(0,0),new O(50,50)),je(f,new O(0,0),new O(50,50)),f.setStrokeAlign("OUTSIDE"),f.setStrokeWeight(4),c(f,new x(0,0,100,100)),S.asyncAssertMatchesSnapshot("should have stroke on top of mask",((y=E.renderTree1())==null?void 0:y.debugString1())??"")})}),Ct("masks",()=>{he("blend mode of masked content should mark mask and all ancestors as 'hasBlends'",()=>{var v;let T=dt(E);return T.setIsBackgroundEnabled(!1),T.setIsFrameMaskDisabled(!0),i(T,0,new x(0,0,10,10)).setIsMask(!0),i(T,0,new x(0,0,100,100)).setBlendMode("MULTIPLY"),S.asyncAssertMatchesSnapshot("all ancestors of rect should have 'hasBlends' flag",((v=E.renderTree1())==null?void 0:v.debugString1())??"")}),he("small outside strokes should be masked",()=>{var v,w;let T=dt(E);T.setIsBackgroundEnabled(!1),T.setIsFrameMaskDisabled(!0),i(T,0,new x(0,0,100,100)).setIsMask(!0);let y=o(T,1,new x(0,0,100,100),2);return y.setStrokeAlign("OUTSIDE"),y.setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),y.setTestOnlyStrokePaints([ee.createSolid(N.BLACK,1)]),S.asyncAssertMatchesSnapshot("optimized RenderTree should mask rect with outside stroke",((w=(v=E.renderTree1())==null?void 0:v.optimized())==null?void 0:w.debugString1())??"")}),he("mask should be ignored if color is contained within the alpha",()=>{var v,w;let T=dt(E);return T.setIsBackgroundEnabled(!1),T.setIsFrameMaskDisabled(!0),s(T,50,0,new x(0,0,100,100)).setIsMask(!0),s(T,10,0,new x(40,40,20,20)).setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),S.asyncAssertMatchesSnapshot("optimized RenderTree should ignore mask as contained",((w=(v=E.renderTree1())==null?void 0:v.optimized())==null?void 0:w.debugString1())??"")}),he("mask should not ignored if color is not contained within the alpha",()=>{var v,w;let T=dt(E);return T.setIsBackgroundEnabled(!1),T.setIsFrameMaskDisabled(!0),s(T,50,0,new x(0,0,100,100)).setIsMask(!0),s(T,32,0,new x(12,12,76,76)).setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),S.asyncAssertMatchesSnapshot("optimized RenderTree should have a mask if alpha does not contain color",((w=(v=E.renderTree1())==null?void 0:v.optimized())==null?void 0:w.debugString1())??"")}),he("mask should be ignored if color contained within the a rounded rectangular alpha",()=>{var v,w;let T=dt(E);return T.setIsBackgroundEnabled(!1),T.setIsFrameMaskDisabled(!0),s(T,27,0,new x(0,0,100,100)).setIsMask(!0),s(T,32,0,new x(12,12,76,76)).setTestOnlyFillPaints([ee.createSolid(N.WHITE,1)]),S.asyncAssertMatchesSnapshot("optimized RenderTree should not contain a mask if color is contained within a rounded rectangular alpha",((w=(v=E.renderTree1())==null?void 0:v.optimized())==null?void 0:w.debugString1())??"")})}),Ct("rectangle visibility",()=>{let T;beforeEach(()=>{P(),T=i(E,0,new x(0,0,100,100)),T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)])}),he("default visible",()=>{var f;return S.asyncAssertMatchesSnapshot("should output single fill",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),Ee("visibility false",()=>{T.setVisible(!1),g(T.renderTree1(),null)}),Ee("layer opacity zero",()=>{T.setOpacity(0),g(T.renderTree1(),null)}),Ee("fill paint opacity zero",()=>{T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,0)]),g(T.renderTree1(),null)}),Ee("no paints",()=>{T.setTestOnlyFillPaints(Se.EMPTY),g(T.renderTree1(),null)}),Ee("no fill paint, stroke paints, zero stroke width",()=>{let y=o(E,1,new x(0,0,100,100),0);y.setTestOnlyFillPaints(Se.EMPTY),y.setTestOnlyStrokePaints([ee.createSolid(N.TRANSPARENT,0)]),g(y.renderTree1(),null)})}),Ct("solid paints",()=>{let T;beforeEach(()=>{P(),T=i(E,0,new x(0,0,100,100))}),he("normal",()=>{var f;return T.setTestOnlyFillPaints([ee.createSolid(N.new3(1,.5,0,1),1)]),S.asyncAssertMatchesSnapshot("should output fill with opacity=1",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("50% opacity",()=>{var f;return T.setTestOnlyFillPaints([ee.createSolid(N.new3(1,.5,0,1),.5)]),S.asyncAssertMatchesSnapshot("should output fill with opacity=0.5",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),Ee("0% opacity",()=>{T.setTestOnlyFillPaints([ee.createSolid(N.new3(1,.5,0,1),0)]),g(T.renderTree1(),null)}),Ee("disabled",()=>{let f=ee.createSolid(N.new3(1,.5,0,1),1);f.setIsEnabled(!1),T.setTestOnlyFillPaints([f]),g(T.renderTree1(),null)}),he("multiply blend",()=>{var y;let f=ee.createSolid(N.new3(1,.5,0,1),1);return f.setBlendMode("MULTIPLY"),T.setTestOnlyFillPaints([f]),S.asyncAssertMatchesSnapshot("should output Blend with Fill child",((y=T.renderTree1())==null?void 0:y.debugString1())??"")})}),Ct("gradient paints",()=>{let T;beforeEach(()=>{P(),T=i(E,0,new x(0,0,100,100))}),he("linear",()=>{var y;let f=ee.createLinearGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);return T.setTestOnlyFillPaints([f]),S.asyncAssertMatchesSnapshot("should output Fill with linear gradient paint",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("radial",()=>{var y;let f=ee.createRadialGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);return T.setTestOnlyFillPaints([f]),S.asyncAssertMatchesSnapshot("should output Fill with radial gradient paint",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("angular",()=>{var y;let f=ee.createAngularGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);return T.setTestOnlyFillPaints([f]),S.asyncAssertMatchesSnapshot("should output Fill with angular gradient paint",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("diamond",()=>{var y;let f=ee.createDiamondGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);return T.setTestOnlyFillPaints([f]),S.asyncAssertMatchesSnapshot("should output Fill with diamond gradient paint",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),he("50% opacity",()=>{var y;let f=ee.createLinearGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);return f.setOpacity(.5),T.setTestOnlyFillPaints([f]),S.asyncAssertMatchesSnapshot("should output linear gradient with 50% opacity",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),Ee("0% opacity",()=>{let f=ee.createLinearGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);f.setOpacity(0),T.setTestOnlyFillPaints([f]),g(T.renderTree1(),null)}),Ee("disabled",()=>{let f=ee.createLinearGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);f.setIsEnabled(!1),T.setTestOnlyFillPaints([f]),g(T.renderTree1(),null)}),he("40% stop opacity",()=>{var y;let f=ee.createLinearGradient([new ct(N.new3(1,.5,0,.4),.25),new ct(N.new3(0,.5,1,.6),.75)]);return T.setTestOnlyFillPaints([f]),S.asyncAssertMatchesSnapshot("should output linear gradient with partial opacity stops",((y=T.renderTree1())==null?void 0:y.debugString1())??"")}),Ee("0% stop opacity",()=>{let f=ee.createLinearGradient([new ct(N.new3(1,.5,0,0),.25),new ct(N.new3(0,.5,1,0),.75)]);T.setTestOnlyFillPaints([f]),g(T.renderTree1(),null)}),he("transform",()=>{var I;let f=ee.createLinearGradient([new ct(N.new3(1,.5,0,1),.25),new ct(N.new3(0,.5,1,1),.75)]);f.setTransform1(new X(.5,-.5,1,-1,1.5,-1.5)),T.setTestOnlyFillPaints([f]);let y=T.renderTree1();g(y==null?void 0:y.op(),3);let w=y.geometry.paints;return g(w,T.fillPaints()),S.asyncAssertMatchesSnapshot("should output linear gradient",((I=T.renderTree1())==null?void 0:I.debugString1())??"")})}),he("geometry",()=>{var C;let T=Qr(E,"VECTOR");T.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]);let f=new x(0,0,100,100),y=new jr("ODD",0,Bt.new2().moveTo1(0,0).lineTo(100,0).lineTo(50,100).close(),f),v=new jr("NONZERO",0,Bt.new2().moveTo1(0,100).lineTo(100,100).lineTo(50,0).close(),f);T.setTestOnlyFillGeometry(new $r([y,v],null,f,null));let w=T.renderTree1();g(w==null?void 0:w.op(),1);let I=w;return g(I.children.length,2),g(I.children[0].op(),3),g(I.children[1].op(),3),g(I.children[0].geometry.path().windingRule(),"ODD"),g(I.children[1].geometry.path().windingRule(),"NONZERO"),S.asyncAssertMatchesSnapshot("should output a group with two fills",((C=T.renderTree1())==null?void 0:C.debugString1())??"")})}),Ct("RenderTree optimization of PaintData",()=>{Ee("dual-color gradient",()=>{let R=[ee.createLinearGradient([new ct(N.new3(0,.5,1,1),0),new ct(N.new3(1,.5,0,1),1)])],E=Se.optimize(R);g(E.length,1),g(E[0].type(),"GRADIENT_LINEAR")}),Ee("dual-opacity gradient",()=>{let R=[ee.createLinearGradient([new ct(N.new3(1,.5,0,0),0),new ct(N.new3(1,.5,0,1),1)])],E=Se.optimize(R);g(E.length,1),g(E[0].type(),"GRADIENT_LINEAR")}),Ee("single-color gradient",()=>{let R=[ee.createLinearGradient([new ct(N.new3(1,.5,0,1),0),new ct(N.new3(1,.5,0,1),1)])],E=Se.optimize(R);g(E.length,1),g(E[0].type(),"SOLID")}),Ee("solid underneath dual-color gradient",()=>{let R=[ee.createSolid(N.GREEN,1),ee.createLinearGradient([new ct(N.new3(0,0,1,.5),0),new ct(N.new3(1,0,0,.5),1)])],E=Se.optimize(R);g(E.length,1),g(E[0].type(),"GRADIENT_LINEAR"),E[0].asSinglePaint()!=null;let P=E[0].asSinglePaint().colorStops()[0],T=E[0].asSinglePaint().colorStops()[1];g(P.position,0),e(P.color,N.new3(0,.5,.5,1)),g(T.position,1),e(T.color,N.new3(.5,.5,0,1))}),Ee("solid underneath single-color gradient",()=>{let R=[ee.createSolid(N.GREEN,1),ee.createLinearGradient([new ct(N.new3(1,0,0,.5),0),new ct(N.new3(1,0,0,.5),1)])],E=Se.optimize(R);g(E.length,1),g(E[0].type(),"SOLID"),e(E[0].asSinglePaint().color(),N.new3(.5,.5,0,1))})}),Ct("RenderTree.isRect",()=>{let R=P=>{g(new Nt(P,"ODD").isRect(),!0)},E=P=>{g(new Nt(P,"ODD").isRect(),!1)};Ee("RenderTree.isRect",()=>{var y;R(Bt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5)),R(Bt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0)),R(Bt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),R(Bt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).close()),R(Bt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),E(Bt.new2().moveTo1(10,0).lineTo(10,5).lineTo(0,5)),E(Bt.new2().moveTo1(10,0).lineTo(0,0).lineTo(10,5).lineTo(0,5).close()),E(Bt.new2().quadraticTo(10,0,10,5).lineTo(0,5)),E(Bt.new2().lineTo(10,0).quadraticTo(10,5,0,5)),E(Bt.new2().cubicTo1(10,0,10,5,0,5));let T=ft.createSceneWithCanvasForTests1().root().childAt1(0),f=i(T,0,new x(0,0,100,100));g(f.renderTree1()!=null,!0),g((y=f.renderTree1())==null?void 0:y.isRectFill(),!0)})}),Ct("RenderTree optimization of Group nodes",()=>{let R;beforeEach(()=>{let E=new Gt(new Nt(vt.fromRect(new x(0,0,1,1)),"ODD"),[ee.createSolid(N.BLACK,1)]);R=new Tr(X.new2(),E,O.new())}),Ee("empty group",()=>{g(new Ue([]).optimized(),null)}),Ee("empty nested group",()=>{g(new Ue([new Ue([])]).optimized(),null)}),he("single group",()=>{var E;return S.asyncAssertMatchesSnapshot("should be fill only; no groups",((E=new Ue([R]).optimized())==null?void 0:E.debugString1())??"")}),he("single nested group",()=>{var E;return S.asyncAssertMatchesSnapshot("should be fill only; no groups",((E=new Ue([new Ue([R])]).optimized())==null?void 0:E.debugString1())??"")}),he("double group",()=>{var E;return S.asyncAssertMatchesSnapshot("group with two fill children can't be optimized",((E=new Ue([R,R]).optimized())==null?void 0:E.debugString1())??"")}),he("double nested group 1",()=>{var E;return S.asyncAssertMatchesSnapshot("outer group should be optimized away, leaving a group with two fill children",((E=new Ue([new Ue([R,R])]).optimized())==null?void 0:E.debugString1())??"")}),he("double nested group 2",()=>{var E;return S.asyncAssertMatchesSnapshot("inner groups should be optimized away, leaving a group with two fill children",((E=new Ue([new Ue([R]),new Ue([R])]).optimized())==null?void 0:E.debugString1())??"")})}),Ct("RenderTree optimization of Dissolve",()=>{let R=null,E=null,P=(T,f)=>new Nn(T,f,"A",()=>1).optimized();beforeEach(()=>{let T=new Gt(new Nt(vt.fromRect(new x(0,0,1,1)),"ODD"),[ee.createSolid(N.BLACK,1)]);R=new Tr(X.new2(),T,O.new());let f=new Gt(new Nt(vt.fromRect(new x(0,0,1,1)),"ODD"),[ee.createSolid(N.RED,1)]);E=new Tr(X.new2(),f,O.new())}),Ee("both subtrees null",()=>{g(P(null,null),null)}),he("old subtree null",()=>{var T;return S.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because old subtree is null",((T=P(null,R))==null?void 0:T.debugString1())??"")}),he("new subtree null",()=>{var T;return S.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because new subtree is null",((T=P(R,null))==null?void 0:T.debugString1())??"")}),he("identical subtrees",()=>{var T;return S.asyncAssertMatchesSnapshot("dissolve should be optimized away entirely because subtrees are identical",((T=P(R,R))==null?void 0:T.debugString1())??"")}),he("different subtrees",()=>{var T;return S.asyncAssertMatchesSnapshot("dissolve should not be optimized away",((T=P(R,E))==null?void 0:T.debugString1())??"")})}),Ct("RenderTree optimization of Fill",()=>{Ee("fill with zero opacity paint",()=>{g(new Tr(X.new2(),new Gt(new Nt(vt.fromRect(new x(0,0,1,1)),"ODD"),[ee.createSolid(N.BLACK,0)]),O.new()).optimized(),null)}),Ee("fill with disabled paint",()=>{g(new Tr(X.new2(),new Gt(new Nt(vt.fromRect(new x(0,0,1,1)),"ODD"),[ee.create("SOLID",1,"NORMAL",!1,N.BLACK)]),O.new()).optimized(),null)}),Ee("fill with empty bounds",()=>{g(new Tr(X.new2(),new Gt(new Nt(vt.fromRect(new x(0,0,0,0)),"ODD"),[ee.createSolid(N.BLACK,1)]),O.new()).optimized(),null)})}),Ct("RenderTree optimization of Blur",()=>{let R;beforeEach(()=>{let E=new Gt(new Nt(vt.fromRect(new x(0,0,1,1)),"ODD"),[ee.createSolid(N.BLACK,1)]);R=new Tr(X.new2(),E,O.new())}),he("zero radius blur",()=>{var E;return S.asyncAssertMatchesSnapshot("should contain no Blur node",((E=fo.createForStandardBlur(0,R,x.INVALID).optimized())==null?void 0:E.debugString1())??"")}),he("blur wrapping volatile fill",()=>{var E;return S.asyncAssertMatchesSnapshot("volatile property binding should be OUTSIDE of blur",((E=fo.createForStandardBlur(10,gt.forTranslation(R,St.forAnimateableTranslation("x"),()=>O.new()),x.INVALID).optimized())==null?void 0:E.debugString1())??"")}),he("clamp blur wrapping volatile fill",()=>{var E;return S.asyncAssertMatchesSnapshot("volatile property binding should be INSIDE of blur",((E=fo.createForStandardBlur(10,gt.forTranslation(R,St.forAnimateableTranslation("x"),()=>O.new()),new x(0,0,1,1)).optimized())==null?void 0:E.debugString1())??"")})}),Ct("RenderTree optimization of HardMaskWithColor",()=>{let R;beforeEach(()=>{let E=new Gt(new Nt(vt.fromRect(new x(0,0,1,1)),"ODD"),[ee.createSolid(N.BLACK,1)]);R=new Tr(X.new2(),E,O.new())}),he("hard mask wrapping fill",()=>{var E;return S.asyncAssertMatchesSnapshot("should be a single Fill",((E=new oi(R,N.BLACK).optimized())==null?void 0:E.debugString1())??"")}),he("hard mask wrapping volatile fill",()=>{var E;return S.asyncAssertMatchesSnapshot("should be a single Fill wrapped by the VolatilePropertyBinding",((E=new oi(gt.forTranslation(R,St.forAnimateableTranslation("x"),()=>O.new()),N.BLACK).optimized())==null?void 0:E.debugString1())??"")}),he("hard mask wrapping blend nodes",()=>{var E;return S.asyncAssertMatchesSnapshot("should be a single Fill",((E=new oi(new go("MULTIPLY",.5,R),N.BLACK).optimized())==null?void 0:E.debugString1())??"")})}),Ct("Stack reverse Z index",()=>{let R,E,P=()=>{R=ft.createSceneWithCanvasForTests1(),E=R.root().childAt1(0),E.setPrototypeDevice(Cn.DEFAULT)};beforeEach(P),he("stacking frame without stackReverseZIndex",()=>{var f;let T=at(E,"f");return qt(T,"c1",N.RED,1),qt(T,"c2",N.BLUE,1),T.setStackMode("VERTICAL"),T.setStackReverseZIndex(!1),S.asyncAssertMatchesSnapshot("should have non-reversed children",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("stacking frame with stackReverseZIndex",()=>{var f;let T=at(E,"f");return qt(T,"c1",N.RED,1),qt(T,"c2",N.BLUE,1),T.setStackMode("VERTICAL"),T.setStackReverseZIndex(!0),S.asyncAssertMatchesSnapshot("should have reversed children",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("non-stacking frame without stackReverseZIndex",()=>{var f;let T=at(E,"f");return qt(T,"c1",N.RED,1),qt(T,"c2",N.BLUE,1),T.setStackMode("NONE"),T.setStackReverseZIndex(!1),S.asyncAssertMatchesSnapshot("should have non-reversed children",((f=T.renderTree1())==null?void 0:f.debugString1())??"")}),he("non-stacking frame with stackReverseZIndex",()=>{var f;let T=at(E,"f");return qt(T,"c1",N.RED,1),qt(T,"c2",N.BLUE,1),T.setStackMode("NONE"),T.setStackReverseZIndex(!0),S.asyncAssertMatchesSnapshot("should have non-reversed children",((f=T.renderTree1())==null?void 0:f.debugString1())??"")})})}m.testRenderTree=u;function p(){let g=AssertLib.deepStrictEqual;Ee("Reparenting a node should invalidate render trees on both its old and its new parent",()=>{let R=ft.createSceneWithCanvasForTests1().root().childAt1(0),E=dt(R),P=dt(R),T=i(E,0,new x(0,0,100,100)),f=E.renderTree1(),y=P.renderTree1();g(f!=null,!0),g(y!=null,!0),T.setParentIndex(new un(Q.invalid(),gr.fromString(""))),P.appendChild(T);let v=E.renderTree1(),w=P.renderTree1();g(v!=f,!0),g(w!=y,!0)})}m.testNodeRenderTree=p;function _(){let g=AssertLib.deepStrictEqual,S=AssertLib.notDeepStrictEqual;Ee("equalWithinBounds works for Group nodes",()=>{let E=ft.createSceneWithCanvasForTests1().root().childAt1(0),P=Rr(E,"frame1",N.BLUE),T=Rr(E,"frame2",N.BLUE),f=P.renderTree1(),y=T.renderTree1(),v=()=>{f=P.renderTree1(),y=T.renderTree1()};v(),g(!!f,!0),f!=null&&(g(f.equals(y),!0),g(f,y),g(f.equalsWithinBounds(y,new x(15,15,10,10)),!0),g(f.equalsWithinBounds(y,new x(0,0,5,5)),!0));let w=i(P,0,new x(1,1,10,10)),I=i(T,0,new x(0,0,10,10));v(),g(f.equals(y),!1),S(f,y),g(f.equalsWithinBounds(y,new x(15,15,10,10)),!0),g(f.equalsWithinBounds(y,new x(0,0,5,5)),!1);let C=i(P,0,new x(15,15,10,10));v(),g(f.equalsWithinBounds(y,new x(30,30,10,10)),!1),g(f.equalsWithinBounds(y,new x(15,15,10,10)),!1),g(f.equalsWithinBounds(y,new x(0,0,5,5)),!1)}),Ee("equalWithinBounds works with nested masking",()=>{let E=ft.createSceneWithCanvasForTests1().root().childAt1(0),P=Rr(E,"frame1",N.BLUE),T=Rr(E,"frame2",N.BLUE),f=P.renderTree1(),y=T.renderTree1(),v=()=>{f=P.renderTree1(),y=T.renderTree1()};v(),g(f.equals(y),!0),g(f,y),g(f.equalsWithinBounds(y,new x(15,15,10,10)),!0),g(f.equalsWithinBounds(y,new x(0,0,5,5)),!0),i(P,0,new x(1,1,10,10)).setIsMask(!0);let I=i(P,0,new x(1,1,100,100));i(T,0,new x(1,1,10,10)).setIsMask(!0);let L=i(T,0,new x(1,1,101,101));v(),g(f.equals(y),!1),S(f,y),g(f.equalsWithinBounds(y,new x(15,15,10,10)),!0),g(f.equalsWithinBounds(y,new x(0,0,5,5)),!1)})}m.testEqualsWithinBounds=_;let h;(R=>(R[R.FILL=0]="FILL",R[R.FILL_AND_STROKE=1]="FILL_AND_STROKE"))(h=m.GeometryType||(m.GeometryType={}));let A;(R=>{function g(E){return E==0||E==1}R.GeometryType_hasFill=g;function S(E){return E==1}R.GeometryType_hasStroke=S})(A=m.in_GeometryType||(m.in_GeometryType={}))})(jf||(jf={}));var tg;(s=>(s.FIG_FILE_NO_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,73,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,130,136,1,0]),s.FIG_FILE_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,76,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,2,11,177,49,48,0,0,3,0,0,0,1,2,3]),s.GIF_MULTI_IMAGE=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,2,76,1,0,59]),s.GIF_MALFORMED_END_NO_EOF=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,50,76,1,0]),s.GIF_SPEED=new Uint8Array([71,73,70,56,57,97,2,0,2,0,240,0,0,0,0,0,255,255,255,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,0,25,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,33,249,4,0,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,68,0,5,0,33,249,4,0,100,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,132,83,0,33,249,4,0,200,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,4,2,5,0,59]),s.GIF_D1_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,5,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59]),s.GIF_D3_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,13,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59])))(tg||(tg={}));var Jp=class{constructor(e,r){if(this._app=null,this._frameLoader=null,this._session=null,this._pendingNodeId=null,this._app=e,this._session=r,this._frameLoader=this._session.incrementalLoader(),this._frameLoader==null)throw new Error("Expected incremental frame loader for mirror mode");this._emitter=Ht.getEventEmitter(),this._pendingNodeId=null,this._emitter.on("incrementalLoadingInfo",n=>{n.type==="finishIncrementalLoading"&&this._handleIncrementalLoadFinished()})}hasPendingSelectionChange(){return this._pendingNodeId!=null}connectToFileAndShowNode(e,r,n,o,i,a){n!=null&&(this._app.state().prototypeState().mostRecentFixInvalidStateInitiator="Mirror.connectToFileAndShowNode",this._app.state().setActivePrototypeStartingPointNodeId(n)),this._session.fileKey()!=e?this._app.connectTo(e,r,n,o,i,a):this._app.state().currentFileKey()!=e?(this._frameLoader.requestTlf(r),this._pendingNodeId=r):this._frameLoader.requestTlf(r)?this._app.state().prototypeState().navigateToFrameAndCloseOverlays(r):this._pendingNodeId=r}_handleIncrementalLoadFinished(){var e;this._pendingNodeId!=null&&((e=this._app.state().scene())==null?void 0:e.findNode(this._pendingNodeId))!=null&&(this._app.state().prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}},jp=class{constructor(e,r){this._app=null,this._session=null,this._app=e,this._session=r,this._observer=new YT(e.state()),Ht.getEventEmitter().on("sceneDidCompleteInitialLoad",n=>{e.state().scene().addObserver(this._observer)})}hasPendingSelectionChange(){return this._observer.hasPendingNodeId()}connectToFileAndShowNode(e,r,n,o,i,a){n!=null&&(this._app.state().prototypeState().mostRecentFixInvalidStateInitiator="Mirror.connectToFileAndShowNode",this._app.state().setActivePrototypeStartingPointNodeId(n)),this._session.fileKey()!=e?this._app.connectTo(e,r,n,o,i,a):this._app.state().currentFileKey()!=e?this._observer.setPendingNodeId(r):this.navigateToFrameAndCloseOverlays(r,n)}navigateToFrameAndCloseOverlays(e,r){var a;let n=Q.fromString(e),o=Q.fromString(r),i=this._app.state();if(n!=null&&Q.isValid(n)){this._observer.setPendingNodeId(null);let s=(a=i.scene())==null?void 0:a.findNode(n);if(s!=null){i.prototypeState().mostRecentBaseScreenIdChangeInitiator="Mirror.navigateToFrameAndCloseOverlays",i.prototypeState().resetPrototype(!1),i.videoManager().handleRestartPrototype(),o&&(i.prototypeState().mostRecentFixInvalidStateInitiator="Mirror.navigateToFrameAndCloseOverlays",i.setActivePrototypeStartingPointNodeId(o));let l=o&&s.topLevelAncestor()==null?o:n;i.prototypeState().navigateToFrameAndCloseOverlays(l,null,2,0,22,null,null)}else this._observer.setPendingNodeId(n),this._session.incrementalLoader().requestTlf(n)}else console.error(`Expected node id; got '${e}' instead`)}},YT=class{constructor(e){this.appState=null,this._pendingNodeId=null,this.appState=e}setPendingNodeId(e){this._pendingNodeId=e}hasPendingNodeId(){return this._pendingNodeId!=null}handleSceneGraphEvent(e){var n;let r=this._pendingNodeId;if(!(r==null||e.node.id()!==r||!(e.property===32&&e.newVal))){if(this.appState.baseScreenId()===r){this._pendingNodeId=null;return}((n=this.appState.scene())==null?void 0:n.findNode(r))!=null&&this.appState.prototypeStructure().validDestinationForPrototypeFromId(r)&&(this._pendingNodeId=null,this.appState.prototypeState().mostRecentBaseScreenIdChangeInitiator="MirrorPrototypeObserver.handleSceneGraphEvent",this.appState.prototypeState().resetPrototype(!0),this.appState.videoManager().handleRestartPrototype(),this.appState.prototypeState().mostRecentFixInvalidStateInitiator="MirrorPrototypeObserver.handleSceneGraphEvent",this.appState.setActivePrototypeStartingPointNodeId(r),this.appState.prototypeState().navigateToFrameAndCloseOverlays(r,null,2,0,22,null,null))}}};var Ld;(a=>{function t(s){return{x:Math.round(s.x()*100)/100,y:Math.round(s.y()*100)/100}}a._serialize=t;function e(s){return new O(s.x,s.y)}a._deserializeVector=e;function r(s,l){1&l&&(s.alt=!0),2&l&&(s.meta=!0),4&l&&(s.shift=!0),8&l&&(s.ctrl=!0),16&l&&(s.platform=!0)}a._setModifiers=r;function n(s){return("alt"in s?1:0)|("meta"in s?2:0)|("shift"in s?4:0)|("ctrl"in s?8:0)|("platform"in s?16:0)}a._loadModifiers=n;function o(s,l){let c=s.asMouseEvent();if(c!=null){let u={};return u.type=Dl[s.type()],u.at=t(l(c.locationInWindow)),c.locationInWindow.equals(c.previousLocationInWindow)||(u.lastAt=t(l(c.previousLocationInWindow))),c.clickCount!=0&&(u.clicks=c.clickCount),c.scrollDelta!=null&&(u.scroll=t(c.scrollDelta)),r(u,s.modifiers()),u}let d=s.asKeyEvent();if(d!=null){let u={};return u.type=Dl[s.type()],u.key=d.key,d.isRepeat&&(u.repeat=!0),r(u,s.modifiers()),u}return null}a.serialize=o;function i(s,l,c,d){let u=Fs.ViewerEventType_fromString(s.type);if(Fs.ViewerEventType_isMouseEventType(u)){let p=d(e(s.at)),_=l(p),h=p;"lastAt"in s&&(h=d(e(s.lastAt)));let A=null;"scroll"in s&&(A=e(s.scroll));let m=0;"clicks"in s&&(m=s.clicks);let g=n(s);return new bl(u,_,g,p,h,A,m,[])}else if(Fs.ViewerEventType_isKeyEventType(u)){let p=c(),_=s.key|0,h=s.repeat,A=n(s);return new Pl(u,p,A,_,h)}else if(Fs.ViewerEventType_isTouchEventType(u)){let p=n(s),_=d(e(s.at)),h=l(_);if(u==11||u==12){let A=_;"lastAt"in s&&(A=d(e(s.lastAt)));let m=new Pc(0,h,_,A);return new Nl(u,h,p,[m],[m])}else return new Nl(u,h,p,[],[])}else if(Fs.ViewerEventType_isWindowEventType(u))throw new Error("Deserializing window events not supported");throw new Error(`Unrecognized event type in deserialize ${Dl[u]}`)}a.deserialize=i})(Ld||(Ld={}));var M2="multiplayerLocalBroadcaster",B2="handshakeBroadcaster",$P="multiplayerLocalBroadcasterReady",eF="multiplayerLocalBroadcasterHandlerReady",QT=["recentClicks","instanceStateChanges","triggeredOverlaysData","videoStateChangeData","embeddedPrototypeData","activeSlidesEmbeddablePrototype","selection","lastTriggeredHotspot","lastTriggeredPrototypeInteractionID","lastTriggeredObjectAnimationIndex","triggeredSetVariableActionData","triggeredSetVariableModeActionData","mouse","scrollPositions"],rg=class{constructor(e,r){this._hasSessionReceivedJoinEnd=!1;this._hasReceivedHandshake=!1;this._session=e,this._session.addObserver(this),this._broadcastChannel=new BroadcastChannel(M2),this._handshakeChannel=new BroadcastChannel(B2),this.setupHandshakeHandler(r)}onHandshakeReceived(){}setupHandshakeHandler(e){this._handshakeChannel.onmessage=r=>{r.data.type===e&&(this._hasReceivedHandshake=!0,this.onHandshakeReceived())}}handleJoinEnd(){this._hasSessionReceivedJoinEnd=!0}isReadyForUse(){return this._hasReceivedHandshake&&this._hasSessionReceivedJoinEnd}handleConnect(e,r){}handleDisconnect(){}handleJoinStart(e,r,n){}handlePresenterChange(){}handleNodeChanges(){}handleSceneGraphReply(e,r){}handleSceneChangedLoadingPhase(e,r){}},ng=class extends rg{constructor(e){super(e,eF),this._session.addMultiplayerMessageObserver(this)}onHandshakeReceived(){this._handshakeChannel.postMessage({type:$P})}handleMultiplayerMessage(e){if(!(!this.isReadyForUse()||e.type!=="USER_CHANGES")&&QT.some(r=>{var n,o;return(o=(n=e.userChanges)==null?void 0:n[0])==null?void 0:o[r]})){let r=gi.deflateRaw(Ve().encodeMessage(e));this._broadcastChannel.postMessage(r),this._session.clearNextUserChange()}}},og=class extends rg{constructor(e,r){super(e,$P),this._coupler=r,this.setupBroadcastChannelMessageHandler()}handleJoinEnd(){super.handleJoinEnd(),this._hasReceivedHandshake||this._handshakeChannel.postMessage({type:eF})}handleMessage(e){var n;this._createMultiplayerUserSyncingIfNotExists(),this._maybeSetObservingSessionId();let r=F();r&&e.data&&((n=r.modules().prototype)==null||n.handleCompressedMultiplayerMessage(e.data,this._session.sessionID(),_n,!0))}setupBroadcastChannelMessageHandler(){this._broadcastChannel.onmessage=e=>{this.isReadyForUse()&&this.handleMessage(e)}}maybeForceUpdateOnUserChange(){this.isReadyForUse()&&this._coupler&&window.document.hidden&&this._coupler.onFrame()}shouldHandleUserChange(e,r){return!this.isReadyForUse()||!this._session.isObserving()||e.connected!==void 0?!0:QT.some(n=>e[n])?r:!0}_createMultiplayerUserSyncingIfNotExists(){if(!this._session.observedUser()&&!this._session.hasMultiplayerUserSyncing()){let e=new oc;e.addUserBySessionId(this._session.observingSessionID()),this._session.setMultiplayerUserSyncing(e)}}handleDisconnect(){this.isReadyForUse()&&this._createMultiplayerUserSyncingIfNotExists()}_maybeSetObservingSessionId(){this._session.isObserving()?this._observingSessionId=this._session.observingSessionID():this._observingSessionId&&this._session.setObservingSessionID(this._observingSessionId)}};var xfe=new md(1/.05,1),Lfe=hd.withDampingRatio(.5,100,1.1);var nF;(r=>{function t(n,o){return n(o)}r.call=t;function e(n){return n}r._new=e})(nF||(nF={}));var XT;(o=>{function t(i,a){e(i.map(s=>(l,c,d,u)=>{s(d,u)}),a)}o.createNewSceneAndRun=t;function e(i,a=(s,l)=>Rr(s,l,N.BLACK)){let s=new ur,l=ft.createSceneWithCanvasForTests1(),c=l.root().childAt1(0),d=a(c,"source");d.setRelativeTransform(new X(1,0,0,0,1,400)),d.setSize(new O(500,700));let u=a(c,"dst");u.setRelativeTransform(new X(1,0,0,0,1,1100)),u.setSize(new O(500,700)),s.setActiveCanvas(c),s.setScene(l);for(let p of i)p(s,l,d,u)}function r(){let i=ud().deepStrictEqual,a=new ec("./src/test/protomagicmove.test.ts");beforeEach(()=>{K.setViewerMode(K.ViewerMode.PROTOTYPE)}),Ct("getNodeMatches",()=>{let s=(l,c,d)=>{let u=ai.getNodeMatches(l,c);for(let p of d){let _=p[0],h=p[1],A=Qe.StringMap_get(u,_.id(),null),m=Qe.StringMap_get(u,h.id(),null);i(A,h,`Expected ${_.id()} to match ${h.id()}, but got ${A==null?null:A.id()} instead.`),i(m,_,`Expected ${h.id()} to match ${_.id()}, but got ${m==null?null:m.id()} instead.`)}i(u.size,d.length*2)};Ee("simple match case",()=>{let c=ft.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),u=nt(d,"A"),p=nt(d,"B"),_=nt(d,"C"),h=at(c,"dst"),A=nt(h,"A"),m=nt(h,"B"),g=nt(h,"C");s(d,h,[[u,A],[p,m],[_,g]])}),Ee("crossed match case",()=>{let c=ft.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),u=nt(d,"A"),p=nt(d,"B"),_=at(c,"dst"),h=nt(_,"B"),A=nt(_,"A");s(d,_,[[u,A],[p,h]])}),Ee("duplicate names",()=>{let c=ft.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),u=nt(d,"A"),p=nt(d,"A");nt(d,"A");let _=at(c,"dst"),h=nt(_,"A"),A=nt(_,"A");s(d,_,[[u,h],[p,A]])}),Ee("recursive matches",()=>{let c=ft.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),u=at(c,"dst"),p=nt(d,"A"),_=nt(p,"A"),h=nt(p,"B"),A=nt(d,"B");nt(A,"A"),nt(A,"B");let m=nt(d,"C");nt(m,"A"),nt(m,"B");let g=nt(u,"A"),S=nt(g,"A"),R=nt(g,"B"),E=nt(u,"B");nt(E,"C"),nt(E,"D");let P=nt(u,"D");nt(P,"A"),nt(P,"B"),s(d,u,[[p,g],[_,S],[h,R],[A,E]])}),Ee("hidden and transparent nodes",()=>{let c=ft.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),u=nt(d,"A");nt(d,"B");let p=nt(d,"C"),_=nt(d,"D");u.setVisible(!1),p.setOpacity(0);let h=at(c,"dst");nt(h,"A");let A=nt(h,"B"),m=nt(h,"C"),g=nt(h,"D");A.setVisible(!1),_.setOpacity(0),s(d,h,[[p,m],[_,g]])}),Ee("boolean op nodes",()=>{let c=ft.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),u=Gc(d);u.setName("booleanOp"),nt(u,"A"),nt(u,"B");let p=at(c,"dst"),_=Gc(p);_.setName("booleanOp"),nt(_,"A"),nt(_,"B"),s(d,p,[[u,_]])})}),Ee("Smart animate of fixed elements",()=>{let s=new O(100,100),l=new O(10,10),c=new ur,d=ft.createSceneWithCanvasForTests1(),u=d.root().childAt1(0);u.setPrototypeDevice(new Cn("CUSTOM",s,null,"NONE")),u.setCurrentViewportSize(s),c.setActiveCanvas(u),c.setScene(d);let p=(m,g)=>{let S=dt(u);S.setSize(new O(m,g)),S.setUsedAsBaseScreen(!0);let R=Wn(S);return R.setSize(new O(10,10)),R.setRelativeTransform(new X(1,0,0,0,1,g-l.y())),R.setVerticalConstraint("MAX"),R.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),S},_=p(100,200),h=p(100,100);Ul(_,h);let A=Td.buildStrategy(_.childAt1(0),h.childAt1(0));i(A.transition.from().transform1().translation().y(),s.y()-l.y()),i(A.transition.to().transform1().translation().y(),s.y()-l.y())}),Ct("interpolation strategies",()=>{let s=(l,c)=>{let d=Td.buildStrategy(l,c);ma(d.isDissolve)};Ee("dissolve discrete properties",()=>{[(c,d)=>{let u=de(c,"A");u.setBlendMode("NORMAL");let p=de(d,"A");p.setBlendMode("MULTIPLY"),s(u,p)},(c,d)=>{let u=Rb(c,"B"),p=de(d,"B");s(u,p)},(c,d)=>{let u=Rr(c,"C",N.TRANSPARENT);de(u,"C_content");let p=os(d,"C");de(p,"C_content"),s(u,p)},(c,d)=>{c.setOverflowDirection("VERTICAL"),d.setOverflowDirection("VERTICAL");let u=de(c,"D");u.setScrollBehavior("SCROLLS");let p=de(d,"D");p.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),s(u,p)}].forEach(c=>{t([c])})}),Ee("interpolate effects and paints",()=>{let l=ee.createLinearGradient([new ct(N.RED,0),new ct(N.TRANSPARENT,.5)]);[(d,u)=>{let p=Ch(d,"A",[l]),_=de(u,"A");s(p,_)},(d,u)=>{let p=de(d,"B");p.setTestOnlyEffects([]);let _=de(u,"B");_.setTestOnlyEffects([Pe.createForegroundBlur(1)]),s(p,_)},(d,u)=>{let p=de(d,"C");p.setTestOnlyEffects([Pe.createForegroundBlur(1)]);let _=de(u,"C");_.setTestOnlyEffects([Pe.createDropShadow(1,new O(1,1),N.BLACK,1)]),s(p,_)},(d,u)=>{let p=de(d,"D"),_=[Pe.createForegroundBlur(1),Pe.createDropShadow(1,new O(1,1),N.BLACK,1)];p.setTestOnlyEffects(_);let h=de(u,"D"),A=_.slice();A[0].setIsEnabled(!1),h.setTestOnlyEffects(A),s(p,h)},(d,u)=>{let p=de(d,"E"),_=[l,ee.createSolid(N.RED,1)];p.setTestOnlyFillPaints(_);let h=de(u,"E"),A=_.slice();A[0].setIsEnabled(!1),h.setTestOnlyFillPaints(A),s(p,h)}].forEach(d=>{t([d])})}),Ee("interpolate geometry",()=>{let l=(d,u,p)=>{let _=nt(d,u);_.setTestOnlyFillPaints([ee.createSolid(N.BLACK,1)]);let h=p.topLeft().x(),A=p.topLeft().y(),m=p.width(),g=p.height(),S=new jr("NONZERO",0,Bt.new2().moveTo1(h,A).lineTo(h+m,A).lineTo(h+m,A+g).lineTo(h,A+g-1).close(),p),R=new $r([S],null,S.bounds(),null);return _.setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),_.setTestOnlyFillGeometry(R),_.setTestOnlyStrokeGeometry(R),je(_,p.topLeft(),p.size()),_};[(d,u)=>{let p=l(d,"A",new x(0,0,100,100)),_=qt(u,"A",N.RED,1);s(p,_)}].forEach(d=>{t([d])})})}),Ct("magic move",()=>{let s=(u,p,_,h)=>{tc(u,()=>{let A=[];return p.forEach(m=>{t([_,(g,S)=>{var v;let R=new X(1,0,0,0,1,700),E=yt.FrozenAffineTransform_IDENTITY,P=ai.getMagicMovePlan2(g,R,S,E,Vr.get(m));A.push(a.asyncAssertMatchesSnapshot(`plan ${m}`,P.debugString()));let T=()=>0,f=uo.makeEasingFunction([0,0,1,1],.3),y=new Qi(P,T,f);A.push(a.asyncAssertMatchesSnapshot(`render tree ${m}`,((v=y.renderTree())==null?void 0:v.debugString1())??""))}],h)}),Promise.all(A)})},l=["DISSOLVE","SLIDE_FROM_RIGHT","PUSH_FROM_RIGHT","MOVE_FROM_RIGHT","SLIDE_OUT_TO_RIGHT","MOVE_OUT_TO_RIGHT"],c=["DISSOLVE","MOVE_FROM_RIGHT","MOVE_OUT_TO_RIGHT"],d=["DISSOLVE"];s("identical rectangles",d,(u,p)=>{de(u,"rect"),de(p,"rect")}),s("rectangles with different opacities",d,(u,p)=>{de(u,"rect").setOpacity(.9),de(p,"rect").setOpacity(.1)}),s("rectangles with changing and unchanging paints",d,(u,p)=>{Ch(u,"rect",[ee.createSolid(N.RED,1),ee.createSolid(N.GREEN,1)]),Ch(p,"rect",[ee.createSolid(N.BLUE,1),ee.createSolid(N.GREEN,1)])}),s("rectangles with different translations",d,(u,p)=>{de(u,"rect").setRelativeTransform(new X(1,0,30,0,1,50)),de(p,"rect").setRelativeTransform(new X(1,0,130,0,1,250))}),s("rectangles with different rotation",d,(u,p)=>{let _=de(u,"rect");_.setRelativeTransform(new X(1,0,30,0,1,50));let h=de(p,"rect"),A=X.new3(_.relativeTransform());A.rotatedBy(Math.PI/4),h.setRelativeTransform(A)}),s("rectangles with different scale",d,(u,p)=>{let _=de(u,"rect");_.setRelativeTransform(new X(1,0,30,0,1,50));let h=de(p,"rect"),A=X.new3(_.relativeTransform());A.scaledBy1(new O(2,3)),h.setRelativeTransform(A)}),s("insertion of new rectangle",d,(u,p)=>{de(p,"rect")}),s("deletion of old rectangle",d,(u,p)=>{de(u,"rect")}),s("rectangles with mismatched names",d,(u,p)=>{de(u,"A"),de(p,"B")}),s("hidden and never-visible rectangles",d,(u,p)=>{let _=de(u,"hidden"),h=de(u,"neverVisible");_.setVisible(!1),h.setOpacity(0);let A=de(p,"hidden"),m=de(p,"neverVisible");A.setVisible(!1),m.setOpacity(0)}),s("hidden and transparent and no match nodes to visible nodes",d,(u,p)=>{let _=de(u,"hidden"),h=de(u,"transparent");_.setVisible(!1),h.setOpacity(0),de(p,"hidden"),de(p,"transparent"),de(p,"noMatch")}),s("visible nodes to hidden and transparent and no match nodes",d,(u,p)=>{de(u,"hidden"),de(u,"transparent"),de(u,"noMatch");let _=de(p,"hidden"),h=de(p,"transparent");_.setVisible(!1),h.setOpacity(0)}),s("matching boolean op nodes",d,(u,p)=>{let _=Gc(u);_.setName("booleanOp"),nt(_,"A"),nt(_,"B");let h=Gc(p);h.setName("booleanOp"),nt(h,"A"),nt(h,"B")}),s("simple matching with layer re-ordering",d,(u,p)=>{de(u,"A"),de(u,"B"),de(p,"B"),de(p,"A")}),s("simple insertion, deletion, and matching",l,(u,p)=>{de(u,"A"),de(u,"B"),de(p,"C"),de(p,"B")}),s("complex layer re-ordering with insertions and removals",c,(u,p)=>{de(u,"A"),de(u,"B"),de(u,"C"),de(u,"D"),de(u,"E"),de(u,"F"),de(u,"G"),de(u,"H"),de(p,"1"),de(p,"2"),de(p,"F"),de(p,"3"),de(p,"4"),de(p,"C"),de(p,"5"),de(p,"6")}),s("complex matching case with no nesting",d,(u,p)=>{de(u,"A"),de(u,"B"),de(u,"C"),de(u,"E"),de(p,"X"),de(p,"Y"),de(p,"B"),de(p,"Z"),de(p,"E"),de(p,"F")}),s("simple nested matching",d,(u,p)=>{let _=at(u,"F");at(_,"rect");let h=at(p,"F");at(h,"rect").setOpacity(.5)}),s("nested insertions/removals",c,(u,p)=>{let _=at(u,"A");de(_,"rectA");let h=at(p,"B");de(h,"rectB")}),s("dissolving between different sized objects",d,(u,p)=>{de(u,"A").setSize(new O(100,100)),de(p,"A").setSize(new O(200,200))}),s("dissolving between non-uniformly scaling frames with children",d,(u,p)=>{let _=at(u,"A");_.setSize(new O(150,1)),qt(_,"rect",N.RED,1).setSize(new O(100,100)),qt(_,"rect",N.RED,1).setSize(new O(100,100));let m=at(p,"A");m.setSize(new O(300,300)),qt(m,"rect",N.RED,1).setSize(new O(100,100)),qt(m,"rect",N.RED,1).setSize(new O(100,100))}),s("dissolving between background blur objects",d,(u,p)=>{let _=Object({viewer_background_blur_opts:!1});K.updateFeatureFlags(_),qt(u,"A",N.RED,.5).setTestOnlyEffects([Pe.createBackgroundBlur(1)]),qt(p,"A",N.BLUE,.5).setTestOnlyEffects([Pe.createBackgroundBlur(1)])}),s("dissolving between background blur objects with a background blur behind",d,(u,p)=>{let _=Object({viewer_background_blur_opts:!1});K.updateFeatureFlags(_),qt(u,"BG",N.RED,.5).setTestOnlyEffects([Pe.createBackgroundBlur(1)]),qt(p,"BG",N.RED,.5).setTestOnlyEffects([Pe.createBackgroundBlur(1)]),qt(u,"A",N.RED,.5).setTestOnlyEffects([Pe.createBackgroundBlur(1)]),qt(p,"A",N.BLUE,.5).setTestOnlyEffects([Pe.createBackgroundBlur(1)])}),s("translating a background blur contained in a frame with clip-content enabled",d,(u,p)=>{let _=Object({viewer_background_blur_opts:!1});K.updateFeatureFlags(_);let h=at(u,"A");h.setIsFrameMaskDisabled(!0);let A=at(h,"B");qt(A,"BG",N.RED,.5).setTestOnlyEffects([Pe.createBackgroundBlur(1)]);let g=at(p,"A");g.setIsFrameMaskDisabled(!0);let S=X.new3(g.relativeTransform());S.translatedBy2(10,10),g.setRelativeTransform(S);let R=at(g,"B");qt(R,"BG",N.RED,.5).setTestOnlyEffects([Pe.createBackgroundBlur(1)])}),s("translating a node with a background blur",d,(u,p)=>{qt(u,"BG",N.RED,.5).setTestOnlyEffects([Pe.createBackgroundBlur(1)]);let h=qt(p,"BG",N.RED,.5);h.setTestOnlyEffects([Pe.createBackgroundBlur(1)]);let A=X.new3(h.relativeTransform());A.translatedBy2(10,10),h.setRelativeTransform(A)}),s("dissolving + scaling between nodes with unmatched children",d,(u,p)=>{let _=Rr(u,"F",N.RED);_.setSize(new O(100,100)),de(_,"rect"),at(p,"F").setSize(new O(200,200))}),s("dissolve only between nodes with unmatched children",d,(u,p)=>{let _=Rr(u,"F",N.RED);_.setSize(new O(100,100)),de(_,"rect"),gb(p,"F").setSize(new O(100,100))}),s("dissolving between visible top frame to invisibile top frame",d,(u,p)=>{let _=new ee("SOLID");_.setColor(N.RED),_.setOpacity(1),_.setIsEnabled(!0),u.setTestOnlyFillPaints([_]),_.setOpacity(0),p.setTestOnlyFillPaints([_])}),s("dissolving between different opacity objects",d,(u,p)=>{let _=de(u,"A");_.setOpacity(1),_.setBlendMode("MULTIPLY");let h=de(p,"A");h.setOpacity(.5),h.setBlendMode("NORMAL")}),s("dissolving between invisible node to visible node",d,(u,p)=>{qt(u,"A",N.RED,0),qt(p,"A",N.BLUE,.5)}),s("interpolating between two solid color paints",d,(u,p)=>{qt(u,"A",N.RED,1),qt(p,"A",N.BLUE,1)}),s("drop shadow: node rotates",d,(u,p)=>{let _=de(u,"rect");_.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]),_.setRelativeTransform(new X(1,0,30,0,1,50));let h=de(p,"rect");h.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]);let A=X.new3(_.relativeTransform());A.rotatedBy(Math.PI/4),h.setRelativeTransform(A)}),s("inner shadow: node rotates",d,(u,p)=>{let _=de(u,"rect");_.setTestOnlyEffects([Pe.createInnerShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]),_.setRelativeTransform(new X(1,0,30,0,1,50));let h=de(p,"rect");h.setTestOnlyEffects([Pe.createInnerShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]);let A=X.new3(_.relativeTransform());A.rotatedBy(Math.PI/4),h.setRelativeTransform(A)}),s("drop shadow: group shadow where group rotates and children are static",d,(u,p)=>{let _=Rr(u,"F",N.TRANSPARENT);_.setIsBackgroundEnabled(!1),de(_,"rectA").setRelativeTransform(X.new2()),de(_,"rectB").setRelativeTransform(new X(1,0,50,0,1,0)),_.setRelativeTransform(new X(1,0,30,0,1,50)),_.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]);let m=Rr(p,"F",N.TRANSPARENT);m.setIsBackgroundEnabled(!1),de(m,"rectA").setRelativeTransform(X.new2()),de(m,"rectB").setRelativeTransform(new X(1,0,50,0,1,0));let R=X.new3(_.relativeTransform());R.rotatedBy(Math.PI/4),m.setRelativeTransform(R),m.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)])}),s("drop shadow: group shadow where group is static and children rotate",d,(u,p)=>{let _=Rr(u,"F",N.TRANSPARENT);_.setIsBackgroundEnabled(!1),de(_,"rectA").setRelativeTransform(X.new2()),de(_,"rectB").setRelativeTransform(new X(1,0,50,0,1,0)),_.setRelativeTransform(new X(1,0,30,0,1,50)),_.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]);let m=Rr(p,"F",N.TRANSPARENT);m.setIsBackgroundEnabled(!1);let g=de(m,"rectA");g.setRelativeTransform(X.new2());let S=de(m,"rectB");S.setRelativeTransform(new X(1,0,50,0,1,0));let R=X.new3(g.relativeTransform());R.rotatedBy(Math.PI/4),g.setRelativeTransform(R);let E=X.new3(S.relativeTransform());E.rotatedBy(Math.PI/4),S.setRelativeTransform(E),m.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)])}),s("drop shadow: complex group shadow with nested groups and mixed transitions",d,(u,p)=>{let _=Rr(u,"staticGroup1",N.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(new X(1,0,30,0,1,50)),_.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]),de(_,"staticRectZ").setRelativeTransform(X.new2());let A=Rr(_,"rotatingGroup2",N.TRANSPARENT);A.setIsBackgroundEnabled(!1),de(A,"rotatingRectA").setRelativeTransform(X.new2()),de(A,"staticRectB").setRelativeTransform(new X(1,0,50,0,1,0));let S=Rr(p,"staticGroup1",N.TRANSPARENT);S.setIsBackgroundEnabled(!1),S.setRelativeTransform(new X(1,0,30,0,1,50)),S.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]),de(S,"staticRectZ").setRelativeTransform(X.new2());let E=Rr(S,"rotatingGroup2",N.TRANSPARENT);E.setIsBackgroundEnabled(!1),E.setRelativeTransform(X.new2().rotatedBy(Math.PI/4)),de(E,"rotatingRectA").setRelativeTransform(X.new2().rotatedBy(Math.PI/3)),de(E,"staticRectB").setRelativeTransform(new X(1,0,50,0,1,0))}),s("inner shadow: complex group shadow with nested groups and mixed transitions",d,(u,p)=>{let _=Rr(u,"staticGroup1",N.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(new X(1,0,30,0,1,50)),_.setTestOnlyEffects([Pe.createInnerShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]),de(_,"staticRectZ").setRelativeTransform(X.new2());let A=Rr(_,"rotatingGroup2",N.TRANSPARENT);A.setIsBackgroundEnabled(!1),de(A,"rotatingRectA").setRelativeTransform(X.new2()),de(A,"staticRectB").setRelativeTransform(new X(1,0,50,0,1,0));let S=Rr(p,"staticGroup1",N.TRANSPARENT);S.setIsBackgroundEnabled(!1),S.setRelativeTransform(new X(1,0,30,0,1,50)),S.setTestOnlyEffects([Pe.createInnerShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]),de(S,"staticRectZ").setRelativeTransform(X.new2());let E=Rr(S,"rotatingGroup2",N.TRANSPARENT);E.setIsBackgroundEnabled(!1),E.setRelativeTransform(X.new2().rotatedBy(Math.PI/4)),de(E,"rotatingRectA").setRelativeTransform(X.new2().rotatedBy(Math.PI/3)),de(E,"staticRectB").setRelativeTransform(new X(1,0,50,0,1,0))}),s("drop shadow: no node change but parent rotates",d,(u,p)=>{let _=at(u,"F");de(_,"rect").setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]),_.setRelativeTransform(new X(1,0,30,0,1,50));let A=de(p,"F");de(A,"rect").setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]);let g=X.new3(_.relativeTransform());g.rotatedBy(Math.PI/4),A.setRelativeTransform(g)}),s("drop shadow: no node change but parent translates/resizes",d,(u,p)=>{let _=at(u,"F");de(_,"rect").setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]),_.setRelativeTransform(new X(1,0,30,0,1,50)),_.setSize(new O(100,100));let A=at(p,"F");de(A,"rect").setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]);let g=X.new3(_.relativeTransform());g.translate1(ge.FrozenVector_new4(1,1)),A.setRelativeTransform(g),A.setSize(new O(100,200))}),s("transition between scrolling frames",c,(u,p)=>{u.setOverflowDirection("VERTICAL"),u.setTestOnlyFillPaints([ee.createSolid(N.RED,1)]),u.setTestOnlyEffects([Pe.createDropShadow(1,new O(1,1),N.BLACK,1)]),p.setTestOnlyFillPaints([ee.createSolid(N.BLUE,1)]),p.setTestOnlyEffects([Pe.createDropShadow(1,new O(1,1),N.BLACK,1)]);let _=qt(u,"rect",N.GREEN,1);_.setSize(new O(u.size().x(),u.size().y()+100)),qt(p,"rect",N.GREEN,1).setSize(_.size())}),s("scaling nodes whose children have different scaling factors",d,(u,p)=>{let _=at(u,"subframe");_.setSize(new O(100,100)),de(_,"rect").setSize(new O(50,50));let A=at(p,"subframe");A.setSize(new O(200,200)),de(A,"rect").setSize(new O(50,50))}),s("deeply nested scaling nodes whose children have different scaling factors",d,(u,p)=>{let _=at(u,"A");_.setSize(new O(100,100));let h=Rr(_,"B",N.RED);h.setSize(new O(50,50)),Rr(h,"C",N.BLACK).setSize(new O(10,10));let m=at(p,"A");m.setSize(new O(200,200));let g=de(m,"B");g.setSize(new O(50,50)),Rr(g,"C",N.BLACK).setSize(new O(10,10))}),s("transition between two screens with masks",d,(u,p)=>{let _=de(u,"mask");_.setSize(new O(50,50)),_.setIsMask(!0),de(u,"color").setSize(new O(100,100)),nt(p,"andrew");let A=de(p,"mask");A.setRelativeTransform(new X(1,0,10,0,1,10)),A.setSize(new O(50,50)),A.setIsMask(!0),de(p,"color").setSize(new O(100,100))}),s("MOVE_IN with unmatched layers nested inside of matched layers",["MOVE_FROM_RIGHT"],(u,p)=>{let _=at(u,"A");qt(_,"A_1",N.BLUE,1);let h=at(p,"A");qt(h,"A_2",N.GREEN,1)}),s("MOVE_IN with unmatched layers nested inside of matched fixed layers",["MOVE_FROM_RIGHT"],(u,p)=>{let _=at(u,"A");_.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),qt(_,"A_1",N.BLUE,1);let h=at(p,"A");qt(h,"A_2",N.GREEN,1)}),s("dissolving image fills with different geometries should separate into masks",d,(u,p)=>{HS(u,"tri",new O(100,100)),HS(p,"tri",new O(50,100))}),s("dissolving non-image fills with different geometries should NOT separate into masks",d,(u,p)=>{zS(u,"rect",N.RED,1,new O(100,100)),zS(p,"rect",N.GREEN,1,new O(50,100))}),tc("non-image rects with different geometries interpolate rounded rectangle parameters",()=>{let u=[];return d.forEach(p=>{t([(_,h)=>{var P;io(_,"rect",N.RED,1,new O(100,100)),io(h,"rect",N.GREEN,1,new O(50,100));let A=new X(1,0,0,0,1,700),m=yt.FrozenAffineTransform_IDENTITY,g=ai.getMagicMovePlan2(_,A,h,m,Vr.get(p));u.push(a.asyncAssertMatchesSnapshot(`plan ${p}`,g.debugString()));let S=()=>0,R=uo.makeEasingFunction([0,0,1,1],.3),E=new Qi(g,S,R);u.push(a.asyncAssertMatchesSnapshot(`render tree ${p}`,((P=E.renderTree())==null?void 0:P.debugString1())??""))}])}),Promise.all(u)}),tc("non-image rects with different geometries and different effect spreads interpolate rounded rectangle + effect parameters",()=>{let u=[];return d.forEach(p=>{t([(_,h)=>{var f;io(_,"rect",N.RED,1,new O(100,100)).setTestOnlyEffects([Pe.createDropShadow(1,new O(5,5),N.BLACK,.5,10)]),io(h,"rect",N.GREEN,1,new O(50,100)).setTestOnlyEffects([Pe.createDropShadow(1,new O(5,5),N.BLACK,.5,10)]);let g=new X(1,0,0,0,1,700),S=yt.FrozenAffineTransform_IDENTITY,R=ai.getMagicMovePlan2(_,g,h,S,Vr.get(p));u.push(a.asyncAssertMatchesSnapshot(`plan ${p}`,R.debugString()));let E=()=>0,P=uo.makeEasingFunction([0,0,1,1],.3),T=new Qi(R,E,P);u.push(a.asyncAssertMatchesSnapshot(`render tree ${p}`,((f=T.renderTree())==null?void 0:f.debugString1())??""))}])}),Promise.all(u)}),s("dissolving image rects with different geometries: render good-enough identical shadows for now",d,(u,p)=>{let _=[Pe.createDropShadow(1,new O(5,5),N.BLACK,.5)];xu(u,"rect",new O(100,100)).setTestOnlyEffects(_),xu(p,"rect",new O(50,100)).setTestOnlyEffects(_)}),s("dissolving image rects with different geometries: non-identical shadows fall back to dissolve for now",d,(u,p)=>{xu(u,"rect",new O(100,100)).setTestOnlyEffects([Pe.createDropShadow(1,new O(5,5),N.BLACK,.5)]),xu(p,"rect",new O(50,100)).setTestOnlyEffects([Pe.createDropShadow(5,new O(5,5),N.BLACK,.5)])}),s("groups with drop shadows and moving children",d,(u,p)=>{let _=os(u,"G");io(_,"A",N.RED,1,new O(10,10)),io(_,"B",N.GREEN,1,new O(10,10)),_.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]);let h=os(p,"G");h.setTestOnlyEffects([Pe.createDropShadow(1,ge.FrozenVector_new4(1,1),N.BLACK,.5)]),io(h,"A",N.RED,1,new O(10,10)).setRelativeTransform(new X(1,0,20,0,1,30)),io(h,"B",N.GREEN,1,new O(10,10)).setRelativeTransform(new X(1,0,50,0,1,100))}),s("resizing resize-to-fit-groups without background paints",d,(u,p)=>{let _=os(u,"G");io(_,"A",N.RED,1,new O(10,10)).setRelativeTransform(new X(1,0,0,0,1,0)),io(_,"B",N.GREEN,1,new O(10,10)).setRelativeTransform(new X(1,0,10,0,1,30)),_.setSize(new O(20,40));let m=os(p,"G");io(m,"A",N.RED,1,new O(10,10)).setRelativeTransform(new X(1,0,0,0,1,0)),io(m,"B",N.GREEN,1,new O(10,10)).setRelativeTransform(new X(1,0,20,0,1,30)),m.setSize(new O(30,40))}),s("resizing resize-to-fit-groups with background paints",d,(u,p)=>{let _=[ee.createSolid(N.RED,1)],h=os(u,"G");h.setTestOnlyFillPaints(_),io(h,"A",N.RED,1,new O(10,10)).setRelativeTransform(new X(1,0,0,0,1,0)),io(h,"B",N.GREEN,1,new O(10,10)).setRelativeTransform(new X(1,0,10,0,1,30)),h.setSize(new O(20,40));let g=os(p,"G");g.setTestOnlyFillPaints(_),io(g,"A",N.RED,1,new O(10,10)).setRelativeTransform(new X(1,0,0,0,1,0)),io(g,"B",N.GREEN,1,new O(10,10)).setRelativeTransform(new X(1,0,20,0,1,30)),g.setSize(new O(30,40))}),s("transition between symbols with new frame properties",d,(u,p)=>{i(u.type(),"SYMBOL"),u.setTestOnlyFillPaints(u.fillPaints()),i(p.type(),"SYMBOL"),p.setTestOnlyFillPaints([ee.createSolid(N.RED,1)])},(u,p)=>{let _=Qr(u,"SYMBOL"),h=new ee("SOLID");return h.setColor(N.BLACK),h.setOpacity(1),h.setIsEnabled(!0),_.setName(p),_.setBackgroundOpacity(1),_.setIsBackgroundEnabled(!0),_.setIsFrameMaskDisabled(!1),_.setIsResizeToFit(!1),_.setTestOnlyFillPaints([h]),_.setStrokeAlign("CENTER"),_}),s("Smart animate frames with reverse z-index",["SMART_ANIMATE"],(u,p)=>{let _=h=>{h.setStackReverseZIndex(!0),h.setStackMode("HORIZONTAL");let A=qt(h,"A",N.RED,.5);A.setSize(new O(20,20)),A.setRelativeTransform(new X(1,0,0,0,1,0));let m=qt(h,"B",N.BLUE,.5);m.setSize(new O(20,20)),m.setRelativeTransform(new X(1,0,10,0,1,0))};_(u),_(p)})})}o.testMagicMove=r;function n(){let i=ud().deepEqual;beforeEach(()=>{K.setViewerMode(K.ViewerMode.PROTOTYPE)}),Ct("Drag vector computation:",()=>{Ee("Smart animate drag - matched object with translation",()=>{e([(a,s,l,c)=>{let d=de(l,"rect");d.setRelativeTransform(new X(1,0,30,0,1,50)),de(c,"rect").setRelativeTransform(new X(1,0,130,0,1,250));let p=en(d,c,"DRAG","SMART_ANIMATE","NAVIGATE"),_=Cr.computeDragVector1(d,p,l,a.prototypeStructure(),a.prototypeState());i(_,new O(100,200))}])}),Ee("Smart animate drag - matched object with translation, rotation, and resizing",()=>{e([(a,s,l,c)=>{let d=de(l,"rect");d.setSize(new O(100,100)),d.setRelativeTransform(X.new2().translatedBy1(d.size().negative().divideScalar(2)));let u=de(c,"rect");u.setSize(new O(200,100));let p=X.new2().translatedBy1(u.size().negative().divideScalar(2));p.postRotate(Math.PI/2),p.postTranslate(new O(100,200)),u.setRelativeTransform(p);let _=en(d,c,"DRAG","SMART_ANIMATE","NAVIGATE"),h=Cr.computeDragVector1(d,_,l,a.prototypeStructure(),a.prototypeState());i(h,new O(100,200))}])}),Ee("Smart animate drag - no matches",()=>{e([(a,s,l,c)=>{let d=de(l,"rect");d.setRelativeTransform(new X(1,0,30,0,1,50));let u=en(d,c,"DRAG","SMART_ANIMATE","NAVIGATE"),p=Cr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(p,null)}])}),Ee("Smart animate drag - overlay swap with matched object with translation",()=>{e([(a,s,l,c)=>{let d=s.root().childAt1(0),u=at(d,"overlayA"),p=at(d,"overlayB"),_=de(u,"rect");_.setRelativeTransform(new X(1,0,30,0,1,50)),de(p,"rect").setRelativeTransform(new X(1,0,130,0,1,250));let A=en(_,p,"DRAG","SMART_ANIMATE","SWAP");en(l,u,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let m=Cr.computeDragVector1(_,A,l,a.prototypeStructure(),a.prototypeState());i(m,new O(100,200))}])}),Ee("Smart animate drag - overlay swap with no matches",()=>{e([(a,s,l,c)=>{let d=s.root().childAt1(0),u=at(d,"overlayA"),p=at(d,"overlayB"),_=de(u,"rect");_.setRelativeTransform(new X(1,0,30,0,1,50));let h=en(_,p,"DRAG","SMART_ANIMATE","SWAP");en(l,u,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let A=Cr.computeDragVector1(_,h,l,a.prototypeStructure(),a.prototypeState());i(A,null)}])}),Ee("Move in smart animate drag - matched object with translation",()=>{e([(a,s,l,c)=>{let d=de(l,"rect");d.setRelativeTransform(new X(1,0,30,0,1,50)),de(c,"rect").setRelativeTransform(new X(1,0,130,0,1,250));let p=Ih(d,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),_=Cr.computeDragVector1(d,p,l,a.prototypeStructure(),a.prototypeState());i(_,new O(100,200))}])}),Ee("Move in smart animate drag - no matches",()=>{e([(a,s,l,c)=>{let d=de(l,"rect");d.setRelativeTransform(new X(1,0,30,0,1,50));let u=Ih(d,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),p=Vr.get("MOVE_FROM_LEFT").enteringFrameTransition(),_=c.size().multiply(p.to().translation1().subtract(p.from().translation1())),h=Cr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(h,_)}])}),Ee("Screen swipe drag - nested node move in transition",()=>{e([(a,s,l,c)=>{let d=de(l,"rect");d.setRelativeTransform(new X(1,0,30,0,1,50));let u=en(d,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),p=Vr.get("MOVE_FROM_LEFT").enteringFrameTransition(),_=c.size().multiply(p.to().translation1().subtract(p.from().translation1())),h=Cr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(h,_)}])}),Ee("Screen swipe drag - nested node move out transition",()=>{e([(a,s,l,c)=>{let d=de(l,"rect");d.setRelativeTransform(new X(1,0,30,0,1,50));let u=en(d,c,"DRAG","MOVE_OUT_TO_LEFT","NAVIGATE"),p=Vr.get("MOVE_OUT_TO_LEFT").exitingFrameTransition(),_=l.size().multiply(p.to().translation1().subtract(p.from().translation1())),h=Cr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(h,_)}])}),Ee("Screen swipe drag - TLF move in transition",()=>{e([(a,s,l,c)=>{let d=en(l,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),u=Vr.get("MOVE_FROM_LEFT").enteringFrameTransition(),p=c.size().multiply(u.to().translation1().subtract(u.from().translation1())),_=Cr.computeDragVector1(l,d,l,a.prototypeStructure(),a.prototypeState());i(_,p)}])}),Ee("Back screen swipe drag - TLF was opened by move in",()=>{e([(a,s,l,c)=>{var m;en(l,c,"ON_CLICK","MOVE_FROM_LEFT","NAVIGATE"),Rh(c),vh(c,"DRAG");let d=l.prototypeInteractions()[0],u=(m=d.action())==null?void 0:m.value;a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().navigateToFrameAndCloseOverlays(u.transitionNodeID(),a.baseScreenNode(),1,0,4,d,u),a.prototypeState().commitStateChange();let p=Vr.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),_=c.size().multiply(p.to().translation1().subtract(p.from().translation1())),h=c.prototypeInteractions()[0],A=Cr.computeDragVector1(c,h,c,a.prototypeStructure(),a.prototypeState());i(A,_)}])}),Ee("Overlay swipe drag - overlay move in transition",()=>{e([(a,s,l,c)=>{en(l,c,"DRAG","MOVE_FROM_LEFT","OVERLAY"),c.setSize(new O(250,250)),c.setOverlayPositionType("TOP_LEFT");let d=Cr.computeDragVector1(l,l.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());i(d,new O(c.size().x(),0))}])}),Ee("Overlay swipe drag - overlay move in transition with nested source",()=>{e([(a,s,l,c)=>{let d=de(l,"rect"),u=en(d,c,"DRAG","MOVE_FROM_LEFT","OVERLAY");c.setSize(new O(250,250)),c.setOverlayPositionType("TOP_LEFT");let p=Cr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());i(p,new O(c.size().x(),0))}])}),Ee("Close overlay swipe drag - overlay opened by move in",()=>{e([(a,s,l,c)=>{let d=s.root().childAt1(0),u=at(d,"overlayA");u.setSize(new O(250,250)),u.setOverlayPositionType("TOP_LEFT");let p=de(u,"rect");p.setRelativeTransform(new X(1,0,30,0,1,50)),en(l,u,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY"),kS(p),vh(p,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(u.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let _=Vr.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),h=u.size().multiply(_.to().translation1().subtract(_.from().translation1())),A=Cr.computeDragVector1(p,p.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());i(A,h)}])}),Ee("Overlay go back swipe drag - no back frame",()=>{e([(a,s,l,c)=>{c.setSize(new O(250,250)),c.setOverlayPositionType("TOP_LEFT"),en(l,c,"DRAG","MOVE_FROM_LEFT","OVERLAY"),Rh(c),vh(c,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(c.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let d=Cr.computeDragVector1(c,c.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());i(d,null)}])}),Ee("Drag - invalid navigate transition",()=>{e([(a,s,l,c)=>{en(l,c,"DRAG","DISSOLVE","NAVIGATE");let d=Cr.computeDragVector1(l,null,l,a.prototypeStructure(),a.prototypeState());i(d,null)}])})}),Ct("Drag progress measurement:",()=>{let a;beforeEach(()=>{a=new Uo,Xe.dangerouslyPushMockTime(a)}),afterEach(()=>{Xe.popMockTime()}),Ee("Simple drag velocity and progress measurement",()=>{e([(s,l,c,d)=>{let u=(T,f,y)=>{Js(y,f,`Expected velocity at timestep ${T} to equal ${f}, got ${y}`)};s.prototypeState().setIsDragging(!0);let p=new Cr(null,new O(1,0),null,null);p.handleDragStart(new O(0,0)),p.handleDrag(new O(0,0));let _=p.onTickProgress();i(_,0),a.advanceSeconds(1),p.handleDrag(new O(.5,0));let h=p.onTickProgress();i(h,.5);let A=p.signedDragSpeed();u(1,.5,A),a.advanceSeconds(.5),p.handleDrag(new O(1,0));let m=p.onTickProgress();i(m,1);let g=p.signedDragSpeed();u(2,1,g),a.advanceSeconds(1);let S=p.onTickProgress();i(S,1);let R=p.signedDragSpeed();u(3,0,R),a.advanceSeconds(.1),p.handleDrag(new O(.5,0));let E=p.onTickProgress();i(E,.5);let P=p.signedDragSpeed();u(4,-5,P)}])}),Ee("Different-direction drag velocity and progress measurement",()=>{e([(s,l,c,d)=>{s.prototypeState().setIsDragging(!0);let u=new Cr(null,new O(1,0),null,null);u.handleDragStart(new O(0,0)),u.handleDrag(new O(0,0));let p=u.onTickProgress();i(p,0),a.advanceSeconds(1),u.handleDrag(new O(0,.5));let _=u.onTickProgress();i(_,0);let h=u.signedDragSpeed();Ym(1,0,h),a.advanceSeconds(1),u.handleDrag(new O(-.5,0));let A=u.onTickProgress();i(A,0);let m=u.signedDragSpeed();Ym(2,-.5,m),a.advanceSeconds(1),u.handleDrag(new O(.5,1));let g=u.onTickProgress();i(g,.5);let S=u.signedDragSpeed();Ym(3,1,S)}])})})}o.testDragToAnimateBehavior=n})(XT||(XT={}));var ig=class{constructor(e){this._viewerStatsigConfigBindings=e}getDynamicConfigBoolean(e,r,n){return this._viewerStatsigConfigBindings.getDynamicConfigBoolean(e,r,n)}getDynamicConfigNumber(e,r,n){return this._viewerStatsigConfigBindings.getDynamicConfigNumber(e,r,n)}getDynamicConfigString(e,r,n){return this._viewerStatsigConfigBindings.getDynamicConfigString(e,r,n)}getExperimentBoolean(e,r,n){return this._viewerStatsigConfigBindings.getExperimentBoolean(e,r,n)}getExperimentNumber(e,r,n){return this._viewerStatsigConfigBindings.getExperimentNumber(e,r,n)}getExperimentString(e,r,n){return this._viewerStatsigConfigBindings.getExperimentString(e,r,n)}getFeatureGate(e){return this._viewerStatsigConfigBindings.getFeatureGate(e)}updateFeatureGateForTesting(e,r){xr(),this._viewerStatsigConfigBindings.updateFeatureGateForTesting(e,r)}setInRenderServerForViewerTests(){var e;xr(),(e=this._viewerStatsigConfigBindings)==null||e.setInRenderServerForViewerTests()}clearFeatureGatesForTesting(){var e;xr(),(e=this._viewerStatsigConfigBindings)==null||e.clearFeatureGatesForTesting()}updateExperimentForTesting(e,r,n){xr(),this._viewerStatsigConfigBindings.updateExperimentForTesting(e,r,n)}clearExperimentsForTesting(){var e;xr(),(e=this._viewerStatsigConfigBindings)==null||e.clearExperimentsForTesting()}};var ag=class{constructor(e){this._session=null,this._preservers=[],this._isReconnecting=!1,this._session=e,this._session.addObserver(this),this._preservers.push(new JT),this._preservers.push(new ZT)}handleSceneChangedLoadingPhase(e,r){r==In.PENDING_LOAD_AFTER_RECONNECT?this.handleSceneWillRebuildAfterReconnect():e==In.PENDING_LOAD_AFTER_RECONNECT&&r==In.LOADED&&this.handleSceneDidRebuildAfterReconnect()}handleSceneWillRebuildAfterReconnect(){if(this._session.scene()==null){we("Scene unexpectedly null in handleSceneWillRebuildAfterReconnect");return}this._isReconnecting=!0,this._preservers.forEach(e=>{e.reset()}),this._session.scene().each(e=>{this._preservers.forEach(r=>{r.saveDataFromOldSceneNode(e)})})}handleSceneDidRebuildAfterReconnect(){this._isReconnecting=!1,this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())}),this._preservers.forEach(e=>{e.reset()})}handleConnect(e,r){}handleDisconnect(){}handleJoinStart(e,r,n){}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){this._isReconnecting&&this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())})}handleSceneGraphReply(e,r){}},ZT=class{constructor(){this._nodeDeveloperFriendlyIdToScrollOffset=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdToScrollOffset=new Map}saveDataFromOldSceneNode(e){e.scrollDirection()!="NONE"&&!e.scrollOffset().equals(ge.FrozenVector_ZERO)&&this._nodeDeveloperFriendlyIdToScrollOffset.set(e.developerFriendlyId(),e.scrollOffset())}restoreDataToNewScene(e){Qe.StringMap_each(this._nodeDeveloperFriendlyIdToScrollOffset,(r,n)=>{let o=e.findNodeFromDeveloperFriendlyId(r);o!=null&&o.setScrollOffset(n)})}},JT=class{constructor(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=new no}saveDataFromOldSceneNode(e){e.usedAsBaseScreen()&&this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.add(e.developerFriendlyId())}restoreDataToNewScene(e){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.each(r=>{let n=e.findNodeFromDeveloperFriendlyId(r);n!=null&&n.setUsedAsBaseScreen(!0)})}};var sg=class{constructor(e){this._scene=null,this.onChange=null,this._scene=e.scene(),e.addAppObserver(this)}handleSceneChange(e,r){e!=null&&e.removeObserver(this),r!=null&&r.addObserver(this),this._scene=r}handleActiveCanvasChange(e,r){}handleActivePrototypeStartingPointChange(e,r){}handleSceneGraphEvent(e){(e.node.type()=="CANVAS"||e.node.type()=="DOCUMENT")&&this.onChange(this.pages())}pages(){let e=[];if(this._scene!=null&&this._scene.root()!=null)for(let r=0;r<this._scene.root().childCount();r=r+1){let n=this._scene.root().childAt1(r);n.type()=="CANVAS"&&!n.isInternalOnly()&&e.push({id:n.id(),name:n.name()})}return e}};var lg=class{handleStateChangeAborted(e){}handleStateChangeCommitted(e,r){this.callback(e)}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,r){}handleRestartPrototype(){}handleSetVariableAction(e){}constructor(e){this.callback=e}};var jT;(o=>{function t(){return o._instance}o.instance=t;function e(i,a){o._instance=new r(i,a)}o.create=e;class r extends lg{constructor(a,s){super(l=>{this._emitter.trigger("topLevelFrameChange",null)}),this._dirtyNodes=null,this._emitter=null,this._scene=null,a.addFrameObserver(this),a.addAppObserver(this),a.prototypeState().addObserver(this),this._emitter=s,this._clearDirtySet()}_clearDirtySet(){this._dirtyNodes=new Ui(a=>a)}handleSceneGraphEvent(a){switch(a.property){case 65:case 32:case 30:case 98:case 57:case 86:case 4:case 25:case 8:{this._dirtyNodes.add(a.node.id());break}}}handleSceneChange(a,s){a!=null&&a.removeObserver(this),s!=null&&s.addObserver(this)}handleActiveCanvasChange(a,s){}handleActivePrototypeStartingPointChange(a,s){}onFrame(){this._dirtyNodes.each(a=>{this._emitter.trigger("accessibilityNodeInvalidated",a)}),this._clearDirtySet()}}o._AccessibilityObserver=r,o._instance=null})(jT||(jT={}));function $p(t){return{x:t.x(),y:t.y(),width:t.width(),height:t.height()}}function oF(t){let e=t.state().getActiveCanvas();if(e==null)return null;let r=e.backgroundColor();return r==N.TRANSPARENT?null:N.asFloattoJSON(r)}function iF(t){if(t.state().scene()==null)return null;let r=t.state().getActiveCanvas();if(r==null)return null;let n=K.prototypeBackgroundColorOverride!=null?K.prototypeBackgroundColorOverride.value:r.prototypeBackgroundColor();return n==N.TRANSPARENT?null:N.asInttoJSON(n)}function z2(t){let e=[];for(let r of t)e.push(Q.fromString(r));return e}function W2(t){return{trigger:t.event().interactionType(),to:t.action().value.connectionType(),type:t.action().value.navigationType()}}function sF(t){return r=>{let n=r.subtract(t.canvasView().absoluteBounds().topLeft()),o=t.canvasView().canvasSpaceToWindowSpace().clone();return o.invert()?(o.transformPoint(n),n):null}}function lF(t,e){e.window().setRecordInteractionCallback(r=>{let n=Ld.serialize(r,t);n!==null&&Ht.getEventEmitter().trigger("recordInteraction",n)})}function K2(t){let e=sF(t);lF(e,t)}async function Y2(t){var w;Qa.detect(),Vt.initialize(t),cr.initialize(),ro.initialize(),K.initialize(t),ub(t.kiwiSchema),Br.setDelegate(new ig(t.statsigViewerWebConfig)),Ed.initialize(t.safeModeOptions),yu.initialize(t.emscriptenGL);let e=new xd(Vt.getContainerElement(),K.gameControllerListener(),new df,0),r=e.multiplayerSession(),n=e.multiplayerCoupler(),o=Ht.getEventEmitter();new ag(r);let i=new Zp(e.state()),a=new sg(e.state()),s={clientId:null,allowedEmbedOrigins:null,embedHost:null},l=new URLSearchParams(window.location.search),c=l.get("client-id")||null,d=((w=window.INITIAL_OPTIONS)==null?void 0:w.allowed_embed_origins)||null,u=l.get("embed_host")||l.get("embed-host")||null;s={clientId:c,allowedEmbedOrigins:d,embedHost:u},el.init(e.state(),e.canvasView(),s);let p=null;K.getViewerMode()==K.ViewerMode.MIRROR&&(K.mirrorShouldUseInlinePreviewFrameLoader()?p=new jp(e,r):p=new Jp(e,r));let _=null;t.enableLocalBroadcaster&&(_=new ng(r));let h=null;t.enableLocalUserChangesHandler&&(h=new og(r,n),e.multiplayerSession().addLocalUserChangesHandler(h)),o.on("documentSyncingMessage",I=>{be.trackEvent("Viewer Document Syncing Message",{...I,hasPendingMirrorSelectionChange:(p==null?void 0:p.hasPendingSelectionChange())??!1,hasPendingPrototypeStateChange:e.state().prototypeState().hasRequestedStateChange()})});let A=t.connectionRole;if(typeof A=="string"){if(["viewer","prototype"].indexOf(A)==-1)throw new Error(`Invalid connection role ${A}`);r.setRole(A)}o.on("sceneDidCompleteInitialLoad",I=>{let C=L=>{window.figmaPerfTesting&&window.postMessage({name:L,value:0},"*")};C("DOCUMENT_IS_LOADED"),window.DebuggingHelpers&&(window.DebuggingHelpers.documentIsLoaded=!0),e.canvasView().afterFrame=()=>{e.canvasView().afterFrame=null,C("AFTER_FIRST_RENDER"),o.trigger("documentIsLoaded")},e.canvasView().afterFirstRenderOfScreenStack=()=>{e.canvasView().afterFirstRenderOfScreenStack=null,C("AFTER_FIRST_RENDER_OF_TLF"),o.trigger("afterFirstRenderOfScreenStack")}});let m=0,g=t.interactionTestState;if(typeof g!="string"||g==="NONE")m=0;else if(g==="RECORD")m=1,SC();else if(g==="PLAYBACK")m=2,gC();else throw new Error(`Invalid interactionTestState ${g}`);let S=null,R=null,E=null,P=null;m!=0&&(S=I=>{let C=I.clone();return e.canvasView().canvasSpaceToWindowSpace().transformPoint(C),C.add(e.canvasView().absoluteBounds().topLeft())},R=sF(e),E=I=>e.window().root().viewFromPoint(I),P=()=>e.window().focusedView()),m==1&&lF(R,e),e.state().addActionObserver(new Ht.ActionHandler);let T=new Ht.AppHandler(e.state());e.state().addFrameObserver(T),jT.create(e.state(),o),fn.addUpdate(rr.windowFrame(e.window().events()),I=>{r.maybeFlushNextUserChange(0)}),e.canvasView().onBaseScreenIdChanged=(I,C,L,B,V)=>{I!=null&&o.trigger("baseScreenChanged",{nodeId:I,userInitiated:C==1,updateURL:L,repairsInvalidState:B,isSymbol:V})},e.canvasView().onScalingModeChanged=I=>{o.trigger("scalingModeChanged",{contentScalingMode:I.contentScalingMode.toString(),viewportScalingMode:I.fitMode.toString()})},e.canvasView().disengageObservationMode=()=>{o.trigger("disengageObservationMode")},e.canvasView().viewportTracker().onChange=(I,C)=>{o.trigger("viewportChanged",{offset:{x:I.x(),y:I.y()},zoomScale:C})},e.canvasView().onResize=()=>{o.trigger("canvasResize")},e.canvasView().onURLClicked=(I,C)=>{o.trigger("urlClicked",{url:I,openInNewWindow:C})},e.canvasView().onNavigateToPrototype=(I,C)=>{o.trigger("navigateToPrototype",{fileKey:I,guid:C})},vo.instance().startLibLoad=()=>{o.trigger("loadVideoJsLib",{})},a.onChange=I=>{o.trigger("pagesChange",I)},i.notifyCommentPositionsChange=()=>{o.trigger("watchedNodeBoundsChange")},new rc(e.state(),67,I=>{o.trigger("backgroundColorChange",oF(e))}),new rc(e.state(),68,I=>{o.trigger("prototypeBackgroundColorChange",iF(e))}),new rc(e.state(),69,I=>{o.trigger("prototypeDeviceChanged",I!=null?I.toJSON():null)});let f=[],y={appState:()=>e.state(),multiplayer:()=>r,prototypeState:()=>e.state().prototypeState(),logAndGetDocument:()=>{var C;let I=(C=e.state().scene())==null?void 0:C.root();return I!=null?console.log(I.debugString()):console.log("Document root not found \u{1F630}"),I},logAndGetBaseScreen:()=>{let I=e.state().baseScreenNode();return I!=null?console.log(I.debugString()):console.log("Base screen not found \u{1F630}"),I},logAndGetNode:I=>{var L;let C=(L=e.state().scene())==null?void 0:L.findNode(I);return C!=null?console.log(C.debugString()):console.log(`Node with id ${I??"null"} not found!`),C},logAndGetNodeByStablePath:I=>{var L;let C=(L=e.state().scene())==null?void 0:L.findNodeByStablePath(ht.fromString(I));return C!=null?console.log(C.debugString()):console.log(`Node with stablePath ${I??"null"} not found!`),C},logAndGetRenderTree:I=>{var L,B;let C=(L=e.state().scene())==null?void 0:L.findNode(I);return C!=null?console.log(((B=C.renderTree1())==null?void 0:B.debugString1())??"null"):console.log(`Node with id ${I??"null"} not found!`),C.renderTree1()},logFakeError:I=>{mC(I)},setDebugUserChanges:I=>{Ba.debugUserChanges=I},fulfilledMultiplayerQueries:()=>r.fulfilledMultiplayerQueries(),ICSemanticStorageTrie:()=>{console.log(e.state().prototypeState().componentStateSyncer.debugString())},VideoSemanticStorageTrie:()=>{console.log(e.state().videoManager().runtimeStorage().toString1())},ScrollPositionStorageTrie:()=>{console.log(e.canvasView().scrollPositionSyncer().debugString())},getMemoryBreakdown:()=>{let I=F().modules().corePerfInfo;return{jsBuffers:I==null?void 0:I.getJsBufferMemory(),memStats:I==null?void 0:I.getMemStatsSummary()}}};K.getFeatureFlags().internal_only_debug_tools&&(window.DebuggingHelpers=y);let v={setObservingSessionID:I=>{if(!fc(I))throw new Error("Missing sessionID");let C=I|0;C!=r.observingSessionID()&&(r.setObservingSessionID(C),n.syncObservedFrameOrOverlay(!1),n.syncObservedVariableActions(!0),n.syncObservedVideoState(),K.getFeatureFlags().slides_iframe_embedded_prototypes_improvements?n.syncObservedEmbeddedPrototypeState(!0):n.syncObservedEmbeddedPrototypeState__OLD__(!0),n.syncObservedActiveEmbeddedPrototypes(),o.trigger("multiplayerUserInfoChange",n.userInfoJSON()),e.canvasView().viewport().invalidate())},nominatePresenter:I=>{if(!fc(I))throw new Error("Missing sessionID");r.nominatePresenter(I|0)},cancelPresenterNomination:I=>{if(!fc(I))throw new Error("Missing sessionID");r.cancelPresenterNomination(I|0)},startPresenting:()=>{r.startPresenting()},stopPresenting:()=>{r.stopPresenting()},setSlideSpeakerNotes:(I,C)=>{r.setSlideSpeakerNotes(I,C)},setInteractiveSlideConfigData:(I,C,L)=>{r.setInteractiveSlideConfigData(I,C,L)},setInteractiveSlideParticipantData:(I,C,L)=>{r.setInteractiveSlideParticipantData(I,C,L)},adjustZoom:(I,C)=>{e.canvasView().viewport().adjustCameraZoom2(1,I,C)},setZoom:(I,C)=>{e.canvasView().viewport().setCameraZoom(1,I)},zoomToNode:(I,C)=>{var B;let L=(B=e.state().scene())==null?void 0:B.findNode(Q.fromString(I));L!=null&&(e.state().setActiveCanvas(L.canvas()),e.canvasView().viewport().zoomToFit1(1,L.canvasSpaceBoundingBox(),C))},getClampedZoomBounds:()=>{var I;return{min:Math.max(xo.ZOOM_MIN,e.canvasView().viewport().getScaleFactorForCurrentTlf((I=e.state().baseScreenNode())==null?void 0:I.fullSize(),e.state().currentScalingInfo(),e.state().activePrototypeDevice())),max:xo.ZOOM_MAX}},getZoomBounds:()=>({min:xo.ZOOM_MIN,max:xo.ZOOM_MAX}),setCanvasSpaceCenter:(I,C)=>{let L=new O(-1*I.x,-1*I.y);e.canvasView().viewport().setCameraOffset2(1,L,C)},setCanvasSpaceCenterWithScroll:I=>{var U;let C=new O(I.x,I.y),L=(U=e.state().baseScreenNode())==null?void 0:U.canvasSpaceBoundingBox();if(L==null)return;let B=Math.max(C.x()-L.x(),0),V=Math.max(C.y()-L.y(),0),b=Math.max(B-L.width()/2,0),D=Math.max(V-L.height()/2,0);if(B!=0||V!=0){let H=new O(b,D);e.canvasView().updateScrollOffsetForNode(e.state().prototypeState().getTopmostScreen(),H)}},setScrollPadding:I=>{e.canvasView().setScrollPadding(+I.left,+I.top,+I.right,+I.bottom)},setScrollToPan:I=>{K.setScrollToPan(I)},setDragToPan:I=>{K.setDragToPan(I)},setShouldPlayVideosLinearly:I=>{K.setShouldPlayVideosLinearly(I)},injectVideoJsLib:I=>{vo.instance().onLoadComplete(I)},connectTo:(I,C)=>{let L={prototypeApp:Qn.instance,skewKiwiSerialization:m_(),deprecatedJsSceneHooks:Qn.instance};C(L).then(B=>{let V=B.cppModules;e.state().setFontListPromise(B.fontListPromise),K.getFeatureFlags().internal_only_debug_tools&&(y.fullscreen=V==null?void 0:V.sharedDebuggingHelpers,window.DebuggingHelpers=y);let b=I.fileKey,D=Q.fromString(I.nodeId);Q.isRoot(D)&&(D=null),K.getViewerMode()==K.ViewerMode.MIRROR&&p!=null?p.connectToFileAndShowNode(b,D,Q.fromString(I.startingPointNodeId),!!I.renderDots,V,I.editorType):e.connectTo(b,D,Q.fromString(I.startingPointNodeId),!!I.renderDots,V,I.editorType)})},openFileKey:()=>r.fileKey()??e.state().currentFileKey(),isConnected:()=>r.isConnected(),hasActiveScene:()=>e.state().scene()!=null,unloadSceneForTesting:()=>{r.disconnect(),e.state().prototypeState().resetPrototype(),e.state().setScene(null)},disconnectForTesting:()=>{r.disconnect()},reconnectForTesting:()=>{r.attemptReconnect()},enforceValidPrototypeStateForTesting:()=>{e.state().prototypeState().enforceValidPrototypeStateForTesting()},deleteNodeForTesting:I=>{let C=e.state().scene();if(C==null)throw new Error("No current scene");C.removeNode(Q.fromString(I))},translateNodeForTesting:(I,C,L)=>{let B=e.state().scene();if(B==null)throw new Error("No current scene");let V=B.findNode(I);if(V==null)throw new Error("Node not found");let b=V.relativeTransform().clone();b.translate2(C,L),V.setRelativeTransform(b)},addCanvasViewObserverForTesting:(I,C)=>{let L=new qf((B,V,b,D)=>{I()},B=>{C(B.scrollOffset().x(),B.scrollOffset().y())});f.push(L),e.canvasView().addObserver(L)},clearCanvasViewObserversForTesting:()=>{for(let I of f)e.canvasView().removeObserver(I);f=[]},sendMultiplayerNodeChangesForTesting:I=>{let C=e.state().scene();if(C==null)throw new Error("No current scene");let L=Ve().encodeMessage(I);C.applyMessageToScene(L)},setMockEmbedListener:I=>{el.setMockListener(I)},isPreloaded(){return e.state().isPreloaded},setMaximumDrawingBufferSizeForTesting:I=>{e.canvasView().setMaximumDrawingBufferSizeForTesting(I)},clearMaximumDrawingBufferSizeForTesting:()=>{e.canvasView().clearMaximumDrawingBufferSizeForTesting()},triggerResizeForTesting:()=>{e.canvasView().triggerResizeForTesting()},getVideoStateForNodeIdForTesting:I=>e.state().prototypeState().getVideoStateChangeForGuid(I),waitForAllVisibleVideosToLoadForTesting:()=>new Promise((C,L)=>{let B=1,V=()=>{e.state().prototypeState().allVisibleVideosAreLoaded()?C(!0):B>3?C(!1):(B++,setTimeout(V,B*1e3))};V()}),reset:()=>{e.state().prototypeState().resetState(),e.unloadSceneAndResetPrototypeLib()},loadFile:(I,C)=>{let L={prototypeApp:Qn.instance,skewKiwiSerialization:m_(),deprecatedJsSceneHooks:Qn.instance};C(L).then(B=>{let V=B.cppModules;e.state().setFontListPromise(B.fontListPromise),e.initializePrototypeLib(V),K.getFeatureFlags().internal_only_debug_tools&&(y.fullscreen=V==null?void 0:V.debuggingHelpers,window.DebuggingHelpers=y);let b=I.bytes,D=Q.fromString(I.nodeId);Q.isRoot(D)&&(D=null);let U=I.startingPointNodeId,H=I.imagePrefixURL,k=I.videoPrefixURL,z=I.renderDots,q=I.editorType;typeof H=="string"&&Vt.setImagePrefixURL(H),typeof k=="string"&&Vt.setVideoPrefixUrl(k),e.state().serialization().decodeSceneWithImages(b,"DUMMY_FILE_KEY").then(j=>{if(r.disconnect(),e.state().prototypeState().mostRecentBaseScreenIdChangeInitiator="externalAPI.loadFile",e.state().prototypeState().resetPrototype(),e.state().prototypeState().mostRecentFixInvalidStateInitiator="externalAPI.loadFile 1",e.state().setScene(j),e.state().setRenderDots(!!z),e.canvasView().setBackgroundEnabled(!z),e.state().setEditorType(q),e.canvasView().initializeThumbnailInvalidationManager(q),j.setAllTlfsLoaded(),K.getViewerMode()==K.ViewerMode.PROTOTYPE){let ae=e.state().scene().findNode(D);if(ae==null){let We=e.state().scene().findNode(Q.fromString(U));if(We!=null&&We.isTopLevel()&&hb(We)&&(ae=We),ae==null){let pt=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();pt.length>0&&(ae=e.state().scene().findNode(Q.fromString(pt[0])))}}e.state().prototypeState().mostRecentFixInvalidStateInitiator="externalAPI.loadFile 2",e.state().setActivePrototypeStartingPointNodeId(Q.fromString(U));let xe=e.state().prototypeStructure().nodeToRestartPrototypeOn(e.state().getActiveCanvas()),Je=ae==null?void 0:ae.topLevelAncestor();if(Je!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays(Je.id());else if(xe!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays(xe.id());else if(!ta)throw new Error("Calling loadFile in PROTOTYPE mode but with a file that isn't a valid prototype")}e.state().fontListPromise().then(()=>{o.trigger("sceneDidCompleteInitialLoad")})})})},navigateForward:I=>{e.canvasView().navigateForward(19,I)},navigateBackward:()=>{e.canvasView().navigateBackward(18)},navigateToFrameAndCloseOverlays:I=>{let C=Q.fromString(I);C!=null&&e.state().prototypeState().navigateToFrameAndCloseOverlays(C)},navigateToFrameAndCloseOverlaysOrRestart:I=>{let C=Q.fromString(I);C!=null&&e.state().prototypeState().navigateToFrameAndCloseOverlaysOrRestart(C,"externalAPI.navigateToFrameAndCloseOverlaysOrRestart")},navigateToFrameAtIndex:I=>{e.canvasView().navigateToFrameAtIndex(I)},navigateViaArrows:(I,C)=>{let L=e.state().prototypeStructure().navigationOrder().transitionDirectionBetweenFrames(Q.fromString(I),Q.fromString(C));e.canvasView().navigateViaArrows(I,C,L,null)},setPreloaded:I=>{e.state().isPreloaded=I},restartPrototype:()=>{e.state().prototypeState().restartPrototype(1)},forceFrame:()=>{e.window().forceFrame!=null&&x_(()=>{e.window().forceFrame()})},setScalingMode:I=>{typeof I=="string"?(I==="free"&&console.warn("setScalingMode('free') called "),e.state().prototypeState().setScalingInfoFromParameter(I)):I.hasOwnProperty("contentScalingMode")&&I.hasOwnProperty("viewportScalingMode")&&(I.viewportScalingMode==="free"&&console.warn("setScalingMode('free') called "),e.state().prototypeState().setScalingInfoFromParameter(I.viewportScalingMode,I.contentScalingMode)),e.state().prototypeState().getCurrentFitMode()=="min-zoom"&&e.canvasView().viewport().setCameraZoom(0,1)},getTransitionOnClick:()=>e.state().prototypeState().getTransitionOnClick(),setTransitionOnClick:I=>{e.state().prototypeState().setTransitionOnClick(I)},setShowHotspots:I=>{e.canvasView().setShowHotspots(I)},setShowDeviceFrame:I=>{e.state().prototypeState().setShowDeviceFrame(I),e.canvasView().viewport().invalidate()},setShowBareUI:I=>{e.state().prototypeState().setShowTransparentBackground(I),e.canvasView().viewport().invalidate()},setDisengageObservationOnClick:I=>{e.state().prototypeState().setDisengageObservationOnClick(I)},setInteractionsEnabled:I=>{e.state().prototypeState().setInteractionsEnabled(I)},toggleInteractionRecording:I=>{I?K2(e):e.window().stopRecordingInteractions()},getBackgroundColor:()=>oF(e),getPrototypeBackgroundColor:()=>iF(e),getPrototypeStartNodeId:()=>{let I=null,C=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();return C.length>0&&(I=Q.fromString(C[0])),I==null||!Q.isValid(I)?null:I},getActivePrototypeStartingPointNodeId:()=>{let I=e.state().activePrototypeStartingPointNodeId();return I==null||!Q.isValid(I)?null:I},setActivePrototypeStartingPointNodeId:I=>{let C=Q.fromString(I);e.state().activePrototypeStartingPointNodeId()!=C&&(e.state().prototypeState().mostRecentFixInvalidStateInitiator="externalAPI.setActivePrototypeStartingPointNodeId",e.state().setActivePrototypeStartingPointNodeId(C))},prototypeStartingPointsData:()=>{let I=e.state().prototypeStructure();return I==null?null:I.prototypeStartingPointsData()},getBaseScreenId:()=>e.state().baseScreenId(),isScalingModeResponsive:()=>e.state().currentScalingInfo().contentScalingMode==="responsive",getCurrentOverlayIdsForTesting:()=>e.state().prototypeState().getCurrentOverlayIds().map(I=>I),getOnscreenStatesForTesting:()=>e.state().prototypeState().getOnscreenStates().map(I=>({stablePath:I.a.guids.map(C=>C),stateId:I.b})),getRelativeTransformForNode:I=>{var L;let C=(L=e.state().scene())==null?void 0:L.findNode(Q.fromString(I));return C?C.relativeTransform().clone():null},pageIdForNodeId:I=>{var B;let C=e.state().scene();if(C==null)return null;let L=C.findNode(I);return(B=L==null?void 0:L.findContainingCanvasOrSelf())==null?void 0:B.id()},navigationOrderType:()=>e.state().prototypeStructure().navigationOrder().navigationOrderTypeString(),supportsLinearNavigationOrder:()=>e.state().prototypeStructure().isLinear(),requestPage:I=>{var V;let C,L=Q.fromString(I),B=(V=e.state().scene())==null?void 0:V.findNode(L);B!=null&&B.type()=="CANVAS"&&e.state().requestSetActiveCanvas(B)},setCurrentPageId:I=>{var V;let C,L=Q.fromString(I),B=(V=e.state().scene())==null?void 0:V.findNode(L);B!=null&&B.type()=="CANVAS"&&e.state().setActiveCanvas(B)},getCurrentPageId:()=>{var C;let I=e.state().getActiveCanvas();return(C=I==null?void 0:I.findContainingCanvasOrSelf())==null?void 0:C.id()},getNodesToShowInPrototype:()=>e.state().prototypeStructure().navigationOrder().topLevelPrototypeNodesInOrder(),getStatsForAnalytics:()=>{var L,B;let I=e.state().getActiveCanvas();if(I==null)throw new Error("Asking for stats without an active canvas");let C=I.prototypeDevice();return{pageId:I.id(),deviceType:C.type,deviceSizeWidth:C.size().x(),deviceSizeHeight:C.size().y(),presetIdentifier:C.presetIdentifier,graphicsCardName:e.canvasView().graphicsCardName(),isHardwareAccelerationDisabled:CC(e.canvasView().getContext()),isHighDPR:K.isHighDPR(),fastImageDecode:nn.browserSupportsFastImageDecoding(),baseScreenWidth:(L=e.state().baseScreenNode())==null?void 0:L.fullSize().x(),baseScreenHeight:(B=e.state().baseScreenNode())==null?void 0:B.fullSize().y(),isInlinePreview:K.isInlinePreview()}},getPrototypeDeviceType:()=>{let I=e.state().getActiveCanvas();return I==null?(we("Asking for prototype device type without a playback canvas"),"NONE"):I.prototypeDevice().type},getStoredPrototypeDevice:()=>{let I=e.state().getActiveCanvas();return I==null?null:I.storedPrototypeDevice()},setStoredPrototypeDevice:I=>{let C=e.state().getActiveCanvas();return C==null?(we("Trying to set prototype device type without a playback canvas"),null):I==null?(we("Trying to set null prototype device type"),null):C.setPrototypeDevice(ut.decodePrototypeDevice(I))},getCurrentTlfBounds:(I=!1)=>{var B;let C=(B=e.state().baseScreenNode())==null?void 0:B.canvasSpaceBoundingBox(),L=x.new2();return C==null?null:I?$p(C):(C.transformInto2(L,e.canvasView().canvasSpaceToWindowSpace()),$p(L))},setUserDidAttemptZoom:I=>{e.canvasView().userDidAttemptZoom=C=>{I(kT[C])}},getCanvasSpaceBoundsByNodeId:I=>{let C={},L=e.state().scene();if(L==null)throw new Error("No current scene");for(let B of I){let V=Q.fromString(B);if(V==null)continue;let b=L.findNode(V);if(b==null)continue;let D=b.canvasSpaceBoundingBox();C[B]=new Map([["x",D.x()],["y",D.y()],["width",D.width()],["height",D.height()]])}return C},getFullSizeByNodeId:I=>{let C=e.state().scene();if(C==null)throw new Error("No current scene");let L=Q.fromString(I);if(L==null)return null;let B=C.findNode(L);return B==null?null:B.fullSize().toJSON()},watchBoundsForNodes:I=>{let C=z2(I);i.setNodesWithComments(C)},getPrototypeStateCurrentIndex:()=>e.state().prototypeState().getCurrentBaseScreenIndex(),getNavigateForwardEnabled:()=>e.state().prototypeStructure().navigationOrder().getNavigateForwardEnabled(),getNavigateBackwardEnabled:()=>e.state().prototypeStructure().navigationOrder().getNavigateBackwardEnabled(),getPages:()=>a.pages(),viewport:()=>{let I=e.canvasView().viewport(),C=I.offset(),L=I.zoomScale();return{offset:{x:C.x(),y:C.y()},zoomScale:L}},getStatsForDebugging:()=>Kr.getStatsForDebugging(),getGPUMemoryTotal:()=>e.canvasView().getContext().stats().total(),getGPUMemoryStats:()=>{let I=e.canvasView().getContext().stats();return{textures:I.forType(0),vertexBuffers:I.forType(1),renderBuffers:I.forType(2),uniformBuffers:0}},on:o.on.bind(o),off:o.off.bind(o),trigger:o.trigger.bind(o),playbackInteraction:I=>{if(m==2){let C=Ld.deserialize(I,E,P,S);e.window().notify(C)}},setNewContainerElement:I=>{e.window().setNewContainerElement(I)},editorTypeForTesting:()=>e.state().editorType(),canvasViewCursorForTesting:()=>eh[e.canvasView().cursor()],lastTopLevelTransitionPropertiesForTesting:()=>{let I=e.state().prototypeState().lastInitiatedTopLevelStateChange();return I==null||I.transitionParameters==null?null:{type:I.transitionParameters.transitionType,durationSeconds:I.transitionParameters.transitionDuration}},lastICTransitionPropertiesForTesting:()=>{let I=e.state().prototypeState().lastInitiatedInstanceStateChange();return I==null||I.transitionParameters==null?null:{type:I.transitionParameters.transitionType,durationSeconds:I.transitionParameters.transitionDuration}},scrollOffsetForNodeInBaseScreenForTesting:I=>{let C=e.state().scene();if(C==null)return{};let L=C.findNode(I);return L!=null?L.scrollOffset().toJSON():O.new().toJSON()},scrollOffsetForNodeInOverlayAtForTesting:(I,C)=>{let L=e.state().scene();if(L==null)return{};let B=L.findNode(I);return B!=null?B.scrollOffset().toJSON():O.new().toJSON()},getCanvasSpaceCommentLocations:I=>{let C=e.state().scene();if(C==null)return{};let L=new Map;for(let B in I)L.set(B,pc.fromJSON(I[B]));return i.getCanvasSpaceCommentLocations(C,L)},getCommentDestinationAtPosition:I=>{let C=new O(I.x,I.y),L=i.getCommentDestinationAtPosition(C);return L==null?null:L.toJSON()},onChange:I=>{var C;return(C=e.state().scene())==null?void 0:C.onChange(I)},getRevisionNumber:()=>{var I;return(I=e.state().scene())==null?void 0:I.getRevisionNumber()},setLoadFullDocument:I=>e.multiplayerSession().incrementalLoader().dangerouslySetLoadFullDocument(I),preloadAllImages:()=>{e.state().imageManager().preloadAllImages()},preloadAllVideos:()=>e.state().videoManager().preloadAllVideos(),unloadAllVideos:()=>{e.state().isPreloaded=!1,e.state().prototypeState().restartPrototype(1),e.state().videoManager().unloadAllVideos()},associateYoutubeWithNode:(I,C)=>{e.state().videoManager().associateYoutubeWithNode(I,C)},disassociateYoutubeWithNode:I=>{e.state().videoManager().disassociateYoutubeWithNode(I)},hasVideoControls:I=>{var L;let C=(L=e.state().scene())==null?void 0:L.findNode(I);return(C==null?void 0:C.videoPlayback().showControls)??!1},hasVideoRuntimes:I=>!!e.state().videoManager().getVideoRuntimesForNode(I),subscribeToVideoRuntimeUpdates:I=>e.state().videoManager().subscribeToVideoRuntimeUpdates(I),getHtmlVideoElementForNode:I=>{let C=e.state().videoManager().getVideoRuntimesForNode(I);if(C==null)return null;for(let L of C.values()){let B=L.getHtmlVideoElement();if(B!=null)return B}return null},playVideoRuntimesForNode:I=>{let C=dr.NULL_ACTION.withTransitionNodeID(I).withMediaAction("PLAY");e.state().videoManager().updateVideoRuntime(C,I)},pauseVideoRuntimesForNode:I=>{let C=dr.NULL_ACTION.withTransitionNodeID(I).withMediaAction("PAUSE");e.state().videoManager().updateVideoRuntime(C,I)},setIsSeekingVideoRuntimesForNode:(I,C)=>{let L=e.state().videoManager().getVideoRuntimesForNode(I);if(L==null)return null;for(let B of L.values())B.setIsSeeking(C)},skipToVideoRuntimesForNode:(I,C)=>{let L=dr.NULL_ACTION.withTransitionNodeID(I).withMediaAction("SKIP_TO").withMediaSkipToTime(C);e.state().videoManager().updateVideoRuntime(L,I)},muteVideoRuntimesForNode:I=>{let C=dr.NULL_ACTION.withTransitionNodeID(I).withMediaAction("MUTE");e.state().videoManager().updateVideoRuntime(C,I)},unmuteVideoRuntimesForNode:I=>{let C=dr.NULL_ACTION.withTransitionNodeID(I).withMediaAction("UNMUTE");e.state().videoManager().updateVideoRuntime(C,I)},preloadDeviceFrames:(I,C)=>{(async()=>(await e.canvasView().deviceRenderer().preloadDeviceImage(ut.decodePrototypeDevice(I)),await Promise.all(C.map(L=>e.canvasView().deviceRenderer().preloadDeviceImage(ut.decodePrototypeDevice(L))))))()},getNodeByIdForTests(I){var C;return(C=e.state().scene())==null?void 0:C.findNode(I)},initialLoadFrames(){return[e.state().baseScreenNode().parent().parent()]},loadFrames:(I,C)=>{let L=0,B=[];for(;I.length>0&&B.length+L<50;){let V=I.pop();if(V!=null){if(V.isTopLevel()&&(V.type()=="FRAME"||V.type()=="SLIDE")&&!V.isInternalOnly())if(V.hasBeenLoaded())L+=1;else{B.push(V);continue}(V.type()=="DOCUMENT"||V.type()=="CANVAS"||V.type()=="SECTION"||V.type()=="SLIDE_GRID"||V.type()=="SLIDE_ROW"||V.isSlideModule())&&!V.isInternalOnly()&&V.forEachChild(b=>{I.push(b)})}}return{nodesToVisit:[...I,...B],numLoaded:C+L}},areAllImagesLoaded:()=>e.state().imageManager().getImageLoadingProgress(),areAllVideosLoaded:I=>e.state().videoManager().getVideoLoadingProgress(I),getThumbnailForNode:(I,C,L)=>{var q;let B=(q=e.state().scene())==null?void 0:q.findNode(I);if(!B||!B.hasBeenLoaded())return console.error("Cannot get thumbnail for node that has not been loaded",I),null;let V=B.fullSizeCanvasSpaceBoundingBox().topLeft(),b=B.fullSize().x()/C,D=B.fullSize().y()/L,U=Math.max(b,D),H=new mn(V,U);return e.canvasView().thumbnailRenderer().generateThumbnail(B,H,C,L)},isWaitingForDeviceFrameToLoadForTesting:()=>{var C;let I=e.state().getActiveCanvas();return I==null?!1:(C=e.canvasView().deviceRenderer())==null?void 0:C.isWaitingForDeviceFrameToLoad(I.prototypeDevice())},prototypeViewHitTest:I=>{let C=new O(I.x,I.y),L=e.state().baseScreenNode();return L==null?{type:"NONE"}:e.canvasView().hitTestDeviceFrame(C)?{type:"DEVICE_FRAME"}:L.canvasSpaceBoundingBox().contains2(C)?{type:"CURRENT_TLF"}:{type:"PROTOTYPE_BACKGROUND"}},getPrototypeNode:I=>{var C;return(C=e.state().scene())==null?void 0:C.findNode(I)},getPrototypeNodeHasLoaded:I=>{var L;let C=(L=e.state().scene())==null?void 0:L.findNode(I);return(C==null?void 0:C.hasBeenLoaded())??!1},getTopmostFrameNode:I=>e.state().prototypeState().getTopmostScreen(),mapChildren:(I,C)=>{let L=[];if(I.isStack())for(let B=0,V=I.childCount();B<V;B=B+1)L.push(C(I.childAt1(B)));else for(let B=0,V=I.childCount();B<V;B=B+1)L.push(C(I.childAt1(I.childCount()-B-1)));return L},nodeId:I=>I.id(),nodeName:I=>I.name(),nodeParent:I=>I.parent(),nodeType:I=>I.type(),nodeCanvasSpaceBounds:I=>$p(I.canvasSpacePreviewBounds()),nodeAbsoluteTransform:I=>I.absoluteTransform(),nodeShapeWithTextType:I=>I.shapeWithTextType(),nodeDisplayBounds:I=>{let C=null;if(I.isTopLevel()){let L=e.state().prototypeState().getOpenOverlayData(I.id());L!=null?C=L.renderedBounds(e.state().prototypeState().getCurrentBaseScreenNode()):C=I.canvasSpaceScrolledBounds(1),C=e.canvasView().viewport().canvasSpaceToViewSpace1().transformRect(C.clone())}else{let L=I.fullSize(),B=new x(0,0,L.x(),L.y()),V=I.relativeTransform().clone(),b=X.new2();b.scale2(e.canvasView().viewport().canvasSpaceToViewSpace1().scale()),V.leftMultiply(b),C=V.transformRect(B)}return $p(C)},nodeFullSize:I=>{if(I.type()=="CANVAS")return null;let C=I.fullSize(),L=new x(0,0,C.x(),C.y());return $p(L)},nodeFillTypes:I=>I.fillPaints().map(C=>C.type()),nodeInteractions:I=>I.prototypeInteractions().filter(C=>{var L;return C.action()!=null&&((L=C.action())==null?void 0:L.value.connectionType())!="NONE"}).map(C=>W2(C)),nodeScrollBounds:I=>{let C=null;if(I.hasOverflowingContentInScrollDirection()){let L=I.canvasSpaceContentBounds(),B=I.scrollOffset();C={x:B.x(),y:B.y(),width:L.width(),height:L.height()}}return C},nodeScrollTo:(I,C,L)=>{I.setScrollOffset(new O(C,L))},nodeText:I=>{var C;return(C=I==null?void 0:I.textData())==null?void 0:C.characters()},nodeVisible:I=>I==null?!1:I.visible(),nodeAccessibilityProperties:I=>({label:I.accessibleLabel()}),nodeCharacterStyles:I=>{var L,B,V;let C=(L=I==null?void 0:I.textData())==null?void 0:L.characters();if(C!=null){let b=Sr._new();Sr.set(b,6,I.get(6));let D=(B=I==null?void 0:I.textData())==null?void 0:B.characterStyleIds(),U=((V=I==null?void 0:I.textData())==null?void 0:V.styleOverrideTable())??new Sn,H=D!=null?D.length:0,k=0,z=0,q=[],Y=(j,ae,xe)=>{let Je=new Map;Sr.each(b,(pt,Mt)=>{Je.set(Lt[pt],Mt)});let We=U==null?void 0:U.styleByID2();if(We!=null){let pt=Xt.IntMap_get(We,xe,null);pt!=null&&Sr.each(pt,(Mt,nr)=>{Je.set(Lt[Mt],nr)})}q.push({start:j,end:ae,props:Je})};for(let j=0,ae=C.length;j<ae;j=j+1){let xe=H>j?D[j]:0;U._in(xe)||(xe=0),k!=xe&&(Y(z,j,k),k=xe,z=j)}return Y(z,C.length,k),q}else return[]},nodeLineData:I=>{var L;let C=(L=I==null?void 0:I.textData())==null?void 0:L.lines();return C!=null?C.map(B=>({indentLevel:B.indentationLevel,lineType:B.lineType})):null},nodeTriggerInteraction:(I,C)=>{let L=0;C=="ON_CLICK"&&(L=4);let B=e.state().prototypeStructure().findHotspotsWithInteractionType(I,0,C);for(let V of B){let b=e.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(V.node,C);for(let D of b){e.canvasView().triggerHotspot(V,D,L,null);return}}},nodeHover:I=>{let C=new Ci(I);e.canvasView().handleHoverAtHotspot(C)},nodeReverseHover:I=>{let C=new Ci(I);e.canvasView().handleReverseHoverAtHotspot(C)},nodeTableCells:I=>{if(I.type()!="TABLE")return null;let C=[];for(let L=0,B=I.childCount();L<B;L=L+1)C.push(I.childAt1(I.childCount()-L-1));return C},nodeTableCellContent:I=>{var C,L;return I.type()!="TABLE_CELL"?null:(L=(C=I.childAt1(0))==null?void 0:C.textData())==null?void 0:L.characters()},nodeInteractiveSlideElementType:I=>I.interactiveSlideElementType(),nodeInteractiveSlideConfigData:I=>I.interactiveSlideConfigData(),nodeInteractiveSlideParticipantData:I=>I.interactiveSlideParticipantData(),nodeSlideSpeakerNotes:I=>I.slideSpeakerNotes(),nodeIsSkippedSlide:I=>I.isSkippedSlide(),nodeSlideThumbnailHash:I=>I.slideThumbnailHash(),isPresenterSession:()=>e.multiplayerSession().isPresenterSession(),userSessionId:()=>e.multiplayerSession().sessionID(),observingSessionId:()=>e.multiplayerSession().observingSessionID(),setEmbeddedPrototypeSession:(I,C)=>{K.getFeatureFlags().slides_iframe_embedded_prototypes_improvements?e.state().embeddedPrototypeManager().setSessionId(I,C):e.multiplayerSession().handleEmbeddedPrototypeChange(I,C)},isActiveSlidesEmbeddedPrototype:I=>K.getFeatureFlags().slides_iframe_embedded_prototypes_improvements?e.state().embeddedPrototypeManager().isActiveSlidesEmbeddedPrototype(I):e.state().prototypeState().getActiveSlidesPrototypeEmbedGUID()===I,setActiveSlidesEmbeddedPrototype:I=>{K.getFeatureFlags().slides_iframe_embedded_prototypes_improvements?e.state().embeddedPrototypeManager().requestPrototype(I):e.state().prototypeState().setActiveSlidesPrototypeEmbedGUID(I)},getCurrentOverlayStack:()=>e.state().prototypeState().getCurrentOverlays().map(I=>I.node()),setFeatureFlagsForTesting:I=>{K.setFeatureFlags(I)},setPrototypeBackgroundColorOverride:I=>{let C=N.new2(I>>16&255,I>>8&255,I&255,255);K.setPrototypeBackgroundColorOverride(new pe(C))},resetStateForTests:()=>{e.canvasView().resetStateForTests(),e.window().resetStateForTests()},resetRendererForTests:()=>{e.canvasView().makeRenderer()},takeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().getContext().takeSpectorSnapshot()},clearTileCachesAndTakeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().getContext().takeSpectorSnapshot()},renderLayerByLayerActivate:()=>{K.internalDebugTools()&&(e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().renderLayerByLayerActivate())},renderLayerByLayerDeactivate:()=>{K.internalDebugTools()&&e.canvasView().renderLayerByLayerDeactivate()},renderLayerByLayerPlay:()=>{K.internalDebugTools()&&e.canvasView().renderLayerByLayerPlay()},renderLayerByLayerPause:()=>{K.internalDebugTools()&&e.canvasView().renderLayerByLayerPause()},renderLayerByLayerForward:()=>{K.internalDebugTools()&&e.canvasView().renderLayerByLayerForward()},renderLayerByLayerBackward:()=>{K.internalDebugTools()&&e.canvasView().renderLayerByLayerBackward()},renderLayerByLayerRewind:()=>{K.internalDebugTools()&&e.canvasView().renderLayerByLayerRewind()},renderLayerByLayerIncreaseSpeed:()=>{K.internalDebugTools()&&e.canvasView().renderLayerByLayerIncreaseSpeed()},renderLayerByLayerDecreaseSpeed:()=>{K.internalDebugTools()&&e.canvasView().renderLayerByLayerDecreaseSpeed()},convertCanvasSpaceToViewportSpace:I=>{let L=e.canvasView().viewport().canvasSpaceToViewSpace1().clone().transformPoint(new O(I[0],I[1]));return[L.x(),L.y()]},isRecordingCommands:()=>e.state().prototypeRecorder().isRecording(),beginRecordingCommands:()=>{e.state().prototypeRecorder().startRecording()},stopRecordingCommands:()=>(e.state().prototypeRecorder().stopRecording(),e.state().prototypeRecorder().getHistory()),getCurrentRecording:()=>e.state().prototypeRecorder().getHistory(),getNodeNameByGuid:I=>{if(e.state().scene()==null)return"";var C=null;return ht.fromString(I)?C=e.state().scene().findNodeByStablePath(ht.fromString(I)):C=e.state().scene().findNode(Q.fromString(I)),C===null?"":C.name()},getNodeNameByStablePath:I=>{if(e.state().scene()==null)return"";let C=ht.fromString(I),L=e.state().scene().findNodeByStablePath(C);return L===null?"no name":L.name()},getInteraction:(I,C)=>{var D,U,H,k;if(e.state().scene()==null)return"";var L=null;if(ht.fromString(I)!=null?L=e.state().scene().findNodeByStablePath(ht.fromString(I)):L=e.state().scene().findNode(I),L==null)return"";let B=L.findPrototypeInteraction(Q.fromString(C)),V=(U=(D=B==null?void 0:B.action())==null?void 0:D.value)==null?void 0:U.connectionType();var b=V==null?void 0:V.toString();return V=="INTERNAL_NODE"&&(b=(k=(H=B==null?void 0:B.action())==null?void 0:H.value)==null?void 0:k.navigationType().toString()),b},runProtoCommand:I=>{var C;if(I.type!="MISCLICK")if(I.action==6||I.action==0)e.state().prototypeState().returnInstanceToState(ht.fromString(I.targetPath??""),2,6);else if(I.action==16){let L=e.state().scene().findNodeByStablePath(ht.fromString(I.targetPath??""));if(!I.scrollOffset)throw new Error("sessionAction.scrollOffset is undefined");let B=new O(I.scrollOffset.x,I.scrollOffset.y);e.canvasView().scrollNode(L.id(),ci.ScrollSource.SCROLL_EVENT,B,null)}else{let L=(C=e.state().scene())==null?void 0:C.findNodeByStablePath(ht.fromString(I.targetPath??"")),B=rt.mapToInteractionType(I.action);v.nodeTriggerInteraction(L,B)}},toggleRenderTreePrinting:()=>{K.internalDebugTools()&&e.canvasView().toggleRenderTreePrinting()},getAndClearHistogramBatchFields:()=>qn.getAndClearHistogramBatchFields(),getAndClearSlowFrameTrackerFields:()=>qn.getAndClearSlowFrameTrackerFields(),clearAllSlowFrameTrackerFields:()=>{qn.clearAllSlowFrameTrackerFields()},getViewerGpuMetricsCurrentFrameJSON:()=>JSON.stringify(e.canvasView().dangerouslyAccessProtoRenderManager().getContext().getGpuMetricsCollection().getCurrentFrameGPUMetrics()),getViewerGpuMetricsPreviousFrameJSON:()=>JSON.stringify(e.canvasView().dangerouslyAccessProtoRenderManager().getContext().getGpuMetricsCollection().getPreviousFrameGPUMetrics()),gpuMetricsNextFrame:I=>{e.canvasView().dangerouslyAccessProtoRenderManager().getContext().getGpuMetricsCollection().nextFrame(I)},setProtoUseFrameEvictionForUnitTests:I=>{K.setProtoUseFrameEvictionForUnitTests(I)},invalidateCanvas:()=>{e.canvasView().viewport().invalidate()}};return!1,Qn.instance.setViewer(v),v}function Q2(){return{prototypeApp:Qn.instance,skewKiwiSerialization:m_(),deprecatedJsSceneHooks:Qn.instance}}function cF(){let t=window,e=t.Fig;e||(t.Fig=e={}),e.createViewer=async r=>{if(delete e.createViewer,!(r instanceof Object))throw new Error("Missing parameters");return await Y2(r)},e.getPrototypeAppBindingsForTest=()=>(delete e.getPrototypeAppBindingsForTest,Q2())}var dg=class dg{setSerialization(e){this._serialization=e}decodeCodeSnapshot(e){let r=Ve().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=null;try{let l=r.nodeChanges[0];n=this._serialization.decodePaints(l.codeSnapshot.paints,r.blobs)}catch(l){we("Caught error during fill paints marshaling. Rendered output may be incorrect"),we(l),n=[]}let o=ut.decodeVector(r.nodeChanges[0].codeSnapshot.offset),i=ut.decodeVector(r.nodeChanges[0].codeSnapshot.layoutSize),a=ut.decodeVector(r.nodeChanges[0].codeSnapshot.canvasSize),s=r.nodeChanges[0].codeSnapshot.devicePixelRatio;return new Mc(n,o,i,a,s)}decodeFillPaintData(e){if(e.length==0)return Se.EMPTY;let r=Ve().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=null;try{let o=r.nodeChanges[0],i=o.fillPaints!=null?o.fillPaints:o.strokePaints;n=this._serialization.decodePaints(i,r.blobs)}catch(o){we("Caught error during fill paints marshaling. Rendered output may be incorrect"),we(o),n=Se.EMPTY}return n}decodeSingleSolidFillWithNormalBlendMode(e,r,n){if(e.alpha!=1)throw new Error("Alpha from C++ is always expected to be 1");let o=new ee("SOLID");return o.setColor(N.new3(e.red,e.green,e.blue,e.alpha)),o.setOpacity(r),o.setIsEnabled(n),[o]}decodeEffectData(e){let r=Ve().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return ut.decodeEffects(r.nodeChanges[0].effects)}decodeTransformModifierData(e){let r=Ve().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return ut.decodeTransformModifiers(r.nodeChanges[0].transformModifiers)}decodePrototypeInteractions(e){let r=Ve().decodeNodeChange(e);if(r==null)throw new Error("Got bad node change from C++");return ut.decodePrototypeInteractions(r.prototypeInteractions)}decodeVectorData(e){let r=Ve().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return this._serialization.decodeVectorData(r.nodeChanges[0].vectorData,r.blobs)}decodeTextData(e){let r=Ve().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=this._serialization.decodeTextData(r.nodeChanges[0].textData,r.blobs);return new Ca(n.styleOverrideTable(),n.fontSizes(),n.characters(),n.lines(),n.characterStyleIds())}decodeDerivedTextData(e,r,n){let o=Ve().decodeMessage(e);if(o.nodeChanges===void 0||o.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let i=this._serialization.decodeDerivedTextData(o.nodeChanges[0].derivedTextData,o.blobs),a=[];for(let s of r)a.push(this._serialization.decodeEmojiImage(s,n));return new Ks(i.hyperlinkBoxes(),r,a)}constructor(){this._serialization=null}};dg.instance=new dg;var cg=dg;function dF(){IC(new cg)}function q2(){dF(),cF()}q2();})();
//!!!!!!!!!!!!!!!!!!!!!!
/*! Bundled license information:

diff/dist/diff.js:
  (*!
  
   diff v3.5.0
  
  Software License Agreement (BSD License)
  
  Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>
  
  All rights reserved.
  
  Redistribution and use of this software in source and binary forms, with or without modification,
  are permitted provided that the following conditions are met:
  
  * Redistributions of source code must retain the above
    copyright notice, this list of conditions and the
    following disclaimer.
  
  * Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the
    following disclaimer in the documentation and/or other
    materials provided with the distribution.
  
  * Neither the name of Kevin Decker nor the names of its
    contributors may be used to endorse or promote products
    derived from this software without specific prior
    written permission.
  
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  @license
  *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=https://admin.figma.com/admin/viewerbuild-artifacts/2e531499f70da5b564860a4f1319ca06315f2613/ts-viewer.js.map

//# debugId=d004f489-c08d-5553-9688-0dbfbc4fd095
