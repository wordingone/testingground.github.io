"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="28ec32cc-20fe-5fa5-b62d-8fc459ba0686")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[3814],{115753:(e,t,n)=>{n.d(t,{A:()=>a});let a=new(n(573349)).b({name:"FigmaScope",dependencies:[],exports:[],routeHints:[],enforce:!1,friendFiles:[],eslint:{rules:{"react/no-array-index-key":"off","@typescript-eslint/no-explicit-any":"off"}}})},430781:(e,t,n)=>{n.d(t,{J:()=>a});let a="dragged_styles--transparent--k4E4U"},784372:(e,t,n)=>{n.d(t,{Fd:()=>i,GE:()=>o,KM:()=>a,Y$:()=>r});let a="multiplayer_viewport_overlay--viewportFrame--QsDIw",o="multiplayer_viewport_overlay--multiplayerBellOuterContainer--nFGro",r="multiplayer_viewport_overlay--prototypeView---d4-5",i="multiplayer_viewport_overlay--delayTransition--YaWi4"},740623:(e,t,n)=>{n.d(t,{ET:()=>o,HG:()=>l,Jy:()=>d,M4:()=>p,OP:()=>m,RT:()=>s,RX:()=>c,dG:()=>i,eP:()=>r,iE:()=>a,t$:()=>u});let a="face_stamps--stamp--W89mK",o="face_stamps--miniStampContainer--SDVwN",r="face_stamps--stampImagePlaceholder--pXueE",i="face_stamps--miniStamp--8eY9E",l="face_stamps--stampContainer--pSzJJ",s="face_stamps--faceStampButton--Ivbob",c="face_stamps--draggingStamp--fb7wV",d="face_stamps--draggingCopy--iNJaR",m="face_stamps--faceLabel--L-WBK ellipsis--ellipsis--Tjyfa",u="face_stamps--faceLabelPlaceholder--E9aYz",p="face_stamps--nonMiniStampPlaceholderContainer--QGaUd"},770360:(e,t,n)=>{n.d(t,{Dp:()=>C,Eu:()=>s,GW:()=>p,Gf:()=>r,IO:()=>h,Kk:()=>b,Ms:()=>d,N1:()=>g,Rq:()=>w,Vy:()=>c,Xg:()=>f,Y$:()=>v,_Q:()=>y,_q:()=>E,hQ:()=>o,iO:()=>m,jT:()=>a,se:()=>l,ts:()=>_,wK:()=>u,yV:()=>i});let a="insert_media_modal--modalContainer--uNx1u",o="insert_media_modal--contentContainer--wh-bQ",r="insert_media_modal--sectionTitle--AkeLl text--fontPos11--2LvXf text--_fontBase--QdLsd",i="insert_media_modal--sectionDescription--potid text--fontPos11--2LvXf text--_fontBase--QdLsd",l="insert_media_modal--sectionDescriptionLink--Atf7X text--fontPos11--2LvXf text--_fontBase--QdLsd",s="insert_media_modal--embedsSection--KStKI insert_media_modal--section--d-vDa",c="insert_media_modal--embedEntryContainer--tK18E",d="insert_media_modal--embedTextBoxRow--crqIf",m="insert_media_modal--embedTextBoxContainer--q2IEG",u="insert_media_modal--embedTextBox--K5yUk",p="insert_media_modal--embedTextBoxBorder--vGy-s",h="insert_media_modal--embedTextBoxBorderError--h0-ou",f="insert_media_modal--embedTextBoxIcon--tlB4V",_="insert_media_modal--examplesContainer--G4gFh",g="insert_media_modal--headerContainer--Tb6A1",v="insert_media_modal--exampleHeader--j6rti text--fontPos11--2LvXf text--_fontBase--QdLsd",E="insert_media_modal--iconsContainer--oOP2I",b="insert_media_modal--icon--66XmK",y="insert_media_modal--iconLink--XCWwX",C="insert_media_modal--iconImage--HHKPc",w="insert_media_modal--embedAddButton--XRIWX"},630478:(e,t,n)=>{n.d(t,{ME:()=>o,hd:()=>a,nw:()=>r});let a="reconnecting_modal--reconnectingModal--zB52E",o="reconnecting_modal--reconnectingModalAnimate--OCvjJ",r="reconnecting_modal--reconnectingModalFlash--KXUlq"},132424:(e,t,n)=>{n.d(t,{BF:()=>u,Cm:()=>y,H2:()=>v,KE:()=>s,LC:()=>p,LT:()=>c,QH:()=>f,R3:()=>i,Te:()=>a,Uf:()=>w,W7:()=>d,WF:()=>_,Wh:()=>h,XF:()=>P,dv:()=>I,g_:()=>b,iE:()=>l,iG:()=>o,iw:()=>x,k$:()=>m,kk:()=>T,rf:()=>k,sl:()=>g,tL:()=>E,yu:()=>C,zc:()=>r});let a="voice_toolbar--audioButtonInDropdown--lmLzR",o="voice_toolbar--centeredContainer--h6AK-",r="voice_toolbar--iconContainer--LjNP5 voice_toolbar--centeredContainer--h6AK-",i="voice_toolbar--avatarWrapper--t-5vS",l="voice_toolbar--wrapper--MHTQ-",s="voice_toolbar--toolbar--co357 voice_toolbar--centeredContainer--h6AK-",c="voice_toolbar--toolbarOverflowHiddenWhileAnimating--qBMho",d="voice_toolbar--toolbarBorder--BT0R2",m="voice_toolbar--activeToolbarBorderParent--jsMm1",u="voice_toolbar--ongoingCallToolbarBorderParent--cmLFf",p="voice_toolbar--noCallToolbarBorderParent--OQ7Oe",h="voice_toolbar--volumeIcon--U-TCI",f="voice_toolbar--audioIconNotJoined---DG1Y",_="voice_toolbar--audioIconUnavailableSpan--H1YdE",g="voice_toolbar--audioIconDisabled--gCpOC",v="voice_toolbar--audioIconToolbar--nW-XS",E="voice_toolbar--audioIconMenu--trTHP",b="voice_toolbar--headphoneContainerWithHover--pTh5Y voice_toolbar--iconContainer--LjNP5 voice_toolbar--centeredContainer--h6AK-",y="voice_toolbar--voiceToolbarInnerWithJoinCall--Xu27i voice_toolbar--_voiceToolbarInnerBase--eFNzx voice_toolbar--centeredContainer--h6AK-",C="voice_toolbar--joinCopy--YVidt",w="voice_toolbar--voiceToolbarInner--hruxy voice_toolbar--_voiceToolbarInnerBase--eFNzx voice_toolbar--centeredContainer--h6AK-",x="voice_toolbar--audioIcon--XaW03 voice_toolbar--centeredContainer--h6AK-",k="voice_toolbar--numParticipants--wS2AS",I="voice_toolbar--numParticipantsInClosedWidgetStateNew--emfkW",T="voice_toolbar--centeredContainerWithHover--wGcWC voice_toolbar--centeredContainer--h6AK-",P="voice_toolbar--avatarObserveClickTarget--QALFw"},694413:(e,t,n)=>{n.d(t,{Ge:()=>c,JY:()=>a,V6:()=>s,VF:()=>l,f_:()=>i,r3:()=>r,s:()=>o});let a="dlt_universal_insert_collage--universalInsertCollageIcon--1oKSL",o="dlt_universal_insert_collage--collageIconContainer--Mkqay",r="dlt_universal_insert_collage--ignorePointerEvents--G4rRr",i="dlt_universal_insert_collage--collageScaleContainer--uLvqK",l="dlt_universal_insert_collage--collageImage--LdlFw",s="dlt_universal_insert_collage--errorBoundaryFallback--6P7SR",c="dlt_universal_insert_collage--universalInsertCollageIconContainer--yExun"},10897:(e,t,n)=>{n.d(t,{C0:()=>s,D9:()=>C,EA:()=>g,O8:()=>b,QE:()=>u,Qf:()=>_,SD:()=>h,TK:()=>i,UD:()=>a,W0:()=>d,WK:()=>E,_v:()=>y,cG:()=>l,fK:()=>f,hQ:()=>m,iG:()=>v,nT:()=>p,sI:()=>c,wx:()=>r,yM:()=>o});let a="vote_pins--votePinRoot--zOOjP",o="vote_pins--votePin--5E3rC",r="vote_pins--header--pfexD",i="vote_pins--headerText--O9EJ7 text--fontPos14--OL9Hp text--_fontBase--QdLsd",l="vote_pins--closeButtonContainer--WZCu2",s="vote_pins--medal--hNcNQ",c="vote_pins--expandingSection--wKym-",d="vote_pins--voterListSeparator--k0aO1",m="vote_pins--voterList--6fCBS",u="vote_pins--voterListItem--wa-M9",p="vote_pins--userName---6RMO text--fontPos11--2LvXf text--_fontBase--QdLsd ellipsis--ellipsis--Tjyfa",h="vote_pins--loadingAvatar--hq0Fh",f="vote_pins--loadingUserName--80x3W",_="vote_pins--voterListOverflowItem--V2jcD vote_pins--voterListItem--wa-M9",g="vote_pins--voterListOverflowIcon--xyXs6",v="vote_pins--voterListOverflowText--48DhR vote_pins--userName---6RMO text--fontPos11--2LvXf text--_fontBase--QdLsd ellipsis--ellipsis--Tjyfa",E="vote_pins--stampPreviewList--qlQDN",b="vote_pins--stampPreview--XkjWz",y="vote_pins--stampPreviewOverflow--QoTgf text--fontPos12--YsUAh text--_fontBase--QdLsd",C="vote_pins--offscreenMeasurementContainer--QYGnX"},938237:(e,t,n)=>{n.d(t,{j:()=>a});let a={library:new(n(765330)).MH}},888298:(e,t,n)=>{n.d(t,{$5:()=>f,E6:()=>p,d9:()=>m});var a=n(382902),o=n(887836),r=n(730143),i=n(231159),l=n(814038),s=n(517776);let c=(0,i.bt)(e=>e.multiplayer.allUsers);(0,a.eU)(e=>{let t=e(o.p9),n=e(c);if(t&&0!==n.length)return n.filter(e=>e.userID!==t.id)});let d=(0,i.bt)(e=>e.multiplayer.deviceNameFilter),m=(0,a.eU)(e=>{let t=e(c),n=e(d);return null!=e(r.yV)&&null!=n&&new Set(t.filter(e=>e.deviceName===n).map(e=>e.userID)).size>1}),u=(0,s.r1)("seen_spotlight_hint"),p=(0,l.Z1)(u,(e,t)=>{let n=t(c),a=t(d);if(t(h))return!1;let o=n.filter(e=>e.deviceName===a),r=Math.max(...Object.values(o).map(e=>e.joinedAtS))-300,i=new Set;for(let e of o)e.joinedAtS>=r&&i.add(e.userID);return!(i.size<5)&&!e}),h=(0,i.bt)(e=>{let t="fullscreen"===e.selectedView.view&&!e.mirror.appModel.showUi,n="prototype"===e.selectedView.view&&e.selectedView.hideUI;return t||n}),f=(0,i.bt)(e=>{let t="fullscreen"===e.selectedView.view&&e.mirror.appModel.showUi,n="prototype"===e.selectedView.view&&!e.selectedView.hideUI;return t||n})},966369:(e,t,n)=>{n.d(t,{NE:()=>l});var a=n(186606),o=n(382902),r=n(899386);let i=(0,n(10082).SG)(()=>a.Ez5.prototypingEditorState().activePrototypeDevice),l=(0,o.mg)(i,e=>(0,r.ln)(e.presetIdentifier))},459720:(e,t,n)=>{n.d(t,{z:()=>d});var a=n(848318),o=n(891627),r=n(536384),i=n.n(r),l=n(764474),s=n(399396),c=n(357202);function d(e){if(!e.dragState?.dragPosition||!e.dragState?.dragOffset)return null;let t=e.dragState.dragPosition.subtract(e.dragState.dragOffset),n=(0,l.ZQ)(e.dragState.draggingResource)?s.W:e.dragState.draggingResource.redirect_icon_url;return(0,o.createPortal)(a.createElement("img",{src:n,alt:e.dragState.draggingResource.name,className:i()(c.fe,{[c.Yg]:e.dragState.isDraggingOverCanvas}),style:{left:t.x,top:t.y,width:e.dragState.draggingThumbSize?.x,height:e.dragState.draggingThumbSize?.y},draggable:!1}),document.getElementById("fullscreen-root"))}},144379:(e,t,n)=>{n.d(t,{S:()=>u});var a=n(848318),o=n(891627),r=n(536384),i=n.n(r),l=n(968602),s=n(240176),c=n(140497),d=n(892576),m=n(357202);function u(e){let t=(0,l.fG)();if(!e.dragState?.dragPosition||!e.dragState?.dragOffset)return null;let n=e.dragState.draggingResource,r=e.dragState.dragPosition.subtract(e.dragState.dragOffset),{imageUrl:u,name:p,thumbnailIsSet:h,hubFileId:f,clientMeta:_,isWhiteboard:g,resizedThumbnailUrls:v}=t(n);return(0,o.createPortal)(a.createElement("div",{className:i()(m.y3,{[m.Yg]:e.dragState.isDraggingOverCanvas}),style:{left:r.x,top:r.y,width:e.dragState.draggingThumbSize?.x,height:e.dragState.draggingThumbSize?.y}},a.createElement(c.FK,{removeBorder:!0},a.createElement(d.Ho,{backgroundColor:(0,s.Cn)(_),image:u,isSet:h,isWhiteboard:g,hubFileId:f,alt:p,resizedThumbnailUrls:v}))),document.getElementById("fullscreen-root"))}},61993:(e,t,n)=>{n.d(t,{E:()=>d});var a=n(848318),o=n(891627),r=n(536384),i=n.n(r),l=n(764474),s=n(154502),c=n(357202);function d(e){if(!e.dragState?.dragPosition||!e.dragState?.dragOffset)return null;let t=e.dragState.dragPosition.subtract(e.dragState.dragOffset),n=(0,l.ZQ)(e.dragState.draggingResource)?s.J:e.dragState.draggingResource.redirect_snapshot_url;return(0,o.createPortal)(a.createElement("img",{src:n??void 0,alt:e.dragState.draggingResource.name,className:i()(c.Az,{[c.Yg]:e.dragState.isDraggingOverCanvas}),style:{left:t.x,top:t.y,width:e.dragState.draggingThumbSize?.x,height:e.dragState.draggingThumbSize?.y},draggable:!1}),document.getElementById("fullscreen-root"))}},769782:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(995218),o=n(625844),r=n(982323),i=n(431063),l=n(106420);function s(e){let t="whiteboard"===(0,a.lg)(),n=(0,l.F5)(),s=async a=>(e.insertAction(a),t&&(0,l.oM)({type:i.Rt.ORG_FACE_STAMPS,source:e.triggeredFrom,options:{...n,query:e.searchQuery}}),await Promise.resolve());return(0,o.t)(e,{insertAction:s,dragPreviewPointerPosition:r.N.RELATIVE,getDragPreviewSrc:()=>e.iconSrc,recordingKey:`insertable-facestamp-${e.resource.id}-${e.mini?"mini":"full"}`})}},653344:(e,t,n)=>{n.d(t,{c:()=>y});var a=n(301168),o=n(781239),r=n(453370),i=n(142896),l=n(471476),s=n(995218),c=n(38011),d=n(652576),m=n(982588),u=n(625844),p=n(982323),h=n(437941),f=n(138528),_=n(767203),g=n(764474),v=n(102382),E=n(399396),b=n(106420);function y(e){let t=(0,f.X$)("useInsertablePlugin").unwrapOr(null),n=(0,f.H3)(t),y=(0,c.Gt)(e.resource.plugin_id,e.triggeredFrom),C=(0,c.dR)(e.resource.plugin_id,e.triggeredFrom),w="whiteboard"===(0,s.lg)(),x=(0,b.F5)(),k=(0,l.t)(e.resource.plugin_id,y,C),I=(0,a.wA)(),T=k.length>0,P=(0,d.cW)(),S=(0,m.EO)(P[e.resource.plugin_id]),M=(0,h.x)({isWidget:!1,id:e.resource.plugin_id}),{validatePublishedPluginInOrgAllowlist:N}=(0,d.j1)(e.resource.plugin_id);return(0,u.t)(e,{insertAction:t=>{if(e.showRequestFlow)return Promise.resolve();let n=N();if(!(0,g.ZQ)(e.resource)&&!n)return Promise.resolve();if(S)M();else{let{e:n}=t;T?I(r.j7({type:i.LO,data:{pluginId:e.resource.plugin_id,target:{top:n.clientY,bottom:n.clientY,right:n.clientX,left:n.clientX,width:0,height:0},triggeredFrom:e.triggeredFrom}})):(0,g.ZQ)(e.resource)?C():y()}return w&&(0,b.oM)({id:e.resource.plugin_id,type:v.p.PLUGINS,source:e.triggeredFrom,options:{...x,query:e.searchQuery}}),Promise.resolve()},dragPreviewPointerPosition:p.N.CENTERED,getDragPreviewSrc:()=>(0,g.ZQ)(e.resource)?E.W:e.resource.redirect_icon_url||"",onPointerDownCallback:()=>{e.showRequestFlow||(0,g.ZQ)(e.resource)||S||_.F.getAndCache(e.resource,n)},recordingKey:o.Pt("plugin",e.resource.plugin_id)})}},234001:(e,t,n)=>{n.d(t,{B:()=>u});var a=n(186606),o=n(781239),r=n(995218),i=n(566841),l=n(968602),s=n(625844),c=n(982323),d=n(102382),m=n(106420);function u(e){let{insertTemplate:t}=(0,i.Fz)(),n="whiteboard"===(0,r.lg)(),u=(0,m.F5)(),{primaryKey:p,imageUrl:h}=(0,l.fG)()(e.resource),f=async o=>{let{dropPosition:r,isClick:i}=o;return n&&(0,m.oM)({id:e.resource.template.id,type:d.p.TEMPLATES,source:e.triggeredFrom,options:{...u,query:e.searchQuery}}),await t({template:e.resource,templateInsertionDirection:i?a.hKj.RIGHT:a.hKj.CUSTOM_POSITION,templateCustomPosition:i?void 0:r,triggeredFrom:e.triggeredFrom})};return(0,s.t)(e,{insertAction:f,dragPreviewPointerPosition:c.N.RELATIVE,getDragPreviewSrc:()=>h||"",recordingKey:o.Pt("template",p)})}},903691:(e,t,n)=>{n.d(t,{P:()=>E});var a=n(320953),o=n(781239),r=n(454805),i=n(995218),l=n(652576),s=n(982588),c=n(345121),d=n(180294),m=n(625844),u=n(982323),p=n(437941),h=n(767203),f=n(764474),_=n(102382),g=n(154502),v=n(106420);function E(e){let t=(0,d.dq)()||void 0,n="whiteboard"===(0,i.lg)(),r=(0,v.F5)(),E=(0,l.ZT)(),y=(0,s.EO)(E[e.resource.plugin_id]),C=(0,p.x)({isWidget:!0,id:e.resource.plugin_id});return(0,m.t)(e,{insertAction:t=>{if(y)C();else{let{dropPosition:n}=t;a.l7.user("insert-widget",()=>(0,c.j)({pluginID:e.resource.plugin_id,widgetName:e.resource.name,pluginVersionID:(0,f.ZQ)(e.resource)?"":e.resource.id,position:n.subtract(b),triggeredFrom:e.triggeredFrom}))}return n&&(0,v.oM)({id:e.resource.plugin_id,type:_.p.WIDGETS,source:e.triggeredFrom,options:{...r,query:e.searchQuery}}),Promise.resolve()},dragPreviewPointerPosition:u.N.RELATIVE,getDragPreviewSrc:()=>(0,f.ZQ)(e.resource)?g.J:e.resource.redirect_snapshot_url||"",onPointerDownCallback:()=>{(0,f.ZQ)(e.resource)||y||h.F.getAndCache(e.resource,t)},recordingKey:o.Pt("widget",e.resource.plugin_id)})}let b=new r.Mi(64,32)},437941:(e,t,n)=>{n.d(t,{x:()=>d});var a=n(848318),o=n(301168),r=n(967688),i=n(952039),l=n(490970),s=n(873197),c=n(400334);function d({isWidget:e,id:t}){let n=(0,o.wA)(),d=a.useCallback(()=>{(0,l.e)({id:t,isWidget:e,source:"extension-requires-payment-error"},a.createElement(c.C,{extensionId:t,extensionType:s.Ag.COMMUNITY}))},[t,e]);return a.useCallback(()=>{n(i.F.enqueue({message:e?(0,r.t)("community.buyer.paid_widgets_cannot_be_added_to_the_canvas_before_purchase"):(0,r.t)("community.buyer.paid_plugins_cannot_be_run_before_purchase"),error:!0,button:{text:(0,r.t)("community.buyer.buy"),action:d},type:e?"widget_requires_payment":"plugin_requires_payment"}))},[n,e,d])}},240092:(e,t,n)=>{n.d(t,{Q:()=>$});var a=n(848318),o=n(301168),r=n(168323),i=n(270251),l=n(904960),s=n(408193),c=n(19180),d=n(536384),m=n.n(d),u=n(410441),p=n(61503),h=n(156974),f=n(173926),_=n(967688),g=n(912873),v=n(453370),E=n(446244),b=n(67188),y=n(696786),C=n(433166),w=n(856731),x=n(730143),k=n(125761),I=n(17753),T=n(335744),P=n(614892),S=n(755042),M=n(623938),N=n(125952),D=n(574786),A=n(232922),L=n(132424),R=n(27776),O=n(580012),B=n(415431);let F=(0,u.jz)(R.m52),U=(0,u.jz)(R.Ko3);function V(e){let t=(0,o.d4)(e=>e.multiplayer);return"sessionID"in e&&t.observingSessionID===e.sessionID}var H=(e=>(e.CURRENT_USER="current_user",e.FILE_CREATOR="file_creator",e))(H||{});function q(e){let{user:t,onClick:n,volumeIcon:d,containsCursor:u,secondaryActions:p,disableSpotlightAnimation:E}=e,y=(0,x.q5)(),C=(0,o.d4)(e=>e.multiplayer),M=(0,k.iZ)(),L=V(t),{getTriggerProps:R,manager:F}=r.b(),U=C.allUsers.length>1,H=M?.id===t.userID,[q,z]=a.useState(!1),$=a.useRef(null),K=(0,o.wA)(),W=a.createElement(N.Ro,{entity:{...t,id:t.userID},className:A.Fp,size:24,key:t.userID}),Z=(0,w.Py)(t);(0,w.AD)(t)?W=a.createElement("span",{className:A.LH},a.createElement(S.vQ,{sessionID:t.sessionID,observingSessionID:C.observingSessionID,presenterSessionID:C.presenterSessionID??null,nominatedSessionID:C.sessionsNominatingCurrentUser.length>0?C.sessionID:null,user:t,showColorIndicators:U,horizontal:!0,disableSpotlightAnimation:E})):Z&&(W=a.createElement("span",{className:A.LH},a.createElement("div",{className:D._L},a.createElement(g.H8,{user:{...t,id:t.userID}}))));let G=m()({[A.nr]:!(0,c.k)().a11y_multiplayer_dropdown,[A.MO]:!0,[A.Vs]:!0,[A.Cu]:e.isCurrentUserHeaderRow,[A.BI]:e.isInListbox&&!Z,[A.yH]:u&&!Z,[A.UD]:Z}),j=()=>H?"current_user":t.userID===y?.creatorId?"file_creator":null,X=()=>{let e=j();return"current_user"===e?a.createElement("span",null," ",(0,_.tx)("collaboration.voice.you_lower_cased")):"file_creator"===e?a.createElement("span",null," ",(0,c.k)().multiplayer_avatar_show_creator_label?(0,_.tx)("collaboration.voice.creator"):(0,_.tx)("collaboration.voice.owner")):""},Q=()=>Z?a.createElement("span",{className:A.FH},a.createElement(f.h1,{date:t.viewedAt})):null,Y=()=>{let e=p?.map(e=>a.createElement(r.q7,{onClick:t=>{t.stopPropagation(),t.preventDefault(),e.onClick(t)},key:e.key,disabled:e.disabled},e.text));return a.createElement(r.mc,null,e)},J=()=>a.createElement(r.bL,{manager:F},a.createElement("div",{className:A.G7},a.createElement(i.u,{className:m()(A.Xg),"aria-label":(0,_.t)("fullscreen.toolbar.multiplayer.more_options"),"data-tooltip-type":I.Ib.TEXT,"data-tooltip":(0,_.t)("fullscreen.toolbar.multiplayer.more_options"),...R()},a.createElement(s.J,null))),Y()),ee=a.createElement(P.fI,{className:A.Hl},W,a.createElement("span",{className:A.nP},a.createElement("span",{className:A.ko},a.createElement("span",{className:A.j7},(0,w.Py)(t)?a.createElement(a.Fragment,null,a.createElement("span",{className:A.TV},t.name),Q()):a.createElement(a.Fragment,null,a.createElement("span",{className:A.DL},t.name,X()),u&&a.createElement("span",{className:A.FH},L?(0,_.tx)("collaboration.voice.click_to_unfollow"):(0,_.tx)("collaboration.voice.click_to_follow")))),d&&a.createElement("span",{className:A.e6},d)),a.createElement("span",{className:A.vO},p&&p.length>0&&((0,c.k)().a11y_multiplayer_dropdown?J():a.createElement("div",{onMouseUp:b.dG},a.createElement("div",{className:A.G7,ref:$},a.createElement(P.YW,{svg:O.A,fallbackSvg:B.A,isBackgroundTransparent:!1,selected:q,"data-tooltip-type":I.Ib.TEXT,"data-tooltip":(0,_.t)("fullscreen.toolbar.multiplayer.more_options"),className:m()(A.hv,{[A.VQ]:q}),onClick:e=>{e.stopPropagation(),z(!0)}})),(()=>{let e=$.current;if(q&&e){let t=p?.map(e=>a.createElement(h.c$,{onClick:t=>{t.stopPropagation(),t.preventDefault(),e.onClick(t),z(!1),K(v.oB())},key:e.key,disabled:e.disabled},e.text));return a.createElement(T.Cf,{targetRect:e.getBoundingClientRect(),minWidth:160,closeDropdown:()=>{z(!1)},autoHeight:!0},t)}return a.createElement(a.Fragment,null)})())))));return(0,c.k)().a11y_multiplayer_dropdown&&n?a.createElement(l.bL,{className:m()(G,{[A.Lk]:!Z&&!F.isOpen,[A.tE]:!Z&&F.isOpen})},a.createElement(l.O6,{onClick:n,key:t.userID,className:A.L8,"aria-label":L?(0,_.t)("collaboration.voice.click_to_unfollow_user",{username:t.name}):(0,_.t)("collaboration.voice.click_to_follow_user",{username:t.name})}),a.createElement(P.fI,{className:A.Hl},W,a.createElement("span",{className:A.nP},a.createElement("span",{className:A.ko},a.createElement("span",{className:A.j7},(0,w.Py)(t)?a.createElement(a.Fragment,null,a.createElement("span",{className:A.TV},t.name),Q()):a.createElement(a.Fragment,null,a.createElement("span",{className:A.DL},t.name,X()),a.createElement("span",{className:A.zO},L?(0,_.tx)("collaboration.voice.click_to_unfollow"):(0,_.tx)("collaboration.voice.click_to_follow")))),d&&a.createElement("span",{className:A.e6},d)),a.createElement(l.HG,{className:A.vO},p&&p.length>0&&J())))):n?a.createElement("button",{className:G,onClick:n,key:t.userID},ee):a.createElement("div",{className:m()(G,{[A.fJ]:F.isOpen&&(0,c.k)().a11y_multiplayer_dropdown}),key:t.userID},ee)}function z(e){let t=(0,o.d4)(e=>e.multiplayer),n=(0,o.d4)(e=>"prototype"===e.selectedView.view?e.prototype.showProgressBar:(0,C.T)(e?.progressBarState?.mode)),r=t.allUsers.length>1,i=(0,p.Av)(),l=(0,y.GS)(),{user:s,onClick:c,volumeIcon:d,disableSpotlightAnimation:u}=e,h=V(s),f=n?D.K$:"";if(!(0,w.AD)(s))return a.createElement("div",{className:m()(D.C7,f)},a.createElement(g.H8,{user:{...s,id:s.userID}}),d&&a.createElement("span",{className:L.Wh},d));{let n=`voice-avatar-session-${s.sessionID}`;return a.createElement("span",{"data-onboarding-key":e.onboardingKey,className:m()(L.R3,f)},c&&a.createElement("button",{className:L.XF,onClick:c,"data-tooltip-proxy-element-id":n,"aria-label":h?(0,_.t)("fullscreen.toolbar.multiplayer.unfollow_name",{name:s.name}):(0,_.t)("fullscreen.toolbar.multiplayer.follow_a_name",{name:s.name}),"data-fullscreen-intercept":!0}),a.createElement(S.vQ,{disableSpotlightAnimation:u,hasBorder:e.hasBorder,nominatedSessionID:t.sessionsNominatingCurrentUser.length>0?t.sessionID:null,observingSessionID:t.observingSessionID,presenterSessionID:t.presenterSessionID??null,sessionID:s.sessionID,showColorIndicators:r,tooltipOffsetY:((l?U:i)-F)/2,tooltipProxyId:n,user:s}),d&&a.createElement("span",{className:L.Wh},d))}}function $(e){let{user:t,onboardingKey:n,callMetadata:r,isOverflow:i,isCurrentUserHeaderRow:l,onUserClick:s,containsCursor:c,secondaryActions:d,disableSpotlightAnimation:m,hasBorder:u,hidePopover:p}=e,h=(0,o.wA)(),f=r&&a.createElement(M.i,{userId:t.userID,userName:t.name,microphoneStyle:r.microphoneStyle,call:r.call,alwaysShowVoiceBars:i,volumeIconMutedState:i?M.S.DEFAULT:M.S.MINI}),_=s&&(e=>{e.stopPropagation(),e.preventDefault(),(0,w.AD)(t)&&(s(t),i?(h(v.oB()),p&&p()):h(E.jD()))});return i||l?a.createElement(q,{user:t,volumeIcon:f,onClick:_,containsCursor:c,secondaryActions:d,disableSpotlightAnimation:m,isCurrentUserHeaderRow:l}):a.createElement(z,{user:t,onboardingKey:n,volumeIcon:f,onClick:_,disableSpotlightAnimation:m,hasBorder:u})}},889415:(e,t,n)=>{n.d(t,{_:()=>v});var a=n(848318),o=n(536384),r=n.n(o),i=n(642014),l=n(652576),s=n(982588),c=n(345121),d=n(61993),m=n(903691),u=n(318147),p=n(764474),h=n(215533),f=n(430781),_=n(483312),g=n(241789);function v(e){let t=(0,h.b)(),n=(0,l.ZT)(),o=(0,s.EO)(n[e.widget.plugin_id]),v="boolean"==typeof e.clickToInsert?e.clickToInsert&&!o:!o,{dragState:E,onInsertableResourcePointerDown:b}=(0,m.P)({clickToInsert_DEPRECATED:v,afterSuccessfulInsert:t,triggeredFrom:e.analytics.triggeredFrom,resource:e.widget,searchQuery:e.analytics.searchQuery}),y=(0,p.ZQ)(e.widget);return a.createElement(a.Fragment,null,a.createElement("div",{className:r()({[_.cJ]:!0,[f.J]:!!E,[_.HA]:e.fillContainer,[_.Gb]:e.context===u._Y.WHITEBOARD}),onPointerDown:b,"data-testid":"widget-snapshot-draggable"},a.createElement("button",{style:{visibility:"hidden",width:0,height:0},onClick:n=>{o||((0,c.j)({pluginID:e.widget.plugin_id,widgetName:e.widget.name,pluginVersionID:y?"":e.widget.id,triggeredFrom:"universal-insert"}),t())},ref:e.keyboardNavigationButtonRef}),a.createElement("img",{src:e.src,alt:"",draggable:!1}),a.createElement("div",{className:_.DJ},y&&a.createElement(i.t,{svg:g.A,useOriginalSrcFills_DEPRECATED:!0,fallbackSvg:g.A}))),a.createElement(d.E,{dragState:E}))}},211128:(e,t,n)=>{n.d(t,{w:()=>P});var a=n(848318),o=n(382902),r=n(918777),i=n(63163),l=n(34375),s=n(34542),c=n(888298),d=n(539829),m=n(517776),u=n(125761),p=n(434289),h=n(263336),f=n(18584),_=n(704410),g=n(136169),v=n(989232),E=n(398612),b=n(264478),y=n(967688);let C={SPOTLIGHT_GUIDE:"https://help.figma.com/hc/articles/5025214483351-Facilitate-meetings-with-spotlight",FOLLOW_GUIDE:"https://help.figma.com/hc/articles/360040322673-Follow-collaborators-in-a-file"};function w(e){return a.createElement("div",null,a.createElement("div",{className:"multiplayer_nux_modals--title--N0NZG text--fontPos13--xW8hS text--_fontBase--QdLsd"},e.title),a.createElement("div",{className:"multiplayer_nux_modals--content--mROkG"},e.content),a.createElement("div",{className:"multiplayer_nux_modals--footerContainer--I-MS-"},a.createElement(b.vd,{className:"multiplayer_nux_modals--footerButton--TJL3G",onClick:e.primaryCTAOnClick},e.primaryCTA),a.createElement(b.tM,{onClick:e.secondaryCTAOnClick},e.secondaryCTA)))}function x({onDismissModal:e}){let t=(0,y.tx)("collaboration.spotlight.2_0.onboarding_spotlight.description_with_spotlight_arg",{spotlightMeButtonText:a.createElement("b",null,(0,y.tx)("collaboration.spotlight.tooltip.spotlight_me"))});return a.createElement(w,{title:(0,y.tx)("collaboration.spotlight.onboarding_spotlight.title"),content:t,secondaryCTA:(0,y.tx)("collaboration.voice.learn_more"),secondaryCTAOnClick:()=>(0,E.FJ)(C.SPOTLIGHT_GUIDE,"_blank","noopener"),primaryCTA:(0,y.tx)("collaboration.spotlight.onboarding.next"),primaryCTAOnClick:()=>{e(),(0,v.trackEvent)("Context Viewed",{name:"should-close-open-spotlight-nux"})}})}function k({onDismissModal:e}){return a.createElement(w,{title:(0,y.tx)("collaboration.spotlight.onboarding_observation.title"),content:(0,y.tx)("collaboration.spotlight.onboarding_observation.description"),secondaryCTA:(0,y.tx)("collaboration.voice.learn_more"),secondaryCTAOnClick:()=>(0,E.FJ)(C.FOLLOW_GUIDE,"_blank","noopener"),primaryCTA:(0,y.tx)("collaboration.spotlight.onboarding.done"),primaryCTAOnClick:()=>{e()}})}let I="seen_synchronous_collaboration_onboarding",T=(0,m.r1)(I);function P(){let e=(0,o.md)(c.d9),t=(0,o.md)(d.PD),n=(0,o.md)(c.$5),m=(0,o.md)(T),v=(0,u.J$)(),E=(0,r.A)().subtract(7,"day").isBefore((0,r.A)(v)),b=(0,s.e)({overlay:g.aI5,priority:h.N.DEFAULT_MODAL},[t,m]),y=(0,s.e)({overlay:g.ar0,priority:h.N.DEFAULT_MODAL}),C=(0,a.useCallback)(()=>{e&&n&&!E&&b.show({canShow:(e,t)=>!e&&!t})},[e,n,E,b]),w=(0,a.useCallback)(()=>{y.show()},[y]),P=(0,a.useCallback)(()=>{b.complete(),w()},[b,w]);return(0,i.h)(C),(0,l.E)(b.uniqueId,p.M8,C),a.createElement(a.Fragment,null,a.createElement(f.h,{element:({onClickPrimaryCta:e})=>a.createElement(x,{onDismissModal:e}),isShowing:b.isShowing,modalType:_.q3.WALK_THROUGH,onClickPrimaryCta:P,onClose:b.complete,onManualDismiss:b.complete,onboardingKey:"multiplayer-spotlight-nux-key",shouldDismissWhenLostDOMTarget:!0,trackingContextName:"multiplayer_onboarding",userFlagOnShow:I,width:268}),a.createElement(f.h,{element:({dismissModal:e})=>a.createElement(k,{onDismissModal:e}),isShowing:y.isShowing,modalType:_.q3.WALK_THROUGH,onClickPrimaryCta:y.complete,onClose:y.complete,onManualDismiss:y.complete,onboardingKey:"multiplayer-observation-nux-key",shouldDismissWhenLostDOMTarget:!0,trackingContextName:"multiplayer_observation_onboarding",userFlagOnShow:I,width:268}))}},980686:(e,t,n)=>{n.d(t,{b:()=>b});var a=n(848318),o=n(382902),r=n(63163),i=n(967688),l=n(972402),s=n(34375),c=n(34542),d=n(888298),m=n(539829),u=n(339042),p=n(434289),h=n(263336),f=n(18584),_=n(698429),g=n(704410),v=n(136169);let E=()=>(0,i.t)("collaboration.spotlight.nudge_spotlight.title");function b(){let e=(0,o.md)(m.PD),t=(0,o.md)(d.E6),n=(0,_.ks)(),i=(0,l._I)(),b=n&&!i,y=(0,c.e)({overlay:v.hPP,priority:h.N.SECONDARY_MODAL},[e,t]),C=(0,a.useCallback)(()=>{b||y.show({canShow:(e,t)=>!e&&t})},[b,y]);(0,r.h)(()=>{C()});let w=(0,a.useCallback)(()=>{y.isShowing||C()},[y.isShowing,C]);return(0,s.E)(y.uniqueId,p.M8,w),a.createElement(f.h,{element:u._,isShowing:y.isShowing,modalType:g.q3.ANNOUNCEMENT_POINTER,onClickPrimaryCta:y.complete,onClose:y.complete,onManualDismiss:y.complete,onboardingKey:"multiplayer-spotlight-nux-key",title:E,trackingContextName:"multiplayer_spotlight_nudge",userFlagOnShow:"seen_spotlight_hint"})}},819013:(e,t,n)=>{n.d(t,{IN:()=>er,ez:()=>J,xw:()=>ee});var a=n(848318),o=n(301168),r=n(660376),i=n(938982),l=n(575055),s=n(186606),c=n(382902),d=n(635),m=n.n(d),u=n(277930),p=n(996202),h=n(865114),f=n(998568),_=n(454805),g=n(14564),v=n(847461),E=n(453370),b=n(431698),y=n(142896),C=n(30575),w=n(330362),x=n(412865),k=n(657554),I=n(15105),T=n(601167),P=n(7148),S=n(125761),M=n(200300),N=n(554326),D=n(314774),A=n(302982),L=n(563741),R=n(664250),O=n(403506),B=n(175393),F=n(837932),U=n(721014),V=n(660037),H=n(959621),q=n(119017),z=n(824069),$=n(134642),K=n(167546),W=n(358857),Z=n(98737),G=n(276595),j=(e=>(e[e.Gradual=0]="Gradual",e[e.Jump=1]="Jump",e))(j||{});let X=q.XC.getPinSize(3),Q=Math.max(H.u5,X.width,X.height),Y=e=>10*Math.round(100*e/10);function J(e,t,n){let a=n,o=t*n,r=Q+(0,O.H)(e,n);return o<3*r&&(a=3*r*n/o),a}function ee({config:e,clusterLocation:t,pins:n,currentViewport:a}){let o=m()(n,e=>Math.max(Math.abs(e.x-t.x),Math.abs(e.y-t.y))),r=Math.abs(o.x-t.x),i=Math.abs(o.y-t.y),l=r>i?"width":"height",s=Math.max(r,i),c=e.clusterClickResultViewportPercentage/100,d=a[l]*c/(2*s),u=J(e,s,d);return u/a.zoomScale<1.5&&(u*=1.5),Math.min(u,e.minZoomPercentage/100+.5)}let et=[s.NLJ.COMMENTS,s.NLJ.SELECT,s.NLJ.SCALE,s.NLJ.HAND,s.NLJ.TYPE],en=(e,t,n,a,o,r)=>{let{threads:i}=e,l=i.map(e=>a(e)),s=i.map(e=>{let t=e.comments[0].client_meta;return t?.in_frame?t.node_id:void 0}),c=new Map;for(let e of l)for(let t of e.avatars)c.has(t.avatar_user_id)?(c.get(t.avatar_user_id).num_unread_comments+=t.num_unread_comments,c.get(t.avatar_user_id).num_comments+=t.num_comments):c.set(t.avatar_user_id,t);let d=1===i.length;return{id:d?i[0].id:(0,K.Ao)(e,i.length),x:e.x,y:e.y,pins:l,isUnread:l.some(e=>e.isUnread),avatarMap:c,onClick:o(e,l),anchoredNode:s.every(e=>e===s[0])?s[0]:void 0,isPinnedToFile:l.some(e=>e.isPinnedToFile),isSinglePin:d,cluster:e,onKeyDown:r(e,l)}};"customElements"in window&&customElements.define(Z.Zb.desiredElementName,Z.Zb);let ea=a.memo(function(e){let t=!!e.activeThread||e.threads.length>0,n=(0,S.iZ)(),d=(0,L.s)(),m=(0,$.Z5)(),k=(0,o.wA)(),I=a.useContext(D.kw),H=a.useRef(null),j=(0,o.d4)(e=>e.mirror.appModel.currentTool),X=(0,N.ut)(s.Ez5?.editorState().handToolTemporarilyEnabled,!1),Q=(0,P.BI)(),J=e.activeThread?.id===A.hm,ea=J?null:e.activeThread?.id||null,er=(0,o.d4)(e=>e.comments.emphasizedPinIds),{zoomScale:ei,deltaOffsetX:el,deltaOffsetY:es,deltaZoomScale:ec}=(0,T.PD)({subscribeToUpdates_expensive:t}),{requestToDeselectCommentPin:ed}=e,[em,eu]=a.useState(!1),ep=(0,b.qN)(),eh=(0,w.k)(),ef=(0,g.WN)(),[e_,eg]=a.useState(void 0),[ev,eE]=a.useState(!1),eb=(0,c.md)(Z.ux),ey=a.useRef(null),eC=(0,c.md)(R.R),ew=(0,o.d4)(e=>![s.m1T.DESIGN_LAYOUT,s.m1T.WHITEBOARD_LAYOUT,s.m1T.HISTORY,s.m1T.PREVIEW,s.m1T.COMMENTS,s.m1T.DEV_HANDOFF,s.m1T.SLIDE_LAYOUT,s.m1T.SITES_LAYOUT].includes(e.mirror.appModel.activeCanvasEditModeType)||e.mirror.appModel.activeUserAction!==s.QOV.DEFAULT)&&(!Q||Q?.shouldOptimizeForIpadApp&&Q?.shouldFadeCommentsDuringEdit)||j===s.NLJ.MULTISELECT,[ex,ek]=a.useState({viewport:I.getViewportInfo(),hasJumped:!1}),eI=a.useRef(e.threads);a.useEffect(()=>{eI.current=e.threads},[e.threads]);let eT=a.useCallback(e=>eI.current?.find(t=>t.id===e)||null,[eI]),eP=(0,o.d4)(e=>e.mirror.appModel.activeUserAction);a.useEffect(()=>{let e=H.current;e&&(e.shouldDisablePointerEvents=!eh&&d?.disableCommentsWhenHandToolEnabled&&j===s.NLJ.HAND||X||void 0!==eP&&eP!==s.QOV.DEFAULT||j===s.NLJ.MULTISELECT)},[H,j,X,eP,d?.disableCommentsWhenHandToolEnabled,eh]);let eS=e.dragDisabledOverride||!et.includes(j),eM=(0,W.B)(eT,e.pageId,e.setClientMeta,eS,e.requestToSelectCommentPin,eC),eN=(0,W.x)(eS),eD=a.useMemo(()=>new Set(e.threads.filter(e=>eN(e)).map(e=>e.id)),[eN,e.threads]),eA=a.useCallback(e=>{k(v.wg({threadId:e}));let t=eT(e);t&&I.setHovering(t.canvasPosition)},[I,k,eT]),eL=a.useCallback(e=>{k(v.RP({threadId:e})),I.setHovering(null)},[I,k]),eR=(0,p.am)(),eO=a.useCallback((e,t)=>eh?()=>Promise.resolve(ef("COMMENT_PIN_CLICK")):async()=>{eR("Comment Cluster Clicked",{clusterSize:t.length,commentThreadIds:t.map(e=>e.id)});let n=ee({config:m,clusterLocation:e,pins:t,currentViewport:I.getViewportInfo()}),a=I.navigateTo(e,n);ed&&ed(),await a},[m,I,eR,ed,eh,ef]),eB=a.useCallback((e,t)=>{t.preventDefault(),t.stopPropagation();let n=eT(e);if(!n)return;let a=I.getViewportInfo(),o=H.current.getPinViewportRect(n.id),r=(0,T.Z0)(a,o),i={x:r.x+o.height/2,y:r.y-o.width/2,height:0,width:0},l=(0,T.HD)(i,a);k(E.j7({type:y.Z7,data:{thread:n,pinClientRect:l}}))},[k,I,eT]),eF=H.current,eU=(0,T.ni)(),eV=a.useCallback(e=>{if(eF){if("function"!=typeof eF.onViewportUpdate){(0,f.$D)(i.e.WAYFINDING,Error("pinRenderer.onViewportUpdate is not a function"),{extra:{pinRendererProperties:Object.getOwnPropertyNames(eF)}});return}eF.onViewportUpdate(e)}},[eF]);a.useEffect(()=>{t&&eV(I.getViewportInfo())},[eV,t,I]),(0,T.D6)({subscribeToUpdates_expensive:t},eV),a.useEffect(()=>{eF&&(eF.bounds={min:{x:eU.x,y:eU.y},max:{x:eU.x+eU.width,y:eU.y+eU.height}},eF.onElementClicked=eM.onPinClicked,eF.onElementDragEnd=eM.onDragEnd,eF.onElementDragMove=eM.onDragUpdate,eF.onElementDragStart=eM.onDragStart,eF.onElementContextMenu=eB)},[eB,eF,eM,eU]);let eH=a.useCallback(e=>{let t;let a=(0,K.c4)(e.comments),o=e.comments.slice(1).reduce((e,t)=>t.isUnread?e+1:e,0);if(e.boundingBoxAnchorCanvasPosition)t=e.boundingBoxAnchorCanvasPosition;else if(e.comments[0].client_meta?.selection_box_anchor&&(t=e.comments[0].client_meta.selection_box_anchor,e.comments[0].client_meta?.in_frame)){let n=e.comments[0].client_meta,a=_.Mi.subtract(t,n);t=_.Mi.add(e.canvasPosition,a)}let i=!!e.isPendingFromSinatra,l={id:e.id,x:e.canvasPosition.x,y:e.canvasPosition.y,isOurs:e.comments[0].user_id===n?.id,pending:i,avatars:a,createdAt:new Date(Date.parse(e.comments[0].created_at)),onMouseEnter:()=>eA(e.id),onMouseLeave:()=>eL(e.id),previewMessageMeta:e.comments[0].message_meta,isUnread:e.comments[0].isUnread||o>0,numUnreadReplies:o,isDraggable:eD.has(e.id)&&!e.boundingBoxAnchorCanvasPosition,isResolved:!!e.comments[0].resolved_at,label:e.comments[0].order_id||"",updatedAt:e.comments[e.comments.length-1].created_at,selectionBoxAnchor:t,otherBoundingBoxes:e.otherBoundingBoxes,numAttachments:e.comments.map(e=>e.attachments?.length||0).reduce((e,t)=>e+t,0),isPinnedToFile:(0,C.U6)()?!!e.commentPin:void 0};return e.sidebarItemType===A.kT.COMMENT_THREAD?{...l,type:A.kT.COMMENT_THREAD}:e.sidebarItemType===A.kT.FEED_POST?{...l,type:A.kT.FEED_POST,feedPostTitle:e.feedPostTitle,pinVerticalStagger:e.pinVerticalStagger}:e.sidebarItemType===A.kT.LITMUS_COMMENT_THREAD?{...l,type:A.kT.LITMUS_COMMENT_THREAD}:void(0,r.xb)(e)},[n,eD,eA,eL]),eq=a.useMemo(()=>e.threads.reduce((e,t)=>{let{canvasPosition:n}=t;return n&&e.push({...t,canvasPosition:n}),e},[]),[e.threads]),[ez,e$]=a.useState(new Map),eK=a.useCallback((e,t)=>{e$(n=>new Map(n.set(e,t)))},[]),eW=(0,h.ZC)(eq),eZ=eq!==eW&&void 0!==eW;a.useEffect(()=>{eZ&&e$(new Map)},[eZ,eq]);let eG=(0,h.ZC)(ep),[ej,eX]=a.useState(()=>{if(ep)return(0,x.Zz)(e.threads)});a.useEffect(()=>{void 0===ej&&!eG&&ep&&(0,x.Zz)(e.threads)&&eX(!0)},[eG,ep,e.threads,ej]),a.useEffect(()=>{eZ&&ej&&(e.threads.some(e=>null!=e.commentPin&&e.comments.some(e=>e.isUnread))||eX(!1))},[ej,eZ,e.threads]);let eQ=(()=>{let e=(0,M.o3)(M.nt.commentsA11y);return a.useCallback((t,n)=>a=>{e&&"Enter"===a.key&&eO(t,n)().then(()=>{H.current.focusOneOf(new Set(t.threads.map(e=>e.id)))})},[e])})(),eY=a.useCallback((e,t)=>{let n=new Set(e.map(e=>e.id)),a=Y(t.zoomScale),o=ez.get(a);if(o){let e=o.map(e=>en(e,t,d,eH,eO,eQ));return new z.n(e,n,t.zoomScale,ej)}{eK(a,o=(0,O.g)(e,t,m));let r=o.map(e=>en(e,t,d,eH,eO,eQ));return new z.n(r,n,t.zoomScale,ej)}},[ez,ej,d,eH,eO,eQ,m,eK]),eJ=a.useCallback(e=>{ek({viewport:I.getViewportInfo(),hasJumped:1===e})},[I]),e0=(0,u.A)(eJ,m.rebuildClustersZoomDelay),e1=a.useMemo(()=>{let e=eY(eq,ex.viewport);return e.applyInstant=ex.hasJumped,e},[eq,ex,eY]);a.useEffect(()=>{let e=ex.viewport.zoomScale;if(ei===e)return;let t=H.current;e>ei&&t&&(t.isZoomingOut=!0);let{width:n,height:a}=I.getViewportInfo();Math.abs(ec)/ei>.45||Math.abs(el)/n>.95||Math.abs(es)/a>.95?eJ(1):e0(0)},[I,ec,el,es,m.rebuildClustersZoomDelay,ex.viewport,ei,eF,e0,eJ]);let e2=a.useCallback(e=>{eu(null!=e),H.current=e},[]);a.useEffect(()=>{if(H.current){let e=H.current;if(em)e.data={clusters:e1,selectedPinId:ea,emphasizedPinIds:er,dimUnselectedPins:!!ew};else{e.wrapperOffsetFn=e=>I.getCommentsWrapperOffset(e);let t=I.getViewportInfo();e.initialViewport=t,e.data={clusters:e1,selectedPinId:ea,emphasizedPinIds:er,dimUnselectedPins:!!ew},e.clientConfig=d}}},[I,ea,er,em,e1,d,ew]);let e3=!!e.activeThread,e4=e.activeThread?(0,K.c4)(e.activeThread.comments).length:1,{setActivePinSize:e5}=e;a.useEffect(()=>{if(!e3){e5(null);return}if(J){let e=q.XC.getPinSize(1);e5({height:e.height,width:e.width});return}e5({width:q.XC.getPinSize(e4).width,height:0})},[e5,e3,J,e4]);let e6=()=>{let e;if(!H.current)return;let t=H.current.shadowRoot,n=t?.querySelector(`[data-onboarding-key="${U.UU}"]`);if(!n)return;let a=ey?.current?.getBoundingClientRect(),o=a?.height,r=n.getBoundingClientRect(),i=U.V_/2,l=r.top<window.innerHeight/3,s=r.top-10,c=r.top+10;if(o){let t=r.top+10-o;e=l?s:t}else e=c;eg({top:e,left:r.left-U.V_-10,pointerOffset:i,pointerPosition:B.F_.RIGHT_BODY})};a.useEffect(()=>{eb&&e6()},[eb]),a.useEffect(()=>{e6()},[ev]),a.useEffect(()=>{eg(void 0)},[el,es]);let e8=a.useMemo(()=>{if(e_)return{targetLocation:e_,innerRef:ey,setIsShowingOverlay:eE}},[e_,ey,eE]),e7=eo(),e9=(0,M.o3)(M.nt.commentsA11y);return a.createElement(G.p,null,eb&&!!e8&&a.createElement(V.ue,{registrationOrigin:F.iX.NEW_COMMENT,fixedPositionProps:e8}),e9?a.createElement(l.i,null,a.createElement("div",{"data-testid":"comments-clustered-pins-focus-anchor",tabIndex:0,"data-fullscreen-intercept":!0}),a.createElement("clustered-pins",{"data-fullscreen-intercept":!0,onKeyDown:e=>{if("Tab"===e.key){let t=Z.iZ?.shadowRoot?.activeElement?.parentElement?.getAttribute("id"),n=e1.all().map(e=>e.id),a=(n.findIndex(e=>e===t)+(e.shiftKey?-1:1)+n.length)%n.length,o=e1.all()[a];if(!o)return;let r=n[a];e7(o.cluster)?.then(()=>{(function(e){let t=Z.iZ?.shadowRoot?.getElementById(e)?.firstElementChild;t instanceof HTMLElement&&t.focus()})(r)}),e.preventDefault()}},ref:e2})):a.createElement("clustered-pins",{ref:e2}))}),eo=()=>{let e=(0,I.Z)(),t=a.useContext(D.kw),n=(0,o.d4)(e=>e.selectedView);return a.useCallback(a=>e((0,k.E)(a.threads[0],t,n,!1,!0)),[e,t,n])},er=a.memo(function(e){return a.createElement(ea,{key:e.pageId,activeThread:e.activeThread,dragDisabledOverride:e.dragDisabledOverride,isCommunity:e.isCommunity,pageId:e.pageId,requestToDeselectCommentPin:e.requestToDeselectCommentPin,requestToSelectCommentPin:e.requestToSelectCommentPin,setActivePinSize:e.setActivePinSize,setClientMeta:e.setClientMeta,threads:e.threads,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})})},824069:(e,t,n)=>{n.d(t,{n:()=>a});class a{constructor(e,t,n,a){this._cached_all=null,this.applyInstant=!1,this.minimizeUnpinned=!1,this.clusters=e.reduce((e,t)=>(e[t.id]=t,e),{}),this.order=e.map(e=>e.id),this.leafNodes=t;let o={};a&&(this.minimizeUnpinned=!0),e.forEach(e=>{e.pins.forEach(t=>{o[t.id]=e.id})}),this.hierarchy=o,this.zoomScale=n}get length(){return this.order.length}all(){return this._cached_all||(this._cached_all=this.order.map(e=>this.clusters[e])),this._cached_all}getParentOf(e){let t=this.hierarchy[e];return t&&this.clusters[t]||null}}},358857:(e,t,n)=>{n.d(t,{B:()=>x,x:()=>C});var a=n(848318),o=n(301168),r=n(484169),i=n(454805),l=n(14564),s=n(847461),c=n(431698),d=n(330362),m=n(412865),u=n(15105),p=n(601167),h=n(730143),f=n(125761),_=n(314774),g=n(302982),v=n(563741),E=n(835486),b=n(119017),y=n(167546);function C(e){let t=(0,f.TA)(),n=h.q5()?.canEdit;return a.useCallback(a=>!!(!0!==e&&(0,g.b7)(a.sidebarItemType))&&(!!n||a.comments[0].user_id===t),[e,t,n])}function w(e,t){let n=a.useContext(_.kw);return a.useCallback(a=>{let o=e(a.id);if(!o||!o.canvasPosition)return;let r=n.getViewportInfo(),l=(0,p.Z0)(r,o.canvasPosition),s=i.Mi.subtract(l,a.offset);t((0,p.$$)(r,s),o,r)},[e,t,n])}function x(e,t,n,h,f,g){let C=a.useContext(_.kw),x=(0,o.wA)(),k=C.getCommentDestinationForCanvasPosition,I=(0,E.fG)(),T=(0,E.pC)(),P=(0,E.gu)(),S=C.getValidCommentsRect,M=a.useCallback(e=>{C.setHovering(e)},[C]),N=w(e,M),D=w(e,a.useCallback((e,n)=>{if(n.comments[0]?.client_meta?.selection_box_anchor){let a=I(e,k(e,t)?.nodeId);if(a){let e=(0,r.pV)(n.comments[0].client_meta.selection_box_anchor,a);if(e.x!==n.comments[0].client_meta.selection_box_anchor.x||e.y!==n.comments[0].client_meta.selection_box_anchor.y){let t={...n.comments[0].client_meta};t.selection_box_anchor=e,x(s.hY({thread:n,clientMeta:t}))}}}M(e)},[t,I,k,x,M])),A=w(e,a.useCallback((e,a,o)=>{let l;let c=(0,p.Z0)(o,e);if(!(0,m.rN)(c,S()))return;if(T(e)){x(s.UU()),P(),M(null);return}let d=k(e,t,!1),u={x:e.x,y:e.y,node_id:d?.nodeId,node_offset:d?.nodeOffset,viewport:o,page_id:t,in_frame:d?.inFrame,selection_box_anchor:a.comments[0].client_meta?.selection_box_anchor,stable_path:d?.stablePath};if(a.comments[0].client_meta?.selection_box_anchor){if(a.comments[0].client_meta.in_frame){let t=a.comments[0].client_meta,n=a.comments[0].client_meta.selection_box_anchor,o=i.Mi.subtract(n,t),r=a.canvasPosition;if(d?.inFrame){let t=i.Mi.subtract(r,e);l=i.Mi.add(i.Mi.add(e,o),t)}else l=i.Mi.add(o,r)}else l=a.comments[0].client_meta?.selection_box_anchor;let t=I(e,d?.nodeId);t&&(l=(0,r.pV)(l,t))}u.selection_box_anchor=l,n({thread:a,clientMeta:u}),M(null)},[t,n,x,k,I,T,P,S,M])),L=function(e,t,n){let r=(0,o.wA)(),i=a.useContext(_.kw),m=(0,c.I_)(),h=(0,v.s)(),f=(0,u.Z)("comments_navigate"),g=(0,d.k)(),E=(0,l.WN)();return a.useCallback(a=>{if(g){E("COMMENT_PIN_CLICK");return}let o=e(a);if(o){if(t){if(!o.isPendingFromSinatra&&o.canvasPosition){let e=(0,p.Z0)(i.getViewportInfo(),o.canvasPosition),n=(0,y.c4)(o.comments).length,a=b.XC.getPinSize(n);t(o.id,{x:e.x,y:e.y,width:1.15*a.width,height:1.15*a.height})}}else r(s.bB({receiptsAPI:m.commentReceipts,viewport:i,thread:o,skipDeactivatingExistingActiveComment:n,config:h,navigate:f}))}},[m,r,e,i,t,n,h,f,g,E])}(e,f,g);return a.useMemo(()=>({onDragEnd:A,onPinClicked:L,onDragUpdate:D,onDragStart:N}),[N,A,L,D])}},204598:(e,t,n)=>{n.d(t,{B:()=>tN});var a=n(848318),o=n(301168),r=n(658839),i=n(50429),l=n(297638),s=n(967688),c=n(847461),d=n(863270),m=n(852314),u=n(330362),p=n(303397),h=n(686464),f=n(355755),_=n(200300),g=n(991675),v=n(134642),E=n(835486),b=n(923164),y=n(247852),C=n(306152),w=n(176677),x=n(354175),k=n(755534),I=n(696786),T=n(746606),P=n(904960),S=n(19180),M=n(865114),N=n(452275),D=n(781239),A=n(952401),L=n(14564),R=n(660376);function O(e){let t=a.useRef(null),n=(0,x.wY)(t)??x.cU,o=function(e){switch(e.display){case"inline-flex":return e.selected?"card--selectedCard---f8bk card--_card--xs0Vl":"card--card---tdpz card--_card--xs0Vl";case"flex":return e.selected?"card--flexSelectedCard---zq1t card--selectedCard---f8bk card--_card--xs0Vl":"card--flexCard--i3MFT card--card---tdpz card--_card--xs0Vl";default:(0,R.xb)(e.display)}}(e);return a.createElement("div",{className:"card--container--aao5L"},a.createElement("button",{"aria-label":e.ariaLabel,style:{width:n.width,height:n.height,borderRadius:e.borderRadius},className:"card--keyboardFocusableCard--rZ7LL",onClick:e.onClick,onFocus:e.onFocus,onBlur:e.onBlur}),a.createElement("div",{ref:t,className:o,onClick:e.onClick,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},e.children))}var B=n(730143),F=n(125761),U=n(302982),V=n(773511),H=n(168323),q=n(353317),z=n(408193),$=n(232167),K=n(218742),W=n(682808),Z=n(536384),G=n.n(Z),j=n(484169),X=n(720522),Q=n(401970),Y=n(17753),J=n(387594),ee=n(125952),et=n(175964);let en="comment_avatar_list--avatarListElement--7ghSl",ea=a.memo(function(e){let{userId:t,imgUrl:n,handle:o}=e,r=a.useMemo(()=>({id:t,img_url:n,handle:o}),[t,n,o]);return a.createElement("div",{className:en},a.createElement(ee.Ro,{size:24,entity:r,className:"comment_avatar_list--commentAvatar--LwAuB"}))});function eo(e){let{avatars:t,maxAvatarsShown:n}=e,o=a.useMemo(()=>t.slice(0,n-1),[t,n]),r=t.length===n,i=t.length>e.maxAvatarsShown,l=t[e.maxAvatarsShown-1];return a.createElement("div",{className:e.grayscale?"comment_avatar_list--avatarListGrayscale--TQPH8 comment_avatar_list--avatarList--ogW8K":"comment_avatar_list--avatarList--ogW8K"},o.map(e=>a.createElement(ea,{key:e.avatar_user_id,userId:e.avatar_user_id,imgUrl:e.avatar_url,handle:e.avatar_user_handle})),r&&l&&a.createElement(ea,{key:l.avatar_user_id,userId:l.avatar_user_id,imgUrl:l.avatar_url,handle:l.avatar_user_handle}),i&&a.createElement("div",{className:en},a.createElement(et.f,{size:24,className:"comment_avatar_list--overflowAvatar--6i3DO comment_avatar_list--commentAvatar--LwAuB",text:`${e.avatars.length-e.maxAvatarsShown+1}`})))}var er=n(16808),ei=n(173926),el=n(339542);let es=a.memo(function(e){return a.createElement("div",{className:"comment_metadata--commentMetadata---ku0T"},(e.orderId||e.parentName&&!e.hideParentName)&&a.createElement("span",{className:"comment_metadata--parentName--pO-hK text--fontPos11--2LvXf text--_fontBase--QdLsd"},a.createElement(ed,{parentName:e.parentName||null,orderId:e.orderId,hideParentName:e.hideParentName,thread:e.thread,hideOrphanedState:e.hideOrphanedState})),a.createElement(ec,{rootUser:e.rootUser,createdAt:e.createdAt,isPendingFromSinatra:e.isPendingFromSinatra}))});function ec(e){return a.createElement("span",{className:"comment_metadata--authorTimeCreated--su-Jn"},a.createElement("div",{className:"comment_metadata--author--FqE-k text--fontPos11--2LvXf text--_fontBase--QdLsd",dir:"auto"},e.rootUser),"\xa0",a.createElement("div",{className:"comment_metadata--timeCreated---00vM text--fontPos11--2LvXf text--_fontBase--QdLsd"},e.isPendingFromSinatra?(0,s.tx)("comments.in_a_moment"):a.createElement(ei.h1,{date:e.createdAt,capitalize:!0})))}function ed(e){let t=(0,el.Kq)(e.thread);if(!e.hideOrphanedState&&t){if(e.orderId){let t=(0,s.tx)("comments.unattached");return(0,s.tx)("comments.parent_name_and_number",{parentName:t,commentNumber:e.orderId})}return null}return e.hideParentName||!e.parentName?e.orderId?(0,s.tx)("comments.number_only",{commentNumber:e.orderId}):null:e.orderId?(0,s.tx)("comments.parent_name_and_number",{parentName:e.parentName,commentNumber:e.orderId}):a.createElement("span",null,e.parentName)}var em=n(314979),eu=n(210853),ep=n(151223);let eh=(0,ep.nF)((e,t)=>{let{receiptsAPI:n,comment:a}=t;n.markAsUnread(a.uuid).catch(t=>{let n=(0,s.t)("whiteboard.an_error_occurred_while_marking_a_canvas_mention_as_unread");try{t=JSON.parse(t),e.dispatch(em.s.error((0,eu.J)(t,n)))}catch(t){e.dispatch(em.s.error(n))}})}),ef=(0,ep.nF)((e,t)=>{let{receiptsAPI:n,thread:a}=t,o=a.comments.map(e=>e.uuid).filter(e=>!!e);n.markAsRead(o).catch(t=>{let n=(0,s.t)("whiteboard.an_error_occurred_while_marking_a_canvas_mention_as_read");try{t=JSON.parse(t),e.dispatch(em.s.error((0,eu.J)(t,n)))}catch(t){e.dispatch(em.s.error(n))}})});var e_=n(31898),eg=n(691784),ev=n(431698),eE=n(711332);function eb(e){let{thread:t,isUnread:n,copyLink:r,onDeleteThread:i}=e,{commentReceipts:l}=(0,ev.I_)(),d=(0,eg.fr)(),m=(0,o.wA)(),u=(0,B.tS)(),p=(0,F.TA)(),h=a.useCallback(()=>{l&&(n?m(c.AY({receiptsAPI:l,thread:t})):m(c.QY({receiptsAPI:l,comment:t.comments[0]})))},[l,m,n,t]),f=a.useCallback(()=>{d&&(n?m(ef({receiptsAPI:d,thread:t})):m(eh({receiptsAPI:d,comment:t.comments[0]})))},[d,m,n,t]),_=a.useCallback(()=>{r(t.comments[0])},[r,t]),g=a.useCallback(()=>{let e=i?()=>i(t):()=>m(c.Mv({comment:t.comments[0]}));m((0,e_.to)({type:eE.h,data:{onConfirm:e}}))},[m,i,t]),v=a.useMemo(()=>{if(p===t.comments[0].user_id&&!t.isCanvasMention&&(0,U.MV)(t.sidebarItemType))return a.createElement(H.q7,{onClick:g,key:"deleteThread"},(0,s.tx)("comments.delete_thread"))},[t,p,g]),E=a.useMemo(()=>{let e=[];return d&&u&&t.isCanvasMention?e.push(a.createElement(H.q7,{onClick:f,key:"toggleUnreadCanvasMention"},n?(0,s.tx)("comments.mark_as_read"):(0,s.tx)("comments.mark_as_unread"))):l&&u&&!t.isCanvasMention&&(0,U.m)(t.sidebarItemType)&&e.push(a.createElement(H.q7,{onClick:h,key:"toggleUnreadComment"},n?(0,s.tx)("comments.mark_as_read"):(0,s.tx)("comments.mark_as_unread"))),e.push(a.createElement(H.q7,{onClick:_,key:"copyCommentLink"},(0,s.tx)("comments.copy_link"))),v&&e.push(v),e},[l,d,u,_,v,t.isCanvasMention,t.sidebarItemType,f,h,n]);return a.createElement(H.mc,null,E)}let ey="comments_row_presentation--button--wBibN",eC="comments_row_presentation--headerElement--FStcl",ew="comments_row_presentation--blueDot--n7bLI",ex="comments_row_presentation--countMetadata--xGPiX";var ek=n(255111),eI=n(452),eT=n(325876),eP=n(214487),eS=n(57544),eM=n(505e3);let eN=a.memo(function(e){return a.createElement("div",{className:"comments_row_presentation--replyAndAttachmentCount--OrlJC"},0!==e.replyCount&&a.createElement(a.Fragment,null,a.createElement("div",{className:ex},(0,s.tx)("comments.reply_count",{replyCount:e.replyCount})),0!==e.attachmentCount&&a.createElement("div",{className:"comments_row_presentation--dot--9cR30 comments_row_presentation--countMetadata--xGPiX"},"\xb7")),0!==e.attachmentCount&&a.createElement("div",{className:ex},(0,s.tx)("comments.attachment_count",{attachmentCount:e.attachmentCount})))}),eD=a.memo(function(e){return a.createElement(a.Fragment,null,e.postTitle&&a.createElement("div",{className:"comments_row_presentation--postTitle--9oNMe"},e.postTitle),!(0,j.I)(e.messageMeta)&&a.createElement(J.HH,{className:"comments_row_presentation--commentMessage--q-YaC text--fontPos11--2LvXf text--_fontBase--QdLsd ellipsis--ellipsisAfter3Lines--h405C ellipsis--_ellipsisAfterNLines--LzI7k comment_message--commentMessage--kZCzD",messageMeta:e.messageMeta,commentId:e.commentId}),a.createElement(eN,{replyCount:e.replyCount,attachmentCount:e.attachmentCount}))}),eA=e=>e.stopPropagation(),eL=a.memo(function(e){let{copyLink:t,isPendingFromSinatra:n,optionsMenuRef:r,onDeleteThread:i,isUnavailable:l,isResolved:c,isUnread:d,onChangeResolveState:u,thread:p,isFocusedThread:h,userCanResolveThread:f,openPostDetailModal:_}=e,g=(0,o.d4)(e=>e.comments.hoveredPinIds),v=(0,I.GS)(),E=(0,S.k)().fpl_card_primitive_migration,b=e.thread.replyCount||e.thread.comments.length-1,y=e.thread.attachments?.length||e.thread.comments.map(e=>e.attachments?.length||0).reduce((e,t)=>e+t,0)||0,C=e.avatars[0].avatar_user_handle,w=e.hideResolve||!f||n,x=p.sidebarItemType===U.kT.FEED_POST&&!(0,m.y)(),k=E?a.createElement(P.HG,null,a.createElement(V.E,{"aria-label":(0,s.t)("comments.unavailable_offline"),"data-tooltip-type":Y.Ib.TEXT,"data-tooltip":(0,s.t)("comments.unavailable_offline"),"data-onboarding-key":"page-unavailable-offline"},a.createElement("span",{"aria-hidden":"true"},a.createElement(X.B,{svg:ek.A})))):a.createElement("div",{"data-tooltip-type":Y.Ib.TEXT,"data-tooltip":(0,s.t)("comments.unavailable_offline"),"data-onboarding-key":"page-unavailable-offline"},a.createElement(X.B,{svg:ek.A})),T=null!=p.commentPin,{manager:M,getTriggerProps:N}=H.b(),D=a.createElement(H.bL,{manager:M},a.createElement(q.d,{"aria-label":(0,s.t)("comments.more_actions"),...N()},a.createElement(z.J,{className:M.isOpen?void 0:ey})),a.createElement(eb,{thread:p,isUnread:e.isUnread,copyLink:t,onDeleteThread:i})),A=a.createElement(er.K0,{svg:c?eP.A:eT.A,className:G()(c?"comments_row_presentation--resolvedButton--EJTu4 comments_row_presentation--button--wBibN":!T&&ey,e.isUnread?"":"comments_row_presentation--buttonRead--zeH0O"),"data-tooltip-type":Y.Ib.TEXT,"data-tooltip":T?(0,s.t)("comments.pinning.cannot_resolve"):c?(0,s.t)("comments.mark_as_unresolved"):(0,s.t)("comments.mark_as_resolved"),onClick:u,onMouseDown:eA,disabled:T},a.createElement(Q.U,{svg:c?eP.A:eT.A},c?a.createElement($.g,null):a.createElement(K.W,null))),L=a.createElement(er.K0,{svg:eM.A,className:ey,"data-tooltip-type":Y.Ib.TEXT,"data-tooltip":(0,s.t)("fig_feed.view_post"),onClick:_,onMouseDown:eA}),R=a.createElement(a.Fragment,null,!n&&!x&&(E?a.createElement(P.HG,{className:eC,ref:r},D):a.createElement("div",{className:eC,ref:r},D)),e.thread.sidebarItemType===U.kT.FEED_POST&&(E?a.createElement(P.HG,{className:eC,ref:r},L):a.createElement("div",{className:eC,ref:r},L)),!w&&(E?a.createElement(P.HG,{className:eC},A):a.createElement("div",{className:eC},A," ")));return a.createElement("div",{className:G()(p.isActive?"comments_row_presentation--commentSelected--whxrP comments_row_presentation--_comment--x7j04 text--fontPos11--2LvXf text--_fontBase--QdLsd":h||M.isOpen?"comments_row_presentation--commentFocused---7hfS comments_row_presentation--_comment--x7j04 text--fontPos11--2LvXf text--_fontBase--QdLsd":"comments_row_presentation--comment--wtdS- comments_row_presentation--_comment--x7j04 text--fontPos11--2LvXf text--_fontBase--QdLsd",{"comments_row_presentation--unread--xgn7e":d,"comments_row_presentation--pinHovered--k1OJV":g.includes(p.id)})},!v&&a.createElement("span",{className:ew}),a.createElement("div",{className:"comments_row_presentation--commentInner--Eu0xM"},v&&a.createElement("div",{className:ew},a.createElement(W.H,null)),a.createElement("span",{className:"comments_row_presentation--commentHeader---8DED"},e.thread.sidebarItemType===U.kT.FEED_POST&&a.createElement(X.B,{svg:eS.A,className:"comments_row_presentation--postIcon--VsaAl"}),a.createElement(eo,{maxAvatarsShown:4,avatars:e.avatars,grayscale:!e.isUnread}),a.createElement("div",{className:M.isOpen?"comments_row_presentation--buttonsVisible--m7qED comments_row_presentation--buttons--qc-Yn":"comments_row_presentation--buttons--qc-Yn"},l?k:R)),a.createElement(es,{rootUser:C,createdAt:e.thread.comments[0].created_at,isPendingFromSinatra:n,orderId:e.orderId,parentName:e.parentName,hideParentName:e.hideParentName,thread:e.thread,hideOrphanedState:e.hideOrphanedState}),e.thread.sidebarItemType===U.kT.FEED_POST&&a.createElement("div",{className:"comments_row_presentation--postThumbnailContainer--NjgZy"},a.createElement("img",{src:e.thread.feedPostThumbnail,alt:"placeholder",className:"comments_row_presentation--postThumbnail--SPSS3 feed_post_popover_modal--postThumbnail--jac1E",style:{backgroundColor:e.thread.feedPostThumbnailBackground,padding:e.thread.padFeedPostThumbnail?"8px":"0"}}),e.thread.feedPostNumContent>1&&a.createElement("div",{className:"comments_row_presentation--numContent--HmWiu comments_row_presentation--postThumbnailOverlay--pPIMf feed_post_popover_modal--postThumbnailOverlay--vDoKP"},a.createElement(X.B,{svg:eI.A,className:"comments_row_presentation--overlayIcon--91i3d"}))),a.createElement(eD,{commentId:e.thread.comments[0].id,messageMeta:e.thread.comments[0].message_meta,replyCount:b,attachmentCount:y,postTitle:e.thread.sidebarItemType===U.kT.FEED_POST?e.thread.feedPostTitle:void 0})))});var eR=n(186606),eO=n(553547),eB=n(334704),eF=n(315933),eU=n(454805),eV=n(952039),eH=n(792533),eq=n(453370),ez=n(15105),e$=n(859480),eK=n(665411),eW=n(633468),eZ=n(318147),eG=n(314774),ej=n(819013),eX=n(563741),eQ=n(228845),eY=n(20649),eJ=n(355739),e0=n(633899);function e1(e){let t=(0,o.d4)(e=>e.mirror.appModel.pagesList);return null===e.page||(0,eK.Fy)(t,e.page)===eR.xal.LOADED}let e2=a.memo(function(e){let{element:t}=e,{comments:n}=t,{getClosestThread:r,onResolveComment:i}=e.extras,l=a.useMemo(()=>{let e=new Map,t=[];return n.forEach(n=>{if(e.has(n.user.id)){let a=e.get(n.user.id);t[a].num_unread_comments+=n.isUnread?1:0,t[a].num_comments+=1}else t.push({avatar_url:n.user.img_url,avatar_user_id:n.user.id,avatar_user_handle:n.user.handle,num_unread_comments:n.isUnread?1:0,num_comments:1}),e.set(n.user.id,t.length-1)}),t},[n]),d=!!n[0].resolved_at,m=n.some(e=>e.isUnread),h=!!t.isPendingFromSinatra,f=a.useRef(null),_=(0,M.ZC)(t.isActive),g=a.useRef(!1),b=(0,F.iZ)(),y=(0,B.q5)(),C=(0,N.yZ)(),w=e1(t),x=a.useMemo(()=>!C&&!w,[C,w]),k=(0,E.hB)(),I=a.useMemo(()=>k(t),[k,t]),R=t.id,{isFocusedThread:V,onCanvasMentionSelect:H,onCommentFocus:q,onCommentBlur:z,onCommentMouseEnter:$,onCommentMouseLeave:K,onCommentSelect:W,onChangeResolveState:Z,onCanvasMentionCopyLink:G,openPostDetailModal:j}=function(e,t,n){let r=(0,o.wA)(),{comments:i}=e,l=!!i[0].resolved_at,d=a.useRef(!1),[m,u]=a.useState(!1),h=e.id,f=!B.q5()?.canEdit,_=(0,o.d4)(e=>e.mirror.appModel.showComments),g=(0,N.yZ)(),b=e1(e),y=a.useContext(eG.kw),C=(0,eX.s)(),w=(0,el.Kq)(e),x=(0,ez.Z)("comments_navigate"),k=!!e.isPendingFromSinatra,I=(0,ev.I_)(),T=(0,eg.fr)(),P=(0,o.Pj)(),S=(0,eQ.n0)(),M=(0,eY.VS)({pagesList:S,isComparingChanges:!1,enabled:!!e.isCanvasMention}),D=(0,e$.dh)(!!e.isCanvasMention),A=a.useCallback(()=>{let t=P.getState().openFile;if(t){let n=(0,eW.jN)({file:t,nodeId:e.nodeId,isFigJam:t.editorType===eZ._Y.WHITEBOARD});r(eH.S({url:n}))}},[r,e.nodeId,P]),L=a.useCallback(()=>g||b?(r(eV.F.dequeue({matchType:"offline-comment-navigation"})),!1):(r(eV.F.enqueue({type:"offline-comment-navigation",message:(0,s.t)("comments.unavailable_offline")})),!0),[g,b,r]),R=a.useCallback(async()=>{if(!L()&&(d.current=!0,r(c.Fm({threadId:h,source:void 0})),e.nodeId||e.stablePath)){let t;let n=P.getState().mirror.sceneGraph;e.isCanvasMention&&T&&r(ef({thread:e,receiptsAPI:T}));let a=eO.x7;e.stablePath?a=`[${e.stablePath.join(",")}]`:e.nodeId&&(a=`[${e.nodeId}]`),e.isCanvasMention&&e.page&&e.page!==D&&(await M(e.page),await (0,eB.yQ)()),eR.glU.setActiveCommentAnchorData({stablePath:a}),eR.fp8.markMentionsAsReadFromStablePath(a),e.stablePath?t=n.getFromStablePath(e.stablePath):e.nodeId&&(t=n.get(e.nodeId)),t&&x((0,e0.e)(t,y,"canvas-mentions"),{additionalTrackEventParams:{text_node_id_path:e.nodeId,mention_id:e.uuid}})}},[L,r,h,e,P,T,x,y,M,D]),O=(0,E.Ue)(),F=a.useMemo(()=>{if(O)return O(e)},[O,e]),V=a.useCallback(()=>{if(L())return;d.current=!0,f&&!_&&p.Y5.triggerAction("toggle-show-comments",{source:"comment_sidebar_list"}),F&&F(),eF.sn.start("view_comment_thread");let n=y.getViewportInfo(),a={thread:e,viewport:y,config:C,navigate:x,isOrphanedComment:w};if(r(k?c.l5(a):c.bB({...a,receiptsAPI:I.commentReceipts})),!w&&!C.disableZoomViewportOnCommentSelection){let a=t(e.id);if(a){let t=eU.Mi.distance(e.canvasPosition,a?.canvasPosition),o=(0,ej.ez)(v.i$,t,n.zoomScale);o>n.zoomScale&&(y.setZoomScale(n.zoomScale,o),y.setCanvasSpaceCenter(e.canvasPosition,n,o))}}},[I.commentReceipts,C,_,r,t,w,k,x,F,L,e,f,y]),H=a.useCallback(()=>{u(!0),r(c.NJ({threadId:h}))},[r,h]),q=a.useCallback(()=>{requestAnimationFrame(()=>{u(!1)}),r(c.Oo({threadId:h}))},[r,h]),z=a.useCallback(()=>{r(c.NJ({threadId:h}))},[r,h]);return{isFocusedThread:m,onCanvasMentionSelect:R,onCommentFocus:H,onCommentBlur:q,onCommentMouseEnter:z,onCommentMouseLeave:a.useCallback(()=>{d.current=!1,r(c.Oo({threadId:h}))},[r,h]),onCommentSelect:V,onChangeResolveState:a.useCallback(e=>{e.stopPropagation(),r(eq.oB()),n&&n(h,!l)},[h,r,n,l]),onCanvasMentionCopyLink:A,openPostDetailModal:a.useCallback(()=>{e.sidebarItemType===U.kT.FEED_POST&&r((0,e_.to)({type:eJ.K,data:{postUuid:e.feedPostPublicUuid,inFileView:!0}}))},[r,e])}}(t,r,i),{scrollableRef:X}=e,{isActive:Q}=t;a.useEffect(()=>{g.current||!Q||_||X.current?.scrollToRow(R)},[Q,R,_,X]);let Y=b?.id,J=a.useMemo(()=>!!(0,U.Vk)(t.sidebarItemType)&&(!(0,U.m)(t.sidebarItemType)||(y&&Y?(0,T.To)(t,y,Y):null)),[y,Y,t]),ee=(0,D.rf)(`comment-sidebar-comment-${t.id}`,"click",W),et=(0,u.k)(),en=(0,L.WN)();et&&(ee=()=>en("SELECT_COMMENT_SIDEBAR")),t.isCanvasMention&&(ee=H);let ea=t.comments.length-1,eo=m?(0,s.t)("comments.aria_label_select_comment_descriptive_unread",{authorString:l[0].avatar_user_handle,contentString:(0,A.F)(t.comments[0].message_meta[0]?.t)??"",replyString:(0,s.t)("comments.reply_count",{replyCount:ea})}):(0,s.t)("comments.aria_label_select_comment_descriptive",{authorString:l[0].avatar_user_handle,contentString:(0,A.F)(t.comments[0].message_meta[0]?.t)??"",replyString:(0,s.t)("comments.reply_count",{replyCount:ea})}),er=t.isCanvasMention?G:e.extras.copyLink,ei=a.createElement(eL,{avatars:l,copyLink:er,hideOrphanedState:e.extras.hideOrphanedState,hideParentName:e.extras.hidePageName,hideResolve:e.extras.hideResolve||!!t.isCanvasMention,isFocusedThread:V,isPendingFromSinatra:h,isResolved:d,isUnavailable:x,isUnread:m,onChangeResolveState:Z,onDeleteThread:e.extras.onDeleteThread,openPostDetailModal:j,optionsMenuRef:f,orderId:t.comments[0].order_id||null,parentName:I,thread:t,userCanResolveThread:J});return a.createElement(a.Fragment,null,(0,S.k)().fpl_card_primitive_migration?a.createElement(P.bL,{className:"comments_row_presentation--cardRoot--PjGzu"},a.createElement(P.O6,{htmlAttributes:{onBlur:z,onFocus:q,onMouseEnter:$,onMouseLeave:K},className:"comments_row_presentation--cardButton--5hUiX",onClick:ee,"aria-label":eo,"aria-expanded":t.isActive}),ei):a.createElement(O,{onClick:ee,onBlur:z,onFocus:q,onMouseEnter:$,onMouseLeave:K,ariaLabel:eo,selected:t.isActive,display:"flex"},ei))}),e3=a.memo(function(e){let{index:t,start:n,measureRef:o}=e.virtualItem,{setSize:r}=e,i=a.useRef(t);a.useEffect(()=>{i.current=t},[t,i]);let l=a.useCallback(e=>{let t=e?.getBoundingClientRect().height;t&&r(i.current,t),o(e)},[i,o,r]);return a.createElement("div",{ref:l,style:{position:"absolute",top:n,left:0,width:"100%"}},e.children)});function e4(e){let t=a.useRef(null),{elements:n}=e,o=(0,I.GS)(),r=(0,E.Lc)(),i=a.useRef(n);a.useEffect(()=>{i.current=n},[n]);let l=(0,x.wY)(t),{estimatedSize:s}=e,c=a.useRef(null),d=a.useRef(new Map),m=a.useCallback(e=>0===n.length?0:d.current.get(e)||s,[n,s]),u=a.useCallback((e,t)=>{d.current.set(e,t)},[]),p=(0,w.z)({size:n.length,parentRef:c,estimateSize:m,overscan:10,paddingEnd:r}),h=p.scrollToIndex,f=a.useRef({scrollToRow:t=>{h(n.findIndex(n=>n[e.elementKey]===t))}});return a.useEffect(()=>{f.current={scrollToRow:t=>{h(n.findIndex(n=>n[e.elementKey]===t))}}},[n,h,e.elementKey]),a.createElement("div",{ref:t,className:"comments_sidebar_list--container--VBa2a"},a.createElement(k.P,{scrollContainerRef:c,height:l?.height||0},a.createElement("div",{style:{height:`${p.totalSize}px`,width:"100%",position:"relative",marginTop:o?"var(--spacer-1)":void 0}},p.virtualItems.map(t=>{let n=e.elements[t.index],o=n[e.elementKey],r=e.row;return a.createElement(e3,{key:o,virtualItem:t,setSize:u},a.createElement(r,{element:n,dataset:i,scrollableRef:f,extras:e.extras}))}))))}let e5=a.memo(function(e){let{onResolveComment:t,hideResolve:n,copyLink:o,hidePageName:r,hideOrphanedState:i,onDeleteThread:l}=e,s=(0,T.$I)(e.items),c=a.useMemo(()=>({onResolveComment:t,getClosestThread:s,hideResolve:n,copyLink:o,hidePageName:r,hideOrphanedState:i,onDeleteThread:l}),[t,s,n,o,r,i,l]);return a.createElement(e4,{elements:e.items,elementKey:"id",row:e2,estimatedSize:133,extras:c})});var e6=n(393704),e8=n(133318),e7=n(877770),e9=n(523152),te=n(439382),tt=n(847240),tn=n(586892),ta=n(821527);let to=a.forwardRef((e,t)=>{let{searchInputRef:n,onMouseDown:o,onMouseUp:r,onClearSearchClick:i,onClearSearchKeyDown:l,onBlur:c,onSearchKeyDown:d,onSearchChange:m}=(0,tt.ne)(e,t),u=a.useCallback(e=>{e.stopPropagation(),d(e)},[d]),p=a.useCallback(e=>{"Enter"===e.key&&l(e),e.stopPropagation()},[l]);return a.createElement("div",{className:"sidebar_search--searchContainer--eU94N"},a.createElement(Q.U,{svg:tn.A,className:"sidebar_search--searchIcon--3FhmC","aria-label":(0,s.t)("fullscreen.accessibility.search_icon")},a.createElement(e7.h,null)),a.createElement(te.L,{ref:n,className:"sidebar_search--searchInput--ySEJ2 text--fontPos11--2LvXf text--_fontBase--QdLsd ellipsis--ellipsis--Tjyfa",onBlur:c,onChange:m,onKeyDown:u,onMouseDown:o,onMouseUp:r,placeholder:e.placeholder||(0,s.t)("search.sidebar_search_placeholder"),spellCheck:!1,value:e.query}),!!e.query&&a.createElement("button",{className:"sidebar_search--xIcon--1xoiw",onClick:i,onKeyDown:p,"aria-label":(0,s.t)("search.sidebar_search_clear")},a.createElement(Q.U,{svg:ta.default},a.createElement(e9.L,null))))});to.displayName="sidebarSearchBar";var tr=n(617215),ti=n(996202),tl=n(813009),ts=n(183603),tc=n(238462),td=n(304756);let tm=(0,ep.nF)((e,t)=>{let n=td.Ay.put(`/api/file/${t.key}/file_followers`,{notification_preference:t.notification_preference}).catch(t=>{let n=t.data?.message||"An error occurred while updating notification preference.";e.dispatch(em.s.flash(n)),console.error(t)}),a=e.getState().user?.id;t.id?ts.WB()?.optimisticallyUpdate({FileFollower:{[t.id]:{notificationPreference:t.notification_preference}}},n):a&&ts.WB()?.optimisticallyCreate({FileFollower:{[`optimistic-id-${t.key}`]:{key:t.key,userId:a,notificationPreference:t.notification_preference,unreadComments:null,statusChangeNotifs:!1}}},n)});var tu=(e=>(e.ALL="all",e.PARTICIPATING="participating",e.NONE="none",e))(tu||{}),tp=n(197696),th=n(788792),tf=n(698429);function t_(){let e=(0,o.d4)(B.sS),t=(0,F.iZ)(),n=(0,ev.jp)(),r=(0,ev.I_)(),i=(0,eg.fr)(),l=(0,ev.n6)(),d=(0,tf.ks)(),m=(0,o.wA)(),u=(0,o.d4)(e=>e.mirror.appModel.showComments),h=a.useCallback(()=>{p.Y5.triggerAction("toggle-show-comments",{source:"comments_sidebar_setting"})},[]),f=(0,tl.R)(e=>e.mirror.appModel.keyboardShortcuts),_=(0,tp.c1)(f,"toggle-show-comments"),g=(0,ti.am)();if(a.useEffect(()=>{g("Properties Panel Comments Tab Settings Opened")},[g]),!e||!t)return null;if("loaded"!==n.status)return a.createElement(H.mc,null,a.createElement(H.q7,{disabled:!0,onClick:tc.lQ},(0,s.tx)("comments.error_loading_notification_preferences")));let v=n?.data?.notificationPreference||tu.NONE,E=n?.data?.statusChangeNotifs??!1,b=t=>{t!==v&&(m(tm({id:n?.data?.id,key:e,notification_preference:t})),g("Comments Notification Preference Changed",{newPreference:t,fileKey:e}))},y=a=>{if(a===E)return;let o=th.sr.updateStatusChangePreferences({fileKey:e,optIn:a}).catch(e=>{let t=e.data?.message||"An error occurred while updating status change preference.";m(em.s.flash(t)),console.error(e)});n?.data?.id?ts.WB()?.optimisticallyUpdate({FileFollower:{[n?.data?.id]:{statusChangeNotifs:a}}},o):t?.id&&ts.WB()?.optimisticallyCreate({FileFollower:{[`optimistic-id-${e}`]:{key:e,userId:t.id,notificationPreference:null,unreadComments:null,statusChangeNotifs:a}}},o),g("Dev Mode Notification Preference Changed",{newPreference:a,fileKey:e})};return a.createElement(H.mc,null,a.createElement(tr.H_,{key:"preference",checked:!u,onChange:h},(0,s.tx)("comments.hide_comments"),_&&a.createElement(H.Ov,null,a.createElement(H.ME,null,a.createElement(H.rm,null,_)))),a.createElement(H.wv,null),a.createElement(tr.z6,{key:"comment-notification-title",onChange:e=>b(e),title:a.createElement(H.hE,null,(0,s.tx)("comments.comment_notifications")),value:v},a.createElement(tr.CU,{key:"notification-all",value:tu.ALL},(0,s.tx)("comments.everything_option")),a.createElement(tr.CU,{key:"notification-participating",value:tu.PARTICIPATING},(0,s.tx)("comments.just_mentions_and_replies_option")),a.createElement(tr.CU,{key:"notification-none",value:tu.NONE},(0,s.tx)("comments.nothing_option"))),d&&a.createElement(tr.z6,{key:"dev-mode-notification-title",title:a.createElement(H.hE,null,(0,s.tx)("comments.dev_mode_notifications")),onChange:e=>y("true"===e),value:E?"true":"false"},a.createElement(tr.CU,{key:"notification-dm-status-changes",value:"true"},(0,s.tx)("comments.status_changes")),a.createElement(tr.CU,{key:"notification-dm-none",value:"false"},(0,s.tx)("comments.nothing_option"))),a.createElement(H.q7,{key:"mark_all_read",onClick:()=>{let e=r.commentReceipts;e&&i&&m(c.Tb({commentReceiptsAPI:e,canvasMentionReceiptsAPI:i}))},disabled:0===l},(0,s.tx)("comments.mark_all_as_read")))}var tg=n(744550);let tv="comments_sidebar_header--headerIconButton--JiHD6",tE="comments_sidebar_header--headerIconButtonSel--3-zXH";function tb(e){let t=(0,o.wA)(),{getTriggerProps:n,manager:r}=H.b(),i=(0,u.k)(),l=(0,L.WN)();(0,tg.Z)(r);let d=(0,M.ZC)(r.isOpen);return(a.useEffect(()=>{if(d!==r.isOpen){if(i)return l("SELECT_COMMENT_SIDEBAR");t(c.UU())}},[t,i,r.isOpen,d,l]),e.hideSettingsDropdown)?null:a.createElement(H.bL,{manager:r},a.createElement(q.d,{...n(),"aria-label":(0,s.t)("comments.settings")},a.createElement(z.J,{className:G()(r.isOpen&&tE)})),a.createElement(t_,null))}var ty=n(343167),tC=n(383262);function tw({activeFilters:e,...t}){let n=(0,o.wA)(),{getTriggerProps:r,manager:i}=H.b(),l=(0,a.useMemo)(()=>{let t=new Set(e);return e.has(e6.mW.RESOLVED)?t.delete(e6.mW.RESOLVED):t.add(e6.mW.RESOLVED),t},[e]),d=t.filters.some(e=>l.has(e)),m="all"!==t.activeMode,u=(d||m)&&!i.isOpen,p=a.useMemo(()=>{let e=[];return t.sorts.length>0&&e.push(a.createElement(tr.z6,{key:"sort-group",title:a.createElement(H.r1,null,(0,s.t)("comments.sort")),onChange:t.threadManager.setSort,value:t.activeSort},t.sorts.map(e=>a.createElement(tr.CU,{key:`sort-option-${e}`,value:e},(0,C.L9)(e))))),t.filters.length>0&&e.push(a.createElement(tr.$Q,{key:"filter-group",title:a.createElement(H.r1,null,(0,s.t)("comments.filter")),onChange:e=>{let n=new Set(e),a=new Set(l);new Set([...Array.from(n).filter(e=>!a.has(e)),...Array.from(a).filter(e=>!n.has(e))]).forEach(t.threadManager.toggleFilter)},selectedItems:Array.from(l)},t.filters.map(e=>a.createElement(tr.a2,{key:`filter-option-${e}`,value:e,disabled:C.vO[t.activeMode].includes(e)},(0,C.T4)(e))))),t.modes&&t.modes.length>0&&e.push(a.createElement(tr.z6,{key:"mode-group",title:a.createElement(H.r1,null,(0,s.t)("comments.mode")),onChange:t.threadManager.setMode,value:t.activeMode},t.modes.map(e=>a.createElement(tr.CU,{key:`mode-option-${e}`,value:e},(0,C.ek)(e))))),e},[t.sorts,t.filters,t.modes,t.activeSort,t.threadManager,t.activeMode,l]),h=(0,M.ZC)(i.isOpen)??!1;return a.useEffect(()=>{h!==i.isOpen&&n(c.UU())},[n,i.isOpen,h]),a.createElement(H.bL,{manager:i},a.createElement(q.d,{...r(),"aria-label":(0,s.t)("comments.sort_filter")},a.createElement(X.B,{className:G()(u?"comments_sidebar_header--sortButtonActive--sPnuw":tv,i.isOpen&&tE),svg:u?tC.A:ty.A})),a.createElement(H.mc,null,p))}function tx(e){let t=(0,o.wA)(),n=a.useCallback(()=>{t(c.UU()),e.threadManager.setQuery("")},[t,e.threadManager]),r=a.useCallback(n=>{t(c.UU()),e.threadManager.setQuery(n)},[t,e.threadManager]);return a.createElement(a.Fragment,null,a.createElement("div",{className:e.stackHeader?"comments_sidebar_header--sidebarHeaderStacked--qkQGM comments_sidebar_header--sidebarHeader--BwT0H text--fontPos11--2LvXf text--_fontBase--QdLsd":"comments_sidebar_header--sidebarHeader--BwT0H text--fontPos11--2LvXf text--_fontBase--QdLsd"},a.createElement(to,{focusOnMount:!1,query:e.activeQuery||"",clearSearch:n,onChange:r}),a.createElement("div",{className:"comments_sidebar_header--sidebarHeaderButtons--XMkx3"},a.createElement(tw,{activeFilters:e.activeFilters,activeMode:e.activeMode,activeSort:e.activeSort,filters:e.filters,modes:e.modes,sorts:e.sorts,threadManager:e.threadManager}),a.createElement(tb,{hideSettingsDropdown:e.hideSettingsDropdown}),e.onCloseButton&&a.createElement(e8.Jn,{className:tv,recordingKey:"threadHeader",onClick:e.onCloseButton,innerText:(0,s.t)("comments.close_sidebar"),"aria-label":(0,s.t)("comments.close_sidebar")}))))}var tk=n(890611);function tI(e){return a.createElement("div",{className:"empty_state_message_view--emptyStateWrapper--QSOXE"},a.createElement("div",{className:"empty_state_message_view--emptyStateInner--XVxQ0"},a.createElement(X.B,{className:"empty_state_message_view--commentTool--lg4bm",svg:tk.A}),a.createElement("div",{className:"empty_state_message_view--emptyStateMessage--3q4Qh"},e.message)))}function tT(e){return e.hasActiveQuery?a.createElement(tI,{message:(0,s.tx)("comments.no_comments_matched_your_search")}):({filters:e.filters}).filters.has("yours")?a.createElement(tI,{message:(0,s.tx)("comments.when_you_leave_a_comment_or_get_mentioned_in_one_it_ll_show_up_here")}):a.createElement(tI,{message:(0,s.tx)("comments.give_feedback_ask_a_question_or_just_leave_a_note_of_appreciation_click_anywhere_in_the_file_to_leave_a_comment")})}function tP(e){let t=(0,f.dH)(),{activeQuery:n,activeFilters:o}=a.useContext(C.hh),{loadedSidebarItems:r}=e,i=!n||n&&!r.length,l=r.length,s=(0,h.q)(),c=(0,u.k)();return(0,d.T8)(a.createElement(a.Fragment,null,s&&a.createElement(y.Mw,{panelName:y.ON.COMMENTS}),i&&!l&&!c&&a.createElement(tT,{hasActiveQuery:!!n,filters:o,empty:!r.length}),a.createElement(e5,{items:r,onResolveComment:e.onResolveComment,hideResolve:e.hideResolve,copyLink:e.copyLink,onDeleteThread:e.onDeleteThread,hidePageName:e.hidePageName,hideOrphanedState:e.hideOrphanedState})),g.e0.COMMENTS_TOOL,{currentTool:t})}let tS=e=>e.stopPropagation(),tM=[e6.hJ.COMMENTS_ONLY,e6.hJ.POSTS_ONLY];function tN(e){let t=(0,o.wA)(),{activeQuery:n,activeSort:d,activeMode:u,activeFilters:h,filteredSidebarItems:f,threadManager:g}=a.useContext(C.hh),y=(0,E.Qj)(),w=(0,E.Yo)(),x=(0,E.lM)(),k=a.useMemo(()=>e.sorts&&Array.from(e.sorts)||y,[e.sorts,y]),I=a.useMemo(()=>e.filters&&Array.from(e.filters)||w,[e.filters,w]),T=a.useMemo(()=>(0,m.y)()&&!x?tM:void 0,[x]),P=a.useMemo(()=>"loaded"===f.status&&f.data||[],[f]),S=a.useRef(P);a.useEffect(()=>{S.current=P},[P,S]);let M=a.useCallback((e,n)=>{let a=S.current.find(t=>t.id===e);a&&t(c.hx({thread:a,resolved:n}))},[S,t]),N=a.useRef(null),D=(0,_.o3)(_.nt.commentsA11y),A=e.isShown??!0;a.useEffect(()=>{if(!A)return;let e=null;if(D){let t=document.querySelector('[data-testid="comments-clustered-pins-focus-anchor"]');t instanceof HTMLElement&&(e=t)}else e=N.current;if(!e)return;let t=()=>(e?.focus(),document.activeElement===e);requestAnimationFrame(()=>{t()||setTimeout(t,100)})},[D,A]);let{disableSidebar:L}=(0,v.Z5)(),R=a.useCallback(()=>{(0,v.uw)({disableSidebar:!1})},[]),O=(0,b.v)(),B=e.copyLinkOverride??O,F=(0,r.U1)(N);return L?a.createElement("div",{className:l.s.flex.flexColumn.justifyStart.alignCenter.m8.mt18.$},(0,s.tx)("comments.you_have_disabled_the_comments_sidebar_via_the_debug_menu"),a.createElement("div",{className:l.s.flex.flexRow.justifyCenter.alignCenter.$},a.createElement("button",{className:l.s.p10.w100.m8.$,style:{backgroundColor:"green",color:"white"},onClick:R},(0,s.tx)("comments.re_enable")))):a.createElement("div",{className:"comments_sidebar--container--g86FO","data-comments-sidebar":!0,onKeyDown:e=>{p.Y5.isReady()&&"Escape"===e.key&&p.Y5.triggerAction("set-tool-default"),tS(e)},onMouseDown:tS,ref:F,tabIndex:-1,"aria-label":(0,s.t)("fullscreen.accessibility.comments_sidebar"),"data-fullscreen-intercept":!0},a.createElement(tx,{activeFilters:h,activeMode:u,activeQuery:n,activeSort:d,filters:I,hideSettingsDropdown:e.hideSettingsDropdown,modes:T,onCloseButton:e.onCloseButton,sorts:k,stackHeader:e.stackHeader,threadManager:g}),a.createElement(i.x,{className:"comments_sidebar--loading--7fXvY",isLoading:"loading"===f.status},()=>a.createElement(tP,{hidePageName:e.hidePageName,hideOrphanedState:e.hideOrphanedState,onResolveComment:M,copyLink:B,onDeleteThread:e.onDeleteThread,emptyState:e.emptyState,hideResolve:e.hideResolve,loadedSidebarItems:P})))}},746606:(e,t,n)=>{n.d(t,{$2:()=>n4,To:()=>n1,$I:()=>n0});var a=n(848318),o=n(301168),r=n(938982),i=n(19180),l=n(382902),s=n(996202),c=n(454805),d=n(146968),m=n(66699),u=n(677972),p=n(847461),h=n(244534),f=n(431698),_=n(412865),g=n(355755),v=n(665411),E=n(7148),b=n(953985),y=n(730143),C=n(274468),w=n(125761),x=n(870419),k=n(314774),I=n(302982),T=n(837988),P=n(819013),S=n(563741),M=n(306152),N=n(186606),D=n(277930),A=n(453370),L=n(142896),R=n(330362),O=n(601167),B=n(554326),F=n(824069),U=n(134642),V=n(167546),H=n(358857),q=n(276595),z=n(664250),$=n(403506),K=n(891627),W=n(536384),Z=n.n(W),G=n(865114),j=n(615233),X=n(73823),Q=n.n(X);class Y{constructor(e,t,n,a){if(e.pins.length>1&&(this.showClusterCount=!0),!n)return;let o=en(e,n);if(!o){a||1!==e.pins.length||e.pins[0].isOurs||(this.expandPin=!0);return}let r=o.pins.length>1&&e.pins.length>1?et(o,t):ee(o,t);this.initialPosition=r}}class J{constructor(e,t,n){let a=n.pins.length>1&&e.pins.length>1?et(n,t):ee(n,t);this.finalPosition=a}}let ee=(e,t)=>({x:e.x+e.x*(t-1),y:e.y+e.y*(t-1)}),et=(e,t)=>({x:e.x+e.x*(t-1)-32,y:e.y+e.y*(t-1)-32}),en=(e,t)=>{if(1===e.pins.length)return t.getParentOf(e.id);let n=t.getParentOf(e.pins[0].id)||null,a=n?new Set(n.pins.map(e=>e.id)):new Set;return e.pins.every(e=>a.has(e.id))||(n=null),n};var ea=n(92019),eo=n(282058),er=n(125952),ei=n(541731),el=n(992430),es=n(428481),ec=n(540111);let ed=el.ay-1,em=a.memo(function({avatar:e,isInCluster:t,isGhost:n,initiallyHidden:o}){let{src:r,fallbackStyle:i}=(0,a.useMemo)(()=>{let t=(0,er.Sw)(e.avatar_url);if(t)return{src:t};let n=(0,ei.$L)(e.avatar_user_id,ei.us),a=(0,ei.Xx)(n);return{src:t,fallbackStyle:{backgroundColor:n,color:a}}},[e.avatar_url,e.avatar_user_id]),l=e.avatar_user_handle[0];return a.createElement("div",{className:Z()(ec.H,{[es.my]:t,[es.v2]:n,[ec.K_]:t})},r?a.createElement("img",{src:r,className:Z()(ec.my,!1===o?ec.el:null),draggable:!1,alt:l}):a.createElement("span",{className:Z()(ec.e7,!1===o?ec.el:null),style:i},l))}),eu=a.memo(function({avatars:e,initiallyHidden:t}){let n=e.slice(0,ed),o=e.slice(ed+1),r=e[ed];return a.createElement("div",{className:ec.dQ},a.createElement("div",{className:ec.u_},o.length?a.createElement("div",{className:ec.Ws},o.reverse().map(e=>a.createElement(em,{key:e.avatar_user_id,avatar:e,initiallyHidden:t}))):null,r?a.createElement("div",{className:ec.OF},a.createElement(em,{avatar:r,initiallyHidden:t})):null,n.length?a.createElement("div",{className:ec.q_},n.reverse().map(e=>a.createElement(em,{key:e.avatar_user_id,avatar:e,initiallyHidden:t}))):null))});function ep(e,t,n,a=!1){if(!t||!(0,ea.x)())return Promise.resolve();let o=`translate3d(${t.x}px, ${t.y}px, 0px) scale(0.2)`;return new Promise((t,r)=>{let i=e.animate([{offset:n,transform:o}],{duration:200});i.onfinish=()=>{a&&(e.style.opacity="0"),t()},i.oncancel=()=>{r()}})}let eh=a.memo(function({cluster:e,selectedState:t,zoomScale:n,animationInfo:o}){let r=(0,a.useMemo)(()=>[...e.avatarMap.values()].sort((e,t)=>e.num_unread_comments>0&&t.num_unread_comments>0?e.num_comments>t.num_comments?-1:1:e.num_unread_comments>0?-1:t.num_unread_comments>0?1:e.num_comments>t.num_comments?-1:1).slice(0,5),[e.avatarMap]),i=1===r.length?r[0]:void 0,l=function(e,t){let n=(t-1)*e.x-32,a=(t-1)*e.y-32;return{x:e.x+n,y:e.y+a}}(e,n),s=(0,a.useRef)(null),c=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(s.current){if(o instanceof Y){let{initialPosition:t,showClusterCount:n}=o;if(s.current.style.opacity="1.0",n&&c.current){var e;(e=c.current)?(e.style.transition="none",e.style.opacity="1",(0,eo.G)(e,[],{duration:1e3}).then(()=>{e.style.removeProperty("opacity"),e.style.removeProperty("transition")})):Promise.resolve()}t&&ep(s.current,t,0,!1)}else if(o instanceof J){let{finalPosition:e}=o;ep(s.current,e,1,!0)}}},[o]),a.createElement("div",{ref:s,"data-testid":"figma-comment-cluster",role:"button",tabIndex:0,className:Z()(es.Di,{[es.gy]:e.isUnread,[es.rX]:t===V.LX.DIMMED}),style:{willChange:"transform",transform:`translate3d(${l.x}px, ${l.y}px, 0px) scale(var(--scale))`,opacity:o instanceof Y?0:1,zIndex:o instanceof J?-1:0},onClick:e.onClick},a.createElement("div",{className:es.IS,"data-testid":"avatar-cluster"},a.createElement("div",{className:es.u_},i?a.createElement(em,{avatar:i,isInCluster:!0,isGhost:!0}):null,r.map(e=>a.createElement(em,{key:e.avatar_user_id,avatar:e,isInCluster:!0}))),a.createElement("div",{ref:c,className:es.A3,"display-thread-count":e.pins.length})))});var ef=n(197638),e_=n.n(ef),eg=n(315933),ev=n(484169),eE=n(781239),eb=n(173926),ey=n(967688),eC=n(303397);let ew=a.memo(function({absoluteBounds:e}){let{width:t,height:n,x:o,y:r}=e;return a.createElement("div",{className:"selection_box--selectionBox--FNRhk","data-testid":"figma-comment-selection-box",style:{width:t,height:n,left:o,top:r}})}),ex=e=>e.ctrlKey||e.altKey||e.shiftKey||e.metaKey;function ek(e,t){let n=(t-1)*e.x,a=(t-1)*e.y;return{x:e.x+n,y:e.y+a}}function eI(e,t,n,a=!1){if(!t||!(0,ea.x)())return Promise.resolve();let o=`translate3d(${t.x}px, ${t.y}px, 0px) scale(0.2)`;return new Promise((t,r)=>{let i=e.animate([{offset:n,transform:o}],{duration:200});i.onfinish=()=>{a&&(e.style.opacity="0"),t()},i.oncancel=()=>{r()}})}let eT=a.memo(function({pin:e}){let t=(0,a.useMemo)(()=>e_().sanitize((0,ev.sP)(e.previewMessageMeta),{ALLOWED_TAGS:["img","span"],ALLOWED_ATTR:["src","class"],ALLOWED_URI_REGEXP:new RegExp((0,j.CZ)("emoji/*"))}),[e.previewMessageMeta]),n=(0,a.useMemo)(()=>{let t=e.avatars.reduce((e,t)=>e+t.num_comments,0)-1,n=e.numAttachments,a=!!e.numUnreadReplies&&e.numUnreadReplies!==t,o=t?(0,ey.t)("comments.preview_reply_count",{replyCount:a?e.numUnreadReplies:t,new:a?"true":"false"}):"",r=n?(0,ey.t)("comments.attachment_count",{attachmentCount:n}):"",i="";return""!==o?i=""!==r?`${o} \xb7 ${r}`:o:""!==r&&(i=r),i},[e.avatars,e.numUnreadReplies,e.numAttachments]),o=(0,a.useMemo)(()=>(0,eb.JD)(e.createdAt,"short"),[e.createdAt]);return a.createElement("div",{className:ec.$N},a.createElement("div",{className:ec.Ud},a.createElement("div",{className:ec.T7,dir:"auto"},e.avatars[0].avatar_user_handle),a.createElement("div",{className:ec.Zr},o)),a.createElement("div",{className:ec.se,dir:"auto"},t),a.createElement("span",{className:ec.V_},n))});function eP(){return a.createElement("div",{className:ec.S})}let eS=a.memo(function({pin:e}){let{selectionBoxAnchor:t}=e,n=(0,O.Pl)({subscribeToUpdates_expensive:!!t});if(!t)return null;let o=ek(e,n),r=function(e,t,n){let a=ek(n,t),o=Math.min(e.x,a.x),r=Math.min(e.y,a.y);return{width:Math.max(e.x-o,a.x-o),height:Math.max(e.y-r,a.y-r),x:o,y:r}}(o,n,t);if(!r)return null;let i={x:r.x-o.x,y:r.y-o.y,width:r.width,height:r.height};return a.createElement(ew,{absoluteBounds:i})}),eM=a.memo(function({pin:e,selectedState:t,onPinClicked:n,onDragEnd:o,onDragUpdate:r,onDragStart:i,onContextMenu:l,animationInfo:s,recordingKey:d,avatarInitiallyHidden:m}){let u=(0,a.useRef)(null),[p,h]=(0,a.useState)(!1),[f,_]=(0,a.useState)(!1),g=eE.rf(d,"click",a.useCallback(()=>{eg.sn.start("view_comment_thread"),n(e.id)},[n,e.id])),{onPointerDown:v,dragOffset:E}=function({ref:e,canDrag:t,onDragStart:n,onDragEnd:o,onDragUpdate:r,onClick:i}){let[l,s]=(0,a.useState)("idle"),[d,m]=(0,a.useState)(!1),[u,p]=(0,a.useState)(null),[h,f]=(0,a.useState)({x:0,y:0}),_=(0,a.useCallback)(t=>{0!==t.button||ex(t)||"idle"!==l||(e.current?.setPointerCapture(t.pointerId),t.stopPropagation(),p({x:t.clientX,y:t.clientY}),s("ready"),m(!1))},[l,e]),g=(0,a.useCallback)(e=>{if(m(!0),"idle"===l||!u||!t)return;let a={x:e.clientX,y:e.clientY},o=c.Mi.subtract(u,a);f(o),"ready"===l?(s("dragging"),n(o)):r(o)},[l,n,r,u,t]),v=(0,a.useCallback)(t=>{"dragging"===l?(e.current?.releasePointerCapture(t.pointerId),t.stopPropagation(),o(h),f({x:0,y:0})):d||i(),s("idle")},[e,l,h,o,i,d]);return(0,a.useEffect)(()=>("idle"!==l&&(document.addEventListener("pointermove",g),document.addEventListener("pointerup",v)),()=>{document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",v)}),[g,v,l]),(0,a.useMemo)(()=>({onPointerDown:_,dragOffset:h}),[_,h])}((0,a.useMemo)(()=>({ref:u,canDrag:e.isDraggable,onDragStart:t=>i({id:e.id,offset:t}),onDragEnd:t=>{o({id:e.id,offset:t})},onDragUpdate:t=>r({id:e.id,offset:t}),onClick:g}),[e,i,o,r,g]));(0,a.useEffect)(()=>{let t;return e.pending?t=setTimeout(()=>{_(!0)},500):_(!1),()=>{t&&clearTimeout(t)}},[e.pending]),(0,a.useEffect)(()=>{if(u.current){if(s instanceof Y){let{initialPosition:t,expandPin:n}=s;if(t)u.current.style.opacity="1.0",eI(u.current,t,0,!1);else if(n){var e;h(!0),((e=u.current)?(requestAnimationFrame(()=>{e.style.setProperty("--expandAnimationTime","0.4s"),e.classList.add(ec.sz)}),(0,eo.G)(e,[],{duration:400,endDelay:3500}).then(()=>{e.classList.remove(ec.sz),e.style.removeProperty("--expandAnimationTime")})):Promise.resolve()).then(()=>{h(!1)})}}else if(s instanceof J){let{finalPosition:e}=s;eI(u.current,e,1,!0)}}},[s]);let b=eE.BV(d,"pointerover",()=>{h(!0)});return a.createElement(a.Fragment,null,a.createElement("div",{"data-testid":`figma-comment-pin-${e.id}`,role:"button",tabIndex:0,className:Z()(ec.ij,ec.C_,{[ec.wH]:t===V.LX.ACTIVE,[ec.rX]:t===V.LX.DIMMED,[ec.Fm]:e.pending||t===V.LX.ACTIVE,[ec.gy]:e.isUnread}),style:{opacity:s instanceof Y&&s.initialPosition?0:1,zIndex:s instanceof J?-1:void 0,transform:0!==E.x||0!==E.y?`translate3d(${-E.x}px, ${-E.y}px, 0px)`:void 0},onPointerDown:v,onContextMenu:t=>l(e.id,{x:e.x,y:e.y,width:23*Math.min(e.avatars.length,2)+32,height:-32},t.nativeEvent),onPointerOver:b,onPointerOut:()=>{h(!1)}},a.createElement("div",{className:Z()(ec.kW,{[ec.tu]:e.avatars.length>1})},f?a.createElement(eP,null):a.createElement(eu,{avatars:e.avatars,initiallyHidden:m}),p&&a.createElement(eT,{pin:e}))),e.selectionBoxAnchor&&p&&a.createElement(eS,{pin:e}))}),eN=a.memo(function({x:e,y:t,children:n}){let o=(0,a.useRef)(null),r=a.useContext(k.kw),i=a.useCallback(function(n){let a=o.current;if(a){let o=ek({x:e,y:t},n.zoomScale);a.style.transform=`translate3d(${o.x}px, ${o.y}px, 0px)`}},[e,t]);return(0,a.useLayoutEffect)(()=>(i(r.getViewportInfo()),eC.Y5&&eC.Y5.viewport.on("onSetViewport",i),()=>{eC.Y5&&eC.Y5.viewport.removeListener("onSetViewport",i)}),[i,r]),a.createElement("div",{style:{willChange:"transform"},ref:o},n)}),eD=a.memo(function({pin:e,selectedState:t,onPinClicked:n,onDragEnd:o,onDragUpdate:r,onDragStart:i,onContextMenu:l,animationInfo:s,recordingKey:c,avatarInitiallyHidden:d}){return a.createElement(eN,{x:e.x,y:e.y},a.createElement(eM,{animationInfo:s,avatarInitiallyHidden:d,onContextMenu:l,onDragEnd:o,onDragStart:i,onDragUpdate:r,onPinClicked:n,pin:e,recordingKey:c,selectedState:t}))});function eA(e){let{children:t}=e,n=(0,a.useRef)(null),[o,r]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(n.current){let e=n.current.attachShadow({mode:"open"}),t=document.createElement("style");t.nonce=(0,j.Ay)().csp_nonce,t.textContent=["@layer css-modules {\n/** @postcss-export-raw */\n.selection_box--selectionBox--FNRhk {\n  position: absolute;\n  box-sizing: border-box;\n  border: dashed 2px var(--color-border-selected);\n  pointer-events: none;\n}\n}","@layer css-modules {\n/** @postcss-export-raw */\n}",es.Nz,ec.Nz].join("\n"),e.append(t),r(e)}},[]),a.createElement("div",{ref:n,"data-testid":"pin-renderer-shadow-dom-container"},o&&(0,K.createPortal)(t,o))}function eL({selectedPinId:e,dimUnselectedPins:t,emphasizedPinIds:n,clusteredThreads:o,clientConfig:r,shouldDisablePointerEvents:i,haveCommentsToShow:l,onPinClicked:s,onDragEnd:d,onDragUpdate:m,onDragStart:u,onContextMenu:p,disableFilteringPinsOnViewportChanges:h}){let f=(0,a.useContext)(k.kw),_=(0,O._X)({subscribeToUpdates_expensive:l}),g=(0,a.useMemo)(()=>f.getCommentsWrapperOffset(_),[f,_]),[v,E]=(0,a.useState)(_);_===v||h||E(_);let b=(0,G.ZC)(o),y=(0,a.useMemo)(()=>(function(e,t){let n=e.all();if(!t||0===t.all().length)return n.map(n=>n.pins.length>1?{cluster:n,animationInfo:new Y(n,e.zoomScale,t,e.applyInstant)}:{cluster:n,animationInfo:{}});let a=n.reduce((e,t)=>(e.set(t.id,t),e),new Map),o=t.all(),r=o.reduce((e,t)=>(e.set(t.id,t),e),new Map),i=n.map(n=>{let a=r.get(n.id);return a?((0,V.xN)(n,a),{cluster:n,animationInfo:{}}):{cluster:n,animationInfo:new Y(n,e.zoomScale,t,e.applyInstant)}}),l=o.filter(e=>!a.has(e.id)),s=Q()(l,t=>{let n=en(t,e);return n?[{cluster:t,animationInfo:new J(t,e.zoomScale,n)}]:[]});return s.length>100?i:s.concat(i)})(o,b),[o,b]),C=(0,a.useMemo)(()=>{let e=function(e,t){let n=(0,O.qc)(t),a=(0,O.kE)(78,t.zoomScale),o=(0,c.UI)(n,a);return e.filter(({cluster:e})=>!(e.x<o.x)&&!(e.x>o.x+o.width)&&!(e.y<o.y)&&!(e.y>o.y+o.height))}(y,v);return e.sort((e,t)=>e.cluster.id<t.cluster.id?-1:1),e},[y,v]),w=(0-_.offsetX)*_.zoomScale+g.x,x=(0-_.offsetY)*_.zoomScale+g.y,I={top:`${_.y+_.height/2}px`,left:`${_.x+_.width/2}px`,transform:`translate(${w}px, ${x}px)`};return a.createElement("div",{className:Z()({"pin_renderer--overlay--oZ6wJ":!0,"pin_renderer--overlayPassthrough--IK1LV":_.isPanning||_.isZooming||i}),style:I,"data-testid":"clustered-comments-wrapper","aria-hidden":"true"},a.createElement(eA,null,a.createElement(a.Fragment,null,C.map(({cluster:n,animationInfo:o})=>{let r;return r=e?n.pins.find(t=>t.id===e)?V.LX.ACTIVE:V.LX.DIMMED:n.pins.every(e=>e.isResolved)?V.LX.DIMMED:t?V.LX.DIMMED:V.LX.NORMAL,a.createElement(a.Fragment,{key:n.id},1===n.pins.length?a.createElement(eD,{pin:n.pins[0],recordingKey:`commentPin.${n.pins[0].id}`,selectedState:r,onPinClicked:s,onDragEnd:d,onDragUpdate:m,onDragStart:u,onContextMenu:p,animationInfo:o}):a.createElement(eh,{cluster:n,selectedState:r,zoomScale:_.zoomScale,animationInfo:o}))}))))}var eR=(e=>(e[e.Gradual=0]="Gradual",e[e.Jump=1]="Jump",e))(eR||{});let eO=[N.NLJ.COMMENTS,N.NLJ.SELECT,N.NLJ.SCALE,N.NLJ.HAND,N.NLJ.TYPE],eB=(e,t,n,a)=>{let{threads:o}=e,r=o.map(e=>n(e)),i=o.map(e=>{let t=e.comments[0].client_meta;return t?.in_frame?t.node_id:void 0}),l=new Map;for(let e of r)for(let t of e.avatars)l.has(t.avatar_user_id)?(l.get(t.avatar_user_id).num_unread_comments+=t.num_unread_comments,l.get(t.avatar_user_id).num_comments+=t.num_comments):l.set(t.avatar_user_id,t);return{id:1===o.length?o[0].id:(0,V.Ao)(e,o.length),x:e.x,y:e.y,pins:r,isUnread:r.some(e=>e.isUnread),avatarMap:l,onClick:a(e,r),anchoredNode:i.every(e=>e===i[0])?i[0]:void 0,isPinnedToFile:r.some(e=>e.isPinnedToFile),isSinglePin:1===o.length,cluster:e,onKeyDown:()=>{}}};function eF(e){return{width:23*Math.min(e-1,2)+32,height:32}}let eU=a.memo(function(e){let t=!!e.activeThread||e.threads.length>0,n=(0,w.iZ)(),r=(0,S.s)(),i=(0,U.Z5)(),d=(0,o.wA)(),m=a.useContext(k.kw),u=(0,o.d4)(e=>e.mirror.appModel.currentTool),h=(0,B.ut)(N.Ez5?.editorState().handToolTemporarilyEnabled,!1),f=(0,l.md)(z.R),_=(0,E.BI)(),g=(0,o.d4)(e=>![N.m1T.DESIGN_LAYOUT,N.m1T.WHITEBOARD_LAYOUT,N.m1T.HISTORY,N.m1T.PREVIEW,N.m1T.COMMENTS,N.m1T.DEV_HANDOFF,N.m1T.SITES_LAYOUT].includes(e.mirror.appModel.activeCanvasEditModeType)||e.mirror.appModel.activeUserAction!==N.QOV.DEFAULT)&&(!_||_?.shouldOptimizeForIpadApp&&_?.shouldFadeCommentsDuringEdit),v=e.activeThread?.id===I.hm,b=v?null:e.activeThread?.id||null,y=(0,o.d4)(e=>e.comments.emphasizedPinIds),{zoomScale:C,deltaOffsetX:x,deltaOffsetY:T,deltaZoomScale:M}=(0,O.PD)({subscribeToUpdates_expensive:t}),{requestToDeselectCommentPin:K}=e,[W,Z]=a.useState({viewport:m.getViewportInfo(),hasJumped:!1}),G=C<W.viewport.zoomScale,j=a.useRef(e.threads);a.useEffect(()=>{j.current=e.threads},[e.threads]);let X=a.useCallback(e=>j.current?.find(t=>t.id===e)||null,[j]),Q=(0,o.d4)(e=>e.mirror.appModel.activeUserAction),Y=e.dragDisabledOverride||!eO.includes(u),J=(0,H.B)(X,e.pageId,e.setClientMeta,Y,e.requestToSelectCommentPin,f),ee=(0,H.x)(Y),et=a.useMemo(()=>new Set(e.threads.filter(e=>ee(e)).map(e=>e.id)),[ee,e.threads]),en=a.useCallback(e=>{d(p.wg({threadId:e}));let t=X(e);t&&m.setHovering(t.canvasPosition)},[m,d,X]),ea=a.useCallback(e=>{d(p.RP({threadId:e})),m.setHovering(null)},[m,d]),eo=(0,s.am)(),er=a.useCallback((e,t)=>()=>{eo("Comment Cluster Clicked",{clusterSize:t.length,commentThreadIds:t.map(e=>e.id)});let n=(0,P.xw)({config:i,clusterLocation:e,pins:t,currentViewport:m.getViewportInfo()});m.navigateTo(e,n),K&&K()},[i,m,eo,K]),ei=a.useCallback((e,t,n)=>{n.preventDefault(),n.stopPropagation();let a=X(e);if(!a)return;let o=m.getViewportInfo(),r=(0,O.Z0)(o,t),i={x:r.x+t.height/2,y:r.y-t.width/2,height:0,width:0},l=(0,O.HD)(i,o);d(A.j7({type:L.Z7,data:{thread:a,pinClientRect:l}}))},[d,m,X]),el=a.useCallback(e=>{let t=(0,V.c4)(e.comments),a=e.comments.slice(1).reduce((e,t)=>t.isUnread?e+1:e,0),o=e.comments[0].client_meta?.selection_box_anchor;if(o&&e.comments[0].client_meta?.in_frame){let t=e.comments[0].client_meta,n=c.Mi.subtract(o,t);o=c.Mi.add(e.canvasPosition,n)}let r=!!e.isPendingFromSinatra;return{id:e.id,x:e.canvasPosition.x,y:e.canvasPosition.y,isOurs:e.comments[0].user_id===n?.id,pending:r,avatars:t,createdAt:new Date(Date.parse(e.comments[0].created_at)),onMouseEnter:()=>en(e.id),onMouseLeave:()=>ea(e.id),previewMessageMeta:e.comments[0].message_meta,isUnread:e.comments[0].isUnread||a>0,numUnreadReplies:a,isDraggable:et.has(e.id)&&!r,isResolved:!!e.comments[0].resolved_at,label:e.comments[0].order_id||"",updatedAt:e.comments[e.comments.length-1].created_at,selectionBoxAnchor:o,type:I.kT.COMMENT_THREAD,numAttachments:e.comments.map(e=>e.attachments?.length||0).reduce((e,t)=>e+t,0),isPinnedToFile:!!e.commentPin}},[n,et,en,ea]),es=a.useMemo(()=>e.threads.reduce((e,t)=>{let{canvasPosition:n}=t;return n&&e.push({...t,canvasPosition:n}),e},[]),[e.threads]),ec=a.useCallback(e=>{Z({viewport:m.getViewportInfo(),hasJumped:1===e})},[m]),ed=(0,D.A)(ec,i.rebuildClustersZoomDelay),em=a.useMemo(()=>{let e=new Set(es.map(e=>e.id)),t=W.viewport,n=(0,$.g)(es,t,i).map(e=>eB(e,t,el,er)),a=new F.n(n,e,t.zoomScale);return a.applyInstant=W.hasJumped,a},[es,W.viewport,W.hasJumped,i,el,er]);a.useEffect(()=>{if(C===W.viewport.zoomScale)return;let{width:e,height:t}=m.getViewportInfo();Math.abs(M)/C>.45||Math.abs(x)/e>.95||Math.abs(T)/t>.95?ec(1):ed(0)},[m,M,x,T,i.rebuildClustersZoomDelay,W.viewport,C,ed,ec]);let eu=!!e.activeThread,ep=e.activeThread?(0,V.c4)(e.activeThread.comments).length:1,{setActivePinSize:eh}=e;a.useEffect(()=>{if(!eu){eh(null);return}if(v){let e=eF(1);eh({height:e.height,width:e.width});return}eh({width:eF(ep).width,height:0})},[eh,eu,v,ep]);let ef=(0,R.k)();return a.createElement(q.p,null,a.createElement(eL,{clientConfig:r,clusteredThreads:em,dimUnselectedPins:!!g,disableFilteringPinsOnViewportChanges:G,emphasizedPinIds:y,haveCommentsToShow:t,onContextMenu:ei,onDragEnd:J.onDragEnd,onDragStart:J.onDragStart,onDragUpdate:J.onDragUpdate,onPinClicked:J.onPinClicked,selectedPinId:b,shouldDisablePointerEvents:!ef&&r?.disableCommentsWhenHandToolEnabled&&u===N.NLJ.HAND||h||void 0!==Q&&Q!==N.QOV.DEFAULT}))}),eV=a.memo(function(e){return a.createElement(eU,{key:e.pageId,activeThread:e.activeThread,dragDisabledOverride:e.dragDisabledOverride,isCommunity:e.isCommunity,pageId:e.pageId,requestToDeselectCommentPin:e.requestToDeselectCommentPin,requestToSelectCommentPin:e.requestToSelectCommentPin,setActivePinSize:e.setActivePinSize,setClientMeta:e.setClientMeta,threads:e.threads,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})});var eH=n(116147),eq=n(854673),ez=n(410725),e$=n(852314),eK=n(696786),eW=n(938237),eZ=n(70217),eG=n(209595),ej=n(543177),eX=n(55116),eQ=n(660376),eY=n(376852),eJ=n(143823),e0=n(989232),e1=n(410441),e2=n(63163),e3=n(182317),e4=n(755534),e5=n(339542),e6=n(913026),e8=n(361323),e7=n(959750),e9=n(17753),te=n(645445),tt=n(937582),tn=n(835486),ta=n(559836),to=n(923164),tr=n(767950),ti=n(691063),tl=n(24422),ts=n(16808),tc=n(175393),td=n(398612),tm=n(380592);function tu(e){let{editorRef:t,container:n,initialLocation:o,closeEditor:r}=e,[i,l]=a.useState(null),s=a.useCallback(e=>{l(e.target.value.trim())},[]),d=a.useCallback(()=>(r(),!0),[r]);(0,eZ.O1)(d,eZ.KD.LINK_TOOLTIP);let m=a.useCallback(e=>{"Enter"===e.key&&(e.preventDefault(),i?t.current?.onSubmitHyperlink(i):t.current?.onRemoveHyperlink(),t.current?.focus(),r())},[r,t,i]),u=a.useCallback(e=>{t.current?.onRemoveHyperlink(),t.current?.focus(),r(),e.stopPropagation()},[r,t]);a.useEffect(()=>{t.current&&l(t.current.getActiveHyperlinkForCurrentSelection())},[t]);let p=a.useMemo(()=>{if(n.current){let e=(0,td.E)(n.current.getBoundingClientRect()),t=o.left-e.left,a=o.top-e.top;return new c.Mi(t+o.width/2,a)}return null},[n,o.left,o.top,o.width]);return p&&null!==i?a.createElement(tm.c,{url:i,location:p,onInputChange:s,onInputKeyDown:m,onBlur:()=>{r()},onClickTrash:u}):null}var tp=n(837932),th=n(721014),tf=n(660037),t_=n(756672),tg=n(345964),tv=n(720522),tE=n(912873),tb=n(31898),ty=n(170954),tC=n(180294),tw=n(259964),tx=n(901176),tk=n(387594),tI=n(607699),tT=n(355739),tP=n(983894),tS=n(311139),tM=n(809651),tN=n(649567),tD=n(27776),tA=n(249555);let tL="feed_post_popover_modal--overlayIcon--SjGSf";var tR=n(452),tO=n(505e3);let tB=(0,e1.jz)(tD.qoo),tF=(0,e1.jz)(tD.u24),tU=(0,e1.jz)(tD.IuL);function tV(e){let t=(0,o.d4)(e=>e.comments.activeThread?.source),n=(0,o.d4)(e=>e.comments.activeThread?.id),r=(0,o.d4)(e=>e.comments.threads),i=n&&r[n]||null,l=i?.reply.messageMeta||[],s=(0,o.d4)(e=>e.comments.editingComment),c=(0,tC.sZ)(),{dispatch:d}=e,{threadPosition:m,comments:u}=e.feedPost,h=(0,f.GH)(),g=a.useMemo(()=>h&&"loaded"===h.status&&h.data&&h?.feedApi?.reactionsApi?h.feedApi.reactionsApi.getReactionsForPost(e.feedPost.feedPostPublicUuid):{postReactions:[],commentReactions:{}},[h,e.feedPost.feedPostPublicUuid]),[v,...E]=u,b=(0,o.d4)(e=>"fullscreen"===e.selectedView.view&&e.selectedView.editorType===tw.nT.Whiteboard),[y,C]=(0,to.R)(),{feedPost:w}=e,x=w.id,k=a.useCallback(e=>{d(p.k7({threadId:x,messageMeta:e}))},[d,x]),T=a.useCallback(e=>{d(p.QD({threadId:x,attachmentId:e.id,attachment:e}))},[d,x]),P=a.useCallback((e,t)=>{d(p.QD({threadId:x,attachmentId:e,attachment:null})),t?t.then(()=>tx.J.delete(e)):tx.J.delete(e)},[d,x]),S=a.useCallback(()=>{i&&(d(ty.gX({postUuid:(0,tI.gk)(x),messageMeta:i.reply.messageMeta,attachmentIds:i.reply.attachments?Object.keys(i.reply.attachments):[]})),C(),k([]),d(p.q4({threadId:x,resetStatusOnly:!1})))},[d,x,i,C,k]),M=a.useRef(null),N=a.useCallback(()=>{M.current?.scrollToBottom(),k([])},[M,k]);a.useEffect(()=>{x&&M.current?.scrollToBottom()},[x,M]);let[D,A]=a.useState(!1),L=(0,_.t$)(),R=a.useCallback(()=>{d((0,tb.to)({type:tT.K,data:{postUuid:w.feedPostPublicUuid,inFileView:!0}})),d(p.UU({force:!0}))},[d,w.feedPostPublicUuid]),O=a.useRef(null),B=a.useRef(null),F=e.viewportInfo.height-2*tF;b&&(F-=tU);let U=F-tB,V=!t&&!e.mountUnfocused,H=[...new Set(w.comments.map(e=>e.user.handle))];return c?a.createElement(e4.P,{ref:M,maxHeight:U,onMouseDown:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),width:L,scrollingDisabled:!!e.hyperlinkLocation,allowScrollAndZoomOver:!0,"data-not-draggable":!0},a.createElement("div",{className:tA.Q,role:"status","aria-live":"polite","aria-atomic":"true"},y),a.createElement("div",{className:"feed_post_popover_modal--postColumn--2MySW"},a.createElement(tS.B,{date:v.created_at,user:v.user,size:tE.Pf.MEDIUM,shortDate:!1}),a.createElement("div",{className:"feed_post_popover_modal--postThumbnailContainer--69nje",onMouseEnter:()=>A(!0),onMouseLeave:()=>A(!1),onClick:R,role:"button",tabIndex:0},a.createElement("img",{src:w.feedPostThumbnail,alt:"placeholder",className:"feed_post_popover_modal--postThumbnail--jac1E",style:{backgroundColor:w.feedPostThumbnailBackground,padding:w.padFeedPostThumbnail?"8px":"0"}}),w.feedPostNumContent>1&&a.createElement("div",{className:"feed_post_popover_modal--numContent--S8q68 feed_post_popover_modal--postThumbnailOverlay--vDoKP"},a.createElement(tv.B,{svg:tR.A,className:tL})),D&&a.createElement("div",{className:"feed_post_popover_modal--expand--cHMgw feed_post_popover_modal--postThumbnailOverlay--vDoKP"},a.createElement(tv.B,{svg:tO.A,className:tL}))),a.createElement("div",{className:"feed_post_popover_modal--subtitleRow--kW-8f"},a.createElement("div",{className:"feed_post_popover_modal--postedToFeed--mHMFC"},(0,ey.t)("fig_feed.posted_to_feed"))," "),a.createElement("div",null,a.createElement("div",{className:"feed_post_popover_modal--postTitle--4GzeH"},w.feedPostTitle),a.createElement(tk.HH,{messageMeta:v.message_meta,commentId:e.feedPost.id,className:"feed_post_popover_modal--postDescription--j6YqM"})),a.createElement("div",{className:"feed_post_popover_modal--reactionSection--cxj-W"},a.createElement(tM.Q$,{type:tM.Us.FULL,source:tM.zY.FILE_POPOVER,feedReactions:g.postReactions,postId:v.feed_id,postUuid:e.feedPost.feedPostPublicUuid}))),a.createElement("div",{className:"feed_post_popover_modal--postCommentlist--NUSo7"},E.map(t=>a.createElement(tP.i,{key:t.id,attachments:t.attachments,commentId:t.feed_id,commentUser:t.user,commentUuid:t.uuid||"",createdAt:t.created_at,currentOrgId:c.id,mentionables:e.mentionables,messageMeta:t.message_meta,reactions:t.uuid&&g.commentReactions[t.feed_id]||[],user:e.user}))),e.isLoading&&a.createElement("div",{className:tN.wG},a.createElement(tg.kt,{size:"small"})),a.createElement(ti.K,{allowAttachments:!0,attachments:i?.reply.attachments?Object.values(i.reply.attachments):[],authorNames:H,className:tN.MJ,deleteAttachment:P,dispatch:d,editingExistingComment:!1,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:O,editorType:"comment-editor-reply",fileKey:e.feedPost.key,hideEmojiPicker:e.hideEmojiPicker,hyperlinkLocation:e.hyperlinkLocation,isDisabled:!!s,isEmojiPickerDisabled:!!e.comments.editingComment,mentionables:e.mentionables,messageMeta:l,mountInputFocused:V,onCancel:e.onCloseEsc,onComposeFocus:e.onComposeFocus,onEditStart:N,onSubmit:S,placeholderText:(0,ey.t)("comments.reply"),recordingKey:I.Dw.feedPopover,replyContainerRef:B,setHyperlinkEditorRef:e.setHyperlinkEditorRef,setHyperlinkLocation:e.setHyperlinkLocation,setIsEditorFocused:e.setIsEditorFocused,submitText:(0,ey.t)("comments.reply"),threadId:x,threadPosition:m,typeahead:e.comments.typeahead,updateAttachment:T,updateMessage:k,user:e.user,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})):null}var tH=n(232167),tq=n(218742),tz=n(133318),t$=n(401970),tK=n(30575),tW=n(15105),tZ=n(658029),tG=n(210853),tj=n(952039),tX=n(533737),tQ=n(338056),tY=n(863270),tJ=n(539829),t0=n(887836),t1=n(796914),t2=n(404778);function t3(e){let t=(0,l.md)(t0.p9),n=(0,l.md)(y.yV),o=(0,tQ.kJ)();return(0,tK.yo)({user:t,file:n,numPinnedCommentThreads:o})?o>0?a.createElement(t5,{id:e.id,commentPin:e.commentPin,numPinnedCommentThreads:o}):a.createElement(t4,null,a.createElement(t5,{id:e.id,commentPin:e.commentPin,numPinnedCommentThreads:o})):null}function t4(e){return(0,tK.k3)()?e.children:null}function t5(e){let t=!(0,l.md)(tJ.wg),{pinApi:n}=(0,f.I_)(),r=(0,o.wA)(),i=!!e.commentPin,s=e.numPinnedCommentThreads>=10;async function c(){try{r(tX.b({has_toggled_comment_pin:!0})),i?await n?.removePin(e.id,e.commentPin.id):await n?.setPin(e.id)}catch(e){if(!e||e?.data?.status===422)return;e?.data?.i18n?r(tj.F.enqueue({message:(0,tG.J)(e,e.data.message),error:!0})):r(tj.F.enqueue({message:(0,ey.YD)("comments.pinning.err.fallback"),error:!0}))}}return a.createElement(tY.fu,{name:"Pin comment icon",properties:{isPinned:i}},a.createElement(tZ.K,{disabled:!i&&s||t,htmlAttributes:{"data-onboarding-key":i?"unpin-comment-icon":"pin-comment-icon","data-testId":"pin-comment-button-thread-header","data-tooltip-type":e9.Ib.TEXT,"data-tooltip":i?(0,ey.t)("comments.pinning.unpin_comment"):(0,ey.t)("comments.pinning.pin_comment")},"aria-label":(0,ey.t)("comments.pinning.pin_comment"),onClick:c,recordingKey:"threadHeader.pinCommentButton"},a.createElement(tv.B,{svg:i?t2.A:t1.A})))}var t6=n(464613),t8=n(728349),t7=n(265897),t9=n(325876),ne=n(214487);function nt(e){let t=a.useRef(null),n=a.useRef(null),r=(0,o.d4)(e=>e.comments.activeThread?.source),i=(0,o.wA)(),s=(0,eK.GS)(),c=(0,l.md)(z.R);a.useEffect(()=>{if(r&&!e.mountUnfocused)switch(r){case I.Eq.prevButton:t.current?.focus();break;case I.Eq.nextButton:n.current?.focus();break;case I.Eq.accessibilityCommentPin:break;default:(0,eQ.xb)(r)}},[e.mountUnfocused,r]);let d=(0,f.I_)(),m=(0,S.s)(),u=(0,tW.Z)("comments_navigate"),h=a.useContext(k.kw),_=(e,t)=>{e&&i(p.bB({receiptsAPI:d.commentReceipts,thread:e,viewport:h,source:t,skipDeactivatingExistingActiveComment:c,config:m,navigate:u}))},g=(0,tK.U6)()&&!!e.thread.commentPin;return a.createElement("div",{className:tN.F7,"data-testid":"thread-header-container"},a.createElement("div",{className:tN.xS,"data-onboarding-key":"thread-header-left-section","data-fullscreen-intercept":!0},s?a.createElement("h2",null,(0,ey.tx)("comments.comment_n")):a.createElement(a.Fragment,null,a.createElement(ts.K0,{ref:t,"aria-label":(0,ey.t)("fullscreen.accessibility.previous_comment"),className:Z()(tN.UR,!e.prevThread&&tN.VM),"data-fullscreen-intercept":!0,"data-tooltip":(0,ey.t)("comments.previous"),"data-tooltip-type":e9.Ib.TEXT,dataTestId:"threadModalLeft",disabled:!e.prevThread,onClick:()=>_(e.prevThread),onKeyDown:()=>_(e.prevThread,I.Eq.prevButton),onMouseDown:e=>e.stopPropagation(),svg:t7.A}),a.createElement(ts.K0,{ref:n,"aria-label":(0,ey.t)("fullscreen.accessibility.next_comment"),className:Z()(tN.UR,!e.nextThread&&tN.VM),"data-fullscreen-intercept":!0,"data-tooltip":(0,ey.t)("comments.next"),"data-tooltip-type":e9.Ib.TEXT,dataTestId:"threadModalRight",disabled:!e.nextThread,onClick:()=>_(e.nextThread),onKeyDown:()=>_(e.nextThread,I.Eq.nextButton),onMouseDown:e=>e.stopPropagation(),svg:t8.A}))),a.createElement("div",{className:tN.eX},e.thread.comments[0]&&a.createElement(t6.V,{comment:e.thread.comments[0],isUnread:e.thread.comments.some(e=>e.isUnread),label:(0,ey.t)("comments.thread_actions"),recordingKey:"threadHeader.moreActionsButton",thread:e.thread,possibleActions:e.overflowMenuActions,onDelete:e.onDelete}),a.createElement(t3,{id:e.thread.id,commentPin:e.thread.commentPin}),!e.hideResolve&&a.createElement(ts.K0,{disabled:g,"data-fullscreen-intercept":!0,"data-tooltip-type":e9.Ib.TEXT,"data-tooltip":e.resolved?g?(0,ey.t)("comments.pinning.cannot_unresolve"):(0,ey.t)("comments.mark_as_unresolved"):g?(0,ey.t)("comments.pinning.cannot_resolve"):(0,ey.t)("comments.mark_as_resolved"),onClick:()=>{e.setResolved({thread:e.thread,resolved:!e.resolved})},recordingKey:"threadHeader.resolveButton",onMouseDown:e=>e.stopPropagation(),className:Z()(e.resolved&&tN.aW,g&&tN.VM)},a.createElement(t$.U,{svg:e.resolved?ne.A:t9.A},e.resolved?a.createElement(tH.g,null):a.createElement(tq.W,null))),e.customIcon,a.createElement(tz.Jn,{className:tN.UR,recordingKey:"threadHeader",onClick:e.onClose,innerText:(0,ey.t)("comments.close"),"aria-label":(0,ey.t)("comments.close"),"data-fullscreen-intercept":!0})))}var nn=n(515640),na=n(249455);let no=(0,e1.hG)(tD.qoo),nr=(0,e1.hG)(tD.u24),ni=(0,e1.jz)(tD.M$q),nl=(0,e1.hG)(tD.PXB),ns=e=>{e.stopPropagation()},nc=[],nd=[],nm=a.memo(e=>{let t=a.useContext(k.kw),n=(0,o.d4)(e=>e.comments.threads)[e.threadId],r=n?.discardAttempts||0,[i,l]=a.useState(0),{positionRef:s,disableCentering:c}=e;a.useEffect(()=>{r<=0||(async()=>{let e=s.current,n=t.getViewportInfo();e&&!c&&await t.navigateTo(e,n.zoomScale,{duration:600,ignoreVisibleTargets:!0}),l(r)})()},[l,s,c,r,t]);let{editorRef:d,editingCommentEditorRef:m}=e,u=a.useCallback(()=>{if(m.current){m.current.selectAll();return}d.current?.selectAll()},[d,m]);return a.createElement(tl.c,{wiggleCount:i,onWiggle:u},e.children)});function nu(e){let t=(0,eG.z3)(),n=(0,o.d4)(e=>e.comments.activeThread?.source),r=(0,o.d4)(e=>e.comments.activeThread?.id),i=(0,o.d4)(e=>e.comments.threads),s=(0,e5.Kq)(e.thread),d=r&&i[r]||null,m=d?.discardAttempts||0,u=d?.reply.messageMeta||nc,h=d?.reply.attachments?Object.values(d?.reply.attachments):nd,f=(0,o.d4)(e=>e.comments.editingComment),[g,v]=a.useState(!1),E=(0,eK.GS)(),b=(0,l.md)(z.R),[y,C]=a.useState((0,_.t$)()),[w,x]=a.useState(no),k=function(e){let t=a.useRef(e);return a.useEffect(()=>{t.current=e},[t,e]),t}(e.thread.canvasPosition),T=a.useRef(null),P=E?ni:nl,{legalLeft:S,legalRight:M,legalBottom:D,useLegalBounds:A}=function(){let e=(0,t_.sO)(),t=(0,B.ut)(N.Ez5?.singleSlideView().isInFocusedNodeView,!1),n=(0,e7.dP)(),a=(0,e7.qw)(),o=(0,B.ut)(N.Ez5?.editorPreferences().speakerNotesHeight,0),r=N.Ez5?.singleSlideView().bottomToolbeltHeightInViewport()??0;return e&&t?{legalLeft:n+ni,legalRight:a+ni,legalBottom:o+r,useLegalBounds:!0}:{legalLeft:0,legalRight:0,legalBottom:0,useLegalBounds:!1}}(),L=a.useRef(!1),R=a.useCallback(n=>{let{x:a,y:o,width:r,height:i}=e.viewportInfo;if("fullscreen"===t&&!n.page)return new c.Mi(a,o);if(!n.threadPosition)return;if(e.useAbsolutePositioning)return new c.Mi(n.threadPosition.x,n.threadPosition.y);let l=n.threadPosition.x+a,s=n.threadPosition.y+o;if(A){let t=S+P,n=a+r-M-y-P;l=(0,eY.qE)(l,t,n);let c=T.current?T.current.getBoundingClientRect().height:w,d=e.viewportInfo.y+P,m=o+i-D-c-P;!L.current&&T.current&&(L.current=!0,V(null)),s=d>m?d:(0,eY.qE)(s,d,m)}return new c.Mi(l,s)},[t,e.viewportInfo,e.useAbsolutePositioning,A,S,M,D,y,w,P]),O=(0,tn.Rf)(),F=a.useMemo(()=>{let t=e.viewportInfo.x+P+O.xDelta,n=e.viewportInfo.y+P+O.yDelta;return new c.Mi(t,n)},[e.viewportInfo.x,e.viewportInfo.y,O.xDelta,O.yDelta,P]),[U,V]=a.useState(null),H=a.useMemo(()=>b?F:s?F:R(e.thread)||new c.Mi(0,0),[b,e.thread,s,F,R]),q=(0,G.ZC)(H);(0,a.useLayoutEffect)(()=>{if(U&&!b){let e=q?H.subtract(q):new c.Mi(0,0);e.equals(new c.Mi(0,0))||V(U.add(e))}},[H,U,q,b]);let $=(0,a.useMemo)(()=>U??H,[H,U]),{dispatch:K,setIsPinned:W}=e,{threadPosition:Z,comments:j}=e.thread;(0,e2.h)(()=>{let e=eg.sn.tryStop("view_comment_thread");e&&(0,e0.trackEvent)("view_comment_thread",{elapsedMs:e},{forwardToDatadog:!0})});let X=(0,e6.kc)(),Q=!E&&"fullscreen"===t,[Y,J]=a.useState(e.thread.comments.length),[ee,et]=a.useState(!1),en="communityHub"===t?X:e.user,[ea,eo]=(0,to.R)(),{submitReply:er,thread:ei}=e,el=ei.id,es=ei.uuid,ec=a.useCallback(()=>{let e=(0,e3.g)();eg.sn.start(`comment_reply_creation_${e}`),er({threadId:el,threadUuid:es??void 0,uuid:e}),eo()},[er,el,es,eo]);(0,e2.h)(()=>()=>{j.map(e=>{e.uuid&&e.isPendingFromSinatra&&eg.sn.tryStop(`comment_reply_creation_${e.uuid}`)})});let ed=a.useCallback(e=>{K(p.k7({threadId:el,messageMeta:e}))},[K,el]),em=a.useRef(null),eu=a.useRef(null),ep=a.useCallback(e=>{K(p.QD({threadId:el,attachmentId:e.id,attachment:e}))},[K,el]),eh=a.useCallback((t,n)=>{K(p.QD({threadId:el,attachmentId:t,attachment:null})),1===h.length&&em.current?.focus(),n?n.then(()=>tt.l.delete(e.thread.key,t)):tt.l.delete(e.thread.key,t)},[e.thread.key,K,el,h.length]),ef=a.useRef(null),e_=a.useCallback(()=>{ef.current?.scrollToBottom(),ed([])},[ef,ed]),{updateCommentContent:eE}=e,eb=a.useCallback((e,t,n)=>{eE({comment:e,messageMeta:t,attachmentUpdates:n})},[eE]),eC=a.useCallback(()=>{W(!1);let e=document.getElementById(`accessibility-comment-pin-${el}`);if(e?.focus(),!(0,ev.I)(u)){if(m&&em.current?.isAllSelected()||(0,ev.Kx)(u)&&0===h.length){ed([]),K(p.pD());return}return!1}},[W,el,u,m,h.length,ed,K]),ew=a.useCallback(()=>{W(!1),K(p.UU({force:!0}));let e=document.getElementById(`accessibility-comment-pin-${el}`);e?.focus()},[K,W,el]),ex=(0,o.d4)(e=>e.universalInsertModal?.pinned===te.t.PINNED_AND_DOCKED_LEFT),ek=(0,G.ZC)(F),eI=ek&&ek!==F,eT=ek&&$.equals(ek);a.useEffect(()=>{eI&&eT&&(W(!0),V(F))},[F,eI,eT,W]);let eP=$.equals(F),eS=(0,tn.sj)();a.useEffect(()=>{eS&&eP&&eS()},[eP,eS,K]),a.useEffect(()=>{el&&ef.current?.scrollToBottom()},[el,ef]);let[eM,eN]=a.useState(null),[eD,eA]=a.useState(a.useRef(null)),eL=a.useMemo(()=>function(e){return a.createElement(nm,{editorRef:em,editingCommentEditorRef:eu,positionRef:k,threadId:el,disableCentering:"communityHub"===t||"prototype"===t},e.children)},[el,k,em,t]),[eR,eO]=a.useState(!1),[eB,eF]=a.useState(!1),eU=a.useCallback(e=>{e?.stopPropagation(),W(!0),V(F),v(!0)},[W,F]),{modalRef:eV}=e;a.useEffect(()=>{eV&&(eV.current={popout:()=>eU()})},[eV,eU]),(0,e8.C_)(T),a.useEffect(()=>{if(n&&!e.mountUnfocused)switch(n){case I.Eq.accessibilityCommentPin:T.current?.focus();break;case I.Eq.prevButton:case I.Eq.nextButton:break;default:(0,eQ.xb)(n)}},[T,e.mountUnfocused,n]);let eH=a.useRef(null),eq=(0,tn.UR)(ta.b.DOCK_STYLE),ez=(0,tn.Y6)(),e$=(0,tn.eW)();return(()=>{if(!$||e.thread.isCanvasMention)return null;let t=(0,_.vl)(e.viewportInfo,e.thread,E,e$.paddingRight),o={x:F.x-y,y:0,width:2*y+P,height:window.innerHeight};ex&&(o.x-=y,o.width+=y);let r=a.createElement(ts.K0,{svg:na.A,"data-tooltip-type":e9.Ib.TEXT,"data-tooltip":(0,ey.t)("comments.dock_to_side"),recordingKey:"activeThread.dockToSideButton",onClick:eU,onMouseDown:e=>e.stopPropagation(),"data-fullscreen-intercept":!0}),i=e.viewportInfo.height-2*nr,l=window.innerHeight-e.viewportInfo.y-e.viewportInfo.height+nr,s=e.viewportInfo.x+nr,c=window.innerWidth-e.viewportInfo.x-e.viewportInfo.width+nr;i+=ez.maxHeightDelta,l+=ez.minBottomMarginDelta,s+=ez.minLeftMarginDelta,c+=ez.minRightMarginDelta;let d=i-no,m=e.useAbsolutePositioning?tN.wC:g?tN.xe:tN.wb,p=!n&&!e.mountUnfocused,b=[...new Set(ei.comments.map(e=>e.user.handle))];return a.createElement(a.Fragment,null,Q&&eR&&eB&&a.createElement("div",{className:eq??nn.k,style:{left:F.x,height:i}}),ee&&a.createElement(tf.ue,{registrationOrigin:tp.iX.COMMENT_REPLY}),a.createElement(tc.BL,{allowWheelPassthrough:!0,alwaysEnsureModalOnScreen:!0,autoflowHeight:!0,bounds:o,container:eL,containerClassName:m,dataOnboardingKey:th.ym,dataTestId:"comment-thread-draggable-modal",disableDragging:e.disableDragging,frameStyle:{boxShadow:"var(--elevation-400-menu-panel, 0px 2px 14px rgba(0, 0, 0, .15), 0 0 0 0.5px rgba(0, 0, 0, .2))",pointerEvents:"auto"},height:w,maxHeight:i,minBottomMargin:l,minLeftMargin:s,minRightMargin:c,minTopMargin:e.viewportInfo.y+nr,onClose:ew,onDragEnd:e=>{eF(!1),W(!0);let t=e.x<F.x,n=tc.rk.CALL_ENSURE_MODAL_ON_SCREEN;return Q&&(eR||t)?(V(F),v(!0),n=tc.rk.SKIP_ENSURE_MODAL_ON_SCREEN):V(e),n},onDragStart:()=>{eF(!0),v(!1)},onEnterBound:()=>eO(!0),onLeaveBound:()=>eO(!1),position:$,recordingKey:"activeThreadDraggableModal",setHeight:x,setPosition:V,setWidth:C,shouldScrollToBottom:()=>{let t=Y<e.thread.comments.length,n=e.thread.comments[e.thread.comments.length-1].user_id===e.user?.id,a=t&&n;return t&&J(e.thread.comments.length),a&&et(!0),a},width:y},eM&&eD&&a.createElement(tu,{editorRef:eD,container:T,initialLocation:eM,closeEditor:()=>{eN(null)}}),a.createElement("div",{ref:T,className:tN.OM,tabIndex:-1,"aria-label":(0,ey.t)("fullscreen.accessibility.comment_thread_label"),role:"region","data-fullscreen-intercept":!0},a.createElement(nt,{customIcon:!eP&&e.showDockToSideButton?r:void 0,hideResolve:e.hideResolve,mountUnfocused:e.mountUnfocused,nextThread:e.nextThread,onClose:ew,prevThread:e.prevThread,resolved:!!j[0].resolved_at,setResolved:e.setResolved,thread:t}),ei.sidebarItemType===I.kT.COMMENT_THREAD?a.createElement(e4.P,{ref:ef,maxHeight:d,onMouseDown:ns,onPointerDown:ns,width:y,scrollingDisabled:!!eM,allowScrollAndZoomOver:!0,"data-not-draggable":!0},a.createElement("div",{className:tA.Q,role:"status","aria-live":"polite","aria-atomic":"true"},ea),j.map((n,o)=>a.createElement(tr.I,{key:`thread-comment-${n.id}`,allowAttachments:!0,comment:n,dispatch:K,editingComment:e.comments.editingComment,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:eu,editorType:"comment-editor-thread",hideEmojiPicker:e.hideEmojiPicker,hideReactions:e.hideReactions,hideResolve:e.hideResolve,hyperlinkLocation:eM,index:o,mentionables:e.mentionables,mountInputFocused:!0,prevAuthor:0===o?null:j[o-1].user_id,setHyperlinkEditorRef:eA,setHyperlinkLocation:eN,setIsEditorFocused:e.setIsEditorFocused,setResolved:e.setResolved,showEditedIndicator:!!(e.showEditedIndicators&&n.edited_at),submitEdit:eb,thread:t,threadPosition:t.threadPosition,typeahead:e.comments.typeahead,user:e.user,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})),e.isLoading&&a.createElement("div",{className:tN.wG},a.createElement(eJ.k,{size:"sm"})),!e.commentCreationDisabled&&a.createElement(ti.K,{allowAttachments:!0,attachments:h,authorNames:b,className:tN.MJ,deleteAttachment:eh,dispatch:K,editingExistingComment:!1,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:em,editorType:"comment-editor-reply",fileKey:e.thread.key,hideEmojiPicker:e.hideEmojiPicker,hyperlinkLocation:eM,isDisabled:!!f,isEmojiPickerDisabled:!!e.comments.editingComment,mentionables:e.mentionables,messageMeta:u,mountInputFocused:p,onCancel:eC,onComposeFocus:e.onComposeFocus,onEditStart:e_,onSubmit:ec,placeholderText:(0,ey.t)("comments.reply"),recordingKey:I.Dw.reply,replyContainerRef:eH,setHyperlinkEditorRef:eA,setHyperlinkLocation:eN,setIsEditorFocused:e.setIsEditorFocused,submitText:(0,ey.t)("comments.reply"),threadId:el,threadPosition:Z,typeahead:e.comments.typeahead,updateAttachment:ep,updateMessage:ed,user:en,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})):ei.sidebarItemType===I.kT.FEED_POST?a.createElement(tV,{comments:e.comments,dispatch:K,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,feedPost:ei,hideEmojiPicker:e.hideEmojiPicker,hyperlinkLocation:eM,isLoading:e.isLoading,mentionables:e.mentionables,mountUnfocused:e.mountUnfocused,onCloseEsc:eC,onComposeFocus:e.onComposeFocus,setHyperlinkEditorRef:eA,setHyperlinkLocation:eN,setIsEditorFocused:e.setIsEditorFocused,showEditedIndicators:e.showEditedIndicators,user:e.user,viewportInfo:e.viewportInfo,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition}):ei.sidebarItemType===I.kT.LITMUS_COMMENT_THREAD?null:void(0,eQ.xb)(ei))))})()}var np=n(895531),nh=n(728075);function nf(e){return a.createElement("svg",{className:"anchor--anchorIcon--e1LTz",viewBox:"0 0 34 41",fill:"none","data-testid":"svg-comment-pin"},a.createElement("path",{fill:e.bodyColor,d:"M17 1C25.8366 1 33 8.16344 33 17C33 23.6257 27.6611 28.9662 17 39.6274C6.33887 28.9663 1.00001 23.6257 1 17C1 8.16344 8.16344 1 17 1Z"}),a.createElement("path",{fill:e.outlineColor,opacity:"0.4",d:"M17 40.3345L16.6261 39.9606C11.3156 34.6501 7.29362 30.6281 4.60457 27.1037C1.90336 23.5633 0.500006 20.4662 0.5 17C0.5 7.8873 7.8873 0.5 17 0.5C26.1127 0.5 33.5 7.8873 33.5 17C33.5 20.4662 32.0967 23.5633 29.3954 27.1037C26.7064 30.6281 22.6845 34.65 17.374 39.9605L17 40.3345ZM33 17C33 8.16344 25.8366 1 17 1C8.16344 1 1 8.16344 1 17C1.00001 23.552 6.22083 28.8474 16.6464 39.2738C16.7174 39.3447 16.7885 39.4159 16.8599 39.4873C16.9065 39.5339 16.9532 39.5806 17 39.6274C17.1185 39.5089 17.2364 39.391 17.3536 39.2738C27.7792 28.8474 33 23.552 33 17Z"}),e.isNew&&a.createElement("circle",{cx:"16.5",cy:"16.5",r:"2.25",fill:e.labelColor}))}let n_={x:0,y:0};function ng(e){let t=(0,o.d4)(e=>e.selectedView),n=(0,w.iZ)(),r=a.useContext(k.kw),i="communityHub"!==t.view||e.thread.comments[0]?.user_id===n?.id,l=(0,o.wA)(),[s,d]=a.useState(null),[m,u]=function(){let e=a.useRef(null),t=a.useCallback(t=>{if(null===t){e.current=null;return}let n=e.current||{};e.current={...n,...t}},[e]);return[e,t]}(),h=a.useRef(e);h.current=e;let{viewportPositionFromClientPosition:f,offset:g}=e,v=a.useCallback(e=>{let t=m.current;if(!t)return;let n=h.current,a=f(new c.Mi(e.clientX,e.clientY)),o=Math.max(t.maxDist,c.Mi.distance(a,t.startPosition));if(u({...t,maxDist:o}),o<_.wB)return;let r=n.computeDropLocation(a,t.mouseOffset);if(!n.isInViewport(r))return;let s=c.Mi.add(a,t.mouseOffset);if(n.thread.id===I.hm){let e=n.viewport.current;if(!e)return;l(p.vV({anchorPosition:(0,O.$$)(e,s)}))}else i&&(l(p.UU()),d(s))},[m,f,u,l,i]),E=a.useCallback(e=>{let t=m.current;if(!t)return;let n=h.current;d(null);let a=f(new c.Mi(e.clientX,e.clientY)),o=n.viewport.current;if(!o)return;if(!(t.maxDist>_.wB)||!i)return u(null);let l=n.computeDropLocation(a,t.mouseOffset);if(!n.isInViewport(l))return u(null);let s=r.getCommentDestinationForCanvasPosition(l,n.pageId);return n.thread.id===I.hm||n.setClientMeta({thread:n.thread,clientMeta:{x:l.x,y:l.y,node_id:s?.nodeId,node_offset:s?.nodeOffset||void 0,viewport:o,page_id:n.pageId,in_frame:s?.inFrame,stable_path:s?.stablePath}}),u(null)},[m,f,i,r,u]),b=a.useCallback(e=>{if(0!==e.button)return;e.stopPropagation();let t=f(new c.Mi(e.clientX,e.clientY));u({startPosition:t,mouseOffset:c.Mi.subtract(g||n_,t),maxDist:0})},[f,u,g]);a.useEffect(()=>(document.addEventListener("pointermove",v),document.addEventListener("pointerup",E),()=>{document.removeEventListener("pointermove",v),document.removeEventListener("pointerup",E)}),[v,E]);let{type:y,resolved:C,active:x}=e,T=a.useCallback(()=>{if("face"===y)return{anchorOutlineColor:"",anchorBodyColor:"",anchorLabelColor:"",anchorClass:"anchor--facePinAnchor--JxEdi"};let e="anchor--anchor--P9sAD";C&&(e="anchor--resolvedAnchor--iU0Ct anchor--anchor--P9sAD");let t=nh.R3,n=nh.Dr;x&&(n="#0d99ff");let a=nh.QQ;return x&&(a=nh.Vm,e+=" anchor--activeAnchor--464Qe anchor--anchor--P9sAD"),{anchorOutlineColor:t,anchorBodyColor:n,anchorLabelColor:a,anchorClass:e}},[y,C,x]),{x:P,y:S}=s||e.offset||n_,M=`translate(${P}px, ${S}px)`,N=T();return a.createElement("div",{"aria-hidden":!0,style:{transform:M,WebkitTransform:M},className:`${N.anchorClass} ${L.Dm}`,onPointerDown:b},"face"===e.type?a.createElement("div",{className:"anchor--commentPinIcon--6I08n"}):a.createElement(a.Fragment,null,a.createElement(nf,{isNew:e.isNew,bodyColor:N.anchorBodyColor,outlineColor:N.anchorOutlineColor,labelColor:N.anchorLabelColor}),a.createElement("span",{className:"anchor--anchorLabel--SUXKt",style:{color:N.anchorLabelColor}},e.label)))}function nv(e){let t=(0,np.H)(e.viewportInfo),n=e.thread,r=a.useContext(k.kw),i=a.useCallback((e,n)=>{let a=c.Mi.add(e,n);return(0,O.$$)(t.current,a)},[t]),l=a.useCallback(e=>{let n=r.getValidCommentsRect(),a=(0,O.Z0)(t.current,e);return(0,_.rN)(a,n)},[r,t]),s=(0,w.iZ)(),d=(0,e6.kc)(),m="communityHub"===(0,o.d4)(e=>e.selectedView).view?d:s;return a.createElement(ng,{active:!0,computeDropLocation:i,entity:m,isInViewport:l,isNew:!0,offset:e.thread.anchorPosition||void 0,pageId:e.pageId,resolved:!1,setClientMeta:e.setClientMeta,thread:n,type:"face",viewport:t,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})}var nE=n(575055),nb=n(238462),ny=n(29188),nC=n(407476);class nw extends a.PureComponent{constructor(e){super(e),this.onMouseUpPos=e=>{nC.AU("mouseup",this.onMouseUpPos),nC.AU("mousemove",this.onMouseMovePos);let{onDragEnd:t}=this.props,{drag:n}=this.state;if(!n){this.setState({drag:null});return}let a=performance.now()-n.startedAt;t&&t({start:n.start,duration:a,position:e}),this.setState({drag:null})},this.onMouseDownPos=e=>{nC.on("mouseup",this.onMouseUpPos),nC.on("mousemove",this.onMouseMovePos),this.setState({drag:{start:e,startedAt:performance.now()}});let{onDragStart:t}=this.props;t&&t({start:e,position:e,duration:0})},this.onMouseMovePos=e=>{let{onDragUpdate:t}=this.props,{drag:n}=this.state;if(n&&t){let a=performance.now()-n.startedAt;t({start:n.start,duration:a,position:e})}},this.state={drag:null}}componentWillUnmount(){nC.AU("mouseup",this.onMouseUpPos),nC.AU("mousemove",this.onMouseMovePos)}render(){let e=this.state.drag?{pointerEvents:"none"}:void 0;return a.createElement("div",{role:"button",tabIndex:-1,style:{...e,...this.props.bounds,...this.props.useAbsolute&&{position:"absolute"}},className:"viewport_draggable--container---XH8-","data-forward-events-to-fullscreen":"true",onMouseUp:this.props.onMouseUp,onMouseDown:this.props.onMouseDown,onMouseMove:this.props.onMouseMove,onContextMenu:e=>{ny.eD||(e.stopPropagation(),e.preventDefault())}},this.props.children)}}let nx={onMouseDownPos:()=>{},onMouseMovePos:()=>{},onMouseUpPos:()=>{}};function nk(e){let t=a.useRef(null),n=function(e){let[t,n]=a.useState(nx);return a.useEffect(()=>{e.current&&n({onMouseDownPos:e.current.onMouseDownPos,onMouseMovePos:e.current.onMouseMovePos,onMouseUpPos:e.current.onMouseUpPos})},[e,n]),function(e){let{onMouseDownPos:t,onMouseMovePos:n,onMouseUpPos:o}=e,r=a.useContext(k.kw),i=a.useCallback((e,t)=>{let n=r.getViewportInfo();return c.Mi.subtract({x:e,y:t},new c.Mi(n.x,n.y))},[r]),l=a.useCallback(e=>i(e.clientX,e.clientY),[i]),s=a.useCallback((e,t)=>{let n=l(e);o&&o(n,t)},[o,l]),d=a.useCallback((e,n)=>{if(e.button&&0!==e.button)return;let a=l(e);t&&t(a,n)},[t,l]),m=a.useCallback((e,t)=>{let a=l(e);n&&n(a,t)},[n,l]);return a.useMemo(()=>({onMouseUp:s,onMouseDown:d,onMouseMove:m}),[s,d,m])}(t)}(t),r=(0,o.d4)(e=>e.selectedView);return a.createElement(nw,{children:e.children,ref:t,bounds:e.bounds,onDragEnd:e.onDragEnd,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onMouseDown:n.onMouseDown,onMouseMove:n.onMouseMove,onMouseUp:n.onMouseUp,useAbsolute:"communityHub"===r.view})}var nI=n(173614);let nT=(0,e1.hG)(tD.u24),nP=new class{constructor(e,t){this.guide=null;let n=0;"number"==typeof e&&(n=e),this.inset={top:e.top||e.vertical||n,bottom:e.bottom||e.vertical||n,left:e.left||e.horizontal||n,right:e.right||e.horizontal||n},t&&(this.guide=document.createElement("div"),this.guide.id="inset-guide",this.guide.style.position="fixed",this.guide.style.zIndex="10",this.guide.style.display="none",this.guide.style.pointerEvents="none",document.firstElementChild.append(this.guide))}_computePositionWithinInsetBounds(e,t,n,a,o){let r=n.top,i=n.bottom-this.inset.bottom,l={};t.y<r?l.y=r:t.y+e.clientHeight>i&&(l.y=i-e.clientHeight);let s=n.left,c=n.right;if(t.x<s?l.x=s:t.x+e.clientWidth>c&&(l.x=c-e.clientWidth),l.x&&a&&l.x<t.x){let n=Math.min(a.x-(o?.x||0),c)-e.clientWidth;n>s?l.x=n:l.x=t.x}return l}computePositionWithinInsetBounds(e,t,n,a,o){let r={top:this.inset.top,left:this.inset.left,right:n.width-this.inset.right,bottom:n.y+n.height-this.inset.bottom},i=this._computePositionWithinInsetBounds(e,t,r,a,o);if(this.guide){let e={top:n.y+this.inset.top,left:n.x+this.inset.left,width:n.width-this.inset.right-this.inset.left,height:n.height-this.inset.bottom-this.inset.top};this.guide.style.top=`${e.top}px`,this.guide.style.left=`${e.left}px`,this.guide.style.height=`${e.height}px`,this.guide.style.width=`${e.width}px`,this.guide.style.display="block",i.y||i.x?this.guide.style.border="1px solid red":this.guide.style.border="1px solid green"}return i}}(nT);function nS(e){let{thread:t,viewportBounds:n,onSubmit:r,discardAttempts:i,allowAttachments:l=!0}=e,s=(0,o.wA)(),d=a.useRef(null),m=a.useCallback(()=>{d.current&&d.current.scrollIntoView({block:"end"})},[d]),{anchorPosition:u}=t,[h,f]=a.useState(null),[g,v]=a.useState({x:0,y:0}),E=c.Mi.add(u,g,h),b=(0,o.d4)(e=>e.comments.activeDragTarget),C=function(e,t,n,o,r,i){let l=e.current,s=a.useMemo(()=>t?c.Mi.add(t,i):null,[i,t]);return a.useMemo(()=>{if(!s)return null;if(!l||!o)return s;let e=o.computePositionWithinInsetBounds(l,s,n,t,r);return{...s,...e}},[l,n,o,s,t,r])}(d,E,n,nP,_.hx,e.pinOffset);a.useEffect(()=>{m()},[m]);let w=t.id,x=e.thread.comments.length;a.useEffect(()=>{w!==I.hm&&m()},[m,w,x]);let[k,T]=a.useState(null),P=a.useCallback(e=>{s(p.Z5({messageMeta:e}))},[s]),S=a.useCallback(e=>{s(p.nb({attachmentId:e.id,attachment:e}))},[s]),M=(0,y.tS)(),N=(0,o.Pj)(),D=a.useCallback((t,n)=>{M&&(s(p.nb({attachmentId:t,attachment:null})),0===Object.keys(N.getState().comments.newComment.attachments||{}).length&&e.editorRef.current?.focus(),n?n.then(()=>tt.l.delete(M,t)):tt.l.delete(M,t))},[s,M,N,e.editorRef]),A=a.useCallback(()=>{r(e.thread)},[r,e.thread]),R=a.useCallback(()=>{let t=N.getState().comments.newComment;!(0,ev.I)(t.messageMeta)&&(i&&e.editorRef.current?.isAllSelected()||(0,ev.Kx)(t.messageMeta)&&0===Object.keys(t.attachments||{}).length)&&s(p.Z5({messageMeta:[]}))},[N,i,e.editorRef,s]),O=(0,o.d4)(e=>e.comments.threads),B=O[e.thread.id]?.state===I.EB.BUSY;if(!C)return null;let{x:F,y:U}=C,V=`translate(${F}px, ${U}px)`,H=`calc(${e.viewportBounds.height}px - (2 * ${nT}px))`,q=!0===e.disablePointerEvents?"new_comment_container--translatedThreadContainerNoPointerEvents--9z1L5 new_comment_container--translatedThreadContainer--2xkOH":`new_comment_container--translatedThreadContainer--2xkOH ${L.Dm}`,z=e.thread.id===I.hm?"new_comment_container--newCommentContainerNext--bCfo7 new_comment_container--threadContainer--XIsVX text--fontPos11--2LvXf text--_fontBase--QdLsd overflow--overflowYAuto--nfK38 overflow--momentumScroll--qtsu7":"new_comment_container--threadContainer--XIsVX text--fontPos11--2LvXf text--_fontBase--QdLsd overflow--overflowYAuto--nfK38 overflow--momentumScroll--qtsu7",$=(0,ey.t)("comments.add_a_comment");return a.createElement(nk,{onDragUpdate:e=>{f(c.Mi.subtract(e.position,e.start))},onDragEnd:e=>{h&&(v(c.Mi.add(h,g)),f(null))},bounds:n},a.createElement("div",{style:{transform:V,WebkitTransform:V},className:q},a.createElement(tl.c,{wiggleCount:e.discardAttempts||0,onWiggle:e.onDiscardAttempt},k&&a.createElement(tu,{editorRef:e.editorRef,container:d,initialLocation:k,closeEditor:()=>{T(null)}}),a.createElement("div",{ref:d,className:`${z} ${b?"new_comment_container--highlighted--wsvS9":""}`,style:{maxHeight:H}},a.createElement(nE.i,null,a.createElement(nI.C,{allowAttachments:l,attachments:e.thread.attachments,deleteAttachment:D,dispatch:s,editingExistingComment:!1,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:e.editorRef,editorType:"comment-editor-new",errorFallback:a.createElement(nI.e,{type:"new"}),fallback:null,fileKey:M,hideEmojiPicker:e.hideEmojiPicker,hyperlinkLocation:k,isDisabled:B,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,messageMeta:e.thread.messageMeta,mountInputFocused:!e.mountUnfocused,mountWithButtons:!0,onCancel:R,onComposeFocus:e.onComposeFocus,onSubmit:A,placeholderText:$,recordingKey:I.Dw.new,scrollToBottom:m,setHyperlinkEditorRef:nb.lQ,setHyperlinkLocation:T,setIsEditorFocused:e.setIsEditorFocused,submitText:(0,ey.t)("comments.post"),threadId:I.hm,threadPosition:e.thread.threadPosition,typeahead:e.typeahead,updateAttachment:S,updateMessage:P,user:e.user,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition}))))))}function nM(e){let t=(0,o.d4)(e=>e.comments.newComment.discardAttempt),n=a.useRef(null),r=a.useCallback(()=>{n.current?.selectAll()},[n]),i=(0,O.th)(e.viewportInfo);return a.createElement("div",null,a.createElement(nv,{thread:e.thread,pageId:e.pageId,viewportInfo:e.viewportInfo,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition,setClientMeta:e.setClientMeta}),!e.hideComposer&&a.createElement(nS,{allowAttachments:e.allowAttachments,discardAttempts:t,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:n,hideEmojiPicker:e.hideEmojiPicker,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,mountUnfocused:e.mountUnfocused,onComposeFocus:e.onComposeFocus,onDiscardAttempt:r,onSubmit:e.onSubmit,pageId:e.pageId,pinOffset:e.pinOffset,setClientMeta:e.setClientMeta,setIsEditorFocused:e.setIsEditorFocused,thread:e.thread,typeahead:e.typeahead,user:e.user,viewportBounds:i,viewportInfo:e.viewportInfo,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition}))}var nN=n(596468),nD=n(892750),nA=n(979890);let nL="comment_selection_box--selectionBox--bg--z";function nR(e){let t=(0,O.Z0)(e.viewportInfo,e.pinCanvasPosition),n=(0,O.Z0)(e.viewportInfo,e.selectionBoxAnchorCanvasPosition),[o,r]=a.useState(void 0),[i,l]=a.useState(void 0),[s,c]=a.useState(n.x-10),[d,m]=a.useState(n.y-10),[u,p]=a.useState(0),[h,f]=a.useState(0),[_,g]=a.useState(""),v=(0,tn.fG)(),E=a.useCallback(()=>{r({mousePosition:e.selectionBoxAnchorCanvasPosition,startZoomScale:e.viewportInfo.zoomScale}),c(n.x-10-2500),m(n.y-10-2500),p(5e3),f(5e3),g("translate(2500px, 2500px"),l(v(e.pinCanvasPosition,e.nodeId)||void 0)},[e.nodeId,e.pinCanvasPosition,e.selectionBoxAnchorCanvasPosition,e.viewportInfo,n,r,l,c,m,p,f,g,v]),{onSetNewSelectionBoxAnchor:b,viewportPositionFromClientPosition:y}=e,C=a.useCallback(t=>{if(!o)return;let a=nO(t.clientX,t.clientY,y,e.viewportInfo,i);r({mousePosition:a,startZoomScale:o.startZoomScale});let l=(0,O.Z0)(e.viewportInfo,a),s=l.x-n.x+2500,c=l.y-n.y+2500;g(`translate(${s}px, ${c}px)`)},[o,r,g,i,n.x,n.y,y,e.viewportInfo]),w=a.useCallback((e,t)=>{let n=(0,O.Z0)(e,t);r(void 0),l(void 0),c(n.x-10),m(n.y-10),p(0),f(0),g("")},[r,l,c,m,p,f,g]),x=a.useCallback(t=>{if(!o)return;let n=nO(t.clientX,t.clientY,y,e.viewportInfo,i);b(n),w(e.viewportInfo,n)},[o,i,b,y,w,e.viewportInfo]);a.useEffect(()=>{o||(c(n.x-10),m(n.y-10))},[n,o]),a.useEffect(()=>{o&&o.startZoomScale!==e.viewportInfo.zoomScale&&w(e.viewportInfo,e.selectionBoxAnchorCanvasPosition)},[o,e.viewportInfo,e.selectionBoxAnchorCanvasPosition,w]);let k=o?(0,O.Z0)(e.viewportInfo,o.mousePosition):n,I=Math.min(t.x,k.x),T=Math.min(t.y,k.y),P=Math.max(t.x-I,k.x-I),S=Math.max(t.y-T,k.y-T);return a.createElement(a.Fragment,null,a.createElement("div",{className:nL,style:{left:I,top:T,width:P,height:S}}),e.canUpdateSelectionBoxAnchor&&a.createElement(nA.D8,{role:"button",tabIndex:-1,className:"comment_selection_box--selectionBoxAnchor--6twQJ",style:{left:s,top:d,width:u,height:h},onMouseDown:E,onMouseMove:C,onMouseUp:x,dataTestId:"comment-selection-box-anchor",recordingKey:"commentSelectionBox.anchor"},a.createElement("div",{className:"comment_selection_box--selectionBoxAnchorIcon--iMwhF",style:{transform:_}})))}function nO(e,t,n,a,o){let r=n(new c.Mi(e,t)),i=(0,O.$$)(a,r);if(!o)return new c.Mi(i.x,i.y);let l=(0,ev.pV)(i,o);return new c.Mi(l.x,l.y)}var nB=n(46503);function nF(e){let t=(0,w.Pc)(),n=(0,o.wA)(),r=(0,o.d4)(e=>e.comments.typeahead);return a.createElement(nM,{dispatch:n,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,hideComposer:e.hideComposer,hideEmojiPicker:e.hideEmojiPicker,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,mountUnfocused:e.mountNewCommentUnfocused,onComposeFocus:e.onComposeFocus,onSubmit:e.submitNewComment,pageId:e.pageId,pinOffset:e.pinOffset,setClientMeta:e.setClientMeta,setIsEditorFocused:e.setIsEditorFocused,thread:e.thread,typeahead:r,user:t,viewportInfo:e.viewportInfo,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition})}function nU({viewportBounds:e,isCommunityMentions:t=!1,children:n,activeDragTarget:o}){return a.createElement("div",{"data-forward-events-to-fullscreen":!0,className:`${o?"comments_modal--detailsContainerToFront--mQO8y comments_modal--detailsContainer--zHNy9":"comments_modal--detailsContainer--zHNy9"} ${L.Uu}`,style:{...t&&{position:"absolute"},top:e.y,left:e.x,height:e.height,width:e.width}},n)}function nV(e){let t=(0,o.wA)(),n=(0,O._X)({subscribeToUpdates_expensive:!0}),r=(0,nB._B)(),i=(0,eK.GS)(),l=(0,tn.eW)(),s=a.useMemo(()=>(0,_.vl)(n,e.thread,i,l.paddingRight),[e.thread,n,i,l.paddingRight]),d=(0,eG._6)(),m="communityHub"===d.view,u=(0,_.eR)(e.thread.id),h=a.useRef(null),f=a.useRef(null),{onClear:g}=r,{submitReply:v,submitNewComment:E}=e,b=a.useCallback(e=>{v(e),g()},[v,g]),y=a.useCallback(()=>{E(),g()},[E,g]),C=(0,o.d4)(e=>e.comments.editingComment),k=(0,o.d4)(e=>e.comments.activeDragTarget),T=(0,nN.i)(),P=a.useCallback(()=>h.current?.visible?(h.current.clearDecorators(),!0):T?((0,nN.Dp)(),!0):!!C||(t(p.UU()),!0),[t,C,T]);(0,eZ.O1)(P,eZ.KD.MODAL);let{pinOffset:S}=e,M=a.useMemo(()=>{if(!S)return _.hx;let{width:e,height:t}=S;return{x:e+_.hx.x,y:_.hx.y-t}},[S]),N=(0,e$.y)()&&s.sidebarItemType===I.kT.FEED_POST,D=m?eW.j:(0,x.zW)({feedPostUuid:N?s.feedPostPublicUuid:void 0}),A=a.useCallback(e=>{let t=e.comments[0].client_meta,n=e.comments[0].client_meta.selection_box_anchor,a=c.Mi.subtract(n,t);return c.Mi.add(e.canvasPosition,a)},[]),L=(0,o.d4)(e=>e.comments.newComment),R=a.useCallback(e=>{if(u)t(p.a$({selectionBoxAnchor:e}));else{if(!s.comments[0].client_meta?.selection_box_anchor)return;let n={...s.comments[0].client_meta};if(s.comments[0].client_meta.in_frame){let t=A(s),a=c.Mi.subtract(e,t);n.selection_box_anchor=c.Mi.add(n.selection_box_anchor,a)}else n.selection_box_anchor=e;t(p.hY({thread:s,clientMeta:n}))}},[t,s,u,A]),B="communityHub"===d.view,F=(0,w.TA)(),U=(0,w.Pc)(),V=(0,o.d4)(e=>e.comments),H="prototype"===d.view,q="communityHub"===d.view,z=a.useMemo(()=>"communityHub"===d.view&&"hubFile"===d.subView&&(0,ej.t0)(d.fullscreenState),[d]),$=null;u?$=L.selectionBoxAnchor:s.comments[0].client_meta?.selection_box_anchor&&(s.comments[0].client_meta?.in_frame,$=s.selectionAnchorCanvasPosition??s.boundingBoxAnchorCanvasPosition??null);let K=!!(0,ez.Rs)((0,eX.dDF)(u?null:{key:e.thread.key})).unwrapOr(!1),W=F===s.comments[0]?.user_id;return null===n?null:a.createElement(a.Fragment,null,a.createElement("div",{className:`comments_modal--overlay--1hWXV ${k?"comments_modal--dimBackground--Vyo3f":""}`}),a.createElement(nU,{viewportBounds:n,isCommunityMentions:m,activeDragTarget:k},s.canvasPosition&&$&&a.createElement(nR,{nodeId:s.comments[0]?.client_meta?.node_id,selectionBoxAnchorCanvasPosition:$,pinCanvasPosition:s.canvasPosition,viewportInfo:n,onSetNewSelectionBoxAnchor:R,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition,canUpdateSelectionBoxAnchor:!s.boundingBoxAnchorCanvasPosition&&(u||W||K)}),u?a.createElement(nF,{editorOnClear:r.editorOnClear,editorOnInsert:r.editorOnInsert,hideComposer:e.hideComposer,hideEmojiPicker:B,maxCommentLength:e.maxCommentLength,mentionables:D,mountNewCommentUnfocused:e.mountNewCommentUnfocused,onComposeFocus:e.onComposeFocus,pageId:e.pageId,pinOffset:M,setClientMeta:e.setClientMeta,setIsEditorFocused:r.setIsEditorFocused,submitNewComment:y,thread:s,viewportInfo:n,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition}):s.sidebarItemType===I.kT.COMMENT_THREAD||s.sidebarItemType===I.kT.FEED_POST&&(0,e$.y)()?a.createElement(nu,{commentCreationDisabled:e.commentCreationDisabled,comments:V,disableDragging:q&&!z,dispatch:t,editorOnClear:r.editorOnClear,editorOnInsert:r.editorOnInsert,hideEmojiPicker:B,hideReactions:q,hideResolve:e.hideResolve||!(0,I.m)(s.sidebarItemType),ignoreThreadContainerScrollOnLoad:q,isLoading:e.isLoading,mentionables:D,modalRef:f,mountUnfocused:e.mountNewCommentUnfocused,nextThread:e.nextThread,onComposeFocus:e.onComposeFocus,prevThread:e.prevThread,setIsEditorFocused:r.setIsEditorFocused,setIsPinned:e.setIsPinned,setResolved:e.setResolved,showDockToSideButton:!i&&!q&&!H,showEditedIndicators:q,submitReply:b,thread:s,updateCommentContent:e.updateCommentContent,useAbsolutePositioning:q&&!z,user:U,viewportInfo:n,viewportPositionFromClientPosition:e.viewportPositionFromClientPosition}):void 0,a.createElement(nD.wV,{decoratorsRef:h,onClear:r.onClear,onInsert:r.onInsert,position:s.threadPosition||void 0,isCommunityMentions:m})))}function nH({renderDetailContainerInPortal:e,detailContainerPortal:t,...n}){let o=a.createElement(nV,{...n});return e?t?(0,K.createPortal)(o,t):null:o}var nq=n(857607),nz=n(352317),n$=n(764872);class nK{constructor(e,t=15){this.eventProvider=e,this.dragMin=t,this.dragInfo=null,this._dragCallbacks={},this._onMouseDownOverride=null,this.canvasPositionClick=(e,t)=>this._onCanvasPositionClick?.(e,{replace:t}),this.viewportPositionClick=(e,t)=>this._onViewportPositionClick?.(e,{replace:t}),this.onDown=e=>{if(this.dragInfo={id:`drag-at-${performance.now()}`,start:e,position:e},this._onMouseDownOverride){this._onMouseDownOverride(e),this.dragInfo.interrupted=!0;return}this._dragCallbacks.onDragStart?.(this.dragInfo)},this.onUp=(e,t)=>{if(!this.dragInfo){this._onViewportPositionClick?.(e,t);return}if(this.dragInfo.interrupted)return;let n=this.dragInfo;if(this.dragInfo=null,!(c.Mi.distance(e,n.start)>this.dragMin)||this._dragCallbacks.canDrag&&!this._dragCallbacks.canDrag()){this._dragCallbacks.onDragCancel?.(n.id),this._onViewportPositionClick?.(e,t);return}this._dragCallbacks.onDragEnd?.(n)},this.onMove=e=>{this.dragInfo&&!this.dragInfo.interrupted&&(this.dragInfo={...this.dragInfo,position:e},this._dragCallbacks.onDragUpdate?.(this.dragInfo))}}set onCanvasPositionClick(e){this._onCanvasPositionClick=e}set onViewportPositionClick(e){this._onViewportPositionClick=e}set onMouseDown(e){this._onMouseDownOverride=e}set dragCallbacks(e){this._dragCallbacks=e}subscribe(){return this.eventProvider.on("down",this.onDown),this.eventProvider.on("up",this.onUp),this.eventProvider.on("move",this.onMove),()=>{this.eventProvider.off("down",this.onDown),this.eventProvider.off("up",this.onUp),this.eventProvider.off("move",this.onMove)}}cancel(){this.dragInfo&&(this.dragInfo.interrupted=!0,this._dragCallbacks.onDragCancel?.(this.dragInfo.id))}}function nW(e){return{on:(t,n)=>{let a=e[t];a&&nC.on(a,n)},off:(t,n)=>{let a=e[t];a&&nC.AU(a,n)}}}let nZ=nW({down:"mousedown",up:"mouseup",move:"mousemove"}),nG=nW({}),nj={subscribe:!0,touchEvents:!1};function nX(e){let t=a.useContext(k.kw),n=(0,tn.pC)(),r=(0,tn.gu)(),i=(0,tn.fG)(),l=(0,o.wA)(),s=(0,o.d4)(e=>e.selectedView.view),{dragEventHandler:c}=e,{canvasPositionClick:d}=c,[m,u]=a.useState(null),[h,f]=a.useState(null),[_,g]=a.useState(null),v=a.useMemo(()=>"communityHub"===s?{}:{canDrag:()=>l(p.UU()),onDragStart:e=>{let n=(0,O.$$)(t.getRawViewportInfo(),e.start);g(n),u((0,O.$$)(t.getRawViewportInfo(),e.position)),f(i(n))},onDragCancel:()=>{g(null),u(null),f(null)},onDragUpdate:e=>{if(!_||!m)return;let n=(0,O.$$)(t.getRawViewportInfo(),e.position);if(h){let e=(0,ev.pV)(n,h);(e.x!==m.x||e.y!==m.y)&&u(e);return}u(n)},onDragEnd:e=>{if(_&&m){if(n((0,O.$$)(t.getRawViewportInfo(),e.start))){r(),g(null),u(null),f(null);return}d(m,!0)&&l(p.a$({selectionBoxAnchor:(0,O.$$)(t.getRawViewportInfo(),e.start)})),g(null),u(null),f(null)}}},[t,n,i,r,l,d,s,m,u,h,f,_,g]);a.useEffect(()=>{c.dragCallbacks=v},[v,c]);let E=m?(0,O.Z0)(t.getRawViewportInfo(),m):null,b=_?(0,O.Z0)(t.getRawViewportInfo(),_):null;if(!E||!b)return null;let y=Math.min(b.x,E.x),C=Math.min(b.y,E.y),w=Math.max(b.x-y,E.x-y),x=Math.max(b.y-C,E.y-C);return a.createElement("div",{className:nL,style:{left:y,top:C,width:w,height:x}})}let nQ={replace:!1};function nY(e){let{requestToDeselectCommentPin:t,requestToAddDraftCommentPin:n}=e,r=(0,O.ni)(),i=(0,o.d4)(e=>e.selectedView.view),s=(0,l.md)(z.R),c=void 0!==e.isActiveCommentPinned?e.isActiveCommentPinned:s,d=(0,o.d4)(e=>e.comments.editingComment),m=(0,o.d4)(e=>e.comments.emojiPicker),u=(0,o.wA)(),{activeId:h,commentCreationDisabled:f}=e,g=(0,o.d4)(e=>e.mirror.appModel.currentTool)===N.NLJ.COMMENTS&&"fullscreen"!==i,v=function(e,t,n,r,i){let{requestToDeselectCommentPin:l,eventPreferences:s,allowCompose:c,requestToAddDraftCommentPin:d}=r||{},m=a.useContext(k.kw),u=(0,tn.pC)(),h=(0,tn.gu)(),f=(0,o.wA)(),g=(0,B.ut)(N.Ez5?.singleSlideView().focusedNodeId,null),v=a.useRef(g);a.useEffect(()=>{g!==v.current&&(v.current=g,f(p.UU()))},[g,f]);let E=a.useCallback((a,o)=>{if(e&&(c||!t))return l?!0!==o&&(l(),!0):(n&&n(!1),!f(p.UU())||!0!==o)},[e,c,t,l,n,f]),{touchEvents:b}=s||{},y=a.useCallback((e,t)=>{let n=(0,O.Z0)(m.getViewportInfo(),e),{replace:a}=t||nQ;if(!E(n,a)&&(!b||a)&&(0,_.rN)(n,m.getValidCommentsRect())){if(u(e)){h();return}return d?d?.({x:n.x,y:n.y,width:32*1.15,height:32*1.15}):(f(p.vV({anchorPosition:e})),f(p.CX())),e}},[E,d,b,m,u,h,f]),C=a.useCallback((e,t)=>y((0,O.$$)(m.getRawViewportInfo(),e),t),[m,y]);return function(e,t,n,o,r,i){let{touchEvents:l,subscribe:s}={...nj,...o||{}},c=a.useCallback(()=>new nK(l?nG:nZ),[l]),[d,m]=a.useState(()=>c());return a.useEffect(()=>{m(c())},[c]),a.useEffect(()=>s?d.subscribe():()=>{},[d,s]),a.useEffect(()=>{l&&r&&i?.current?(r.updateTapGestureRecognizer(i.current,e=>{t(e)}),r.updateMultiTouchLongPressGestureRecognizer(i.current,e=>{t(e,{replace:!0})},1)):(d.onCanvasPositionClick=e,d.onViewportPositionClick=t)},[e,t,d,l,r,i]),a.useEffect(()=>{d.onMouseDown=n},[n,d]),d}(y,C,c?null:E,s,a.useContext(nz.W),i)}(h,c,e.setIsPinned,{requestToAddDraftCommentPin:n,eventPreferences:{touchEvents:e.preferTouchOverMouseForComments},allowCompose:!0!==f||g,requestToDeselectCommentPin:t},e.gestureCanvasRef),E=a.createRef(),b=a.useCallback(t=>{if(t.keyCode===nq.Uz.ESCAPE&&(v.cancel(),!d&&e.activeId)){m&&m.visible&&u(p.RI({visible:!1}));return}},[u,d,e.activeId,m,v]),y=eE.v_(e.recordingKey,"keydown",b),C=a.useCallback(e=>{y(e.event)},[y]),w=a.useRef();if(a.useEffect(()=>{if(w.current&&"details"===e.mode&&!e.activeId){w.current();return}},[e.mode,w,e.activeId]),!r)return null;let{x,y:I,width:T,height:P}=r,S={left:e.positionRelativeToCanvas?0:x,top:e.positionRelativeToCanvas?0:I,width:T,height:P};return a.createElement(n$.vL,{name:"comments-view-canvas",focusOnMount:!1,propagateKeyboardFocus:!0,handleKeyDown:C,ref:E,focusFunctionRef:w,style:{position:"absolute"}},a.createElement("div",{"data-forward-events-to-fullscreen":!0,className:"comments_view--viewContainer--gpOsy comments_view--_container--bDxcy"},a.createElement("div",{"data-allow-component-drop":!0,"data-forward-events-to-fullscreen":!0,className:"comments_view--outerAnchorContainer--ppSFh comments_view--_container--bDxcy",ref:e.forwardedRef,style:S},a.createElement(nX,{dragEventHandler:v}),e.children)))}let nJ=a.forwardRef((e,t)=>a.createElement(nY,{...e,forwardedRef:t}));function n0(e){let t=a.useRef(e);return a.useEffect(()=>{t.current=e},[e]),a.useCallback(e=>{let n=t.current,a=n.find(t=>t.id===e);if(a)return function(e,t){let n;if(!e.canvasPosition)return;let a=1/0;return t.forEach(t=>{t.id!==e.id&&t.canvasPosition&&t.page===e.page&&c.Mi.distance(e.canvasPosition,t.canvasPosition)<a&&(n=t,a=c.Mi.distance(e.canvasPosition,t.canvasPosition))}),n}(a,n)},[t])}function n1(e,t,n){if(0===e.comments.length)return!1;let a=e.comments[0]?.user_id===n,o=e.comments.some(e=>e.user_id===n||(0,_.F$)(e).includes(n));return t.canEdit||a||o}let n2=e=>{let t=(0,l.Xr)(z.R),n=(0,s.am)();return a.useCallback(a=>{t(a),a&&n("Comment Pinned",{parentCommentId:e})},[e,n,t])};function n3(e){var t;let{activeId:n}=e,r=a.useContext(k.kw),l=(0,o.d4)(e=>"communityHub"===e.selectedView.view),s=(0,w.iZ)(),d=(0,y.q5)(),m=(0,o.d4)(e=>e.selectedView.commentThreadId),u=(0,o.wA)(),p=a.useContext(M.hh),_=p.filteredThreads,g=(0,nB.WM)(_,e.pageId,n,e.showOnlyParticipatingComments,e.hideInactiveComments);t=_.status,(0,C.t)(e=>{"loaded"===t&&e("comments_rendered")},[t]);let v=(0,nB.hC)(p.threads,[]),E="loaded"===p.threads.status,b=(0,f.Le)(),x=m&&E&&v.some(e=>e.id===m),T=!!m&&E&&!x&&b,S=(0,nB.nq)(m,E,n,v,r,e.requestToSelectCommentPin);a.useEffect(()=>{(S||T)&&u(h.ST())},[S,T,u]);let N=(0,nB.uB)(n,e.pageId),D=(0,nB.zf)(g,r.getViewportInfo()),[A,L]=a.useMemo(()=>{let e=D.findIndex(e=>e.id===n);return -1===e?[void 0,void 0]:[D[e-1],D[e+1]]},[D,n]),R=s?.id&&N&&d?n1(N,d,s.id):null,O=e.hideResolve||!R,B=a.useRef(null),F=a.useCallback(e=>{if(B.current){let t=B.current.getBoundingClientRect();return e.subtract(new c.Mi(t.left,t.top))}return new c.Mi(0,0)},[]),[U,V]=a.useState(null),H=!(e.requestToSelectCommentPin&&N?.id!==I.hm),q=n2(N?.id);return a.createElement(a.Fragment,null,(0,i.k)().comments_react?a.createElement(eV,{activeThread:N,dragDisabledOverride:e.dragDisabledOverride,isCommunity:l,pageId:e.pageId,requestToDeselectCommentPin:e.requestToDeselectCommentPin,requestToSelectCommentPin:e.requestToSelectCommentPin,setActivePinSize:V,setClientMeta:e.setClientMeta,threads:g,viewportPositionFromClientPosition:F}):a.createElement(P.IN,{activeThread:N,dragDisabledOverride:e.dragDisabledOverride,isCommunity:l,pageId:e.pageId,requestToDeselectCommentPin:e.requestToDeselectCommentPin,requestToSelectCommentPin:e.requestToSelectCommentPin,setActivePinSize:V,setClientMeta:e.setClientMeta,threads:g,viewportPositionFromClientPosition:F}),a.createElement(nJ,{ref:B,activeId:n,commentCreationDisabled:"pins"===e.mode||e.commentCreationDisabled,gestureCanvasRef:e.gestureCanvasRef,mode:e.mode,positionRelativeToCanvas:e.positionRelativeToCanvas,preferTouchOverMouseForComments:e.preferTouchOverMouseForComments,recordingKey:"commentsViewCanvas",requestToAddDraftCommentPin:e.requestToAddDraftCommentPin,requestToDeselectCommentPin:e.requestToDeselectCommentPin,setIsPinned:q},a.createElement(a.Fragment,null,N&&H&&a.createElement(nH,{commentCreationDisabled:e.commentCreationDisabled,detailContainerPortal:e.detailContainerPortal,hideComposer:!!e.requestToAddDraftCommentPin,hideResolve:O,isLoading:e.isLoadingActiveThread,maxCommentLength:e.maxCommentLength,mountNewCommentUnfocused:e.mountNewCommentUnfocused,nextThread:L,onComposeFocus:e.onComposeFocus,pageId:e.pageId,pinOffset:U,prevThread:A,renderDetailContainerInPortal:e.renderDetailContainerInPortal,setClientMeta:e.setClientMeta,setIsPinned:q,setResolved:e.setResolved,submitNewComment:e.submitNewComment,submitReply:e.submitReply,thread:N,updateCommentContent:e.updateCommentContent,viewportPositionFromClientPosition:F}))))}function n4(e){let t=(0,x.Qt)(e.activeId);return a.createElement(d.tH,{boundaryKey:"FileCommentsOverlay",team:r.e.WAYFINDING,fallback:d.H4.NONE_I_KNOW_WHAT_IM_DOING},a.createElement(T.p,{featureFlag:"mobile_reply_upsell"},a.createElement(eH.T,null)),a.createElement(n5,{...e,usersOnFile:t}))}function n5(e){let t=(0,f.wq)(),n=(0,S.s)(),r=(0,o.wA)(),i=function(){let e=(0,eq.Vi)(),t=(0,o.d4)(e=>e.mirror.appModel.showComments);return e?"details":!1===t?null:"pins"}(),{pageId:l,modeOverride:s}=e,c=a.useContext(k.kw),d=(0,nB.H6)(c,l),h=(0,f.I_)().writeAPI,_=a.useCallback(e=>{if(!h){console.error("Calling submitReply with no write API");return}"loaded"===t.status&&t.data.find(t=>t.id===e.threadId)&&(e.onCommentValidationFailure=(t,a,o,i)=>p.dB(h,r,t,a,o,i,e.uuid,n),r(p.lV({...e,commentsWriteApi:h,commentsConfiguration:n})),(0,m.YQ)({id:eH.w}))},[r,t,h,n]),y=a.useCallback(e=>{if(!h){console.error("Calling submitNewComment with no write API");return}e.onCommentValidationFailure=(e,t,n,a)=>p.C(r,e,t,n,a),r(p._v(e))},[r,h]),C=(0,o.d4)(e=>e.selectedView),w=(0,E.Yi)(C),x=(0,o.d4)(e=>"fullscreen"===e.selectedView.view),I=(0,g.aV)(),{isLoading:T}=(0,v._Z)(),P=s||i,M=(0,nB.hC)(t,[]);(0,b.d0)(e.activeId,M,c,x,d),(0,b.$P)(e.activeId,M,c,s,P);let N=(0,E.sc)(),D=a.useCallback(e=>{r(p.hY(e))},[r]),A=a.useCallback(e=>{r(p.hx(e))},[r]);if((0,u.Kv)()||x&&(I||T)||null===P||w)return null;let L=!x&&!!N?.requestToSelectCommentPin&&!!N?.requestToDeselectCommentPin&&!!N?.requestToAddDraftCommentPin;return a.createElement(n3,{activeId:e.activeId,detailContainerPortal:e.detailContainerPortal,dragDisabledOverride:N?.shouldDisableCommentDrag,gestureCanvasRef:e.gestureCanvasRef,hideInactiveComments:!1,mode:P,pageId:e.pageId,positionRelativeToCanvas:!1,preferTouchOverMouseForComments:L,renderDetailContainerInPortal:e.renderDetailContainerInPortal,requestToAddDraftCommentPin:N?.requestToAddDraftCommentPin,requestToDeselectCommentPin:N?.requestToDeselectCommentPin,requestToSelectCommentPin:N?.requestToSelectCommentPin,setClientMeta:D,setResolved:A,showOnlyParticipatingComments:e.showOnlyParticipatingComments,showResolvedComments:e.showResolvedComments,submitNewComment:()=>{d(),(0,m.YQ)({id:eH.w})},submitReply:_,updateCommentContent:y})}n3.displayName="CommentsOverlay"},403506:(e,t,n)=>{n.d(t,{g:()=>d,H:()=>l});var a=n(959621),o=n(119017),r=n(454805);class i{constructor(e,t,n){this.cellSize=e,this.neighborThreshold=t,this.sizeFn=n,this.grid=new Map,this.NEIGHBORING_CELL_DELTAS=[[0,0],[-1,0],[0,-1],[0,1],[1,0],[1,-1],[1,1],[-1,-1],[-1,1]]}add(e){let{x:t,y:n}=this.getCoords(e),a=this.toCellIndex(n),o=this.toCellIndex(t);this.getCell(a,o).push(e)}findNeighbor(e){let t=this.sizeFn(e),{x:n,y:a}=this.getCoords(e),o=this.toCellIndex(a),i=this.toCellIndex(n);for(let[n,a]of this.NEIGHBORING_CELL_DELTAS)for(let l of this.getCell(o+n,i+a))if(l!==e){let e=this.sizeFn(l);if((0,r.gt)(t,e)<=this.neighborThreshold)return l}return null}getCoords(e){let t=this.sizeFn(e);return{x:t.x+t.width/2,y:t.y+t.height/2}}getCell(e,t){let n=this.grid.get(e);n||(n=new Map,this.grid.set(e,n));let a=n.get(t);return a||(a=[],n.set(t,a)),a}toCellIndex(e){return Math.floor(e/this.cellSize)}}function l(e,t){return Math.max(e.minZoomPercentage/100-t,0)*e.zoomScaleOverlap}let s=(e,t)=>{t.forEach(t=>{let n=e.threads.length,a=t.threads.length,o=n+a,r=e.x*n/o+t.x*a/o,i=e.y*n/o+t.y*a/o;e.x=r,e.y=i,e.threads=e.threads.concat(t.threads)})};class c{constructor(e,t,n){let r=l(t,e.zoomScale),s=o.XC.getPinSize(3),c=Math.ceil(Math.max(a.u5,s.width,s.height)+r);this.distanceGrid=new i(c,r,n)}getNearbyNeighbor(e){return this.distanceGrid.findNeighbor(e)||void 0}onAddToResultCluster(e){this.distanceGrid?.add(e)}}function d(e,t,n){let o=[],r=null;for(let t of e)t.isActive?r=t:o.push({x:t.canvasPosition.x,y:t.canvasPosition.y,threads:[t]});let i=e=>a.ip.getClusterViewportRect(e,t);if(t.zoomScale<=n.minZoomPercentage/100){let e=new Map;do{e.clear();let a=new c(t,n,i),r=[];for(let t of o){let n=a.getNearbyNeighbor(t);n?e.has(n)?e.get(n).push(t):e.set(n,[t]):(a.onAddToResultCluster(t),r.push(t))}e.forEach((e,t)=>{s(t,e)}),o=r}while(e.size>0)}if(r){let{canvasPosition:e}=r;e&&o.push({x:e.x,y:e.y,threads:[r]})}return o}},469429:(e,t,n)=>{n.d(t,{m:()=>O});var a=n(848318),o=n(773511),r=n(928799),i=n(536384),l=n.n(i),s=n(141760),c=n(740705),d=n(978877),m=n(206639),u=n(716793),p=n(354175),h=n(656329),f=n(781239),_=n(979890),g=n(720522),v=n(967688),E=n(661289),b=n(660376),y=n(324366),C=n(170116),w=n(495607),x=n(25493),k=n(194200);function I(e){let t="left"===e.side?x.A:k.A,n="left"===e.side?`6px 0 0 ${e.color}`:`-6px 0 0 ${e.color}`;return a.createElement(d.P.div,{style:{opacity:e.opacity,position:"relative",top:e.offset,zIndex:1}},a.createElement("div",{style:{boxShadow:n,transition:`box-shadow ${w.Bn}s linear`}},a.createElement(g.B,{svg:t,style:{fill:e.color,transition:`fill ${w.Bn}s linear`}})))}function T(e){let{opacity:t,offset:n,color:o,children:r}=e;return a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start"}},a.createElement(I,{side:"left",opacity:t,offset:n,color:o}),a.createElement("span",{style:{zIndex:2}},r),a.createElement(I,{side:"right",opacity:t,offset:n,color:o}))}function P(e){return a.createElement("div",{style:{borderRadius:"6px",overflow:"hidden"}},e.children)}function S(e){let{color:t,docked:n,dockedStyle:o,dockedOffset:r,children:i}=e,l=(0,y.d)(1),s=(0,y.d)(0),c=!0===n?l:!1===n?s:n,m=(0,C.G)(c,[0,1],[0,1]),u=(0,C.G)(c,[0,1],["0px",`${r}px`]),p=(0,C.G)(c,[0,1],["6px","0px"]);switch(o){case"straight":return a.createElement(d.P.div,{style:{borderTopLeftRadius:p,borderTopRightRadius:p,borderBottomLeftRadius:"6px",borderBottomRightRadius:"6px",backgroundColor:t,overflow:"hidden"}},i);case"inverted":return a.createElement(T,{opacity:m,offset:u,color:t},a.createElement(P,null,i));default:(0,b.xb)(o)}}var M=n(782863),N=n(277930);let D=({enabled:e})=>{let[t,n]=a.useState(0),o=a.useCallback(()=>{n(Date.now())},[]);return a.useEffect(()=>(e&&document.addEventListener("mousemove",o),()=>{document.removeEventListener("mousemove",o)}),[o,e]),t};function A({enabled:e,children:t}){let n=D({enabled:e}),o=(0,M.E)(),r=a.useCallback(()=>{o.start({opacity:1,transition:{duration:0}})},[o]),i=a.useCallback(()=>{o.start({opacity:0,transition:{duration:.5}})},[o]),l=(0,N.A)(i,5e3);return a.useEffect(()=>{r(),e?l():l.isPending()&&l.cancel()},[e,n,l,r]),a.createElement(d.P.div,{animate:o},t)}let L="multiplayer_bell--buttonContainer--4rypl";var R=n(821527);function O(e){let{color:t,useSecondaryColor:n,message:i,renderKey:E,progressBar:b,progressBarDurationMs:y,autoHide:C,button:x,showCloseButton:k,onCloseCallback:I,docked:T,dockedBorderInfo:P,isTabAccessible:M}=e,[N,D]=a.useState(!1),O=h.Xb?"multiplayer_bell--buttonMobile--Z5j0F multiplayer_bell--button--QWm4n multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd multiplayer_bell--multiplayerTextMobile--4qVD- multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd text--fontPos14--OL9Hp text--_fontBase--QdLsd":"multiplayer_bell--button--QWm4n multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd",F=h.Xb?"multiplayer_bell--messageMobile--Z1sCx multiplayer_bell--message--POM9v multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd multiplayer_bell--multiplayerTextMobile--4qVD- multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd text--fontPos14--OL9Hp text--_fontBase--QdLsd":"multiplayer_bell--message--POM9v multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd",U=h.Xb?"multiplayer_bell--closeButtonMobile--s-kHx multiplayer_bell--closeButton--5Pbdu multiplayer_bell--multiplayerTextMobile--4qVD- multiplayer_bell--multiplayerText--b-7-0 text--fontPos11--2LvXf text--_fontBase--QdLsd text--fontPos14--OL9Hp text--_fontBase--QdLsd":"multiplayer_bell--closeButton--5Pbdu",V=t??m.ol.MULTIPLAYER_GRAY,H=a.useMemo(()=>{if("brand"===t)return{"--multiplayerBellBackgroundColor":n?"var(--color-bg-brand-hover)":"var(--color-bg-brand)","--multiplayerBellTextColor":"var(--color-text-onbrand)","--multiplayerBellButtonBackgroundColor":"var(--color-bg-menu)","--multiplayerBellButtonTextColor":"var(--color-text-menu)","--multiplayerBellButtonHoverColor":"var(--color-bg-menu-secondary)","--multiplayerBellProgressBackgroundColor":"var(--color-bg-brand-hover)"};{let e=(0,m.H0)(V),t=(0,u.Hd)(e,-.15),a=(0,u.Hd)(e,-.55),o=(0,u.Hd)(e,-.8),r=e&&(0,m.GL)(e),i=a&&(0,m.GL)(a);return{"--multiplayerBellBackgroundColor":n&&t?(0,s.colorToString)(t):V,"--multiplayerBellTextColor":r,"--multiplayerBellButtonBackgroundColor":a?(0,s.colorToString)(a):void 0,"--multiplayerBellButtonTextColor":i,"--multiplayerBellButtonHoverColor":o?(0,s.colorToString)(o):void 0,"--multiplayerBellProgressBackgroundColor":t?(0,s.colorToString)(t):void 0}}},[V,t,n]),q=(0,a.useRef)(null),z=(0,a.useRef)(null),$=(0,p.wY)(q),K=(0,p.wY)(z),W=$&&K?$.width+K.width:"auto";if(N)return null;let Z=y>=w.BI?"multiplayer_bell--progressBarAnimationSlow--Rfp9s":"multiplayer_bell--progressBarAnimationQuick--aBXRY";return a.createElement(A,{enabled:C},a.createElement(S,{color:H["--multiplayerBellBackgroundColor"],docked:T||!1,dockedStyle:0===(P?.width||0)?"straight":"inverted",dockedOffset:P?.width||0},a.createElement(B,{isTabAccessible:M},a.createElement(c.N,{initial:!1},a.createElement("div",{key:E,className:l()({"multiplayer_bell--multiplayerBell--MJNGX":!0}),style:{...H,transition:`background-color ${w.Bn}s linear`}},b&&a.createElement("div",{className:l()("multiplayer_bell--progressBarContainer--6yfl6")},a.createElement("div",{className:l()("multiplayer_bell--progressBarFill--McozJ",Z),style:{animationDuration:`${y}ms`}})),a.createElement("div",{className:"multiplayer_bell--messageAndButtonsContainer--SRFq4"},a.createElement(d.P.div,{animate:{width:W},className:"multiplayer_bell--messageAndButtonsVariableWidthContainer--6tqVI",transition:{duration:w.Uj,type:"easeOut"}},a.createElement("div",{style:{width:"fit-content"},ref:q,"aria-live":"polite"},i.onClick?a.createElement(o.E,{className:l()(F),recordingKey:f.Pt(e,"message"),onClick:i.onClick},a.createElement(r.T,null,i.text)):a.createElement(r.T,{className:l()(F)},i.text)),a.createElement("div",{style:{width:"fit-content"},ref:z},a.createElement("div",{className:"multiplayer_bell--buttonsContainer--9CCwH"},x&&a.createElement(d.P.div,{className:L,initial:{opacity:0},animate:{opacity:1},transition:{duration:w.Gy,delay:w.kS}},a.createElement(o.E,{className:l()(O),recordingKey:f.Pt(e,"button"),onClick:x.onClick},x.text)),k&&a.createElement("div",{className:L},a.createElement(_.GG,{className:l()(U),recordingKey:f.Pt(e,"closeButton"),onClick:()=>{I&&I(),D(!0)},"aria-label":(0,v.t)("collaboration.spotlight.bell.dismiss")},a.createElement(g.B,{svg:R.default}))))))))))))}function B({isTabAccessible:e,children:t}){return e?a.createElement(a.Fragment,null,t):a.createElement(E.m,{role:"region"},t)}},268170:(e,t,n)=>{n.d(t,{s:()=>r});var a=n(848318),o=n(967688);function r({count:e}){let t;return t=e<10?60:e<100?68:72,a.createElement("div",{style:{minWidth:t,display:"flex",justifyContent:"center"}},(0,o.tx)("collaboration.spotlight.bell.presenter.follower_count",{followerCount:e}))}},514045:(e,t,n)=>{n.d(t,{Y:()=>u});var a=n(848318),o=n(536384),r=n.n(o),i=n(324366),l=n(170116),s=n(978877),c=n(469429),d=n(495607),m=n(944616);function u(e){let{borderInfo:t}=a.useContext(m.h),n=t.width,o=e.docked?0:8,u=(0,i.d)(o),p=(0,l.G)(u,[8,n,0],[0,0,1]),h=(0,l.G)(u,[8,0],[0,1]),f=0===t.width?h:p;return a.createElement(s.P.div,{className:r()({"positioned_multiplayer_bell--multiplayerBellContainer--Ad5kg":!0,"positioned_multiplayer_bell--ghost--vYS1y":e.ghost}),animate:{top:o},style:{top:u},initial:!1,transition:{type:"easeout",duration:d.lo},key:e.renderKey},a.createElement(c.m,{...e,docked:!!e.docked&&f,dockedBorderInfo:t,recordingKey:"multiplayerBell",isTabAccessible:e.isTabAccessible}))}},944616:(e,t,n)=>{n.d(t,{h:()=>a});let a=n(848318).createContext({borderInfo:{width:0,color:"transparent"},style:{}})},495607:(e,t,n)=>{n.d(t,{BI:()=>s,Bn:()=>l,Gy:()=>r,Uj:()=>o,kS:()=>i,lo:()=>a});let a=.2,o=.2,r=.05,i=.2-.05,l=.1,s=3e3},247852:(e,t,n)=>{n.d(t,{Mw:()=>eu,ON:()=>er});var a=n(848318),o=n(301168),r=n(531788),i=n(239547),l=n(413927),s=n(186606),c=n(19180),d=n(382902),m=n(918777),u=n(637640),p=n(615233),h=n(304756),f=n(14564),_=n(297638);n(66699);var g=n(178806),v=n(967688),E=n(952039),b=n(469508),y=n(306152),C=n(322638),w=n(910223);let x="interacted_with_slack_and_teams_announcement";var k=n(972402),I=n(584961),T=n(533737),P=n(506428),S=n(330362),M=n(11232),N=n(92338),D=n(966369),A=n(972382),L=n(730143),R=n(125761),O=n(633468),B=n(318147),F=n(554326),U=n(138528),V=n(698429),H=n(253066),q=n(124810),z=n(317720),$=n(536384),K=n.n($),W=n(156137),Z=n(230618),G=n(50429),j=n(401970),X=n(850426),Q=n(863270),Y=n(696786),J=n(483157),ee=n(614892),et=n(821527);function en(e){let t=(0,Y.GS)();return e.link?a.createElement("div",null,a.createElement(X.Ph,{trackingProperties:{text:e.mainButtonTitle},href:e.link,newTab:!0},e.children)):a.createElement("div",{className:_.s.wFull.$},t?a.createElement(g.$z,{variant:"secondary",onClick:e.onClick,disabled:e.disabled},e.children):a.createElement(g.Ih,{variant:"secondary",onClick:e.onClick,disabled:e.disabled},e.children))}function ea(e){let t=(0,R.iZ)(),n=(0,L.MY)(),r=(0,o.wA)(),i=(0,Y.GS)(),l=(0,A.w)(),s=()=>{let t=e.imageBg?{backgroundColor:e.imageBg}:void 0;return a.createElement(Z.oW,{src:e.imageSrc,className:K()("brand"===e.layoutStyle?"announcement--announcementBrandImg--H6L6b":"announcement--announcementAppImg--l9gG8",{"announcement--imageNoPaddingTop--YSxed":e.imageNoPaddingTop}),alt:e.imageAlt,style:t})},c=z.Qw.useTransform(n,e=>t?.id===e?.creatorId?"owner":e?.canEdit?"editor":"viewer");return a.createElement(Q.fu,{name:e.trackingContextName,properties:{userId:t?.id,jobTitle:l,userRole:c.unwrapOr("viewer")},enabled:e.trackingDisabled&&"loaded"===c.status},a.createElement(W.k,{name:"announcement_panel"},a.createElement(ee.Zk,{className:"announcement--announcementPanel--Ds9Bn"},a.createElement("div",null,a.createElement("div",{className:"announcement--announcementTitleRow--bQu8l"},a.createElement(J.Q,{extended:!0,doNotReserveSpaceForChevron:!0},a.createElement("div",{className:_.s.with({ml8:i}).$},e.title)),a.createElement("div",{className:"announcement--announcementCloseButton--vgH6U"},a.createElement(g.Me,{"aria-label":(0,v.t)("general.close"),onClick:e.onDismiss?e.onDismiss:()=>{r(T.b({[e.userFlagName]:!0}))},trackingProperties:{action:"close"}},a.createElement(j.U,{svg:et.default},a.createElement(q.A,null))))),"app"===e.layoutStyle&&e.description,"brand"===e.layoutStyle&&s()),"app"===e.layoutStyle&&s(),"brand"===e.layoutStyle&&e.description,e.mainButtonOverride,!e.mainButtonOverride&&e.mainButtonTitle&&a.createElement(en,{link:e.ctaHref,onClick:e.onCtaClick,disabled:e.isLoading,mainButtonTitle:e.mainButtonTitle},a.createElement(G.x,{isLoading:e.isLoading,className:"announcement--loading--KRjaH"},()=>a.createElement(a.Fragment,null,e.mainButtonTitle))))))}(0,p.ck)("a553882986986c96fc7d298a674e9e0522d05b53");let eo=(0,N.ck)();var er=(e=>(e.DESIGN="Design",e.PROTOTYPE="Prototype",e.INSPECT="Inspect",e.HANDOFF="Handoff",e.COMMENTS="Comments",e))(er||{});let ei={assetSrc:(0,p.ck)("828793d9a2d4cff784587a20da2cd458dceddfe9"),backgroundColor:"#F5F5F5",imageNoPaddingTop:!0},el={assetSrc:(0,p.ck)("fb12393ac78bdda14d77f2be682d3f2e67fe7f6f"),backgroundColor:"#383838",imageNoPaddingTop:!0},es=(e,t)=>{let n=new Date(e);return n.setDate(n.getDate()+t),n},ec=new Date,ed=[{userFlagName:"seen_mobile_proto_announcement",AnnouncementComponent:function(){let e=(0,o.wA)();return(0,d.md)(D.NE)?a.createElement(ea,{description:(0,v.t)("mobile_download_prompts.play_mobile_prototypes"),imageAlt:(0,v.t)("cross_sell.mobile_app_prompt.comment_image_alt_text"),imageSrc:(0,p.ck)("b50fba0faeea245feed92fe60337297d827e4984"),isLoading:!1,layoutStyle:"app",mainButtonTitle:(0,v.t)("mobile_download_prompts.email_me"),onCtaClick:()=>{h.Ay.post("/api/send_mobile_download_email",{type:"prototype"}),e(E.F.enqueue({message:(0,v.t)("rcs.mobile_comment_reply_upsell.email_sent")})),e(T.b({seen_mobile_proto_announcement:!0}))},title:(0,v.t)("mobile_download_prompts.run_prototypes_from_your_phone"),trackingContextName:"Mobile App Prototype Announcement",trackingDisabled:!0,userFlagName:"seen_mobile_proto_announcement"}):a.createElement(a.Fragment,null)},panelName:"Prototype",additionalDisplayBlocker:(e,t,n,a,o)=>!(0,c.k)().mobile_download_proto_sidebar||n?.is_active_mobile_user||!!a.seen_mobile_proto_download_modal_prompt||(0,V.$A)(o)},{userFlagName:"seen_mobile_comment_announcement",AnnouncementComponent:function(){let e=(0,o.wA)();return a.createElement(ea,{description:(0,v.t)("mobile_download_prompts.join_team_conversations"),imageAlt:(0,v.t)("cross_sell.mobile_app_prompt.comment_image_alt_text"),imageSrc:(0,p.ck)("5b8af9ed88cb76b20858a7a8ac9fed784e5cbeb7"),isLoading:!1,layoutStyle:"app",mainButtonTitle:(0,v.t)("mobile_download_prompts.email_me"),onCtaClick:()=>{h.Ay.post("/api/send_mobile_download_email",{type:"comment"}),e(E.F.enqueue({message:(0,v.t)("rcs.mobile_comment_reply_upsell.email_sent")})),e(T.b({seen_mobile_comment_announcement:!0}))},title:(0,v.t)("mobile_download_prompts.meet_your_team"),trackingContextName:"Mobile App Comments Announcement",trackingDisabled:!0,userFlagName:"seen_mobile_comment_announcement"})},panelName:"Comments",additionalDisplayBlocker:(e,t,n,a,o)=>!(0,c.k)().mobile_download_comment_sidebar||n?.is_active_mobile_user||!!a.seen_mobile_comment_download_modal_prompt||(0,V.$A)(o)},{userFlagName:"dev_mode_dismissed_properties_panel_announcement",AnnouncementComponent:function({userFlagName:e,lifecycle:t}){let n=(0,o.wA)(),r=(0,H.U)("announcement"),i="dark"===(0,P.DP)(),s=()=>{t?(0,M._Z)(t):n(T.b({[e]:!0}))},c=()=>{s(),r("handoff")},{assetSrc:d,backgroundColor:m,imageNoPaddingTop:u}=i?el:ei;return a.createElement(ea,{description:(0,v.t)("inspect_panel.properties.dev_mode_upsell_message"),imageAlt:(0,v.t)("inspect_panel.code.promo_image_alt"),imageBg:m,imageNoPaddingTop:u,imageSrc:d,isLoading:!1,layoutStyle:"brand",mainButtonOverride:a.createElement("div",{className:_.s.wFull.$},a.createElement(l.v,{mode:"dev-handoff"},a.createElement(g.lR,{variant:"primary",onClick:c},(0,v.t)("dev_handoff.paywall.blocking_modal.button.request_access")))),mainButtonTitle:(0,v.t)("inspect_panel.code.promo_button_text"),onCtaClick:c,onDismiss:s,title:(0,v.tx)("dev_handoff.paywall.banner.title"),trackingContextName:"Dev Mode announcement",userFlagName:e})},panelName:"Inspect",lifecycle:{userFlagName:"dev_mode_dismissed_properties_panel_announcement",maxTimes:3,cooldown:"MONTH_AND_A_HALF"},additionalDisplayBlocker:(e,t,n,a,o,r,i,l,s)=>!function({isDevHandoffView:e,isRecovery:t,isReadOnly:n,canAccessDevMode:a}){return!t&&n&&!a&&!e}({isDevHandoffView:(0,V.$A)(o),isRecovery:r,isReadOnly:l,canAccessDevMode:s})},{userFlagName:x,AnnouncementComponent:function(){let{filteredSidebarItems:e}=a.useContext(y.hh);return 0===a.useMemo(()=>"loaded"===e.status&&e.data||[],[e]).length?null:a.createElement(C.u,{className:"dev_handoff_comments_panel_slack_teams_hint--hintPanel--cjNDL",idForTests:"hintFigmaForSlackTeams",userFlag:x,title:(0,v.t)("dev_handoff.comments_panel.slack_teams_hint.title"),icon_DEPRECATED:w.A,hintText:(0,v.tx)("dev_handoff.comments_panel.slack_teams_hint",{figmaForSlackLink:a.createElement(b.N,{href:"https://figma.slack.com/apps/A01N2QYSA81-figma-and-figjam?tab=more_info",newTab:!0,trusted:!0},(0,v.tx)("dev_handoff.comments_panel.slack_teams_hint.slack_link")),figmaForTeamsLink:a.createElement(b.N,{href:"https://appsource.microsoft.com/en-us/product/office/WA200004521?exp=ubp8",newTab:!0,trusted:!0},(0,v.tx)("dev_handoff.comments_panel.slack_teams_hint.teams_link"))})})},panelName:"Comments",additionalDisplayBlocker:(e,t,n,a,o)=>!(0,V.$A)(o)},{userFlagName:I.xb,AnnouncementComponent:I.FO,panelName:"Handoff",additionalDisplayBlocker:(e,t,n,a,o)=>!a.dev_handoff_seen_config_wizard||es(a.dev_handoff_seen_config_wizard.updatedAt,3)<ec},{userFlagName:"dev_mode_demo_file_props_panel_upsell_dismissed",AnnouncementComponent:function(){let e=(0,o.wA)(),t=(0,p.tl)().dev_mode_demo_file_key,n=()=>{t&&u.Ay.redirect((0,O.jN)({file:{key:t},isDevHandoff:!0}),"_blank"),e(T.b({dev_mode_demo_file_props_panel_upsell_dismissed:!0}))};return t?a.createElement(ea,{description:(0,v.t)("dev_mode_demo_file.check_out_our_interactive_test"),imageAlt:(0,v.t)("inspect_panel.code.promo_image_alt"),imageSrc:(0,p.ck)("0381fb8f01b5e71da6e1f3d65e2bab6be47de673"),isLoading:!1,layoutStyle:"brand",mainButtonOverride:a.createElement(l.v,{mode:"dev-handoff"},a.createElement(g.lR,{variant:"primary",onClick:n},(0,v.t)("dev_mode_playground_file.try_it_now"))),mainButtonTitle:(0,v.t)("dev_mode_playground_file.try_it_now"),onCtaClick:n,title:(0,v.tx)("dev_mode_playground_file.want_to_try_dev_mode"),trackingContextName:"Dev Mode Demo Props Upsell",userFlagName:"dev_mode_demo_file_props_panel_upsell_dismissed"}):null},panelName:"Inspect",additionalDisplayBlocker:(e,t,n,a,o,r,i,l,s,c,d)=>!a.dev_mode_dismissed_properties_panel_announcement||s||!i||d?.tier===B.Ag.STARTER}],em=(0,d.eU)(e=>{let t={};return ed.forEach(n=>{n.lifecycle&&(t[n.userFlagName]=e((0,M.eC)(n.lifecycle)))}),t});function eu(e){let t=(0,L.q5)(),n=t?.editorType,l=(0,U.S2)().unwrapOr(null),c=l?.figjamDisabledAt||null,p=(0,o.d4)(e=>e.userFlags),h=(0,d.md)(em),_=(0,R.iZ)(),g=(0,o.d4)(e=>e.userAnalyticsData),E=(0,o.d4)(e=>e.selectedView),b=_?.created_at,y=(0,m.A)(b).add(14,"day").isSameOrAfter((0,m.A)()),C=(0,S.k)(),w=(0,f.WN)(),x=a.useMemo(()=>"prototype"===E.view?void 0:s.Ez5,[E.view]),I=(0,F.ut)(x?.uiState().isRecovery,!1),T="developer"===(0,A.w)(),P=(0,k._I)(),N={};if(C)return a.createElement("div",{className:"announcement--loggedOutSignupCta--qrt2V"},a.createElement(i.f,null),(0,v.t)("auth.create_account_to_view_reply_comments"),a.createElement(r.$n,{variant:"link",onClick:()=>w("SIGN_UP_CTA_COMMENTS_PANEL")},(0,v.t)("auth.sign_up")));if(n===B._Y.WHITEBOARD||n===B._Y.SLIDES||"fullscreen"!==E.view||null!=c||y||"Comments"===e.panelName&&"fullscreen"===E.view&&n===B._Y.DESIGN&&p.claimed_invite_with_pending_user_mention&&!p.has_closed_comment&&u.Ay.location.hash)return null;let D=Date.now()-2592e5;if(ed.some(e=>{let t=p[e.userFlagName];return!!t&&t.updatedAt>new Date(D)}))return null;let O=ed.find(n=>{if(eo||n.panelName!==e.panelName)return!1;if(n.lifecycle){let e=h[n.userFlagName];if(e?.status!=="loaded"||(0,M.$1)({...e.data,lifecycleConfig:n.lifecycle}))return!1}let a=p[n.userFlagName];return(!!n.lifecycle||!a)&&!n.additionalDisplayBlocker?.(_,t,g,p,E,I,T,!t?.canEdit,P,N,l)});if(O){let e=O.AnnouncementComponent;return a.createElement(e,{userFlagName:O.userFlagName,lifecycle:O.lifecycle})}return null}},116147:(e,t,n)=>{n.d(t,{T:()=>M,w:()=>S});var a=n(848318),o=n(301168),r=n(19180),i=n(382902),l=n(989232),s=n(238462),c=n(304756),d=n(967688),m=n(952039),u=n(34375),p=n(34542),h=n(385711),f=n(517776),_=n(263336),g=n(518383),v=n(18584),E=n(704410),b=n(136169),y=n(615233),C=n(744577),w=n(67391),x=n(526697);function k(){return a.createElement(a.Fragment,null,a.createElement("div",{style:C.sx.add({backgroundColor:"#5551ff"}).$},a.createElement(w.Gv,{src:(0,y.ck)("a553882986986c96fc7d298a674e9e0522d05b53"),width:"100%"})),a.createElement(w.ak,null,(0,d.tx)("rcs.mobile_comment_reply_upsell_page1.description")))}function I(){return a.createElement(a.Fragment,null,a.createElement("div",{style:C.sx.flex.alignCenter.wFull.borderBox.p18.h200.add({backgroundColor:"#5551ff"}).$},a.createElement(x.T,null)),a.createElement(w.ak,null,(0,d.tx)("rcs.mobile_comment_reply_upsell_page2.description")))}let T="dismissed_mobile_replies_upsell",P=(0,f.r1)(T),S="commentSubmitted";function M(){let e=(0,i.md)(P),t=(0,o.d4)(e=>e.userAnalyticsData?.is_active_mobile_user),n=(0,p.e)({overlay:b.$T1,priority:_.N.DEFAULT_MODAL},[e]);(0,u.E)(n.uniqueId,S,(0,a.useCallback)(()=>{!t&&(0,r.k)().mobile_reply_upsell&&n.show({canShow:e=>!e})},[t,n]));let f=(0,h.A)({numSteps:2,onComplete:n.complete}),y=(0,a.useCallback)(e=>({onClickBehavior:"function",label:e,onClick:e=>{c.Ay.post("/api/send_mobile_download_email"),(0,l.trackEvent)("post_comment_mobile_app_download_prompt_email_me_cta_clicked"),n.complete(),e(m.F.enqueue({message:(0,d.t)("rcs.mobile_comment_reply_upsell.email_sent")}))},textForTracking:()=>e}),[n]),C=(0,a.useMemo)(()=>[{element:k,additionalButton:y((0,d.t)("rcs.mobile_comment_reply_upsell.email_me")),ctaText:(0,d.t)("rcs.mobile_comment_reply_upsell.download_via_qr_code"),ctaOnClick:()=>{(0,l.trackEvent)("post_comment_mobile_app_download_prompt_qr_code_cta_clicked")},onManualDismiss:()=>{(0,l.trackEvent)("post_comment_mobile_app_download_prompt_dismissed")}},{element:I,additionalButton:y((0,d.t)("rcs.mobile_comment_reply_upsell.email_me_instead")),ctaText:(0,d.t)("rcs.rcs_shared.done"),ctaOnClick:s.lQ,onManualDismiss:s.lQ}],[y]),w=(0,a.useMemo)(()=>C.map((e,t)=>a.createElement(v.h,{key:t,additionalButton:e.additionalButton,ctaText:e.ctaText,currentStepIndex:t,defaultLocation:E.LN.BOTTOM_RIGHT,element:e.element,hideStepCounter:!0,isShowing:n.isShowing,modalType:E.q3.DRAGGABLE,onClickPrimaryCta:()=>{f.next(),e.ctaOnClick()},onClose:s.lQ,onManualDismiss:()=>{n.complete(),e.onManualDismiss()},title:()=>(0,d.t)("rcs.mobile_comment_reply_upsell.title"),totalNumSteps:2,trackingContextName:"mobile_reply_upsell",userFlagOnShow:T})),[C,n,f]);return a.createElement(g.U,{currentStep:f.currentStep,isShowing:n.isShowing},w)}},526697:(e,t,n)=>{n.d(t,{T:()=>i});var a=n(848318),o=n(615233),r=n(744577);function i(){return a.createElement("div",{style:r.sx.flex.columnGap32.flexRow.alignCenter.justifyCenter.wFull.$},a.createElement("img",{alt:"Android QR code",src:(0,o.ck)("259b16f36c4afa958c6185b07e9b78f3e2b4cc4d")}),a.createElement("img",{alt:"IOS QR code",src:(0,o.ck)("d32c8c72eda223d979ca672dacb3ead939ac63a3")}))}},259810:(e,t,n)=>{n.d(t,{s:()=>m});var a=n(848318),o=n(19180),r=n(978877),i=n(740705),l=n(865114),s=n(696786),c=n(856731),d=n(240092);function m({featured:e,quickAccess:t,onUserClick:n,maxVisibleUsers:m,totalUserCount:u}){let p=(0,s.GS)(),h={ease:"easeOut",duration:p?.15:.3},f=t.filter(t=>t.sessionID!==e?.sessionID);p&&f.reverse();let _=f.length+(e?1:0),g=p?c.pl:32,v=Math.min(m,f.length+(e?1:0))*g,E=(0,l.ZC)(u);p&&E&&u!==E&&(h.duration=.3);let b=(0,a.useCallback)(e=>{if(0===e)return"multiplayer-observation-nux-key"},[]),y=(0,o.k)().spotlight_disable_fade?1:.5,C=`polygon(-${g}px 0, 100% 0, 100% 100%, -${g}px 100%)`,w=e&&a.createElement(r.P.span,{initial:{opacity:0,scale:y},animate:{opacity:1,scale:1},exit:{opacity:0,scale:y},transition:h,style:{pointerEvents:"all"}},a.createElement(d.Q,{user:e,isOverflow:!1,onUserClick:n,hasBorder:p})),x=f.map((e,t)=>a.createElement(r.P.span,{style:{marginLeft:p?"-8px":void 0,pointerEvents:"all"},initial:{opacity:0,scale:y},animate:{opacity:1,scale:1},transition:h,key:e.sessionID,layout:"position"},a.createElement(d.Q,{onboardingKey:b(t),user:e,isOverflow:!1,onUserClick:n,hasBorder:p})));return a.createElement("div",{style:{width:v,clipPath:p?void 0:C,position:"relative",height:"100%",pointerEvents:"none"},"data-onboarding-key":"multiplayer-avatars"},a.createElement(r.P.div,{style:{width:m*g,position:"absolute",right:p?"-8px":0,display:"flex",flexDirection:p?"row-reverse":void 0,justifyContent:_>m!==p?"flex-start":"flex-end"},layout:!0,layoutRoot:!0},a.createElement(i.N,{initial:!1,mode:"popLayout"},p?a.createElement(a.Fragment,null,x,w):a.createElement(a.Fragment,null,w,x))))}},697211:(e,t,n)=>{n.d(t,{M:()=>c});var a=n(848318),o=n(301168),r=n(264478),i=n(967688),l=n(453370),s=n(795240);function c(){let e=(0,o.wA)(),[t,n]=a.useState(),c=a.useCallback(e=>{n(e.target.value)},[]),d=a.useCallback(n=>{n.preventDefault(),n.stopPropagation(),t&&t.trim().length>0&&e(s.cq({name:t})),e(l.oB())},[e,t]);return a.createElement("div",{className:"nickname_dropdown--nicknameDropdownContent--DKhRa",onClick:e=>e.stopPropagation()},a.createElement("form",{onSubmit:d},a.createElement(r.ks,{autoFocus:!0,maxLength:170,className:"nickname_dropdown--nicknameInput--bKp78",placeholder:(0,i.t)("fullscreen.toolbar.multiplayer.enter_a_name"),value:t,onChange:c})))}},209265:(e,t,n)=>{n.d(t,{n:()=>o});let a=new(n(193743)).KH({keys:["name"],threshold:.1});function o(e,t){return a.set(t),a.search(e)}},755042:(e,t,n)=>{n.d(t,{sK:()=>P,vQ:()=>T});var a=n(848318),o=n(536384),r=n.n(o),i=n(239910),l=n.n(i),s=n(410441),c=n(865114),d=n(615233),m=n(61503),u=n(696786),p=n(493228),h=n(125952),f=n(184283),_=n(27776),g=n(574786);let v=e=>e?13:14,E=(0,s.jz)(_.Ocz),b=(0,s.jz)(_.bnr),y=e=>e?b:E,C=(0,s.jz)(_.Ko3);var w=(e=>(e.PRESENTING="presenting",e.SELECTED="selected",e.NONE="none",e))(w||{}),x=(e=>(e.PRESENTING="presenting",e.SELECTED="selected",e.DESELECTED="deselected",e.NONE="",e))(x||{});let k=e=>{let t=e.user.sessionID===e.observingSessionID,n=e.user.sessionID===e.presenterSessionID;return t?"selected":n?"presenting":"none"},I=l()([{current:"none",selected:"selected",presenting:"presenting",none:""},{current:"selected",selected:"selected",presenting:"presenting",none:"deselected"},{current:"presenting",selected:"selected",presenting:"presenting",none:""}],e=>e.current);function T(e){let t;let{user:n,tooltipOffsetY:o}=e,i=(0,u.GS)(),l=(0,m.Av)(),s=i?C:l,d=function(e){let[t,n]=a.useState(""),o=(0,c.ZC)(e),r=a.useMemo(()=>o&&{user:o.user,observingSessionID:o.observingSessionID,presenterSessionID:o.presenterSessionID,nominatedSessionID:o.nominatedSessionID},[o]),i=a.useMemo(()=>({user:e.user,observingSessionID:e.observingSessionID,presenterSessionID:e.presenterSessionID,nominatedSessionID:e.nominatedSessionID}),[e.observingSessionID,e.presenterSessionID,e.user,e.nominatedSessionID]);return a.useEffect(()=>{let t="";if(!e.disableSpotlightAnimation){let e=k(i);t=I[r&&k(r)||"none"][e]}n(t)},[i,r,e.disableSpotlightAnimation]),t}(e),_=g.qb,E=(0,p.Ww)(),b=k(a.useMemo(()=>({user:e.user,observingSessionID:e.observingSessionID,presenterSessionID:e.presenterSessionID,nominatedSessionID:e.nominatedSessionID}),[e.observingSessionID,e.presenterSessionID,e.user,e.nominatedSessionID])),w=n.sessionID===E?.sessionID?"var(--color-bg-brand)":n.color,x=y(i),T=v(i);return e.hasBorder&&(t="none"===b?"outward":"inward"),a.createElement("div",{className:r()({[g.C7]:!e.horizontal,[g._L]:e.horizontal})},a.createElement(f.W,{id:e.tooltipProxyId,user:{id:n.userID,handle:n.name,sessionId:n.sessionID},tooltipOffsetY:o},a.createElement("svg",{key:"multiplayer-animation-svg",className:`multiplayer-animation-svg ${e.horizontal?"horizontal":""}`,viewBox:`0 0 ${x} ${s}`,"aria-hidden":"true"},a.createElement("circle",{className:`multiplayer-animation-circle ${e.horizontal?"horizontal":""} ${d}`,cx:x/2,cy:s/2,r:T,fill:"none",stroke:w,strokeWidth:"2"})),e.showColorIndicators&&a.createElement("div",{key:"multiplayer-animation-droplet",className:`multiplayer-animation-droplet${e.horizontal?"-horizontal":""} ${d}`,"data-avatar-color-bar":!0,style:{backgroundColor:w}}),a.createElement("div",{className:_},a.createElement(h.Ro,{entity:{...n,id:n.userID},className:g.ws,borderStyle:t}))))}let P=a.memo(function(e){let t=y(e.isUI3),n=v(e.isUI3),o=`
  @layer css-modules {
    .multiplayer-animation-svg {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: ${t}px;
    }

    .multiplayer-animation-droplet {
      left: ${t/2-n/2}px;
      top: 0px;
      height: 2px;
      width: ${n}px;
      border-radius: 0px;
      position: absolute;
    }

    .multiplayer-animation-droplet-horizontal {
      left: 0px;
      top: 50%;
      transform: translateY(-50%);
      height: ${n}px;
      width: 2px;
      border-radius: 0px;
      position: absolute;
    }

    .multiplayer-animation-droplet.selected {
      animation: droplet 0.3s ease-in forwards;
    }

    .multiplayer-animation-droplet-horizontal.selected {
      animation: droplet-horizontal 0.3s ease-in forwards;
    }

    .multiplayer-animation-droplet.deselected {
      animation: droplet-reverse 0.2s ease-out 0.4s forwards;
      left: ${t/2-n/4}px;
      top: 0px;
      height: 0px;
      width: 0px;
      border-radius: 0px;
    }

    .multiplayer-animation-droplet-horizontal.deselected {
      animation: droplet-horizontal-reverse 0.2s ease-out 0.4s forwards;
      left: ${t/2-n/4}px;
      height: 0px;
      width: 0px;
      border-radius: 0px;
    }

    .multiplayer-animation-circle {
      stroke-dasharray: 400;
      stroke-dashoffset: 400;
      transform-origin: center;
      transform: rotateZ(-90deg);
    }

    .multiplayer-animation-circle.horizontal {
      transform: rotateZ(-180deg);
    }

    .multiplayer-animation-circle.selected {
      animation: draw-circle 0.15s ease-in 0.3s forwards;
    }

    .multiplayer-animation-circle-horizontal.selected {
      animation: draw-circle-horizontal 0.15s ease-in 0.3s forwards;
    }

    .multiplayer-animation-circle.deselected {
      animation: draw-circle-reverse 0.4s ease-in forwards;
    }

    .multiplayer-animation-circle.presenting {
      stroke-dasharray: 3.4;
      animation: rotating 30s linear infinite
    }

    @keyframes rotating {
      from {
        transform: rotateZ(0deg);
      }
      to {
        transform: rotateZ(360deg);
      }
    }

    @keyframes droplet {
      0% {
        top: 0px;
        height: 2px;
        width: ${n}px;
        border-radius: 0px;
      }
      20% {
        top: -3.5px;
        height: ${n/2}px;
        width:  ${n/2}px;
        border-radius: 100%;
      }
      66% {
        top: -2px;
        height: 7px;
      }
      98% {
        top: 5px;
        height: 3px;
        width: 3px;
        border-radius: 100%;
      }
      99% {
        top: 5px;
        height: 1px;
        width: 1px;
        border-radius: 100%;
      }
      100% {
        top: 5px;
        height: 0px;
        width: 0px;
        border-radius: 100%;
      }
    }

    @keyframes droplet-horizontal {
      0% {
        left: 0;
        height: ${n}px;
        width: 2px;
        border-radius: 0px;
      }
      20% {
        left: -3.5px;
        height: ${n/2}px;
        width: ${n/2}px;
        border-radius: 100%;
      }
      66% {
        left: -2px;
        width: ${n/2}px;
      }
      99% {
        left: 5px;
        height: 3px;
        width: 3px;
        border-radius: 100%;
      }
      100% {
        left: 5px;
        height: 0px;
        width: 0px;
        border-radius: 100%;
      }
    }

    @keyframes draw-circle {
      0% {
        stroke-dashoffset: 400;
      }
      100% {
        stroke-dashoffset: 300;
      }
    }

    @keyframes droplet-reverse {
      0% {
        top: 0px;
        height: 2px;
        width: 2px;
        border-radius: 0px;
      }
      100% {
        top: 0px;
        height: 2px;
        width: ${n};
        border-radius: 0px;
      }
    }

    @keyframes droplet-horizontal-reverse {
      0% {
        left: 0px;
        height: 2px;
        width: 2px;
        border-radius: 0px;
      }
      100% {
        left: 0px;
        width: 2px;
        height: ${n}px;
        border-radius: 0px;
      }
    }
  }
  `;return a.createElement("style",{nonce:(0,d.Ay)().csp_nonce},o)})},40808:(e,t,n)=>{n.d(t,{w:()=>tl});var a=n(848318),o=n(301168),r=n(749214);let i=(0,a.memo)(function(e){return(0,r.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,r.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M9.5 6H7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1zm5-1H17a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2.5v-.5A1.5 1.5 0 0 1 11 3h2a1.5 1.5 0 0 1 1.5 1.5zm-1 0v-.5A.5.5 0 0 0 13 4h-2a.5.5 0 0 0-.5.5V5zM12 12a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m1.212.687a2.5 2.5 0 1 0-2.424 0A4 4 0 0 0 8 16.5a.5.5 0 0 0 1 0 3 3 0 1 1 6 0 .5.5 0 0 0 1 0 4 4 0 0 0-2.788-3.813",clipRule:"evenodd"})})});var l=n(536384),s=n.n(l),c=n(410441),d=n(615233),m=n(410725),u=n(748008),p=n(656329),h=n(66699),f=n(178806),_=n(967688),g=n(318798),v=n(214625),E=n(972402),b=n(361964),y=n(792533),C=n(31898),w=n(863270),x=n(870567),k=n(584026),I=n(961675),T=n(765770),P=n(355755),S=n(125761),M=n(318147),N=n(94831),D=n(822670),A=n(53e3),L=n(710269),R=n(382902),O=n(249726),B=n(709292),F=n(730143),U=n(55116),V=n(806349);function H(){let e=(0,F.tS)(),t=(0,m.Rs)(U.nn0,{fileKey:e??""},{enabled:!!e});return(0,a.useMemo)(()=>t.data?.file?.fileRoleRequests??[],[t.data?.file?.fileRoleRequests])}function q(){let e=(0,o.d4)(e=>e.currentUserOrgId),t=(0,o.d4)(F.vu),n=(0,R.md)(B.t).data??!0,r=(0,m.Rs)(U.L1I,{fileKey:t?.key??"",teamId:t?.team_id??null,repoId:t?.file_repo_id??null,projectId:t?.folder_id??null,currentOrgId:e??null});return(0,a.useMemo)(()=>{let e="loaded"===r.status&&r.data.file;if(!e)return null;let a=e.project,o=(0,O.VA)(a);return{file:t,repo:e.repo?{...(0,V.Xs)(e.repo),canEdit:e.repo.canEdit}:null,hasOrg:!!e.org,isInDraftsFolder:o,isFreeUserOnly:n}},[t,r.status,r.data,n])}let z="edit_request",$="move_to_project";var K=n(995218),W=n(696786),Z=n(578590),G=n(7148),j=n(253332),X=n(138528),Q=n(532511),Y=n(259964),J=n(17753),ee=n(692853),et=n(474935),en=n(475005),ea=n(658029),eo=n(124810),er=n(19180);function ei(e){let{className:t,maxWidth:n,dep:o,children:r}=e,i=(0,a.useRef)(null),l=(0,a.useRef)(null);return(0,a.useLayoutEffect)(()=>{if(!i.current||!l.current)return;i.current.style.width="unset";let e=Math.ceil(l.current.getBoundingClientRect().width);i.current.style.width=`${e}px`},[o]),a.createElement("div",{className:t,ref:i,style:{maxWidth:n}},a.createElement("span",{ref:l},r))}var el=n(806362),es=n(698429),ec=n(335744),ed=n(938982),em=n(998568),eu=n(828532),ep=n(636256);let eh="read-file-requests";function ef(e){let[t,n]=(0,a.useState)(!1),o=(0,P.aV)();return(0,a.useEffect)(()=>{if(o)return;let t=setTimeout(()=>n(!0),e);return()=>clearTimeout(t)},[o,e]),t}function e_(e){let[t,n]=(0,a.useState)(),o=(0,P.aV)();return(0,a.useLayoutEffect)(()=>{if(o)return;let t=()=>{let t=e.getBoundingClientRect(),a=new DOMRect(t.left,t.top,t.width,t.height);a.x+=6,a.y+=6,n(a)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[o,e]),t}function eg(){try{return new Set(JSON.parse(localStorage.getItem(eh)??"[]"))}catch(e){return(0,em.$D)(ed.e.GROWTH_PLATFORM,Error(`Failed to parse read file requests from storage: ${e}`)),localStorage.removeItem(eh),new Set}}let ev="edit_request_tooltip--avatar--RW6OW",eE="edit_request_tooltip--buttonContainer--h3Mpx";function eb({target:e,windowPadding:t}){let n=ef(500),{unreadRequests:r,markRequestsAsRead:i}=function(){let e=H(),[t,n]=(0,a.useState)(()=>eg()),r=(0,S.TA)(),i=(0,o.d4)(e=>e.modalShown?.type===eu.jS),l=(0,a.useMemo)(()=>e.filter(e=>!t.has(e.id)&&e.requesterUserId!==r),[e,t,r]),s=(0,a.useCallback)(e=>{let t=new Set([...eg(),...l.map(e=>e.id)]);localStorage.setItem(eh,JSON.stringify([...t])),e&&n(t)},[l]);return(0,a.useEffect)(()=>{i&&l.length>0&&s(!0)},[i,s,l.length]),{unreadRequests:l,markRequestsAsRead:s}}(),l=function(e){let t=e.map(e=>e.requesterUser?.imgUrl??null),n=0===e.length;return(0,ep.x)(n,t)}(r.slice(0,2)),s=q(),c=(0,es.ks)(),d=(0,E._I)();return n&&r.length&&l&&s&&(!c||d)?a.createElement(ey,{target:e,unreadRequests:r,markRequestsAsRead:i,editRequestPermissionsData:s,windowPadding:t}):null}function ey({target:e,unreadRequests:t,markRequestsAsRead:n,editRequestPermissionsData:o,windowPadding:r}){let i=e_(e);return i?a.createElement(w.fu,{name:"Edit Request Tooltip"},a.createElement(ec.Cf,{className:"edit_request_tooltip--tooltipContainer--rhLGf",targetRect:i,disableDropdownScrollContainer:!0,propagateCloseClick:!0,windowPadding:r},a.createElement(eC,{requests:t,markRequestsAsRead:n,editRequestPermissionsData:o}))):null}function eC({requests:e,markRequestsAsRead:t,editRequestPermissionsData:n}){return a.createElement("div",{className:"edit_request_tooltip--contentContainer--IClWV","data-preferred-theme":"dark","data-testid":"edit-request-tooltip"},a.createElement(ew,{requests:e}),a.createElement(ex,{requests:e}),a.createElement(ek,{requests:e,editRequestPermissionsData:n}),a.createElement(ea.K,{onClick:()=>t(!0),"aria-label":(0,_.t)("general.close")},a.createElement(eo.A,null)))}function ew({requests:e}){let t=e.length<=2?e.length:1,n=e.length-t;return a.createElement("div",{className:"edit_request_tooltip--avatarContainer--wTOHq"},e.slice(0,t).map((e,t)=>a.createElement(el.e,{adtlClassName:ev,key:e.id,size:24,entity:{id:e.requesterUserId,name:e.requesterUser?.handle,img_url:e.requesterUser?.imgUrl},style:{zIndex:-t}})),n>0&&a.createElement(el.e,{adtlClassName:s()(ev,"edit_request_tooltip--avatarRemainder--AP7l3"),size:24,entity:{id:"-1",name:n.toString()},style:{zIndex:-t}}))}function ex({requests:e}){let t=(e=(0,_.t)("user_notifications.community.someone"))=>a.createElement("b",null,e.length<=18?e:`${e.slice(0,18).trim()}...`),n=(()=>{switch(e.length){case 1:return(0,_.tx)("role_request.edit_request_tooltip.user_wants_to_request_type",{userHandle:t(e[0].requesterUser?.handle),requestType:(0,A.zg)(e[0].level)});case 2:return(0,_.tx)("role_request.edit_request_tooltip.user1_and_user2_request_access",{userHandle1:t(e[0].requesterUser?.handle),userHandle2:t(e[1].requesterUser?.handle)});default:return(0,_.tx)("role_request.edit_request_tooltip.user_and_others_request_access",{userHandle:t(e[0].requesterUser?.handle),othersText:a.createElement("b",null,(0,_.tx)("role_request.edit_request_tooltip.othersText",{numOthers:e.length-1}))})}})(),o=1===e.length?137:158;return a.createElement(ei,{className:"edit_request_tooltip--textContainer--OU1YR",maxWidth:o,dep:e},(0,er.k)().edit_request_reformat?a.createElement(a.Fragment,null,a.createElement("div",null,(()=>{switch(e.length){case 1:return t(e[0].requesterUser?.handle);case 2:let n=t(e[0].requesterUser?.handle),o=t(e[1].requesterUser?.handle);if(e[0].requesterUser?.handle.length&&e[1].requesterUser?.handle.length&&e[1].requesterUser?.handle.length+e[0].requesterUser?.handle.length>18)return(0,_.tx)("role_request.edit_request_tooltip.user1_and_user2",{userHandle1:t(e[0].requesterUser?.handle),userHandle2:a.createElement("b",null,(0,_.tx)("role_request.edit_request_tooltip.othersText",{numOthers:e.length-1}))});return(0,_.tx)("role_request.edit_request_tooltip.user1_and_user2",{userHandle1:n,userHandle2:o});default:return(0,_.tx)("role_request.edit_request_tooltip.user1_and_user2",{userHandle1:t(e[0].requesterUser?.handle),userHandle2:a.createElement("b",null,(0,_.tx)("role_request.edit_request_tooltip.othersText",{numOthers:e.length-1}))})}})()),a.createElement("div",null,(()=>{if(1!==e.length)return(0,_.tx)("role_request.edit_request_tooltip.request_access");{let t=(0,A.zg)(e[0].level);return(0,_.tx)("role_request.edit_request_tooltip.wants_to_request_type",{requestType:t})}})())):a.createElement(a.Fragment,null,n))}function ek({requests:e,editRequestPermissionsData:t}){let n=(0,o.wA)(),r=(0,F.tS)(),i=t.file?.key??r,l=e[0];return 1===e.length&&l&&l.requesterUser?a.createElement("div",{className:eE},a.createElement(eI,{id:l.id,level:l.level,requesterUserId:l.requesterUserId,userHandle:l.requesterUser.handle,editRequestPermissionsData:t})):i?a.createElement("div",{className:eE},a.createElement(f.$z,{trackingProperties:{numRequests:e.length},trackingEventName:"Edit Request Tooltip - Open Share Modal",onClick:()=>{i&&n((0,C.to)({type:L.g_,data:{fileKey:i,source:T.nk.editRequestTooltip}}))},variant:"secondary"},(0,_.tx)("role_request.edit_request_tooltip.view_button_text"))):null}function eI(e){let{id:t,level:n,requesterUserId:r,userHandle:i,editRequestPermissionsData:l}=e,s=(0,o.wA)(),c=(0,F.tS)(),{handleApprove:d,handleDeny:m}=(0,A.iF)(s,l)({roleRequestId:t,requestType:n,handle:i}),u={fileKey:c,userId:r,fileRoleRequestId:t,request_type:(0,A.aD)(n)};return a.createElement(a.Fragment,null,a.createElement(f.$z,{trackingProperties:u,trackingEventName:"Edit Request Tooltip - Request Denied",onClick:m,variant:"destructiveLink"},(0,_.tx)("request_row.deny")),a.createElement(f.$z,{trackingProperties:u,trackingEventName:"Edit Request Tooltip - Request Approved",onClick:d,variant:"secondary"},(0,_.tx)("request_row.approve")))}var eT=n(297638),eP=n(912873),eS=n(877146),eM=n(740495),eN=n(209595),eD=n(795234);let eA=new class{notifyViewerRestrictedDraftShared(e){return eD._5.validate(({xr:t})=>t.put(`/api/viewer_restricted_draft/${e}/notify`))}dismissViewerRestrictedDraftShared(e){return eD._5.validate(({xr:t})=>t.put(`/api/viewer_restricted_draft/${e}/dismiss`))}};var eL=n(119866),eR=n(212478),eO=n(208598),eB=n(710923);function eF(){return a.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",className:"shared_vr_draft_tooltip--svg--6colb"},a.createElement("path",{d:"M16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8Z",fill:"#FFCD29"}),a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.30796 4.53016V9.09594H8.6777V4.53016H7.30796Z",fill:"black"}),a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.9925 10.2382C8.49683 10.2382 8.90566 10.6471 8.90566 11.1514V11.214C8.90566 11.7183 8.49683 12.1272 7.9925 12.1272C7.48818 12.1272 7.07935 11.7183 7.07935 11.214V11.1514C7.07935 10.6471 7.48818 10.2382 7.9925 10.2382Z",fill:"black"}))}let eU=[eL.D.type,eO.PK.type,eO.YG.type,eR.t.type];function eV({file:e,target:t}){let n=ef(500),o=(0,es.ks)(),r=(0,m.Rs)(U.lrh,{fileKey:e.key,orgId:e.parentOrgId||null,teamId:e.teamId||null}),i=(0,Z.wR)(e.editorType),{handleUpgrade:l,getUpgradeEligibility:s}=(0,Q.wH)({entryPoint:eS.tc.IN_EDITOR_RESTRICTED_DRAFT}),c=(0,R.md)(eN.yF);if(c&&eU.includes(c)||!n||"loaded"!==r.status)return null;let d=(0,x.oA)(r.data.viewerRestrictedDraftAccessLog);if(!d||o||!e.parentOrgId&&!e.teamId||!r.data.file?.isDraftFile)return null;let u=r.data.currentUser?.baseOrgUser,p=r.data.currentUser?.teamUser;if(!(e.parentOrgId?u:p)||d.dismissedAt||s(i)!==ee.q.CAN_UPGRADE)return null;let h=d.viewerUser?.name,f=l({licenseType:i,upgradeReason:eB.i.DRAFTS_SHARE,entryPoint:eS.tc.IN_EDITOR_RESTRICTED_DRAFT});return a.createElement(eH,{target:t,viewerUserName:h,file:e,orgUser:u,teamUser:p,handleUpgrade:f})}function eH({target:e,viewerUserName:t,file:n,orgUser:o,teamUser:r,handleUpgrade:i}){let l=e_(e),s=(0,eM.Xt)(!!o),[c,d]=(0,a.useState)(!1);if(!s||c||!l)return null;let m=o?.org??r?.team;if(!m)return null;let u=()=>{eA.dismissViewerRestrictedDraftShared(n.key),d(!0)},p=(0,_.tx)("viewer_restricted_tooltip.teammates_cant_access_this_file"),h=t?(0,_.tx)("viewer_restricted_tooltip.to_collaborate_in_this_draft",{fileOpenerName:t}):(0,_.tx)("viewer_restricted_tooltip.to_collaborate_in_this_draft_no_name");return a.createElement(w.fu,{name:"VR Draft Share Notification Tooltip"},a.createElement(ec.Cf,{targetRect:l,disableDropdownScrollContainer:!0,showPoint:!0,propagateCloseClick:!0,maxWidth:384},a.createElement("div",{className:eT.s.flex.flexRow.gap14.mb4.mt4.ml8.mr8.$,"data-testid":"SharedVrDraftTooltipView"},a.createElement(eq,{plan:m}),a.createElement("div",null,a.createElement("div",{className:eT.s.colorTextOnbrand.fontBold.$},p),a.createElement("div",{className:eT.s.colorTextOnbrandSecondary.mt2.$},h),a.createElement("div",{className:eT.s.flex.flexRow.mt8.gap8.$},a.createElement(f.e6,{className:"shared_vr_draft_tooltip--ignoreButton---wVA0",onClick:u},(0,_.tx)("viewer_restricted_tooltip.ignore")),a.createElement(f.lR,{variant:"primary",type:"submit",onClick:e=>{d(!0),i(e),u()}},(0,_.tx)("viewer_restricted_tooltip.get_upgraded_seat")))))))}function eq({plan:e}){let t={imgUrl:e.imgUrl??void 0,id:e.id,name:e.name};return a.createElement("div",{className:"shared_vr_draft_tooltip--svgContainer--SousN"},a.createElement(eP.nl,{team:t,size:eP.Pf.LARGE}),a.createElement(eF,null))}var ez=n(382293),e$=n(398612),eK=n(637640),eW=n(103661),eZ=n(946778),eG=n(264478),ej=n(720522),eX=n(677334),eQ=n(446951),eY=n(844462),eJ=n(175393),e0=n(593713),e1=n(226455);let e2="share_link_modal--section--JsLVR";var e3=n(75936),e4=n(391205);function e5({fileKey:e,onRequestClose:t,alreadyCopied:n}){let r=(0,o.wA)(),i=eX.M4.File.useValue(e).data,l=i?.url||"",c=(0,o.d4)(e=>!e.user),[d,m]=(0,a.useState)(!!n),u=()=>{d||(m(!0),r(y.S({url:l})))};return(0,a.useEffect)(()=>{if(d){let e=setTimeout(()=>{m(!1)},5e3);return()=>clearTimeout(e)}},[d]),a.createElement(w.fu,{name:"Share Link Modal"},a.createElement("div",{className:e2},(0,_.tx)("figjam_try.share_link_modal.title")),a.createElement("div",{className:e2},a.createElement(eG.ks,{readOnly:!0,value:l,onClick:u,className:"share_link_modal--input--GQgxB"})),a.createElement("div",{className:s()(c&&e2)},a.createElement(eG.vd,{fullWidth:!0,onClick:u,trackingProperties:{buttonContext:"Copy link"}},a.createElement("span",{className:"share_link_modal--buttonContent--xZNXo"},a.createElement(ej.B,{svg:e3.A,className:"share_link_modal--linkIcon--lwYrP"}),d?(0,_.t)("figjam_try.link_copied"):(0,_.t)("figjam_try.copy_link")))),c&&a.createElement("div",{className:"share_link_modal--anonymousUserSection--tS-rc"},a.createElement(ej.B,{svg:e4.A,className:"share_link_modal--teamIcon--1LdNm"}),a.createElement("span",null,(0,_.tx)("figjam_try.share_link_modal.cta_description")," ",a.createElement(eG.Us,{role:"button",onClick:()=>{t(),r(eW.Ts({origin:"figjam_try_share_modal",formState:eZ.qB.SIGN_UP,redirectUrl:(0,e$.dR)(eK.Ay.location.pathname,{[e1.ao.key]:e1.ao.value}),signedUpFromOpenSession:!0})),r(C.to({type:eY.x,data:{headerText:(0,_.t)("fullscreen.toolbar.create_an_account_to_do_more_with_fig_jam")}}))},trackingProperties:{buttonContext:"Create account"},trusted:!0},(0,_.tx)("figjam_try.share_link_modal.cta")))))}let e6=(0,eQ.Ju)(function({fileKey:e,alreadyCopied:t}){let n=(0,o.wA)(),r=()=>{n(C.Ce())};return a.createElement(e0.CR,{targetKey:e1.v4,width:300-2*e0.uv,shouldCenterArrow:eJ.EL.FALLBACK,topPadding:4,dismissModal:r,hideCloseButton:!0,animateQuickly:!0},a.createElement(e5,{fileKey:e,onRequestClose:r,alreadyCopied:t}))},"ShareLinkModal");var e8=n(534497);let e7=(0,n(244052).ex)("share_button_disabled_personal_draft",function(e){let{isCurrentUserFileOwner:t}=e;return t?a.createElement("div",{className:eT.s.cursorDefault.colorTextTooltip.$},a.createElement("span",null,(0,_.tx)("fullscreen.toolbar.multiplayer.sharing_disabled_for_personal_drafts")),a.createElement("div",{className:eT.s.bl1.hFull.inline.bSolid.colorBorderMenu.ml8.mr8.$}),a.createElement(e8._,{href:"/files/drafts-to-move",className:eT.s.cursorPointer.noUnderline.fontBold.colorTextTooltip.$},(0,_.tx)("fullscreen.toolbar.multiplayer.sharing_disabled_visit_drafts_to_move_link"))):(0,_.tx)("fullscreen.toolbar.multiplayer.sharing_disabled_while_file_is_being_moved")},e=>{let t=e.getAttribute("data-tooltip-is-current-user-file-owner");return{isCurrentUserFileOwner:!!t&&JSON.parse(t),unconstrainWidth:!0}});var e9=n(254028),te=n(157777);function tt({fileKey:e,isLegacyPosition:t}){let n=0,o=(0,m.Rs)(U.OCJ,{fileKey:e});if(o&&"loaded"===o.status&&o.data.file?.fileRoleRequests&&(n=o.data.file.fileRoleRequests.length),0===n)return null;let r=s()("badge--shareButtonBadge--zXKJj",{"badge--legacyPosition--58g-I":t});return a.createElement(w.fu,{name:"Share Button Badge",properties:{numRequests:n}},a.createElement("div",{className:r}))}var tn=n(401970),ta=n(626467);function to(){return a.createElement("div",{className:"open_sessions_icon--container--Lveob","data-testid":"openSessionsIcon"},a.createElement(tn.U,{svg:ta.A},a.createElement(i,null)))}var tr=n(27776),ti=(e=>(e.PRIMARY="primary",e.SECONDARY="secondary",e.DISABLED="disabled",e.LOADING="loading",e.OPEN_SESSION="openSession",e.PERSONAL_DRAFT_DISABLED="personalDraftDisabled",e.HAS_CURRENT_UPGRADE_REQUEST="hasCurrentUpgradeRequest",e))(ti||{});function tl({editingFile:e,user:t,isFileInWorkshop:n,appendedClassname:r}){let i=(0,W.GS)(),l=(0,b.l7)(),s=(0,K.my)(),f=(0,Z.wR)(e.editorType),{hasPendingRequest:w,getUpgradePathway:R,getHasProvisionalAccess:O}=(0,Q.wH)({folderId:e.folderId}),B=e.editorType===M._Y.WHITEBOARD&&!!e.org?.figjamDisabledAt,V=s===Y.nT.Slides&&(0,u.oA)(e.org?.isSlidesDisabled),en=s===Y.nT.Sites&&!!e.org?.isSitesDisabled,ea=s===Y.nT.Cooper&&!!e.org?.isCooperDisabled,eo=(0,te.e)(),er=!!e.org||(0,j.XX)(e.team),ei=e.isTryFile,el=(0,P.aV)(),es=(0,o.wA)(),ec=F.Cq({useSinatraType:!0})?.url,[ed,em]=(0,a.useState)(null),eu=!e.teamId&&!e.parentOrgId&&e.folderId===t?.personal_drafts_folder_id&&!ei,ep=O(f),{userLacksLicenseAccess:eh}=(0,Q.KI)({fileKey:e.key,userId:t?.id??null,enabled:!!e&&!!t}),ef=eh(e.editorType??M._Y.DESIGN)&&w(f)&&!ep&&R(f)!==ee.J.AUTO_PATHWAY,e_=t?.id===e.creatorId,eg=(0,ez.vt)(e.team?.id),ev=(0,et.jn)(),eE=(0,m.Rs)(U.kQI,{id:e.team?.id||""},{enabled:!!e.team}),ey="loaded"===eE.status&&!!eE.data.team?.hasPermission,eC=!!e.team&&eg||!!e.team&&ev,ew=e.editorType===M._Y.FIGMAKE&&!eo,ex=(0,X.X$)("ShareButton").unwrapOr(null),ek=ex?.tier===M.Ag.PRO,eI=(0,E.xo)();!function(e){let t=(0,o.wA)(),n=q(),r=H(),i=e.editorType===M._Y.WHITEBOARD&&!!e.org?.figjamDisabledAt,l=e.editorType===M._Y.SLIDES&&(0,x.oA)(e.org?.isSlidesDisabled),s=e.editorType===M._Y.SITES&&e.org?.isSitesDisabled,c=e.editorType===M._Y.COOPER&&e.org?.isCooperDisabled,d=(0,P.aV)(),m=(0,S.iZ)();a.useEffect(()=>{let a=(0,I.QL)(z),o="true"===(0,I.QL)($);a&&!d&&function(a){if(i||l||s||c||!n)return;let d=r.find(e=>e.id===a);if(d?.level!==N.e6.EDITOR||d.status!==A.IZ.Pending)return;let u=e.ownerRole?.userId,p=m?.id;if(null==u||null==p||u!==p)return;let h=d.requesterUser?.handle;if(!h)return;let f=o&&n.isFreeUserOnly&&n.isInDraftsFolder&&!n.hasOrg,g={handle:h,requestType:N.e6.EDITOR,roleRequestId:a};t((0,C.to)({type:L.g_,data:{fileKey:n.file?.key??e.key,source:T.nk.editRequestExternal}})),f&&(0,k.h)(n.file,n.repo,t,{handlesVisualBell:!0,callback:e=>{(0,A.wR)(t,A.IZ.Approved,g)}},{...(0,D.x)(),moveText:(0,_.t)("file_permissions_modal.move_and_allow_edits")}),(0,I.EM)(z),(0,I.EM)($)}(a)},[e,m,n,r,i,l,s,c,d,t])}(e);let eT=(0,e9.Oc)(),eP=(e.canView&&e.canEdit,(0,a.useCallback)(()=>{if(!el&&!B&&!V&&!en&&!ea&&!ew&&!eu&&e){if(ei){let t;void 0!==ec&&(es(y.S({url:ec})),t=!0),es((0,C.to)({type:e6,data:{fileKey:e.key,alreadyCopied:t}}))}else(0,h.YQ)({id:"multiplayer_toolbar_share_button"}),es((0,C.to)({type:L.g_,data:{fileKey:e.key,source:T.nk.fullscreenToolbar,isLockedTeam:eC}}))}},[el,B,V,en,ea,eu,ei,ew,eC,ec,e,es])),eS=(0,G.m0)();if((0,a.useEffect)(()=>{eS&&(eS._share_file=()=>{eP()})},[eS,eP]),p.Ay.isMeetDevice||(!ei||!n)&&!t)return null;let eM=n&&!ei&&er,eN=!!(0,d.tl)().org_id&&(0,d.tl)().org_id===e.parentOrgId;if(eC&&"loading"===eE.status)return null;let eD=ew?"disabled":ei?"secondary":B||V||en||ea?"disabled":el?"loading":eM?"openSession":eu?"personalDraftDisabled":ef?"hasCurrentUpgradeRequest":eC&&ey&&!e.canEdit||eI?"secondary":"primary",eA=ew?(0,_.t)("fullscreen.toolbar.multiplayer.sharing_figmake_files_disabled"):B?(0,_.t)("fullscreen.toolbar.multiplayer.sharing_fig_jam_files_disabled_by_your_organization"):V?(0,_.t)("fullscreen.toolbar.multiplayer.sharing_slides_files_disabled_by_your_organization"):en?(0,_.t)("fullscreen.toolbar.multiplayer.sharing_sites_files_disabled_by_your_organization"):ea?(0,_.t)("fullscreen.toolbar.multiplayer.sharing_buzz_files_disabled_by_your_organization"):eM?(0,_.t)("fullscreen.toolbar.multiplayer.open_session_in_progress"):eu?e7:ef?(0,_.t)("fullscreen.toolbar.multiplayer.sharing_has_current_upgrade_request"):null,eL={"data-tooltip-is-current-user-file-owner":JSON.stringify(e_),"data-tooltip-type":eu?J.Ib.SPECIAL:J.Ib.TEXT,"data-tooltip-interactive":!!eu,"data-tooltip":eA,"data-tooltip-show-immediately":!0,"data-tooltip-offset-y":eu?0:6},eR=s===Y.nT.Whiteboard,eO=i&&(eR||l||eT),eB=e.hasEditRole&&(0,u.oA)(e.hasEditRole),eF=!el&&!eA&&ed&&e_&&(eN||ek),eU=eR?(0,c.jz)(tr.M$q):void 0;return a.createElement(a.Fragment,null,a.createElement("div",{className:eO?"share_button--shareButtonContainer--LA-wf":"share_button--legacyShareButtonContainer--51MTb",ref:em,"data-onboarding-key":g.D9},a.createElement(eO?tm:ts,{variant:eD,onClick:eP,tooltipProps:eL,appendedClassname:r}),eB&&a.createElement(tt,{fileKey:e.key,isLegacyPosition:!eO})),eB&&!eA&&ed&&a.createElement(eb,{target:ed,windowPadding:eU}),eF&&a.createElement(eV,{file:e,target:ed}),a.createElement(v.DG,null))}function ts({variant:e,onClick:t,tooltipProps:n,appendedClassname:o}){let r=(0,en.v)(),i="openSession"===e,l=s()(r?"share_button--shareButtonExtraMargin--4zFpB share_button--shareButton--BPUkd share_button--textButtonContainer--uqZsQ":"share_button--shareButton--BPUkd share_button--textButtonContainer--uqZsQ",{"share_button--shareButtonFigjamDisabled--O-XXk":"disabled"===e,"share_button--shareButtonLoading--vLUAl":"loading"===e,"share_button--shareButtonWorkshop--zKuoB":i,"share_button--shareButtonPersonalDraftDisabled--PZUda share_button--shareButton--BPUkd share_button--textButtonContainer--uqZsQ":"personalDraftDisabled"===e,"share_button--shareButtonSecondary--0-pgr":"secondary"===e},"share_button--textButton--x7STz basic_form--primaryBtn--AU7Gy basic_form--btn--FSrmp ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",o);return a.createElement(w.$z,{type:"button",className:l,onClick:t,"data-onboarding-key":e1.v4,...n,dataTestId:"multiplayer-toolbar-share-button",trackingProperties:{buttonVariant:e},disabled:td(e)},i&&a.createElement(to,null),(0,_.tx)("fullscreen.toolbar.multiplayer.share"))}let tc=["disabled","personalDraftDisabled","loading","hasCurrentUpgradeRequest"];function td(e){return tc.includes(e)}function tm({variant:e,onClick:t,tooltipProps:n}){let o={primary:"primary",secondary:"secondary",disabled:"disabled",loading:"disabled",openSession:"primary",personalDraftDisabled:"disabled",hasCurrentUpgradeRequest:"disabled"}[e],r=null;return"openSession"===e&&(r=a.createElement(i,null)),a.createElement(f.c,{disabled:td(e),variant:"disabled"!==o?o:void 0,iconPrefix:r,onClick:t,trackingProperties:{buttonVariant:e},htmlAttributes:{...n,"data-testid":"multiplayer-toolbar-share-button","data-onboarding-key":e1.v4}},(0,_.tx)("fullscreen.toolbar.multiplayer.share"))}},399396:(e,t,n)=>{n.d(t,{W:()=>a});let a=`data:image/svg+xml;utf8,<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M15 23L18 9L17.0222 8.79047L14.0222 22.7905L15 23ZM12.304 12.2072L8.414 16.0962L12.303 19.9852L11.596 20.6922L7 16.0962L7.354 15.7432L11.596 11.5002L12.304 12.2072ZM24.546 15.7432L20.304 11.5002H20.303L19.596 12.2072L23.486 16.0962L19.596 19.9852L20.303 20.6922L24.9 16.0962L24.546 15.7432Z" fill="black" fill-opacity="0.3"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.92869 31.7293L6.18693 30.7632C6.7641 30.9175 7.37164 31 8 31H9.77778V32H8C7.28368 32 6.58934 31.9059 5.92869 31.7293ZM22.2222 32V31H24C24.6284 31 25.2359 30.9175 25.8131 30.7632L26.0713 31.7293C25.4107 31.9059 24.7163 32 24 32H22.2222ZM28.0006 30.9294L27.4998 30.0638C28.5625 29.449 29.449 28.5625 30.0638 27.4998L30.9294 28.0006C30.227 29.2147 29.2147 30.227 28.0006 30.9294ZM32 9.77778H31V8C31 7.37164 30.9175 6.7641 30.7632 6.18693L31.7293 5.9287C31.9059 6.58934 32 7.28368 32 8V9.77778ZM30.9294 3.99936L30.0638 4.50017C29.449 3.43754 28.5625 2.55101 27.4998 1.93619L28.0006 1.07063C29.2147 1.77305 30.227 2.78535 30.9294 3.99936ZM9.77778 0H8C7.28368 0 6.58934 0.0941465 5.9287 0.270741L6.18693 1.23682C6.7641 1.08254 7.37164 1 8 1H9.77778V0ZM3.99936 1.07063L4.50017 1.93619C3.43754 2.55101 2.55101 3.43754 1.93619 4.50017L1.07063 3.99936C1.77305 2.78535 2.78535 1.77305 3.99936 1.07063ZM0 22.2222H1V24C1 24.6284 1.08254 25.2359 1.23682 25.8131L0.270741 26.0713C0.0941465 25.4107 0 24.7163 0 24V22.2222ZM1.07063 28.0006L1.93619 27.4998C2.55101 28.5625 3.43754 29.449 4.50017 30.0638L3.99936 30.9294C2.78535 30.227 1.77305 29.2147 1.07063 28.0006ZM0 20.4444H1V16.8889H0V20.4444ZM0 15.1111H1V11.5556H0V15.1111ZM0 9.77778H1V8C1 7.37164 1.08254 6.7641 1.23682 6.18693L0.270741 5.92869C0.0941466 6.58934 0 7.28368 0 8V9.77778ZM11.5556 0V1H15.1111V0H11.5556ZM16.8889 0V1H20.4444V0H16.8889ZM22.2222 0V1H24C24.6284 1 25.2359 1.08254 25.8131 1.23682L26.0713 0.270741C25.4107 0.0941466 24.7163 0 24 0H22.2222ZM32 11.5556H31V15.1111H32V11.5556ZM32 16.8889H31V20.4444H32V16.8889ZM32 22.2222H31V24C31 24.6284 30.9175 25.2359 30.7632 25.8131L31.7293 26.0713C31.9059 25.4107 32 24.7163 32 24V22.2222ZM20.4444 32V31H16.8889V32H20.4444ZM15.1111 32V31H11.5556V32H15.1111Z" fill="black" fill-opacity="0.3"/>
</svg>
`},154502:(e,t,n)=>{n.d(t,{J:()=>a});let a=`data:image/svg+xml;utf8,<svg width="208" height="124" viewBox="0 0 208 124" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="208" height="124" rx="8" fill="white"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M108.986 49.0056L102.891 73.3875L105.801 74.1151L111.897 49.7332L108.986 49.0056ZM91.0944 60.4997L97.1898 54.4042L99.3111 56.5256L94.2763 61.5604L99.3111 66.5952L97.1898 68.7165L91.0944 62.621L90.0337 61.5604L91.0944 60.4997ZM123.693 60.4997L117.598 54.4042L115.476 56.5256L120.511 61.5604L115.476 66.5952L117.598 68.7165L123.693 62.621L124.754 61.5604L123.693 60.4997Z" fill="black" fill-opacity="0.3"/>
<rect x="0.5" y="0.5" width="207" height="123" rx="7.5" stroke="black" stroke-opacity="0.3" stroke-dasharray="4 4"/>
</svg>`},620958:(e,t,n)=>{n.d(t,{q:()=>_});var a=n(848318),o=n(301168),r=n(204571),i=n(469733),l=n(615233),s=n(656329),c=n(264478),d=n(967688),m=n(577148),u=n(7148),p=n(17753),h=n(770360);let f=()=>{let e=[{key:"figma",name:(0,d.t)("whiteboard.embeds.insert_embed_modal.figma"),url:"https://figma.com/",srcColor:(0,l.ck)("7ea1b6f90b29ea190de9f069109ba70cdb731c3e")},{key:"youtube",name:(0,d.t)("whiteboard.embeds.insert_embed_modal.youtube"),url:"https://youtube.com/",srcColor:(0,l.ck)("27da640990b84fd2d3133d90c7af66d8cf212a41")},{key:"vimeo",name:(0,d.t)("whiteboard.embeds.insert_embed_modal.vimeo"),url:"https://vimeo.com/",srcColor:(0,l.ck)("7ef2e69ffc73f6e90f9fa5e90d485e623c69ed10")},{key:"loom",name:(0,d.t)("whiteboard.embeds.insert_embed_modal.loom"),url:"https://loom.com/",srcColor:(0,l.ck)("097eb54967f52a9ad067434278365eba38bca3c3")},{key:"spotify",name:(0,d.t)("whiteboard.embeds.insert_embed_modal.spotify"),url:"https://spotify.com/",srcColor:(0,l.ck)("1c81468ec0a9eccd0c0cdd21b9d4f6a6477dcc8a")},{key:"codepen",name:(0,d.t)("whiteboard.embeds.insert_embed_modal.codepen"),url:"https://codepen.io/",srcColor:(0,l.ck)("76ecbaf33bb0485666ef32e5afaf73b4add66fd7")}];return e.push({key:"asana",name:(0,d.t)("whiteboard.embeds.insert_embed_modal.asana"),url:"https://asana.com/",srcColor:(0,l.ck)("67c0efb6b111e5fd5b3153057bbddb000ec04fca")}),e};function _(e){let{onSuccess:t}=e,[n,l]=a.useState(""),[f,_]=a.useState(!1),v=(0,o.wA)(),E=a.useCallback(e=>{e.preventDefault(),e.stopPropagation();let a=(0,i.Cg)(v,n);if(a.length&&a[0].valid){_(!1),t();return}(0,r.CV)(v,n,m.WJ.MODAL).valid?(_(!1),t()):(_(!0),b.current?.focus(),b.current?.select())},[v,t,n]),b=a.useRef(null),y=a.useCallback(e=>{l(e.currentTarget.value),_(!1)},[]),C=!(0,r.KJ)(n),w=(0,u.Kx)();return a.createElement("div",{className:h.Eu},e.title&&a.createElement("div",{className:h.Gf},e.title),a.createElement("div",{className:h.yV},(0,d.tx)("whiteboard.embeds.insert_embed_modal.add_media_from_across_the_web",{learnMoreLink:a.createElement(c.CY,{className:h.se,href:"https://help.figma.com/hc/articles/4414079911575",target:"_blank",trusted:!0},(0,d.tx)("whiteboard.embeds.insert_embed_modal.learn_more"))})),a.createElement("form",{className:h.Vy,onSubmit:E},a.createElement("div",{className:h.Ms},a.createElement("div",{className:h.iO},a.createElement(c.ks,{value:n,ref:b,onChange:y,className:h.wK,placeholder:(0,d.t)("whiteboard.embeds.insert_embed_modal.paste_a_public_link"),autoFocus:!w?.shouldOptimizeForIpadApp,autoCapitalize:"none"}),a.createElement("span",{className:f?h.IO:h.GW}),f&&a.createElement("div",{className:h.Xg,"data-tooltip-type":p.Ib.TEXT,"data-tooltip":(0,d.t)("whiteboard.embeds.insert_embed_modal.invalid_link_error_message"),"data-tooltip-show-above":!0,"data-tooltip-show-immediately":!0},a.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.5 14C11.8137 14 14.5 11.3137 14.5 8C14.5 4.68629 11.8137 2 8.5 2C5.18629 2 2.5 4.68629 2.5 8C2.5 11.3137 5.18629 14 8.5 14ZM8.99998 8.66701H7.99998V6.50001V4.66701H8.99998V6.50001V8.66701ZM8.50098 11.333C8.13198 11.333 7.83398 11.035 7.83398 10.667C7.83398 10.298 8.13198 10 8.50098 10C8.86898 10 9.16698 10.298 9.16698 10.667C9.16698 11.035 8.86898 11.333 8.50098 11.333Z",fill:"#F24822"})))),a.createElement(c.nR,{type:"submit",disabled:C,className:h.Rq},(0,d.tx)("whiteboard.embeds.insert_embed_modal.add")))),!s.Ay.isIpadNative&&a.createElement(g,null))}function g(){return a.createElement("div",{className:h.ts},a.createElement("div",{className:h.Y$},(0,d.tx)("whiteboard.embeds.insert_embed_modal.try_linking_to_sites_like")),a.createElement("div",{className:h._q},f().map(e=>a.createElement("div",{key:e.key,className:h.Kk},a.createElement("a",{className:h._Q,href:e.url,"data-tooltip-type":p.Ib.TEXT,"data-tooltip-show-immediately":!0,"data-tooltip-hide-immediately":!0,"data-tooltip":e.name,target:"_blank"},a.createElement("img",{className:h.Dp,src:e.srcColor,alt:e.name}))))))}},749683:(e,t,n)=>{n.d(t,{A:()=>C});var a=n(848318),o=n(771194),r=n(749214);let i=(0,a.memo)(function(e){return(0,r.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,r.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M13 7v1.879l1-1V7a2 2 0 1 0-4 0v4.879l1-1V7a1 1 0 1 1 2 0m.996 5.125-1.87 1.871a2 2 0 0 0 1.87-1.87M8.5 12c0 .413.071.809.203 1.176l-.764.764A4.5 4.5 0 0 1 7.5 12v-.5a.5.5 0 0 1 1 0zm2.324 3.297-.764.764c.444.213.93.355 1.44.412V18h-2a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-2v-1.527a4.5 4.5 0 0 0 4-4.473v-.5a.5.5 0 0 0-1 0v.5a3.5 3.5 0 0 1-4.676 3.297m7.03-8.443a.5.5 0 0 0-.708-.708l-11 11a.5.5 0 0 0 .708.708z",clipRule:"evenodd"})})});var l=n(149550),s=n(967688),c=n(696786),d=n(80024);let m="voice_svg--voiceAudioBar--bWITN",u="voice_svg--voiceAudioBarStroke--MEsT8 voice_users--voiceAudioBarStroke--MKNsx",p="voice_svg--unmuted--2ZOer",h="voice_svg--muted--WhICG",f="voice_svg--mutedLine--A9TnC";function _(){return a.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:p},a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 7.51144C10 6.40687 10.8954 5.51144 12 5.51144C13.1046 5.51144 14 6.40687 14 7.51144V11.5114C14 12.616 13.1046 13.5114 12 13.5114C10.8954 13.5114 10 12.616 10 11.5114V7.51144ZM13 7.51144V11.5114C13 12.0637 12.5523 12.5114 12 12.5114C11.4477 12.5114 11 12.0637 11 11.5114V7.51144C11 6.95916 11.4477 6.51144 12 6.51144C12.5523 6.51144 13 6.95916 13 7.51144Z"}),a.createElement("path",{d:"M9 11.5V11H8V11.5C8 13.5398 9.52684 15.223 11.5 15.469V17H9.99991V18H13.9999V17H12.5V15.469C14.4732 15.223 16 13.5398 16 11.5V11H15V11.5C15 13.1568 13.6569 14.5 12 14.5C10.3431 14.5 9 13.1568 9 11.5Z"}))}function g(){return a.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:h},a.createElement("path",{d:"M13.9121 6.92322C13.6609 6.10572 12.8999 5.51144 12 5.51144C10.8954 5.51144 10 6.40687 10 7.51144V10.8353L11 9.83531V7.51144C11 6.95916 11.4477 6.51144 12 6.51144C12.5523 6.51144 13 6.95916 13 7.51144V7.83531L13.9121 6.92322Z"}),a.createElement("path",{d:"M9.01672 11.8186C9.00567 11.7139 9 11.6076 9 11.5V11H8V11.5C8 11.9047 8.06009 12.2953 8.17184 12.6635L9.01672 11.8186Z"}),a.createElement("path",{d:"M10.0723 15.0057L10.8193 14.2587C11.1816 14.414 11.5808 14.5 12 14.5C13.6569 14.5 15 13.1568 15 11.5V11H16V11.5C16 13.5398 14.4732 15.223 12.5 15.469V17H13.9999V18H9.99991V17H11.5V15.469C10.9877 15.4052 10.5055 15.2444 10.0723 15.0057Z"}),a.createElement("path",{d:"M11.6054 13.4725L14 11.078V11.5114C14 12.616 13.1046 13.5114 12 13.5114C11.8649 13.5114 11.733 13.4981 11.6054 13.4725Z"}),a.createElement("path",{d:"M16.9995 5.25L17.7066 5.95711L6.39291 17.2708L5.6858 16.5637L16.9995 5.25Z",fill:"#F24822",className:f}))}function v({withHover:e}){return a.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",className:e?"voice_svg--mutedWithHover--bYL86 voice_svg--muted--WhICG":h},a.createElement("path",{d:"M19 10.2327V10C19 8.34315 17.6569 7 16 7C14.3431 7 13 8.34315 13 10V16C13 16.0755 13.0028 16.1504 13.0083 16.2245L14 15.2327V10C14 8.89543 14.8954 8 16 8C17.1046 8 18 8.89543 18 10V11.2327L19 10.2327Z"}),a.createElement("path",{d:"M11.3618 17.8709C11.1285 17.293 11 16.6615 11 16V15H10V16C10 16.9426 10.2174 17.8344 10.6047 18.6281L11.3618 17.8709Z"}),a.createElement("path",{d:"M13.4547 21.4349L14.2169 20.6727C14.7707 20.8842 15.3718 21 16 21C18.7614 21 21 18.7614 21 16V15H22V16C22 19.1453 19.5798 21.7254 16.5 21.9795V24H18.5V25H13.5V24H15.5V21.9795C14.7739 21.9196 14.0844 21.7304 13.4547 21.4349Z"}),a.createElement("path",{d:"M15.8915 18.9981L19 15.8896V16C19 17.6569 17.6569 19 16 19C15.9637 19 15.9275 18.9994 15.8915 18.9981Z"}),a.createElement("path",{d:"M24.0005 7L25.0611 8.06066L8.09059 25.0312L7.02993 23.9706L24.0005 7Z",fill:"#F24822",className:f}))}function E({withHover:e}){return a.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",className:e?"voice_svg--unmutedWithHover--XYx6- voice_svg--muted--WhICG":p},a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13 10C13 8.34315 14.3431 7 16 7C17.6569 7 19 8.34315 19 10V16C19 17.6569 17.6569 19 16 19C14.3431 19 13 17.6569 13 16V10ZM18 10V16C18 17.1046 17.1046 18 16 18C14.8954 18 14 17.1046 14 16V10C14 8.89543 14.8954 8 16 8C17.1046 8 18 8.89543 18 10Z"}),a.createElement("path",{d:"M11 16V15H10V16C10 19.1453 12.4202 21.7254 15.5 21.9795V24H13.5V25H18.5V24H16.5V21.9795C19.5798 21.7254 22 19.1453 22 16V15H21V16C21 18.7614 18.7614 21 16 21C13.2386 21 11 18.7614 11 16Z"}))}function b({className:e}){return a.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",className:e},a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25 21.807C25 22.4323 24.6121 22.992 24.0267 23.2115L22.0267 23.9615C21.0461 24.3292 20 23.6043 20 22.557V17.443C20 16.3957 21.0461 15.6708 22.0267 16.0385L24 16.7785V16C24 11.5817 20.4183 8 16 8C11.5817 8 8 11.5817 8 16V16.7785L9.97332 16.0385C10.9539 15.6708 12 16.3957 12 17.443V22.557C12 23.6043 10.9539 24.3292 9.97332 23.9615L7.97331 23.2115C7.38786 22.9919 7 22.4323 7 21.807V16C7 11.0294 11.0294 7 16 7C20.9706 7 25 11.0294 25 16V21.807ZM21 17.443C21 17.0939 21.3487 16.8523 21.6756 16.9748L23.6756 17.7248C23.8707 17.798 24 17.9846 24 18.193V21.807C24 22.0154 23.8707 22.202 23.6756 22.2752L21.6756 23.0252C21.3487 23.1477 21 22.9061 21 22.557V17.443ZM8 18.193C8 17.9846 8.12929 17.798 8.32444 17.7248L10.3244 16.9748C10.6513 16.8523 11 17.0939 11 17.443V22.557C11 22.9061 10.6513 23.1477 10.3244 23.0252L8.32444 22.2752C8.12929 22.202 8 22.0154 8 21.807V18.193Z"}),a.createElement("line",{x1:"16",x2:"16",y1:"20",y2:"16",strokeWidth:"2",strokeDashoffset:"0",strokeDasharray:"0, 8",strokeLinecap:"round"}))}function y({className:e}){return a.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:e},a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19 16.4343C19 16.9924 18.63 17.4829 18.0934 17.6362L16.0934 18.2076C15.2949 18.4358 14.5 17.8362 14.5 17.0057V12.9943C14.5 12.1638 15.2949 11.5643 16.0934 11.7924L18 12.3372V12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12V12.3371L7.9066 11.7924C8.70512 11.5642 9.5 12.1638 9.5 12.9943V17.0057C9.5 17.8362 8.70512 18.4358 7.9066 18.2076L5.9066 17.6362C5.36997 17.4829 5 16.9924 5 16.4343V12C5 8.13401 8.13401 5 12 5C15.866 5 19 8.13401 19 12V16.4343ZM15.5 12.9943C15.5 12.8282 15.659 12.7083 15.8187 12.7539L17.8187 13.3254C17.926 13.356 18 13.4541 18 13.5657V16.4343C18 16.5459 17.926 16.644 17.8187 16.6747L15.8187 17.2461C15.659 17.2917 15.5 17.1718 15.5 17.0057V12.9943ZM6 13.5657C6 13.4541 6.07399 13.356 6.18132 13.3253L8.18132 12.7539C8.34102 12.7083 8.5 12.8282 8.5 12.9943V17.0057C8.5 17.1718 8.34102 17.2917 8.18132 17.2461L6.18132 16.6747C6.07399 16.644 6 16.5459 6 16.4343V13.5657Z"}))}let C={Unmuted:({size:e,withHover:t=!1})=>(0,c.GS)()?a.createElement(o.P,null):24===e?a.createElement(_,null):a.createElement(E,{withHover:t}),Muted:({size:e,withHover:t=!1})=>(0,c.GS)()?a.createElement(i,null):24===e?a.createElement(g,null):a.createElement(v,{withHover:t}),UnmutedBars:({volume:e,className:t,alwaysShowVoiceBars:n,userName:o})=>{if((e||0)<d.q){if(!0!==n)return null;e=0}let r=[7*(e=Math.pow(e||0,.5))*.4,7*e,7*e*.4].map(e=>.8*e+e*(.4*Math.random()-.2));return a.createElement("svg",{width:"24",viewBox:"-5 -8 18 16",fill:"none",className:t,"aria-label":(0,s.t)("collaboration.voice.unmuted_user",{user_name:o})},a.createElement("line",{className:u,x1:"1",y1:0,x2:"7",y2:0,strokeWidth:"5",color:"red",strokeLinecap:"round"}),a.createElement("line",{className:u,x1:"1",y1:-r[0],x2:"1",y2:r[0],strokeWidth:"4",strokeLinecap:"round"}),a.createElement("line",{className:m,x1:"1",y1:-r[0],x2:"1",y2:r[0],stroke:"#1BC47D",strokeWidth:"2",strokeLinecap:"round"}),a.createElement("line",{className:u,x1:"4",y1:-r[1],x2:"4",y2:r[1],strokeWidth:"4",strokeLinecap:"round"}),a.createElement("line",{className:m,x1:"4",y1:-r[1],x2:"4",y2:r[1],stroke:"#1BC47D",strokeWidth:"2",strokeLinecap:"round"}),a.createElement("line",{className:u,x1:"7",y1:-r[2],x2:"7",y2:r[2],strokeWidth:"4",strokeLinecap:"round"}),a.createElement("line",{className:m,x1:"7",y1:-r[2],x2:"7",y2:r[2],stroke:"#1BC47D",strokeWidth:"2",strokeLinecap:"round"}))},HeadphonesIcon:({size:e,className:t})=>(0,c.GS)()?a.createElement(l.D,{className:t}):24===e?a.createElement(y,{className:t}):a.createElement(b,{className:t}),MutedMini:({userName:e})=>a.createElement("svg",{width:"13",height:"16",viewBox:"0 0 13 16",fill:"none","aria-label":(0,s.t)("collaboration.voice.muted_user",{user_name:e})},a.createElement("path",{className:"voice_svg--iconBorder--tkPMY",d:"M4 6V4.5C4 2.567 5.567 1 7.5 1H10C11.1046 1 12 1.89543 12 3V5C12.5523 5 13 5.44772 13 6V8.75736C13 9.55301 12.6839 10.3161 12.1213 10.8787L11 12V14C11 14.5523 10.5523 15 10 15H5C4.44772 15 4 14.5523 4 14V13L1.20711 10.2071C0.816583 9.81658 0.816582 9.18342 1.20711 8.79289L4 6Z"}),a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.33306 3.25234C8.09478 3.09295 7.8083 3 7.5001 3C6.67168 3 6.0001 3.67157 6.0001 4.5V5.58529L6.40341 5.18198L8.33306 3.25234ZM5.47386 10.3542L6.1952 9.63284C6.57505 9.86573 7.0219 10 7.50011 10C8.88081 10 10.0001 8.88074 10.0001 7.50003V7H11.0001V7.50003C11.0001 9.26326 9.69624 10.722 8.0001 10.9646V12H9.0001V13H7.5001H6.0001V12H7.0001V10.9646C6.437 10.884 5.91714 10.6694 5.47386 10.3542ZM6.93722 8.89081L9.0001 6.82793V7.5C9.0001 8.32843 8.32853 9 7.5001 9C7.30104 9 7.11103 8.96122 6.93722 8.89081Z",fill:"#F24822",className:f}),a.createElement("path",{d:"M10.5009 2.49847L11.2081 3.20558L3.92834 10.4853L3.22123 9.77819L10.5009 2.49847Z",fill:"#F24822",className:f}))}},220184:(e,t,n)=>{n.d(t,{WM:()=>h,C$:()=>m});var a=n(848318),o=n(536384),r=n.n(o),i=n(410441),l=n(61503),s=n(335744),c=n(27776);let d=(0,i.hG)(c.rJv);function m(){let e=(0,l.Av)();return window.innerHeight-e-22}var u=(e=>(e.VOICE="voice",e))(u||{});let p={voice:"base_user_overflow_dropdown--voiceOverrides--j6uyP"};function h(e){let t=e.pointingDropdownStyleVariant&&p[e.pointingDropdownStyleVariant],n=r()("base_user_overflow_dropdown--pointingDropdown--SqJzp",t),o=m();return a.createElement(s.Cf,{className:n,targetRect:e.targetRect,maxHeight:o,maxWidth:d,onKeyDown:e.onKeyDown,lean:"left",disableDropdownScrollContainer:!0,propagateCloseClick:!0},a.createElement("div",{className:"base_user_overflow_dropdown--voiceUsersList--pLiMw"},e.children))}},473694:(e,t,n)=>{n.d(t,{Y:()=>d});var a=n(848318),o=n(658029),r=n(967688),i=n(80024),l=n(904749),s=n(17753),c=n(749683);function d({userId:e,onMuteButtonClickCallback:t,disabled:n}){let d=i.h.getInstance(),[m,u]=(0,a.useState)(null),p=(0,l.TI)(e,d),h=(0,a.useCallback)(async()=>{!n&&void 0!==p&&d&&(await t(p,d),u(p?"unmute":"mute"))},[p,t,u,d,n]);a.useEffect(()=>{u(null)},[p]);let f=()=>n?(0,r.t)("collaboration.voice.check_your_microphone_permissions_to_start_chatting"):p?(0,r.t)("collaboration.voice.click_to_unmute"):(0,r.t)("collaboration.voice.click_to_mute");return a.createElement(o.K,{onClick:h,"data-tooltip-type":s.Ib.TEXT,"data-tooltip":f(),"data-tooltip-timeout-delay":n?50:void 0,"aria-label":f(),"data-fullscreen-intercept":!0,disabled:n},n||"unmute"!==m&&("mute"===m||p)?a.createElement(c.A.Muted,{size:32}):a.createElement(c.A.Unmuted,{size:32}))}},623938:(e,t,n)=>{n.d(t,{S:()=>s,i:()=>c});var a=n(848318),o=n(904749),r=n(641400),i=n(749683),l=n(232922),s=(e=>(e[e.NONE=0]="NONE",e[e.DEFAULT=2]="DEFAULT",e[e.MINI=1]="MINI",e))(s||{});function c({userId:e,userName:t,microphoneStyle:n,call:o,volumeIconMutedState:s,alwaysShowVoiceBars:c,className:m}){return n===r.bU.HEADPHONES?a.createElement(i.A.HeadphonesIcon,{size:24,className:l.AL}):n!==r.bU.NONE&&o?a.createElement(d,{userId:e,call:o,className:m,volumeIconMutedState:s||0,alwaysShowVoiceBars:c,userName:t}):a.createElement(a.Fragment,null)}function d({userId:e,call:t,volumeIconMutedState:n,alwaysShowVoiceBars:r,className:s,userName:c}){let d=(0,o.Wl)(e,t);if(!d)return null;if(d.isMuted){if(2===n)return a.createElement(i.A.Muted,{size:32});if(1===n){let e=l.Nn;return s&&(e+=" "+s),a.createElement("span",{className:e},a.createElement(i.A.MutedMini,{userName:c}))}return null}return a.createElement(i.A.UnmutedBars,{alwaysShowVoiceBars:r,className:s,volume:d?.volumeLevel,userName:c})}},639902:(e,t,n)=>{n.d(t,{K:()=>p});var a=n(848318),o=n(301168),r=n(531788),i=n(773511),l=n(967688),s=n(979533),c=n(696786),d=n(353231),m=n(730143),u=n(80024);function p(e){let t=(0,o.wA)(),n=(0,o.Pj)(),p=(0,o.d4)(e=>e.voice.showWidget),h=(0,m.q5)(),f=(0,o.d4)(t=>!!t.voice.activeCall[e.fileKey]),_=!!h&&!!f,g=(0,c.GS)(),v={onClick:async()=>{e.hidePopover&&e.hidePopover(),p&&_?p&&t(s.jT()):((0,d.ds)("Context Viewed",e.fileKey,n.getState(),{name:"should-close-open-audio-nux"}),await u.h.createInstance(),_&&(0,d.ds)("voice_widget_minimized_toggle",e.fileKey,n.getState(),{minimized:!1}),t(s.Pp(!0)))},"data-tooltip-show-below":!0,"data-dropdown-tooltip":e["data-tooltip"],"data-tooltip-type":e["data-tooltip-type"],"data-tooltip":e["data-tooltip"],"aria-label":(0,l.t)("collaboration.voice.start_conversation"),"data-fullscreen-intercept":!0};if(g&&e.isJoinWidget){let{onClick:t,"aria-label":n,...o}=v;return a.createElement("div",{"data-onboarding-key":e["data-onboarding-key"]},a.createElement(r.$n,{onClick:t,"aria-label":n,variant:"signup",htmlAttributes:{...o}},e.children))}return a.createElement(i.E,{...v,className:e.className},e.children)}},153203:(e,t,n)=>{n.d(t,{L:()=>N,k:()=>M});var a=n(848318),o=n(301168),r=n(656329),i=n(967688),l=n(31898),s=n(979533),c=n(353231),d=n(381673),m=n(730143),u=n(125761),p=n(318147),h=n(605885),f=n(472287),_=n(810807),g=n(520779),v=n(259964),E=n(386252),b=n(17753),y=n(274016),C=n(473694),w=n(749683),x=n(639902),k=n(132424),I=(e=>(e[e.NO_CALL_STATE=0]="NO_CALL_STATE",e[e.JOIN_CALL_STATE=1]="JOIN_CALL_STATE",e[e.IN_CALL_WIDGET_OPEN=2]="IN_CALL_WIDGET_OPEN",e[e.IN_CALL_WIDGET_CLOSED=3]="IN_CALL_WIDGET_CLOSED",e))(I||{});let T=()=>new Promise(e=>window.requestAnimationFrame(()=>e())),P=async e=>{let t=e.current;if(!t)return;t.classList.add(k.LT);let n=t.getBoundingClientRect().width;t.style.width=n+"px",await T(),t.style.width="auto";let a=t.getBoundingClientRect().width;t.style.width=n+"px",await T(),t.style.width=a+"px",await new Promise(e=>setTimeout(e,300)),t.style.width="auto",t.classList.remove(k.LT)},S=null;function M(e){let{userIdsInCall:t}=(0,f.W5)(e.fileKey,!0),n=(0,f.bF)(t,e.fileKey),l=(0,o.Pj)(),d=(0,o.wA)(),m=(0,u.iZ)(),p=(0,o.d4)(e=>e.voice.showWidget),_=(0,o.d4)(t=>e.fileKey in t.voice.activeCall),g=(0,o.d4)(t=>!!t.voice.activeCall[e.fileKey]),v=a.useRef(null),E=n.length;a.useEffect(()=>{!_&&E>0?d(s.Zq({fileKey:e.fileKey})):_&&!g&&0===E&&d(s.a6({fileKey:e.fileKey}))},[E,e.fileKey,_,g,d]);let y=async(t,n)=>{(0,c.ds)("voice_user_mute_toggle",e.fileKey,l.getState(),{source:"voice_toolbar",muted:!t}),t?await n?.unmute():await n?.mute()};if(a.useEffect(()=>{r.XN||n.find(e=>e.userID===m?.id)||(0,h.w$)(E)},[E,m?.id,n]),r.XN||0===E)return null;let I=0===n.length?0:!g&&n.some(e=>e.userID===m?.id)?2:g?p?2:3:1;(3===S&&2===I||2===S&&3===I)&&P(v),S=I;let T=0===I?k.LC:1===I?k.BF:k.k$;return a.createElement("div",{className:k.iE},a.createElement("span",{ref:v,className:[k.KE,T].join(" "),"data-toolbar":!0},a.createElement(x.K,{fileKey:e.fileKey,className:1===I?k.Cm:k.Uf,"data-tooltip-type":b.Ib.TEXT,"data-tooltip":(()=>{if(!g&&_)return(0,i.t)("collaboration.voice.join_conversation")})()},a.createElement("span",{className:1===I||0===I||3===I?k.iG:k.kk},a.createElement("span",{"data-onboarding-key":"audio-nux-key",className:3===I?k.g_:k.zc},a.createElement(w.A.HeadphonesIcon,{className:1===I?k.QH:k.H2,size:0===I?32:24}),3===I&&a.createElement("div",{className:k.dv},E)),a.createElement("span",{className:k.yu},(0,i.tx)("collaboration.voice.join")),2===I&&a.createElement("div",{className:k.rf},E))),a.createElement("div",{className:k.W7}),3===I&&m&&a.createElement(C.Y,{userId:m.id,onMuteButtonClickCallback:y})))}function N(e){let t=(0,o.Pj)(),n=(0,m.q5)(),s=(0,o.d4)(e=>e.orgById),u=(0,o.d4)(e=>e.teams),f=(0,o.d4)(e=>e.selectedView?.editorType),C=(0,o.d4)(e=>"prototype"===e.selectedView.view),I=f===v.nT.Design||f===v.nT.Whiteboard||f===v.nT.DevHandoff||f===v.nT.Slides||f===v.nT.Illustration,T=(0,o.wA)();if(r.XN||!n||C||!I)return null;let P=(0,_.YL)({openFile:n,teams:u,orgById:s});if(P===_.gW.FEATURE_DISABLED)return null;if(P===_.gW.ELIGIBLE_WITH_UPGRADE)return a.createElement(a.Fragment,null,a.createElement("span",{className:k.WF,"data-onboarding-key":h._2,onClick:()=>{let e=n.teamId&&u[n.teamId];if(!e)return;(0,c.ds)("CTA Clicked",n.key,t.getState(),{name:"Disabled Voice Call Button"});let a=f===v.nT.Whiteboard?p._Y.WHITEBOARD:p._Y.DESIGN;T(l.to({type:y.DV,data:{team:e,resource:g.Bi.AUDIO,action:E.pE.USE_AUDIO,editorType:a,currentPlan:d.F.Plan.STARTER,upsellPlan:d.F.Plan.PRO}}))}},a.createElement(w.A.HeadphonesIcon,{className:k.tL,size:32})));if(P!==_.gW.ELIGIBLE){let e=P===_.gW.DISABLED_BY_ORG?(0,i.t)("collaboration.voice.audio_has_been_disabled_by_your_organization"):(0,i.t)("collaboration.voice.to_use_audio_in_this_file_move_it_to_a_team_on_one_of_our_paid_plans");return a.createElement("span",{className:k.WF,"data-tooltip-type":b.Ib.TEXT,"data-tooltip-show-immediately":!0,"data-tooltip":e},a.createElement(w.A.HeadphonesIcon,{className:k.sl,size:32}))}return a.createElement("div",{className:k.Te},a.createElement(x.K,{fileKey:n.key,className:k.iw,"data-tooltip-type":b.Ib.TEXT,"data-tooltip":(0,i.t)("collaboration.voice.start_conversation"),hidePopover:e.hidePopover},a.createElement("span",{className:k.iG},a.createElement("span",{"data-onboarding-key":"audio-nux-key",className:k.zc},a.createElement(w.A.HeadphonesIcon,{className:k.tL,size:32})))))}},981420:(e,t,n)=>{n.d(t,{U:()=>o});var a=n(720300);let o=new(n(573349)).b({name:"react_scenegraph",dependencies:[],exports:{"./lazy_root":"./lazy_root.tsx","./jsx_panel":"./jsx_panel.tsx","./chart/import_data_modal":"./chart/import_data_modal.tsx","./jsx_props":"./jsx_props.ts"},friendFiles:[],routeHints:["react_scenegraph"],eslint:{rules:{"react/jsx-no-literals":["error",{elementOverrides:{Text:{allowElement:!0},Line:{allowElement:!0},UnorderedList:{allowElement:!0},OrderedList:{allowElement:!0},Sticky:{allowElement:!0}}}]}}}).createLazyComponent(()=>Promise.all([n.e(7989),n.e(6517)]).then(n.bind(n,922094)).then(e=>e.ReactScenegraphRoot),{componentName:"LazyReactScenegraphRoot",error:a.H4.NONE})},364421:(e,t,n)=>{n.d(t,{W:()=>c});var a=n(848318),o=n(536384),r=n.n(o),i=n(277930),l=n(67188);function s(e){return a.createElement("div",{"aria-selected":e.selected,"aria-label":e.label,id:e.id,key:e.id,onPointerOver:e.onHover,onPointerOut:e.onHoverOut,onMouseDown:l.dG,onMouseUp:e.onClick,role:e.role},e.displayText)}function c({children:e,label:t,onSelect:n,initiallyNotSelected:o,renderer:l,autofocus:c,customClassName:d}){let m=(0,a.useRef)(null),[u,p,h,f,_]=function({children:e,onSelect:t,initiallyNotSelected:n}){let o=(0,a.useMemo)(()=>e.map(e=>({type:"value",value:e})),[e]),[r,i]=(0,a.useState)(n?-1:0),[l,s]=(0,a.useState)([]);return(0,a.useEffect)(()=>{let e=l.map(e=>o[e]?.value).filter(e=>void 0!==e);t?.(e)},[o,l,t]),[o,r,i,l,s]}({children:e,onSelect:n,initiallyNotSelected:o}),g=(0,a.useMemo)(()=>{let e="function"==typeof l&&l||l.label,t="function"==typeof l&&l||l.id||l.label;return{label:e,id:t,searchTerm:"function"==typeof l&&l||l.searchTerm||l.label,renderDisplay:"function"==typeof l&&l||l.renderDisplay||l.label,renderAccessibleItem:("function"==typeof l?void 0:l.renderAccessibleItem)||s}},[l]),{onKeyDown:v,role:E,tabIndex:b,activeDescendant:y}=function({cursor:e,model:t,render:n,setCursor:o,setSelection:r}){let[l,s]=(0,a.useState)(""),c=(0,i.A)(()=>{s("")},200),d=(0,a.useCallback)(a=>{switch(a.key){case"ArrowUp":{let n=e;do n=Math.max(0,n-1);while(n>0&&"separator"===t[n].type)o(n),a.stopPropagation(),a.preventDefault();break}case"ArrowDown":{let n=e;do n=Math.min(t.length-1,n+1);while(n>0&&"separator"===t[n].type)o(n),a.stopPropagation(),a.preventDefault();break}case"Home":o(0),a.stopPropagation(),a.preventDefault();break;case"End":o(t.length-1),a.stopPropagation(),a.preventDefault();break;case" ":case"Enter":r([e]),a.stopPropagation(),a.preventDefault();break;default:if(RegExp("^\\p{Alpha}$","u").test(a.key)){let e=l+a.key,r=RegExp(`^${e}`,"iu"),i=t.findIndex(e=>"value"===e.type&&r.test(n.searchTerm(e.value)));i>=0&&o(i),s(e),c(),a.stopPropagation(),a.preventDefault()}}},[e,t,l,n,c,o,r]),m=t[e];return{onKeyDown:d,role:"listbox",tabIndex:0,activeDescendant:m?.type==="value"?n.id(m.value):void 0}}({cursor:p,model:u,render:g,setCursor:h,setSelection:_});return(0,a.useEffect)(()=>{c&&m.current?.focus()},[c]),a.createElement("div",{role:E,onKeyDown:v,className:r()("listbox--listbox--7TMgv",d),tabIndex:b,"aria-label":t,"aria-activedescendant":y,ref:m},...u.map((e,t)=>{switch(e.type){case"separator":return a.createElement("hr",{key:t});case"value":let n=p===t,o=f.includes(t),r=g.id(e.value),i=g.label(e.value),l=g.renderDisplay(e.value,{hasCursor:n,selected:o});return g.renderAccessibleItem({selected:o,hasCursor:n,onHover:e=>{h(t),e.stopPropagation(),e.preventDefault()},onHoverOut:e=>{e.relatedTarget&&(p===t&&h(-1),e.stopPropagation(),e.preventDefault())},onClick:e=>{h(t),_([t]),e.stopPropagation(),e.preventDefault()},id:r,label:i,displayText:l,role:"option"})}}))}},993766:(e,t,n)=>{n.d(t,{HD:()=>N,NT:()=>A,ws:()=>L});var a=n(848318),o=n(301168),r=n(19180),i=n(223926),l=n.n(i),s=n(239910),c=n.n(s),d=n(946678),m=n.n(d),u=n(260986),p=n.n(u),h=n(204295),f=n(652576),_=n(566841),g=n(968602),v=n(391375),E=n(740267),b=n(677334),y=n(20687),C=n(811085),w=n(722563),x=n(152545),k=n(475166),I=n(313434),T=n(284425),P=n(924476),S=n(46290);let M=b.M4.Query({fetch:async e=>(await S.d.getDefaultCollageItems({orgId:e})).data.meta});var N=(e=>(e[e.LIBRARY_ITEM=0]="LIBRARY_ITEM",e[e.WIDGET=1]="WIDGET",e[e.PLUGIN=2]="PLUGIN",e[e.TEMPLATE=3]="TEMPLATE",e[e.FACE_STAMP=4]="FACE_STAMP",e[e.WHITEBOARD_TOOL=5]="WHITEBOARD_TOOL",e))(N||{});let D=new Set([C.Ph,C.T0]);function A(){let e=function(){let{productComponents:e}=(0,v.g5)(k.$A.FigJam),t=(0,f.op)(),n=(0,_.eE)(k.$A.FigJam),r=(0,f.qr)(),i=(0,T.qK)(),s=function(){let e=(0,o.d4)(e=>e.recentlyUsed.whiteboardTools),t=(0,P.o)();return a.useMemo(()=>t?e.figjam.map(e=>e.id):[],[t,e])}(),d=(0,o.d4)(E.s),u=(0,o.d4)(e=>e.recentlyUsed);return(0,a.useMemo)(()=>(function(e,t,n,a,o,r,i,s){let d=t.templates.figjam.reduce((e,t)=>(e[(0,w.X2)(t)]=t,e),{}),u={...c()(t.libraryItems.figjam,"key"),...c()(t.plugins.figjam,"id"),...d,...c()(t.widgets.figjam,"id"),...c()(t.faceStamps.figjam,"user.id"),...c()(t.whiteboardTools?.figjam,"id")},p=[...n.map(t=>({type:0,item:t,id:t.id,lastAddedAt:u["component"===t.type?t.component_key:t.key]?.last_added_at_by_user_id?.[e]})),...a.map(t=>({type:2,item:t,id:t.plugin_id,lastAddedAt:u[t.plugin_id]?.last_added_at_by_user_id?.[e]})),...o.map(t=>{let n=(0,g.gp)(t);return{type:3,item:t,id:t.template.id,lastAddedAt:u[n]?.last_added_at_by_user_id?.[e]}}),...r.map(t=>({type:1,item:t,id:t.plugin_id,lastAddedAt:u[t.plugin_id]?.last_added_at_by_user_id?.[e]})),...i.map(t=>({type:4,item:t,id:t.id,lastAddedAt:u[t.id]?.last_added_at_by_user_id?.[e]})),...s.map(t=>({type:5,item:t,id:t,lastAddedAt:u[t]?.last_added_at_by_user_id?.[e]}))],[h,f]=m()(p,e=>!!e.lastAddedAt);return[...h.sort((e,t)=>(t.lastAddedAt||0)-(e.lastAddedAt||0)),...function(e){let t={1:0,0:1,3:2,2:3,4:4,5:5};return function(e){let t=[],n=Math.max(...e.map(e=>e.length));for(let a=0;a<n;a++)e.forEach(e=>{a<e.length&&t.push(e[a])});return t}(Object.entries(l()(e,"type")).sort(([e],[n])=>(t[e]??100)-(t[n]??100)).map(([,e])=>e))}(f)].slice(0,4)})(d,u,e,t,n,r,i,s),[d,u,e,t,n,r,i,s])}(),t=function(){let e=(0,h.q8)(),t=(0,o.d4)(e=>e.currentUserOrgId),[n]=(0,b.IT)(M(t));return(0,a.useMemo)(()=>"loaded"!==n.status?[]:function(e){let t=[];return e.plugins.forEach(e=>{let n=(0,y.uF)(e);t.push({type:2,item:n,id:n.plugin_id})}),e.widgets.forEach(e=>{let n=(0,y.uF)(e);t.push({type:1,item:n,id:n.plugin_id})}),e.components.forEach(e=>{t.push({type:0,item:e,id:e.id})}),e.templates.forEach(e=>{t.push({type:3,item:{type:x.n.HubFile,template:e},id:e.id})}),t}(n.data),[n]).filter(t=>!!(0,r.k)().jamgpt_recents_pin&&!e||t.id&&!D.has(t.id))}(),n=function(e){let t=(0,h.q8)();if(!(0,r.k)().jamgpt_recents_pin||t)return null;for(let t of e)if(t.id&&D.has(t.id))return t;return null}(t),i=(0,h.q8)();return(0,a.useMemo)(()=>{let a=[];n?(a.push(n),e.forEach(e=>{e.id!==n.id&&a.push(e)})):a=e,i&&(a=a.filter(e=>!(i&&D.has(e.id||""))));let o=[...a,...t].filter(e=>e.id);return p()(o,"id").slice(0,4)},[t,n,e,i])}function L(e){return(0,I.mk)(e,[])}},134700:(e,t,n)=>{n.d(t,{E:()=>$,h:()=>z});var a=n(848318),o=n(301168),r=n(536384),i=n.n(r),l=n(398612),s=n(410441),c=n(230618),d=n(792001),m=n(63443),u=n(968602),p=n(240176),h=n(848751),f=n(459720),_=n(144379),g=n(653344),v=n(234001),E=n(534619),b=n(318147),y=n(431063),C=n(475166),w=n(17753),x=n(792755),k=n(889415),I=n(824662),T=n(102382),P=n(961687),S=n(620803),M=n(399396),N=n(154502),D=n(892576),A=n(993766),L=n(430781),R=n(27776);let O="dlt_universal_insert_item--recentItem--Jci7m",B="dlt_universal_insert_item--recentItemImage--vvIrT",F=(0,s.jz)(R.MNc);function U(e){return`data:image/svg+xml;utf8,${encodeURIComponent(e)}`}let V=U(`<svg width="68" height="41" viewBox="0 0 68 41" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="0.858643" y="0.297363" width="66.9565" height="40" fill="#F5F5F5"/>
<path d="M6.24878 6.57568L61.5614 35.8461" stroke="#E6E6E6" stroke-width="2"/>
</svg>`),H=U(`<svg width="47" height="47" viewBox="0 0 47 47" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="0.795898" y="0.795898" width="46" height="46" rx="4" fill="#F5F5F5"/>
<path d="M6.05078 6.43506L42.0168 41.4843" stroke="#E6E6E6" stroke-width="2"/>
</svg>`);function q(e,t){let[n,o]=(0,a.useState)(0),[r,i]=(0,a.useState)(0);return(0,a.useEffect)(()=>{if(e){let t=new Image;t.addEventListener("load",function(){o(t.naturalWidth),i(t.naturalHeight)}),t.src=e}},[e]),!e||n*r>25e5?t:e}function z(e,t,n){let{item:a,type:o}=e;if(!a)return null;switch(o){case A.HD.LIBRARY_ITEM:return(n&&a.thumbnail_url?(0,l.NQ)(a.thumbnail_url,"fuid",n):a.thumbnail_url)||null;case A.HD.WIDGET:return a.redirect_snapshot_url||N.J;case A.HD.PLUGIN:return a.redirect_icon_url||M.W;case A.HD.TEMPLATE:return t(a).imageUrl||null;case A.HD.FACE_STAMP:return a.img_url||null;case A.HD.WHITEBOARD_TOOL:return(0,E.AE)(a)}}function $({item:e,width:t,height:n,disableTooltips:o}){let r=(0,u.fG)(),i=(0,a.useCallback)(e=>z(e,r),[r]);if(!e.item)return null;switch(e.type){case A.HD.LIBRARY_ITEM:return a.createElement(I.lX,{draggable:{sourceForTracking:"universal-insert-figjam-collage"},height:n||F,isDragged:o,isFigJam:!0,item:e.item,noBackground:!0,shouldHideDescription:!0,showName:!1,tooltipShownAbove:!0,width:t||F});case A.HD.WIDGET:return a.createElement(K,{widget:e.item,disableTooltips:o,imgSrc:i(e)});case A.HD.PLUGIN:return a.createElement(W,{plugin:e.item,disableTooltips:o,imgSrc:i(e)});case A.HD.TEMPLATE:return a.createElement(Z,{template:e.item,disableTooltips:o,width:t||F,imgSrc:i(e)});case A.HD.FACE_STAMP:return a.createElement(P.I,{mini:!0,hideName:!0,user:e.item,triggeredFrom:(0,y.Vq)(T.p.RECENTS_COLLAGE)});case A.HD.WHITEBOARD_TOOL:return a.createElement(G,{tool:e.item,onInsertableResourcePointerDown:(0,S.Yx)(e.item).insertToolWithDragAction,disableTooltips:o});default:return null}}function K({widget:e,disableTooltips:t,imgSrc:n}){let o=q(n,e.redirect_icon_url||H);return a.createElement("div",{className:O,"data-tooltip-type":t?void 0:w.Ib.TEXT,"data-tooltip":t?void 0:e.name,"data-tooltip-timeout-delay":t?void 0:500,"data-tooltip-show-above":!t||void 0},a.createElement(k._,{src:o,widget:e,analytics:{triggeredFrom:"universal-insert-figjam-collage"},fillContainer:!0,clickToInsert:!1,context:b._Y.WHITEBOARD}))}function W({plugin:e,disableTooltips:t,imgSrc:n}){let{dragState:o,onInsertableResourcePointerDown:r}=(0,g.c)({clickToInsert_DEPRECATED:!1,triggeredFrom:(0,y.Vq)(T.p.RECENTS_COLLAGE),resource:e}),i=q(n,H);return a.createElement(a.Fragment,null,a.createElement("div",{className:O,"data-tooltip-type":t?void 0:w.Ib.TEXT,"data-tooltip":t?void 0:e.name,"data-tooltip-timeout-delay":t?void 0:500,"data-tooltip-show-above":!t||void 0,onPointerDown:r,role:"button",tabIndex:0},a.createElement("div",{className:"dlt_universal_insert_item--recentPluginImageContainer--j2z08"},a.createElement("img",{src:i,alt:e.name,className:B,draggable:!1}))),a.createElement(f.z,{dragState:o}))}function Z({template:e,disableTooltips:t,width:n,imgSrc:o}){let r;let{dragState:l,onInsertableResourcePointerDown:s}=(0,v.B)({resource:e,clickToInsert_DEPRECATED:!1,triggeredFrom:"universal-insert-figjam-collage"}),{name:c,clientMeta:m,thumbnailIsSet:h,hubFileId:f,resizedThumbnailUrls:g}=(0,u.fG)()(e);if(g){let e=Object.keys(g).map(e=>Number(e)).sort()[0];e&&(r=g[e])}let E=q(r||o,V);return a.createElement(a.Fragment,null,a.createElement("div",{className:i()(O,{[L.J]:!!l}),"data-tooltip-type":t?void 0:w.Ib.TEXT,"data-tooltip":t?void 0:c,"data-tooltip-timeout-delay":t?void 0:500,"data-tooltip-show-above":!t||void 0,onPointerDown:s,role:"button",tabIndex:0,style:{width:n,height:.6*n}},a.createElement(x.WM,{backgroundColor:(0,p.Cn)(m),removeBorder:!0,className:i()("dlt_universal_insert_item--recentTemplateCommunityCard--0w4xu",{"dlt_universal_insert_item--recentTemplateCommunityCardInnerImage--nDAlH":!h})},a.createElement(D.Ho,{image:E,isSet:!!h,isWhiteboard:!0,hubFileId:f,alt:c,draggable:!1,resizedThumbnailUrls:g,thumbnailContext:d.O7.UNIVERSAL_INSERT}))),a.createElement(_.S,{dragState:l}))}function G({tool:e,onInsertableResourcePointerDown:t,disableTooltips:n}){let r=(0,o.wA)(),i=(0,o.d4)(e=>e.user?.id),l=a.useCallback(()=>{r(m.ay({currentUserId:i,storeInRecentsKey:C.$A.FigJam,item:{id:e,type:C.vt.WhiteboardTool}}))},[i,r,e]),{dragState:s,onInsertableResourcePointerDown:d}=(0,E.Ik)({resource:e,insertAction:t,clickToInsert_DEPRECATED:!1,triggeredFrom:(0,y.Vq)(T.p.RECENTS_COLLAGE),afterSuccessfulInsert:l}),u=(0,E.AE)(e);return a.createElement(a.Fragment,null,a.createElement("div",{className:O,"data-tooltip-type":n?void 0:w.Ib.TEXT,"data-tooltip":n?void 0:(0,E.E)(e),"data-tooltip-timeout-delay":n?void 0:500,"data-tooltip-show-above":!n||void 0,onPointerDown:d,role:"button",tabIndex:0},a.createElement("div",{className:"dlt_universal_insert_item--recentTool--fZfmo"},a.createElement(c.oW,{src:u,alt:(0,E.E)(e),className:B,draggable:!1}))),a.createElement(h.M,{dragState:s}))}},633899:(e,t,n)=>{n.d(t,{e:()=>m});var a=n(940807),o=n(410441),r=n(601167),i=n(993865),l=n(596414),s=n(27776);let c=l.V3*l.w,d=(0,o.jz)(s.rY4)+16;function m(e,t,n){let a=e.guid,o=e.absoluteBoundingBox,l=t.getViewportInfo();return Math.max(o.w,o.h)*l.zoomScale<=170?(0,r.QZ)({nodeId:a,minSizePx:170,alwaysPan:!1}):(0,r.QZ)({...i.B5,nodeId:a,nodeAbsoluteBounds:"vote"===n?p(o,l):u(o),viewportRect:h(l,d)})}let u=e=>a.r.fromOriginAndSize(e.x,e.y,e.w,e.h),p=(e,t)=>{let n=c/t.zoomScale,o=l.HG/t.zoomScale;return a.r.fromOriginAndSize(e.x,e.y-n,e.w+o,e.h+n)},h=(e,t)=>({origin:{x:0,y:0},size:{x:e.width-t,y:e.height}})},331945:(e,t,n)=>{n.d(t,{m:()=>s,v:()=>l});var a=n(848318),o=n(967688),r=n(636524),i=n(125952);function l({userId:e,user:t,loading:n,size:o,defaultClassName:r,loadingClassName:l}){return t?a.createElement(i.Ro,{size:o,entity:t,className:r}):n?a.createElement("div",{className:l,style:{width:o,height:o}}):a.createElement(i.Ro,{size:o,entity:{id:e},className:r})}function s({userId:e,user:t,loading:n,defaultClassName:i,loadingClassName:l}){return t?a.createElement("span",{className:i},t.handle):n?a.createElement("span",{className:l}):(0,r.Fl)(e)?a.createElement("span",{className:i},(0,o.tx)("voting.voter_username.visitor")):a.createElement("span",{className:i},(0,o.tx)("voting.voter_username.unavailable"))}},658466:(e,t,n)=>{n.d(t,{r:()=>m});var a=n(848318),o=n(301168),r=n(186606),i=n(66699),l=n(446244),s=n(986368),c=n(353231),d=n(62053);function m(e,t){let n=(0,o.wA)();return(0,a.useCallback)(()=>{(0,i.YQ)({id:"figjam-saves"}),e?(n(s.KE()),r.glU?.triggerActionInUserEditScope("set-tool-default",{source:d.fK})):(r.glU?.triggerActionInUserEditScope("clear-tool",{source:d.fK}),n(l.jD()),n(s.En({initialX:0,initialY:0,initialTab:t})),(0,c.Cu)({source:d.fK},d.tV))},[e,t,n])}},771194:(e,t,n)=>{n.d(t,{P:()=>o});var a=n(749214);let o=(0,n(848318).memo)(function(e){return(0,a.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,a.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M13 7v5a1 1 0 1 1-2 0V7a1 1 0 1 1 2 0m-3 0a2 2 0 1 1 4 0v5a2 2 0 1 1-4 0zm-1.5 4.5a.5.5 0 0 0-1 0v.5a4.5 4.5 0 0 0 4 4.473V18h-2a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-2v-1.527a4.5 4.5 0 0 0 4-4.473v-.5a.5.5 0 0 0-1 0v.5a3.5 3.5 0 1 1-7 0z",clipRule:"evenodd"})})})},319647:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(749214),o=n(848318),r=n(58153);let i=(0,o.memo)(function(e){return(0,r.O)()?(0,a.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,a.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M12.354 6.146a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L11.5 7.707V13.5a.5.5 0 0 0 1 0V7.707l2.146 2.147a.5.5 0 0 0 .708-.708zM7 13.5a.5.5 0 0 0-1 0v3A1.5 1.5 0 0 0 7.5 18h9a1.5 1.5 0 0 0 1.5-1.5v-3a.5.5 0 0 0-1 0v3a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5z",clipRule:"evenodd"})}):(0,a.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,a.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M11.854 6.146a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L11 7.707V13.5a.5.5 0 0 0 1 0V7.707l2.146 2.147a.5.5 0 0 0 .708-.708zM7 13.5a.5.5 0 0 0-1 0v3A1.5 1.5 0 0 0 7.5 18h8a1.5 1.5 0 0 0 1.5-1.5v-3a.5.5 0 0 0-1 0v3a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5z",clipRule:"evenodd"})})})}}]);

//# debugId=28ec32cc-20fe-5fa5-b62d-8fc459ba0686

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/c806c444796268d576cc87e80c35e04d40e9a08e/3814-47251e816f2a9e63.min.js.map